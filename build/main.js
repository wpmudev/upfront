//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/**
 * @license RequireJS text 2.0.3 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/* Chosen v1.1.0 | (c) 2011-2013 by Harvest | MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md */

/*! jquery-dateFormat 10-05-2014 */

/*!
 * jQuery Simulate v@VERSION - simulate browser mouse and keyboard events
 * https://github.com/jquery/jquery-simulate
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * Date: @DATE
 */

/**
 * findAndReplaceDOMText v 0.4.2
 * @author James Padolsey http://james.padolsey.com
 * @license http://unlicense.org/UNLICENSE
 *
 * Matches the text of a DOM node against a regular expression
 * and replaces each match (or node-separated portions of the match)
 * in the specified element.
 */

/*
    Redactor v10.0.9
    Updated: March 16, 2015

    http://imperavi.com/redactor/

    Copyright (c) 2009-2015, Imperavi LLC.
    License: http://imperavi.com/redactor/license/

    Usage: $('#content').redactor();
*/

(function(){function t(t){function e(e,i,n,o,r,s){for(;r>=0&&s>r;r+=t){var a=o?o[r]:r;n=i(n,e[a],a,e)}return n}return function(i,n,o,r){n=b(n,r,4);var s=!E(i)&&v.keys(i),a=(s||i).length,l=t>0?0:a-1;return arguments.length<3&&(o=i[s?s[l]:l],l+=t),e(i,n,o,s,l,a)}}function e(t){return function(e,i,n){i=y(i,n);for(var o=U(e),r=t>0?0:o-1;r>=0&&o>r;r+=t)if(i(e[r],r,e))return r;return-1}}function i(t,e,i){return function(n,o,r){var s=0,a=U(n);if("number"==typeof r)t>0?s=r>=0?r:Math.max(r+a,s):a=r>=0?Math.min(r+1,a):r+a+1;else if(i&&r&&a)return r=i(n,o),n[r]===o?r:-1;if(o!==o)return r=e(d.call(n,s,a),v.isNaN),r>=0?r+s:-1;for(r=t>0?s:a-1;r>=0&&a>r;r+=t)if(n[r]===o)return r;return-1}}function n(t,e){var i=I.length,n=t.constructor,o=v.isFunction(n)&&n.prototype||a,r="constructor";for(v.has(t,r)&&!v.contains(e,r)&&e.push(r);i--;)r=I[i],r in t&&t[r]!==o[r]&&!v.contains(e,r)&&e.push(r)}var o=this,r=o._,s=Array.prototype,a=Object.prototype,l=Function.prototype,p=s.push,d=s.slice,c=a.toString,u=a.hasOwnProperty,h=Array.isArray,f=Object.keys,_=l.bind,g=Object.create,m=function(){},v=function(t){return t instanceof v?t:this instanceof v?void(this._wrapped=t):new v(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=v),exports._=v):o._=v,v.VERSION="1.8.3";var b=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,o){return t.call(e,i,n,o)};case 4:return function(i,n,o,r){return t.call(e,i,n,o,r)}}return function(){return t.apply(e,arguments)}},y=function(t,e,i){return null==t?v.identity:v.isFunction(t)?b(t,e,i):v.isObject(t)?v.matcher(t):v.property(t)};v.iteratee=function(t,e){return y(t,e,1/0)};var w=function(t,e){return function(i){var n=arguments.length;if(2>n||null==i)return i;for(var o=1;n>o;o++)for(var r=arguments[o],s=t(r),a=s.length,l=0;a>l;l++){var p=s[l];e&&void 0!==i[p]||(i[p]=r[p])}return i}},k=function(t){if(!v.isObject(t))return{};if(g)return g(t);m.prototype=t;var e=new m;return m.prototype=null,e},$=function(t){return function(e){return null==e?void 0:e[t]}},x=Math.pow(2,53)-1,U=$("length"),E=function(t){var e=U(t);return"number"==typeof e&&e>=0&&x>=e};v.each=v.forEach=function(t,e,i){e=b(e,i);var n,o;if(E(t))for(n=0,o=t.length;o>n;n++)e(t[n],n,t);else{var r=v.keys(t);for(n=0,o=r.length;o>n;n++)e(t[r[n]],r[n],t)}return t},v.map=v.collect=function(t,e,i){e=y(e,i);for(var n=!E(t)&&v.keys(t),o=(n||t).length,r=Array(o),s=0;o>s;s++){var a=n?n[s]:s;r[s]=e(t[a],a,t)}return r},v.reduce=v.foldl=v.inject=t(1),v.reduceRight=v.foldr=t(-1),v.find=v.detect=function(t,e,i){var n;return n=E(t)?v.findIndex(t,e,i):v.findKey(t,e,i),void 0!==n&&n!==-1?t[n]:void 0},v.filter=v.select=function(t,e,i){var n=[];return e=y(e,i),v.each(t,function(t,i,o){e(t,i,o)&&n.push(t)}),n},v.reject=function(t,e,i){return v.filter(t,v.negate(y(e)),i)},v.every=v.all=function(t,e,i){e=y(e,i);for(var n=!E(t)&&v.keys(t),o=(n||t).length,r=0;o>r;r++){var s=n?n[r]:r;if(!e(t[s],s,t))return!1}return!0},v.some=v.any=function(t,e,i){e=y(e,i);for(var n=!E(t)&&v.keys(t),o=(n||t).length,r=0;o>r;r++){var s=n?n[r]:r;if(e(t[s],s,t))return!0}return!1},v.contains=v.includes=v.include=function(t,e,i,n){return E(t)||(t=v.values(t)),("number"!=typeof i||n)&&(i=0),v.indexOf(t,e,i)>=0},v.invoke=function(t,e){var i=d.call(arguments,2),n=v.isFunction(e);return v.map(t,function(t){var o=n?e:t[e];return null==o?o:o.apply(t,i)})},v.pluck=function(t,e){return v.map(t,v.property(e))},v.where=function(t,e){return v.filter(t,v.matcher(e))},v.findWhere=function(t,e){return v.find(t,v.matcher(e))},v.max=function(t,e,i){var n,o,r=-1/0,s=-1/0;if(null==e&&null!=t){t=E(t)?t:v.values(t);for(var a=0,l=t.length;l>a;a++)n=t[a],n>r&&(r=n)}else e=y(e,i),v.each(t,function(t,i,n){o=e(t,i,n),(o>s||o===-1/0&&r===-1/0)&&(r=t,s=o)});return r},v.min=function(t,e,i){var n,o,r=1/0,s=1/0;if(null==e&&null!=t){t=E(t)?t:v.values(t);for(var a=0,l=t.length;l>a;a++)n=t[a],r>n&&(r=n)}else e=y(e,i),v.each(t,function(t,i,n){o=e(t,i,n),(s>o||1/0===o&&1/0===r)&&(r=t,s=o)});return r},v.shuffle=function(t){for(var e,i=E(t)?t:v.values(t),n=i.length,o=Array(n),r=0;n>r;r++)e=v.random(0,r),e!==r&&(o[r]=o[e]),o[e]=i[r];return o},v.sample=function(t,e,i){return null==e||i?(E(t)||(t=v.values(t)),t[v.random(t.length-1)]):v.shuffle(t).slice(0,Math.max(0,e))},v.sortBy=function(t,e,i){return e=y(e,i),v.pluck(v.map(t,function(t,i,n){return{value:t,index:i,criteria:e(t,i,n)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return t.index-e.index}),"value")};var S=function(t){return function(e,i,n){var o={};return i=y(i,n),v.each(e,function(n,r){var s=i(n,r,e);t(o,n,s)}),o}};v.groupBy=S(function(t,e,i){v.has(t,i)?t[i].push(e):t[i]=[e]}),v.indexBy=S(function(t,e,i){t[i]=e}),v.countBy=S(function(t,e,i){v.has(t,i)?t[i]++:t[i]=1}),v.toArray=function(t){return t?v.isArray(t)?d.call(t):E(t)?v.map(t,v.identity):v.values(t):[]},v.size=function(t){return null==t?0:E(t)?t.length:v.keys(t).length},v.partition=function(t,e,i){e=y(e,i);var n=[],o=[];return v.each(t,function(t,i,r){(e(t,i,r)?n:o).push(t)}),[n,o]},v.first=v.head=v.take=function(t,e,i){return null==t?void 0:null==e||i?t[0]:v.initial(t,t.length-e)},v.initial=function(t,e,i){return d.call(t,0,Math.max(0,t.length-(null==e||i?1:e)))},v.last=function(t,e,i){return null==t?void 0:null==e||i?t[t.length-1]:v.rest(t,Math.max(0,t.length-e))},v.rest=v.tail=v.drop=function(t,e,i){return d.call(t,null==e||i?1:e)},v.compact=function(t){return v.filter(t,v.identity)};var C=function(t,e,i,n){for(var o=[],r=0,s=n||0,a=U(t);a>s;s++){var l=t[s];if(E(l)&&(v.isArray(l)||v.isArguments(l))){e||(l=C(l,e,i));var p=0,d=l.length;for(o.length+=d;d>p;)o[r++]=l[p++]}else i||(o[r++]=l)}return o};v.flatten=function(t,e){return C(t,e,!1)},v.without=function(t){return v.difference(t,d.call(arguments,1))},v.uniq=v.unique=function(t,e,i,n){v.isBoolean(e)||(n=i,i=e,e=!1),null!=i&&(i=y(i,n));for(var o=[],r=[],s=0,a=U(t);a>s;s++){var l=t[s],p=i?i(l,s,t):l;e?(s&&r===p||o.push(l),r=p):i?v.contains(r,p)||(r.push(p),o.push(l)):v.contains(o,l)||o.push(l)}return o},v.union=function(){return v.uniq(C(arguments,!0,!0))},v.intersection=function(t){for(var e=[],i=arguments.length,n=0,o=U(t);o>n;n++){var r=t[n];if(!v.contains(e,r)){for(var s=1;i>s&&v.contains(arguments[s],r);s++);s===i&&e.push(r)}}return e},v.difference=function(t){var e=C(arguments,!0,!0,1);return v.filter(t,function(t){return!v.contains(e,t)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(t){for(var e=t&&v.max(t,U).length||0,i=Array(e),n=0;e>n;n++)i[n]=v.pluck(t,n);return i},v.object=function(t,e){for(var i={},n=0,o=U(t);o>n;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},v.findIndex=e(1),v.findLastIndex=e(-1),v.sortedIndex=function(t,e,i,n){i=y(i,n,1);for(var o=i(e),r=0,s=U(t);s>r;){var a=Math.floor((r+s)/2);i(t[a])<o?r=a+1:s=a}return r},v.indexOf=i(1,v.findIndex,v.sortedIndex),v.lastIndexOf=i(-1,v.findLastIndex),v.range=function(t,e,i){null==e&&(e=t||0,t=0),i=i||1;for(var n=Math.max(Math.ceil((e-t)/i),0),o=Array(n),r=0;n>r;r++,t+=i)o[r]=t;return o};var T=function(t,e,i,n,o){if(!(n instanceof e))return t.apply(i,o);var r=k(t.prototype),s=t.apply(r,o);return v.isObject(s)?s:r};v.bind=function(t,e){if(_&&t.bind===_)return _.apply(t,d.call(arguments,1));if(!v.isFunction(t))throw new TypeError("Bind must be called on a function");var i=d.call(arguments,2),n=function(){return T(t,n,e,this,i.concat(d.call(arguments)))};return n},v.partial=function(t){var e=d.call(arguments,1),i=function(){for(var n=0,o=e.length,r=Array(o),s=0;o>s;s++)r[s]=e[s]===v?arguments[n++]:e[s];for(;n<arguments.length;)r.push(arguments[n++]);return T(t,i,this,this,r)};return i},v.bindAll=function(t){var e,i,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(e=1;n>e;e++)i=arguments[e],t[i]=v.bind(t[i],t);return t},v.memoize=function(t,e){var i=function(n){var o=i.cache,r=""+(e?e.apply(this,arguments):n);return v.has(o,r)||(o[r]=t.apply(this,arguments)),o[r]};return i.cache={},i},v.delay=function(t,e){var i=d.call(arguments,2);return setTimeout(function(){return t.apply(null,i)},e)},v.defer=v.partial(v.delay,v,1),v.throttle=function(t,e,i){var n,o,r,s=null,a=0;i||(i={});var l=function(){a=i.leading===!1?0:v.now(),s=null,r=t.apply(n,o),s||(n=o=null)};return function(){var p=v.now();a||i.leading!==!1||(a=p);var d=e-(p-a);return n=this,o=arguments,0>=d||d>e?(s&&(clearTimeout(s),s=null),a=p,r=t.apply(n,o),s||(n=o=null)):s||i.trailing===!1||(s=setTimeout(l,d)),r}},v.debounce=function(t,e,i){var n,o,r,s,a,l=function(){var p=v.now()-s;e>p&&p>=0?n=setTimeout(l,e-p):(n=null,i||(a=t.apply(r,o),n||(r=o=null)))};return function(){r=this,o=arguments,s=v.now();var p=i&&!n;return n||(n=setTimeout(l,e)),p&&(a=t.apply(r,o),r=o=null),a}},v.wrap=function(t,e){return v.partial(e,t)},v.negate=function(t){return function(){return!t.apply(this,arguments)}},v.compose=function(){var t=arguments,e=t.length-1;return function(){for(var i=e,n=t[e].apply(this,arguments);i--;)n=t[i].call(this,n);return n}},v.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},v.before=function(t,e){var i;return function(){return--t>0&&(i=e.apply(this,arguments)),1>=t&&(e=null),i}},v.once=v.partial(v.before,2);var z=!{toString:null}.propertyIsEnumerable("toString"),I=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];v.keys=function(t){if(!v.isObject(t))return[];if(f)return f(t);var e=[];for(var i in t)v.has(t,i)&&e.push(i);return z&&n(t,e),e},v.allKeys=function(t){if(!v.isObject(t))return[];var e=[];for(var i in t)e.push(i);return z&&n(t,e),e},v.values=function(t){for(var e=v.keys(t),i=e.length,n=Array(i),o=0;i>o;o++)n[o]=t[e[o]];return n},v.mapObject=function(t,e,i){e=y(e,i);for(var n,o=v.keys(t),r=o.length,s={},a=0;r>a;a++)n=o[a],s[n]=e(t[n],n,t);return s},v.pairs=function(t){for(var e=v.keys(t),i=e.length,n=Array(i),o=0;i>o;o++)n[o]=[e[o],t[e[o]]];return n},v.invert=function(t){for(var e={},i=v.keys(t),n=0,o=i.length;o>n;n++)e[t[i[n]]]=i[n];return e},v.functions=v.methods=function(t){var e=[];for(var i in t)v.isFunction(t[i])&&e.push(i);return e.sort()},v.extend=w(v.allKeys),v.extendOwn=v.assign=w(v.keys),v.findKey=function(t,e,i){e=y(e,i);for(var n,o=v.keys(t),r=0,s=o.length;s>r;r++)if(n=o[r],e(t[n],n,t))return n},v.pick=function(t,e,i){var n,o,r={},s=t;if(null==s)return r;v.isFunction(e)?(o=v.allKeys(s),n=b(e,i)):(o=C(arguments,!1,!1,1),n=function(t,e,i){return e in i},s=Object(s));for(var a=0,l=o.length;l>a;a++){var p=o[a],d=s[p];n(d,p,s)&&(r[p]=d)}return r},v.omit=function(t,e,i){if(v.isFunction(e))e=v.negate(e);else{var n=v.map(C(arguments,!1,!1,1),String);e=function(t,e){return!v.contains(n,e)}}return v.pick(t,e,i)},v.defaults=w(v.allKeys,!0),v.create=function(t,e){var i=k(t);return e&&v.extendOwn(i,e),i},v.clone=function(t){return v.isObject(t)?v.isArray(t)?t.slice():v.extend({},t):t},v.tap=function(t,e){return e(t),t},v.isMatch=function(t,e){var i=v.keys(e),n=i.length;if(null==t)return!n;for(var o=Object(t),r=0;n>r;r++){var s=i[r];if(e[s]!==o[s]||!(s in o))return!1}return!0};var P=function(t,e,i,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof v&&(t=t._wrapped),e instanceof v&&(e=e._wrapped);var o=c.call(t);if(o!==c.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var r="[object Array]"===o;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,a=e.constructor;if(s!==a&&!(v.isFunction(s)&&s instanceof s&&v.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}i=i||[],n=n||[];for(var l=i.length;l--;)if(i[l]===t)return n[l]===e;if(i.push(t),n.push(e),r){if(l=t.length,l!==e.length)return!1;for(;l--;)if(!P(t[l],e[l],i,n))return!1}else{var p,d=v.keys(t);if(l=d.length,v.keys(e).length!==l)return!1;for(;l--;)if(p=d[l],!v.has(e,p)||!P(t[p],e[p],i,n))return!1}return i.pop(),n.pop(),!0};v.isEqual=function(t,e){return P(t,e)},v.isEmpty=function(t){return null==t||(E(t)&&(v.isArray(t)||v.isString(t)||v.isArguments(t))?0===t.length:0===v.keys(t).length)},v.isElement=function(t){return!(!t||1!==t.nodeType)},v.isArray=h||function(t){return"[object Array]"===c.call(t)},v.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){v["is"+t]=function(e){return c.call(e)==="[object "+t+"]"}}),v.isArguments(arguments)||(v.isArguments=function(t){return v.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(v.isFunction=function(t){return"function"==typeof t||!1}),v.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},v.isNaN=function(t){return v.isNumber(t)&&t!==+t},v.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===c.call(t)},v.isNull=function(t){return null===t},v.isUndefined=function(t){return void 0===t},v.has=function(t,e){return null!=t&&u.call(t,e)},v.noConflict=function(){return o._=r,this},v.identity=function(t){return t},v.constant=function(t){return function(){return t}},v.noop=function(){},v.property=$,v.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},v.matcher=v.matches=function(t){return t=v.extendOwn({},t),function(e){return v.isMatch(e,t)}},v.times=function(t,e,i){var n=Array(Math.max(0,t));e=b(e,i,1);for(var o=0;t>o;o++)n[o]=e(o);return n},v.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},v.now=Date.now||function(){return(new Date).getTime()};var M={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=v.invert(M),O=function(t){var e=function(e){return t[e]},i="(?:"+v.keys(t).join("|")+")",n=RegExp(i),o=RegExp(i,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(o,e):t}};v.escape=O(M),v.unescape=O(j),v.result=function(t,e,i){var n=null==t?void 0:t[e];return void 0===n&&(n=i),v.isFunction(n)?n.call(t):n};var D=0;v.uniqueId=function(t){var e=++D+"";return t?t+e:e},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,V=function(t){return"\\"+L[t]};v.template=function(t,e,i){!e&&i&&(e=i),e=v.defaults({},e,v.templateSettings);var n=RegExp([(e.escape||A).source,(e.interpolate||A).source,(e.evaluate||A).source].join("|")+"|$","g"),o=0,r="__p+='";t.replace(n,function(e,i,n,s,a){return r+=t.slice(o,a).replace(N,V),o=a+e.length,i?r+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":n?r+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var s=new Function(e.variable||"obj","_",r)}catch(t){throw t.source=r,t}var a=function(t){return s.call(this,t,v)},l=e.variable||"obj";return a.source="function("+l+"){\n"+r+"}",a},v.chain=function(t){var e=v(t);return e._chain=!0,e};var B=function(t,e){return t._chain?v(e).chain():e};v.mixin=function(t){v.each(v.functions(t),function(e){var i=v[e]=t[e];v.prototype[e]=function(){var t=[this._wrapped];return p.apply(t,arguments),B(this,i.apply(v,t))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=s[t];v.prototype[t]=function(){var i=this._wrapped;return e.apply(i,arguments),"shift"!==t&&"splice"!==t||0!==i.length||delete i[0],B(this,i)}}),v.each(["concat","join","slice"],function(t){var e=s[t];v.prototype[t]=function(){return B(this,e.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return v})}).call(this),function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(i,n,o){e.Backbone=t(e,o,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(t){}t(e,exports,n,i)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,i,n){var o=t.Backbone,r=Array.prototype.slice;e.VERSION="1.3.3",e.$=n,e.noConflict=function(){return t.Backbone=o,this},e.emulateHTTP=!1,e.emulateJSON=!1;var s=function(t,e,n){switch(t){case 1:return function(){return i[e](this[n])};case 2:return function(t){return i[e](this[n],t)};case 3:return function(t,o){return i[e](this[n],l(t,this),o)};case 4:return function(t,o,r){return i[e](this[n],l(t,this),o,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[n]),i[e].apply(i,t)}}},a=function(t,e,n){i.each(e,function(e,o){i[o]&&(t.prototype[o]=s(e,o,n))})},l=function(t,e){return i.isFunction(t)?t:i.isObject(t)&&!e._isModel(t)?p(t):i.isString(t)?function(e){return e.get(t)}:t},p=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}},d=e.Events={},c=/\s+/,u=function(t,e,n,o,r){var s,a=0;if(n&&"object"==typeof n){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=i.keys(n);a<s.length;a++)e=u(t,e,s[a],n[s[a]],r)}else if(n&&c.test(n))for(s=n.split(c);a<s.length;a++)e=t(e,s[a],o,r);else e=t(e,n,o,r);return e};d.on=function(t,e,i){return h(this,t,e,i)};var h=function(t,e,i,n,o){if(t._events=u(f,t._events||{},e,i,{context:n,ctx:t,listening:o}),o){var r=t._listeners||(t._listeners={});r[o.id]=o}return t};d.listenTo=function(t,e,n){if(!t)return this;var o=t._listenId||(t._listenId=i.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),s=r[o];if(!s){var a=this._listenId||(this._listenId=i.uniqueId("l"));s=r[o]={obj:t,objId:o,id:a,listeningTo:r,count:0}}return h(t,e,n,this,s),this};var f=function(t,e,i,n){if(i){var o=t[e]||(t[e]=[]),r=n.context,s=n.ctx,a=n.listening;a&&a.count++,o.push({callback:i,context:r,ctx:r||s,listening:a})}return t};d.off=function(t,e,i){return this._events?(this._events=u(_,this._events,t,e,{context:i,listeners:this._listeners}),this):this},d.stopListening=function(t,e,n){var o=this._listeningTo;if(!o)return this;for(var r=t?[t._listenId]:i.keys(o),s=0;s<r.length;s++){var a=o[r[s]];if(!a)break;a.obj.off(e,n,this)}return this};var _=function(t,e,n,o){if(t){var r,s=0,a=o.context,l=o.listeners;if(e||n||a){for(var p=e?[e]:i.keys(t);s<p.length;s++){e=p[s];var d=t[e];if(!d)break;for(var c=[],u=0;u<d.length;u++){var h=d[u];n&&n!==h.callback&&n!==h.callback._callback||a&&a!==h.context?c.push(h):(r=h.listening,r&&0===--r.count&&(delete l[r.id],delete r.listeningTo[r.objId]))}c.length?t[e]=c:delete t[e]}return t}for(var f=i.keys(l);s<f.length;s++)r=l[f[s]],delete l[r.id],delete r.listeningTo[r.objId]}};d.once=function(t,e,n){var o=u(g,{},t,e,i.bind(this.off,this));return"string"==typeof t&&null==n&&(e=void 0),this.on(o,e,n)},d.listenToOnce=function(t,e,n){var o=u(g,{},e,n,i.bind(this.stopListening,this,t));return this.listenTo(t,o)};var g=function(t,e,n,o){if(n){var r=t[e]=i.once(function(){o(e,r),n.apply(this,arguments)});r._callback=n}return t};d.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),i=Array(e),n=0;n<e;n++)i[n]=arguments[n+1];return u(m,this._events,t,void 0,i),this};var m=function(t,e,i,n){if(t){var o=t[e],r=t.all;o&&r&&(r=r.slice()),o&&v(o,n),r&&v(r,[e].concat(n))}return t},v=function(t,e){var i,n=-1,o=t.length,r=e[0],s=e[1],a=e[2];switch(e.length){case 0:for(;++n<o;)(i=t[n]).callback.call(i.ctx);return;case 1:for(;++n<o;)(i=t[n]).callback.call(i.ctx,r);return;case 2:for(;++n<o;)(i=t[n]).callback.call(i.ctx,r,s);return;case 3:for(;++n<o;)(i=t[n]).callback.call(i.ctx,r,s,a);return;default:for(;++n<o;)(i=t[n]).callback.apply(i.ctx,e);return}};d.bind=d.on,d.unbind=d.off,i.extend(e,d);var b=e.Model=function(t,e){var n=t||{};e||(e={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(n=this.parse(n,e)||{});var o=i.result(this,"defaults");n=i.defaults(i.extend({},o,n),o),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};i.extend(b.prototype,d,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return i.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this)(this.attributes)},set:function(t,e,n){if(null==t)return this;var o;if("object"==typeof t?(o=t,n=e):(o={})[t]=e,n||(n={}),!this._validate(o,n))return!1;var r=n.unset,s=n.silent,a=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=i.clone(this.attributes),this.changed={});var p=this.attributes,d=this.changed,c=this._previousAttributes;for(var u in o)e=o[u],i.isEqual(p[u],e)||a.push(u),i.isEqual(c[u],e)?delete d[u]:d[u]=e,r?delete p[u]:p[u]=e;if(this.idAttribute in o&&(this.id=this.get(this.idAttribute)),!s){a.length&&(this._pending=n);for(var h=0;h<a.length;h++)this.trigger("change:"+a[h],this,p[a[h]],n)}if(l)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,i.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!i.isEmpty(this.changed):i.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,n={};for(var o in t){var r=t[o];i.isEqual(e[o],r)||(n[o]=r)}return!!i.size(n)&&n},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(t){t=i.extend({parse:!0},t);var e=this,n=t.success;return t.success=function(i){var o=t.parse?e.parse(i,t):i;return!!e.set(o,t)&&(n&&n.call(t.context,e,i,t),void e.trigger("sync",e,i,t))},B(this,t),this.sync("read",this,t)},save:function(t,e,n){var o;null==t||"object"==typeof t?(o=t,n=e):(o={})[t]=e,n=i.extend({validate:!0,parse:!0},n);var r=n.wait;if(o&&!r){if(!this.set(o,n))return!1}else if(!this._validate(o,n))return!1;var s=this,a=n.success,l=this.attributes;n.success=function(t){s.attributes=l;var e=n.parse?s.parse(t,n):t;return r&&(e=i.extend({},o,e)),!(e&&!s.set(e,n))&&(a&&a.call(n.context,s,t,n),void s.trigger("sync",s,t,n))},B(this,n),o&&r&&(this.attributes=i.extend({},l,o));var p=this.isNew()?"create":n.patch?"patch":"update";"patch"!==p||n.attrs||(n.attrs=o);var d=this.sync(p,this,n);return this.attributes=l,d},destroy:function(t){t=t?i.clone(t):{};var e=this,n=t.success,o=t.wait,r=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(i){o&&r(),n&&n.call(t.context,e,i,t),e.isNew()||e.trigger("sync",e,i,t)};var s=!1;return this.isNew()?i.defer(t.success):(B(this,t),s=this.sync("delete",this,t)),o||r(),s},url:function(){var t=i.result(this,"urlRoot")||i.result(this.collection,"url")||V();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},i.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=i.extend({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return!n||(this.trigger("invalid",this,n,i.extend(e,{validationError:n})),!1)}});var y={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};a(b,y,"attributes");var w=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,i.extend({silent:!0},e))},k={add:!0,remove:!0,merge:!0},$={add:!0,remove:!1},x=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var n,o=Array(t.length-i),r=e.length;for(n=0;n<o.length;n++)o[n]=t[n+i];for(n=0;n<r;n++)t[n+i]=e[n];for(n=0;n<o.length;n++)t[n+r+i]=o[n]};i.extend(w.prototype,d,{model:b,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,i.extend({merge:!1},e,$))},remove:function(t,e){e=i.extend({},e);var n=!i.isArray(t);t=n?[t]:t.slice();var o=this._removeModels(t,e);return!e.silent&&o.length&&(e.changes={added:[],merged:[],removed:o},this.trigger("update",this,e)),n?o[0]:o},set:function(t,e){if(null!=t){e=i.extend({},k,e),e.parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var n=!i.isArray(t);t=n?[t]:t.slice();var o=e.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,a=[],l=[],p=[],d=[],c={},u=e.add,h=e.merge,f=e.remove,_=!1,g=this.comparator&&null==o&&e.sort!==!1,m=i.isString(this.comparator)?this.comparator:null;for(s=0;s<t.length;s++){r=t[s];var v=this.get(r);if(v){if(h&&r!==v){var b=this._isModel(r)?r.attributes:r;e.parse&&(b=v.parse(b,e)),v.set(b,e),p.push(v),g&&!_&&(_=v.hasChanged(m))}c[v.cid]||(c[v.cid]=!0,a.push(v)),t[s]=v}else u&&(r=t[s]=this._prepareModel(r,e),r&&(l.push(r),this._addReference(r,e),c[r.cid]=!0,a.push(r)))}if(f){for(s=0;s<this.length;s++)r=this.models[s],c[r.cid]||d.push(r);d.length&&this._removeModels(d,e)}var y=!1,w=!g&&u&&f;if(a.length&&w?(y=this.length!==a.length||i.some(this.models,function(t,e){return t!==a[e]}),this.models.length=0,x(this.models,a,0),this.length=this.models.length):l.length&&(g&&(_=!0),x(this.models,l,null==o?this.length:o),this.length=this.models.length),_&&this.sort({silent:!0}),!e.silent){for(s=0;s<l.length;s++)null!=o&&(e.index=o+s),r=l[s],r.trigger("add",r,this,e);(_||y)&&this.trigger("sort",this,e),(l.length||d.length||p.length)&&(e.changes={added:l,removed:d,merged:p},this.trigger("update",this,e))}return n?t[0]:t}},reset:function(t,e){e=e?i.clone(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,i.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,i.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return i.isFunction(e)&&(e=i.bind(e,this)),1===n||i.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){t=i.extend({parse:!0},t);var e=t.success,n=this;return t.success=function(i){var o=t.reset?"reset":"set";n[o](i,t),e&&e.call(t.context,n,i,t),n.trigger("sync",n,i,t)},B(this,t),this.sync("read",this,t)},create:function(t,e){e=e?i.clone(e):{};var n=e.wait;if(t=this._prepareModel(t,e),!t)return!1;n||this.add(t,e);var o=this,r=e.success;return e.success=function(t,e,i){n&&o.add(t,i),r&&r.call(i.context,t,e,i)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?i.clone(e):{},e.collection=this;var n=new this.model(t,e);return n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var i=[],n=0;n<t.length;n++){var o=this.get(t[n]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes);null!=s&&delete this._byId[s],e.silent||(e.index=r,o.trigger("remove",o,this,e)),i.push(o),this._removeReference(o,e)}}return i},_isModel:function(t){return t instanceof b},_addReference:function(t,e){this._byId[t.cid]=t;var i=this.modelId(t.attributes);null!=i&&(this._byId[i]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var i=this.modelId(t.attributes);null!=i&&delete this._byId[i],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,n){if(e){if(("add"===t||"remove"===t)&&i!==this)return;if("destroy"===t&&this.remove(e,n),"change"===t){var o=this.modelId(e.previousAttributes()),r=this.modelId(e.attributes);o!==r&&(null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=e))}}this.trigger.apply(this,arguments)}});var U={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};a(w,U,"models");var E=e.View=function(t){this.cid=i.uniqueId("view"),i.extend(this,i.pick(t,C)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];i.extend(E.prototype,d,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=i.result(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var n=t[e];if(i.isFunction(n)||(n=this[n]),n){var o=e.match(S);this.delegate(o[1],o[2],i.bind(n,this))}}return this},delegate:function(t,e,i){return this.$el.on(t+".delegateEvents"+this.cid,e,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,i){return this.$el.off(t+".delegateEvents"+this.cid,e,i),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var t=i.extend({},i.result(this,"attributes"));this.id&&(t.id=i.result(this,"id")),this.className&&(t.class=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,n,o){var r=T[t];i.defaults(o||(o={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=i.result(n,"url")||V()),null!=o.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(s.contentType="application/json",
s.data=JSON.stringify(o.attrs||n.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var a=o.beforeSend;o.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",r),a)return a.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var l=o.error;o.error=function(t,e,i){o.textStatus=e,o.errorThrown=i,l&&l.call(o.context,t,e,i)};var p=o.xhr=e.ajax(i.extend(s,o));return n.trigger("request",n,p,o),p};var T={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var z=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},I=/\((.*?)\)/g,P=/(\(\?)?:\w+/g,M=/\*\w+/g,j=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(z.prototype,d,{initialize:function(){},route:function(t,n,o){i.isRegExp(t)||(t=this._routeToRegExp(t)),i.isFunction(n)&&(o=n,n=""),o||(o=this[n]);var r=this;return e.history.route(t,function(i){var s=r._extractParameters(t,i);r.execute(o,s,n)!==!1&&(r.trigger.apply(r,["route:"+n].concat(s)),r.trigger("route",n,s),e.history.trigger("route",r,n,s))}),this},execute:function(t,e,i){t&&t.apply(this,e)},navigate:function(t,i){return e.history.navigate(t,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var t,e=i.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(j,"\\$&").replace(I,"(?:$1)?").replace(P,function(t,e){return e?t:"([^/?]+)"}).replace(M,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var n=t.exec(e).slice(1);return i.map(n,function(t,e){return e===n.length-1?t||null:t?decodeURIComponent(t):null})}});var O=e.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,A=/^\/+|\/+$/g,L=/#.*$/;O.started=!1,i.extend(O.prototype,d,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(D,"")},start:function(t){if(O.started)throw new Error("Backbone.history has already been started");if(O.started=!0,this.options=i.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(A,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,o=n.insertBefore(this.iframe,n.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),O.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e!==this.fragment&&(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),i.some(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!O.started)return!1;e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||"");var i=this.root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var n=i+t;if(t=this.decodeFragment(t.replace(L,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var o=this.iframe.contentWindow;e.replace||(o.document.open(),o.document.close()),this._updateHash(o.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var n=t.href.replace(/(javascript:|#).*$/,"");t.replace(n+"#"+e)}else t.hash="#"+e}}),e.history=new O;var N=function(t,e){var n,o=this;return n=t&&i.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},i.extend(n,o,e),n.prototype=i.create(o.prototype,t),n.prototype.constructor=n,n.__super__=o.prototype,n};b.extend=w.extend=z.extend=E.extend=O.extend=N;var V=function(){throw new Error('A "url" property or function must be specified')},B=function(t,e){var i=e.error;e.error=function(n){i&&i.call(e.context,t,n,e),t.trigger("error",t,n,e)}};return e}),function(t){define("models",["backbone"],function(e){Upfront.Events=_.isEmpty(Upfront.Events)?_.extend(Upfront.Events,e.Events):Upfront.Events;var n=e.Model.extend({defaults:{name:"",value:""},idAttribute:"name"}),o=e.Collection.extend({model:n}),r=e.Model.extend({defaults:{name:"",element_id:"",properties:new o},initialize:function(){var t=arguments;t&&t[0]&&t[0].properties?(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)):this.set("properties",new o([])),this.init&&this.init(),this.get_property_value_by_name("currentpreset")&&(this.set_property("preset",this.get_property_value_by_name("currentpreset"),!0),this.set_property("currentpreset",!1,!0))},get_view_class:function(){return Upfront.Views.ObjectView},get_property_by_name:function(t){var e=this.get("properties").where({name:t});return!!e.length&&e[0]},get_property_value_by_name:function(t){var e=this.get_property_by_name(t);return!(!e||!e.get)&&e.get("value")},has_property:function(t){return!!this.get_property_value_by_name(t)},has_property_value:function(t,e){return e==this.get_property_value_by_name(t)},decode_preset:function(t){t=t||(Upfront.Views.breakpoints_storage.get_breakpoints().get_active()||{}).id;var e,i=this.get_property_value_by_name("current_preset")||this.get_property_value_by_name("preset")||"default",n=this.get_property_value_by_name("breakpoint_presets")||{};"mobile"==t?e=(n[t]||n.tablet||n.desktop||{}).preset:"tablet"==t?e=(n[t]||n.desktop||{}).preset:(e=(n[t]||{}).preset,i=e||i||"default");var o=e||i;return this.set_property("current_preset",i,!0),this.set_property("preset",o,!1),o},encode_preset:function(t,e){e=e||(Upfront.Views.breakpoints_storage.get_breakpoints().get_active()||{}).id;var i=this.get_property_value_by_name("breakpoint_presets")||{},n=(this.get_property_by_name("preset").previousAttributes()||{value:"default"}).value,o=(Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({default:!0})||{}).id;return i[e]={preset:t},i[o]||(i[o]={preset:n}),this.set_property("breakpoint_presets",i,!0),i},add_property:function(t,e,i){i||(i=!1),this.get("properties").add(new Upfront.Models.Property({name:t,value:e}),{silent:i}),Upfront.Events.trigger("model:property:add",t,e,i)},set_property:function(t,e,i){if(!t)return!1;i||(i=!1);var n=this.get_property_by_name(t);return n&&n.set?(n.set({value:e},{silent:i}),void Upfront.Events.trigger("model:property:set",t,e,i)):this.add_property(t,e,i)},remove_property:function(t,e){if(!t)return!1;e||(e=!1);var i=this.get_property_by_name(t);i&&i.set&&(this.get("properties").remove(i,{silent:e}),Upfront.Events.trigger("model:property:remove",t,e))},init_property:function(t,e){this.has_property(t)||this.add_property(t,e)},init_properties:function(t){var e=this;_(t).each(function(t,i){e.init_property(i,t)})},get_content:function(){return this.get_property_value_by_name("content")},set_content:function(t,e){e="undefined"!=typeof e?e:{};var i=this.get_property_by_name("content");return i?i.set("value",t,e):this.get("properties").add(new Upfront.Models.Property({name:"content",value:t}))},get_element_id:function(){return this.get_property_value_by_name("element_id")},get_wrapper_id:function(){return this.get_property_value_by_name("wrapper_id")},replace_class:function(t){var e=this.get_property_by_name("class"),i=!!e&&e.get("value");if(e&&i){for(var o=t.split(" "),r=i,s=0;s<o.length;s++){var a=o[s].replace(/-?\d+/,"-?\\d+"),l=new RegExp(a);r.match(l)?r=r.replace(l,o[s]):r+=" "+o[s]}return e.set("value",r)}return e||this.get("properties").add(new n({name:"class",value:t})),!1},add_class:function(t){var e=new RegExp(t),i=this.get_property_by_name("class"),o=!!i&&i.get("value");return i&&!o.match(e)?i.set("value",o+" "+t):(i||this.get("properties").add(new n({name:"class",value:t})),!1)},remove_class:function(t){var e=new RegExp(t),i=this.get_property_by_name("class"),n=!!i&&i.get("value");return!(!i||!n.match(e))&&i.set("value",n.replace(e,""))},is_visible:function(){return this.get_property_value_by_name("visibility")},get_breakpoint_property_value:function(t,e,i,n){if(n=n?n:Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i="undefined"!=typeof i&&i,!n||n.default)return this.get_property_value_by_name(t);var o=this.get_property_value_by_name("breakpoint");return _.isObject(o)&&_.isObject(o[n.id])&&t in o[n.id]?o[n.id][t]:e?this.get_property_value_by_name(t):i},set_breakpoint_property:function(t,e,i,n){if(n=n?n:Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),!n||n.default)this.set_property(t,e,i);else{var o=Upfront.Util.clone(this.get_property_value_by_name("breakpoint")||{});_.isObject(o[n.id])||(o[n.id]={}),o[n.id][t]=e,o.current_property=t,this.set_property("breakpoint",o,i)}},add_to:function(t,e,i){i=_.isObject(i)?i:{};var n=this,o=[],r=!1;t.each(function(t,i){i==e&&(o.push(n),r=!0),o.push(t)}),r?(t.reset(o,{silent:!0}),t.trigger("add",this,t,_.extend(i,{index:e}))):t.add(this,_.extend(i,{index:e}))}}),s=r.extend({defaults:function(){return{name:"",objects:new a,wrappers:new g,properties:new o}},initialize:function(){var t=arguments;t&&t[0]&&t[0].objects?(t[0].objects=t[0].objects instanceof a?t[0].objects:new a(t[0].objects),this.set("objects",t[0].objects)):this.set("objects",new a([])),t&&t[0]&&t[0].wrappers?(t[0].wrappers=t[0].wrappers instanceof g?t[0].wrappers:new g(t[0].wrappers),this.set("wrappers",t[0].wrappers)):this.set("wrappers",new g([])),t&&t[0]&&t[0].properties?(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)):this.set("properties",new o([])),this.init&&this.init()}}),a=e.Collection.extend({model:function(t,e){var i=t.properties?_(t.properties).where({name:"type"}):t.get("properties").where({name:"type"}),n=i.length?i[0].value:"";return Upfront.Models[n]?new Upfront.Models[n](t,e):new r(t,e)},get_by_element_id:function(t){var e=!1;return this.each(function(i){i.get_element_id()==t&&(e=i)}),e}}),p=r.extend({defaults:{name:"",objects:new a,properties:new o},initialize:function(){var t=arguments;t&&t[0]&&t[0].objects?(t[0].objects=t[0].objects instanceof a?t[0].objects:new a(t[0].objects),this.set("objects",t[0].objects)):this.set("objects",new a([])),t&&t[0]&&t[0].properties?(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)):this.set("properties",new o([])),this.init&&this.init()}}),d=r.extend({defaults:function(){return{name:"",modules:new c,wrappers:new g,properties:new o}},initialize:function(){var t=arguments;t&&t[0]&&t[0].modules?(t[0].modules=t[0].modules instanceof c?t[0].modules:new c(t[0].modules),this.set("modules",t[0].modules)):this.set("modules",new c([])),t&&t[0]&&t[0].wrappers?(t[0].wrappers=t[0].wrappers instanceof g?t[0].wrappers:new g(t[0].wrappers),this.set("wrappers",t[0].wrappers)):this.set("wrappers",new g([])),t&&t[0]&&t[0].properties?(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)):this.set("properties",new o([])),this.init_property("has_settings",1),this.init_property("type","ModuleGroup"),this.init&&this.init()}}),c=e.Collection.extend({model:function(t,e){return t.modules?new d(t,e):new p(t,e)},get_by_element_id:function(t){var e=!1;return this.each(function(i){i.get_element_id()==t&&(e=i)}),e}}),u=r.extend({defaults:function(){return{name:"",properties:new o,wrappers:new g,modules:new c}},initialize:function(){var t=arguments;t&&t[0]&&t[0].modules?(t[0].modules=t[0].modules instanceof c?t[0].modules:new c(t[0].modules),this.set("modules",t[0].modules)):this.set("modules",new c([])),t&&t[0]&&t[0].wrappers?(t[0].wrappers=t[0].wrappers instanceof g?t[0].wrappers:new g(t[0].wrappers),this.set("wrappers",t[0].wrappers)):this.set("wrappers",new g([])),t&&t[0]&&t[0].properties?(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)):this.set("properties",new o([]))},is_main:function(){var t=this.get("container"),e=this.get("name");return!t||t==e},get_sub_regions:function(){if(!this.collection)return!1;var t=this.collection,e=(t.indexOf(this),t.size()-1,this.get("container")||this.get("name")),i=t.filter(function(t){return t.get("container")==e||t.get("name")==e}),n=[],o={fixed:[],lightbox:[],top:!1,left:!1,right:!1,bottom:!1};if(i.length>1&&_.each(i,function(t,e){var i=t.get("sub");"fixed"==i?o.fixed.push(t):"lightbox"==i?o.lightbox.push(t):i&&i.match(/^(top|left|bottom|right)$/)?o[i]=t:n.push(t)}),n.length>1){var r=_.indexOf(n,this);0===r?o.right=n[1]:1===r&&(o.left=n[0],o.right=n.length>2&&n[2])}return o},get_sub_region:function(t){return this.get_sub_regions()[t]},has_sub_region:function(){return _.find(this.get_sub_regions(),function(t){return t!==!1})},get_side_region:function(t){return this.get_sub_region(t?"right":"left")},has_side_region:function(){var t=this.get_sub_regions();return t.left||t.right}}),h=e.Collection.extend({model:u,get_by_name:function(t){t=t.toLowerCase();var e=!1;return this.each(function(i){i.get("name").toLowerCase()==t&&(e=i)}),e},at_container:function(t){var e=0;return this.find(function(i){if(i.is_main()){if(e==t)return!0;e++}return!1})},index_container:function(t,e){e=_.isArray(e)?e:[e];var i=this.filter(function(t){return t.is_main()&&!_.contains(e,t.get("name"))}),n=i.indexOf(t);return n},total_container:function(t){t=_.isArray(t)?t:[t];var e=this.filter(function(e){return e.is_main()&&!_.contains(t,e.get("name"))});return e.length},get_new_title:function(t,e){var i=(t+e).replace(/[^A-Za-z0-9\s_-]/g,""),n=i.toLowerCase().replace(/\s/g,"-");return this.get_by_name(n)?this.get_new_title(t,e+1):{title:i,name:n}}}),f=r.extend({defaults:{name:"",properties:new o},initialize:function(){var t=arguments;t&&t[0]&&t[0].properties?(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)):this.set("properties",new o([]))}}),g=e.Collection.extend({model:f,get_by_wrapper_id:function(t){var e=!1;return this.each(function(i){i.get_wrapper_id()==t&&(e=i)}),e}}),m=r.extend({defaults:{name:"",properties:new o,regions:new h,wrappers:new g},initialize:function(){var t=arguments;t&&t[0]&&t[0].regions&&(t[0].regions=t[0].regions instanceof h?t[0].regions:new h(t[0].regions),this.set("regions",t[0].regions)),t&&t[0]&&t[0].properties&&(t[0].properties=t[0].properties instanceof o?t[0].properties:new o(t[0].properties),this.set("properties",t[0].properties)),t&&t[0]&&t[0].wrappers&&(t[0].wrappers=t[0].wrappers instanceof g?t[0].wrappers:new g(t[0].wrappers),this.set("wrappers",t[0].wrappers))},get_current_state:function(){return Upfront.PreviewUpdate.get_revision()},has_undo_states:function(){return!!Upfront.Util.Transient.length("undo")},has_redo_states:function(){return!!Upfront.Util.Transient.length("redo")},store_undo_state:function(){var t=this.get_current_state(),e=Upfront.Util.Transient.get_all();return!(e.indexOf(t)>=0)&&(Upfront.Util.Transient.push("undo",t),void Upfront.Events.trigger("upfront:undo:state_stored"))},restore_undo_state:function(){return!!this.has_undo_states()&&this.restore_state_from_stack("undo")},restore_redo_state:function(){return!!this.has_redo_states()&&this.restore_state_from_stack("redo")},restore_state_from_stack:function(e){var i="undo"==e?"redo":"undo",n=Upfront.Util.Transient.pop(e);if(!n)return Upfront.Util.log("Invalid "+n+" state"),!1;Upfront.Util.Transient.push(i,this.get_current_state());var o=this,r=new t.Deferred;return Upfront.Util.post({action:"upfront_get_revision",revision:n}).done(function(t){"revision"in t.data&&(o.get("regions").reset(Upfront.Util.model_to_json(t.data.revision.regions)),r.resolve())}),r.promise()}}),v=e.Model.extend({initialize:function(){var t=arguments,i=t[0]||{};this.taxonomy=i.taxonomy?new e.Model(i.taxonomy):e.Model({}),this.all_terms=i.all_terms?new e.Collection(i.all_terms):new e.Collection([]),this.post_terms=i.post_terms?new e.Collection(i.post_terms):new e.Collection([])}}),b=e.Model.extend({action:"upfront-wp-model",fetchAttributes:[],saveAttributes:[],fetch:function(t){var e=this;return postdata={action:"fetch_"+this.modelName,id:this.id},_.each(this.fetchAttributes,function(t){postdata[t]=e[t]}),postdata=_.extend(postdata,t),this.post(postdata).done(function(t){e.set(t.data)})},save:function(){var t=this,e=this.toJSON();return _.each(this.saveAttributes,function(i){e[i]=t[i]}),e.action="save_"+this.modelName,this.post(e).done(function(e){t.changed={}})},post:function(t){return t=_.isObject(t)?_.clone(t):{},t.model_action=t.action,t.action=this.action,Upfront.Util.post(t)},get:function(t){var e=this.attributes[t],i=["post_date","post_date_gmt","post_modified","post_modified_gmt"];if(_.indexOf(i,t)!==-1){var n=(new Date).getTimezoneOffset(),o=n/60,r=o>0?"-":"+",s=parseInt(Math.abs(o),10),a=parseInt(60*(Math.abs(o)-s),10),l=e.replace(/ /,"T");s=s>=10?""+s:"0"+s,a=a>=10?""+a:"0"+a,l&&s.length&&a.length&&(l+=r+s+a);var p=l.split(/[^0-9]/);return new Date(p[0],p[1]-1,p[2],p[3],p[4],p[5])}return this.attributes[t]},set:function(t,i,n){var o=i,r={};if(_.isObject(t)){for(var s in t){var a=t[s];i instanceof Date?r[s]=Upfront.Util.format_date(a,!0,!0).replace(/\//g,"-"):r[s]=a}e.Model.prototype.set.call(this,r,n)}else i instanceof Date&&(o=Upfront.Util.format_date(i,!0,!0).replace(/\//g,"-")),e.Model.prototype.set.call(this,t,o,n);return this}}),y=e.Collection.extend({action:"upfront-wp-model",fetchAttributes:[],saveAttributes:[],changedModels:[],addedModels:[],removedModels:[],isNew:!0,parentAttribute:!1,childrenAttribute:!1,orphans:{},orderby:!1,order:"desc",pagination:{pages:1,pageSize:10,currentPage:1,totalElements:0,loaded:{}},lastFetchOptions:{},fetch:function(t){var e=this,i={action:"fetch_"+this.collectionName,id:this.id};return this.orderby&&(i.orderby=this.orderby,i.order=this.order),_.each(this.fetchAttributes,function(t){i[t]=e[t]}),i=this.checkPostFlush(_.extend(i,t)),this.changedModels=[],this.addedModels=[],this.removedModels=[],this.off("change",this.updateChanged,this),this.on("change",this.updateChanged,this),this.off("add",this.updateAdded,this),this.on("add",this.updateAdded,this),this.off("remove",this.updateRemoved,this),this.on("remove",this.updateRemoved,this),this.isNew=!1,this.post(i).done(function(t){if(t.data.pagination){var n=t.data.pagination,o=[];i.flush||e.pagination.totalElements!=n.total?(e.pagination={totalElements:n.total,pageSize:n.page_size,pages:Math.ceil(n.total/n.page_size),currentPage:n.page,loaded:i.flush?{}:e.pagination.loaded},e.pagination.loaded[n.page]=!0,_.each(t.data.results,function(t){var i=new e.model(t);i.belongsToPage=n.page,o.push(i)}),e.reset(o)):(e.pagination.currentPage=n.page,e.pagination.loaded[n.page]=!0,_.each(t.data.results,function(t){var i=new e.model(t);i.belongsToPage=n.page,e.add(i,{silent:!0,merge:!0})}),e.trigger("reset",e))}else e.reset(t.data.results)})},post:function(t){return t=_.isObject(t)?_.clone(t):{},t.model_action=t.action,t.action=this.action,Upfront.Util.post(t)},save:function(){var t=this,e={all:this.toJSON(),added:[],changed:[],removed:[],action:"save_"+this.collectionName};return this.isNew?e.added=e.all:this.each(function(i){t.addedModels.indexOf(i.id)!=-1&&e.added.push(i.toJSON()),t.changedModels.indexOf(i.id)!=-1&&e.changed.push(i.toJSON()),t.removedModels.indexOf(i.id)!=-1&&e.removed.push(i.toJSON())}),this.isNew=!1,_.each(this.saveAttributes,function(i){e[i]=t[i]}),this.post(e).done(function(e){t.reset(e.data),t.addedModels=[],t.changedModels=[],t.removedModels=[]})},updateChanged:function(t){var e=t.id,i=_.indexOf(this.addedModels,e);i!=-1?this.addedModels[i]=e:_.contains(this.changedModels,e)||this.changedModels.push(e)},updateAdded:function(t){var e=t.id,i=_.indexOf(this.removedModels,e);i!=-1?(this.removedModels.splice(i,1),this.changedModels.push(e)):_.contains(this.addedModels,e)||this.addedModels.push(e)},updateRemoved:function(t){var e=t.id,i=_.indexOf(this.addedModels,e),n=_.indexOf(this.changedModels,e);i!=-1?this.addedModels.splice(i,1):_.contains(this.removedModels,e)||this.removedModels.push(e),n!=-1&&this.changedModels.splice(n,1)},add:function(t,i){if(!this.parentAttribute||!this.childrenAttribute)return e.Collection.prototype.add.call(this,t,i);var n=this;if(!_.isArray(t)){var o=0,r=t;if(this.model&&r instanceof this.model)o=r.get(this.parentAttribute);else{if(!_.isObject(r))return e.Collection.prototype.add.call(this,r,i);o=r[this.parentAttribute],this.model&&(r=new this.model(t))}if(this.orphans[r.id]?(r[this.childrenAttribute]?r[this.childrenAttribute].add(this.orphans[r.id],i):r[this.childrenAttribute]=new this.constructor(this.orphans[r.id],i),delete this.orphans[r.id]):r[this.childrenAttribute]||(r[this.childrenAttribute]=new this.constructor([],i)),o){var s=this.get(o);if(s)s[this.childrenAttribute].add(r,i);else{var a=this.orphans[o];a?a.push(r):this.orphans[o]=[r]}}return e.Collection.prototype.add.call(this,r,i)}_.each(t,function(t){n.add(t,i)})},remove:function(t,n){if(!this.parentAttribute||!this.childrenAttribute)return e.Collection.prototype.remove.call(this,t,n);var o=this;for(t=_.isArray(t)?t.slice():[t],i=0,l=t.length;i<l;i++){var r=this.get(t[i]);r&&r[this.childrenAttribute].each(function(t){o.remove(t,n)})}return e.Collection.prototype.remove.call(this,t,n)},getPage:function(t){return this.filter(function(e){return e.belongsToPage==t})},fetchPage:function(t,e){if(e||(e={}),!e.flush&&this.pagination.loaded[t]){this.pagination.currentPage=t;var i=this.getPage(t),n=[];return _.each(i,function(t){n.push(t.toJSON())}),this.pagination.currentPage=t,jQuery.Deferred().resolve({results:n})}return this.fetch(_.extend({page:t,limit:this.pagination.pageSize},e))},reSort:function(t,e){var i="asc"==e?"asc":"desc";return this.orderby=t,this.order=i,this.fetch({page:0,sort:t,direction:i})},checkPostFlush:function(t){var e=this,i=!1,n=_.clone(t);return t.flush?(delete n.flush,this.lastFetchOptions=n,t):(_.each(t,function(t,n){["limit","page"].indexOf(n)==-1&&(i=i||e.lastFetchOptions[n]!=t)}),i?(e.lastFetchOptions=_.clone(t),n.flush=!0):n=_.extend(this.lastFetchOptions,n),n)}}),w=b.extend({modelName:"post",defaults:{ID:0,post_author:0,post_date:new Date,post_date_gmt:new Date,post_content:"",post_title:"",post_excerpt:"",post_status:"",comment_status:"",ping_status:"",post_password:"",post_name:"",to_ping:[],pinged:[],post_modified:new Date,post_modified_gmt:new Date,post_content_filtered:"",post_parent:0,guid:"",menu_order:0,post_type:"post",post_mime_type:"",comment_count:0,permalink:""},saveAttributes:["sticky"],author:!1,comments:!1,parent:!1,terms:!1,meta:!1,initialize:function(t,e){t&&(t.id&&this.set(this.idAttribute,t.id),t.author&&(this.author=new Upfront.Models.User(t.author)),t.meta&&(this.meta=new Upfront.Collections.MetaList(t.meta,{objectId:this.id,metaType:"post"})))},getVisibility:function(){return"private"==this.get("post_status")?"private":this.get("post_password")?"password":this.sticky?"sticky":"public"},setVisibility:function(t){this.sticky=0,"password"==t?this.set("post_status","publish"):(this.set("post_password",""),"private"==t?this.set("post_status","private"):"sticky"==t?this.sticky=1:"public"==t&&this.set("post_status","publish"))},fetch:function(t){var e=this;return b.prototype.fetch.call(this,t).done(function(t){t.data.author&&(e.author=new Upfront.Models.User(t.data.author)),t.data.meta&&(e.meta=new Upfront.Collections.MetaList(t.data.meta,{objectId:e.id,metaType:"post"})),e.sticky=t.data.sticky})},idAttribute:"ID",fetch_comments:function(t){return t=_.isObject(t)?t:{},this.comments=new Upfront.Collections.CommentList([],{postId:this.id}),this.comments.fetch()},fetch_parent:function(){if(!this.get("post_parent"))return!1;var t=this,e={action:"fetch_post",id:this.get("post_parent")};return this.post(e).done(function(e){t.parent=new w(e.data)})},fetch_author:function(){console.log("Fetch author not yet implemented.")},fetch_terms:function(t){return!!t&&this.post({taxonomy:t,post_id:this.get("ID"),action:"get_terms"})},fetch_meta:function(){return this.meta=new Upfront.Collection.MetaList([],{objectId:this.id,metaType:"post"}),this.meta.fetch()}}),k=b.extend({modelName:"template",defaults:{},initialize:function(t,e){}}),$=y.extend({collectionName:"post_list",model:w,parentAttribute:"post_parent",childrenAttribute:"children",postId:!1,postType:"post",withMeta:!1,withAuthor:!1,fetchAttributes:["postId","postType","withMeta","withAuthor"],initialize:function(t,e){e&&(e.postId&&(this.postId=e.postId),e.postType&&(this.postType=e.postType),e.withMeta&&(this.withMeta=e.withMeta),e.withAuthor&&(this.withAuthor=e.withAuthor))}});PageTemplateList=y.extend({collectionName:"page_templates",model:k,postId:!1,templateObject:!1,fetchAttributes:["postId"],initialize:function(t,e){e&&e.postId&&(this.postId=e.postId)},fetch:function(t){var e=this;return y.prototype.fetch.call(this,t).done(function(t){e.templateObject=t.results})}});var x=b.extend({modelName:"comment",defaults:{comment_ID:0,comment_post_id:0,comment_author:"",comment_author_email:"",comment_author_url:"",comment_author_IP:"0.0.0.0",comment_date:new Date,comment_date_gmt:new Date,comment_content:"",comment_karma:"",comment_agent:"",comment_type:"",comment_approved:"0",comment_parent:0,user_id:0},idAttribute:"comment_ID",initialize:function(t){t&&t.id&&this.set(this.idAttribute,t.id)},trash:function(t){return t?this.set("comment_approved","trash"):t||"trash"!=this.get("comment_approved")||this.set("comment_approved","0"),this},spam:function(t){return t?this.set("comment_approved","spam"):t||"spam"!=this.get("comment_approved")||this.set("comment_approved","0"),this},approve:function(t){return t?this.set("comment_approved","1"):t||"1"!=this.get("comment_approved")||this.set("comment_approved","0"),this},isTrash:function(){return"trash"==this.get("comment_approved")},isApproved:function(){return"1"==this.get("comment_approved")},isSpam:function(){return"spam"==this.get("comment_approved")}}),U=y.extend({model:x,collectionName:"comment_list",postId:!1,fetchAttributes:["postId","commentType"],parentAttribute:"comment_parent",childrenAttribute:"replies",commentType:"comment",initialize:function(t,e){e.postId&&(this.postId=e.postId)},save:function(){console.error("CommentList save: Use single comment save instead.")}}),E=e.Model.extend({defaults:{meta_key:"",meta_value:""},idAttribute:"meta_key"}),S=y.extend({model:E,collectionName:"meta_list",metaType:"post",objectId:0,fetchAttributes:["objectId","metaType"],saveAttributes:["objectId","metaType"],initialize:function(t,e){e.objectId&&(this.objectId=e.objectId),e.metaType&&(this.metaType=e.metaType)},getValue:function(t){var e=this.get(t);if(e)return e.get("meta_value")},setValue:function(t,e){var i=this.get(t);return i?(i.set("meta_value",e),this.changedModels.push(i.id)):(i=new E({meta_key:t,meta_value:e}),this.add(i)),i}}),C=b.extend({modelName:"term",defaults:{term_id:0,name:"",slug:"",term_group:"",term_taxonomy_id:0,taxonomy:"",description:"",parent:"",count:0},idAttribute:"term_id",taxonomy:!1,fetchAttributes:["taxonomy"],saveAttributes:["taxonomy"],initialize:function(t,e){t&&t.taxonomy&&(this.taxonomy=t.taxonomy)},save:function(t){var e=this;return b.prototype.save.call(this,t).done(function(t){e.set("term_id",t.data.term_id)})}}),T=y.extend({collectionName:"term_list",model:C,taxonomy:!1,taxonomyObject:!1,postId:!1,fetchAttributes:["taxonomy","postId"],saveAttributes:["taxonomy","postId"],parentAttribute:"parent",childrenAttribute:"children",initialize:function(t,e){e&&(e.taxonomy&&(this.taxonomy=e.taxonomy),e.postId&&(this.postId=e.postId))},fetch:function(t){var e=this;return y.prototype.fetch.call(this,t).done(function(t){e.taxonomyObject=t.data.taxonomy})}}),z=b.extend({modelName:"user",defaults:{ID:0,caps:[],cap_key:"",roles:[],allcaps:[],data:{}},idAttribute:"ID"}),I=e.Model.extend({initialize:function(){var t=arguments,i=t[0]||{};this.posts=i.posts?new e.Collection(i.posts):new e.Collection([]),this.pagination=i.pagination?new e.Model(i.pagination):new e.Model([])}}),P=I.extend({}),M=e.Model.extend({initialize:function(){var t=arguments,i=t[0]||{};this.comments=i.comments?new e.Collection(i.comments):new e.Collection([]),this.pagination=i.pagination?new e.Model(i.pagination):new e.Model([])}}),j=e.Model.extend({defaults:function(){return{vid:"",label:"Variant Label",group:{margin_left:0,margin_right:0,col:24,row:50,left:0,float:"none"},image:{order:0,col:24,top:0,left:0,row:40,clear:!0},caption:{show:1,order:1,col:24,top:0,left:0,row:10,clear:!0}}}}),O=e.Collection.extend({model:j});return{Models:{Property:n,ObjectModel:r,ObjectGroup:s,Module:p,ModuleGroup:d,Region:u,Wrapper:f,Layout:m,Taxonomy:v,Post:w,Posts:I,Pages:P,Comment:x,Comments:M,Meta:E,Term:C,User:z,ImageVariant:j},Collections:{Properties:o,Objects:a,Modules:c,Regions:h,Wrappers:g,CommentList:U,MetaList:S,PostList:$,TermList:T,ImageVariants:O,PageTemplateList:PageTemplateList}}})}(jQuery),define("scripts/upfront/render-queue",[],function(){var t=function(){var t=[],e=[];this.add=function(e){Upfront.Events.trigger("upfront:renderingqueue:add"),t.push(function(i){e(),Upfront.Events.trigger("upfront:renderingqueue:progress"),!i&&t.length>0&&(i=t.shift()),setTimeout(function(){i?t.length>0?i(t.shift()):i():Upfront.Events.trigger("upfront:renderingqueue:finished");
},0)})},this.addToEnd=function(t){Upfront.Events.trigger("upfront:renderingqueue:add"),e.push(function(i){t(),Upfront.Events.trigger("upfront:renderingqueue:progress"),setTimeout(function(){i&&(e.length>0?i(e.shift()):(i(),Upfront.Events.trigger("upfront:renderingqueue:done")))},0)})},this.start=function(){setTimeout(function(){Upfront.Events.trigger("upfront:renderingqueue:start"),t.length>1?t.shift()(t.shift()):t.length>0&&t.shift()()},500)},Upfront.Events.on("upfront:renderingqueue:finished",function(){e.length>1?e.shift()(e.shift()):e.length>0&&e.shift()()})},e=new t;return e}),define("scripts/upfront/render-queue-reporter",[],function(){var t=function(t,e,i){var n=0,o=0,r=0;Upfront.Events.on("upfront:renderingqueue:add",function(){n++}),t&&"function"==typeof t&&Upfront.Events.on("upfront:renderingqueue:start",t),Upfront.Events.on("upfront:renderingqueue:progress",function(){var t;o++,t=Math.floor(o/n*100),r=t>r?t:r,e&&"function"==typeof e&&e(r)}),Upfront.Events.on("upfront:renderingqueue:done",function(){n=0,o=0,r=0,i&&"function"==typeof i&&i()})};return t}),define("text",["module"],function(t){"use strict";var e,i,n=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,r=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,a=s&&location.protocol&&location.protocol.replace(/\:/,""),l=s&&location.hostname,p=s&&(location.port||void 0),d=[],c=t.config&&t.config()||{};return e={version:"2.0.3",strip:function(t){if(t){t=t.replace(o,"");var e=t.match(r);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:c.createXhr||function(){var t,e,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){i=n[e];try{t=new ActiveXObject(i)}catch(t){}if(t){n=[i];break}}return t},parseName:function(t){var e=!1,i=t.indexOf("."),n=t.substring(0,i),o=t.substring(i+1,t.length);return i=o.indexOf("!"),i!==-1&&(e=o.substring(i+1,o.length),e="strip"===e,o=o.substring(0,i)),{moduleName:n,ext:o,strip:e}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,i,n,o){var r,s,a,l=e.xdRegExp.exec(t);return!l||(r=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(r&&r!==i||s&&s.toLowerCase()!==n.toLowerCase()||(a||s)&&a!==o))},finishLoad:function(t,i,n,o){n=i?e.strip(n):n,c.isBuild&&(d[t]=n),o(n)},load:function(t,i,n,o){if(o.isBuild&&!o.inlineText)return void n();c.isBuild=o.isBuild;var r=e.parseName(t),d=r.moduleName+"."+r.ext,u=i.toUrl(d),h=c.useXhr||e.useXhr;!s||h(u,a,l,p)?e.get(u,function(i){e.finishLoad(t,r.strip,i,n)},function(t){n.error&&n.error(t)}):i([d],function(t){e.finishLoad(r.moduleName+"."+r.ext,r.strip,t,n)})},write:function(t,i,n,o){if(d.hasOwnProperty(i)){var r=e.jsEscape(d[i]);n.asModule(t+"!"+i,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,i,n,o,r){var s=e.parseName(i),a=s.moduleName+"."+s.ext,l=n.toUrl(s.moduleName+"."+s.ext)+".js";e.load(a,n,function(i){var n=function(t){return o(l,t)};n.asModule=function(t,e){return o.asModule(t,l,e)},e.write(t,a,n,r)},r)}},"node"===c.env||!c.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),e.get=function(t,e){var n=i.readFileSync(t,"utf8");0===n.indexOf("\ufeff")&&(n=n.substring(1)),e(n)}):"xhr"===c.env||!c.env&&e.createXhr()?e.get=function(t,i,n){var o=e.createXhr();o.open("GET",t,!0),c.onXhr&&c.onXhr(o,t),o.onreadystatechange=function(e){var r,s;4===o.readyState&&(r=o.status,r>399&&r<600?(s=new Error(t+" HTTP status: "+r),s.xhr=o,n(s)):i(o.responseText))},o.send(null)}:("rhino"===c.env||!c.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(e.get=function(t,e){var i,n,o="utf-8",r=new java.io.File(t),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);l=String(i.toString())}finally{a.close()}e(l)}),e}),define("text!upfront/templates/object.html",[],function(){return'<div class="upfront-editable_entity upfront-object {{properties.class}} {{properties.preset}}" id="{{properties.element_id}}" style="{[ if (height > 0){ ]}min-height: {{height}}px;{[ } ]} {[ if (hide == 1) { ]}display: none;{[ } ]}">\r\n\t<b class="upfront-entity_meta upfront-ui">\r\n\t\t<!-- {[ if (parseInt(properties.has_settings, 10)) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a> {[ } ]} -->\r\n        {{extra_buttons}}\r\n\t\t<!--<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>-->\r\n\t</b>\r\n\t{[ if (buttons){ ]}\r\n\t<b class="upfront-entity_meta upfront-ui upfront-entity_meta_extra">{{buttons}}</b>\r\n\t{[ } ]}\r\n\t<div class="upfront-object-content upfront-output-{{properties.id_slug}}">\r\n\t\t{{content}}\r\n\t</div>\r\n</div>\r\n'}),define("text!upfront/templates/object_group.html",[],function(){return'<div class="upfront-editable_entity upfront-object-group {{properties.class}} {{properties.preset}}" id="{{properties.element_id}}" {[ if (height > 0){ ]}style="min-height: {{height}}px;"{[ } ]}>\r\n\t<b class="upfront-entity_meta upfront-ui">\r\n\t\t<!-- {[ if (parseInt(properties.has_settings, 10)) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a> {[ } ]} -->\r\n        {{extra_buttons}}\r\n\t\t<!--<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>-->\r\n\t</b>\r\n\t{[ if (buttons){ ]}\r\n\t<b class="upfront-entity_meta upfront-ui upfront-entity_meta_extra">{{buttons}}</b>\r\n\t{[ } ]}\r\n\t<div class="upfront-object-group-default"></div>\r\n\t<div class="upfront-objects_container upfront-output-{{properties.id_slug}}"></div>\r\n</div>\r\n<div class="upfront-object-group-finish-edit upfront-ui"><i class="upfront-field-icon upfront-field-icon-tick"></i> {{Upfront.Settings.l10n.global.views.done}}</div>'}),define("text!upfront/templates/module.html",[],function(){return'<div class="upfront-editable_entity upfront-module {{parent_group_class}} {{properties.class}}" id="{{properties.element_id}}" style="{[ if (height > 0){ ]}min-height: {{height}}px;{[ } ]} {[ if (hide == 1) { ]}display: none;{[ } ]}" data-row="{{properties.row}}">\r\n\t<b class="upfront-entity_meta upfront-ui">\r\n\t\t{{name}} \r\n\t\t{[ if (parseInt(properties.has_settings, 10)) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a> {[ } ]}\r\n\t\t{[ if (!properties.sticky) { ]} <a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a> {[ } ]}\r\n\t\t<a href="#" class="upfront-icon-button upfront-icon-button-hide upfront-entity-hide_trigger" style="display:none;"></a> \r\n\t</b>\r\n\t<div class="upfront-objects_container"></div>\r\n</div>\r\n<div class="upfront-module-hidden-toggle upfront-ui" style="display:none;"><a class="upfront-entity-hide_trigger">{{Upfront.Settings.l10n.global.views.show_element}}</a></div>\r\n'}),define("text!upfront/templates/module_group.html",[],function(){return'<b class="upfront-entity_meta upfront-ui">\r\n\t<!--<a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a>-->\r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-hide upfront-entity-hide_trigger" style="display:none;"></a>\r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>\r\n</b>\r\n<div class="upfront-selected-border"></div>\r\n<div class="upfront-module-group-toggle-container upfront-module-group-toggle-edit-container">\r\n\t<div class="upfront-module-group-toggle upfront-module-group-ungroup">{{Upfront.Settings.l10n.global.views.ungroup}}</div><br />\r\n\t<div class="upfront-module-group-toggle upfront-module-group-edit">{{Upfront.Settings.l10n.global.views.edit_elements}}</div>\r\n</div>\r\n<div class="upfront-module-group-toggle-container upfront-module-group-toggle-reorder-container">\r\n\t<div class="upfront-module-group-toggle upfront-module-group-reorder">{{Upfront.Settings.l10n.global.views.reorder}}</div>\r\n</div>\r\n<div class="upfront-module-group-finish-edit upfront-ui"><i class="upfront-field-icon upfront-field-icon-tick"></i> {{Upfront.Settings.l10n.global.views.done}}</div>\r\n\r\n<div class="upfront-module-hidden-toggle upfront-ui" style="display:none;"><a class="upfront-entity-hide_trigger">{{Upfront.Settings.l10n.global.views.show_group}}</a></div>\r\n\r\n<div class="upfront-module-group-bg"></div>\r\n<div class="upfront-modules_container"></div>\r\n'}),define("text!upfront/templates/region_container.html",[],function(){return'<div class="upfront-region-container-bg">\r\n\t<div class="upfront-grid-layout {{size_class}}{{max_col}}">\r\n\t\t<div class="upfront-grid-layout-gutter">\r\n\t\t\t<div class="upfront-grid-layout-gutter-left"></div>\r\n\t\t\t<div class="upfront-grid-layout-gutter-right"></div>\r\n\t\t</div>\r\n\t</div>\r\n</div>'}),define("text!upfront/templates/region.html",[],function(){return'<b class="upfront-entity_meta upfront-ui">\r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>\r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-hide upfront-entity-hide_trigger" style="display:none;"></a> \r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-setting upfront-entity-settings_trigger"></a>\r\n</b>\r\n<div class="upfront-region-title">{{title}}</div>\r\n<div class="upfront-region-wrapper"><div class="upfront-modules_container"></div></div>\r\n<div class="upfront-region-hidden-toggle upfront-ui" style="display:none;"><a class="upfront-entity-hide_trigger">{{Upfront.Settings.l10n.global.views.show_region}}</a></div>'}),define("text!upfront/templates/wrapper.html",[],function(){return'<b class="upfront-wrapper-meta upfront-wrapper-meta-left upfront-ui upfront-resize-handle-wrapper upfront-resize-handle-wrapper-w ui-resizable-handle ui-resizable-w">\r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-add-spacer upfront-add-spacer" data-position="left" title="Add spacer"></a>\r\n</b>\r\n<b class="upfront-wrapper-meta upfront-wrapper-meta-right upfront-ui upfront-resize-handle-wrapper upfront-resize-handle-wrapper-e ui-resizable-handle ui-resizable-e">\r\n\t<a href="#" class="upfront-icon-button upfront-icon-button-add-spacer upfront-add-spacer" data-position="right" title="Add spacer"></a>\r\n</b>\r\n'}),define("text!upfront/templates/layout.html",[],function(){return'<section class="upfront-layout">\r\n\r\n</section>'}),define("text!upfront/templates/api_key_overlay_region.html",[],function(){return'<div id="upfront_map-api_key_overlay-wrapper" class="upfront-initial-overlay-wrapper upfront_map-api_key_region">\n\t<div id="upfront_map-api_key_overlay" class="uf_el_map_initial-overlay upfront-initial-overlay-wrapper">\n\t\t<div class="upfront-ui">\n\t\t\t<button type="button" class="upfront-field-icon upfront-icon-map-warning"></button>\n\t\t</div>\n\t\t<p id="upfront_map-api_key_overlay-instruction">\n\t\t{{Upfront.Settings.l10n.maps_element.api_key_empty_region}}\n\t\t</p>\n\t</div>\n</div>\n'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("views",["scripts/upfront/render-queue","scripts/upfront/render-queue-reporter","text!upfront/templates/object.html","text!upfront/templates/object_group.html","text!upfront/templates/module.html","text!upfront/templates/module_group.html","text!upfront/templates/region_container.html","text!upfront/templates/region.html","text!upfront/templates/wrapper.html","text!upfront/templates/layout.html","text!upfront/templates/api_key_overlay_region.html"],function(i,n){var o=["text!upfront/templates/object.html","text!upfront/templates/object_group.html","text!upfront/templates/module.html","text!upfront/templates/module_group.html","text!upfront/templates/region_container.html","text!upfront/templates/region.html","text!upfront/templates/wrapper.html","text!upfront/templates/layout.html","text!upfront/templates/api_key_overlay_region.html"],r=_.rest(arguments,2),s={};_(o).each(function(t,e){s[t.replace(/text!upfront\/templates\//,"").replace(/\.html/,"")]=r[e]});var a,l,p=_.clone(Backbone.Events),d={dispatcher:p},c={activate_condition:function(){return!1}},u={activate_condition:function(){var t=this.parent_module_view,e=!(!t||!t.model)&&t.model;return!e||!!e.get("name").length}},h={anchor:{is_target:!0,is_trigger:!1}},f=Backbone.View.extend(_.extend({},d,{initialize:function(t){this.options=t,this.listenTo(this.model,"change",this.render),this.init&&this.init(),this.listenTo(Upfront.Events,"upfront:paddings:top:updated",this.adjust_top_settings_panel_position)},_get_full_size_el:function(t,e,i){var n=t.width(),o=t.height();return this._get_full_size(n,o,e,i)},_get_full_size:function(t,e,i,n){if(n){if(Math.round(e/t*100)/100<i){var o=e/i;return[o,e,(t-o)/2,0]}var r=t*i;return[t,r,0,(e-r)/2]}if(Math.round(e/t*100)/100>i){var o=e/i;return[o,e,(t-o)/2,0]}var r=t*i;return[t,r,0,(e-r)/2]},update_background:function(){var e,i=this,n="undefined"!=typeof this.$bg?this.$bg:this.$el,o=this.model.get_breakpoint_property_value("background_type",!0),r=n.children(".upfront-region-bg-overlay");if("featured"!=o&&i.$el.children(".feature_image_selector").length>0&&i.$el.children(".feature_image_selector").remove(),r.data("uparallax")&&r.uparallax("destroy"),o&&"color"!=o){r.length?r.show():(r=t('<div class="upfront-region-bg-overlay" />'),n.append(r));var s=r.find(".upfront-region-bg-"+o);switch(s.length?s.show():(s=t('<div class="upfront-region-bg upfront-region-bg-'+o+'" />'),r.append(s)),r.find(".upfront-region-bg").not(s).hide(),n.css({backgroundColor:"",backgroundImage:"none",backgroundSize:"",backgroundRepeat:"",backgroundPosition:""}),o){case"image":this.update_background_image(s,r);break;case"featured":this.update_background_featured(s,r);break;case"map":this.update_background_map(s,r);break;case"slider":this.update_background_slider(s,r);break;case"video":e=this.model.get_breakpoint_property_value("background_style",!0),"service"===e?this.update_background_video(s,r):this.update_uploaded_background_video(s,r);break;case"uploaded_video":console.log("we have uploaded video yay"),this.update_uploaded_background_video(s,r)}}else this.update_background_color(),r.length&&r.hide();Upfront.Events.trigger("entity:background:update",this,this.model)},update_background_color:function(){var t="undefined"!=typeof this.$bg?this.$bg:this.$el,e=this.model.get_breakpoint_property_value("background_color",!0);this.remove_api_key_overlay(),e?t.css("background-color",e):t.css("background-color","")},_update_background_image_from_data:function(e,i,n){var o=this instanceof A,r=this.model.get_breakpoint_property_value("background_repeat",!0),s=this.model.get_breakpoint_property_value("background_position",!0),a=this.model.get_breakpoint_property_value("background_size",!0),l=this.model.get_breakpoint_property_value("background_style",!0);if(e.image){if(i.css("background-image","url('"+e.image+"')"),"parallax"==l&&n.uparallax({element:i,overflowTop:0,overflowBottom:0}),"full"==l){var a=this._get_full_size_el(o?t(window):i,e.ratio,!1);i.data("bg-position-y",a[3]),i.data("bg-position-x",a[2]),i.css({backgroundSize:a[0]+"px "+a[1]+"px",backgroundRepeat:"no-repeat",backgroundPosition:a[2]+"px "+a[3]+"px"})}else i.css({backgroundSize:a,backgroundRepeat:r,backgroundPosition:s});o&&i.css("background-attachment","fixed")}else i.css({backgroundImage:"none",backgroundSize:"",backgroundRepeat:"",backgroundPosition:"",backgroundAttachment:""})},update_background_image:function(t,e){var i=("undefined"!=typeof this.$bg?this.$bg:this.$el,this.model.get_breakpoint_property_value("background_image",!0)),n=parseFloat(this.model.get_breakpoint_property_value("background_image_ratio",!0));this.remove_api_key_overlay(),this.update_background_color(),this._update_background_image_from_data({image:i,ratio:n},t,e)},update_background_featured:function(i,n){var o=this,r="undefined"!=typeof this.$bg?this.$bg:this.$el,s=this.model.get_breakpoint_property_value("background_default",!0),a=this.model.get_breakpoint_property_value("featured_fallback_background_color",!0),l=this.model.get_breakpoint_property_value("background_type",!0),p=function(){"image"==s?o.update_background_image(i,n):o._update_background_image_from_data({image:!1,ratio:0},i,n)};this.remove_api_key_overlay(),r.addClass("no-featured_image"),this.update_background_color();var d=Upfront.data.posts[_upfront_post_data.post_id];if(o.$el.children(".feature_image_selector").length<1&&!1===Upfront.plugins.isForbiddenByPlugin("initialize featured image selector")){var c=t('<a href="#" class="feature_image_selector">Add Feature Image</a>');c.bind("click",function(){Upfront.Views.Editor.ImageSelector.open().done(function(e){var i={},n=0;_.each(e,function(t,e){i=t,n=e});var r={src:i.medium?i.medium[0]:i.full[0],srcFull:i.full[0],srcOriginal:i.full[0],fullSize:{width:i.full[1],height:i.full[2]},size:i.medium?{width:i.medium[1],height:i.medium[2]}:{width:i.full[1],height:i.full[2]},position:!1,rotation:0,id:n};t("<img>").attr("src",r.srcFull).load(function(){d.meta.setValue("_thumbnail_id",r.id),d.meta.setValue("_thumbnail_data",r),d.meta.save().done(function(){t("<img>").attr("src",r.srcOriginal).load(function(){o.update_background(),Upfront.Views.Editor.ImageSelector.close()})})})})}),Upfront.Application.user_can("EDIT")===!1?"undefined"!=typeof d&&parseInt(d.get("post_author"),10)===Upfront.data.currentUser.id&&Upfront.Application.user_can("EDIT_OWN")===!0&&o.$el.append(c):o.$el.append(c)}Upfront.Util.post({action:"this_post-get_thumbnail",post_id:_upfront_post_data.post_id}).done(function(d){if("undefined"!=typeof d.data.featured_image){""!==d.data.featured_image?o.$el.children(".feature_image_selector").addClass("change_feature_image").text(e.change_featured_image):("featured"==l&&"color"==s&&r.hasClass("no-featured_image")&&r.css("background-color",a),o.$el.children(".feature_image_selector").removeClass("change_feature_image").text(e.add_featured_image)),image=d.data.featured_image;var c=t("<img>").attr("src",d.data.featured_image);c.load(function(){ratio=parseFloat(Math.round(this.height/this.width*100)/100),r.data("bg-featured-image-ratio",ratio),r.removeClass("no-featured_image"),o._update_background_image_from_data({image:image,ratio:ratio},i,n)})}else p()}).fail(p())},postpone_map_init:function(e,i){var n=this;t(document).one("upfront-google_maps-loaded",function(){n.update_background_map(e,i)})},add_api_key_overlay:function(){this.$el.find("#upfront_map-api_key_overlay-wrapper")[0]||this.$el.find(".upfront-region-bg-overlay").append(_.template(s.api_key_overlay_region))},remove_api_key_overlay:function(){this.$el.find("#upfront_map-api_key_overlay-wrapper").remove()},update_background_map:function(t,e){(!(window._upfront_api_keys||{}).gmaps&&Upfront.Application.user_can_modify_layout()||"undefined"!=typeof google_maps_auth_error)&&this.add_api_key_overlay();try{if(!window.google.maps.Map)return this.postpone_map_init(t,e)}catch(i){return this.postpone_map_init(t,e)}var i=this,n=this.model.get_breakpoint_property_value("background_map_center",!0),o=this.model.get_breakpoint_property_value("background_map_zoom",!0),r=this.model.get_breakpoint_property_value("background_map_style",!0),s=this.model.get_breakpoint_property_value("background_map_controls",!0)||[],a=this.model.get_breakpoint_property_value("background_show_markers",!0),l=!!this.model.get_breakpoint_property_value("background_use_custom_map_code",!0)&&JSON.parse(this.model.get_breakpoint_property_value("map_styles",!0)),p={center:new google.maps.LatLng(n[0],n[1]),zoom:parseInt(o,10)||0,mapTypeId:google.maps.MapTypeId[r],panControl:s.indexOf("pan")>=0,zoomControl:s.indexOf("zoom")>=0,mapTypeControl:s.indexOf("map_type")>=0,scaleControl:s.indexOf("scale")>=0,streetViewControl:s.indexOf("street_view")>=0,overviewMapControl:s.indexOf("overview_map")>=0,scrollwheel:!1,styles:l};if(this.bg_map?(t.show(),this.bg_map.setOptions(p),l&&this.bg_map.setOptions({styles:l}),setTimeout(function(){i.bg_map.setCenter(p.center)},500)):(this.bg_map=new google.maps.Map(t.get(0),p),l&&this.bg_map.setOptions({styles:l})),a){new google.maps.Marker({position:p.center,draggable:!1,map:this.bg_map})}},update_background_slider:function(e,i){var n=this,o=this.model.get_breakpoint_property_value("background_slider_images",!0),r=this.model.get_breakpoint_property_value("background_slider_rotate",!0),s=this.model.get_breakpoint_property_value("background_slider_rotate_time",!0),a=this.model.get_breakpoint_property_value("background_slider_control",!0),l=this.model.get_breakpoint_property_value("background_slider_control_style",!0),p=this.model.get_breakpoint_property_value("background_slider_transition",!0);if(this.remove_api_key_overlay(),o){r?(e.attr("data-slider-auto",1),e.attr("data-slider-interval",1e3*s)):e.attr("data-slider-auto",0),"arrows"===l?(e.attr("data-control_num",0),e.attr("data-control_next_prev",1)):"dots"===l?(e.attr("data-control_num",1),e.attr("data-control_next_prev",0)):(e.attr("data-control_num",1),e.attr("data-control_next_prev",1)),e.attr("data-slider-show-control",a),e.attr("data-slider-effect",p);var d=Upfront.plugins.call("update-background-slider",{slide_images:o,typeEl:e,me:n});if(d.status&&"called"===d.status)return;this.slide_images!=o&&o.length>0?Upfront.Views.Editor.ImageEditor.getImageData(o).done(function(i){var r=i.data.images;_.each(o,function(i){var n=r[i],o=t('<div class="upfront-default-slider-item" />');n&&n.full&&o.append('<img src="'+n.full[0]+'" />'),e.append(o)}),n.slide_images=o,e.trigger("refresh")}):e.trigger("refresh"),0==o.length&&(e.find(".upfront-default-slider-wrap").html(""),e.trigger("refresh"))}},update_background_video:function(e,i){console.log("update_background_video");var n,o,r=this instanceof A,s="undefined"!=typeof this.$bg?this.$bg:this.$el,a=this.model.get_breakpoint_property_value("background_color",!0),l=this.model.get_breakpoint_property_value("background_video",!0),p=this.model.get_breakpoint_property_value("background_video_embed",!0),d=this.model.get_breakpoint_property_value("background_video_width",!0),c=this.model.get_breakpoint_property_value("background_video_height",!0),u=this.model.get_breakpoint_property_value("background_video_style",!0)||"crop";if(this.remove_api_key_overlay(),"inside"==u&&a?s.css("background-color",a):s.css("background-color",""),r&&i.css("position","fixed"),l&&p&&(this._prev_video&&this._prev_video!=l||!this._prev_video)){if(n=c/d,o=t(p),o.css("position","absolute").appendTo(e),"crop"==u||"inside"==u){var h=this._get_full_size_el(r?t(window):e,n,"inside"==u);o.css({width:h[0],height:h[1],left:h[2],top:h[3]})}else"full"==u&&o.css({width:r?t(window).width():e.width(),height:r?t(window).height():e.height(),left:0,top:0});this._prev_video=l}else l&&p?this.refresh_background():this.remove_background()},update_uploaded_background_video:function(e,i){console.log("update_uploaded_background_video");var n,o,r=this instanceof A,s="undefined"!=typeof this.$bg?this.$bg:this.$el,a=this.model.get_breakpoint_property_value("background_color",!0),l=this.model.get_breakpoint_property_value("uploaded_background_video",!0),p=this.model.get_breakpoint_property_value("uploaded_background_video_embed",!0),d=this.model.get_breakpoint_property_value("background_video_width",!0),c=this.model.get_breakpoint_property_value("background_video_height",!0),u=this.model.get_breakpoint_property_value("background_video_style",!0)||"crop";if("inside"==u&&a?s.css("background-color",a):s.css("background-color",""),r&&i.css("position","fixed"),l&&p&&(this._prev_video&&this._prev_video!=l||!this._prev_video)){if(n=c/d,o=t(p),o.css("position","absolute").appendTo(e),"crop"==u||"inside"==u){var h=this._get_full_size_el(r?t(window):e,n,"inside"==u);o.css({width:h[0],height:h[1],left:h[2],top:h[3]})}else"full"==u&&o.css({width:r?t(window).width():e.width(),height:r?t(window).height():e.height(),left:0,top:0});this._prev_video=l}else l&&p?this.refresh_background():this.remove_background()},refresh_background:function(){var t="undefined"!=typeof this.$bg?this.$bg:this.$el,e=this.model.get_breakpoint_property_value("background_type",!0),i=t.children(".upfront-region-bg-overlay"),n=i.find(".upfront-region-bg-"+e);switch(e){case"image":this.refresh_background_image(n,i);break;case"featured":this.refresh_background_featured(n,i);break;case"map":this.refresh_background_map(n,i);break;case"slider":this.refresh_background_slider(n,i);break;case"video":this.refresh_background_video(n,i)}},_refresh_background_image_from_data:function(t,e,i){var n=this.model.get_breakpoint_property_value("background_style",!0);if("parallax"==n&&i.data("uparallax")&&(i.uparallax("refresh"),setTimeout(function(){i.data("uparallax")&&i.uparallax("refresh")},2e3)),"full"==n){var o=this._get_full_size_el(e,t.ratio,!1);e.data("bg-position-y",o[3]),e.data("bg-position-x",o[2]),e.css({backgroundSize:o[0]+"px "+o[1]+"px",backgroundRepeat:"no-repeat",backgroundPosition:o[2]+"px "+o[3]+"px"})}},refresh_background_image:function(t,e){var i=this.model.get_breakpoint_property_value("background_image_ratio",!0);this._refresh_background_image_from_data({ratio:i},t,e)},refresh_background_featured:function(t,e){var i="undefined"!=typeof this.$bg?this.$bg:this.$el,n=this.model.get_breakpoint_property_value("background_default",!0),o=t.data("bg-featured-image-ratio");i.hasClass("no-featured_image")?"image"==n&&this.refresh_background_image(t,e):this._refresh_background_image_from_data({ratio:o},t,e)},refresh_background_map:function(t,e){this.bg_map&&google.maps.event.trigger(this.bg_map,"resize")},refresh_background_video:function(t,e){var i,n=this.model.get_breakpoint_property_value("background_video",!0),o=this.model.get_breakpoint_property_value("background_video_embed",!0),r=this.model.get_breakpoint_property_value("background_video_width",!0),s=this.model.get_breakpoint_property_value("background_video_height",!0),a=this.model.get_breakpoint_property_value("background_video_style",!0)||"crop",l=t.children("iframe");if(n&&o)if(i=s/r,"crop"==a||"inside"==a){var p=this._get_full_size_el(t,i,"inside"==a);l.css({width:p[0],height:p[1],left:p[2],top:p[3]})}else"full"==a&&l.css({width:t.width(),height:t.height(),left:0,top:0})},refresh_background_slider:function(t,e){t.trigger("refresh")},remove_background:function(){var t="undefined"!=typeof this.$bg?this.$bg:this.$el,e=this.$el.find(".upfront-region-bg-overlay");if(e.length){if(e.parent().hasClass("upfront-module-group-bg"))return;e.hide()}t.css({backgroundColor:"",backgroundImage:"none",backgroundSize:"",backgroundRepeat:"",backgroundPosition:""})},on_window_resize:function(t){if(t.target==window&&t.data.model){var e=t.data;e.refresh_background()}},adjust_top_settings_panel_position:function(e,i){var n,o,r=e&&e instanceof Backbone.Model?e:this.model,s=i?i:this,a=i&&i.$control_el?i.$control_el:this.$control_el,l=t(Upfront.Settings.LayoutEditor.Selectors.main);if(s&&a&&!a.$el){n=l.offset(),o=s.$el.offset();var p=a.find(".upfront-inline-panel-top").first();p.find(".upfront-control-dialog-open").length||(parseInt(r.get_breakpoint_property_value("top_padding_num",!1,0),10)<30&&o.top-n.top>=30?p.css("top","-30px"):p.css("top","0px"))}}})),g=f.extend({resort_bound_collection:function(){this.$el.trigger("resort",[this])},get_settings:function(){return""},on_click:function(e){return""===t("#element-settings-sidebar").html()&&""===t("#settings").html()&&void(e&&e.shiftKey||(this.activate(),Upfront.Events.trigger("entity:contextmenu:deactivate",this)))},deactivate:function(){this.$el.removeClass("upfront-active_entity"),this.check_deactivated(),this.trigger("upfront:entity:deactivate",this)},activate:function(){var t=this,e=Upfront.data.currentEntity;if(this.activate_condition&&!this.activate_condition())return!1;if(e&&e==this)return!1;if(this instanceof x){if(e&&e!=this){if(Upfront.data.currentEntity.$el.closest(t.$el).length)return;Upfront.data.currentEntity.trigger("deactivated")}Upfront.data.currentEntity=this,this.trigger("upfront:entity:activate",this),this.trigger("activated",this),this.listenToOnce(this,"deactivated",this.deactivate),this.$el.addClass("upfront-active_entity"),this.adjust_top_settings_panel_position()}},on_meta_click:function(){},on_delete_click:function(){if(this.$el.closest(".upfront-region-container").removeClass("upfront-region-module-activated"),this.$el.trigger("upfront:entity:remove",[this]),this.group_view){var t=this.group_view.$el.find(".upfront-editable_entities_container .upfront-module-view");0==t.length&&this.group_view.on_ungroup()}return Upfront.Events.trigger("entity:layout:change"),!1},on_context_menu:function(e){return t(e.target).closest(".redactor-editor").length>0?void e.stopPropagation():void(Upfront.Settings.Application.no_context_menu||(e.stopPropagation(),t(e.target).closest(".redactor_box").length>0||(e.preventDefault(),this.event=e,Upfront.Events.trigger("entity:contextmenu:activate",this))))},on_settings_click:function(t){"undefined"!=typeof t&&t.preventDefault(),Upfront.Events.trigger("entity:settings:activate",this)},on_hide_click:function(t){t.preventDefault();var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(i[e.id])||(i[e.id]={}),1==i[e.id].hide?i[e.id].hide=0:i[e.id].hide=1,this.model.set_property("breakpoint",i)},check_deactivated:function(){Upfront.data.currentEntity==this&&(Upfront.data.currentEntity=!1)},create_size_hint:function(e){e=e?e:this.$el.find(".upfront-editable_entity:first");var i=this;e.children(".upfront-entity-size-hint").length||(this.$size_hint=t('<div class="upfront-entity-size-hint upfront-ui"></div>'),e.append(this.$size_hint)),setTimeout(function(){i.update_size_hint()},500)},update_size_hint:function(t,e){if(this.$size_hint){var i=Upfront.Settings.LayoutEditor.Grid.column_padding,n=parseInt(this.model.get_breakpoint_property_value("left_padding_num")||i,10)+parseInt(this.model.get_breakpoint_property_value("right_padding_num")||i,10),t=(parseInt(this.model.get_breakpoint_property_value("top_padding_num")||i,10)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||i,10),t?t-n:this.$el.width()-n),e=e?e:this.$el.outerHeight(),o="<b>w:</b>"+t+"px <b>h:</b>"+e+"px";this.$el.find(".upfront-entity-size-hint").html(o)}},apply_breakpoint_position:function(t,e,i){var n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=Upfront.Settings.LayoutEditor.Grid;if(n){var i=_.isArray(i)?i:[],r=this.model.get_property_value_by_name("breakpoint"),s=this.model.get_property_value_by_name("row"),a=this.model.get_property_value_by_name("default_hide"),l=this.model.get_property_value_by_name("toggle_hide"),p=this.model.get_property_value_by_name("hide"),d=r[n.id],c=this.$el.parent(".upfront-wrapper"),u=c.length>0&&c.children(":not(.upfront-wrapper-meta)").length>1,h=d?d.left+d.col:0;u&&(h=Upfront.Util.width_to_col(c.width())),_.contains(i,"hide")||(d&&"hide"in d?p=d.hide:n.default&&p!==!1||(p=a),p?t.hide():t.show(),e&&e.length>0&&(l!==!1&&0==l||!p?e.hide():p&&e.show())),_.contains(i,"col")||(d&&"number"==typeof d.col?(t.css("width",d.col/h*100+"%"),t.data("breakpoint_col",d.col),t.data("current_col",d.col)):n.default?(t.css("width",""),t.removeData("breakpoint_col"),
t.data("current_col",t.data("default_col"))):(h=Upfront.Util.width_to_col(c.width()),t.css("width","100%"),t.data("breakpoint_col",h),t.data("current_col",h))),_.contains(i,"left")||(d&&"number"==typeof d.left?(t.css("margin-left",d.left/h*100+"%"),t.data("breakpoint_left",d.left)):(t.css("margin-left",""),t.removeData("breakpoint_left"))),_.contains(i,"top")||(d&&"number"==typeof d.top?(t.css("margin-top",d.top*o.baseline+"px"),t.data("breakpoint_top",d.top)):(t.css("margin-top",""),t.removeData("breakpoint_top"))),_.contains(i,"row")||(d&&"number"==typeof d.row?(t.css("min-height",d.row*o.baseline+"px"),t.data("breakpoint_row",d.row)):(t.css("min-height",s*o.baseline+"px"),t.removeData("breakpoint_row"))),_.contains(i,"order")||(d&&"number"==typeof d.order?(this.$el.css("order",d.order),t.data("breakpoint_order",d.order)):(this.$el.css("order",""),t.removeData("breakpoint_order")))}},apply_paddings:function(t){var e=this.model.get_breakpoint_property_value("top_padding_use",!0),i=this.model.get_breakpoint_property_value("bottom_padding_use",!0),n=this.model.get_breakpoint_property_value("left_padding_use",!0),o=this.model.get_breakpoint_property_value("right_padding_use",!0),r=this.model.get_breakpoint_property_value("top_padding_num",!0),s=this.model.get_breakpoint_property_value("bottom_padding_num",!0),a=this.model.get_breakpoint_property_value("left_padding_num",!0),l=this.model.get_breakpoint_property_value("right_padding_num",!0);t.css({paddingTop:e&&r!==!1?r+"px":"",paddingBottom:i&&s!==!1?s+"px":"",paddingLeft:n&&a!==!1?a+"px":"",paddingRight:o&&l!==!1?l+"px":""})},show_top_padding_hint:function(e,i){var n=this,i=!_.isUndefined(i)&&!1!==i&&i instanceof jQuery?i:this.$el.parents(".upfront-module"),o=i.find(".upfront-entity-top-padding-hint");return this.top_padding_hint_flag?(o.length||(o=t('<div class="upfront-ui upfront-entity-padding-hint upfront-entity-top-padding-hint"></div>').appendTo(i)),o.css({height:e+"px",opacity:1}),clearTimeout(this.top_padding_hint_timer),void(this.top_padding_hint_timer=setTimeout(function(){n.hide_top_padding_hint(i)},1e3))):void(this.top_padding_hint_flag=!0)},hide_top_padding_hint:function(t){var t=_.isUndefined(t)||!1===t?this.$el.parents(".upfront-module"):t;this.padding_hint_locked||t.find(".upfront-entity-top-padding-hint").css({opacity:0})},show_bottom_padding_hint:function(e,i){var n=this,i=_.isUndefined(i)||!1===i?this.$el.parents(".upfront-module"):i,o=i.find(".upfront-entity-bottom-padding-hint");return this.bottom_padding_hint_flag?(o.length||(o=t('<div class="upfront-ui upfront-entity-padding-hint upfront-entity-bottom-padding-hint"></div>').appendTo(i)),o.css({height:e+"px",opacity:1}),clearTimeout(this.bottom_padding_hint_timer),void(this.bottom_padding_hint_timer=setTimeout(function(){n.hide_bottom_padding_hint(i)},1e3))):void(this.bottom_padding_hint_flag=!0)},hide_bottom_padding_hint:function(t){var t=_.isUndefined(t)||!1===t?this.$el.parents(".upfront-module"):t;this.padding_hint_locked||t.find(".upfront-entity-bottom-padding-hint").css({opacity:0})},toggleControls:function(){Upfront.Application.user_can_modify_layout()||(this.$control_el&&0!==this.$control_el.length||(this.$control_el=this.$el),this.$control_el.find(".upfront-element-controls").remove())},updateControls:function(){var t='<div class="upfront-element-controls upfront-ui"></div>';this.paddingControl&&"undefined"!=typeof this.paddingControl.isOpen&&this.paddingControl.isOpen||(this.controls||(this.controls=this.createControls()),this.controls!==!1&&(this.controls.render(),this.$control_el&&0!==this.$control_el.length||(this.$control_el=this.$el),0===this.$control_el.find(">.upfront-element-controls").length&&(this.$control_el.append(t),this.$control_el.find(">.upfront-element-controls").html("").append(this.controls.$el)),this.updateAdvancedPadding(),this.controls.delegateEvents()))},updateAdvancedPadding:function(){var e=this;if(e.model.set_breakpoint_property("use_padding","yes",!0),e.$control_el){var i=e.$control_el.find(".upfront-element-controls .upfront-field-advanced-padding");i.length>0&&(e.$el.hasClass("upfront-module-group")||i.on("click",function(){void 0!==e.paddingControl&&e.paddingControl.close(),0==t("#element-settings-sidebar #settings").length&&e.on_settings_click(),setTimeout(function(){var e=t("#element-settings-sidebar .advanced-settings");e.length>0&&!e.hasClass("uf-settings-panel--expanded")&&e.toggleClass("uf-settings-panel--expanded").find(".uf-settings-panel__body").toggle()},500)}))}},createControls:function(){if(!Upfront.Application.user_can_modify_layout())return!1;var t=new Upfront.Views.Editor.InlinePanels.Panel;return t.items=this.getControlItems(),t},createControl:function(t,e,i){var n=this,o=new Upfront.Views.Editor.InlinePanels.Control;return o.icon=t,o.tooltip=e,i&&this.listenTo(o,"click",function(t){n[i](t)}),o},createPaddingControl:function(){return this.paddingControl=new Upfront.Views.Editor.InlinePanels.PaddingControl({model:this.model}),this.paddingControl.icon="padding",this.paddingControl.tooltip=e.padding_settings,this.paddingControl},getControlItems:function(){return _([this.createPaddingControl(),this.createControl("settings",e.settings,"on_settings_click")])}}),m=g.extend({events:{click:"on_click",dblclick:"on_edit"},on_edit:function(){if(""!==t("#element-settings-sidebar").html()||""!==t("#settings").html())return!1;var e=this.$el.find("[contenteditable]");return e.length>0?e[0].focus():Upfront.Events.trigger("entity:settings:activate",this),!1}}),v=Backbone.View.extend(_.extend({},d,{initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"add",this.render),this.listenTo(this.model,"remove",this.render),this.init&&this.init()}})),b=v.extend({events:{resort:"on_resort_collection","upfront:entity:remove":"on_entity_remove"},on_resort_collection:function(){var e=[],i=this.model;return this.$el.find(".upfront-editable_entity, .upfront-module-group").each(function(){var n=t(this).attr("id"),o=i.get_by_element_id(n);o&&e.push(o)}),this.model.reset(e),!1},on_entity_remove:function(t,e){e.remove(),this.model.remove(e.model)},on_activate:function(t){this.model.active_entity=t.model,Upfront.Events.trigger("entity:activated",t,t.model),this.trigger("activated")},deactivate:function(t){t==this.model.active_entity&&(this.model.active_entity=!1),Upfront.Events.trigger("entity:deactivated",t),this.trigger("deactivated")},fix_flexbox_clear:function(t){},fix_wrapper_height:function(t,e,i){Upfront.Behaviors.GridEditor.time_start("fn fix_wrapper_height");var n=this,o=Upfront.Behaviors.GridEditor,r=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),s=o.parse_modules_to_lines(t,e,r.id,_.isNumber(i)?i:r.columns);Upfront.Events.trigger("upfront:wrappers:before_fix_height",this),e.each(function(t){var e=Upfront.data.wrapper_views[t.cid];e&&e.$el.css("min-height","")}),_.each(s,function(t){var e=[];_.each(t.wrappers,function(t){var i=Upfront.data.wrapper_views[t.model.cid];i&&e.push(i.$el)}),n._apply_wrapper_height(e)}),Upfront.Events.trigger("upfront:wrappers:after_fix_height",this),Upfront.Behaviors.GridEditor.time_end("fn fix_wrapper_height")},_apply_wrapper_height:function(t){var e=_.map(t,function(t){return parseFloat(t.css("height"))}),i=_.max(e,function(t){return t});_.each(t,function(e,n){var o=n>0&&t[n-1].hasClass("upfront-wrapper-spacer"),r=n<t.length-1&&t[n+1].hasClass("upfront-wrapper-spacer");e.removeAttr("data-first-in-row"),e.removeAttr("data-last-in-row"),e.removeAttr("data-prev-spacer"),e.removeAttr("data-next-spacer"),0==n&&e.attr("data-first-in-row","1"),n==t.length-1&&e.attr("data-last-in-row","1"),o&&e.attr("data-prev-spacer","1"),r&&e.attr("data-next-spacer","1"),e.css("min-height",i)})},normalize_child_modules:function(t,e,i){var n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=this,r=Upfront.Behaviors.GridEditor,s=this.model,a=_.isNumber(e)?e:t,l=r.parse_modules_to_lines(s,i,n?n.id:"desktop",a);_.each(l,function(e){o._normalize_child_modules_line(e,t,a,n,i)})},normalize_child_spacing:function(){if((!this.region_view||"shadow"!=this.region_view.model.get("name"))&&(this.object_group_view||this.region_view)){var t=this,e=Upfront.Behaviors.GridEditor,i=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),n=!_.isUndefined(this.group_view),o=!_.isUndefined(this.object_group_view),r=this.model,s=n?this.group_view.model.get("wrappers"):o?this.object_group_view.model.get("wrappers"):this.region_view.model.get("wrappers");_.each(i,function(i){var n=i.toJSON(),o=e.get_container_col(t,n),a=e.parse_modules_to_lines(r,s,n.id,o),l=!1;_.each(a,function(i){var o=[],r=[],a=[];return _.each(i.wrappers,function(t){o.push(t),t.spacer?r.push(t):a.push(t)}),o.length==r.length?(t._remove_spacers(r,s),void(l=!0)):void _.each(o,function(i,r){if(0!=r&&i.spacer&&o[r-1].spacer){var a=o[r-1],p=a.col+i.col,d=a.model.get_property_value_by_name("breakpoint"),c=d&&n.id in d?d[n.id]:{};t._remove_spacers([i],s),!n||n.default?(a.model.replace_class(e.grid.class+p),_.each(a.modules,function(t){t.model.replace_class(e.grid.class+p)})):(c.col=p,a.model.set_property("breakpoint",Upfront.Util.clone(d)),_.each(a.modules,function(t){var e=t.model.get_property_value_by_name("breakpoint"),i=e&&n.id in e?e[n.id]:{};i.col=p,t.model.set_property("breakpoint",Upfront.Util.clone(e))})),l=!0}})}),l&&(a=e.parse_modules_to_lines(r,s,n.id,o)),_.each(a,function(e){e.col!=o&&t._normalize_child_modules_line(e,o,e.col,n,s)})})}},_normalize_child_modules_line:function(t,e,i,n,o){var r=Upfront.Behaviors.GridEditor,s=(this.model,e-t.col),a=0,l=0,p=0,d=0,c=[],u=[],h=[];if(0!=s){if(_.each(t.wrappers,function(t){t.ratio=t.col/i,t.apply_diff=Math.round(t.ratio*s),t.col+t.apply_diff<=0&&(t.apply_diff=0),a+=t.apply_diff,c.push(t),t.spacer?u.push(t):h.push(t)}),c.length==u.length)return void this._remove_spacers(u,o);if(l=a-s,0!=l)for(d=l>0?-1:1;0!=l&&(p=l,_.each(s>0?_.union(h,u):_.union(u,h),function(t){0!=l&&(t.col+t.apply_diff+d<=0||(t.apply_diff+=d,l+=d))}),p!=l););_.each(c,function(t){var e=t.col+t.apply_diff,i=t.model.get_property_value_by_name("breakpoint"),o=i&&n.id in i?i[n.id]:{};!n||n.default?(t.model.replace_class(r.grid.class+e),_.each(t.modules,function(t){t.model.replace_class(r.grid.class+e)})):(o.col=e,t.model.set_property("breakpoint",Upfront.Util.clone(i)),_.each(t.modules,function(t){var i=t.model.get_property_value_by_name("breakpoint"),o=i&&n.id in i?i[n.id]:{};o.col=e,t.model.set_property("breakpoint",Upfront.Util.clone(i))}))})}},_remove_spacers:function(t,e){var i=this.model;_.each(t,function(t){_.each(t.modules,function(t){i.remove(t.model)}),e.remove(t.model)})},preserve_wrappers_breakpoint_order:function(){if(this.region_view&&"shadow"!=this.region_view.model.get("name")){var t=this,e=Upfront.Behaviors.GridEditor,i=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),n=!_.isUndefined(this.group_view),o=!_.isUndefined(this.object_group_view),r=this.model,s=n?this.group_view.model.get("wrappers"):o?this.object_group_view.model.get("wrappers"):this.region_view.model.get("wrappers");_.each(i,function(i){var n=i.toJSON();if(!n.default){var o=e.get_container_col(t,n),a=e.parse_modules_to_lines(r,s,n.id,o),l=1;_.each(a,function(t){_.each(t.wrappers,function(t){var e=t.model.get_property_value_by_name("breakpoint"),i=e&&n.id in e?e[n.id]:{};i.order=l,t.model.set_property("breakpoint",Upfront.Util.clone(e)),l++})})}})}}}),y=Backbone.View.extend({tagName:"li",initialize:function(t){this.options=t,this.label=this.options.get_label,this.action=this.options.action,"function"==typeof this.options.in_context&&(this.in_context=this.options.in_context)},render:function(){var t=this,e="upfront-ctx-"+this.label().replace(/[^a-z0-9]/gi,"_").toLowerCase();this.$el.empty().addClass(e),this.$el.append(this.label),this.$el.bind("click",function(e){e.preventDefault(),t.action(this.for_view,e),Upfront.Events.trigger("entity:contextmenu:deactivate",this)})},remove:function(){this.parent_view=!1,this.for_view=!1,Backbone.View.prototype.remove.call(this)},in_context:function(){return!0}}),w=Backbone.View.extend({tagName:"ul",initialize:function(t){this.options=t,this.for_view=this.options.for_view},render:function(){var t=this;this.$el.empty(),this.menuitems.each(function(e){e.menulist||(e.menulist=t),e.for_view=t.for_view,e.in_context()&&(e.render(),e.parent_view=t,t.$el.append(e.el))})},remove:function(){this.menuitems&&this.menuitems.each(function(t){t.remove()}),this.for_view=!1,this.parent_view=!1,this.options=!1,Backbone.View.prototype.remove.call(this)}}),k=w.extend({className:"upfront-default_ctx_list",initialize:function(){var t=[];"theme"!=Upfront.Application.get_current()&&(Upfront.Settings.Application.NO_SAVE||t.push(new Upfront.Views.ContextMenuItem({get_label:function(){return e.save},action:function(){var t=new Upfront.Views.Editor.Command_SaveLayout;t.on_click()}})),t.push(new Upfront.Views.ContextMenuItem({get_label:function(){return e.undo},action:function(t){var e=new Upfront.Views.Editor.Command_Undo({model:Upfront.Application.layout});e.on_click()}}))),t.push(new Upfront.Views.ContextMenuItem({get_label:function(){return Upfront.Application.get_gridstate()?e.hide_grid:e.show_grid},action:function(){var t=new Upfront.Views.Editor.Command_ToggleGrid;t.on_click()}})),t.push(new Upfront.Views.ContextMenuItem({get_label:function(){return e.clone},in_context:function(){return this.for_view instanceof Upfront.Views.ObjectView},action:function(t,e){var i=this.for_view.parent_module_view,n=i.model,o=i.group_view?i.group_view:i.region_view,r=o.model.get("modules"),s=o.model.get("wrappers"),a=s.get_by_wrapper_id(n.get_property_value_by_name("wrapper_id")),l=Upfront.Util.model_to_json(n),p=new Upfront.Models.Module(l),d=Upfront.Util.get_unique_id("wrapper"),c=Upfront.Util.model_to_json(a),u=new Upfront.Models.Wrapper(c);r.indexOf(n);u.set_property("wrapper_id",d),p.set_property("wrapper_id",d),p.set_property("element_id",Upfront.Util.get_unique_id("module")),p.get("objects").each(function(t){t.set_property("element_id",Upfront.Util.get_unique_id("object"))}),s.add(u),r.add(p);var h=Upfront.Behaviors.GridEditor,f=Upfront.data.module_views[p.cid],_=f.$el,g=_.find(".upfront-module"),m=g.offset(),v=(g.position(),g.outerHeight()),b=g.outerWidth();h.start(f,p),h.normalize(h.els,h.wraps),g.css({position:"relative",top:e.pageY-m.top-v/2,left:e.pageX-m.left-b/2}),g.simulate("mousedown",{clientX:e.clientX,clientY:e.clientY})}})),t.push(new Upfront.Views.ContextMenuItem({get_label:function(){return"Edit Object"},in_context:function(){return this.for_view instanceof Upfront.Views.ObjectGroup},action:function(t,e){this.for_view.enable_object_edit()}})),this.menuitems=_(t)}}),$=Backbone.View.extend({initialize:function(t){this.options=t,this.for_view=this.options.for_view,this.menulists=_([])},render:function(){if(!Upfront.Application.user_can_modify_layout())return!1;var e=this;this.$el.empty().show(),this.menulists.each(function(t){t.for_view=e.for_view,t.render(),t.parent_view=e,e.$el.append(t.el)});var i=new k;i.for_view=e.for_view,i.render(),i.parent_view=e,e.$el.append(i.el),this.$el.css({position:"absolute","z-index":1e7,display:"block"}).offset({top:e.for_view.event.pageY,left:e.for_view.event.pageX-(t(document).width()-e.for_view.event.pageX<=this.$el.width()?this.$el.width():0)}).addClass("uf-context-menu")},remove:function(){this.menulists&&this.menulists.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this),t("#contextmenu").length||t("body").append('<div id="contextmenu">')}}),x=m.extend({className:"upfront-object-view",display_size_hint:!0,events:{"click .upfront-object > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .upfront-object > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-object-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-object > .upfront-entity_meta":"on_meta_click",click:"on_click",contextmenu:"on_context_menu"},initialize:function(){var t=this.update||this.render;this.listenTo(this.model.get("properties"),"change",t),this.listenTo(this.model.get("properties"),"add",t),this.listenTo(this.model.get("properties"),"remove",t),this.listenTo(Upfront.Events,"entity:resize_start",this.close_settings),this.listenTo(Upfront.Events,"entity:drag_start",this.close_settings),this.listenTo(Upfront.Events,"upfront:element:edit:start",this.on_element_edit_start),this.listenTo(Upfront.Events,"upfront:element:edit:stop",this.on_element_edit_stop),this.listenTo(Upfront.Events,"upfront:edit_content_style:start",this.on_content_style_edit_start),this.listenTo(Upfront.Events,"upfront:edit_content_style:stop",this.on_content_style_edit_stop),this.listenTo(Upfront.Events,"entity:module:update",this.on_module_update),this.listenTo(Upfront.Events,"layout:after_render",this.on_after_layout_render),this.listenTo(Upfront.Events,"layout:after_render",this.checkUiOffset),this.on("entity:resize_start",this.on_resize_start),this.on("entity:resizing",this.on_resizing),this.on("entity:resize_stop",this.on_resize),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:after",this.on_change_breakpoint_after),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.init&&this.init()},init_properties:function(){var t=Upfront.Settings.LayoutEditor.Grid.column_padding;this.model.get_property_value_by_name("padding_slider")||this.model.init_property("padding_slider",t)},close_settings:function(){Upfront.Events.trigger("entity:settings:deactivate")},render:function(){var e,i,n,o,r,a,l,p=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),d=Upfront.Settings.LayoutEditor.Grid,c={},u=this,h=this.get_buttons?this.get_buttons():"",f=this.get_extra_buttons?this.get_extra_buttons():"",g=this.get_content_markup?this.get_content_markup():"";d.column_padding;this.$el.addClass("upfront-object-view"),this.init_properties();var m=this.model.get_property_value_by_name("anchor");m&&m.length&&(this.el.id=m),this.model.get("properties").each(function(t){c[t.get("name")]=t.get("value")});var v="";_.each(this.model._previousAttributes.properties,function(t){"undefined"!=typeof t&&"theme_style"===t.name&&(v=t.value)}),v&&""===c.theme_style&&(this.$el.removeClass(v),this.$el.addClass(c.preset));var b=this.model.get_breakpoint_property_value("row",!0);e=b?b*Upfront.Settings.LayoutEditor.Grid.baseline:0,l="default_hide"in c?c.default_hide:0,a="hide"in c?c.hide:l;var y=this.model.get_breakpoint_property_value("theme_style",!0);if(y&&(c.class+=" "+y.toLowerCase(),this._theme_style=y),c.preset=c.preset||"",i=_.extend(this.model.toJSON(),{properties:c,buttons:h,content:g,height:e,hide:a,extra_buttons:f}),"undefined"==typeof i.properties.usingNewAppearance&&(i.properties.preset=""),n=_.template(s.object,i),Upfront.Events.trigger("entity:object:before_render",this,this.model),this.parent_module_view&&(this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_start"),this.listenTo(this.parent_module_view,"entity:resize_start",this.on_element_resize_start),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resizing"),this.listenTo(this.parent_module_view,"entity:resizing",this.on_element_resizing),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_stop"),this.listenTo(this.parent_module_view,"entity:resize_stop",this.on_element_resize),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:drop"),this.listenTo(this.parent_module_view,"entity:drop",this.on_element_drop),this.listenTo(this.parent_module_view,"entity:drop",this.adjust_top_settings_panel_position),o=Upfront.Behaviors.GridEditor.get_class_num(this.parent_module_view.model.get_property_value_by_name("class"),d.class)),this.object_group_view&&(this.stopListening(this.object_group_view,"toggle_object_edit"),this.listenTo(this.object_group_view,"toggle_object_edit",this.on_toggle_object_edit)),this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update)),this.$el.html(n),"undefined"!=typeof this.subview&&this.subview.setElement(this.$(".upfront-object-content")).render(),"class"in c?(r=Upfront.Behaviors.GridEditor.get_class_num(c.class,d.class),r=r>o?o:r):r=o,$object=this.$el.find(".upfront-editable_entity:first"),$object.data("default_col",r),$object.data("current_col",r),this.apply_paddings(this.$el.find("> .upfront-editable_entity:first")),Upfront.Events.trigger("entity:object:after_render",this,this.model),this.display_size_hint&&this.create_size_hint(this.$el),this.on_render&&this.on_render(),this.ensure_breakpoint_change_is_listened(),this.ensureUiOffsetCalls(),this.object_group_view?this.$control_el=this.$el:this.parent_module_view&&(this.$control_el=this.parent_module_view.$(".upfront-module")),this.$control_el&&1==this.$control_el.length&&(this.updateControls(),this.toggleControls(),setTimeout(function(){u.paddingControl&&"undefined"!=typeof u.paddingControl.isOpen&&!u.paddingControl.isOpen&&u.paddingControl.refresh()},300)),p&&!p.default)this.update_position();else if(0==t("#element-settings-sidebar").children().length){var w=this.model.get_property_value_by_name("current_preset"),k=this.model.get_property_value_by_name("preset");w&&k!==w&&this.model.set_property("preset",w,!1)}},update:function(t,e){if("undefined"==typeof t)return this.render();var i=t.get("value"),n=this.$el.find(".upfront-editable_entity:first"),o=this.object_group_view?n:!!this.parent_module_view&&this.parent_module_view.$el.find(">.upfront-module"),r=Upfront.Settings.LayoutEditor.Grid;if("row"==t.id){var s=i*r.baseline;n.css("min-height",s).attr("data-row",i)}else if("class"==t.id){n.attr("class");_.each([r.class,r.left_margin_class,r.top_margin_class,r.bottom_margin_class,r.right_margin_class],function(t){var e=new RegExp("\\b"+t+"(\\d+)"),o=i.match(e);o&&o[1]&&(Upfront.Behaviors.GridEditor.update_class(n,t,o[1]),t==r.class&&(n.data("default_col",parseInt(o[1],10)),n.data("current_col",parseInt(o[1],10))))})}else if("breakpoint"==t.id){this.update_position();var a=i.current_property,l=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),p=!(!i[l.id]||!i[l.id][a])&&i[l.id][a];a&&p&&("top_padding_num"===a&&this.show_top_padding_hint(p,o),"bottom_padding_num"===a&&this.show_bottom_padding_hint(p,o))}else t.id.match(/(top|bottom|left|right)_padding_(use|num|slider)/)?(this.apply_paddings(n),this.handle_visual_padding_hint(t,o)):t.id.match(/padding_slider/)?(this.render(),this.handle_visual_padding_hint(t,o)):"wrapper_id"==t.id?this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update)):this.render();Upfront.Events.trigger("entity:object:update",this,this.model)},handle_visual_padding_hint:function(t,e){if("undefined"!=typeof t){var i=t.get("value");t.id.match(/(top|bottom)_padding_(num|slider)/)?(t.id.match(/top_padding_(num|slider)/)&&this.show_top_padding_hint(i,e),t.id.match(/bottom_padding_(num|slider)/)&&this.show_bottom_padding_hint(i,e)):t.id.match(/padding_slider/)&&(this.show_top_padding_hint(i,e),this.show_bottom_padding_hint(i,e))}},update_position:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if(t){var e=this.$el.find("> .upfront-editable_entity:first"),i=this.$el.find("> .upfront-object-hidden-toggle");this.apply_paddings(e),this.apply_breakpoint_position(e,i),this.display_size_hint&&this.update_size_hint(),this.trigger("update_position",this,this.model),Upfront.Events.trigger("entity:object:update_position",this,this.model)}},ensure_breakpoint_change_is_listened:function(){this.breakpoint_change_is_setup||(this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.breakpoint_change_is_setup=!0)},ensureUiOffsetCalls:function(){var e=this;this.parent_module_view&&this.parent_module_view.$el&&!this.offset_check_set_for_parent&&(this.offset_check_set_for_parent=!0,this.listenTo(this.parent_module_view,"entity:drop",function(){e.checkUiOffset()})),this.window_resize_offset_check_set||(this.lazyCheckUiOffset=_.throttle(this.checkUiOffset,1e3),t(window).on("resize",t.proxy(this.lazyCheckUiOffset,e)),this.window_resize_offset_check_set=!0)},checkUiOffset:function(){if(this.parent_module_view){var t=this.parent_module_view.region_view&&this.parent_module_view.region_view.$el;if(t){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=e&&!e.default,n=t.closest(".upfront-region-container"),o=i?t.offset():n.offset(),r=this.$el.offset(),s=o&&r.top-o.top<50,a=r.left+this.$el.width(),l=(o||{left:0}).left+(i?t.width():n.width()),p=l-a<30;s&&p?this.parent_module_view.$el.addClass("offset-ui-from-right-top"):this.parent_module_view.$el.removeClass("offset-ui-from-right-top")}}},on_click:function(t){g.prototype.on_click.call(this,t),this.object_group_view&&"editing"in this.object_group_view&&this.object_group_view.editing&&t.stopPropagation()},on_element_edit_start:function(t,e){"text"!=t&&"write"!=t||!this.parent_module_view||(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-editing"),"write"==t?this.parent_module_view.disable_interaction(!0,!0,!1,!1,!0):this.parent_module_view.disable_interaction(!1))},on_element_edit_stop:function(e,i,n){var o=t(Upfront.Settings.LayoutEditor.Selectors.main);o.hasClass("upfront-editing-post-content")&&"write"!=e||(this.parent_module_view&&this.parent_module_view.enable_interaction&&n!==!0&&(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-editing"),"write"==e?this.parent_module_view.enable_interaction(!0):this.parent_module_view.enable_interaction(!1)),Upfront.Events.trigger("entity:object:refresh",this))},on_content_style_edit_start:function(){this.parent_module_view&&(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-editing"),this.parent_module_view.disable_interaction(!1))},on_content_style_edit_stop:function(){this.parent_module_view&&this.parent_module_view.enable_interaction&&(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-editing"),this.parent_module_view.enable_interaction(!1)),Upfront.Events.trigger("entity:object:refresh",this)},on_element_resize_start:function(t){},on_element_resizing:function(t){this.display_size_hint&&this.update_size_hint(t.width,t.height)},on_element_resize:function(t){},on_element_drop:function(t){},on_resize_start:function(t){},on_resizing:function(t){this.display_size_hint&&this.update_size_hint(t.width,t.height)},on_resize:function(t){},on_after_layout_render:function(){},on_module_update:function(t){if(this.parent_module_view&&this.parent_module_view==t&&this.display_size_hint){var e=this;setTimeout(function(){e.update_size_hint()},500)}},on_wrapper_update:function(t,e){this.wrapper_view&&t!=this.wrapper_view||this.update_position()},on_toggle_object_edit:function(t){var e=this.$el.find(">.upfront-editable_entity:first"),i=e.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger"),n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();e.data("ui-draggable")&&e.draggable("option","disabled",!t),n&&!n.default?i.toggle(t):i.hide()},on_change_breakpoint:function(t){var e=this.model.get_breakpoint_property_value("theme_style",!0),i=this.$el.find("> .upfront-editable_entity:first");if(this._theme_style&&i.removeClass(this._theme_style.toLowerCase()),e&&(i.addClass(e.toLowerCase()),this._theme_style=e),this.model.decode_preset(t.id),this.checkUiOffset(),"undefined"!=typeof this.parent_module_view&&this.parent_module_view){this.$control_el=this.parent_module_view.$(".upfront-module"),this.updateControls()}},on_change_breakpoint_after:function(t){var e=this.$el.find("> .upfront-editable_entity:first");"undefined"!=typeof this.paddingControl&&"undefined"!=typeof this.paddingControl.model&&(this.paddingControl.refresh(this.paddingControl.model),this.apply_paddings(e)),this.after_breakpoint_change()},after_breakpoint_change:function(){},on_grid_update:function(){var t=this.$el.find("> .upfront-editable_entity:first");this.apply_paddings(t),this.update_position()},activate:function(){"undefined"!=typeof Upfront.data.prevEntity&&Upfront.data.prevEntity!==!1&&Upfront.data.prevEntity.deactivate(),Upfront.data.prevEntity=this,g.prototype.activate.call(this),t(".upfront-region-module-activated").removeClass(".upfront-region-module-activated"),this.$el.closest(".upfront-region-container").addClass("upfront-region-module-activated"),this.parent_module_view&&(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-active"),this.parent_module_view.wrapper_view&&this.parent_module_view.wrapper_view.$el.addClass("upfront-wrapper-active"))},deactivate:function(){return""===t("#element-settings-sidebar").html()&&""===t("#settings").html()&&(Upfront.data.prevEntity=!1,g.prototype.deactivate.call(this),this.$el.closest(".upfront-region-container").removeClass("upfront-region-module-activated"),void(this.parent_module_view&&(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-active"),this.parent_module_view.wrapper_view&&(this.parent_module_view.wrapper_view.$el.removeClass("upfront-wrapper-active upfront-inline-panel-item-open"),this.paddingControl&&this.paddingControl.close()))))},on_hide_click:function(t){t.preventDefault();var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(i[e.id])||(i[e.id]={}),1==i[e.id].hide?i[e.id].hide=0:i[e.id].hide=1,this.model.set_property("breakpoint",i)},on_context_menu:function(t){this.object_group_view||g.prototype.on_context_menu.call(this,t)},toggle_region_class:function(t,e,i){var n=!(!this.parent_module_view||!this.parent_module_view.region_view)&&this.parent_module_view.region_view,o=!!n&&n.parent_view.get_container_view(n.model),i=!0===i;n&&(i?(o||{}).$el&&o.$el.toggleClass(t,e):n.$el.toggleClass(t,e))},add_region_class:function(t,e){this.toggle_region_class(t,!0,e)},remove_region_class:function(t,e){this.toggle_region_class(t,!1,e)},get_element_size:function(t){t="undefined"==typeof t||t;var e=Upfront.Behaviors.GridEditor;e.start(this.parent_module_view,this.parent_module_view.model);var i=e.get_position(this.parent_module_view.$el.find(".upfront-module"));return{col:i.col,row:t?i.row:this.model.get_property_value_by_name("row")}},get_element_columns:function(){return this.get_element_size().col},get_element_rows:function(){return this.get_element_size().row},get_element_size_px:function(t){t="undefined"==typeof t||t;var e=Upfront.Behaviors.GridEditor,i=this.get_element_size(t);return{col:i.col*e.col_size,row:i.row*e.baseline}},get_element_columns_px:function(){return this.get_element_size_px().col},get_element_rows_px:function(){return this.get_element_size_px().row},get_element_max_size:function(t){var e=Upfront.Behaviors.GridEditor,i=this.parent_module_view.$el.find(".upfront-module"),n=this.$el.closest(".upfront-region");return e.start(this.parent_module_view,this.parent_module_view.model),e.get_max_size(e.get_el(i),e.els,e.get_region(n),t)},get_element_max_columns:function(t){return this.get_element_max_size(t).col},get_element_max_rows:function(t){return this.get_element_max_size(t).row},get_element_max_size_px:function(t){var e=Upfront.Behaviors.GridEditor,i=this.get_element_max_size(t);return{col:i.col*e.col_size,row:i.row*e.baseline}},get_element_max_columns_px:function(t){return this.get_element_max_size_px(t).col},get_element_max_rows_px:function(t){return this.get_element_max_size_px(t).row;
},set_element_size:function(t,e,i,n){return Upfront.Behaviors.GridEditor.resize(this.parent_module_view,this.parent_module_view.model,t,e,i,n)},cleanup:function(){},remove:function(){this.cleanup(),t(window).off("resize",this.lazyCheckUiOffset),this.parent_view=!1,this.parent_module_view=!1,this.object_group_view=!1,Backbone.View.prototype.remove.call(this)},on_settings_click:function(t){"undefined"!=typeof t&&t.preventDefault(),Upfront.Events.trigger("element:settings:activate",this)}}),U=x.extend({className:"upfront-object-group-view",events:{"click .upfront-object-group > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click .upfront-object-group > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .upfront-object-group > .upfront-entity_meta":"on_meta_click","click > .upfront-object-group-finish-edit":"on_finish",click:"on_click",contextmenu:"on_context_menu"},initialize:function(){x.prototype.initialize.call(this),this.listenTo(Upfront.Events,"command:object_group:finish_edit",this.on_finish),this._module_col={},this.editing=!1},render:function(){var t,e,i,n,o,r=this,a=Upfront.Settings.LayoutEditor.Grid,l=this._objects_view||new E({model:this.model.get("objects")}),p={},d=this.get_buttons?this.get_buttons():"",c=this.get_extra_buttons?this.get_extra_buttons():"",u=this.model.get_property_value_by_name("anchor");u&&u.length&&(this.el.id=u),this.model.get("properties").each(function(t){p[t.get("name")]=t.get("value")});var h=this.model.get_breakpoint_property_value("row",!0);t=h?h*Upfront.Settings.LayoutEditor.Grid.baseline:0;var f=this.model.get_breakpoint_property_value("theme_style",!0);f&&(p.class+=" "+f.toLowerCase(),this._theme_style=f),p.preset=p.preset||"",this._preset=p.preset,e=_.extend(this.model.toJSON(),{properties:p,buttons:d,height:t,extra_buttons:c}),i=_.template(s.object_group,e),Upfront.Events.trigger("entity:object_group:before_render",this,this.model),this.parent_module_view&&(this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_start"),this.listenTo(this.parent_module_view,"entity:resize_start",this.on_element_resize_start),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resizing"),this.listenTo(this.parent_module_view,"entity:resizing",this.on_element_resizing),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_stop"),this.listenTo(this.parent_module_view,"entity:resize_stop",this.on_element_resize),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:drop"),this.listenTo(this.parent_module_view,"entity:drop",this.on_element_drop),n=Upfront.Behaviors.GridEditor.get_class_num(this.parent_module_view.model.get_property_value_by_name("class"),a.class)),l.$el.detach(),this.$el.html(i),l.object_group_view=this,this.$(".upfront-objects_container").append(l.el),l.render(),o=Upfront.Behaviors.GridEditor.get_class_num(p.class,a.class),o=o>n?n:o,$object=this.$el.find(".upfront-editable_entity:first"),$object.data("default_col",o),$object.data("current_col",o),this.apply_paddings(this.$el.find("> .upfront-editable_entity:first")),Upfront.Events.trigger("entity:object_group:after_render",this,this.model),this.display_size_hint&&this.create_size_hint(this.$el),this.on_render&&this.on_render(),this._objects_view?this._objects_view.delegateEvents():this._objects_view=l,this.ensure_breakpoint_change_is_listened(),this.ensureUiOffsetCalls(),this.parent_module_view&&(this.$control_el=this.parent_module_view.$(".upfront-module"),this.updateControls(),this.toggleControls(),setTimeout(function(){r.paddingControl&&"undefined"!=typeof r.paddingControl.isOpen&&!r.paddingControl.isOpen&&r.paddingControl.refresh()},300)),this._module_cols=this.get_module_cols()},update:function(t,e){if("undefined"!=typeof t){var i=t.get("value"),n=this.$el.find(".upfront-editable_entity:first"),o=Upfront.Settings.LayoutEditor.Grid;if("row"==t.id){var r=i*o.baseline;n.css("min-height",r).attr("data-row",i)}else if("class"==t.id){n.attr("class");_.each([o.class,o.left_margin_class,o.top_margin_class,o.bottom_margin_class,o.right_margin_class],function(t){var e=new RegExp("\\b"+t+"(\\d+)"),o=i.match(e);o&&o[1]&&Upfront.Behaviors.GridEditor.update_class(n,t,o[1])})}else if("breakpoint"==t.id){this.update_position();var s=i.current_property,a=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),l=!(!i[a.id]||!i[a.id][s])&&i[a.id][s];s&&l&&("top_padding_num"===s&&this.show_top_padding_hint(l),"bottom_padding_num"===s&&this.show_bottom_padding_hint(l))}else t.id.match(/(top|bottom|left|right)_padding_(use|num|slider)/)?(this.apply_paddings(n),this.handle_visual_padding_hint(t)):t.id.match(/padding_slider/)?this.handle_visual_padding_hint(t):"preset"==t.id&&(this._preset&&n.removeClass(this._preset),n.addClass(i),this._preset=i);Upfront.Events.trigger("entity:object_group:update",this,this.model)}},get_module_cols:function(){var t=this,e=this.parent_module_view.model,i=e.get_property_value_by_name("class"),n=Upfront.Settings.LayoutEditor.Grid,o=Upfront.Behaviors.GridEditor,r=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),s={};return s.default=o.get_class_num(i,n.class),_.each(r,function(e){var i=e.toJSON(),n=o.get_container_col(t._objects_view,i);s[i.id]=n}),s},on_click:function(t){g.prototype.on_click.call(this,t),this.parent_module_view&&this.parent_module_view.group_view&&t.stopPropagation()},on_module_update:function(t,e){if(this.parent_module_view&&this.parent_module_view==t){var i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=this.get_module_cols();Upfront.Application.layout_ready&&(prev_col=!i||i.default?this._module_cols.default:this._module_cols[i.id],col=!i||i.default?n.default:n[i.id],prev_col!=col&&this.normalize_child_modules(prev_col)),this._module_cols=n}},normalize_child_modules:function(t){if(this._objects_view){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Behaviors.GridEditor,n=this.parent_module_view.$el.find("> .upfront-module"),o=!e||e.default?i.get_class_num(n,i.grid.class):n.data("breakpoint_col");this._objects_view.normalize_child_modules(o,t,this.model.get("wrappers"))}},enable_object_edit:function(){this.parent_module_view&&!this.parent_module_view.group_view&&Upfront.Events.trigger("command:module_group:finish_edit"),Upfront.Events.trigger("command:object_group:finish_edit"),this.toggle_object_edit(!0)},disable_object_edit:function(){this.editing&&this.toggle_object_edit(!1)},toggle_object_edit:function(e){var i=t(Upfront.Settings.LayoutEditor.Selectors.main);e?(i.addClass("upfront-object-group-editing"),this.$el.addClass("upfront-object-group-on-edit"),this.parent_module_view.disable_interaction(!0,!0,!1,!1,!0),this.parent_module_view.$el.addClass("upfront-module-object-group-on-edit"),this.parent_module_view.wrapper_view&&this.parent_module_view.wrapper_view.$el.addClass("upfront-wrapper-object-group-on-edit"),this.editing=!0):this.editing&&(i.removeClass("upfront-object-group-editing"),this.$el.removeClass("upfront-object-group-on-edit"),this.parent_module_view.enable_interaction(!0),this.parent_module_view.$el.removeClass("upfront-module-object-group-on-edit"),this.parent_module_view.wrapper_view&&this.parent_module_view.wrapper_view.$el.removeClass("upfront-wrapper-object-group-on-edit"),this.editing=!1),this.trigger("toggle_object_edit",e)},on_finish:function(t){"undefined"!=typeof t&&t.preventDefault(),this.disable_object_edit()},remove:function(){this._objects_view&&this._objects_view.remove(),Backbone.View.prototype.remove.call(this)}}),E=b.extend({attributes:{class:"upfront-editable_entities_container"},init:function(){this.stopListening(this.model,"add",this.render),this.listenTo(this.model,"add",this.on_add),this.stopListening(this.model,"remove",this.render),this.listenTo(this.model,"remove",this.on_remove),this.stopListening(this.model,"change",this.render),this.listenTo(this.model,"change",this.rerender_objects),this.listenTo(this.model,"reset",this.on_reset),this.lazy_apply_wrapper_height=_.debounce(this.apply_wrapper_height,1e3),this.listenTo(Upfront.Events,"entity:drag_stop",this.lazy_apply_wrapper_height),this.listenTo(Upfront.Events,"entity:drag_stop",this.apply_adapt_to_breakpoints),this.listenTo(Upfront.Events,"entity:resized",this.apply_wrapper_height),this.listenTo(Upfront.Events,"entity:resized",this.apply_adapt_to_breakpoints),this.listenTo(Upfront.Events,"entity:wrapper:resized",this.on_wrapper_resize),this.listenTo(Upfront.Events,"entity:wrappers:update",this.on_wrappers_update),this.listenTo(Upfront.Events,"entity:object:refresh",this.on_object_refresh),this.listenTo(Upfront.Events,"layout:render",this.on_after_layout_render),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:after",this.on_change_breakpoint_after),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"upfront:grid:updated:after",this.on_grid_update_after)},on_entity_remove:function(t,e){Upfront.Events.trigger("entity:object:removed:before");var i=e.model.get_wrapper_id();if(i&&this.object_group_view){var n=this.object_group_view.model.get("wrappers"),o=n.get_by_wrapper_id(i),r=0;o&&(this.model.each(function(t){t.get_wrapper_id()==i&&r++}),1==r&&(Upfront.Behaviors.GridEditor.normalize_module_remove(e,e.model,this.model,o,n),n.remove(o)))}e.remove(),this.model.remove(e.model),this.normalize_child_spacing(),Upfront.Events.trigger("entity:object:removed:after")},render:function(){var t=this.$el,e=this;t.find(">.upfront-wrapper").detach(),"undefined"==typeof Upfront.data.object_views&&(Upfront.data.object_views={}),"undefined"==typeof Upfront.data.wrapper_views&&(Upfront.data.wrapper_views={}),this.current_wrapper_view=null,this.current_wrapper_id=null,this.current_wrapper_el=null,this.model.each(function(t){e.render_object(t)}),this.apply_flexbox_clear()},render_object:function(e,i){var n,o,r=this.$el,s=i&&"undefined"!=typeof i.index?i.index-1:-2,a=s>=0&&r.find("> .upfront-wrapper > .upfront-object-view, > .upfront-wrapper > .upfront-object-group").eq(s),l=!(!this.object_group_view||!this.object_group_view.model)&&this.object_group_view.model.get("wrappers"),p=e.get("properties").where({name:"view_class"}),d=!!e.get("objects"),c=d?"ObjectGroup":"ObjectView",u=p.length?p[0].get("value"):c,h=!!Upfront.Views[u]&&(Upfront.data.object_views[e.cid]||new Upfront.Views[u]({model:e})),f=e.get_wrapper_id(),_=!(!l||!f)&&l.get_by_wrapper_id(f);l&&!_||(h&&(h.parent_view=this,h.parent_module_view&&(h._previous_parent_module_view=h.parent_module_view),this.object_group_view?(h.object_group_view=this.object_group_view,h.parent_module_view=this.object_group_view.parent_module_view):h.parent_module_view=this.parent_view,_?(this.current_wrapper_id==f?o=this.current_wrapper_el:(n=Upfront.data.wrapper_views[_.cid],n?n.parent_view=this:(n=new Upfront.Views.Wrapper({model:_}),n.parent_view=this,n.render()),o=n.el,this.current_wrapper_view=n),this.current_wrapper_id=f,this.current_wrapper_el=o,this.current_wrapper_view&&(h.wrapper_view=this.current_wrapper_view),n&&(s===-2?r.append(o):s===-1?r.prepend(o):a.closest(".upfront-wrapper").after(o),Upfront.data.wrapper_views[_.cid]||(Upfront.data.wrapper_views[_.cid]=n)),a!==!1?a.closest(".upfront-wrapper").get(0)==o?a.after(h.el):t(o).prepend(h.el):s===-1?t(o).prepend(h.el):t(o).append(h.el),h.render()):(s===-2?r.append(h.el):s===-1?r.prepend(h.el):a.parent().after(h.el),h.render()),Upfront.data.object_views[e.cid]?h.delegateEvents():(this.listenTo(h,"upfront:entity:activate",this.on_activate),this.listenTo(h.model,"remove",this.deactivate),Upfront.data.object_views[e.cid]=h)),Upfront.Events.trigger("entity:objects:render_object",h,h.model,this,this.model))},rerender_objects:function(){this.model.each(function(t){var e=Upfront.data.object_views[t.cid];e&&e.render()})},apply_flexbox_clear:function(){this.fix_flexbox_clear(this.$el)},apply_wrapper_height:function(){if(Upfront.Application.layout_ready&&this.object_group_view){var t=this.object_group_view.parent_module_view;if(!t.region_view||"shadow"!=t.region_view.model.get("name")){var e=Upfront.Behaviors.GridEditor,i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=this.object_group_view.model.get("wrappers"),o=i.default?e.get_class_num(t.$el.find(">.upfront-module"),e.grid.class):t.model.get_breakpoint_property_value("col");this.fix_wrapper_height(this.model,n,o)}}},apply_adapt_to_breakpoints:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if((!t||t.default)&&this.object_group_view){var e=this.object_group_view.parent_module_view;if(!e.region_view||"shadow"!=e.region_view.model.get("name")){var i=this,n=Upfront.Behaviors.GridEditor,o=this.object_group_view.model.get("wrappers"),r=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(r,function(t){var r=t.toJSON();if(!r.default){var s=n.get_class_num(e.$el.find("> .upfront-module"),n.grid.class),a=e.model.get_property_value_by_name("breakpoint");_.isObject(a)&&_.isObject(a[r.id])&&!_.isUndefined(a[r.id].col)&&(s=a[r.id].col),n.adapt_to_breakpoint(i.model,o,r.id,s,!0)}})}}},on_after_layout_render:function(){this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints(),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.lazy_apply_wrapper_height)},on_wrappers_update:function(t){_.isObject(t)&&t.get("objects")!=this.model||(this.model.each(function(t){var e=Upfront.data.object_views[t.cid];e&&e.update_position()}),this.lazy_apply_wrapper_height())},on_wrapper_resize:function(t,e){t.parent_view&&t.parent_view!=this||(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_object_refresh:function(t){this.object_group_view&&(t.parent_view&&t.parent_view!=this||this.lazy_apply_wrapper_height())},on_add:function(t,e,i){var n="undefined"==typeof i.update||i.update;this.current_wrapper_id=this.current_wrapper_el=null,this.render_object(t,i),n&&(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints()),Upfront.Events.trigger("entity:added:after")},on_remove:function(t,e,i){var n="undefined"==typeof i.update||i.update;this.remove_model(t),n&&(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},remove_model:function(t){var e=Upfront.data.object_views[t.cid];e&&(e.unbind(),e.remove(),delete Upfront.data.object_views[t.cid])},on_reset:function(t,e){var i=this;e&&e.call_render&&(_.each(e.call_render,function(e){var n=t.indexOf(e);i.render_object(e,{index:n})}),this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_change_breakpoint:function(t){},on_change_breakpoint_after:function(t){this.lazy_apply_wrapper_height()},on_grid_update:function(){},on_grid_update_after:function(){this.lazy_apply_wrapper_height()},remove:function(){this.model&&this.model.each(function(t){var e=Upfront.data.object_views[t.cid];e&&(e.remove(),delete Upfront.data.object_views[t.cid])}),this.parent_view=!1,Backbone.View.prototype.remove.call(this),this.model&&(this.model.reset([],{silent:!0}),this.model=!1)}}),S=g.extend({interaction:!0,lock_interaction:!1,className:"upfront-module-view",events:{"click .upfront-module > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click .upfront-module > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .upfront-module > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-module-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click .upfront-module > .upfront-entity_meta":"on_meta_click",click:"on_click"},initialize:function(){var t=this.update||this.render;this.listenTo(this.model.get("properties"),"change",t),this.listenTo(this.model.get("properties"),"add",t),this.listenTo(this.model.get("properties"),"remove",t),this.listenTo(Upfront.Events,"command:region:edit_toggle",this.on_region_edit),this.listenTo(Upfront.Events,"command:region:fixed_edit_toggle",this.on_region_edit),this.on("on_layout",this.render_new_object,this),this.on("region:updated",this.on_region_update,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"layout:render",this.on_after_layout_render)},render:function(){var t,e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Settings.LayoutEditor.Grid,n={},o="undefined"!=typeof this.group_view,r=(this.model.get("properties").each(function(t){n[t.get("name")]=t.get("value")}),n.row?n.row*Upfront.Settings.LayoutEditor.Grid.baseline:0),a=Upfront.Behaviors.GridEditor.get_class_num(n.class,i.class),l="default_hide"in n?n.default_hide:0,p="hide"in n?n.hide:l,d=_.extend(this.model.toJSON(),{properties:n,height:r,hide:p,parent_group_class:o?"upfront-module-parent-group":""}),c=_.template(s.module,d);Upfront.Events.trigger("entity:module:before_render",this,this.model),this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update)),this.$el.html(c),t=this.$el.find(".upfront-editable_entity:first"),t.data("default_col",a),t.data("current_col",a),e&&!e.default&&this.update_position(),this.model.get("shadow")?t.attr("data-shadow",this.model.get("shadow")):this.render_object(),this.$el.is(".upfront-active_entity")&&this.$el.trigger("upfront-editable_entity-selected",[this.model,this]),Upfront.Events.trigger("entity:module:after_render",this,this.model)},update:function(t,e){var i=(t._previousAttributes.value,t.get("value")),n=this.$el.find(".upfront-editable_entity:first"),o=Upfront.Settings.LayoutEditor.Grid;if("row"==t.id){var r=i*o.baseline;n.css("min-height",r).attr("data-row",i)}else if("class"==t.id){n.attr("class");_.each([o.class,o.left_margin_class,o.top_margin_class,o.bottom_margin_class,o.right_margin_class],function(t){var e=new RegExp("\\b"+t+"(\\d+)"),r=i.match(e);r&&r[1]&&(Upfront.Behaviors.GridEditor.update_class(n,t,r[1]),t==o.class&&(n.data("default_col",parseInt(r[1],10)),n.data("current_col",parseInt(r[1],10))))})}else"breakpoint"==t.id?this.update_position():"wrapper_id"==t.id&&this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update));Upfront.Events.trigger("entity:module:update",this,this.model)},update_position:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();Upfront.Settings.LayoutEditor.Grid;if(t){var e=this.$el.find("> .upfront-module"),i=this.$el.find("> .upfront-module-hidden-toggle");this.apply_breakpoint_position(e,i),this.trigger("update_position",this,this.model),Upfront.Events.trigger("entity:module:update_position",this,this.model)}},render_object:function(){var t=this._objects_view||new E({model:this.model.get("objects")});t.parent_view=this,this.$(".upfront-objects_container").append(t.el),t.render(),this._objects_view?this._objects_view.delegateEvents():this._objects_view=t},render_new_object:function(){this.render_object(),this.model.get("objects").each(function(t){t.set_property("usingNewAppearance",!0)})},disable_interaction:function(t,e,i,n,o){var r=this.$el.find(".upfront-editable_entity:first");t&&e&&r.addClass("upfront-module-disabled-all"),t&&r.addClass("upfront-module-disabled-edit"),e&&r.addClass("upfront-module-disabled-button"),!i&&r.data("ui-resizable")&&r.resizable("option","disabled",!0),!n&&r.data("ui-draggable")&&r.draggable("option","disabled",!0),this.interaction=!1,o&&(this.lock_interaction=!0)},enable_interaction:function(t){if(!this.lock_interaction||t){var e=this.$el.find(".upfront-editable_entity:first");e.removeClass("upfront-module-disabled-all upfront-module-disabled-edit upfront-module-disabled-button"),e.data("ui-resizable")&&e.resizable("option","disabled",!1),e.data("ui-draggable")&&e.draggable("option","disabled",!1),this.interaction=!0,this.lock_interaction=!1}},on_click:function(e){var i,n,o,r=this,s=Upfront.Behaviors.LayoutEditor,a=!1,l=this.$el.find(">.upfront-module"),p=Upfront.data.currentEntity,d=!!p&&p.$el.closest(".upfront-module");this.interaction?e&&e.shiftKey&&this.region_view?(_.each(s.selection,function(e){a||(a=t(e).closest(".upfront-region").get(0)!=r.region_view.$el.get(0))}),a&&s.remove_selections(),n=this.region_view.$el.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),o=this.region_view.$el.find(".upfront-module-group"),s.selection.length>0?(i=this.region_view.$el.find(".upfront-ui-selected"),s._add_selections(i.add(l),n,o)):d!==!1&&d.length>0?(s._add_selection(d.get(0)),i=d,d.get(0)!=l.get(0)&&(i=i.add(l)),i.length>1&&s._add_selections(i,n,o)):s._add_selection(l.get(0)),s._update_selection_outline(),s.selection.length>1&&s.parse_selections(),p&&(p.trigger("deactivated",e),p.$el.removeClass("upfront-active_entity"),Upfront.Events.trigger("entity:deactivated",e),Upfront.data.currentEntity=!1),e.stopPropagation()):(s.remove_selections(),this.constructor.__super__.on_click.call(this,e)):e.stopPropagation()},on_hide_click:function(t){g.prototype.on_hide_click.call(this,t),Upfront.Events.trigger("entity:module:hide_toggle",this,this.model)},on_resize:function(t){},on_drop:function(t){},on_region_update:function(){this._objects_view&&this._objects_view.model.each(function(t){t.trigger("region:updated")})},on_region_edit:function(t){Upfront.Application.PostContentEditor!=Upfront.Application.current_subapplication&&(t?this.disable_interaction(!0,!0,!1,!1,!0):this.enable_interaction(!0))},on_wrapper_update:function(t,e){this.wrapper_view&&t!=this.wrapper_view||this.update_position()},on_change_breakpoint:function(t){var e=this.$el.find(".upfront-module > .upfront-entity_meta > a.upfront-entity-delete_trigger"),i=this.$el.find(".upfront-module > .upfront-entity_meta > a.upfront-entity-hide_trigger");t.default?(this.enable_interaction(!0),e.show(),i.hide()):(this.disable_interaction(!0,!1,!0,!0,!0),e.hide(),i.show())},on_grid_update:function(){},on_after_layout_render:function(){},remove:function(){this._objects_view&&this._objects_view.remove(),Backbone.View.prototype.remove.call(this)}}),C=g.extend({className:"upfront-editable_entity upfront-module-group",id:function(){return this.model.get_property_value_by_name("element_id")},cssSelectors:{".upfront-module-group":{label:e.mg_label,info:e.mg_info},".upfront-module-group-bg":{label:e.mgbg_label,info:e.mgbg_info},".upfront-object, .upfront-output-object":{label:e.mgel_label,info:e.mgel_info}},events:{"click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-module-group-toggle-container > .upfront-module-group-ungroup":"on_ungroup","click > .upfront-module-group-toggle-container > .upfront-module-group-reorder":"on_reorder","click > .upfront-module-group-toggle-container > .upfront-module-group-edit":"on_edit","click > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-module-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click .open-item-controls":"onOpenItemControlsClick","click > .upfront-module-group-finish-edit":"on_finish",click:"on_click",dblclick:"on_dblclick"},initialize:function(){var t=this.update||this.render;this.listenTo(this.model.get("properties"),"change",t),this.listenTo(this.model.get("properties"),"change",this.handle_visual_padding_hint),this.listenTo(this.model.get("properties"),"add",t),this.listenTo(this.model.get("properties"),"remove",t),this._prev_class=this.model.get_property_value_by_name("class"),this.listenTo(Upfront.Events,"layout:after_render",this.refresh_background),this.listenTo(Upfront.Events,"layout:after_render",this.update_size_hint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"command:module_group:finish_edit",this.on_finish),this.listenTo(Upfront.Events,"command:module_group:close_panel",this.closeControlPanel),this.listenTo(Upfront.Events,"upfront:element:edit:start",this.on_element_edit_start),this.listenTo(Upfront.Events,"upfront:element:edit:stop",this.on_element_edit_stop),this.editing=!1,this.hidden=!1,this.on("entity:resize_stop",this.on_resize,this)},handle_visual_padding_hint:function(t){if("undefined"!=typeof t){var e=t.get("value");t.id.match(/(top|bottom)_padding_(num|slider)/)&&(t.id.match(/top_padding_(num|slider)/)&&this.show_top_padding_hint(e,this.$el),t.id.match(/bottom_padding_(num|slider)/)&&this.show_bottom_padding_hint(e,this.$el))}},createPaddingControl:function(){return this.paddingControl=new Upfront.Views.Editor.InlinePanels.PaddingControl({model:this.model}),this.paddingControl.icon="padding",this.paddingControl.tooltip=e.padding_settings,this.paddingControl.default_padding.top=0,this.paddingControl.default_padding.bottom=0,this.paddingControl},onOpenPanelClick:function(t){t.preventDefault(),this.toggleLinkPanel()},onOpenItemControlsClick:function(){this.$el.hasClass("controls-visible")?this.closeControlPanel():this.openControlPanel()},openControlPanel:function(){this.$el.addClass("controls-visible"),this.controlsVisible=!0,this.disable_interaction(!1,!1,!1)},closeControlPanel:function(t){t=t!==!1,this.$el.removeClass("controls-visible"),this.controlsVisible=!1,t&&this.enable_interaction()},createInlineControlPanel:function(){var i=this.model.get_property_value_by_name("href");i||(i="");var n=this,o=new Upfront.Views.Editor.InlinePanels.ControlPanel,r=new Upfront.Views.Editor.InlinePanels.Controls.VisitLink({url:i,hideIfUnlink:!0,linkLabel:{external:e.visit_link}}),s=new Upfront.Views.Editor.InlinePanels.Controls.GroupLinkPanel({linkUrl:i,linkType:Upfront.Util.guessLinkType(i),linkTarget:this.model.get_property_value_by_name("linkTarget"),button:!1}),a=new Upfront.Views.Editor.InlinePanels.Control({label:e.ungroup,className:"upfront-inline-panel-item ungroup-control"}),l=new Upfront.Views.Editor.InlinePanels.Control({label:e.edit_elements,className:"upfront-inline-panel-item edit-elements-control"});this.listenTo(s,"change change:target",function(t){r.setLink(t.url),this.model.set_property("href",t.url),this.model.set_property("linkTarget",t.target)}),this.listenTo(s,"panel:open panel:close",function(){n.toggleLinkPanel()}),this.listenTo(s,"panel:close",function(){n.closeControlPanel()}),this.listenTo(a,"click",function(t){n.on_ungroup()}),this.listenTo(l,"click",function(t){n.closeControlPanel(!1),n.on_edit()}),o.items=_([s,r,l,a]);var p=t('<div class="upfront-module-group-controls upfront-ui"></div>');this.$el.append(p),o.render(),p.append(o.el),o.delegateEvents(),this.panel=o},toggleLinkPanel:function(){this.$el.toggleClass("control-dialog-open")},render:function(){var t=this,e={},i=(this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e.row?e.row*Upfront.Settings.LayoutEditor.Grid.baseline:0),n=_.extend(this.model.toJSON(),{properties:e,height:i,href:""}),o=_.template(s.module_group,n);Upfront.Events.trigger("entity:module_group:before_render",this,this.model);var r=this.model.get_property_value_by_name("anchor");r&&r.length&&(this.el.id=r);var a=this.model.get_breakpoint_property_value("theme_style",!0);a&&(this.$el.addClass(a.toLowerCase()),this._theme_style=a),this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update)),Upfront.Application.user_can_modify_layout()?this.$el.html(o+'<span class="open-item-controls"></span>'):this.$el.html(o),this.$bg=this.$el.find(".upfront-module-group-bg"),this.update();var l=this._modules_view||new T({model:this.model.get("modules")});l.region_view=this.region_view,l.group_view=this,this.$el.find("> .upfront-modules_container").append(l.el),l.render(),this.apply_paddings(this.$el.find("> .upfront-modules_container")),this._modules_view?this._modules_view.delegateEvents():this._modules_view=l,Upfront.Application.user_can_modify_layout()||this.$el.addClass("upfront-module-group-no-edit"),this.createInlineControlPanel(),this.create_size_hint(this.$el),this.$control_el=this.$el,this.updateControls(),this.toggleControls(),setTimeout(function(){t.paddingControl&&"undefined"!=typeof t.paddingControl.isOpen&&!t.paddingControl.isOpen&&t.paddingControl.refresh()},300),Upfront.Events.trigger("entity:module_group:after_render",this,this.model)},update:function(t){var e,i,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=this.model.get_property_value_by_name("class"),r=this.model.get_property_value_by_name("row"),s=this.model.get_breakpoint_property_value("use_padding",!0),a=this.model.get_breakpoint_property_value("theme_style",!0),l=Upfront.Settings.LayoutEditor.Grid,p=Upfront.Behaviors.GridEditor,d=p.get_class_num(o,l.class);return t&&"id"in t&&"wrapper_id"==t.id?void(this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update))):(Upfront.Application.layout_ready&&(e=!n||n.default?p.get_class_num(this._prev_class,l.class):this.$el.data("breakpoint_col"),i=!n||n.default?p.get_class_num(o,l.class):this.model.get_breakpoint_property_value("col")),this.$el.removeClass(this._prev_class).addClass(o),this.$el.data("default_col",d),this.$el.data("current_col",d),this._prev_class=o,a&&(this.$el.removeClass(this._theme_style).addClass(a.toLowerCase()),this._theme_style=a),this.$el.css("min-height",r*l.baseline+"px").attr("data-row",r),this.$bg.toggleClass("upfront-module-group-bg-padding",!!s),this.update_position(),Upfront.Application.layout_ready&&t&&("class"==t.id||"breakpoint"==t.id)&&e!=i&&this.normalize_child_modules(e),void Upfront.Events.trigger("entity:module_group:update",this,this.model))},update_position:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();Upfront.Settings.LayoutEditor.Grid;if(this.apply_paddings(this.$el.find("> .upfront-modules_container")),!t)return void this.update_background();var e=this.$el.find("> .upfront-module-hidden-toggle"),i=this.model.get_breakpoint_property_value("hide",!0);this.apply_breakpoint_position(this.$el,e,["hide"]),i?(this.hidden=!0,this.$el.addClass("upfront-module-group-hidden"),e.show(),this.disable_interaction(!0,!1,!1)):(this.hidden=!1,this.$el.removeClass("upfront-module-group-hidden"),e.hide(),this.enable_interaction(),this.model.get("modules").each(function(t){var e=!!Upfront.data.module_views&&Upfront.data.module_views[t.cid];e&&e.update_position()}));var n=this.model.get_breakpoint_property_value("theme_style",!0);this._theme_style&&this.$el.removeClass(this._theme_style.toLowerCase()),n&&(this.$el.addClass(n.toLowerCase()),this._theme_style=n),this.update_size_hint(),this.update_background(),this.trigger("update_position",this,this.model),Upfront.Events.trigger("entity:module_group:update_position",this,this.model)},normalize_child_modules:function(t){if(this._modules_view){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Behaviors.GridEditor,n=!e||e.default?i.get_class_num(this.$el,i.grid.class):this.$el.data("breakpoint_col");this._modules_view.normalize_child_modules(n,t,this.model.get("wrappers"))}},on_settings_click:function(t){"undefined"!=typeof t&&t.preventDefault();var i=Upfront.Views.Editor.BgSettings.GroupSettings.extend({bg_title:e.group_settings});Upfront.Events.trigger("element:settings:activate",this,i)},on_ungroup:function(){var t,e,i,n,o=this,r=Upfront.Behaviors.GridEditor,s=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),a=r.get_class_num(this.$el,r.grid.class),l=this.model.get_breakpoint_property_value("top_padding_use",!0),p=this.model.get_breakpoint_property_value("top_padding_num",!0),d=l&&p!==!1?p:0,c=this.$el.closest(".upfront-wrapper"),u=(Upfront.Util.find_sorted(c.parent(),"> .upfront-wrapper:visible"),
c.hasClass("clr")),h=this.model.get_wrapper_id(),f=this.model.get("modules"),g=this.model.get("wrappers"),m=this.region,v=this.region_view.model.get("modules"),b=this.region_view.model.get("wrappers"),y=b.get_by_wrapper_id(h),w=Upfront.data.wrapper_views[y.cid],k=v.indexOf(this.model),$=r.parse_modules_to_lines(v,b,s.id,s.columns),x=r.parse_modules_to_lines(f,g,s.id,a),U=f.map(function(t){return t}),E=[],S=0,C=[],T=!1,z=[],I=[],P=0,M=0;this.toggle_modules_interaction(!0,!0,!0),r.start(this,this.model),_.each($,function(r){t||(i=!1,n=!1,_.each(r.wrappers,function(s){e&&!n&&(n=s),_.each(s.modules,function(i){o.model==i.model&&(e=s,t=r)}),e||(i=s)}))}),t&&(_.each(t.wrappers,function(t){t.spacer&&E.push(t)}),(e.modules.length>1||t.wrappers.length-E.length>1)&&(T=!0,1==e.modules.length&&1==x.length&&(T=!1)),T&&1==e.modules.length&&(_.each(x,function(t,e){_.each(t.wrappers,function(e,i){0==i&&(e.spacer?z.push(e.col):z.push(0)),i==t.wrappers.length-1&&(e.spacer?I.push(e.col):I.push(0))})}),P=_.min(z),M=_.min(I)),_.each(x,function(t,e){_.each(t.wrappers,function(s,l){var p=Upfront.data.wrapper_views[s.model.cid],c=[],m=[];_.each(s.modules,function(t,s){var l=Upfront.data.module_views[t.model.cid],p=l.$el.find("> .upfront-editable_entity"),u=p.is(":visible"),f=t.model.get("objects").first(),_=a,g=!1;u?(T&&(t.spacer?g=!0:(P>0&&i&&i.spacer&&(_-=P),M>0&&n&&n.spacer&&(_-=M),r.update_model_margin_classes(p,[r.grid.class+_]),t.model.set_property("wrapper_id",h))),0!=e||0!=s||t.spacer||o._update_padding("top",f,d)):g=!0,delete l.group_view,g?c.push({model:t.model}):(m.push({model:t.model,index:k+S}),S++)}),T||(0==l&&(u?s.model.add_class("clr"):s.model.remove_class("clr"),i&&i.spacer&&(s.spacer?(s.modules[0].model.replace_class(r.grid.class+(s.col+i.col)),s.model.replace_class(r.grid.class+(s.col+i.col))):C.push({view:p,position:"left",col:i.col,wrapper_col:s.col+i.col}))),l==t.wrappers.length-1&&n&&n.spacer&&(s.spacer?(s.modules[0].model.replace_class(r.grid.class+(s.col+n.col)),s.model.replace_class(r.grid.class+(s.col+n.col))):C.push({view:p,position:"right",col:n.col,wrapper_col:s.col+n.col}))),_.each(c,function(t){f.remove(t.model)}),g.remove(s.model,{silent:!0}),m.length>0&&(T||b.add(s.model,{silent:!0}),_.each(m,function(t){f.remove(t.model,{silent:!0}),t.model.add_to(v,t.index,{update:!1})}))})}),T?(P>0&&(i&&i.spacer?(i.modules[0].model.replace_class(r.grid.class+(i.col+P)),i.model.replace_class(r.grid.class+(i.col+P))):w.add_spacer("left",P,a)),M>0&&(n&&n.spacer?(n.modules[0].model.replace_class(r.grid.class+(n.col+M)),n.model.replace_class(r.grid.class+(n.col+M))):w.add_spacer("right",M,a-P))):(i&&i.spacer&&(b.remove(i.model),v.remove(i.modules[0].model,{update:!1})),n&&n.spacer&&(b.remove(n.model),v.remove(n.modules[0].model,{update:!1})),_.each(C,function(t){t.view.add_spacer(t.position,t.col,t.wrapper_col)}),b.remove(y)),v.remove(this.model),r.update_position_data(c.closest(".upfront-editable_entities_container")),r.update_wrappers(m),Upfront.Events.trigger("entity:module_group:ungroup",U,m))},_update_padding:function(t,e,i){var n=(e.get_breakpoint_property_value(t+"_padding_use",!0),e.get_breakpoint_property_value(t+"_padding_num",!0)),o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().get("column_padding");0!==i&&(e.set_breakpoint_property(t+"_padding_use","yes"),n!==!1?e.set_breakpoint_property(t+"_padding_num",parseInt(n,10)+parseInt(i,10)):e.set_breakpoint_property(t+"_padding_num",parseInt(o,10)+parseInt(i,10)))},on_reorder:function(){Upfront.Events.trigger("command:module_group:finish_edit"),Upfront.Events.trigger("command:object_group:finish_edit");var e=t(Upfront.Settings.LayoutEditor.Selectors.main);e.addClass("upfront-module-group-editing"),this.$el.addClass("upfront-module-group-on-edit"),this.editing=!0,this.disable_interaction(!1,!1),this.toggle_modules_interaction(!0,!1),Upfront.Events.trigger("entity:module_group:edit",this,this.model)},on_edit:function(){if(!Upfront.Application.user_can_modify_layout())return!1;Upfront.Events.trigger("command:module_group:finish_edit"),Upfront.Events.trigger("command:object_group:finish_edit");var e=t(Upfront.Settings.LayoutEditor.Selectors.main);e.addClass("upfront-module-group-editing"),this.wrapper_view&&this.wrapper_view.$el.addClass("upfront-wrapper-module-group-on-edit"),this.$el.addClass("upfront-module-group-on-edit"),this.trigger("deactivated"),this.editing=!0,this.disable_interaction(!1,!1,!1),this.toggle_modules_interaction(!0,!0),Upfront.Events.trigger("entity:module_group:edit",this,this.model)},on_finish:function(){if(this.editing){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);e.removeClass("upfront-module-group-editing"),this.wrapper_view&&this.wrapper_view.$el.removeClass("upfront-wrapper-module-group-on-edit"),this.$el.removeClass("upfront-module-group-on-edit"),this.editing=!1,this.enable_interaction(),this.toggle_modules_interaction(!1)}},on_resize:function(t){var e=this.model.get("wrappers");e.each(function(t){var e=Upfront.data.wrapper_views[t.cid];e&&e.update_position()}),this.update_size_hint()},on_dblclick:function(e){var i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();return""===t("#element-settings-sidebar").html()&&""===t("#settings").html()&&void(this.$el.hasClass("upfront-module-group-on-edit")||this.$el.hasClass("upfront-module-group-disabled")||this.wrapper_view&&this.wrapper_view.$el.hasClass("upfront-inline-panel-item-open")||(this.closeControlPanel(!1),!i||i.default?this.on_edit():this.on_reorder()))},on_hide_click:function(t){g.prototype.on_hide_click.call(this,t),this.closeControlPanel(!1),this.deactivate(),t.stopPropagation(),Upfront.Events.trigger("entity:module_group:hide_toggle",this,this.model)},on_element_edit_start:function(t,e){"write"==t&&(this.$el.addClass("upfront-module-group-element-editing"),this.disable_interaction(!0,!1,!1))},on_element_edit_stop:function(t,e,i){"write"==t&&i!==!0&&(this.$el.removeClass("upfront-module-group-element-editing"),this.enable_interaction())},disable_interaction:function(t,e,i){t&&this.$el.addClass("upfront-module-group-disabled"),!e&&this.$el.data("ui-resizable")&&this.$el.resizable("option","disabled",!0),!i&&this.$el.data("ui-draggable")&&this.$el.draggable("option","disabled",!0)},enable_interaction:function(){this.editing||this.hidden||(this.$el.removeClass("upfront-module-group-disabled"),this.$el.data("ui-resizable")&&this.$el.resizable("option","disabled",!1),this.$el.data("ui-draggable")&&this.$el.draggable("option","disabled",!1))},toggle_modules_interaction:function(t,e,i){e=e===!0,i=i===!0,this.model.get("modules").each(function(n){var o=!!Upfront.data.module_views&&Upfront.data.module_views[n.cid];o&&(t?(o.enable_interaction(!0),i||o.disable_interaction(!e,!1,!0,!0,!e)):o.disable_interaction(!0,!1,!1,!1,!0))})},on_wrapper_update:function(t,e){this.wrapper_view&&t!=this.wrapper_view||this.update_position()},on_change_breakpoint:function(t){var e=this.$el.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger"),i=this.$el.find("> .upfront-entity_meta > a.upfront-entity-delete_trigger");t.default?(this.$el.removeClass("upfront-module-group-reorder-mode"),e.hide(),i.show()):(this.$el.addClass("upfront-module-group-reorder-mode"),e.show(),i.hide()),this.on_finish()},on_grid_update:function(){this.update_background()},deactivate:function(){return""===t("#element-settings-sidebar").html()&&""===t("#settings").html()&&(Upfront.data.prevEntity=!1,this.$el.closest(".upfront-region-container").removeClass("upfront-region-module-activated"),this.$el.removeClass("upfront-module-group-active"),this.check_deactivated(),void this.trigger("upfront:entity:deactivate",this))},activate:function(){var e=Upfront.data.currentEntity;return!!Upfront.Application.user_can_modify_layout()&&(!this.hidden&&("undefined"!=typeof Upfront.data.prevEntity&&Upfront.data.prevEntity!==!1&&Upfront.data.prevEntity.deactivate(),Upfront.data.prevEntity=this,!(this.activate_condition&&!this.activate_condition())&&(!this.$el.hasClass("upfront-module-group-element-editing")&&((!e||e!=this)&&(e&&e!=this&&e.trigger("deactivated"),Upfront.data.currentEntity=this,this.trigger("activated",this),this.trigger("upfront:entity:activate",this),this.listenToOnce(this,"deactivated",this.deactivate),t(".upfront-region-module-activated").removeClass(".upfront-region-module-activated"),this.$el.closest(".upfront-region-container").addClass("upfront-region-module-activated"),void this.$el.addClass("upfront-module-group-active"))))))},remove:function(){this._modules_view&&this._modules_view.remove();var t=this.model.get("wrappers");t&&t.each(function(t){var e=Upfront.data.wrapper_views[t.cid];e&&(e.remove(),delete Upfront.data.wrapper_views[t.cid])}),this.panel&&(this.panel.remove(),this.panel=!1),this.region_view=!1,this.region=!1,Backbone.View.prototype.remove.call(this),this.model.get("wrappers").reset([],{silent:!0}),this.model=!1}}),T=b.extend({className:"upfront-editable_entities_container",init:function(){this.stopListening(this.model,"add",this.render),this.listenTo(this.model,"add",this.on_add),this.stopListening(this.model,"remove",this.render),this.listenTo(this.model,"remove",this.on_remove),this.listenTo(this.model,"reset",this.on_reset),this.listenTo(Upfront.Events,"entity:drag_stop",this.on_drop),this.listenTo(Upfront.Events,"entity:resized",this.on_resize),this.listenTo(Upfront.Events,"entity:wrapper:resized",this.on_wrapper_resize),this.listenTo(Upfront.Events,"entity:wrappers:update",this.on_wrappers_update),this.listenTo(Upfront.Events,"entity:module:hide_toggle",this.on_module_hide),this.listenTo(Upfront.Events,"entity:module_group:hide_toggle",this.on_module_hide),this.listenTo(Upfront.Events,"entity:object:refresh",this.on_object_refresh),this.listenTo(Upfront.Events,"entity:object:update",this.on_object_refresh),this.listenTo(Upfront.Events,"entity:module_group:update",this.on_module_refresh),this.listenTo(Upfront.Events,"entity:module_group:group",this.on_group),this.listenTo(Upfront.Events,"entity:module_group:ungroup",this.on_ungroup),this.listenTo(Upfront.Events,"layout:after_render",this.on_after_layout_render),this.listenTo(Upfront.Events,"layout:after_render:finish",this.on_after_layout_render_finish),this.listenTo(Upfront.Events,"upfront:csseditor:ready",this.on_csseditor_ready),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:after",this.on_change_breakpoint_after),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"upfront:grid:updated:after",this.on_grid_update_after),this.lazy_apply_wrapper_height=_.debounce(this.apply_wrapper_height,1e3)},on_entity_remove:function(t,e){Upfront.Events.trigger("entity:removed:before");var i=e.model.get_wrapper_id();if(i){var n=!_.isUndefined(this.group_view),o=n?this.group_view.model.get("wrappers"):this.region_view.model.get("wrappers"),r=o.get_by_wrapper_id(i),s=0;r&&(this.model.each(function(t){t.get_wrapper_id()==i&&s++}),1==s&&(Upfront.Behaviors.GridEditor.normalize_module_remove(e,e.model,this.model,r,o),o.remove(r)))}this.model.remove(e.model),this.normalize_child_spacing(),Upfront.Events.trigger("entity:removed:after")},render:function(){this.$el.html("");var t=(this.$el,this);this.current_wrapper_view=null,this.current_wrapper_id=null,this.current_wrapper_el=null,Upfront.Events.trigger("entity:modules:before_render",this,this.model),"undefined"==typeof Upfront.data.module_views&&(Upfront.data.module_views={}),"undefined"==typeof Upfront.data.wrapper_views&&(Upfront.data.wrapper_views={}),Upfront.Application.layout_ready?(this.model.each(function(e){t.render_module(e)}),t.apply_flexbox_clear(),t.lazy_apply_wrapper_height()):(this.model.each(function(e){i.add(function(){t.render_module(e)})}),i.addToEnd(function(){t.apply_flexbox_clear(),t.lazy_apply_wrapper_height(),Upfront.Events.trigger("entity:modules:after_render",t,t.model)}))},render_module:function(e,i){var n,o,r=this.$el,s=i&&"undefined"!=typeof i.index?i.index-1:-2,a=s>=0&&r.find("> .upfront-wrapper > .upfront-module-view, > .upfront-wrapper > .upfront-module-group").eq(s),l=e.get("modules")?"ModuleGroup":"Module",p=e.get("properties").where({name:"view_class"}),d=p.length?p[0].get("value"):l,c=!!Upfront.Views[d]&&(Upfront.data.module_views[e.cid]||new Upfront.Views[d]({model:e})),u=("undefined"!=typeof this.group_view?this.group_view:this.region_view).model.get("wrappers"),h=e.get_wrapper_id(),f=!(!u||!h)&&u.get_by_wrapper_id(h);c&&(c.parent_view=this,c.region_view=this.region_view,c.region=this.region_view.model,this.group_view&&(c.group_view=this.group_view),f?(this.current_wrapper_id==h?o=this.current_wrapper_el:(n=Upfront.data.wrapper_views[f.cid],n?n.parent_view=this:(n=new Upfront.Views.Wrapper({model:f}),n.parent_view=this,n.render()),o=n.el,this.current_wrapper_view=n),this.current_wrapper_id=h,this.current_wrapper_el=o,this.current_wrapper_view&&(c.wrapper_view=this.current_wrapper_view),n&&(s===-2?r.append(o):s===-1?r.prepend(o):a.closest(".upfront-wrapper").after(o),Upfront.data.wrapper_views[f.cid]||(Upfront.data.wrapper_views[f.cid]=n)),a!==!1?a.closest(".upfront-wrapper").get(0)==o?a.after(c.el):t(o).prepend(c.el):s===-1?t(o).prepend(c.el):t(o).append(c.el),c.render()):(c.render(),s===-2?r.append(c.el):s===-1?r.prepend(c.el):a.parent().after(c.el)),Upfront.data.module_views[e.cid]?c.delegateEvents():(this.listenTo(c,"upfront:entity:activate",this.on_activate),this.listenTo(c.model,"remove",this.deactivate),Upfront.data.module_views[e.cid]=c)),Upfront.Events.trigger("entity:modules:render_module",c,c.model,this,this.model)},on_wrappers_update:function(t){_.isObject(t)&&t.get("modules")!=this.model||(this.model.each(function(t){var e=Upfront.data.module_views[t.cid];e&&e.update_position()}),this.apply_flexbox_clear(),this.lazy_apply_wrapper_height())},on_drop:function(t,e){t.parent_view&&t.parent_view!=this||(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_resize:function(t,e){t.parent_view&&t.parent_view!=this||(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_wrapper_resize:function(t,e){t.parent_view&&t.parent_view!=this||(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_module_hide:function(t,e){t.parent_view&&t.parent_view!=this||(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_object_refresh:function(t){t.parent_module_view&&(t.parent_module_view.parent_view&&t.parent_module_view.parent_view!=this||this.lazy_apply_wrapper_height())},on_module_refresh:function(t){t.parent_view&&t.parent_view==this&&this.lazy_apply_wrapper_height()},on_add:function(t,e,i){var n="undefined"==typeof i.update||i.update;this.current_wrapper_id=this.current_wrapper_el=null,this.render_module(t,i),n&&(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints()),Upfront.Events.trigger("entity:added:after")},on_remove:function(t,e,i){var n="undefined"==typeof i.update||i.update;this.remove_model(t),n&&(this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},remove_model:function(t){var e=Upfront.data.module_views[t.cid];e&&(e.unbind(),e.remove(),delete Upfront.data.module_views[t.cid])},on_reset:function(t,e){var i=this;e&&e.call_render&&(_.each(e.call_render,function(e){var n=t.indexOf(e);i.render_module(e,{index:n})}),this.apply_flexbox_clear(),this.lazy_apply_wrapper_height(),this.apply_adapt_to_breakpoints())},on_after_layout_render:function(){this.apply_flexbox_clear(),this.apply_adapt_to_breakpoints(),this.normalize_child_spacing()},on_after_layout_render_finish:function(){this.lazy_apply_wrapper_height()},on_csseditor_ready:function(){},apply_flexbox_clear:function(){this.fix_flexbox_clear(this.$el)},apply_wrapper_height:function(){if(Upfront.Application.layout_ready&&this.region_view&&"shadow"!=this.region_view.model.get("name")){var t=Upfront.Behaviors.GridEditor,e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=!_.isUndefined(this.group_view),n=(i?this.group_view:this.region_view).model.get("wrappers"),o=e.default?t.get_class_num((i?this.group_view:this.region_view).$el,t.grid.class):(i?this.group_view:this.region_view).model.get_breakpoint_property_value("col");this.model.each(function(t){var e=Upfront.data.module_views[t.cid];e&&e._modules_view&&e._modules_view.apply_wrapper_height()}),this.fix_wrapper_height(this.model,n,o)}},apply_adapt_to_breakpoints:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if((!t||t.default)&&(!this.region_view||"shadow"!=this.region_view.model.get("name"))){var e=this,i=Upfront.Behaviors.GridEditor,n="undefined"!=typeof this.group_view,o=(n?this.group_view:this.region_view).model.get("wrappers"),r=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(r,function(t){var r=t.toJSON();if(!r.default){if(n){var s=i.get_class_num(e.group_view.$el,i.grid.class),a=e.group_view.model.get_property_value_by_name("breakpoint");_.isObject(a)&&_.isObject(a[r.id])&&!_.isUndefined(a[r.id].col)&&(s=a[r.id].col)}var l=n?s:r.columns;i.adapt_to_breakpoint(e.model,o,r.id,l,!0)}})}},on_group:function(t){"undefined"!=typeof this.group_view&&t.cid==this.group_view.model.cid&&this.reset_breakpoints(this.model.map(function(t){return t}))},on_ungroup:function(t){t&&t[0]&&!this.model.find(function(e){return e.cid==t[0].cid})||this.reset_breakpoints(t)},reset_breakpoints:function(t){_.each(t,function(t){var e=Upfront.Util.clone(t.get_property_value_by_name("breakpoint")||{});_.each(e,function(t,i){e[i].edited=!1}),t.set_property("breakpoint",e,!0)}),this.apply_adapt_to_breakpoints()},on_change_breakpoint:function(t){},on_change_breakpoint_after:function(t){this.apply_flexbox_clear(),this.lazy_apply_wrapper_height()},on_grid_update:function(){},on_grid_update_after:function(){this.apply_flexbox_clear(),this.lazy_apply_wrapper_height()},remove:function(){var t=this;this.model.each(function(e){t.remove_model(e)}),this.region_view=!1,this.group_view=!1,Backbone.View.prototype.remove.call(this),this.model.reset([],{silent:!0}),this.model=!1}}),z=f.extend({cssSelectors:{".upfront-region-container-bg":{label:e.region_container_label,info:e.region_container_info},".upfront-region-center":{label:e.main_content_label,info:e.main_content_info},".upfront-region-side-left":{label:e.lsr_label,info:e.lsr_info},".upfront-region-side-right":{label:e.rsr_label,info:e.rsr_info}},events:{"click > .upfront-region-edit-trigger":"trigger_edit","click > .upfront-region-edit-fixed-trigger":"trigger_edit_fixed","click > .upfront-region-finish-edit":"finish_edit",contextmenu:"on_context_menu",mouseover:"on_mouse_over"},attributes:function(){var t=(this.model.get("container")||this.model.get("name")).toLowerCase().replace(/\s/g,"-"),e=[];return e.push("upfront-region-container"),e.push("upfront-region-container-"+t),e.push("upfront-region-container-"+this._get_region_type()),_.isObject(this.model.collection)&&this.model.collection.active_region==this.model&&e.push("upfront-region-container-active"),{class:e.join(" "),id:"region-container-"+t}},_get_region_type:function(){return this.model.get("type")||(this.model.get("clip")?"clip":"wide")},_get_previous_region_type:function(){return this.model.previous("type")||(this.model.previous("clip")?"clip":"wide")},on_mouse_over:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);e.hasClass("upfront-region-fixed-editing")&&this.trigger("activate_region",this)},remove_context_menu:function(e){return!!this.context_menu_view&&(t(Upfront.Settings.LayoutEditor.Selectors.contextmenu).html("").hide(),void(this.context_menu_view=!1))},on_context_menu:function(e){if(t(e.target).closest(".upfront-inline-modal-content").length>0)return void e.stopPropagation();if(!Upfront.Settings.Application.no_context_menu){if(e.preventDefault(),this.event=e,this.context_menu_view)return this.context_menu_view.render();var i=new this.ContextMenu({model:this.model,el:t(Upfront.Settings.LayoutEditor.Selectors.contextmenu)});return i.for_view=this,this.context_menu_view=i,this.context_menu_view.render()}},init:function(){var i=this,n=Upfront.Views.ContextMenuList.extend({initialize:function(){this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){var i=t(Upfront.Settings.LayoutEditor.Selectors.main);return i.hasClass("upfront-region-editing")?e.finish_editing:e.edit_background},action:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);e.hasClass("upfront-region-editing")?i.close_edit():i.trigger_edit(i.event)}}),new Upfront.Views.ContextMenuItem({get_label:function(){return e.add_floating_region},action:function(e,n){function o(t,e){var i="animationend.fixed_region_ani webkitAnimationEnd.fixed_region_ani MSAnimationEnd.fixed_region_ani oAnimationEnd.fixed_region_ani";s=setTimeout(r,2e3),t.$el.addClass("upfront-add-region-ani upfront-add-region-ani-"+d+"-"+p),t.$el.one(i,function(){r(t),clearTimeout(s),t.$el.off(i)})}function r(t){t.$el.removeClass("upfront-add-region-ani upfront-add-region-ani-"+d+"-"+p),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0)}var s,a,l,p,d,c=t(Upfront.Settings.LayoutEditor.Selectors.main),u=i.model.collection,h=u.indexOf(i.model),f=i.model.get_sub_region("fixed"),g=i.model.get("title")+" Floating "+(f.length+1),m=g.toLowerCase().replace(/\s/g,"-"),v=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:m,container:i.model.get("name"),title:g,type:"fixed",sub:"fixed",scope:i.model.get("scope")})),b=i.$el.offset(),y=i.$el.width(),w=i.$el.height(),k=t(window).height(),$=225,x=225;v.set_property("width",$),v.set_property("height",x),n.pageX>b.left+y/2?(a=b.left+y-n.pageX-Math.floor($/2),p="right"):(a=n.pageX-b.left-Math.floor($/2),p="left"),w>=k&&n.clientY>k/2?(l=k-n.clientY-Math.floor(x/2),d="bottom"):(l=n.clientY-Math.floor(x/2),d="top"),a=a>0?a:0,l=l>0?l:0,v.set_property(p,a),v.set_property(d,l),v.set_property("background_type","color"),v.set_property("background_color","#aeb8c2"),Upfront.Events.once("entity:region:added",o,this),v.add_to(u,h+1,{sub:"fixed"}),c.hasClass("upfront-region-fixed-editing")||i.trigger_edit_fixed(i.event)}})])}});this.ContextMenu=Upfront.Views.ContextMenu.extend({initialize:function(){this.menulists=_([new n])}});var o=Upfront.Settings.LayoutEditor.Grid,r=this.model.get_property_value_by_name("width");this.sub_model=[],this.max_col=r?Upfront.Util.width_to_col(r):o.size,this.available_col=this.max_col,this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(Upfront.Events,"entity:region:activated",this.update_pos),this.listenTo(Upfront.Events,"entity:region:activated",this.update_overlay),this.listenTo(Upfront.Events,"entity:region:deactivated",this.close_edit),this.listenTo(Upfront.Events,"layout:after_render",this.fix_height),this.listenTo(Upfront.Events,"entity:resize_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.update_overlay),this.listenTo(Upfront.Events,"entity:drag_stop",this.fix_height),this.listenTo(Upfront.Events,"entity:drag:drop_change",this.refresh_background),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_open",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_close",this.refresh_background),this.listenTo(Upfront.Events,"entity:region:added",this.fix_height),this.listenTo(Upfront.Events,"entity:region:removed",this.on_region_remove),this.listenTo(Upfront.Events,"entity:region:hide_toggle",this.on_region_hide),this.listenTo(Upfront.Events,"entity:module_group:group",this.fix_height),this.listenTo(Upfront.Events,"entity:module_group:ungroup",this.fix_height),this.listenTo(Upfront.Events,"upfront:layout:contained_region_width",this.on_contained_width_change),this.listenTo(Upfront.Events,"layout:after_render",this.update_pos),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_pos),this.listenTo(Upfront.Events,"application:mode:after_switch",this.update_pos),t(window).on("scroll.region_container_"+this.model.get("name"),this,this.on_scroll),t(window).on("resize.region_container_"+this.model.get("name"),this,this.on_window_resize),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:after",this.on_change_breakpoint_after),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"upfront:grid:updated:after",this.on_grid_update_after),this.listenTo(Upfront.Events,"entity:contextmenu:deactivate",this.remove_context_menu),this.lazyFixHeight=_.debounce(this.fix_height,1e3)},render:function(){var i=Upfront.Settings.LayoutEditor.Grid,n=(this._get_region_type(),_.extend(this.model.toJSON(),{size_class:i.class,max_col:this.max_col,available_col:this.available_col})),o=_.template(s.region_container,n),r=t('<div class="upfront-region-edit-trigger upfront-ui" title="'+e.change_background+'"><i class="upfront-icon upfront-icon-region-edit"></i></div>'),a=t('<div class="upfront-region-finish-edit upfront-ui"><i class="upfront-field-icon upfront-field-icon-tick"></i> '+e.finish_edit_bg+"</div>");Upfront.Events.trigger("entity:region_container:before_render",this,this.model),this.$el.html(o),this.$bg=this.$el.find(".upfront-region-container-bg"),this.$layout=this.$el.find(".upfront-grid-layout"),r.appendTo(this.$el),a.appendTo(this.$el),this.update(),this.$el.append('<div class="upfront-region-active-overlay" />'),Upfront.Events.trigger("entity:region_container:after_render",this,this.model)},update:function(){var t=this,e=Upfront.Settings.LayoutEditor.Grid,i=(this.model.get("container")||this.model.get("name")).toLowerCase().replace(/\s/g,"-"),n=(this.model.previous("container")||this.model.previous("name")).toLowerCase().replace(/\s/g,"-"),o=(this.model.get_property_value_by_name("expand_lock"),this._get_region_type()),r=this._get_previous_region_type(),s=Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON(),a=s.columns*e.column_width,l=Upfront.Application.layout.get_property_value_by_name("contained_region_width")||a;"clip"==o?this.$bg.css("max-width",(l>a?l:a)+"px"):this.$bg.css("max-width",""),this.update_background(),r!=o&&(this.$el.removeClass("upfront-region-container-"+r),this.$el.addClass("upfront-region-container-"+o),_.delay(function(){t.fix_height(),t.update_overlay()},500)),n!=i&&(this.$el.removeClass("upfront-region-container-"+n),this.$el.addClass("upfront-region-container-"+i),this.$el.attr("id","region-container-"+i))},render_fixed_panel:function(){this.region_fixed_panels=new Upfront.Views.Editor.RegionFixedPanels({model:this.model}),this.region_fixed_panels.render(),this.$el.append(this.region_fixed_panels.el)},on_change_breakpoint:function(t){var e=Upfront.Settings.LayoutEditor.Grid;this.$layout.removeClass(e.class+this.max_col),this.max_col=t.columns,this.$layout.addClass(e.class+this.max_col)},on_change_breakpoint_after:function(t){this.update_background(),this.fix_height()},on_grid_update:function(){},on_grid_update_after:function(){this.update(),this.fix_height()},on_contained_width_change:function(t){var e=this._get_region_type();"clip"==e?this.$bg.css("max-width",t+"px"):this.$bg.css("max-width",""),this.refresh_background()},trigger_edit:function(e){if(Upfront.Application.get_current()==Upfront.Settings.Application.MODE.CONTENT)return!1;var i=t(Upfront.Settings.LayoutEditor.Selectors.main);i.addClass("upfront-region-editing"),this.update_overlay(),Upfront.Events.trigger("command:region:edit_toggle",!0),this.trigger("activate_region",this),this.listenTo(Upfront.Events,"command:newpage:start",this.close_edit),this.listenTo(Upfront.Events,"command:newpost:start",this.close_edit),this.$el.find(".upfront-region-edit-fixed-trigger").show()},finish_edit:function(t){Upfront.Events.trigger("entity:region:deactivated")},close_edit:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);(e.hasClass("upfront-region-editing")||e.hasClass("upfront-region-fixed-editing")||e.hasClass("upfront-region-lightbox-editing"))&&(e.removeClass("upfront-region-editing"),e.removeClass("upfront-region-fixed-editing"),e.removeClass("upfront-region-lightbox-editing"),this.remove_overlay(),Upfront.Events.trigger("command:region:edit_toggle",!1),Upfront.Events.trigger("command:region:fixed_edit_toggle",!1),Upfront.Events.off("command:newpage:start",this.close_edit,this),Upfront.Events.off("command:newpost:start",this.close_edit,this),this.$el.find(".upfront-region-edit-fixed-trigger").hide(),this.$el.find(".upfront-region-edit-lightbox-trigger").hide(),Upfront.Application.sidebar.visible||Upfront.Application.sidebar.toggleSidebar(),t(".upfront-region-container > .upfront-region-finish-edit").css({position:"",left:"",right:""}))},trigger_edit_lightbox:function(e){if(Upfront.Application.get_current()==Upfront.Settings.Application.MODE.CONTENT)return!1;var i=this,n=t(Upfront.Settings.LayoutEditor.Selectors.main);n.hasClass("upfront-region-editing")&&this.close_edit(),n.addClass("upfront-region-lightbox-editing"),this.trigger("activate_region",this),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0),setTimeout(function(){t(".upfront-region-container > .upfront-region-finish-edit").each(function(){t(this).css({position:"fixed",left:i.$layout.offset().left+i.$layout.width()-t(this).width(),right:"auto"})})},350)},trigger_edit_fixed:function(){if(Upfront.Application.get_current()==Upfront.Settings.Application.MODE.CONTENT)return!1;var e=this,i=t(Upfront.Settings.LayoutEditor.Selectors.main);i.hasClass("upfront-region-editing")&&this.close_edit(),i.addClass("upfront-region-fixed-editing"),this.trigger("activate_region",this),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0),Upfront.Application.sidebar.visible&&Upfront.Application.sidebar.toggleSidebar(),setTimeout(function(){t(".upfront-region-container > .upfront-region-finish-edit").each(function(){t(this).css({position:"fixed",left:e.$layout.offset().left+e.$layout.width()-t(this).width(),right:"auto"})})},350)},update_overlay:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main),i=this.$el.position(),n=t('<div class="upfront-region-editing-overlay" />'),o=t('<div class="upfront-region-editing-overlay" />');e.hasClass("upfront-region-editing")&&this.parent_view.model.active_region==this.model&&(this.$el.siblings(".upfront-region-editing-overlay").remove(),this.$el.before(n),n.css({bottom:"auto",height:i.top}),this.$el.after(o),o.css({top:i.top+this.$el.height()}))},remove_overlay:function(){this.$el.siblings(".upfront-region-editing-overlay").remove()},add_sub_model:function(t){this.sub_model.push(t)},on_scroll:function(t){var e=t.data;e.update_pos()},on_region_render:function(t){},on_region_update:function(t){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=this.max_col;_.each(this.sub_model,function(t){var e=t.get("sub");e&&"left"!=e&&"right"!=e||(i-=t.get_property_value_by_name("col"))}),e&&!e.default||(this.trigger("region_resize",i),this.available_col=i),this.fix_height(),this.update_overlay()},on_region_changed:function(){this.fix_height()},on_region_remove:function(t,e){var i=e.get("sub");this.fix_height(),i&&i.match(/(top|bottom|left|right)/)||this.close_edit()},on_region_hide:function(t,e){var i=e.parent_view.get_container_view(e.model);this==i&&t&&0==this.$el.find(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right").not(".upfront-region-hidden").length&&this.close_edit();
},on_window_resize:function(t){if(t.target==window&&t.data.model){var e=t.data;e.lazyFixHeight()}},fix_height:function(){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if(e&&!e.default||this.$layout.css("display").indexOf("flex")!=-1)return this.set_full_screen(),this.refresh_background(),void this.update_pos();var i=this.$el.find(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right"),n=this.$el.find(".upfront-region-side-top, .upfront-region-side-bottom"),o=i.find("> .upfront-region-wrapper > .upfront-modules_container"),r=0;i.add(o).css({minHeight:"",height:"",maxHeight:""}),this.set_full_screen(),n.each(function(){t(this).find("> .upfront-region-wrapper > .upfront-modules_container").css("min-height",t(this).outerHeight())}),i.each(function(){var e=t(this).outerHeight();r=e>r?e:r}),i.add(o).css("min-height",r),this.refresh_background(),this.update_pos()},set_full_screen:function(){var e=this.$layout.find(".upfront-region-center"),i=this.$bg.find(".upfront-region-side-top, .upfront-region-side-bottom"),n=this.model.get_breakpoint_property_value("row",!0),o=n?n*Upfront.Settings.LayoutEditor.Grid.baseline:0,r=t(window).height();"full"==this._get_region_type()?(this.$bg.children(".upfront-region-bg-overlay").css("height",r),i.each(function(){r-=t(this).outerHeight()}),e.css({minHeight:r}),this.model.set_property("original_height",r,!0)):(this.$bg.children(".upfront-region-bg-overlay").css("height",""),e.css({minHeight:""}),o>0&&e.css("min-height",o),this.model.remove_property("original_height",!0))},update_pos:function(){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=t(Upfront.Settings.LayoutEditor.Selectors.main),n=this.$el.offset(),o=n.top,r=this.$el.outerHeight(),s=o+r,a=t(document).scrollTop(),l=t(window).height(),p=a+l,d=i.offset(),c=d.top,u=this.$el.find("> .upfront-region-edit-trigger"),h=u.offset(),f=this.model.get("sticky"),g=this.$el.data("sticky-top");if(a=a<0?0:a,e&&!e.default&&(f=!1),f&&!_.isNumber(g)&&a>o-c&&(this.$el.css({position:"fixed",top:c,left:d.left,right:0,bottom:"auto"}),this.$el.addClass("upfront-region-container-sticky"),this.$el.data("sticky-top",o-c),this.$el.nextAll(".upfront-region-container:first").css("margin-top",this.$el.height())),"fixed"==this.$el.css("position")&&(!f||_.isNumber(g)&&a<=g)&&(this.$el.css({position:"",top:"",left:"",right:"",bottom:""}),this.$el.removeClass("upfront-region-container-sticky"),this.$el.removeData("sticky-top"),this.$el.nextAll(".upfront-region-container:first").css("margin-top","")),"full"==this._get_region_type()){this.model.get_breakpoint_property_value("background_type",!0),parseInt(this.$layout.find(".upfront-region-center").css("min-height"),10);a>=o-c&&p<=s?this.$bg.children(".upfront-region-bg-overlay").css("top",a-c):this.$bg.children(".upfront-region-bg-overlay").css("top",r-l)}if(u.length>0&&(a>o-c&&a<s-c?"fixed"!=u.css("position")&&u.css({position:"fixed",top:c,left:h.left,right:"auto"}):u.css({position:"",top:"",left:"",right:""})),i.hasClass("upfront-region-editing")&&this.$el.hasClass("upfront-region-container-active")){var m=this.$el.find(".upfront-region-finish-edit"),v=m.offset();s+m.outerHeight()>p&&o<p?"fixed"!=m.css("position")&&m.css({position:"fixed",bottom:0,left:v.left,right:"auto"}):m.css({position:"",bottom:"",left:"",right:""})}},remove:function(){t(window).off("scroll.region_container_"+this.model.get("name")),t(window).off("resize.region_container_"+this.model.get("name")),this.context_menu_view&&this.context_menu_view.remove(),this.parent_view=!1,this.event=!1,Backbone.View.prototype.remove.call(this)}}),I=f.extend({attributes:function(){var t=this.model.get("container")||this.model.get("name"),e=this.model.get("sub"),i=[];return i.push("upfront-region-sub-container"),i.push("upfront-region-sub-container-"+t.toLowerCase().replace(/ /,"-")),i.push("upfront-region-sub-container-"+e),{class:i.join(" ")}},init:function(){this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(Upfront.Events,"layout:after_render",this.refresh_background),this.listenTo(Upfront.Events,"entity:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.update_pos),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag:drop_change",this.refresh_background),this.listenTo(Upfront.Events,"layout:after_render",this.update_pos),this.listenTo(Upfront.Events,"entity:region:added",this.update_pos),this.listenTo(Upfront.Events,"entity:region:removed",this.update_pos),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_pos),this.listenTo(Upfront.Events,"application:mode:after_switch",this.update_pos),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),t(window).on("scroll.region_subcontainer_"+this.model.get("name"),this,this.on_scroll),t(window).on("resize.region_subcontainer_"+this.model.get("name"),this,this.on_window_resize)},_get_region_type:function(){return this.model.get("type")||(this.model.get("clip")?"clip":"wide")},render:function(){var t=Upfront.Settings.LayoutEditor.Grid,e=this.parent_view.get_container_view(this.model),i=_.extend(this.model.toJSON(),{size_class:t.class,max_col:e.max_col,available_col:e.available_col}),n=_.template(s.region_container,i);Upfront.Events.trigger("entity:region_sub_container:before_render",this,this.model),this.$el.html(n),this.$layout=this.$el.find(".upfront-grid-layout"),this.update(),Upfront.Events.trigger("entity:region_sub_container:after_render",this,this.model)},update:function(){var t=this.parent_view.get_container_view(this.model);t&&"full"==t._get_region_type()?(this.update_background(),this.$el.show()):this.$el.hide(),this.update_pos()},on_scroll:function(t){var e=t.data;e.update_pos()},on_window_resize:function(t){var e=t.data;e.update_pos()},on_change_breakpoint:function(){this.update_pos()},on_grid_update:function(){this.update_pos()},update_pos:function(){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=t(Upfront.Settings.LayoutEditor.Selectors.main),n=this.$el.offset(),o=n.top,r=t(document).scrollTop(),s=t(window).height(),a=r+s,l=i.offset(),p=l.top,d=this.parent_view.get_container_view(this.model),c=d.$el.outerHeight(),u=d.$el.offset(),h=u.top+c,f=this.$el.height(),g=this.model.get("sticky"),m=this.$el.data("sticky-top"),v=this.model.get("sub"),b=!1,y={};if("none"==this.$el.css("display"))return this.$el.css({position:"",top:"",left:"",right:"",bottom:""}),this.$el.removeClass("upfront-region-container-sticky"),this.$el.removeData("sticky-top"),void("top"==v?this.$el.closest(".upfront-region-container-bg").css("padding-top",""):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",""));if(r=r<0?0:r,e&&!e.default&&(g=!1),g&&!_.isNumber(m)&&r>=o-p&&(y.position="fixed",y.top=p,y.left=l.left,y.right=0,y.bottom="auto",b=!0,this.$el.data("sticky-top",o-p)),r+p>=u.top&&a<=h){y.position="fixed","top"==v?(y.top=p,y.bottom="auto"):(y.top="auto",y.bottom=0),y.left=l.left,y.right=0,b=!1;var w=t(".upfront-regions");this.$el.children(".upfront-region-container-bg").children(".upfront-grid-layout");y.width=w.width(),w.offset()&&(y.left=w.offset().left-t(document).scrollLeft())}y.position&&"fixed"==y.position?(this.$el.css("position")==y.position&&this.$el.css("left")==y.left&&this.$el.css("top")==y.top||(this.$el.css(y),"top"==v?this.$el.closest(".upfront-region-container-bg").css("padding-top",f):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",f)),b?this.$el.addClass("upfront-region-container-sticky"):this.$el.removeClass("upfront-region-container-sticky")):"fixed"==this.$el.css("position")&&(!g||_.isNumber(m)&&r<=m||!_.isNumber(m)&&(r+p<u.top||a>h))&&(this.$el.css({position:"",top:"",left:"",right:"",bottom:""}),"top"==v&&this.$el.css("top",c-s+p),this.$el.removeClass("upfront-region-container-sticky"),this.$el.removeData("sticky-top"),"top"==v?this.$el.closest(".upfront-region-container-bg").css("padding-top",""):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",""))},remove:function(){var e=this.model.get("sub");"top"==e?this.$el.closest(".upfront-region-container-bg").css("padding-top",""):this.$el.closest(".upfront-region-container-bg").css("padding-bottom",""),this.event=!1,t(window).off("scroll.region_subcontainer_"+this.model.get("name")),t(window).off("resize.region_subcontainer_"+this.model.get("name")),Backbone.View.prototype.remove.call(this)}}),P=f.extend({cssSelectors:{".upfront-region-wrapper":{label:e.rw_label,info:e.rw_info}},events:{mouseup:"on_mouse_up",mouseover:"on_mouse_over",mouseenter:"on_mouse_enter","mouseleave > .upfront-region-edit-trigger-small":"on_mouse_leave",click:"on_click","click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click > .upfront-entity_meta > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-region-hidden-toggle > a.upfront-entity-hide_trigger":"on_hide_click","click > .upfront-region-edit-trigger":"trigger_edit"},attributes:function(){var t,e,i=Upfront.Settings.LayoutEditor.Grid,n=this.model.get("container"),o=this.model.get("name").toLowerCase().replace(/\s/,"-"),r=[];if(this.col||(t=this.model.get_property_value_by_name("col"),e=this.model.get_property_value_by_name("width"),this.col=t||(e?Upfront.Util.width_to_col(e):i.size),this.col>i.size&&(this.col=i.size)),r.push("upfront-region"),r.push("upfront-region-"+o),r.push(i.class+this.col),this.model.is_main())r.push("upfront-region-center");else{var s=this.model.collection.indexOf(this.model),a=this.model.get("sub"),l=this.model.collection.at(s+1),p=l&&(l.get("name")==n||l.get("container")==n);r.push("upfront-region-side"),r.push("upfront-region-side-"+(a?a:p?"left":"right"))}return this.model.collection&&this.model.collection.active_region==this.model&&r.push("upfront-region-active"),{class:r.join(" "),id:"region-"+o}},init:function(){this.model.get("container"),this.model.get("name");this.collection=this.model.collection,this.listenTo(this.dispatcher,"plural:propagate_activation",this.on_mouse_up),this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(this.model.get("modules"),"change",this.on_module_update),this.listenTo(this.model.get("modules"),"add",this.on_module_update),this.listenTo(this.model.get("modules"),"remove",this.on_module_update),this.listenTo(this.model.get("modules"),"reset",this.on_module_update),this.listenTo(Upfront.Events,"entity:added:after",this.display_region_hint),this.listenTo(Upfront.Events,"layout:after_render",this.on_layout_render),this.listenTo(Upfront.Events,"entity:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:region_container:resize_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag_stop",this.refresh_background),this.listenTo(Upfront.Events,"entity:drag:drop_change",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_open",this.refresh_background),this.listenTo(Upfront.Events,"entity:navigation:responsive_close",this.refresh_background),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"entity:region:hide_toggle",this.update_hide_toggle),this.listenTo(Upfront.Events,"command:region:edit_toggle",this.update_buttons),this.listenTo(Upfront.Events,"entity:region:removed",this.update_buttons),t(window).on("resize.region_"+this.model.get("name"),this,this.on_window_resize),this.listenTo(Upfront.Events,"upfront:renderingqueue:finished",this.display_region_hint)},on_click:function(t){},on_mouse_up:function(){this.trigger("activate_region",this)},on_mouse_over:function(){var e=(Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),this.parent_view.get_container_view(this.model)),i=t(Upfront.Settings.LayoutEditor.Selectors.main);i.hasClass("upfront-region-editing")&&e&&e.$el.hasClass("upfront-region-container-active")&&!e.$el.hasClass("upfront-region-bg-setting-open")&&this.trigger("activate_region",this)},on_mouse_enter:function(e){var i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if(void 0!==i&&"Default Desktop"!=i.name){var n=t(e.target).parents(".upfront-region-container").find(".upfront-region-edit-trigger-small");n.length>0&&(t(".upfront-region-edit-trigger-small").removeClass("visible"),n.addClass("visible"))}},on_mouse_leave:function(e){t(e.target).removeClass("visible")},_is_clipped:function(){var t=(this.model.get("type"),this.model.get("sub"));return!this.model.is_main()&&(!t||"top"!=t&&"bottom"!=t)},render:function(){var i=(this.model.get("container"),this.model.get("name"),_.template(s.region,this.model.toJSON())),n=t('<div class="upfront-region-edit-trigger upfront-region-edit-trigger-small upfront-ui" title="'+e.edit_region+'"><i class="upfront-icon upfront-icon-region-edit"></i>'+e.edit_region+"</div>"),o=t('<div class="upfront-region-size-hint upfront-ui"></div>');Upfront.Events.trigger("entity:region:before_render",this,this.model),this.$el.html(i),this.$el.append('<div class="upfront-debug-info"/>'),n.appendTo(this.$el),o.appendTo(this.$el),this.update();var r=this._modules_view||new T({model:this.model.get("modules")});r.region_view=this,this.$el.find("> .upfront-region-wrapper > .upfront-modules_container").append(r.el),r.render(),this.render_panels(),this.display_region_hint(),Upfront.Events.trigger("entity:region:after_render",this,this.model),this.trigger("region_render",this),this._modules_view?this._modules_view.delegateEvents():this._modules_view=r},render_panels:function(){this.region_panels=new Upfront.Views.Editor.RegionPanels({model:this.model}),this.region_panels.render(),this.$el.append(this.region_panels.el)},render_bg_setting:function(){var e=(this.parent_view.get_container_view(this.model),{model:this.model,to:this.$el,width:260,top:0,left:0,keep_position:!1}),i=t("#region-settings-sidebar");this.bg_setting=new Upfront.Views.Editor.RegionBgSetting(e),this.bg_setting.for_view=this,this.bg_setting.render(),i.html(this.bg_setting.el),this.listenTo(this.bg_setting,"modal:open",function(){i.css("opacity",""),this.on_modal_open()}),this.listenTo(this.bg_setting,"modal:close",this.on_modal_close)},update:function(){var t=Upfront.Settings.LayoutEditor.Grid,e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=(this.model.get("container"),this.model.get("name").toLowerCase().replace(/\s/g,"-")),n=this.model.previous("name"),o=this.model.get_property_value_by_name("col"),r=this.model.get_property_value_by_name("row"),s=r?r*Upfront.Settings.LayoutEditor.Grid.baseline:0,a=this.model.get_property_value_by_name("expand_lock");this.$el.data("name",i),this.$el.attr("data-title",this.model.get("title")),this.$el.data("type",this.model.get("type")),this.$el.find(".upfront-region-title").html(this.model.get("title")),e&&!e.default||o&&o!=this.col&&this.region_resize(o),s>0&&this.$el.css("min-height",s+"px"),a?this.$el.addClass("upfront-region-expand-lock"):this.$el.removeClass("upfront-region-expand-lock"),n!=i&&(this.$el.removeClass("upfront-region-"+n.toLowerCase().replace(/\s/g,"-")),this.$el.addClass("upfront-region-"+i),this.$el.attr("id","region-"+i)),this._is_clipped()?this.update_background():this.remove_background(),this.update_padding(),this.update_position(),this.update_buttons(),this.update_size_hint(this.col*t.column_width,parseInt(this.$el.css("height"),10)),this.trigger("region_update",this)},update_position:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),e=Upfront.Settings.LayoutEditor.Grid,i=this.$el.find("> .upfront-region-edit-trigger");if(t){var n=this.model.get_property_value_by_name("breakpoint"),o=this.model.get_property_value_by_name("row"),r=n[t.id],s=this.parent_view.get_container_view(this.model),a=this.$el.find("> .upfront-region-wrapper > .upfront-modules_container"),l=this.$el.find(".upfront-region-hidden-toggle"),p=this.$el.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger"),d=0,c=0,u=0,h=0;if("undefined"!=typeof s){var f=s.$el.find(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right");r&&r.hide?r.hide&&(a.hide(),l.show(),this.$el.addClass("upfront-region-hidden"),p.hide(),this.update_hide_toggle()):(a.show(),l.hide(),this.$el.removeClass("upfront-region-hidden"),t.default||p.show()),f.length>0&&f.length==s.$el.find(".upfront-region-hidden").length?s.$el.addClass("upfront-region-container-hidden"):s.$el.removeClass("upfront-region-container-hidden"),r&&"number"==typeof r.col?(c=r.col/t.columns*100,this.$el.css("width",(c>100?100:c)+"%"),this.$el.data("breakpoint_col",r.col)):(this.$el.css("width",""),this.$el.removeData("breakpoint_col")),t.default?(i.css("right",""),l.css("left","")):(this.model.is_main()?i.css("right",(t.width-t.columns*e.column_width)/2*-1):i.css("right",""),l.css("left",(t.width-t.columns*e.column_width)/2)),r&&"number"==typeof r.row?(d=r.row*e.baseline,this.$el.data("breakpoint_row",r.row)):(d=o*e.baseline,this.$el.removeData("breakpoint_row")),d>0?(u=parseInt(this.$el.css("padding-top"),10),h=parseInt(this.$el.css("padding-bottom"),10),this.$el.css("min-height",d+"px"),d-=u+h,d=d>0?d:0,a.css("min-height",d+"px")):(this.$el.css("min-height",""),a.css("min-height","")),this.trigger("region_changed",this),Upfront.Events.trigger("entity:region:update_position",this,this.model)}}},update_padding:function(){var t={},e=this.$el.closest(".upfront-region");this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")});var i,n,o=("undefined"!=typeof Upfront.Settings.LayoutEditor.Theme.breakpoints?Upfront.Settings.LayoutEditor.Theme.breakpoints:[],Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON()),r="default"===o?o:o.id,s="undefined"!=typeof t.breakpoint&&"undefined"!=typeof t.breakpoint[r]&&t.breakpoint[r];i="undefined"!=typeof s.top_bg_padding_num?s.top_bg_padding_num:"undefined"!=typeof t.top_bg_padding_num&&t.top_bg_padding_num,n="undefined"!=typeof s.bottom_bg_padding_num?s.bottom_bg_padding_num:"undefined"!=typeof t.bottom_bg_padding_num&&t.bottom_bg_padding_num,e.css({"padding-top":!1===i?"":i+"px","padding-bottom":!1===n?"":n+"px"})},update_buttons:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),e=this.$el.find("> .upfront-entity_meta > a.upfront-entity-delete_trigger");!t||t.default?this.model.is_main()&&this.model.has_side_region()||"top"==this.model.get("sub")||"bottom"==this.model.get("sub")?e.hide():e.css("display","block"):e.hide(),this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10))},update_size_hint:function(t,e,i){var n="<b>w:</b>"+t+"px <b>h:</b>"+e+"px";(i?i:this.$el).find(".upfront-region-size-hint").html(n)},region_resize:function(t){var e=Upfront.Settings.LayoutEditor.Grid,i=this.col;this.col=t,this.$el.removeClass(e.class+i),this.$el.addClass(e.class+this.col),Upfront.Application.layout_ready&&this.normalize_child_modules(i)},on_module_update:function(){this.trigger("region_changed",this),this.display_region_hint()},display_region_hint:function(){"theme"!=Upfront.Application.get_current()||this.$el.hasClass("upfront-region-floating")||this.$el.hasClass("upfront-region-lightbox")||"region-shadow"==this.$el.attr("id")||(this.$el.find("> .upfront-region-wrapper > .upfront-modules_container .upfront-wrapper").size()<1?this.$el.addClass("empty_in_theme_mode"):this.$el.removeClass("empty_in_theme_mode"))},on_layout_render:function(){this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10)),this.refresh_background(),this.update_padding()},normalize_child_modules:function(t){if(this._modules_view){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Behaviors.GridEditor,n=!e||e.default?i.get_class_num(this.$el,i.grid.class):this.$el.data("breakpoint_col");this._modules_view.normalize_child_modules(n,t,this.model.get("wrappers"))}},remove:function(){this._modules_view&&this._modules_view.remove(),t(window).off("resize.region_"+this.model.get("name"));var e=this.model.get("wrappers");e&&e.each(function(t){var e=Upfront.data.wrapper_views[t.cid];e&&(e.remove(),delete Upfront.data.wrapper_views[t.cid])}),this.parent_view=!1,Backbone.View.prototype.remove.call(this),this.model.get("wrappers").reset([],{silent:!0}),this.model=!1},on_delete_click:function(i){if("undefined"!=typeof i&&i.preventDefault(),confirm(e.section_delete_nag)){var n=this.$el.closest(".upfront-region-container-bg").children(".upfront-region-bg-overlay");n.length>0&&n.data("uparallax")&&n.uparallax("destroy");var o=this.parent_view;"lightbox"==this.model.get("type")&&this.hide();var r=this.model.collection||this.collection;if(this.model.is_main()){var s=this.model.get_sub_regions();_.each(s,function(t,e){_.isArray(t)?_.each(t,function(t){r.remove(t)}):_.isObject(t)&&r.remove(t)})}"fixed"===this.model.get("type")?(this.parent_view.get_container_view(this.model).close_edit(),this.collection.remove(this.model)):this.collection.remove(this.model);var a=r.total_container(["shadow","lightbox"]);0==a&&o.$el.find("#no_region_add_one").length<1&&o.$el.append(t("<a>").attr("id","no_region_add_one").text(e.no_region_add).one("click",function(){var i=!1,n="main",o=e.main_area;r.get_by_name(n)&&(i=r.get_new_title("Main ",2),o=i.title,n=i.name);var s=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:n,container:n,title:o})),a={};s.set_property("row",Upfront.Util.height_to_row(t(window).height())),s.add_to(r,0,a),t(this).remove()}))}Upfront.Events.trigger("entity:layout:change")},on_settings_click:function(e){"undefined"!=typeof e&&(e.preventDefault(),e.stopPropagation());var i=this,n=this.parent_view.get_container_view(this.model);this.listenToOnce(Upfront.Events,"entity:region:deactivated",function(n){e&&!this.$el.is(t(e.target).closest("div.upfront-region"))&&i.bg_setting&&i.bg_setting.close(!1)}),_.each(_.flatten([n.model,n.sub_model]),function(t){var e=Upfront.data.region_views[t.cid];return t==i.model?void e.$el.find(".upfront-inline-modal-wrap").draggable({delay:300,addClasses:!1,cancel:".upfront-field-select, input,textarea,button,select,option"}):void(e&&e.bg_setting&&e.bg_setting.close(!1))});var o=this.$el.find("> .upfront-entity_meta > a.upfront-entity-settings_trigger"),r=o.offset(),s=this.$el.offset(),a=this.$el.width();if(this.render_bg_setting(),"lightbox"==this.model.get("type")){this.bg_setting.right=80,this.bg_setting.top=r.top;var n=this.parent_view.get_container_view(this.model);n.trigger_edit_lightbox(e)}else this.bg_setting.width<r.left-10?(this.bg_setting.right=s.left+a-r.left+10,this.bg_setting.left=-1):(this.bg_setting.right=-1,this.bg_setting.left=a),this.bg_setting.top=r.top-s.top;n.$el.addClass("upfront-region-bg-setting-open"),this.bg_setting.open().always(function(){n.$el.removeClass("upfront-region-bg-setting-open")})},on_hide_click:function(t){t.preventDefault();var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(i[e.id])||(i[e.id]={}),1==i[e.id].hide?i[e.id].hide=0:i[e.id].hide=1,this.model.set_property("breakpoint",i),Upfront.Events.trigger("entity:region:hide_toggle",i[e.id].hide,this)},update_hide_toggle:function(){if(this.$el.hasClass("upfront-region-hidden")){var e=this.$el.find(".upfront-region-hidden-toggle"),i=t(".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right"),n=Upfront.Util.find_from_elements(i,this.$el,".upfront-region",!0,":not(.upfront-region-hidden)");e.css("margin-top",20*n.length+"px")}},trigger_edit:function(t){var e=this.parent_view.get_container_view(this.model);e.trigger_edit(t),t.stopPropagation()},close_edit:function(t){var e=this.parent_view.get_container_view(this.model);e.close_edit(),t.stopPropagation()},on_modal_open:function(){var t=this.parent_view.get_container_view(this.model);t.$el.find(".upfront-region-finish-edit").css("display","none")},on_modal_close:function(){var t=this.parent_view.get_container_view(this.model);t.$el.find(".upfront-region-finish-edit").css("display",""),this.bg_setting.remove(),this.bg_setting=!1},on_change_breakpoint:function(t){var e=this.$el.find("> .upfront-entity_meta > a.upfront-entity-delete_trigger"),i=(this.$el.find("> .upfront-entity_meta > a.upfront-entity-settings_trigger"),this.$el.find("> .upfront-entity_meta > a.upfront-entity-hide_trigger"));t.default?(e.show(),i.hide()):(e.hide(),i.show()),this.update_position(),this.update_padding(),this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10)),this._is_clipped()&&this.update_background()},on_grid_update:function(){this.update_position(),this.update_padding(),this.update_size_hint(parseInt(this.$el.css("width"),10),parseInt(this.$el.css("height"),10)),this._is_clipped()&&this.update_background()}}),M=P.extend({events:{mouseover:"on_mouse_over",click:"on_click","click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click > .upfront-region-edit-trigger":"trigger_edit","click > .upfront-region-finish-edit-fixed":"close_edit"},init:function(){this.constructor.__super__.init.call(this),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.check_modules),this.listenTo(Upfront.Events,"layout:after_render",this.check_modules),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(this.model,"restrict_to_container",this.update_position_on_restrict),t(window).on("scroll.region_"+this.model.get("name"),this,this.on_scroll)},render:function(){this.constructor.__super__.render.call(this);var i=t('<div class="upfront-region-edit-trigger upfront-region-edit-trigger-small upfront-region-edit-trigger-small-fixed upfront-ui" title="'+e.change_background+'"><i class="upfront-icon upfront-icon-region-edit"></i></div>'),n=t('<div class="upfront-region-edit-trigger upfront-region-edit-trigger-full upfront-ui"><div class="upfront-region-edit-text">'+e.click_to_edit_floating_region+"</div></div>"),o=t('<div class="upfront-region-finish-edit-fixed upfront-ui">'+e.ok+"</div>"),r=t('<div class="upfront-region-size-hint upfront-ui"></div>'),s=t('<div class="upfront-region-position-hint upfront-ui"></div>');r.appendTo(this.$el),s.appendTo(this.$el),i.appendTo(this.$el),n.appendTo(this.$el),o.appendTo(this.$el),this.update_padding()},render_bg_setting:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);this.bg_setting=new Upfront.Views.Editor.RegionBgSettingFixed({model:this.model,to:e,width:420}),this.bg_setting.render(),e.append(this.bg_setting.el),this.listenTo(this.bg_setting,"modal:open",this.on_modal_open),this.listenTo(this.bg_setting,"modal:close",this.on_modal_close)},update:function(){this.constructor.__super__.update.call(this),this.check_modules(),this.update_region_position(),this.update_padding()},update_region_position:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main),i=Upfront.Settings.LayoutEditor.Grid,n=this.model.get("restrict_to_container"),o=this.model.get_property_value_by_name("width"),r=this.model.get_property_value_by_name("col"),s=this.model.get_property_value_by_name("height"),a=this.model.get_property_value_by_name("top"),l="number"==typeof a,p=this.model.get_property_value_by_name("left"),d="number"==typeof p,c=this.model.get_property_value_by_name("bottom"),u="number"==typeof c,h=this.model.get_property_value_by_name("right"),f="number"==typeof h,_={width:o||225,minHeight:s||225};o||this.model.set_property("width",225,!0),r?r=r<=i.size?r:i.size:(r=Upfront.Util.width_to_col(_.width),r=r<=i.size?r:i.size,this.model.set_property("col",r,!0)),s||this.model.set_property("height",225,!0),l||!u?(_.top=l?a:30,_.bottom="",l||this.model.set_property("top",30,!0)):(_.bottom=c,_.top=""),d||!f?(_.left=(d?p:30)+(n?0:e.offset().left),_.right="",d||this.model.set_property("left",30,!0)):(_.right=h,_.left=""),this.$el.find("> .upfront-region-wrapper > .upfront-modules_container").css({width:r*i.column_width,minHeight:_.minHeight}),this.$el.css(_),this.edit_position&&this.edit_position.update_fields(),this.update_size_hint(_.width,_.minHeight),this.update_position_hint(_),this.update_position_scroll()},update_position_hint:function(t,e){var i="";"number"==typeof t.top?i+="<b>top:</b>"+t.top:"number"==typeof t.bottom&&(i+="<b>bottom:</b>"+t.bottom),"number"==typeof t.left?i+=" <b>left:</b>"+t.left:"number"==typeof t.right&&(i+=" <b>right:</b>"+t.right),(e?e:this.$el).find(".upfront-region-position-hint").html(i)},update_position_on_restrict:function(e){var i=t(window).scrollTop(),n=t(window).height(),o=i+n,r=this.parent_view.get_container_view(this.model),s=r.$el.height(),a=r.$el.offset(),l=a.top+s,p=this.model.get_property_value_by_name("height"),d=this.model.get_property_value_by_name("top"),c="number"==typeof d,u=this.model.get_property_value_by_name("bottom"),h="number"==typeof u;e?(c||!h)&&i<=a.top?(d-=a.top-i,d+p>s?d=s-p:d<0&&(d=0)):h&&o>=l&&(u-=o-l,u+p>s?u=s-p:u<0&&(u=0)):c||!h?d=a.top>=i?a.top-i+d:d:u=o>=l?o-l+u:u,c||!h?(this.model.set_property("top",d,!0),s>n&&o>l&&t("html,body").animate({scrollTop:l-n},600)):(this.model.set_property("bottom",u,!0),s>n&&i<a.top&&t("html,body").animate({scrollTop:a.top},600))},update_position_scroll:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main),i=t(window).scrollTop(),n=t(window).height(),o=i+n,r=this.parent_view.get_container_view(this.model),s=r.$el.height(),a=r.$el.offset(),l=a.top+s,p=this.model.get("restrict_to_container"),d=(this.model.get_property_value_by_name("height"),this.model.get_property_value_by_name("top")),c="number"==typeof d,u=this.model.get_property_value_by_name("left"),h=this.model.get_property_value_by_name("right"),f="number"==typeof u,_=this.model.get_property_value_by_name("bottom"),g={};(o<r.$el.offset().top||i>r.$el.offset().top+r.$el.outerHeight())!=!0?0===h&&this.$el.find(".upfront-region-edit-trigger").css({right:30}):this.$el.find(".upfront-region-edit-trigger").css({right:0}),p?i>=a.top&&o<=l?(g.position="fixed",c?g.top=d:g.bottom=_):(g.position="absolute",c?s>n&&i>=a.top+s-n?g.top=s-n+d:g.top=d:s>n&&o<=a.top+n?g.bottom=s-n+_:g.bottom=_):(g.position="fixed",c?g.top=d:g.bottom=_),f&&(g.left=u+("fixed"==g.position?e.offset().left:0)),this.$el.css(g),"fixed"==g.position&&g.bottom<35||"absolute"==g.position&&this.$el.offset().top+this.$el.height()>o-35?this.$el.find(".upfront-region-finish-edit-fixed").css("bottom",0):this.$el.find(".upfront-region-finish-edit-fixed").css("bottom","")},on_scroll:function(t){var e=t.data;e.update_position_scroll()},render_panels:function(){},render_edit_position:function(){this.edit_position=new Upfront.Views.Editor.RegionFixedEditPosition({
model:this.model}),this.edit_position.render(),this.$el.append(this.edit_position.el)},trigger_edit:function(t){var e=this.parent_view.get_container_view(this.model);e.trigger_edit_fixed(),t.stopPropagation()},close_edit:function(t){var e=this.parent_view.get_container_view(this.model);e.close_edit(),t.stopPropagation()},check_modules:function(){var t=this.$el.find("> .upfront-region-wrapper > .upfront-modules_container > .upfront-editable_entities_container").find(".upfront-module").size();0==t?(this.$el.removeClass("upfront-region-has-modules"),this.$el.addClass("upfront-region-empty")):(this.$el.removeClass("upfront-region-empty"),this.$el.addClass("upfront-region-has-modules"))},remove:function(){t(window).off("scroll.region_"+this.model.get("name")),this.constructor.__super__.remove.call(this)},on_change_breakpoint:function(t){this.update_padding(),t.default?this.$el.show():this.$el.hide()},on_grid_update:function(){this.update_padding()}}),j=P.extend({cssSelectors:{".upfront-region-side-lightbox":{label:e.ltbox_area_label,info:e.ltbox_area_info},".close_lightbox > .upfront-icon-popup-close":{label:e.ltbox_close_icon_label,info:e.ltbox_close_icon_info}},$bg:t('<div class="upfront-lightbox-bg"></div>'),$close:t('<div class="upfront-ui close_lightbox"></div>'),$close_icon:t('<div class="upfront-icon-popup-close"></div>'),events:{mouseover:"on_mouse_over",click:"on_click","click > .upfront-entity_meta > a.upfront-entity-settings_trigger":"on_settings_click","click > .upfront-entity_meta > a.upfront-entity-delete_trigger":"on_delete_click","click > .upfront-region-edit-trigger":"trigger_edit","click > .upfront-region-finish-edit-lightbox":"close_edit","click > .close_lightbox":"hide"},init:function(){this.constructor.__super__.init.call(this),this.listenTo(Upfront.Events,"sidebar:toggle:done",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.update_region_position),this.listenTo(Upfront.Events,"entity:drag_stop",this.check_modules),this.listenTo(Upfront.Events,"layout:after_render",this.check_modules),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update)},render:function(){this.constructor.__super__.render.call(this),this.hide(),this.$close.appendTo(this.$el)},render_bg_setting:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);this.bg_setting=new Upfront.Views.Editor.RegionBgSettingLightbox({model:this.model,to:e,width:420}),this.bg_setting.for_view=this,this.bg_setting.render(),e.append(this.bg_setting.el),this.listenTo(this.bg_setting,"modal:open",this.on_modal_open),this.listenTo(this.bg_setting,"modal:close",this.close_edit)},show:function(){Upfront.Events.trigger("upfront:element:edit:stop");var t=this;this.$bg.insertBefore(this.$el),"yes"==this.model.get_property_value_by_name("click_out_close")&&(this.$bg.unbind("click"),this.$bg.bind("click",function(){t.hide()})),this.$el.show(),this._modules_view.apply_flexbox_clear(),this._modules_view.lazy_apply_wrapper_height(),Upfront.Events.trigger("upfront:lightbox:show")},hide:function(){this.$el.hide(),this.$bg.remove()},refresh_background:function(){this.constructor.__super__.refresh_background.call(this)},update:function(){this.constructor.__super__.update.call(this),this.check_modules(),this.update_region_position(),this.update_padding(),"yes"==this.model.get_property_value_by_name("show_close")||"yes"==this.model.get_property_value_by_name("add_close_text")?(this.$el.find(".close_lightbox").css("display","block"),"yes"==this.model.get_property_value_by_name("add_close_text")?(this.$close.html("<h3>"+this.model.get_property_value_by_name("close_text")+"</h3>"),"yes"==this.model.get_property_value_by_name("show_close")&&this.$close.children("h3").css("margin-right","40px")):this.$close.html(""),"yes"==this.model.get_property_value_by_name("show_close")&&this.$close.append(this.$close_icon)):this.$el.find(".close_lightbox").css("display","none");var t=this;"yes"==this.model.get_property_value_by_name("click_out_close")?(this.$bg.unbind("click"),this.$bg.bind("click",function(){t.hide()})):this.$bg.unbind("click"),this.$bg.css("background-color",this.model.get_property_value_by_name("overlay_color")),this.$el.css("background-color",this.model.get_property_value_by_name("lightbox_color")),this.$el.removeClass("init_state"),this.model.get_property_value_by_name("delete")&&(this.model.set_property("delete",!1),this.on_delete_click())},update_region_position:function(){var e=(t(Upfront.Settings.LayoutEditor.Selectors.main),Upfront.Settings.LayoutEditor.Grid),i=this.model.get_breakpoint_property_value("col",!0),n=this.model.get_property_value_by_name("height");i||this.model.set_property("col",10,!0),n||this.model.set_property("height",225,!0),width=i*e.column_width;var o={width:width||225,minHeight:parseInt(n,10)||225};o["margin-left"]=parseInt(-(width/2)+t("#sidebar-ui").width()/2,10),o["margin-top"]=parseInt(-(n/2),10),this.$el.find("> .upfront-region-wrapper > .upfront-modules_container").css({width:Math.floor(o.width/e.column_width)*e.column_width,minHeight:o.minHeight}),this.$el.css(o)},render_edit_position:function(){this.edit_position=new Upfront.Views.Editor.RegionFixedEditPosition({model:this.model}),this.edit_position.render(),this.$el.append(this.edit_position.el)},trigger_edit:function(t){this.on_settings_click(),t.stopPropagation()},close_edit:function(t){var e=this.parent_view.get_container_view(this.model);e.close_edit(),"undefined"!=typeof t&&t.stopPropagation()},check_modules:function(){var t=this.$el.find("> .upfront-region-wrapper > .upfront-modules_container > .upfront-editable_entities_container").find(".upfront-module").size();0==t?(this.$el.removeClass("upfront-region-has-modules"),this.$el.addClass("upfront-region-empty")):(this.$el.removeClass("upfront-region-empty"),this.$el.addClass("upfront-region-has-modules"))},on_change_breakpoint:function(t){this.update_padding(),this.update_region_position(),this.hide()},on_grid_update:function(){this.update_padding(),this.update_region_position()}}),O=v.extend({className:"upfront-regions",allow_edit:!0,init:function(){this.stopListening(this.model,"add",this.render),this.listenTo(this.model,"add",this.on_add),this.stopListening(this.model,"remove",this.render),this.listenTo(this.model,"remove",this.on_remove),this.listenTo(this.model,"reset",this.on_reset),this.listenTo(Upfront.Events,"entity:region:resize_start",this.pause_edit),this.listenTo(Upfront.Events,"entity:region:resize_stop",this.resume_edit),this.listenTo(Upfront.Events,"entity:region:deactivated",this.deactivate_region),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update)},render:function(){this.$el.html("");var t=this;"object"!=typeof this.container_views&&(this.container_views={}),"object"!=typeof this.sub_container_views&&(this.sub_container_views={}),"object"!=typeof Upfront.data.region_views&&(Upfront.data.region_views={}),this.model.each(function(e){t.render_container(e)}),this.model.each(function(e,n){i.add(function(){t.render_region(e)})}),i.addToEnd(function(){t.apply_adapt_region_to_breakpoints()})},render_container:function(t,e){var i=t.get("container");t.get("name");if(t.is_main()||"lightbox"==i&&!this.container_views[t.cid]){var n=this.container_views[t.cid]||this.create_container_instance(t);return n.parent_view=this,this.listenTo(n,"activate_region",this.activate_region_container),e>=0?this.$el.find(".upfront-region").eq(e).closest(".upfront-region-container").before(n.el):this.$el.append(n.el),n.render(),this.container_views[t.cid]?n.delegateEvents():this.container_views[t.cid]=n,Upfront.Events.trigger("entity:regions:render_container",n,n.model),n}},render_region:function(t,e){var i,n=Upfront.data.region_views[t.cid]||this.create_region_instance(t),o=this.get_container_view(t),e=e?e:t.get("sub");if(o)return"top"==e||"bottom"==e?(i=this.sub_container_views[t.cid]||new I({model:t}),"top"==e?o.$layout.before(i.el):o.$layout.after(i.el),i.parent_view=this,i.listenTo(o.model.get("properties"),"change",i.update),i.render(),n.sub_container_view=i,i.$layout.append(n.el),this.sub_container_views[t.cid]?i.delegateEvents():this.sub_container_views[t.cid]=i):"left"==e?o.$layout.prepend(n.el):"fixed"==e?o.$el.append(n.el):o.$layout.append(n.el),Upfront.data.region_views[t.cid]?(n.render(),n.delegateEvents()):(n.parent_view=this,o.listenTo(n,"region_render",o.on_region_render),o.listenTo(n,"region_update",o.on_region_update),o.listenTo(n,"region_changed",o.on_region_changed),t.is_main()?n.listenTo(o,"region_resize",n.region_resize):o.add_sub_model(t),n.render(),this.listenTo(n,"activate_region",this.activate_region),Upfront.data.region_views[t.cid]=n),t.get("default")&&n.trigger("activate_region",n),Upfront.Events.trigger("entity:regions:render_region",n,n.model),n},create_container_instance:function(t){return new z({model:t})},create_region_instance:function(t){var e=t.get("type");return"fixed"==e?new M({model:t}):"lightbox"==e?new j({model:t}):new P({model:t})},get_container_view:function(t){return _.find(this.container_views,function(e){var i=e.model.get("container")||e.model.get("name");if(t.get("container")==i||t.get("name")==i)return!0})},activate_region:function(e){if(this.allow_edit){var e=e.model?e:Upfront.data.region_views[e.cid],i=e.model;if(this.model.active_region!=i&&(this.model.active_region=i,e.$el)){t(".upfront-region-active").removeClass("upfront-region-active"),e.$el.addClass("upfront-region-active");var n=this.get_container_view(e.model);n&&(t(".upfront-region-container-active").removeClass("upfront-region-container-active"),n.$el.addClass("upfront-region-container-active")),t(".upfront-region-sub-container-active").removeClass("upfront-region-sub-container-active"),e.sub_container_view&&e.sub_container_view.$el.addClass("upfront-region-sub-container-active"),Upfront.Events.trigger("entity:region:activated",e)}}},deactivate_region:function(){this.allow_edit&&this.model.active_region&&(t(".upfront-region-active").removeClass("upfront-region-active"),t(".upfront-region-container-active").removeClass("upfront-region-container-active"),this.model.active_region=null)},activate_region_container:function(t){var e=Upfront.data.region_views[t.model.cid];e&&e.trigger("activate_region",e)},pause_edit:function(){this.allow_edit=!1},resume_edit:function(){this.allow_edit=!0},on_edit_toggle:function(t){this.allow_edit=t},on_add:function(t,e,i){var n,o=this.get_container_view(t),r="undefined"!=typeof i.index?i.index:-1,s=!!i.sub&&i.sub;o?n=this.render_region(t,s):(this.render_container(t,r),n=this.render_region(t)),this.apply_adapt_region_to_breakpoints(),Upfront.Events.trigger("entity:region:added",n,n.model)},on_remove:function(t){var e=Upfront.data.region_views[t.cid];if(e){var i=this.get_container_view(t),n=this.sub_container_views[t.cid];if(delete Upfront.data.region_views[t.cid],e.region_panels&&(e.region_panels.unbind(),e.region_panels.remove()),e.bg_setting&&(e.bg_setting.unbind(),e.bg_setting.remove()),e.edit_position&&(e.edit_position.unbind(),e.edit_position.remove()),e.unbind(),e.remove(),i){if(i.sub_model.length>0){var o=Upfront.data.region_views[i.model.cid];_.each(i.sub_model,function(e,n){if(e==t)i.sub_model.splice(n,1);else{var o=Upfront.data.region_views[(e||{}).cid];o&&o.update()}}),o&&o.update()}Upfront.data.region_views[i.model.cid]||0!=i.sub_model.length||(delete this.container_views[i.model.cid],i.region_fixed_panels&&(i.region_fixed_panels.unbind(),i.region_fixed_panels.remove()),i.unbind(),i.remove())}n&&(delete this.sub_container_views[t.cid],n.unbind(),n.remove()),Upfront.Events.trigger("entity:region:removed",e,t)}},on_reset:function(t,e){var i=this;e.previousModels&&_.each(e.previousModels,function(t){i.on_remove(t)})},apply_adapt_region_to_breakpoints:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if(!t||t.default){var e=this,i=Upfront.Behaviors.GridEditor,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(n,function(t){var n=t.toJSON();n.default||i.adapt_region_to_breakpoint(e.model,n.id,n.columns,!0)})}},on_change_breakpoint:function(t){},on_grid_update:function(){},remove:function(){var t=this;this.model.each(function(e){t.on_remove(e)}),Backbone.View.prototype.remove.call(this),_.each(this.container_views,function(e,i){e.remove(),delete t.container_views[i]}),this.container_views=null,_.each(this.sub_container_views,function(e,i){e.remove(),delete t.sub_container_views[i]}),this.sub_container_views=null,this.model.reset([],{silent:!0}),this.model=!1,this.options=!1}}),D=f.extend({events:{mouseup:"on_mouse_up","click > .upfront-wrapper-meta > .upfront-add-spacer":"on_add_spacer"},attributes:function(){var t="upfront-wrapper",e=this.model.get_property_value_by_name("class");return{class:t+" "+e,id:this.model.get_wrapper_id()}},init:function(){this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model,"remove",this.on_remove),this.listenTo(Upfront.Events,"entity:region:update_position",this.on_region_update),this.listenTo(Upfront.Events,"entity:module:update_position",this.on_module_update),this.listenTo(Upfront.Events,"entity:modules:render_module",this.on_module_update),this.listenTo(Upfront.Events,"entity:object:update_position",this.on_object_update),this.listenTo(Upfront.Events,"entity:objects:render_object",this.on_object_update),this.listenTo(Upfront.Events,"layout:after_render",this.on_layout_after_render),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.listenTo(Upfront.Events,"upfront:lightbox:show",this.on_lightbox_show)},render:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),e=_.template(s.wrapper),i=Upfront.Settings.LayoutEditor.Grid,n=this.model.get_property_value_by_name("class"),o=Upfront.Behaviors.GridEditor.get_class_num(n,i.class);Upfront.Events.trigger("entity:wrapper:before_render",this,this.model),this.stopListening(Upfront.Events,"upfront:layout_size:change_breakpoint"),this.stopListening(Upfront.Events,"upfront:layout_size:change_breakpoint:secondary"),this.stopListening(Upfront.Events,"upfront:layout_size:change_breakpoint:tertiary"),this.parent_view&&"group_view"in this.parent_view&&this.parent_view.group_view?this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:secondary",this.on_change_breakpoint):this.parent_view&&"object_group_view"in this.parent_view&&this.parent_view.object_group_view?this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:tertiary",this.on_change_breakpoint):this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.$el.html(e),this.$el.data("default_col",o),this.$el.data("current_col",o),t&&!t.default&&this.update_position(),Upfront.Events.trigger("entity:wrapper:after_render",this,this.model)},update:function(t,e){var i=Upfront.Settings.LayoutEditor.Grid,n=this.model.get_property_value_by_name("class"),o=Upfront.Behaviors.GridEditor.get_class_num(n,i.class);"class"==t.id?(this.$el.attr("class",(this.attributes()||{}).class),this.$el.data("default_col",o),this.$el.data("current_col",o)):"breakpoint"==t.id&&this.update_position()},update_position:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();if(t){var e=Upfront.Behaviors.GridEditor,i=(Upfront.Settings.LayoutEditor.Grid,this.model.get_property_value_by_name("breakpoint")),n=i[t.id],o=!_.isUndefined(this.parent_view.group_view),r=!_.isUndefined(this.parent_view.object_group_view),s=o?this.parent_view.group_view:r?this.parent_view.object_group_view:this.parent_view.region_view,a=o?e.get_position(s.$el):r?e.get_position(s.parent_module_view.$el.find("> .upfront-module")):e.get_region_position(s.$el),l=a.col;this.$el.css({minHeight:"",marginRight:0}),n&&"number"==typeof n.col?(this.$el.css("width",n.col/l*100+"%"),this.$el.data("breakpoint_col",n.col),this.$el.data("current_col",n.col)):(this.$el.css("width",""),this.$el.removeData("breakpoint_col"),this.$el.data("current_col",this.$el.data("default_col"))),n&&"number"==typeof n.order?(this.$el.css("order",n.order),this.$el.data("breakpoint_order",n.order)):(this.$el.css("order",""),this.$el.removeData("breakpoint_order")),n&&n.clear?this.$el.data("breakpoint_clear",n.clear):this.$el.removeData("breakpoint_clear"),this.trigger("update_position",this,this.model),Upfront.Events.trigger("entity:wrapper:update_position",this,this.model)}},on_add_spacer:function(e){var i=Upfront.Behaviors.GridEditor,n=t(e.target),o=n.attr("data-position");e.preventDefault(),i.start(this,this.model),this.add_spacer(o,1,null,0!==n.closest(".upfront-objects_container").length)},add_spacer:function(e,i,n,o){o=!_.isUndefined(o)&&o,i=i>0?i:1,n=_.isNumber(n)&&n>i?n:Upfront.Util.width_to_col(this.$el.width());var r=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),s=Upfront.Behaviors.GridEditor,a=Upfront.Settings.LayoutEditor.Grid.class,l=this._find_child_min_col(),p=n-i,d=p>=l?this.$el:this._find_closest_wrapper("left"==e,i);if(d.length){p<l&&(n=Upfront.Util.width_to_col(d.width()),p=n-i);var c=this.model.collection.get_by_wrapper_id(d.attr("id")),u=this.model.get_property_value_by_name("class"),h=r&&!r.default?this.model.get_breakpoint_property_value("clear"):u.match(/clr/),f=Upfront.Util.get_unique_id("wrapper"),g=[{name:"wrapper_id",value:f},{name:"default_hide",value:1},{name:"toggle_hide",value:0},{name:"hide",value:r&&!r.default?1:0}],m=new Upfront.Models.UspacerModel({name:"",properties:o?_.union([{name:"class",value:a+i+" upfront-object-spacer"}],g):[]}),v=new Upfront.Models.Module({name:"",properties:_.union([{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:a+i+" upfront-module-spacer"},{name:"has_settings",value:0}],g),objects:[m]}),b=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:f},{name:"class",value:a+i+(h&&"left"==e?" clr":"")}]}),y=this.$el.find(s.el_selector_direct),w="right"==e?y.last():y.first(),k=s.get_el_model(w),$=k.collection.indexOf(k);c&&(d.find(s.el_selector_direct).each(function(){var e=s.get_el_model(t(this));r&&!r.default?(e.set_breakpoint_property("edited",!0,!0),e.set_breakpoint_property("col",p)):e.replace_class(a+p)}),h&&"left"==e&&(r&&!r.default?(this.model.set_breakpoint_property("edited",!0,!0),this.model.set_breakpoint_property("clear",!1)):this.model.remove_class("clr")),r&&!r.default?(c.set_breakpoint_property("edited",!0,!0),c.set_breakpoint_property("col",p)):c.replace_class(a+p),r&&!r.default&&(b.set_breakpoint_property("edited",!0,!0),b.set_breakpoint_property("clear",h&&"left"==e,!0),b.set_breakpoint_property("order",this.model.get_breakpoint_property_value("order")),b.set_breakpoint_property("col",i),o?(m.set_breakpoint_property("edited",!0,!0),m.set_breakpoint_property("hide",0,!0),m.set_breakpoint_property("left",0,!0),m.set_breakpoint_property("col",i)):(v.set_breakpoint_property("edited",!0,!0),v.set_breakpoint_property("hide",0,!0),v.set_breakpoint_property("left",0,!0),v.set_breakpoint_property("col",i))),this.model.collection.add(b),o?m.add_to(k.collection,"right"==e?$+1:$):v.add_to(k.collection,"right"==e?$+1:$))}},_find_closest_wrapper:function(e,i){var n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=this.$el.parent().children(".upfront-wrapper:visible").filter(function(){return t(this).height()>0}).each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb),r=(o.index(this.$el),function(t){return!n||n.default?t.hasClass("clr"):t.data("breakpoint_clear")}),s=function(t){return Upfront.Util.width_to_col(t.width())>i},a=r(this.$el)?this.$el:Upfront.Util.find_from_elements(o,this.$el,r,!0),l=Upfront.Util.find_from_elements(o,a,".upfront-wrapper",!1,r),p=t(_.union([a.get(0)],l.map(function(){return this}).get())),d=Upfront.Util.find_from_elements(p,this.$el,s,e),c=d.length?d:Upfront.Util.find_from_elements(p,this.$el,s,!e);return c.first()},_find_child_min_col:function(){var t=Upfront.Behaviors.GridEditor,e=1;return this.parent_view.model.each(function(i){if(i.get("modules")){var n=Upfront.data.module_views[i.cid],o=n?t.get_group_min_col(n):1;e=Math.max(e,o)}}),e},toggle_wrapper_visibility:function(){var t=parseInt(this.$el.css("height"),10)>0;t||"none"==this.$el.css("display")?t&&this.$el.css("display",""):this.$el.css("display","none")},on_change_breakpoint:function(){this.$el.css({display:""}),this.update_position()},on_grid_update:function(){this.update_position()},on_region_update:function(t){this.parent_view&&this.parent_view.region_view&&this.parent_view.region_view==t&&this.toggle_wrapper_visibility()},on_module_update:function(t){t.wrapper_view&&t.wrapper_view==this&&(t instanceof Upfront.Views.ModuleGroup||this.toggle_wrapper_visibility())},on_object_update:function(t){t.wrapper_view&&t.wrapper_view==this&&this.toggle_wrapper_visibility()},on_layout_after_render:function(){this.$el.find("> .upfront-module-group").length>0||this.toggle_wrapper_visibility()},on_lightbox_show:function(){this.$el.find("> .upfront-module-group").length>0||this.toggle_wrapper_visibility()},on_remove:function(){this.unbind(),this.remove()}}),A=f.extend({tpl:_.template(s.layout),events:{click:"on_click"},initialize:function(e){this._has_ruler=!1,this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(Upfront.Events,"command:layout:edit_background",this.open_edit_background),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"application:mode:after_switch",this.on_mode_switch),t(window).on("resize.upfront_layout",this,this.on_window_resize),t(window).on("scroll.upfront_layout",this,this.on_window_scroll),t(window).on("keydown.upfront_layout",this,this.on_keydown),this.render()},update:function(){this.update_background()},update_background_color:function(){var e=t("body"),i=this.model.get_breakpoint_property_value("background_color",!0);i?e.css("background-color",i):e.css("background-color","")},render:function(){var e=this;this.$el.addClass("upfront-layout-view"),this.$el.html(this.tpl(this.model.toJSON())),this.$layout=this.$(".upfront-layout"),this.remove_selections(),this.local_view?(this.$layout.append(this.local_view.el),this.local_view.render(),this.local_view.delegateEvents()):(this.local_view=new O({model:this.model.get("regions")}),this.$layout.append(this.local_view.el),this.local_view.render()),i.addToEnd(function(){e.update(),e.bg_setting=new Upfront.Views.Editor.ModalBgSetting({model:e.model,to:e.$el,width:420}),e.bg_setting.render(),e.$el.append(e.bg_setting.el),e.fix_height(),e.update_grid_css(),Upfront.Util.css_support("flex")&&t("html").addClass("flexbox-support"),Upfront.Events.trigger("layout:after_render"),Upfront.Events.trigger("layout:after_render:finish")}),i.start()},on_click:function(e){var i=Upfront.data.currentEntity;t(e.target).closest(".upfront-entity_meta").length||t(e.target).closest("#upfront-csseditor").length||Upfront.Events.trigger("entity:settings:deactivate"),Upfront.Events.trigger("entity:contextmenu:deactivate"),i&&(t(e.target).closest(i.el).length||(i.trigger("deactivated",e),i.$el.removeClass("upfront-active_entity"),Upfront.Events.trigger("entity:deactivated",e),Upfront.data.currentEntity=!1)),t(e.target).hasClass("upfront-editable_entities_container")&&Upfront.Events.trigger("entity:deactivated"),t(e.target).hasClass("upfront-region-editing-overlay")&&!t(".upfront-region-bg-setting-open").length&&Upfront.Events.trigger("entity:region:deactivated"),this.remove_selections(),t(e.target).closest(".upfront-module-group-on-edit").length||Upfront.Events.trigger("command:module_group:finish_edit"),t(e.target).closest(".upfront-object-group-on-edit").length||Upfront.Events.trigger("command:object_group:finish_edit")},on_keydown:function(t){var e=Upfront.data.currentEntity;if("undefined"!=typeof e&&e&&e instanceof x&&!(e.$el.find(".redactor-box").length>0)&&e.paddingControl&&!e.$el.find("[contenteditable]:focus").length&&(38===t.keyCode||40===t.keyCode))switch(t.preventDefault(),t.stopPropagation(),t.keyCode){case 38:e.paddingControl.on_up_arrow_click();break;case 40:e.paddingControl.on_down_arrow_click()}},on_mode_switch:function(){Upfront.Application.get_current()!==Upfront.Settings.Application.MODE.RESPONSIVE?this.remove_ruler():this.render_ruler(!0)},on_change_breakpoint:function(t){var e=Upfront.Settings.LayoutEditor.Grid;Upfront.Settings.LayoutEditor.CurrentBreakpoint=t,e.size=t.columns,t.default?(this.$layout.css("width",""),this.render_ruler(!0),this.remove_gutter(),Upfront.Behaviors.LayoutEditor.enable_mergeable()):(this.$layout.width(t.width),this.render_ruler(!1,t.width),this.render_gutter(t.width),Upfront.Behaviors.LayoutEditor.disable_mergeable()),this.update_grid_css()},render_gutter:function(e){var i=this.$el.find(".upfront-layout-gutter");i.length||(i=t('<div class="upfront-layout-gutter"><div class="upfront-layout-gutter-left"></div><div class="upfront-layout-gutter-right"></div></div>'),this.$el.prepend(i)),i.find(".upfront-layout-gutter-left").css("margin-right",Math.ceil(e/2)),i.find(".upfront-layout-gutter-right").css("margin-left",Math.ceil(e/2))},remove_gutter:function(){this.$el.find(".upfront-layout-gutter").remove()},render_ruler:function(e,i){var n,o=Upfront.Settings.LayoutEditor.Grid,i=e?o.size*o.column_width:i,r=this.$el.find(".upfront-ruler-container"),s=r.find(".upfront-ruler"),a=function(t,e,i){return'<div class="upfront-ruler-mark" style="width:'+e+'px;">'+(i?'<div class="upfront-ruler-mark-num">'+t+"</div>":"")+"</div>"};for(r.length||(r=t('<div class="upfront-ruler-container"></div>'),s=t('<div class="upfront-ruler upfront-ui"></div>'),this.$el.prepend(r),r.prepend(s)),s.empty(),s.css("width",i),n=0;n<i;n+=100)s.append(a(n,100,!(n+40>i)));i>n-100&&s.append(a(i,i-(n-100),!0)),this._has_ruler=!0},remove_ruler:function(){this.$el.find(".upfront-ruler-container").remove(),this._has_ruler=!1},update_ruler:function(){if(this._has_ruler){var e=t(window).scrollTop(),i=this.$el.find(".upfront-ruler-container"),n=i.css("position");if(e>0&&"fixed"!=n){var o=this.$el.offset(),r=i.offset();i.css({position:"fixed",top:o.top,left:r.left,right:0,width:"auto"})}else e<=0&&"fixed"==n&&i.css({position:"",top:"",left:"",right:"",width:""})}},on_window_scroll:function(t){var e=t.data;e.update_ruler()},update_grid_css:function(){var e=Upfront.Settings.LayoutEditor.Grid,i=[],n="#page.upfront-layout-view";i.push(n+" { min-width: "+e.column_width*e.size+"px; }"),i.push(n+" .upfront-grid-layout { width: "+e.column_width*e.size+"px; }"),i.push(n+" .upfront-object { padding: "+e.column_padding+"px; }"),i.push(n+" .upfront-overlay-grid {background-size: 100% "+e.baseline+"px; }"),i.push(n+" .plaintxt_padding {padding: "+e.type_padding+"px; }"),i.push(n+" .upfront-inserted_image-wrapper .wp-caption-text, "+n+" .uinsert-image-wrapper { padding: "+e.column_padding+"px; }"),i.push(n+" .upfront-module-group-bg-padding { margin: "+e.column_padding+"px; }"),t("#upfront-grid-style-inline").length?t("#upfront-grid-style-inline").html(i.join("\n")):t("body").append('<style id="upfront-grid-style-inline">'+i.join("\n")+"</style>")},remove:function(){this.local_view&&this.local_view.remove(),this.local_view=null,t(window).off("resize.upfront_layout"),t(window).off("scroll.upfront_layout"),this.stopListening(Upfront.Events,"upfront:start:responsive"),this.bg_setting&&this.bg_setting.remove(),this.bg_setting=null,Backbone.View.prototype.remove.call(this),this.model=!1,this.options=!1},open_edit_background:function(){var t=this;this.bg_setting.open().always(function(){}),this.bg_setting.$el.addClass("upfront-modal-bg-settings-global"),this.listenTo(Upfront.Events,"upfront:start:responsive",function(){t.bg_setting&&t.bg_setting.close(!1)})},fix_height:function(){this.$(".upfront-layout").css("min-height",t(window).height())},remove_selections:function(){Upfront.Behaviors.LayoutEditor.selecting||Upfront.Events.trigger("command:selection:remove")}});new n(function(){a=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.application.rendering.replace(/%s/,"0"),done:Upfront.Settings.l10n.global.application.rendering_success,fixed:!0}),a.render(),t("body").append(a.$el),t("body").append('<div id="render-queue-loading-bar" style="position: fixed; left: 0; top: 0; height: 6px; background-color: #3ea;width: 0%; z-index: 100000;"></div>')},function(e){a.update_loading_text(Upfront.Settings.l10n.global.application.rendering.replace(/%s/,e)),t("#render-queue-loading-bar").width(e+"%")},function(){t("#render-queue-loading-bar").remove(),a.done(),a=!1,l=!1});return{Views:{ObjectView:x,ObjectGroup:U,Module:S,ModuleGroup:C,Wrapper:D,Layout:A,ContextMenu:$,ContextMenuList:w,ContextMenuItem:y,RegionView:P,RegionLightboxView:j,RegionContainerView:z,RegionsView:O},Mixins:{FixedObject:c,FixedObjectInAnonymousModule:u,Anchorable:h}}})}(jQuery),!function(){var t,e,i,n,o,r={}.hasOwnProperty,s=function(t,e){function i(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=function(){function t(){this.options_index=0,this.parsed=[]}return t.prototype.add_node=function(t){return"OPTGROUP"===t.nodeName.toUpperCase()?this.add_group(t):this.add_option(t)},t.prototype.add_group=function(t){var e,i,n,o,r,s;for(e=this.parsed.length,this.parsed.push({array_index:e,group:!0,label:this.escapeExpression(t.label),children:0,disabled:t.disabled}),r=t.childNodes,s=[],n=0,o=r.length;o>n;n++)i=r[n],s.push(this.add_option(i,e,t.disabled));return s},t.prototype.add_option=function(t,e,i){return"OPTION"===t.nodeName.toUpperCase()?(""!==t.text?(null!=e&&(this.parsed[e].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:t.value,text:t.text,html:t.innerHTML,selected:t.selected,disabled:i===!0?i:t.disabled,group_array_index:e,classes:t.className,style:t.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},t.prototype.escapeExpression=function(t){var e,i;return null==t||t===!1?"":/[\&\<\>\"\'\`]/.test(t)?(e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/&(?!\w+;)|[\<\>\"\'\`]/g,t.replace(i,function(t){return e[t]||"&amp;"})):t},t}(),n.select_to_array=function(t){var e,i,o,r,s;for(i=new n,s=t.childNodes,o=0,r=s.length;r>o;o++)e=s[o],i.add_node(e);return i.parsed},e=function(){function t(e,i){this.form_field=e,this.options=null!=i?i:{},t.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers())}return t.prototype.set_default_values=function(){var t=this;return this.click_test_action=function(e){return t.test_active_click(e)},this.activate_action=function(e){return t.activate_field(e)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text&&this.options.allow_single_deselect,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null==this.options.enable_split_word_search||this.options.enable_split_word_search,this.group_search=null==this.options.group_search||this.options.group_search,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null==this.options.single_backstroke_delete||this.options.single_backstroke_delete,
this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null==this.options.display_selected_options||this.options.display_selected_options,this.display_disabled_options=null==this.options.display_disabled_options||this.options.display_disabled_options},t.prototype.set_default_text=function(){return this.default_text=this.form_field.getAttribute("data-placeholder")?this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||t.default_multiple_text:this.options.placeholder_text_single||this.options.placeholder_text||t.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||t.default_no_result_text},t.prototype.mouse_enter=function(){return this.mouse_on_container=!0},t.prototype.mouse_leave=function(){return this.mouse_on_container=!1},t.prototype.input_focus=function(){var t=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return t.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},t.prototype.input_blur=function(){var t=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return t.blur_test()},100))},t.prototype.results_option_build=function(t){var e,i,n,o,r;for(e="",r=this.results_data,n=0,o=r.length;o>n;n++)i=r[n],e+=i.group?this.result_add_group(i):this.result_add_option(i),(null!=t?t.first:void 0)&&(i.selected&&this.is_multiple?this.choice_build(i):i.selected&&!this.is_multiple&&this.single_set_selected_text(i.text));return e},t.prototype.result_add_option=function(t){var e,i;return t.search_match&&this.include_option_in_results(t)?(e=[],t.disabled||t.selected&&this.is_multiple||e.push("active-result"),!t.disabled||t.selected&&this.is_multiple||e.push("disabled-result"),t.selected&&e.push("result-selected"),null!=t.group_array_index&&e.push("group-option"),""!==t.classes&&e.push(t.classes),i=document.createElement("li"),i.className=e.join(" "),i.style.cssText=t.style,i.setAttribute("data-option-array-index",t.array_index),i.innerHTML=t.search_text,this.outerHTML(i)):""},t.prototype.result_add_group=function(t){var e;return(t.search_match||t.group_match)&&t.active_options>0?(e=document.createElement("li"),e.className="group-result",e.innerHTML=t.search_text,this.outerHTML(e)):""},t.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing?this.winnow_results():void 0},t.prototype.reset_single_select_options=function(){var t,e,i,n,o;for(n=this.results_data,o=[],e=0,i=n.length;i>e;e++)t=n[e],t.selected?o.push(t.selected=!1):o.push(void 0);return o},t.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},t.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},t.prototype.winnow_results=function(){var t,e,i,n,o,r,s,a,l,p,d,c,u;for(this.no_results_clear(),o=0,s=this.get_search_text(),t=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),n=this.search_contains?"":"^",i=new RegExp(n+t,"i"),p=new RegExp(t,"i"),u=this.results_data,d=0,c=u.length;c>d;d++)e=u[d],e.search_match=!1,r=null,this.include_option_in_results(e)&&(e.group&&(e.group_match=!1,e.active_options=0),null!=e.group_array_index&&this.results_data[e.group_array_index]&&(r=this.results_data[e.group_array_index],0===r.active_options&&r.search_match&&(o+=1),r.active_options+=1),(!e.group||this.group_search)&&(e.search_text=e.group?e.label:e.html,e.search_match=this.search_string_match(e.search_text,i),e.search_match&&!e.group&&(o+=1),e.search_match?(s.length&&(a=e.search_text.search(p),l=e.search_text.substr(0,a+s.length)+"</em>"+e.search_text.substr(a+s.length),e.search_text=l.substr(0,a)+"<em>"+l.substr(a)),null!=r&&(r.group_match=!0)):null!=e.group_array_index&&this.results_data[e.group_array_index].search_match&&(e.search_match=!0)));return this.result_clear_highlight(),1>o&&s.length?(this.update_results_content(""),this.no_results(s)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},t.prototype.search_string_match=function(t,e){var i,n,o,r;if(e.test(t))return!0;if(this.enable_split_word_search&&(t.indexOf(" ")>=0||0===t.indexOf("["))&&(n=t.replace(/\[|\]/g,"").split(" "),n.length))for(o=0,r=n.length;r>o;o++)if(i=n[o],e.test(i))return!0},t.prototype.choices_count=function(){var t,e,i,n;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,n=this.form_field.options,e=0,i=n.length;i>e;e++)t=n[e],t.selected&&(this.selected_option_count+=1);return this.selected_option_count},t.prototype.choices_click=function(t){return t.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},t.prototype.keyup_checker=function(t){var e,i;switch(e=null!=(i=t.which)?i:t.keyCode,this.search_field_scale(),e){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(t.preventDefault(),this.results_showing)return this.result_select(t);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},t.prototype.clipboard_event_checker=function(){var t=this;return setTimeout(function(){return t.results_search()},50)},t.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},t.prototype.include_option_in_results=function(t){return!(this.is_multiple&&!this.display_selected_options&&t.selected)&&(!(!this.display_disabled_options&&t.disabled)&&!t.empty)},t.prototype.search_results_touchstart=function(t){return this.touch_started=!0,this.search_results_mouseover(t)},t.prototype.search_results_touchmove=function(t){return this.touch_started=!1,this.search_results_mouseout(t)},t.prototype.search_results_touchend=function(t){return this.touch_started?this.search_results_mouseup(t):void 0},t.prototype.outerHTML=function(t){var e;return t.outerHTML?t.outerHTML:(e=document.createElement("div"),e.appendChild(t),e.innerHTML)},t.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:!/iP(od|hone)/i.test(window.navigator.userAgent)&&(!/Android/i.test(window.navigator.userAgent)||!/Mobile/i.test(window.navigator.userAgent))},t.default_multiple_text="Select Some Options",t.default_single_text="Select an Option",t.default_no_result_text="No results match",t}(),t=jQuery,t.fn.extend({chosen:function(n){return e.browser_is_supported()?this.each(function(){var e,o;e=t(this),o=e.data("chosen"),"destroy"===n&&o?o.destroy():o||e.data("chosen",new i(this,n))}):this}}),i=function(e){function i(){return o=i.__super__.constructor.apply(this,arguments)}return s(i,e),i.prototype.setup=function(){return this.form_field_jq=t(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},i.prototype.set_up_html=function(){var e,i;return e=["chosen-container"],e.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&e.push(this.form_field.className),this.is_rtl&&e.push("chosen-rtl"),i={class:e.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(i.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=t("<div />",i),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},i.prototype.register_observers=function(){var t=this;return this.container.bind("mousedown.chosen",function(e){t.container_mousedown(e)}),this.container.bind("mouseup.chosen",function(e){t.container_mouseup(e)}),this.container.bind("mouseenter.chosen",function(e){t.mouse_enter(e)}),this.container.bind("mouseleave.chosen",function(e){t.mouse_leave(e)}),this.search_results.bind("mouseup.chosen",function(e){t.search_results_mouseup(e)}),this.search_results.bind("mouseover.chosen",function(e){t.search_results_mouseover(e)}),this.search_results.bind("mouseout.chosen",function(e){t.search_results_mouseout(e)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(e){t.search_results_mousewheel(e)}),this.search_results.bind("touchstart.chosen",function(e){t.search_results_touchstart(e)}),this.search_results.bind("touchmove.chosen",function(e){t.search_results_touchmove(e)}),this.search_results.bind("touchend.chosen",function(e){t.search_results_touchend(e)}),this.form_field_jq.bind("chosen:updated.chosen",function(e){t.results_update_field(e)}),this.form_field_jq.bind("chosen:activate.chosen",function(e){t.activate_field(e)}),this.form_field_jq.bind("chosen:open.chosen",function(e){t.container_mousedown(e)}),this.form_field_jq.bind("chosen:close.chosen",function(e){t.input_blur(e)}),this.search_field.bind("blur.chosen",function(e){t.input_blur(e)}),this.search_field.bind("keyup.chosen",function(e){t.keyup_checker(e)}),this.search_field.bind("keydown.chosen",function(e){t.keydown_checker(e)}),this.search_field.bind("focus.chosen",function(e){t.input_focus(e)}),this.search_field.bind("cut.chosen",function(e){t.clipboard_event_checker(e)}),this.search_field.bind("paste.chosen",function(e){t.clipboard_event_checker(e)}),this.is_multiple?this.search_choices.bind("click.chosen",function(e){t.choices_click(e)}):this.container.bind("click.chosen",function(t){t.preventDefault()})},i.prototype.destroy=function(){return t(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},i.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},i.prototype.container_mousedown=function(e){return this.is_disabled||(e&&"mousedown"===e.type&&!this.results_showing&&e.preventDefault(),null!=e&&t(e.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!e||t(e.target)[0]!==this.selected_item[0]&&!t(e.target).parents("a.chosen-single").length||(e.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),t(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},i.prototype.container_mouseup=function(t){return"ABBR"!==t.target.nodeName||this.is_disabled?void 0:this.results_reset(t)},i.prototype.search_results_mousewheel=function(t){var e;return t.originalEvent&&(e=-t.originalEvent.wheelDelta||t.originalEvent.detail),null!=e?(t.preventDefault(),"DOMMouseScroll"===t.type&&(e=40*e),this.search_results.scrollTop(e+this.search_results.scrollTop())):void 0},i.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},i.prototype.close_field=function(){return t(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},i.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},i.prototype.test_active_click=function(e){var i;return i=t(e.target).closest(".chosen-container"),i.length&&this.container[0]===i[0]?this.active_field=!0:this.close_field()},i.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=n.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},i.prototype.result_do_highlight=function(t){var e,i,n,o,r;if(t.length){if(this.result_clear_highlight(),this.result_highlight=t,this.result_highlight.addClass("highlighted"),n=parseInt(this.search_results.css("maxHeight"),10),r=this.search_results.scrollTop(),o=n+r,i=this.result_highlight.position().top+this.search_results.scrollTop(),e=i+this.result_highlight.outerHeight(),e>=o)return this.search_results.scrollTop(e-n>0?e-n:0);if(r>i)return this.search_results.scrollTop(i)}},i.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},i.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},i.prototype.update_results_content=function(t){return this.search_results.html(t)},i.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},i.prototype.set_tab_index=function(){var t;return this.form_field.tabIndex?(t=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=t):void 0},i.prototype.set_label_behavior=function(){var e=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=t("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(t){return e.is_multiple?e.container_mousedown(t):e.activate_field()}):void 0},i.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},i.prototype.search_results_mouseup=function(e){var i;return i=t(e.target).hasClass("active-result")?t(e.target):t(e.target).parents(".active-result").first(),i.length?(this.result_highlight=i,this.result_select(e),this.search_field.focus()):void 0},i.prototype.search_results_mouseover=function(e){var i;return i=t(e.target).hasClass("active-result")?t(e.target):t(e.target).parents(".active-result").first(),i?this.result_do_highlight(i):void 0},i.prototype.search_results_mouseout=function(e){return t(e.target).hasClass("active-result")?this.result_clear_highlight():void 0},i.prototype.choice_build=function(e){var i,n,o=this;return i=t("<li />",{class:"search-choice"}).html("<span>"+e.html+"</span>"),e.disabled?i.addClass("search-choice-disabled"):(n=t("<a />",{class:"search-choice-close","data-option-array-index":e.array_index}),n.bind("click.chosen",function(t){return o.choice_destroy_link_click(t)}),i.append(n)),this.search_container.before(i)},i.prototype.choice_destroy_link_click=function(e){return e.preventDefault(),e.stopPropagation(),this.is_disabled?void 0:this.choice_destroy(t(e.target))},i.prototype.choice_destroy=function(t){return this.result_deselect(t[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),t.parents("li").first().remove(),this.search_field_scale()):void 0},i.prototype.results_reset=function(){return this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},i.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},i.prototype.result_select=function(t){var e,i;return this.result_highlight?(e=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?e.removeClass("active-result"):this.reset_single_select_options(),i=this.results_data[e[0].getAttribute("data-option-array-index")],i.selected=!0,this.form_field.options[i.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(i):this.single_set_selected_text(i.text),(t.metaKey||t.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[i.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())):void 0},i.prototype.single_set_selected_text=function(t){return null==t&&(t=this.default_text),t===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(t)},i.prototype.result_deselect=function(t){var e;return e=this.results_data[t],!this.form_field.options[e.options_index].disabled&&(e.selected=!1,this.form_field.options[e.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[e.options_index].value}),this.search_field_scale(),!0)},i.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},i.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":t("<div/>").text(t.trim(this.search_field.val())).html()},i.prototype.winnow_results_set_highlight=function(){var t,e;return e=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),t=e.length?e.first():this.search_results.find(".active-result").first(),null!=t?this.result_do_highlight(t):void 0},i.prototype.no_results=function(e){var i;return i=t('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),i.find("span").first().html(e),this.search_results.append(i),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},i.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},i.prototype.keydown_arrow=function(){var t;return this.results_showing&&this.result_highlight?(t=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(t):void 0:this.results_show()},i.prototype.keyup_arrow=function(){var t;return this.results_showing||this.is_multiple?this.result_highlight?(t=this.result_highlight.prevAll("li.active-result"),t.length?this.result_do_highlight(t.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},i.prototype.keydown_backstroke=function(){var t;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(t=this.search_container.siblings("li.search-choice").last(),t.length&&!t.hasClass("search-choice-disabled")?(this.pending_backstroke=t,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},i.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},i.prototype.keydown_checker=function(t){var e,i;switch(e=null!=(i=t.which)?i:t.keyCode,this.search_field_scale(),8!==e&&this.pending_backstroke&&this.clear_backstroke(),e){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(t),this.mouse_on_container=!1;break;case 13:t.preventDefault();break;case 38:t.preventDefault(),this.keyup_arrow();break;case 40:t.preventDefault(),this.keydown_arrow()}},i.prototype.search_field_scale=function(){var e,i,n,o,r,s,a,l,p;if(this.is_multiple){for(n=0,a=0,r="position:absolute; left: -1000px; top: -1000px; display:none;",s=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],l=0,p=s.length;p>l;l++)o=s[l],r+=o+":"+this.search_field.css(o)+";";return e=t("<div />",{style:r}),e.text(this.search_field.val()),t("body").append(e),a=e.width()+25,e.remove(),i=this.container.outerWidth(),a>i-10&&(a=i-10),this.search_field.css({width:a+"px"})}},i}(e)}.call(this),define("chosen",function(){}),function(t){define("scripts/upfront/global-event-handlers",[],function(){t("body").on("mouseup",function(){t(".upfront-field-select").removeClass("upfront-field-select-expanded")});var e='#page input[type="text"], #page input[type="email"], #page input[type="password"], #page textarea, #page select, #page .upfront-field-select';t("body").on("mouseover",e,function(e){try{t(e.target).closest(".ui-draggable").draggable("disable")}catch(t){}}),t("body").on("mouseout",e,function(e){try{t(e.target).closest(".ui-draggable").draggable("enable")}catch(t){}}),t(document).on("click",function(e){t(".sp-container").length!==t(".sp-container.sp-hidden").length&&t(".sp-container").not(".sp-hidden").each(function(){var e=t(this),i=e.data("sp-options");if(!i||!i.flat){var n=e.parent().find(".sp-replacer");n.removeClass("sp-active"),e.addClass("sp-hidden"),setTimeout(function(){n.removeClass("sp-active"),e.addClass("sp-hidden")},10)}})}),/i(Pad|Phone|Pod)/g.test(navigator.userAgent)&&t(window).on("resize",function(e){setTimeout(function(){t.magnificPopup.instance.updateSize()},500)}),t(document).one("upfront-load",function(){Upfront.Events.once("Upfront:loaded",function(){t(document).on("click","a",function(e){var i,n,o,r,s;e.isDefaultPrevented()||(i=t(e.currentTarget).data("bypass"),i||(o=e.target,r=o.pathname,n=o.getAttribute("href"),s=o.search,"#"==n||o.origin!=window.location.origin||r==window.location.pathname&&s==window.location.search||t(e.target).closest(".redactor_box").length||t(e.target).parents(".redactor-editor").length||(Upfront.mainData.site.indexOf("localhost")>-1&&Upfront.mainData.site+"/"===o.origin+r&&(r="/"),window.location.search.indexOf("dev=true")>-1&&s.indexOf("dev=true")===-1&&(""===s&&(s="?"),s+="dev=true"),e.preventDefault(),o.origin===window.location.origin&&(r=r.replace(window.location.pathname,"")),Upfront.PreviewUpdate._is_dirty&&!confirm(Upfront.Settings.l10n.global.application.navigation_confirm)||Upfront.Application.navigate(r+s,{trigger:!0}))))}).on("keydown",function(e){if(8==e.which){var i=e.target.tagName.toUpperCase();"INPUT"==i||"TEXTAREA"==i||t(e.target).closest(".redactor_box").length||e.target.contentEditable||e.preventDefault()}})})})})}(jQuery),function(t){define("scripts/upfront/inline-panels/panels",[],function(){var e=Backbone.View.extend({className:"upfront-inline-panels upfront-ui",initialize:function(){this.panels=_([])},render:function(){var e=this,i="function"==typeof this.panels?this.panels():this.panels,n=t('<div class="upfront-inline-panels-wrap" />');this.$el.html(""),i.each(function(t){t&&(t.panels_view=e,t.render(),t.delegateEvents(),n.append(t.el))}),this.$el.append(n),"function"==typeof this.on_render&&this.on_render()},on_active:function(){t(".upfront-inline-panels-active").removeClass("upfront-inline-panels-active"),this.$el.addClass("upfront-inline-panels-active")},remove:function(){var t="function"==typeof this.panels?this.panels():this.panels;t&&t.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}});return e})}(jQuery),define("scripts/upfront/inline-panels/panel",[],function(){var t=Backbone.View.extend({className:"upfront-inline-panel upfront-no-select",position_v:"top",position_h:"center",initialize:function(){this.items=_([])},render:function(){var t="function"==typeof this.items?this.items():this.items,e=["upfront-inline-panel-"+this.position_v,"upfront-inline-panel-"+this.position_v+"-"+this.position_h],i=0,n=0;this.$el.html(""),this.collapsedParent=!1,t.each(function(t){t.panel_view=this,t.render(),t.delegateEvents(),this.$el.append(t.el),t.collapsed&&(e.push("upfront-inline-panel-collapsed-parent"),this.collapsedParent=!0),"center"===this.position_v?(i=t.width>i?t.width:i,n+=t.height):(i+=t.width,n=t.height>n?t.height:n),"function"==typeof t.active&&1==t.active()?t.$el.addClass("active"):"function"==typeof t.active&&0==t.active()&&t.$el.removeClass("active")},this),this.$el.addClass(this.className+" "+e.join(" ")),this.collapsedParent&&(n=13),this.$el.css({width:i,height:n})},remove:function(){var t="function"==typeof this.items?this.items():this.items;t&&t.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}});return t}),define("scripts/upfront/inline-panels/item",[],function(){var t=Backbone.View.extend({className:"upfront-inline-panel-item",width:38,height:38,icon_class:"upfront-icon-region",initialize:function(t){this.options=t||{},this.label=this.options.label},render_icon:function(){var t="function"==typeof this.icon?this.icon():this.icon;if(t){var e=this,i=t.split(" "),n=["upfront-icon"],o=this.$el.find(".upfront-icon");_.each(i,function(t){n.push(e.icon_class+"-"+t)}),o.length?o.attr("class",n.join(" ")):this.$el.append('<i class="'+n.join(" ")+'" />')}},render_label:function(){var t="function"==typeof this.label?this.label():this.label;if(t){var e=this.$el.find(".upfront-inline-panel-item-label");this.$el.addClass("labeled"),e.length?e.html(t):this.$el.append('<span class="upfront-inline-panel-item-label">'+t+"</span>")}},render_tooltip:function(){var t="function"==typeof this.tooltip?this.tooltip():this.tooltip;t&&this.$el.attr("title",t)},render:function(){this.render_icon(),this.render_label(),this.render_tooltip(),this.$el.css({width:this.width,height:this.height}),this.$el.attr("id",this.id),"function"==typeof this.on_render&&this.on_render()},open_modal:function(t,e){if(!this.modal){var i=this,n=this.$el.closest(".upfront-region-container");this.modal=new Upfront.Views.Editor.Modal({to:n,top:60}),this.modal.render(),n.append(this.modal.$el)}return this.listenToOnce(Upfront.Events,"entity:region:deactivated",function(){i.close_modal(!1)}),this.modal.open(t,this,e)},close_modal:function(t){return this.modal.close(t)},remove:function(){this.panel_view=!1}});return t}),function(t){define("scripts/upfront/inline-panels/item-multi",["scripts/upfront/inline-panels/item"],function(e){var i=e.extend({events:{"click >.upfront-icon":"toggle_subitem"},initialize:function(){this.sub_items={},this.listenTo(Upfront.Events,"entity:region:activated",this.on_region_change)},get_selected_item:function(){},get_default_item:function(){},get_selected_icon:function(t){return t+"-active"},set_selected_item:function(){},select_item:function(t){this.set_selected_item(t),this.render()},render:function(){var e=this,i=this.get_selected_item()||this.get_default_item(),n=t('<div class="upfront-inline-panel-subitem" />');this.$el.html(""),this.icon=this.get_selected_icon(i),this.render_icon(),this.render_tooltip(),_.each(this.sub_items,function(t,o){t.panel_view=e.panel_view,t.parent_view=e,t.render(),t.delegateEvents(),i!=o&&n.append(t.el)}),n.append(this.sub_items[i].el),this.$el.append(n)},toggle_subitem:function(){this.$el.hasClass("upfront-inline-panel-subitem-active")?this.close_subitem():this.open_subitem()},open_subitem:function(){this.$el.addClass("upfront-inline-panel-subitem-active"),this.$el.removeClass("upfront-inline-panel-subitem-inactive")},close_subitem:function(){this.$el.addClass("upfront-inline-panel-subitem-inactive"),this.$el.removeClass("upfront-inline-panel-subitem-active")},on_region_change:function(t){t.model!=this.model&&this.close_subitem()},remove:function(){this.sub_items&&_.each(this.sub_items,function(t){t.remove()}),this.panel_view=!1,Backbone.View.prototype.remove.call(this)}});return i})}(jQuery),function(t){define("scripts/upfront/inline-panels/control",["scripts/upfront/inline-panels/item"],function(e){var i=e.extend({events:{click:"clicked"},initialize:function(t){this.options=t||{},this.label=this.options.label,this.icon=this.options.icon},clicked:function(e){var i=t(e.target);e.preventDefault(),e.stopPropagation(),this.$el.siblings(".upfront-inline-panel-subitem-active").removeClass("upfront-inline-panel-subitem-active"),i.hasClass("upfront-icon-region-settings")||(i.closest(".upfront-inline-panel-item").hasClass("upfront-control-dialog-open")?i.closest(".upfront-wrapper").removeClass("upfront-inline-panel-item-open"):i.closest(".upfront-wrapper").addClass("upfront-inline-panel-item-open")),this.trigger("click",e)},setIsSelected:function(t){return t?void this.$el.addClass("inline-panel-item-selected"):void this.$el.removeClass("inline-panel-item-selected")}});return i})}(jQuery),function(t){define("scripts/upfront/inline-panels/multi-control",["scripts/upfront/inline-panels/item-multi"],function(e){var i=e.extend({events:{click:"clicked","click .upfront-inline-panel-item":"selectItem"},render:function(){e.prototype.render.call(this,arguments)},clicked:function(e){var i=this.$el.children(".upfront-inline-panel-subitem");t(e.target).closest(i).length>0||(this.trigger("click",e),this.toggle_subitem())},get_selected_item:function(){return this.selected},selectItem:function(e){var i=!1,n=t(e.target).is("i")?t(e.target):t(e.target).find("i");
_.each(this.sub_items,function(t,e){n.hasClass("upfront-icon-region-"+t.icon)&&(i=e)}),i&&(this.selected=i,this.render(),this.trigger("select",i))}});return i})}(jQuery),function(t){define("scripts/upfront/inline-panels/tooltip-control",["scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/control"],function(e,i){var n=Upfront.mainData.l10n.image_element,o=i.extend({multiControl:!0,events:{click:"onClickControl","click .upfront-inline-panel-item":"selectItem"},initialize:function(){var e=this;t(document).click(function(i){var n=t(i.target);n.closest("#page").length&&n[0]!==e.el&&!n.closest(e.el).length&&e.isOpen&&e.close()})},onClickControl:function(t){this.isDisabled||(t.preventDefault(),this.clicked(t),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),this.isOpen?this.close():this.open())},open:function(){this.isOpen=!0,this.$el.addClass("upfront-control-dialog-open")},close:function(){this.isOpen=!1,this.$el.removeClass("upfront-control-dialog-open")},render:function(){e.prototype.render.call(this,arguments);var i,n=this.$(".uimage-caption-control"),o=this,r="";this.$el.hasClass("uimage-caption-control-item")||this.$el.addClass("uimage-caption-control-item"),"undefined"!=typeof this.wrapperClass&&(r=this.wrapperClass),n.length||(n=t('<div class="uimage-caption-control inline-panel-control-dialog '+r+'"></div>'),this.$el.append(n)),_.each(this.sub_items,function(t,e){e===o.selected?t.setIsSelected(!0):t.setIsSelected(!1),t.render(),t.$el.find("i").addClass("upfront-icon-region-caption"),n.append(t.$el),o.listenTo(t,"click",o.selectItem)}),i=this.sub_items[this.selected],i&&("undefined"!=typeof i.icon?this.$el.children("i").addClass("upfront-icon-region-"+i.icon):"undefined"!=typeof i.label&&this.$el.find(".tooltip-content").append(": "+i.label))},get_selected_item:function(){return this.selected},selectItem:function(e){var i=!1,n=t(e.target).is("i")?t(e.target):t(e.target).find("i");_.each(this.sub_items,function(o,r){n.hasClass("upfront-icon-region-"+o.icon)&&(i=r),i||t(e.target).closest(".upfront-inline-panel-item").attr("id")!==o.id||(i=r)}),i&&(this.selected=i,this.render(),this.trigger("select",i))},setDisabled:function(t){this.isDisabled=t,t?this.tooltip=n.ctrl.caption_position_disabled:this.tooltip=n.ctrl.caption_display}});return o})}(jQuery),function(t){define("scripts/upfront/inline-panels/sub-control",["scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/control"],function(e,i){var n=Upfront.mainData.l10n.image_element,o=i.extend({multiControl:!0,events:{click:"onClickControl","click .upfront-inline-panel-item":"selectItem"},initialize:function(){var e=this;t(document).click(function(i){var n=t(i.target);n.closest("#page").length&&n[0]!==e.el&&!n.closest(e.el).length&&e.isOpen&&e.close()}),this.listenTo(Upfront.Events,"upfront:hide:subControl",this.close)},onClickControl:function(t){this.isDisabled||(t.preventDefault(),this.clicked(t),this.$el.siblings(".upfront-sub-control-dialog-open").removeClass("upfront-sub-control-dialog-open"),this.isOpen?this.close():this.open())},open:function(){this.isOpen=!0,this.$el.addClass("upfront-sub-control-dialog-open"),Upfront.Events.trigger("upfront:hide:paddingPanel")},close:function(){this.isOpen=!1,this.$el.removeClass("upfront-sub-control-dialog-open")},render:function(){e.prototype.render.call(this,arguments);var i=this.$(".image-sub-control"),n=this,o=0;i.length||(i=t('<div class="image-sub-control inline-panel-sub-control-dialog"></div>'),this.$el.append(i)),_.each(this.sub_items,function(t,e){e===n.selected?t.setIsSelected(!0):t.setIsSelected(!1),t.render(),t.delegateEvents(),i.append(t.$el),o++}),this.$el.find(".image-sub-control").css("width",38*o)},get_selected_item:function(){return this.selected},setDisabled:function(t){this.isDisabled=t,t?this.tooltip=n.ctrl.caption_position_disabled:this.tooltip=n.ctrl.caption_display}});return o})}(jQuery),function(t){define("scripts/upfront/inline-panels/padding-control",["scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/control"],function(e,i){var n=Upfront.mainData.l10n.global.views,o=i.extend({multiControl:!0,events:{click:"onClickControl"},initialize:function(){var e=this;t(document).click(function(i){var n=t(i.target);n.closest("#page").length&&n[0]!==e.el&&!n.closest(e.el).length&&e.isOpen&&e.close()}),t(document).mouseup(function(i){var n=t(i.target),o=Upfront.data.currentEntity;n.closest("#page").length&&n[0]!==e.el&&!n.closest(e.el).length&&"undefined"!=typeof o&&"undefined"!=typeof o.padding_hint_locked&&o.padding_hint_locked&&(o.padding_hint_locked=!1,o.top_padding_hint_timer=setTimeout(function(){"function"==typeof o.hide_top_padding_hint&&o.hide_top_padding_hint()},1e3),o.bottom_padding_hint_timer=setTimeout(function(){"function"==typeof o.hide_bottom_padding_hint&&o.hide_bottom_padding_hint()},1e3))}),this.default_padding={top:!1,bottom:!1,left:!1,right:!1},this.listenTo(Upfront.Events,"upfront:paddings:updated",this.refresh)},onClickControl:function(e){var i=t(e.target);if(!this.isDisabled)return i.closest(".upfront-icon-region-padding").length?void(i.hasClass(".upfront-field-checkbox")||(e.preventDefault(),this.clicked(e),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),this.listenTo(Upfront.Events,"upfront:hide:paddingPanel",this.close),this.isOpen?this.close():this.open())):void e.stopPropagation()},open:function(){this.isOpen=!0,this.refresh(),this.$el.addClass("upfront-control-dialog-open"),this.update_position(),Upfront.Events.trigger("upfront:hide:subControl");var e=this.$el.closest(".upfront-region-container"),i=t(".upfront-region-container").not(".upfront-region-container-shadow").last();i.get(0)==e.get(0)&&e.addClass("upfront-last-region-padding")},close:function(){this.isOpen=!1,this.$el.removeClass("upfront-control-dialog-open"),this.$el.closest(".upfront-inline-panel-item-open").removeClass("upfront-inline-panel-item-open"),this.$el.closest(".upfront-region-container").removeClass("upfront-last-region-padding")},on_render:function(){var e=this,i=e.$(".upfront-padding-control"),o=t('<div class="upfront-padding-container upfront-padding-container-top"></div>'),r=t('<div class="upfront-padding-container upfront-padding-container-lock"></div>'),s=t('<div class="upfront-padding-container upfront-padding-container-left"></div>'),a=t('<div class="upfront-padding-container upfront-padding-container-right"></div>'),l=t('<div class="upfront-padding-container upfront-padding-container-bottom"></div>'),p=Upfront.Settings.LayoutEditor.Grid.column_padding;e.$el.hasClass("upfront-padding-control-item")||e.$el.addClass("upfront-padding-control-item"),0===i.length&&(i=t('<div class="upfront-padding-control inline-panel-control-dialog"></div>'),e.$el.append(i)),e.default_padding.top===!1&&(e.default_padding.top=p),e.default_padding.bottom===!1&&(e.default_padding.bottom=p),e.default_padding.left===!1&&(e.default_padding.left=p),e.default_padding.right===!1&&(e.default_padding.right=p),e.paddingTop=new Upfront.Views.Editor.Field.Number({model:this.model,use_breakpoint_property:!0,property:"top_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_num")||e.default_padding.top,min:0,max:200,step:5,change:function(t){var t=this.get_value(),i=this.model.get_breakpoint_property_value("lock_padding",!0);"yes"===i&&e.update_locked_values(t),this.model.set_breakpoint_property("use_padding","yes",!0),this.model.set_breakpoint_property("top_padding_use","yes",!0),this.model.set_breakpoint_property("top_padding_slider",t,!0),this.model.set_breakpoint_property("top_padding_num",t),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:top:updated",this.model,Upfront.data.currentEntity)}}),e.paddingLeft=new Upfront.Views.Editor.Field.Number({model:this.model,use_breakpoint_property:!0,property:"left_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("left_padding_num")||e.default_padding.left,min:0,max:200,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("use_padding","yes",!0),this.model.set_breakpoint_property("left_padding_use","yes",!0),this.model.set_breakpoint_property("left_padding_slider",t,!0),this.model.set_breakpoint_property("left_padding_num",t),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:left:updated",this.model,Upfront.data.currentEntity)}}),e.paddingRight=new Upfront.Views.Editor.Field.Number({model:this.model,use_breakpoint_property:!0,property:"right_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("right_padding_num")||e.default_padding.right,min:0,max:200,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("use_padding","yes",!0),this.model.set_breakpoint_property("right_padding_use","yes",!0),this.model.set_breakpoint_property("right_padding_slider",t,!0),this.model.set_breakpoint_property("right_padding_num",t),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:right:updated",this.model,Upfront.data.currentEntity)}}),e.paddingBottom=new Upfront.Views.Editor.Field.Number({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bottom_padding_num")||e.default_padding.bottom,min:0,max:200,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("use_padding","yes",!0),this.model.set_breakpoint_property("bottom_padding_use","yes",!0),this.model.set_breakpoint_property("bottom_padding_slider",t,!0),this.model.set_breakpoint_property("bottom_padding_num",t),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:bottom:updated",this.model,Upfront.data.currentEntity)}}),e.lockPadding=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"padding-lock",use_breakpoint_property:!0,property:"lock_padding",label:"",default_value:0,multiple:!1,values:[{label:"",value:"yes"}],show:function(t){"yes"==t?(e.paddingLeft.$el.find("input").prop("disabled",!0).css("opacity",.4),e.paddingRight.$el.find("input").prop("disabled",!0).css("opacity",.4),e.paddingBottom.$el.find("input").prop("disabled",!0).css("opacity",.4)):(e.paddingLeft.$el.find("input").prop("disabled",!1).css("opacity",1),e.paddingRight.$el.find("input").prop("disabled",!1).css("opacity",1),e.paddingBottom.$el.find("input").prop("disabled",!1).css("opacity",1))},change:function(t){var i=this.model.get_breakpoint_property_value("top_padding_num",!0);"yes"===t&&e.update_locked_values(i),this.model.set_breakpoint_property("lock_padding",t,!0)}}),i.html(""),$paddingControlTitle='<span class="upfront-padding-arrow"></span><span class="upfront-padding-title">'+n.padding_title+"</span>",i.append($paddingControlTitle),$paddingControlTitle='<span class="upfront-padding-keyboard">&nbsp;</span><span class="upfront-checkbox-info" title="'+n.padding_keyboard+'"></span>',i.append($paddingControlTitle),e.paddingTop.render(),o.append(e.paddingTop.$el),i.append(o),e.lockPadding.render(),r.append(e.lockPadding.$el),e.lockPadding.delegateEvents(),i.append(r),e.paddingLeft.render(),s.append(e.paddingLeft.$el),i.append(s),e.paddingRight.render(),a.append(e.paddingRight.$el),i.append(a),e.paddingBottom.render(),l.append(e.paddingBottom.$el),i.append(l),o.on("mousedown",function(){Upfront.data.currentEntity.padding_hint_locked=!0}).on("mouseup",function(){var t=Upfront.data.currentEntity;t.padding_hint_locked=!1,t.top_padding_hint_timer=setTimeout(function(){"function"==typeof t.hide_top_padding_hint&&t.hide_top_padding_hint()},1e3)}),l.on("mousedown",function(){Upfront.data.currentEntity.padding_hint_locked=!0}).on("mouseup",function(){var t=Upfront.data.currentEntity;t.padding_hint_locked=!1,t.bottom_padding_hint_timer=setTimeout(function(){"function"==typeof t.hide_bottom_padding_hint&&t.hide_bottom_padding_hint()},1e3)})},update_locked_values:function(t){this.model.set_breakpoint_property("left_padding_use","yes",!0),this.model.set_breakpoint_property("left_padding_slider",t,!0),this.model.set_breakpoint_property("left_padding_num",t),this.model.set_breakpoint_property("bottom_padding_use","yes",!0),this.model.set_breakpoint_property("bottom_padding_slider",t,!0),this.model.set_breakpoint_property("bottom_padding_num",t),this.model.set_breakpoint_property("right_padding_use","yes",!0),this.model.set_breakpoint_property("right_padding_slider",t,!0),this.model.set_breakpoint_property("right_padding_num",t),this.paddingLeft.get_field().val(t),this.paddingRight.get_field().val(t),this.paddingTop.get_field().val(t),this.paddingBottom.get_field().val(t)},refresh:function(t){if(!t||t===this.model){var e,i,n,o,r=Upfront.Settings.LayoutEditor.Grid.column_padding,s=this.model.get_breakpoint_property_value("top_padding_use",!0),a=this.model.get_breakpoint_property_value("bottom_padding_use",!0),l=this.model.get_breakpoint_property_value("left_padding_use",!0),p=this.model.get_breakpoint_property_value("right_padding_use",!0),d=this.model.get_breakpoint_property_value("lock_padding",!0),c=this.lockPadding.$el.find("input");this.default_padding.top===!1&&(this.default_padding.top=r),this.default_padding.bottom===!1&&(this.default_padding.bottom=r),this.default_padding.left===!1&&(this.default_padding.left=r),this.default_padding.right===!1&&(this.default_padding.right=r),e=s?this.model.get_breakpoint_property_value("top_padding_num",!0):this.default_padding.top,i=a?this.model.get_breakpoint_property_value("bottom_padding_num",!0):this.default_padding.bottom,n=l?this.model.get_breakpoint_property_value("left_padding_num",!0):this.default_padding.left,o=p?this.model.get_breakpoint_property_value("right_padding_num",!0):this.default_padding.right,d?c.attr("checked","checked"):c.removeAttr("checked"),c.trigger("change"),"undefined"!=typeof this.paddingTop&&this.paddingTop.get_field().val(e),"undefined"!=typeof this.paddingBottom&&this.paddingBottom.get_field().val(i),"undefined"!=typeof this.paddingLeft&&this.paddingLeft.get_field().val(n),"undefined"!=typeof this.paddingRight&&this.paddingRight.get_field().val(o)}},on_up_arrow_click:function(){if("undefined"!=typeof this.paddingTop){var t=parseInt(this.model.get_breakpoint_property_value("top_padding_num",!0),10)-5;t=t<0?0:t,this.model.set_breakpoint_property("top_padding_use","yes"),this.model.set_breakpoint_property("top_padding_num",t),this.model.set_breakpoint_property("top_padding_slider",t),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:top:updated",this.model,Upfront.data.currentEntity),this.refresh()}},on_down_arrow_click:function(){if("undefined"!=typeof this.paddingTop){var t=parseInt(this.model.get_breakpoint_property_value("top_padding_num",!0),10)+5;this.model.set_breakpoint_property("top_padding_use","yes"),this.model.set_breakpoint_property("top_padding_num",t),this.model.set_breakpoint_property("top_padding_slider",t),Upfront.Events.trigger("upfront:paddings:updated",this.model,Upfront.data.currentEntity),Upfront.Events.trigger("upfront:paddings:top:updated",this.model,Upfront.data.currentEntity),this.refresh()}},update_position:function(){var t=this.$el.prevAll().length,e=38*t,i=Upfront.Util.isRTL()?"right":"left";this.$el.find(".upfront-padding-control").css(i,-e),this.$el.find(".upfront-padding-arrow").css(i,e)}});return o})}(jQuery),function(t){define("scripts/upfront/inline-panels/collapsed-multi-control",["scripts/upfront/inline-panels/control","scripts/upfront/inline-panels/multi-control"],function(e,i){var n=i.extend({collapsed:!0,className:"upfront-inline-panel-item inline-panel-collapsed-control",render:function(){if(!this.sub_items.collapsedControl){var t=new e;t.icon="collapsedControl",t.tooltip="More tools",this.sub_items.collapsedControl=t}this.selected="collapsedControl",this.constructor.__super__.render.call(this,arguments)},selectItem:function(e){var n=!1,o=!1,r=t(e.target).is("i")?t(e.target):t(e.target).find("i");if(_.each(this.sub_items,function(t,e){r.hasClass("upfront-icon-region-"+t.icon)&&(n=t,o=e)}),n){if(n instanceof i||n.multiControl===!0)return!1;this.render(),this.trigger("select",o)}},open_subitem:function(){_.each(this.sub_items,function(t){t instanceof i&&t.close_subitem()}),this.constructor.__super__.open_subitem.call(this,arguments)}});return n})}(jQuery),define("scripts/upfront/inline-panels/control-panel",["scripts/upfront/inline-panels/panel","scripts/upfront/inline-panels/collapsed-multi-control","scripts/upfront/inline-panels/tooltip-control"],function(t,e,i){var n=Upfront.mainData.l10n.image_element,o=t.extend({position_v:"none",position_h:"none",setWidth:function(t){var o,r=this.items._wrapped,s=_.extend({widthThreshold:100,width:101,heightThreshold:100,height:101},t);s.width<s.widthThreshold||s.height<s.heightThreshold?this.collapsed!==!0&&(o=new e,_.each(r,function(t){t instanceof i&&t.setDisabled(!0),o.sub_items[t.icon]=t}),o.icon="collapsedControl",o.tooltip=n.ctrl.more_tools,o.position="left",this.items=_([o]),this.collapsed=!0):(this.collapsed&&(this.items=_([]),_.each(r[0].sub_items,function(t,e){"collapsedControl"!==e&&this.items.push(t),t instanceof i&&t.setDisabled(!1)},this)),this.collapsed=!1)},delegateEvents:function(){Backbone.View.prototype.delegateEvents.call(this,arguments),this.items&&this.items.each&&this.items.each(function(t){t.delegateEvents()})}});return o}),define("text!scripts/upfront/inline-panels/templates/panel-control-template.html",[],function(){return'<div class="uimage-control-panel upfront-ui">\n\t<div class="uimage-control-panel-content"></div>\n\t{[ if (!hideOkButton) { ]}\n\t<button type="button" class="upfront-save_settings"><i class="icon-ok"></i> {{ l10n.ok }}</button>\n\t{[ } ]}\n</div>\n'}),function(t){define("scripts/upfront/inline-panels/dialog-control",["scripts/upfront/inline-panels/control","text!scripts/upfront/inline-panels/templates/panel-control-template.html"],function(e,i){var n=Upfront.mainData.l10n.image_element,o=e.extend({multiControl:!0,hideOnClick:!0,events:{click:"onClickControl","click button":"onClickOk"},initialize:function(t){var e=this;this.options=t||{},this.listenTo(Upfront.Events,"dialog-control:open",function(t){e!==t&&e.close()})},render:function(){e.prototype.render.call(this,arguments);var o,r=this;return this.$el.hasClass("uimage-control-panel-item")||this.$el.addClass("uimage-control-panel-item"),this.view&&(this.view.render(),this.view.delegateEvents()),this.panel||(o=t(_.template(i,{l10n:n.template,hideOkButton:this.hideOkButton})),o.addClass("inline-panel-control-dialog"),o.addClass("inline-panel-control-dialog-"+this.id),this.$el.append(o),o.find(".uimage-control-panel-content").html("").append(this.view.$el),this.panel=o,t(document).on("click.dialog-control."+r.cid,r,r.onDocumentClick)),this},remove:function(){t(document).off("click.dialog-control."+this.cid)},onDocumentClick:function(e){var i=t(e.target),n=e.data;i.closest("#page").length&&i[0]!==n.el&&!i.closest(n.el).length&&n.isopen&&n.close()},onClickControl:function(e){return this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),!t(e.target).closest(".upfront-icon").length||t(e.target).closest("upfront-icon-media-label-delete").length?void e.stopPropagation():(e.preventDefault(),this.clicked(e),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),void(this.isopen?this.close():this.open()))},onClickOk:function(t){t.preventDefault(),this.trigger("panel:ok",this.view)},bindEvents:function(){this.panel.find("button").on("click",function(){})},open:function(){if(this.isopen=!0,this.$el.addClass("upfront-control-dialog-open"),this.trigger("panel:open"),Upfront.Events.trigger("dialog-control:open",this),this.$el.is("#link")){var e=this.$el.closest(".upfront-region-container"),i=t(".upfront-region-container").not(".upfront-region-container-shadow").last();i.get(0)==e.get(0)&&e.addClass("upfront-last-region-padding")}return this},close:function(){return this.isopen?(this.isopen=!1,this.$el.removeClass("upfront-control-dialog-open"),this.trigger("panel:close"),this.$el.closest(".upfront-region-container").removeClass("upfront-last-region-padding"),this):this}});return o})}(jQuery),function(t){define("scripts/upfront/inline-panels/image-control",["scripts/upfront/inline-panels/control","text!scripts/upfront/inline-panels/templates/panel-control-template.html"],function(e,i){var n=(Upfront.mainData.l10n.image_element,e.extend({multiControl:!0,hideOnClick:!1,hideOkButton:!0,width:26,height:18,events:{click:"onClickControl","click button":"onClickOk"},initialize:function(t){var e=this;this.options=t||{},this.listenTo(Upfront.Events,"image-control:open",function(t){e!==t&&e.close()})},render:function(){e.prototype.render.call(this,arguments);return this.$el.hasClass("image-edit-control-panel-item")||this.$el.addClass("image-edit-control-panel-item"),this.view&&(this.view.render(),this.view.delegateEvents()),this.panel||(this.$el.append('<div class="uimage-control-panel image-control-button"></div>'),this.$el.find(".image-control-button").append(this.view.$el)),this},remove:function(){t(document).off("click.dialog-control."+this.cid)},onDocumentClick:function(e){var i=t(e.target),n=e.data;i.closest("#page").length&&i[0]!==n.el&&!i.closest(n.el).length&&n.isopen&&n.close()},onClickControl:function(t){this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),t.preventDefault(),this.clicked(t),this.isopen?this.close():this.open()},open:function(){return this.isopen=!0,this.$el.addClass("upfront-control-dialog-open"),this.trigger("panel:open"),Upfront.Events.trigger("dialog-control:open",this),this},close:function(){return this.isopen=!1,this.$el.removeClass("upfront-control-dialog-open"),this.trigger("panel:close"),this}}));return n})}(jQuery),define("scripts/upfront/inline-panels/controls/visit-link",["scripts/upfront/inline-panels/control"],function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.content:Upfront.mainData.l10n.global.content,i=t.extend({className:"upfront-inline-panel-item visit-link-control",initialize:function(t){this.options=t||{},this.constructor.__super__.initialize.call(this,t),this.linkLabel=_.extend({unlink:e.not_linked,lightbox:e.open_lightbox,anchor:e.scroll_to_anchor,entry:e.go_to_post,external:e.open_ext_link,email:e.send_email,phone:e.dial_number},t.linkLabel||{}),this.setOptions(this.options.url,this.options.type),this.hideIfUnlink=t.hideIfUnlink===!0,this.setOptions(this.options.url)},setOptions:function(t,e){var i=e?e:Upfront.Util.guessLinkType(t);this.url=t,this.icon="visit-link-"+i,this.label=this.getTextByLinkType(i)},clicked:function(t){this.constructor.__super__.clicked.call(this,t),""!==this.url&&Upfront.Util.visitLink(this.url)},setLink:function(t,e){this.setOptions(t,e),this.render()},on_render:function(){this.hideIfUnlink&&"unlink"==Upfront.Util.guessLinkType(this.url)?this.$el.hide():this.$el.is(":visible")||this.$el.show()},getTextByLinkType:function(t){return this.linkLabel[t]}});return i}),define("scripts/upfront/inline-panels/controls/link-panel",["scripts/upfront/inline-panels/dialog-control"],function(t){var e=t.extend({initialize:function(t){this.options=t||{},this.constructor.__super__.initialize.call(this,t),this.icon=this.options.icon,this.tooltip=this.options.tooltip,this.id=this.options.id,this.view=new Upfront.Views.Editor.LinkPanel({model:this.model,button:!1}),this.listenTo(this.view,"url:changed",this.onClickOk)},onClickOk:function(t){(t||{}).preventDefault&&t.preventDefault(),"lightbox"===this.view.model.get("type")&&""!==this.view.$el.find(".js-ulinkpanel-lightbox-input").val()&&this.view.createLightBox(),this.close()}});return e}),define("scripts/upfront/link-model",[],function(){var t=Backbone.Model.extend({defaults:{type:"unlink",url:"",target:"_self"},initialize:function(){this.on("change:type",this.updateTarget,this)},updateTarget:function(){_.contains(["lightbox","anchor"],this.get("type"))&&(console.log("we have an anchor or a lightbox"),this.set({target:"_self"},{silent:!0}))}});return t}),function(t){define("scripts/upfront/inline-panels/controls/group-link-panel",["scripts/upfront/inline-panels/controls/link-panel","scripts/upfront/link-model"],function(e,i){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,o=e.extend({className:"upfront-inline-panel-item group-link-control",initialize:function(t){var e=this;this.options=t||{},this.constructor.__super__.constructor.__super__.initialize.call(this,t),this.icon=this.options.icon,this.tooltip=this.options.tooltip,this.id=this.options.id,this.link=new i({type:this.options.linkType,url:this.options.linkUrl,target:this.options.linkTarget,object:this.options.linkObject,object_id:this.options.linkObjectId}),this.view=new Upfront.Views.Editor.LinkPanel({model:this.link,button:!1,title:n.link_group_to}),this.listenTo(this.link,"change change:target change:type",function(t){e.render_label(),this.trigger("change",{url:t.get("url"),target:t.get("target"),type:t.get("type")})})},label:function(){return"unlink"!=this.link.get("type")?n.edit_link:n.not_linked},onClickControl:function(e){this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),t(e.target).closest(".inline-panel-control-dialog").length||(e.preventDefault(),this.isopen?this.close():this.open())}});return o})}(jQuery),define("scripts/upfront/inline-panels/inline-panels",["scripts/upfront/inline-panels/panels","scripts/upfront/inline-panels/panel","scripts/upfront/inline-panels/item","scripts/upfront/inline-panels/item-multi","scripts/upfront/inline-panels/control","scripts/upfront/inline-panels/multi-control","scripts/upfront/inline-panels/tooltip-control","scripts/upfront/inline-panels/sub-control","scripts/upfront/inline-panels/padding-control","scripts/upfront/inline-panels/control-panel","scripts/upfront/inline-panels/dialog-control","scripts/upfront/inline-panels/image-control","scripts/upfront/inline-panels/collapsed-multi-control","scripts/upfront/inline-panels/controls/visit-link","scripts/upfront/inline-panels/controls/link-panel","scripts/upfront/inline-panels/controls/group-link-panel"],function(t,e,i,n,o,r,s,a,l,p,d,c,u,h,f,_){return{Panels:t,Panel:e,Item:i,ItemMulti:n,Control:o,MultiControl:r,TooltipControl:s,SubControl:a,PaddingControl:l,ControlPanel:p,DialogControl:d,ImageControl:c,CollapsedMultiControl:u,Controls:{VisitLink:h,LinkPanel:f,GroupLinkPanel:_}}}),function(t){define("scripts/upfront/element-settings/sidebar",[],function(){t("body").append('<div id="element-settings-sidebar" />'),t("#element-settings-sidebar").width(0).css("opacity",0);var e,i,n,o=function(){if(e){e.cleanUp(),e=!1,t("#element-settings-sidebar").width(10).css("opacity",0).html(""),Upfront.Events.off("element:settings:saved",o),Upfront.Events.off("element:settings:cancel",r);var i=t("#sidebar-ui");i.length&&i.removeClass("element-settings-activated")}},r=function(){var t=new Upfront.Collections.Properties(n.properties);t._events=i.get("properties")._events,i.set("properties",t),o()},s=function(s,a){var l,p;if(e)return void Upfront.Events.trigger("element:settings:canceled");l=_(Upfront.Application.LayoutEditor.Objects).reduce(function(t,e){return s instanceof e.View?e:t},!1),l=l&&l.Settings?l:Upfront.Views.Editor.Settings,p="undefined"!=typeof a?a:l.Settings,e=new p({model:s.model,anchor:!!l&&l.anchor}),e.for_view=s,e.render(),t("#element-settings-sidebar").html(e.el),t("#element-settings-sidebar").append('<div id="preventElementsUsageOverlay"><span></span></div>'),t("#element-settings-sidebar").width(260).css("opacity",""),t(".uf-settings-panel--expanded:not(:first)").toggleClass("uf-settings-panel--expanded").find(".uf-settings-panel__body").toggle(),Upfront.Events.on("element:settings:saved",o),i=s.model,n=Upfront.Util.model_to_json(s.model),Upfront.Events.once("element:settings:canceled",r),setTimeout(function(){t("#element-settings-sidebar").removeClass("collapsed")},500),Upfront.Events.trigger("element:settings:render");var d=t("#sidebar-ui");d.length&&d.addClass("element-settings-activated")};Upfront.Events.on("element:settings:activate",s),Upfront.Events.on("entity:removed:after",o),Upfront.Events.on("upfront:layout_size:change_breakpoint",o),Upfront.Events.on("upfront:edit_content_style:start",o)})}(jQuery),define("text!scripts/upfront/templates/link-panel.html",[],function(){return'<div class="ulinkpanel-title">{{title}}</div>\n<form>\n{[if(type == \'external\') { ]}\n<div class="upfront-field-wrap ulinkpanel-external-wrap">\n\t<input type="text" value="{{link.url}}" placeholder="{{Upfront.Settings.l10n.global.ueditor.type_link_url}}" class="upfront-field-text js-ulinkpanel-input-url js-ulinkpanel-input-external">\n</div>\n{[ } ]}\n{[if(type == \'phone\') { ]}\n<div class="upfront-field-wrap ulinkpanel-external-wrap">\n\t<input type="text" value="{{link.url}}" placeholder="{{Upfront.Settings.l10n.global.ueditor.type_link_phone}}" class="upfront-field-text js-ulinkpanel-input-url js-ulinkpanel-input-external">\n</div>\n{[ } ]}\n{[if(type == \'email\') { ]}\n<div class="upfront-field-wrap ulinkpanel-external-wrap">\n\t<input type="text" value="{{link.url}}" placeholder="johnsmith@example.com" class="upfront-field-text js-ulinkpanel-input-url js-ulinkpanel-input-external">\n</div>\n{[ } ]}\n{[if(type == \'entry\') { ]}\n<div class="upfront-field-wrap ulinkpanel-entry-wrap">\n\t<a title="{{Upfront.Settings.l10n.global.content.change_link}}" class="ulinkpanel-entry-url js-ulinkpanel-input-url js-ulinkpanel-input-entry" href="#">{{(!link.url || link.url==\'\' || link.url==\'http://\')? Upfront.Settings.l10n.global.content.select :link.url}}</a>\n</div>\n{[ } ]}\n{[if(type == \'anchor\') { ]}\n<div class="anchor-selector">\n</div>\n{[ } ]}\n{[if(type == \'lightbox\') { ]}\n<div class="js-ulinkpanel-input-url js-ulinkpanel-input-lightbox clearfix">\n\t{[ if(lightboxes.length) { ]}\n\t\t<div class="lightbox-selector">\n\t\t</div>\n\t\t<a href="{{link.url}}" class="link-panel-lightbox-trigger">{{Upfront.Settings.l10n.global.content.open_lightbox}}</a>\n\t{[ } else { ]}\n\n\t{[ } ]}\n\n    <div class="js-ulinkpanel-new-lightbox ulinkpanel-new-lightbox">\n        <div class="ulinkpanel-title">{{Upfront.Settings.l10n.global.content.create_lightbox}}</div>\n        <input type="text" name="new_lightbox" class="upfront-field upfront-field-text upfront-field-empty ulinkpanel-lightbox-input js-ulinkpanel-lightbox-input" value="" placeholder="{{Upfront.Settings.l10n.global.content.lightbox_name}}" />\n    </div>\n</div>\n{[ } ]}\n</form>\n{[if(button) { ]}\n<div class="upfront-settings-button_panel">\n\t<button type="button" class="upfront-save_settings js-ulinkpanel-ok"><i class="icon-ok"></i> {{Upfront.Settings.l10n.global.content.ok}}</button>\n</div>\n{[ } ]}\n'}),function(t){define("scripts/upfront/link-panel",["scripts/upfront/link-model","text!scripts/upfront/templates/link-panel.html"],function(e,i){var n=function(){var t,e=Upfront.Application.layout.get("regions"),i=[{id:"#page",label:Upfront.Settings.l10n.global.views.back_to_top}];return t=function(e){e.each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&i.push({id:"#"+n,label:n}),e.get("objects")&&(e.get("objects")||{}).each?e.get("objects").each(function(t){var e=t.get_property_value_by_name("anchor");e&&e.length&&i.push({id:"#"+e,label:e})}):e.get("modules")&&t(e.get("modules"))})},e.each(function(e){var n=e.attributes.title,o="#upfront-region-container-"+e.attributes.name;
i.push({id:o,label:n}),t(e.get("modules"))}),i},o=function(){var t=[];return _.each(Upfront.data.ugallery.postTypes,function(e){"attachment"!=e.name&&t.push({name:e.name,label:e.label})}),t},r=function(){var t=[],e=(Upfront.Application.layout||{}).get?Upfront.Application.layout.get("regions"):[];return _.each(e.models,function(e){"lightbox"==e.attributes.sub&&t.push({id:"#"+e.get("name"),label:e.get("title")})}),t},s=Backbone.View.extend({tpl:_.template(i),defaultLinkTypes:{unlink:!0,external:!0,entry:!0,anchor:!0,image:!1,lightbox:!0,email:!0,phone:!0,homepage:!0},events:{"click .js-ulinkpanel-input-entry":"openPostSelector","keydown .js-ulinkpanel-lightbox-input":"onLightboxNameInputChange","blur .js-ulinkpanel-input-external":"onUrlInputBlur","click .upfront-save_settings":"onOkClick","keydown .js-ulinkpanel-input-url.js-ulinkpanel-input-external":"onExternalUrlKeydown","click .link-panel-lightbox-trigger":"visit_lightbox"},className:"ulinkpanel-dark",visit_lightbox:function(e){e.preventDefault();var i=t(e.target).attr("href");if(i&&""!==i){var n=Upfront.Application.layout.get("regions");if(region=!!n&&n.get_by_name(this.getUrlanchor(i)),region){_.each(n.models,function(t){"lightbox"==t.attributes.sub&&Upfront.data.region_views[t.cid].hide()});var o=Upfront.data.region_views[region.cid];o.show()}}},getUrlanchor:function(e){if("undefined"==typeof e&&(e=t(location).attr("href")),e.indexOf("#")>=0){var i=e.split("#");return i[1]}return!1},initialize:function(t){if(t.linkTypes&&t.linkTypes.image&&t.linkTypes.image===!0&&_.isUndefined(t.imageUrl))throw'Provide "imageUrl" if "linkTypes" option has { image: true } when initializing LinkPanel.';if(this.options=t||{},this.linkTypes=_.extend({},this.defaultLinkTypes,t.linkTypes||{}),this.theme=t.theme||"dark",this.button=t.button||!1,this.title=t.title||Upfront.Settings.l10n.global.content.links_to,"undefined"==typeof t.model)return void Upfront.Util.log("There was no link model, use new linking.");var e=this.get_mapped_url();"anchor"===this.model.get("type")&&null!==this.model.get("url").match(/^#/)&&this.model.set({url:e+this.model.get("url")},{silent:!0}),this.listenTo(this.model,"change:type",this.handleTypeChange)},get_mapped_url:function(){var t=Upfront.mainData.site||document.location.origin,e=Upfront.mainData.siteUrl||document.location.origin,i=e.split("/")[3],n=document.location.pathname;if(t!==e&&i&&""!==i&&n.search(i)>-1){var o=n.split("/");o.shift(),o.shift(),n="/"+o.join("/")}return n.search("edit")>-1?"":t+n},onOkClick:function(){"lightbox"===this.model.get("type")&&""!==this.$el.find(".js-ulinkpanel-lightbox-input").val()?this.createLightBox():(this.close(),this.model.trigger("change"))},onExternalUrlKeydown:function(t){return 13!==t.which||(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),this.onOkClick(t),this.trigger("url:changed"),!1)},close:function(){this.trigger("linkpanel:close")},handleTypeChange:function(){"homepage"===this.model.get("type")?this.model.set({url:Upfront.mainData.site},{silent:!0}):this.model.set({url:""},{silent:!0}),this.render(),"entry"===this.model.get("type")&&this.openPostSelector(),"image"===this.model.get("type")&&this.model.set({url:this.options.imageUrl})},getLinkTypeValue:function(t){var e=Upfront.Settings.l10n.global.content;switch(t){case"homepage":return{value:"homepage",label:e.homepage};case"unlink":return{value:"unlink",label:e.no_link};case"external":return{value:"external",label:e.url};case"email":return{value:"email",label:e.email};case"phone":return{value:"phone",label:e.phone};case"entry":return{value:"entry",label:e.post_or_page};case"anchor":return{value:"anchor",label:e.anchor};case"image":return{value:"image",label:e.larger_image};case"lightbox":return{value:"lightbox",label:e.lightbox}}},openPostSelector:function(t){t&&t.preventDefault();var e=this,i={postTypes:o()};Upfront.Views.Editor.PostSelector.open(i).done(function(t){e.model.set({url:t.get("permalink"),object:t.get("post_type"),object_id:t.get("ID")}),e.render()})},onLightboxNameInputChange:function(t){13===t.which&&(t.preventDefault(),this.createLightBox())},createLightBox:function(){var e=t.trim(this.$(".js-ulinkpanel-lightbox-input").val());return e?(this.model.set({url:"#"+Upfront.Application.LayoutEditor.getLightboxSafeName(e)}),Upfront.Application.LayoutEditor.createLightboxRegion(e),this.model.trigger("change",!0),void this.render()):(Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.views.ltbox_empty_name_nag,"error"),!1)},onUrlInputBlur:function(e){var i=t(e.currentTarget).val().trim();"external"!==this.model.get("type")||i.match(/https?:\/\//)||_.isEmpty(i)||(i="http://"+i),"email"!==this.model.get("type")||i.match(/^mailto:/)||(i="mailto:"+i),"phone"!==this.model.get("type")||i.match(/^tel:/)||(i="tel:"+i,this.model.set({target:"_self"})),this.model.set({url:i}),this.render()},render:function(){if(!this.model)return void this.$el.html("Error occurred, link panel switch to new style.");var t={title:this.title,link:this.model.toJSON(),checked:'checked="checked"',lightboxes:r(),button:this.button,type:this.model.get("type")};this.$el.html(this.tpl(t)),this.renderTypeSelect(),"anchor"==this.model.get("type")&&this.renderAnchorSelect(),"lightbox"==this.model.get("type")&&r()&&this.renderLightBoxesSelect(),_.contains(["external","entry","homepage"],this.model.get("type"))&&this.renderTargetRadio(),this.delegateEvents()},renderTypeSelect:function(){var t=this,e=[];_.each(this.linkTypes,function(t,i){t&&e.push(this.getLinkTypeValue(i))},this),this.typeSelect=new Upfront.Views.Editor.Field.Select({label:"",values:e,default_value:this.model.get("type"),change:function(){t.model.set({type:this.get_value()})}}),this.typeSelect.render(),this.$el.find("form").prepend(this.typeSelect.el)},renderTargetRadio:function(){var t=this;this.targetRadio=new Upfront.Views.Editor.Field.Radios({label:Upfront.Settings.l10n.global.content.target,default_value:this.model.get("target")||"_self",layout:"horizontal-inline",values:[{label:Upfront.Settings.l10n.global.content.blank,value:"_blank"},{label:Upfront.Settings.l10n.global.content.self,value:"_self"}],change:function(){t.model.set({target:this.get_value()})}}),this.targetRadio.render(),this.$el.find("form").append(this.targetRadio.el)},renderAnchorSelect:function(){var t=this.model,e=this.get_mapped_url(),i=[{label:"Choose Anchor...",value:""}];_.each(n(),function(t){i.push({label:t.label,value:e+t.id})});var o=this.model.get("url");o=o?o:"",o=o.indexOf("#")!==-1?o:"",this.anchorSelect=new Upfront.Views.Editor.Field.Select({label:"",values:i,default_value:o,change:function(){var e=this.get_value();null!==document.location.pathname.match(/^\/create_new\//)&&(e="#"+e.split("#")[1]),t.set({url:e})}}),this.anchorSelect.render(),this.$el.find(".anchor-selector").append(this.anchorSelect.el)},renderLightBoxesSelect:function(){var e=this.model,i=[{label:"Choose Lightbox...",value:""}];_.each(r()||[],function(t){i.push({label:t.label,value:t.id})});var n=this.model.get("url");n=n?n:"",n=n.match(/^#/)?n:"",this.lightboxSelect=new Upfront.Views.Editor.Field.Select({label:"",values:i,default_value:n,change:function(){e.set({url:this.get_value()}),t(".link-panel-lightbox-trigger").attr("href",this.get_value())}}),this.lightboxSelect.render(),this.$el.find(".lightbox-selector").append(this.lightboxSelect.el)},delegateEvents:function(t){this.typeSelect&&this.typeSelect.delegateEvents(),this.anchorSelect&&this.anchorSelect.delegateEvents(),this.lightboxSelect&&this.lightboxSelect.delegateEvents(),Backbone.View.prototype.delegateEvents.call(this,t)}});return s})}(jQuery),define("text!upfront/templates/post-editor/edition-box.html",[],function(){return'<div>\n    <script id="ueditor-box-main" type="text/template">\n        <div class="ueditor-box ueditable" id="{{cid}}">\n\t\t\t<div class="ueditor-box-content-wrap">\n\t\t\t\t<div class="ueditor-box-content">\n\t\t\t\t\t<!--\n\t\t\t\t\t<div class="misc-pub-section misc-pub-post-category"></div>\n\t\t\t\t\t<div class="misc-pub-section misc-pub-post-tags"></div>\n\t\t\t\t\t-->\n\t\t\t\t\t<div class="misc-pub-section misc-pub-post-url"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ueditor-box-content-wrap">\n\t\t\t\t<div class="ueditor-bix-top-buttons">\n\t\t\t\t\t{[ if(draftButton){ ]}\n\t\t\t\t\t<a class="ueditor-action ueditor-action-draft" href="#">{{Upfront.Settings.l10n.global.content.save_draft}}</a>\n\t\t\t\t\t{[ } ]}\n\t\t\t\t\t<a class="ueditor-action ueditor-action-preview" target="_blank" href="{{previewLink}}">{{Upfront.Settings.l10n.global.content.preview}}</a>\n\t\t\t\t</div>\n\t\t\t\t<div class="ueditor-box-content">\n\t\t\t\t\t<div class="misc-pub-section misc-pub-post-status"></div>\n\t\t\t\t\t<div class="misc-pub-section misc-pub-visibility"></div>\n\t\t\t\t\t<div class="misc-pub-section  misc-pub-schedule"></div>\n\t\t\t\t</div>\n\n\t\t\t\t<!--\n\t\t\t\t<div class="ueditor-box-bottom-buttons">\n\t\t\t\t\t{[ if(cancelButton){ ]}\n\t\t\t\t\t<a class="ueditor-button-cancel-edit" href="#">{{Upfront.Settings.l10n.global.content.cancel}}</a>\n\t\t\t\t\t{[ } ]}\n\t\t\t\t\t<a class="ueditor-action-publish" href="#">{{buttonText}}</a>\n\t\t\t\t\t<a href="#" class="ueditor-action-trash ueditor-box-icon ueditor-box-icon-text" title="{{Upfront.Settings.l10n.global.content.trash}}">{{Upfront.Settings.l10n.global.content.trash}}</a>\n\t\t\t\t</div>\n\t\t\t\t-->\n\n\t\t\t</div>\n        </div>\n    </script>\n\n\t<script id="post-box-metadesc" type="text/template">\n\t\t<div class="ueditor-post-page-metadesc">\n\t\t\t<p id="post-metadesc" class="ueditor-previous-data ueditor-previous-data-toggle">\n\t\t\t\t<span>{{ metadesc || Upfront.Settings.l10n.global.views.meta_description }}</span>\n\t\t\t\t<a href="#" class="ueditor-edit-post-metadesc ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</a>\n\t\t\t</p>\n\n\n\t\t\t<div class="ueditor-togglable ueditor-togglable-post-metadesc">\n\t\t\t\t<div class="ueditor-row">\n\t\t\t\t\t<textarea class="upfront-field-text upfront-field-textarea ueditor-post-metadesc-text">{{metadesc}}</textarea>\n\t\t\t\t\t<div class="char-counter {[ if (char_limit < metadesc.length) { ]}over-limit{[ } ]}" data-limit="{{char_limit}}">\n\t\t\t\t\t\t<span class="current">{{metadesc.length}}</span> / <span class="limit">{{char_limit}}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href="#" class="ueditor-save-post-data  ueditor-button-save ueditor-button-small-ok">{{Upfront.Settings.l10n.global.content.ok}}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</script>\n\n    <script id="post-url-editor" type="text/template">\n        <label id="post-url-display-label">{{url_label}}:</label>\n\n\t\t<div class="ueditor-post-page-title">\n\t\t\t<p id="post-title" class="ueditor-previous-data ueditor-previous-data-toggle"><span>{{postTitle}}</span> <a href="#" class="ueditor-edit-post-title ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</a></p>\n\n\n\t\t\t<div class="ueditor-togglable ueditor-togglable-post-title">\n\t\t\t\t<div class="ueditor-row">\n\t\t\t\t\t<input type="text" class="upfront-field-text ueditor-post-title-text" value="{{postTitle}}">\n\t\t\t\t\t<a href="#" class="ueditor-save-post-data  ueditor-button-save ueditor-button-small-ok">{{Upfront.Settings.l10n.global.content.ok}}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="ueditor-post-page-url">\n\t\t\t<p id="post-url-display">{{rootUrl}}</p>\n\t\t\t<p id="post-url-slug" class="ueditor-previous-data ueditor-previous-data-toggle"><span>{{slug}}</span> <a href="#" class="ueditor-edit-post-url ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</a></p>\n\n\t\t\t<div class="ueditor-togglable ueditor-togglable-post-url">\n\t\t\t\t<div class="ueditor-row">\n\t\t\t\t\t<input type="text" class="upfront-field-text ueditor-post-url-text" value="{{slug}}">\n\t\t\t\t\t<a href="#" class="ueditor-save-post-data  ueditor-button-save ueditor-button-small-ok">{{Upfront.Settings.l10n.global.content.ok}}</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n    </script>\n\n\t<script type="text/template" id="upfront-term-list-tpl">\n        <label id="post-categories-display-label">{{labels.name}}:</label>\n        <!--\n\t\t<a href="#" class="ueditor-edit-categories ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</a>\n\n\t\t<p id="post-category-display" class="ueditor-previous-data ueditor-previous-data-toggle ueditor-previous-data-small">\n            {{postTerms.pluck("name").join(", ").trim()}}\n        </p>\n\t\t-->\n        <div class="ueditor-taxonomy-wrapper">\n\t\t\t<div class="upfront-taxonomy-tab-wrapper">\n\t\t\t\t<ul class="taxonomy-panel-tabspane" style="">\n\t\t\t\t\t<li data-target="allcategories" class="upfront-taxonomy-tab active">{{Upfront.Settings.l10n.global.content.all_categories}}</li>\n\t\t\t\t\t<li data-target="topcategories" class="upfront-taxonomy-tab">{{Upfront.Settings.l10n.global.content.top_categories}}</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="taxonomy-panel-content" id="allcategories">\n\t\t\t\t\t<div id="upfront-taxonomy-list" class="upfront-scroll-panel">\n\t\t\t\t\t\t{[ _.each( allTerms, function(term, idx){ ]}\n\t\t\t\t\t\t{{ termTemplate({term: term, termTemplate: termTemplate, termId: term.get(\'term_id\'), postTerms: postTerms}) }}\n\t\t\t\t\t\t{[ }); ]}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="taxonomy-panel-content most-used-categories" id="topcategories">\n\n\t\t\t\t</div>\n\t\t\t</div>\n            <a href="#" class="add-new-taxonomies-btn ueditor-ok-button">{{Upfront.Settings.l10n.global.content.add_new.replace("%s", labels.singular_name)}}</a>\n            <div id="upfront-taxonomy-add" class="ueditor-togglable-child">\n                <select id="upfront-taxonomy-parents">\n                    <option value="0">-- {{Upfront.Settings.l10n.global.content.parent_category}} --</option>\n                    {[ _(allTerms).each(function(term, idx) { ]}\n                    <option value="{{ term.get(\'term_id\') }}">{{ term.get(\'name\') }}</option>\n                    {[ }) ]}\n                </select>\n\t\t\t\t<input type="text" class="upfront-tax-new_term" placeholder="{{Upfront.Settings.l10n.global.content.enter.replace(\'%s\', labels.singular_name)}}" />\n                <button id="upfront-tax-add_term" class="ueditor-button-small"> {{Upfront.Settings.l10n.global.content.add_label}}</button>\n            </div>\n        </div>\n    </script>\n\n    <script type="text/template" id="upfront-term-single-tpl">\n        <div class="upfront-taxonomy_item" id="upfront-term_item-{{ termId }}">\n\n            <input type="checkbox" id="upfront-taxonomy-{{ term.taxonomy }}-{{ termId }}" class="upfront-field-checkbox" value="{{ termId }}" {{ postTerms.get(termId) || typeof selected !== "undefined" ? \'checked="checked"\' : \'\' }} />\n            <label for="upfront-taxonomy-{{ term.taxonomy }}-{{ termId }}">\n\t\t\t\t {{ term.get(\'name\') }}\n\t\t\t</label>\n            {[ if( term.children ) { ]}\n            {[ term.children.each(function(child, idx){ ]}\n            {{ termTemplate({term: child, termTemplate: termTemplate, termId: child.get(\'term_id\'), postTerms: postTerms}) }}\n            {[ }) ]}\n            {[ } ]}\n        </div>\n    </script>\n\n\t<script type="text/template" id="upfront-term-mostused-tpl">\n\t\t<div id="upfront-taxonomy-list" class="upfront-scroll-panel">\n\t\t\t{[ _.each( mostUsed, function(term, idx){ ]}\n\t\t\t{[ if( term.get(\'count\') > 0 ) { ]}\n\t\t\t{{ termTemplate({term: term, termTemplate: termTemplate, termId: term.get(\'term_id\'), postTerms: postTerms}) }}\n\t\t\t{[ } ]}\n\t\t\t{[ }); ]}\n\t\t</div>\n    </script>\n\n\t<script type="text/template" id="upfront-term-mostused-single-tpl">\n        <div class="upfront-taxonomy_item" id="upfront-term_item-{{ termId }}">\n            <input type="checkbox" id="upfront-taxonomy-{{ term.taxonomy }}-{{ termId }}" class="upfront-field-checkbox" value="{{ termId }}" {{ postTerms.get(termId) || typeof selected !== "undefined" ? \'checked="checked"\' : \'\' }} />\n            <label for="upfront-taxonomy-{{ term.taxonomy }}-{{ termId }}">\n\t\t\t\t {{ term.get(\'name\') }}\n\t\t\t</label>\n        </div>\n    </script>\n\n    <script type="text/template" id="upfront-flat-term-list-tpl">\n        <label id="post-tags-display-label">{{ labels.name }}:</label>\n        <div class="upfront-taxonomy-list-panel upfront-scroll-panel" id="upfront-taxonomy-list-current">\n\t\t\t{[ currentTerms.each(function(term, idx){ ]}\n\t\t\t{{ termTemplate({ term: term }) }}\n\t\t\t{[ }); ]}\n\t\t</div>\n\n\t\t<div class="upfront-taxonomy-chosen"></div>\n\t</script>\n\n    <script type="text/template" id="upfront-term-flat-single-tpl">\n        <div class="upfront-taxonomy_item upfront-taxonomy_item-flat" id="upfront-term_item-{{ term.get(\'term_id\') }}" data-term_id="{{ term.get(\'term_id\') }}">\n            <i class="icon-plus"></i>\n            <i class="icon-remove-circle"></i>\n            {{ term.get(\'name\') }}\n        </div>\n    </script>\n\n\t<script type="text/template" id="upfront-page-template-list-tpl">\n\t\t<label id="post-tags-display-label">{{ label }}:</label>\n\t\t<div class="upfront-page-template-dropdown">\n\t\t\t<div class="upfront-page-template-chosen"></div>\n\t\t\t<a href="" class="apply-post-template upfront-select-template-button">{{Upfront.Settings.l10n.global.content.apply}}</a>\n\t\t</div>\n\t\t<div class="upfront-page-template-description">{{Upfront.Settings.l10n.global.content.template_nag}}</div>\n\t\t<div class="upfront-page-template-action">\n\t\t</div>\n\t</script>\n\n\t<script type="text/template" id="upfront-page-action">\n\t\t<a href="" class="delete-post-template upfront-delete-template-button">{{Upfront.Settings.l10n.global.content.delete_template}}</a>\n\t\t<a href="" class="update-post-template upfront-select-template-button">{{Upfront.Settings.l10n.global.content.update_template}}</a>\n\t\t<a href="" class="reset-post-template upfront-select-template-button">{{Upfront.Settings.l10n.global.content.reset_changes}}</a>\n\t\t<a href="" class="save-post-template upfront-select-template-button">{{Upfront.Settings.l10n.global.content.save_template}}</a>\n\t</script>\n\n\t<script type="text/template" id="upfront-apply-page-action">\n\t\t<div class="upfront-apply-page-modal">\n\t\t\t<p>{{Upfront.Settings.l10n.global.content.apply_template_warning}}</p>\n\t\t</div>\n\t</script>\n\n    <script type="text/template" id="post-status-tpl">\n        <label id="post-status-display-label" class="ueditor-icon-label">{{Upfront.Settings.l10n.global.content.status}}:</label>\n        <span id="post-status-display" class="ueditor-previous-data">{{status.name}}</span>\n        <a href="#" class="edit-post-status ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</a>\n\n        <div id="post-status-select" class="ueditor-togglable">\n            <div class="ueditor-select-status"></div>\n            <select class="ueditor-select-options ueditor-status-select">\n                {[ _.each(options, function(option){ ]}\n                <option class="ueditor-select-option ueditor-action-status" value="{{option.value}}" {[ if( status.value == option.value ) { ]} selected="selected"  {[ } ]} >{{option.name}}</option>\n                {[ }); ]}\n            </select>\n            <a href="" class="save-post-status  ueditor-button-small-ok ueditor-ok-button">{{Upfront.Settings.l10n.global.content.ok}}</a>\n        </div>\n    </script>\n\n    <script type="text/template" id="post-visibility-tpl">\n        <label id="post-visibility-display" class="ueditor-icon-label">{{Upfront.Settings.l10n.global.content.visibility}}</label>\n        <span class="ueditor-previous-data">{{status.name}}</span>\n        <a href="#" class="edit-visibility ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</span>\n        </a>\n\n        <div id="post-visibility-select" class="ueditor-togglable">\n            <input type="checkbox" style="display:none" name="hidden_post_sticky" id="hidden-post-sticky" value="sticky">\n            <input type="radio" name="visibility" id="visibility-radio-public" value="public" class="upfront-field-radio" {[ if( status.value == "public" ) { ]} checked="checked" {[ } ]} >\n            <label for="visibility-radio-public">{{Upfront.Settings.l10n.global.content.public_post}}</label>\n            <br>\n            <span id="sticky-span" class="ueditor-togglable-child ueditor-togglable-child-public" {[ if( status.value == "public" ) { ]} style="display:block" {[ } ]}>\n            <input name="sticky" type="checkbox" value="sticky" class="upfront-field-checkbox">\n            <label>{{Upfront.Settings.l10n.global.content.sticky_post_label}}</label><br>\n            </span>\n            <input type="radio" name="visibility" id="visibility-radio-password" value="password" class="upfront-field-radio" {[ if( status.value == "password" ) { ]} checked="checked" {[ } ]}>\n            <label for="visibility-radio-password">{{Upfront.Settings.l10n.global.content.password_protected}}</label>\n            <br>\n            <span id="password-span" class="ueditor-togglable-child ueditor-togglable-child-password" {[ if( status.value == "password" ) { ]} style="display:block" {[ } ]}>\n            <input type="password" class="upfront-field-text ueditor-post-pass" value="{{post_password}}" placeholder="{{Upfront.Settings.l10n.global.content.password}}">\n            </span>\n            <input type="radio" name="visibility" id="visibility-radio-private" value="private" class="upfront-field-radio" {[ if( status.value == "private" ) { ]} checked="checked" {[ } ]}>\n            <label for="visibility-radio-private">{{Upfront.Settings.l10n.global.content.is_private}}</label>\n            <br>\n            <p>\n                <a href="#" class="save-post-visibility ueditor-small-button ueditor-button-small-ok ueditor-ok-button">{{Upfront.Settings.l10n.global.content.ok}}</a>\n            </p>\n        </div>\n    </script>\n\n    <script type="text/template" id="post-schedule-tpl">\n        <span>\n        <label id="publication-time" class="ueditor-icon-label">{{schedule.key}}:</label>\n        <b class="ueditor-previous-data">{{schedule.text}}</b>\n    </span>\n        <a href="#" class="edit-timestamp ueditor-btn-edit">{{Upfront.Settings.l10n.global.views.edit}}</a>\n        <div class="ueditor-togglable ueditor-togglable-post-schedule-date">\n            <div class="timestamp-wrap">\n\t\t\t\t<div class="upfront-bar-datepicker">\n\t\t\t\t\t <input id="upfront-schedule-datepicker" type="text" name="date" value="{{date}}">\n\t\t\t\t</div>\n                @\n                <label class="screen-reader-text">{{Upfront.Settings.l10n.global.content.hour}}</label>\n                <input type="text" class="schedule-hours" name="hh" value="{{currentHour}}" size="2" maxlength="2" min="0" max="23" autocomplete="off">\n                : <label class="screen-reader-text">{{Upfront.Settings.l10n.global.content.minute}}</label>\n                <input type="text" class="schedule-minutes" name="mn" value="{{currentMinute}}" size="2" maxlength="2" min="0" max="59" autocomplete="off">\n\n\t\t\t\t <a href="#" class="ueditor-save-post-date  ueditor-button-small-ok ueditor-ok-button">{{Upfront.Settings.l10n.global.content.ok}}</a>\n            </div>\n        </div>\n    </script>\n\n</div>\n'}),function(t){define("upfront/post-editor/post-box-metadesc",["text!upfront/templates/post-editor/edition-box.html"],function(e){var i=Backbone.View.extend({meta_key:"_metadesc",supported_meta_keys:["_metadesc","_wds_metadesc"],char_limit:160,events:{"click a.ueditor-save-post-data":"handle_metadesc_update","keyup textarea":"handle_counter_update"},initialize:function(){this.meta_key=((Upfront.data||{}).metadata||{}).metadesc_key||this.meta_key,this.supported_meta_keys=((Upfront.data||{}).metadata||{}).supported_metadesc_keys||this.supported_meta_keys;var t=!!((Upfront.data||{}).metadata||{}).metadesc_length&&parseInt(Upfront.data.metadata.metadesc_length,10);this.char_limit=t||this.char_limit},render:function(){var i=_.template(t(e).find("#post-box-metadesc").html())({metadesc:this.get_current_metadesc(),char_limit:this.get_char_limit()});return this.undelegateEvents(),this.$el.empty().append(i),this.delegateEvents(),this},get_char_limit:function(){return this.char_limit},handle_metadesc_update:function(t){var e=this.$el.find("textarea").val();return this.set_current_metadesc(e),!0},handle_counter_update:function(t){var e=this.$el.find(".char-counter"),i=this.$el.find("textarea").val().length,n=this.get_char_limit();i>n?e.addClass("over-limit"):e.removeClass("over-limit"),e.find(".current").text(i)},get_current_metadesc:function(){var t="";return this.model&&(this.model||{}).get?(this.model.meta&&(this.model.meta||{}).getValue&&(t=_.reduce(this.supported_meta_keys,function(t,e){return this.model.meta.getValue(e)||t},"",this)),t=t||this.model.get("post_excerpt")||""):t},set_current_metadesc:function(t){return!(!(this.model||{}).meta||!(this.model||{}).meta.setValue)&&(this.model.meta.setValue(this.meta_key,t),!0)}});return i})}(jQuery),function(t){define("upfront/post-editor/upfront-post-edit",["text!upfront/templates/post-editor/edition-box.html","upfront/post-editor/post-box-metadesc"],function(e,i){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n:Upfront.mainData.l10n,o=Backbone.View.extend({className:"ueditor-box-wrapper upfront-ui",post:!1,taxSection:!1,offset:{min:0,max:0},position:{min:0,max:0},onScrollFunction:!1,statusSelect:!1,visibilitySelect:!1,taxSections:[],events:{"click .ueditor-action-preview":"navigate_to_preview","click .ueditor-button-cancel-edit":"cancel","click .ueditor-action-publish":"publish","click .ueditor-action-draft":"saveAsDraft","click .ueditor-action-trash":"trash","click .ueditor-box-title":"toggle_section","click .ueditor-save-post-data":"save_post_data"},initialize:function(i){this.post=i.post,this.layout_modified=!1,this.statusSection=new c({post:this.post}),this.visibilitySection=new u({post:this.post}),this.scheduleSection=new h({post:this.post}),this.urlEditor=new d({post:this.post}),this.tpl=_.template(t(e).find("#ueditor-box-main").html()),this.datepickerTpl=_.template(t(Upfront.data.tpls.popup).find("#datepicker-tpl").html()),this.listenTo(Upfront.Events,"entity:module:update",this.on_layout_change),this.listenTo(Upfront.Events,"entity:layout:change",this.on_layout_change),Upfront.Events.off("command:layout:trash",this.trash),Upfront.Events.off("command:layout:save",this.publish),Upfront.Events.off("command:layout:save_as",this.save_as_publish),Upfront.Events.off("command:post:save",this.publish),Upfront.Events.on("command:layout:trash",this.trash,this),Upfront.Events.on("command:layout:save",this.publish,this),Upfront.Events.on("command:layout:save_as",this.save_as_publish,this),Upfront.Events.on("command:post:save",this.publish,this)},rebindEvents:function(){this.render(),this.delegateEvents(),this.statusSection.render(),this.statusSection.delegateEvents(),this.visibilitySection.render(),this.visibilitySection.delegateEvents(),this.scheduleSection.render(),this.scheduleSection.delegateEvents(),this.urlEditor.render(),this.urlEditor.delegateEvents()},render:function(){if(this.destroy(),Upfront.Application.user_can("EDIT")!==!1||parseInt(this.post.get("post_author"),10)===Upfront.data.currentUser.id&&Upfront.Application.user_can("EDIT_OWN")===!0){var t=this,e=this.post.toJSON(),i={},o=t.post.get("guid");return i.rootUrl=o?o.replace(/\?.*$/,""):window.location.origin+"/",e.permalink=this.permalink=i.rootUrl+this.post.get("post_name"),e.previewLink=this.post.get("permalink")+"?preview=true",e.buttonText=this.getButtonText(),e.draftButton=["publish","future"].indexOf(this.initialStatus)==-1,e.cancelButton=!this.post.is_new,e.postStatus=this.post.get("post_status"),e.cid=this.cid,Upfront.Events.trigger("upfront:save:label",this.getButtonText()),i.post_type_conditional_box_title=this._post_type_has_taxonomy("post_tag")&&this._post_type_has_taxonomy("category")?n.global.content.tags_cats_url:n.global.content.no_tax_url,i.url_label="post"===t.post.get("post_type")?n.global.content.post_url:n.global.content.page_url,this.$el.html(this.tpl(_.extend({},e,i))),"publish"===e.postStatus&&this.$el.find(".ueditor-action-draft, .ueditor-action-preview").hide(),this.populateSections(),this}},navigate_to_preview:function(t){return t.preventDefault(),"auto-draft"===this.post.get("post_status")?(this.post.trigger("editor:auto-draft"),this.trigger("auto-draft"),void window.open(this.post.get("guid")+"&preview=true","_blank")):void window.open(this.post.get("guid"),"_blank")},renderTaxonomyEditor:function(t,e){e="undefined"==typeof e?"category":e;var i=this,n=new Upfront.Collections.TermList([],{postId:this.post.id,taxonomy:e});return this._post_type_has_taxonomy(e)?void n.fetch({allTerms:!0}).done(function(o){var r=o.data.taxonomy.hierarchical?s:a,l=i.taxSections[e]=new r({collection:n,tax:e});l.allTerms=new Upfront.Collections.TermList(o.data.allTerms),l.render(),t.html(l.$el)}):(t.hide(),!1)},on_layout_change:function(){Upfront.Application.layout_ready&&(this.layout_modified=!0)},populateSections:function(){this.$(".misc-pub-post-status").html(this.statusSection.$el),this.$(".misc-pub-visibility").html(this.visibilitySection.$el),this.$(".misc-pub-schedule").html(this.scheduleSection.$el),this.$(".misc-pub-section.misc-pub-post-url").html(this.urlEditor.$el)},_post_type_has_taxonomy:function(t){if(!t)return!0;var e=this.post.get("post_type")||"post";return"page"!==e},getButtonText:function(){var t=this.initialStatus,e=this.post.get("post_date"),i=new Date;return e=e?e.getTime():0,i=i.getTime(),!t&&this.post&&this.post.get&&(t=this.post.get("post_status")),i<e?"future"==t?n.global.content.update:n.global.content.schedule:"publish"==t?n.global.content.update:n.global.content.publish},setPosition:function(){var e=t(".upost-data-object-post_data, .upfront-output-this_post").length?t(".upost-data-object-post_data, .upfront-output-this_post"):this.$el.closest(".upfront-postcontent-editor"),i=e.map(function(){return{right:t(this).width()+t(this).offset().left,$el:t(this)}}),n=_.max(i,function(t){return t.right}),o=t("body").width()-n.right,r=o>this.$el.width()?o-this.$el.width():10;Upfront.Util.isRTL()?this.$el.css({left:r+10,right:"auto"}):this.$el.css({right:r+10})},toggleRegionClass:function(t){this.$el.closest(".upfront-region-container").toggleClass("upfront-region-container-editing-post",t)},destroy:function(){},_stop_overlay:function(){t(".editing-overlay").remove(),t(".upfront-module").removeClass("editing-content"),t(".upfront-module.fadedOut").fadeTo("slow",1).removeClass("fadedOut"),t(".ueditor-display-block").removeClass("ueditor-display-block")},cancel:function(t){t.preventDefault(),confirm(n.global.content.discard_changes.replace(/%s/,this.post.get("post_title")))&&(this.post.trigger("editor:cancel"),this.trigger("cancel"),Upfront.Events.trigger("upfront:element:edit:stop","write",this.post),this.fadein_other_elements())},fadein_other_elements:function(){t(".editing-overlay").remove(),t(".upfront-module").removeClass("editing-content"),t(".upfront-module.fadedOut").fadeTo("fast",1).removeClass("fadedOut"),t(".ueditor-display-block").removeClass("ueditor-display-block")},save_as_publish:function(){this.stopListening(Upfront.Events,"command:proceed:save:post"),this.listenTo(Upfront.Events,"command:proceed:save:post",this.publish),Upfront.Events.trigger("command:layout:layout_changes",!0)},save_post:function(){this.publish(),$layout_key="single-post-"+this.post.get("ID"),Upfront.Events.trigger("command:layout:save_post_layout",$layout_key)},publish:function(){var t=this;if("undefined"!=typeof _upfront_post_data.skip_publish&&1===_upfront_post_data.skip_publish)return void(_upfront_post_data.skip_publish=0);if("undefined"!=typeof _upfront_post_data.post_status&&_upfront_post_data.post_status.length>0){
if(this.post.set("post_status",_upfront_post_data.post_status),_upfront_post_data.post_status="","draft"==this.post.get("post_status"))return void this.saveDraft()}else{var e=(this.post||{}).getVisibility&&"private"===this.post.getVisibility()?"private":"publish";this.post.set("post_status",e),Upfront.Events.trigger("global:status:change",e)}t.post.trigger("editor:publish"),t.trigger("publish"),Upfront.Events.trigger("upfront:element:edit:stop","write",t.post),Upfront.Events.trigger("upfront:post:edit:stop","write",t.post.toJSON()),t.fadein_other_elements(),t._stop_overlay()},saveAsDraft:function(t){t.preventDefault(),this.saveDraft(),$layout_key="single-"+this.post.get("post_type")+"-"+this.post.get("ID"),Upfront.Events.trigger("command:layout:save_post_layout",$layout_key)},saveDraft:function(){this.post.trigger("editor:draft"),this.trigger("draft"),Upfront.Events.trigger("upfront:element:edit:stop","write",this.post,!0)},trash:function(){confirm(n.global.content.delete_confirm.replace(/%s/,this.post.get("post_type")))&&(this.trigger("trash"),Upfront.Events.trigger("upfront:element:edit:stop","write",this.post))},toggle_section:function(e){e.preventDefault();var i=t(e.target),n=i.closest(".ueditor-box-section"),o=n.find(".ueditor-box-content-wrap");n.toggleClass("show"),o.slideToggle()}}),r=Backbone.View.extend({events:{"click .ueditor-btn-edit":"toggleEditor","click .ueditor-button-cancel":"cancelEdit","click .ueditor-button-small-ok":"update",'change input[type="radio"][name="visibility"]':"visibility_radio_change","change input[name='visibility']":"set_visibility"},toggleEditor:function(e){e.preventDefault();var i,n=t(e.target),o=n.parent().parent().find(".ueditor-previous-data-toggle");i=n.hasClass("ueditor-edit-post-url")||n.hasClass("ueditor-edit-post-title")||n.hasClass("ueditor-edit-post-metadesc")?n.parent().siblings(".ueditor-togglable"):n.siblings(".ueditor-togglable"),n.hasClass("ueditor-edit-post-url")&&n.hasClass("ueditor-edit-post-title")&&n.hasClass("ueditor-edit-post-metadesc")||t(".ueditor-box-content-wrap .ueditor-togglable").parent().removeClass("upfront-settings-toggled"),t(".ueditor-box-content-wrap .ueditor-togglable").not(i).slideUp(),t(".ueditor-box-content-wrap .ueditor-btn-edit").show(),t(".ueditor-previous-data-toggle").not(o).show(),o.hide(),n.hide(),i.slideDown(100),i.parent().addClass("upfront-settings-toggled")},cancelEdit:function(e){e.preventDefault();var i=t(e.target),n=i.closest(".misc-pub-section").find(".ueditor-previous-data-toggle");n.show(),i.closest(".ueditor-togglable").slideUp(100,function(){i.closest(".ueditor-togglable").siblings(".ueditor-btn-edit").show(),i.closest(".ueditor-togglable").parent().removeClass("upfront-settings-toggled")})},visibility_radio_change:function(e){var i=t(e.target),n=i.val(),o=t(".ueditor-togglable-child-"+n);i.closest(".ueditor-togglable").find(".ueditor-togglable-child").not(o).hide(),o.show()}}),s=r.extend({termListingTpl:_.template(t(e).find("#upfront-term-list-tpl").html()),termTopListingTpl:_.template(t(e).find("#upfront-term-mostused-tpl").html()),termSingleTpl:_.template(t(e).find("#upfront-term-single-tpl").html()),termTopSingleTpl:_.template(t(e).find("#upfront-term-mostused-single-tpl").html()),defaults:{title:"Categories"},className:"upfront-taxonomy-hierarchical",events:_.extend({},r.prototype.events,this.events,{"click #upfront-tax-add_term":"handle_new_term","click .add-new-taxonomies-btn":"toggle_add_new","keydown #upfront-add_term":"handle_enter_new_term","change .upfront-taxonomy_item":"handle_terms_update","keydown #upfront-new_term":"handle_enter_new_term","click .upfront-taxonomy-tab":"on_click"}),updateTimer:!1,allTerms:!1,initialize:function(t){this.tax=t.tax},render:function(){var t=this,e=t.collection.pluck("term_id"),i=(this.allTerms.sortBy(function(t,i){return e.indexOf(t.get("term_id"))!==-1}),this.allTerms.sortBy(function(t){return t.get("count")}));this.$el.html(this.termListingTpl(_.extend({},this.defaults,{allTerms:this.allTerms.where({parent:0}),postTerms:this.collection,termTemplate:this.termSingleTpl,labels:this.collection.taxonomyObject.labels}))),this.$el.find(".most-used-categories").html(this.termTopListingTpl(_.extend({},this.defaults,{mostUsed:i.reverse(),termTemplate:this.termTopSingleTpl,postTerms:this.collection}))),this.$el.find(".taxonomy-panel-content").hide().first().show();var o=this.chosen_field(),r=this.normalize_tax_object(this.allTerms);this.taxonomySelect=new o({model:this.model,label:n.global.content.category_label,values:r,placeholder:n.global.content.category_placeholder,change:function(t){}}),this.taxonomySelect.render(),this.listenTo(this.taxonomySelect,"taxonomy:new",this.handle_new_term),this.listenTo(this.taxonomySelect,"taxonomy:changed",this.handle_choose_term),this.$el.find(".upfront-taxonomy-chosen").html(this.taxonomySelect.$el)},on_click:function(e){var i="#"+t(e.target).data("target");this.$el.find(".upfront-taxonomy-tab").removeClass("active"),t(e.target).addClass("active"),this.$el.find(".taxonomy-panel-content").hide(),this.$el.find(i).show()},normalize_tax_object:function(t){var e={};return t.each(function(t,i){e[t.get("term_id")]={label:t.get("name"),value:t.get("term_id")}}),e},chosen_field:function(){var t=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"select-taxonomy-chosen",render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);var t=this,e="100%";this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:e,disable_search:!1});var i=['<a href="#" title="'+n.global.content.add_label+'" class="upfront-taxonomy-add">'+n.global.content.add_label+"</a>"];return this.$el.find(".chosen-search").append(i.join("")),this.$el.on("click",".upfront-taxonomy-add",function(e){e.preventDefault();var i=t.$el.find(".chosen-search input").val();t.trigger("taxonomy:new",i.trim())}),this},on_change:function(){this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed"),this.trigger("taxonomy:changed",this.get_value())}});return t},handle_new_term:function(){var e,i,n=this,o=this.$(".upfront-tax-new_term"),r=o.val();return!!r&&(t("#upfront-taxonomy-parents").length&&(e=parseInt(t("#upfront-taxonomy-parents").val(),10)),i=new Upfront.Models.Term({taxonomy:this.collection.taxonomy,name:r,parent:e}),i.save().done(function(t){n.allTerms.add(i),n.collection.add(i),setTimeout(function(){n.update()},100)}),o.val(""),this.$el.find(".add-new-taxonomies-btn").removeClass("upfront-add-active"),this.$el.find(".ueditor-togglable-child").toggle(),void this.$("#upfront-taxonomy-list").scrollTop(0))},handle_terms_update:function(e){var i=t(e.target),n=i.val();i.is(":checked")?this.collection.add(this.allTerms.get(n)):this.collection.remove(this.allTerms.get(n)),this.collection.save(),Upfront.Events.trigger("editor:post:tax:updated",this.collection,this.tax)},handle_enter_new_term:function(t){13==t.which&&this.handle_new_term(t)},update:function(t){this.collection.save(),Upfront.Events.trigger("editor:post:tax:updated",this.collection,this.tax),this.render()},toggle_add_new:function(e){e.preventDefault(),$target=t(e.currentTarget),$target.hasClass("upfront-add-active")?$target.removeClass("upfront-add-active"):$target.addClass("upfront-add-active"),this.$el.find(".ueditor-togglable-child").toggle()}}),a=r.extend({className:"upfront-taxonomy-flat",termListTpl:_.template(t(e).find("#upfront-flat-term-list-tpl").html()),termSingleTpl:_.template(t(e).find("#upfront-term-flat-single-tpl").html()),changed:!1,updateTimer:!1,events:_.extend({},r.prototype.events,{"click .ueditor-button-small-flat-tax-add":"handle_new_term","click .upfront-taxonomy_item-flat":"handle_term_click","keydown #upfront-flat-tax-add_term":"handle_enter_new_term","keydown .upfront-flat-tax-new_term":"handle_enter_new_term","click .upfront-taxonomy-list-choose-from-prev":"toggle_prev_used_tax"}),initialize:function(t){this.collection.on("add remove",this.update,this),this.tax=t.tax},render:function(){var t=this,e=new Upfront.Collections.TermList,i=new Upfront.Collections.TermList;this.allTerms.each(function(n,o){n.children=[],t.collection.get(n.get("term_id"))?e.add(n):i.add(n)}),this.$el.html(this.termListTpl({currentTerms:e,otherTerms:i,termTemplate:this.termSingleTpl,labels:this.collection.taxonomyObject.labels}));var o=this.chosen_field(),r=this.normalize_tax_object(i);this.taxonomySelect=new o({model:this.model,label:n.global.content.tags_label,values:r,placeholder:n.global.content.tags_placeholder,change:function(t){}}),this.taxonomySelect.render(),this.listenTo(this.taxonomySelect,"taxonomy:new",this.handle_new_term),this.listenTo(this.taxonomySelect,"taxonomy:changed",this.handle_choose_term),this.$el.find(".upfront-taxonomy-chosen").html(this.taxonomySelect.$el)},normalize_tax_object:function(t){var e={label:"",value:""};return t.each(function(t,i){e[t.get("term_id")]={label:t.get("name"),value:t.get("term_id")}}),e},chosen_field:function(){var t=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"select-taxonomy-chosen",render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);var t=this,e="100%";this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:e,disable_search:!1});var i=['<a href="#" title="'+n.global.content.add_label+'" class="upfront-taxonomy-add">'+n.global.content.add_label+"</a>"];return this.$el.find(".chosen-search").append(i.join("")),this.$el.on("click",".upfront-taxonomy-add",function(e){e.preventDefault();var i=t.$el.find(".chosen-search input").val();t.trigger("taxonomy:new",i.trim())}),this},on_change:function(){this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed"),this.trigger("taxonomy:changed",this.get_value())}});return t},handle_term_click:function(e){var i=t(e.currentTarget),n=i.attr("data-term_id");"upfront-taxonomy-list-current"==i.parent().attr("id")?this.collection.remove(n):this.collection.add(this.allTerms.get(n))},handle_choose_term:function(t){this.collection.add(this.allTerms.get(t))},handle_new_term:function(t){var e,i=this;return!!t&&(e=new Upfront.Models.Term({taxonomy:this.collection.taxonomy,name:t}),void e.save().done(function(t){i.allTerms.add(e),i.collection.add(e).save()}))},handle_enter_new_term:function(t){13==t.which&&this.handle_new_term(t)},toggle_prev_used_tax:function(t){t.preventDefault(),this.$(".ueditor-togglable-child").slideToggle()},update:function(t){var e=this;this.collection.save(),Upfront.Events.trigger("editor:post:tax:updated",this.collection,this.tax),setTimeout(function(){e.render()},50)}}),l=r.extend({className:"upfront-page-template-editor",pageTemplateListTpl:_.template(t(e).find("#upfront-page-template-list-tpl").html()),changed:!1,updateTimer:!1,allPageTemplates:!1,events:_.extend({},r.prototype.events,{"click .save-post-template":"handle_save_as","click .apply-post-template":"show_apply_template_modal","click .update-post-template":"update_template","click .reset-post-template":"reset_changes","click .delete-post-template":"show_delete_template_modal"}),initialize:function(t){this.label=t.label,this.off("initiate:no:layout:change",this.initiate_no_layout_change),this.on("initiate:no:layout:change",this.initiate_no_layout_change)},render:function(){var i=this;this.$el.html(this.pageTemplateListTpl({label:i.label})),this.$el.find(".upfront-page-template-action").html(_.template(t(e).find("#upfront-page-action").html()));var n=this.chosen_field(),o=this.get_options();this.templateSelect=new n({model:i.model,label:"",values:o}),this.templateSelect.render(),this.$el.find(".upfront-page-template-chosen").html(this.templateSelect.$el),this.listenTo(Upfront.Events,"entity:module:update",this.on_layout_change),this.listenTo(Upfront.Events,"entity:layout:change",this.on_layout_change)},after_append:function(){var t=this;setTimeout(function(){t.$el.find(".upfront-field-multiple input").bind("click.chosen",function(e){t.stop_bubble(e)}),t.$el.find(".upfront-field-multiple span.upfront-field-label-text").bind("click.chosen",function(e){t.stop_bubble(e)})},300),"undefined"!=typeof _upfront_post_data.layout_change&&1===_upfront_post_data.layout_change?this.on_layout_change():this.trigger("initiate:no:layout:change"),"undefined"!=typeof _upfront_post_data.template_slug&&this.templateSelect.set_value(_upfront_post_data.template_slug),this.prev_template_name=this.$el.find('select.upfront-chosen-select option[value="'+_upfront_post_data.template_slug+'"]').first().text(),this.spawn_template_modal(),this.disable_apply_template=!0,this.$el.find("a.apply-post-template").css({cursor:"default",opacity:.6})},initiate_no_layout_change:function(){_upfront_post_data.layout_change=0,this.$el.find(".chosen-container .chosen-single span").removeClass("dot"),this.$el.find(".upfront-page-template-description").hide(),this.$el.find(".upfront-page-template-action a.update-post-template").hide(),this.$el.find(".upfront-page-template-action a.reset-post-template").hide(),this.$el.find(".upfront-page-template-action a.save-post-template").hide(),"undefined"!=typeof _upfront_post_data.template_type&&"page"===_upfront_post_data.template_type?this.$el.find(".upfront-page-template-action a.delete-post-template").hide():this.$el.find(".upfront-page-template-action a.delete-post-template").show()},spawn_template_modal:function(){if(!this.template_modal){var i=this;this.template_modal=new Upfront.Views.Editor.Modal({to:t("body"),button:!1,top:120,width:540}),this.template_modal.render(),this.template_modal.on("modal:close",this.reset_cancel_button_data,this),this.template_modal.delegateEvents(),t("body").append(this.template_modal.el);var o=i.template_modal.$el.find(".upfront-inline-modal-content");o.empty().append(_.template(t(e).find("#upfront-apply-page-action").html()));var r=new Upfront.Views.Editor.Field.Button({label:n.global.views.cancel,classname:"upfront-cancel-apply-template",compact:!0,on_click:function(t){t.preventDefault(),i.template_modal.close()}});r.render(),r.delegateEvents(),o.find(".upfront-apply-page-modal").append(r.$el);var s=new Upfront.Views.Editor.Field.Button({label:n.global.content.continue,classname:"upfront-continue-apply-template",compact:!0,on_click:function(t){i.template_modal.close(),i.apply_template(t)}});s.render(),s.delegateEvents(),o.find(".upfront-apply-page-modal").append(s.$el);var a=new Upfront.Views.Editor.Field.Button({label:n.global.content.continue,classname:"upfront-delete-selected-template",compact:!0,on_click:function(t){i.template_modal.close(),Upfront.Events.trigger("command:layout:delete_layout")}});a.render(),a.delegateEvents(),o.find(".upfront-apply-page-modal").append(a.$el)}},reset_cancel_button_data:function(){this.template_modal.$el.find(".upfront-cancel-apply-template").css("margin-right",""),this.template_modal.$el.find(".upfront-cancel-apply-template").attr("title",n.global.views.cancel),this.template_modal.$el.find(".upfront-cancel-apply-template input").val(n.global.views.cancel),this.template_modal.$el.find(".upfront-cancel-apply-template input").attr("placeholder",n.global.views.cancel)},show_apply_template_modal:function(t){if(t.preventDefault(),!this.disable_apply_template){var e=this,i=this.template_modal.$el.find(".upfront-inline-modal-content"),o=this.$el.find("select.upfront-chosen-select option:selected").text();this.template_modal.$el.find(".upfront-continue-apply-template").show(),this.template_modal.$el.find(".upfront-delete-selected-template").hide(),this.template_modal.$el.find(".upfront-apply-page-modal p").html(n.global.content.apply_template_warning),this.template_modal.open(function(){i.find("span.old_template_name").text(e.prev_template_name),i.find("span.new_template_name").text(o)})}},apply_template:function(t){t.preventDefault();var e=this.$el.find(".upfront-chosen-select"),i=e.find("option:selected").closest("optgroup").attr("label"),n="templates"==i?"page":"layout";_upfront_post_data.template_slug=e.val(),_upfront_post_data.template_type=n,_upfront_post_data.layout_change=0,Upfront.Events.trigger("command:layout:save_meta")},update_template:function(t){t.preventDefault(),this.disable_update_template||(_upfront_post_data.layout_action="update",this.trigger("initiate:no:layout:change"),this.stopListening(Upfront.Events,"page:layout:updated"),this.listenTo(Upfront.Events,"page:layout:updated",this.on_page_layout_updated),_upfront_post_data.skip_publish=1,Upfront.Events.trigger("command:layout:save"))},reset_changes:function(t){t.preventDefault(),this.trigger("initiate:no:layout:change"),Upfront.Events.trigger("command:layout:reset_changes")},on_page_layout_updated:function(){var t=this;this.trigger("initiate:no:layout:change"),this.template_modal.$el.find(".upfront-continue-apply-template").hide(),this.template_modal.$el.find(".upfront-delete-selected-template").hide(),this.template_modal.open(function(){t.template_modal.$el.find(".upfront-apply-page-modal p").html(n.global.content.update_template_notification),t.template_modal.$el.find(".upfront-cancel-apply-template").css("margin-right","0"),t.template_modal.$el.find(".upfront-cancel-apply-template").attr("title",n.global.content.ok),t.template_modal.$el.find(".upfront-cancel-apply-template input").val(n.global.content.ok),t.template_modal.$el.find(".upfront-cancel-apply-template input").attr("placeholder",n.global.content.ok)})},show_delete_template_modal:function(t){t.preventDefault();var e=this,i=this.$el.find("select.upfront-chosen-select option:selected").text();this.template_modal.$el.find(".upfront-continue-apply-template").hide(),this.template_modal.$el.find(".upfront-delete-selected-template").show(),this.template_modal.$el.find(".upfront-apply-page-modal p").html(n.global.content.delete_template_warning),this.template_modal.$el.find(".upfront-apply-page-modal p span.template_name").text(i),this.template_modal.open(function(){e.template_modal.$el.find(".upfront-apply-page-modal p span.template_name").text(i)})},stop_bubble:function(t){return t.stopImmediatePropagation(),!0},filter_list:function(t){this.$el.find("optgroup").attr("disabled","disabled");for(var e in t)this.$el.find('optgroup[label="'+t[e]+'"]').removeAttr("disabled");this.$el.find(".upfront-chosen-select").trigger("chosen:updated")},handle_save_as:function(t){t.preventDefault(),this.save_fields=new p({model:this.model}),this.save_fields.render(),this.$el.find(".upfront-page-template-action").html(this.save_fields.$el),this.add_overlay(),this.listenTo(this.save_fields,"click:cancel",this.cancel_save),this.listenTo(this.save_fields,"click:save",this.save)},cancel_save:function(){this.$el.find(".upfront-page-template-action").html(_.template(t(e).find("#upfront-page-action").html())),this.$el.find(".upfront-page-template-action a.delete-post-template").hide(),this.remove_overlay()},save:function(t){_upfront_post_data.template_type="layout",_upfront_post_data.template_slug=t,_upfront_post_data.layout_action="save_as",this.trigger("initiate:no:layout:change"),this.stopListening(Upfront.Events,"update:page:layout:list"),this.listenTo(Upfront.Events,"update:page:layout:list",this.update_template_list),_upfront_post_data.skip_publish=1,Upfront.Events.trigger("command:layout:save"),this.cancel_save()},update_template_list:function(t){this.trigger("initiate:no:layout:change"),this.added_template_name="undefined"!=typeof _upfront_post_data.added_template_name?_upfront_post_data.added_template_name:"";var e='<option value="'+_upfront_post_data.template_slug+'">'+this.added_template_name+"</option>";this.$el.find('.upfront-chosen-select optgroup[label="layouts"]').append(e),this.$el.find(".upfront-chosen-select").val(_upfront_post_data.template_slug).trigger("chosen:updated")},add_overlay:function(){this.$el.find(".upfront-page-template-dropdown, .upfront-page-template-description").append('<div class="upfront-templates-overlay"></div>').css({opacity:.6})},remove_overlay:function(){this.$el.find(".upfront-page-template-dropdown .upfront-templates-overlay, .upfront-page-template-description .upfront-templates-overlay").remove(),this.$el.find(".upfront-page-template-dropdown, .upfront-page-template-description").css({opacity:1})},on_layout_change:function(){if(Upfront.Application.layout_ready){var e=this.$el.find(".chosen-container .chosen-single span.dot");if(e.length)return;this.$el.find(".chosen-container .chosen-single span").addClass("dot"),this.$el.find(".upfront-page-template-action a.reset-post-template").hide(),this.$el.find(".upfront-page-template-action a.update-post-template").hide();var i=this.$el.find(".upfront-page-template-description"),o=this.$el.find('select.upfront-chosen-select option[value="'+_upfront_post_data.template_slug+'"]').text();"undefined"!=typeof _upfront_post_data.template_type&&"page"===_upfront_post_data.template_type?(this.$el.find(".upfront-page-template-action a.reset-post-template").show(),i.html(n.global.content.reset_changes_nag)):(i.html(n.global.content.template_nag),this.$el.find(".upfront-page-template-action a.update-post-template").show()),this.$el.find(".upfront-page-template-action a.save-post-template").show(),this.$el.find(".upfront-page-template-action a.delete-post-template").hide(),i.find("span.template_name").text(o),i.show(),_upfront_post_data.layout_change=1}else{var r=this;this.listenToOnce(Upfront.Events,"layout:after_render",function(){t.contains(document.documentElement,r.$el.get(0))&&r.on_layout_change()})}},get_options:function(){var t={templates:this.normalize_template_object(this.allPageTemplates),layouts:this.normalize_template_object(this.allPageLayouts)};return t},normalize_template_object:function(t){var e=[];return t.each(function(t,i){"undefined"!=typeof t.get("ID")?e[i]={label:t.get("post_name"),value:t.get("ID")}:"undefined"!=typeof t.get("name")&&"undefined"!=typeof t.get("slug")&&(e[i]={label:t.get("name"),value:t.get("slug")})}),e},chosen_field:function(){var e=this,i=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"select-page-template-chosen",initialize:function(e){this.options=e,t(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.closeChosen)},render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);var t=this,e="155px";return this.typeCheckbox=this.type_field(),this.typeCheckbox.render(),setTimeout(function(){t.$el.find(".chosen-drop").prepend(t.typeCheckbox.$el)},200),this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:e,disable_search:!0,display_disabled_options:!1}),this.$el.find(".upfront-chosen-select").on("chosen:hiding_dropdown",function(){t.allowMouseWheel()}),this},on_change:function(){this.allowMouseWheel(),this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed"),"undefined"!=typeof _upfront_post_data.template_slug&&this.get_value()==_upfront_post_data.template_slug?(e.disable_apply_template=!0,e.$el.find("a.apply-post-template").css({cursor:"default",opacity:.6}),e.disable_update_template=!1,e.$el.find("a.update-post-template").css({cursor:"",opacity:1})):(e.disable_apply_template=!1,e.$el.find("a.apply-post-template").css({cursor:"",opacity:1}),e.disable_update_template=!0,e.$el.find("a.update-post-template").css({cursor:"default",opacity:.6}))},get_value_html:function(t,e){var i="";return i+='<optgroup label="'+e+'">',_.each(t,function(t){i+='<option value="'+t.value+'">'+t.label+"</option>"}),i+="</optgroup>"},type_field:function(){var t=new Upfront.Views.Editor.Field.Checkboxes({label:n.global.views.label_show_templates+":",className:"chosen-checkbox-filter",default_value:["templates","layouts"],layout:"horizontal-inline",multiple:!0,values:[{label:n.global.views.pages,value:"templates"},{label:n.global.views.layouts,value:"layouts"}],change:function(t){e.filter_list(this.get_value())}});return t},openOptions:function(e){var i=this;t(".sidebar-panel-content .sidebar-tab-content").bind("mousewheel",function(){return!1}),_.delay(function(){var e=i.$el.parents("#sidebar-ui").length,n=i.$el.parents("#element-settings-sidebar").length,o=44;if(1==e||1==n){var r=i.$el.find(".chosen-drop"),s=r.parent(),a=s.offset().top-t("#element-settings-sidebar").offset().top+s.height();a+=o,r.css("width",s.width()),r.css("top",a+"px"),r.css("left",s.offset().left+"px"),r.css("display","block")}},20),i.$el.find(".chosen-drop").show()},closeChosen:function(t){var e=t.data,i=e.$el.parents("#sidebar-ui").length,n=e.$el.parents("#element-settings-sidebar").length;1!=i&&1!=n||e.$el.find(".chosen-drop").css("display","none"),e.$el.find("select").trigger("chosen:close"),e.allowMouseWheel()},allowMouseWheel:function(){t(".sidebar-panel-content .sidebar-tab-content").unbind("mousewheel")}});return i}}),p=Backbone.View.extend({initialize:function(t){var e=this;this.editor=t.editor,this.fields=[new Upfront.Views.Editor.Field.Button({className:"save-form-cancel",model:this.model,label:n.global.content.cancel,compact:!0,on_click:function(){e.trigger("click:cancel")}}),new Upfront.Views.Editor.Field.Text({className:"save-form-name",model:this.model,compact:!0}),new Upfront.Views.Editor.Field.Button({className:"save-form-save",model:this.model,label:n.global.content.ok,compact:!0,on_click:function(){e.trigger("click:save",e.$el.find(".save-form-name input").val())}})]},render:function(){return this.$el.html(""),_.each(this.fields,function(t){t.render(),t.delegateEvents(),this.$el.append(t.el)},this),this}}),d=r.extend({hasDefinedSlug:!1,className:"upfront-slug_editor-url",tpl:_.template(t(e).find("#post-url-editor").html()),initialize:function(t){this.post=t.post,this.listenTo(Upfront.Events,"content:change:title",this.changeTitle),this.hasDefinedSlug=!_.isEmpty(this.post.get("post_name")),this.metadesc=new i({model:this.post}),this.render()},render:function(){var t=this,e=this.post.get("guid"),i=this.post.get("post_title");e=e?e.replace(/\?.*$/,""):window.location.origin+"/",this.$el.html(this.tpl({rootUrl:e,postTitle:i,slug:t.post.get("post_name"),url_label:"post"===t.post.get("post_type")?n.global.content.post_url:n.global.content.page_url})).append(this.metadesc.render().$el)},changeTitle:function(t){this.post.set("post_title",t),this.render()},update:function(e){e.preventDefault();var i=this.$(".ueditor-post-url-text").val(),n=this.$(".ueditor-post-title-text").val();if(i.length>1){var o=i.toLowerCase().replace(/ /g,"-"),r=this.post.get("guid");t(".ueditor-action-preview").attr("href",r+"?preview=true"),_upfront_post_data.post_name_updated=!0,this.post.set("post_name",o),this.hasDefinedSlug=!0}n.length>1&&(this.post.set("post_title",n),Upfront.Events.trigger("change:title",n)),(i.length>1||n.length>1)&&this.render()}}),c=r.extend({statusOptions:{future:{value:"future",name:n.global.content.scheduled},publish:{value:"publish",name:n.global.content.published},pending:{value:"pending",name:n.global.content.pending_review},draft:{value:"draft",name:n.global.content.draft},private:{value:"private",name:n.global.content.private_post},"auto-draft":{value:"auto-draft",name:n.global.content.new_post},trash:{value:"trash",name:n.global.content.deleted_post}},initialStatus:!1,className:"upfront-toggleable-content",tpl:_.template(t(e).find("#post-status-tpl").html()),initialize:function(t){this.post=t.post,this.render()},render:function(){return this.initialStatus=this.currentStatus=this.post.get("post_status"),this.currentTime=this.post.get("server_time"),this.status=this.getStatus(),this.options=this.getStatusOptions(),this.$el.html(this.tpl(_.extend({},this.post,{status:this.status},{options:this.options}))),this},getStatusOptions:function(t){var e=[],i=this.initialStatus;return"publish"==i?e.push(this.statusOptions.publish):"future"==i&&e.push(this.statusOptions.future),e.push(this.statusOptions.pending),e.push(this.statusOptions.draft),"private"==i&&(e=[this.statusOptions.private]),e},getStatus:function(){var t=this.post.get("post_status");return["auto-draft","draft","pending"].indexOf(t)!=-1?this.statusOptions[t]:this.statusOptions[this.initialStatus]},update:function(e){e.preventDefault();var i=t(e.target);i.closest(".ueditor-togglable").slideUp(100,function(){i.closest(".ueditor-togglable").siblings(".ueditor-btn-edit").show()}),t(".ueditor-box-content-wrap .ueditor-togglable").parent().removeClass("upfront-settings-toggled"),i.closest(".ueditor-togglable").parent().removeClass("upfront-settings-toggled");var n=this.$("select").val();_.isEmpty(n)||n===this.initialStatus||(_upfront_post_data.post_status=n,this.post.set("post_status",n),this.trigger("status:change",n),this.render())}}),u=r.extend({tpl:_.template(t(e).find("#post-visibility-tpl").html()),post_password:"",postVisibility:!1,className:"upfront-toggleable-content",visibilityOptions:{public:{value:"public",name:n.global.content.public_post},sticky:{value:"sticky",name:n.global.content.sticky},password:{value:"password",name:n.global.content.protected_post},private:{value:"private",name:n.global.content.is_private}},initialize:function(t){this.post=t.post,this.render()},render:function(){return this.postVisibility=this.postVisibility?this.postVisibility:this.post.getVisibility(),this.status=this.visibilityOptions[this.postVisibility],"password"==this.postVisibility&&(this.post_password=this.post.get("post_password")),this.$el.html(this.tpl(_.extend({},this.post,{status:this.status,post_password:this.post_password}))),this},getVisibilityOptions:function(){var t=this.post.getVisibility(),e=this.visibilityOptions;return"password"==t?[{value:"password",name:n.global.content.edit_pwd},e.public,e.sticky,e.private]:_.values(e)},set_visibility:function(e){var i=t(e.target).val();this.postVisibility=i},update:function(){var e=this.$(".ueditor-post-pass"),i=e.val();if(this.postVisibility=this.$("input[name='sticky']").is(":checked")?this.postVisibility="sticky":this.postVisibility,this.visibilityOptions.hasOwnProperty(this.postVisibility)){switch(this.postVisibility){case"password":if(""===i)return void e.css("border","1px solid red");e.css("border","1px solid #a3bfd9"),this.post.setVisibility(this.postVisibility),this.post.set("post_password",i),this.trigger("visibility:change","password",i);break;default:this.post.setVisibility(this.postVisibility),this.trigger("visibility:change",this.postVisibility,"")}t(".ueditor-box-content-wrap .ueditor-togglable").parent().removeClass("upfront-settings-toggled"),this.render()}}}),h=r.extend({tpl:_.template(t(e).find("#post-schedule-tpl").html()),className:"upfront-toggleable-content",initialize:function(t){this.post=t.post,this.render()},render:function(){this.initialDate=this.post.get("post_date");var t={},e=new Date(this.initialDate),i="en-us",n=e.toLocaleString(i,{month:"short"});return me=this,t.date=n+" "+this.initialDate.getDate()+", "+this.initialDate.getFullYear(),t.currentHour=this.initialDate.getHours(),t.currentMinute=this.initialDate.getMinutes(),this.schedule=this.getSchedule(),Upfront.Events.trigger("upfront:save:label",this.getButtonText()),this.$el.html(this.tpl(_.extend({},this.post,t,{schedule:this.schedule}))),this.$("#upfront-schedule-datepicker").datepicker({dateFormat:"M d, yy"}),this.validateDate(),this},validateDate:function(){this.$(".schedule-hours, .schedule-minutes").change(function(){var e=parseInt(t(this).attr("max"),10),i=parseInt(t(this).attr("min"),10);t(this).val()>e?t(this).val(e):t(this).val()<i?t(this).val(i):isNaN(t(this).val())&&t(this).val("0")})},getButtonText:function(){var t=this.initialStatus,e=this.post.get("post_date"),i=new Date;return e=e?e.getTime():0,i=i.getTime(),!t&&this.post&&this.post.get&&(t=this.post.get("post_status")),i<e?"future"==t?n.global.content.update:n.global.content.schedule:"publish"==t?n.global.content.update:n.global.content.publish},getSchedule:function(){var t=new Date,e=this.initialDate,i=this.post.get("server_time"),o=this.post.get("post_status"),r=Upfront.Util.format_date;return!e&&!this.initialDate||r(e,!0)===r(i,!0)&&"publish"!==o?{key:n.global.content.publish,text:n.global.content.immediately}:e.getTime()==this.initialDate?e.getTime()<t.getTime()?{
key:n.global.content.published,text:r(e,!0)}:{key:n.global.content.scheduled,text:r(e,!0)}:e.getTime()<t.getTime()?"publish"!==o?{key:n.global.content.publish_on,text:r(e,!0)}:{key:n.global.content.published_on,text:r(e,!0)}:{key:n.global.content.scheduled_for,text:r(e,!0)}},update:function(){var e=this.$("#upfront-schedule-datepicker").datepicker("getDate"),i=new Date,n=e.getFullYear(),o=e.getMonth(),r=e.getDate(),s=this.$("input[name='hh']").val(),a=this.$("input[name='mn']").val();i.setFullYear(n),i.setMonth(o),i.setDate(r),i.setHours(s),i.setMinutes(a),t(".ueditor-box-content-wrap .ueditor-togglable").parent().removeClass("upfront-settings-toggled"),this.post.set("post_date",i),this.trigger("date:updated",i),this.render()}});return{Box:o,ContentEditorTaxonomy_Hierarchical:s,ContentEditorTaxonomy_Flat:a,PageTemplateEditor:l}})}(jQuery),function(t){Upfront.mainData.isRTL&&t.widget("ui.slider",t.ui.slider,{_handleEvents:{keydown:function(e){var i,n,o,r,s=t(e.target).data("ui-slider-handle-index");switch(e.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(e.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(e.target).addClass("ui-state-active"),i=this._start(e,s),i===!1))return}switch(r=this.options.step,n=o=this.options.values&&this.options.values.length?this.values(s):this.value(),e.keyCode){case t.ui.keyCode.HOME:o=this._valueMin();break;case t.ui.keyCode.END:o=this._valueMax();break;case t.ui.keyCode.PAGE_UP:o=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.PAGE_DOWN:o=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/this.numPages);break;case t.ui.keyCode.UP:if(n===this._valueMax())return;o=this._trimAlignValue(n+r);break;case t.ui.keyCode.RIGHT:if(n===this._valueMax())return;o=this._trimAlignValue(n+-r);break;case t.ui.keyCode.DOWN:if(n===this._valueMin())return;o=this._trimAlignValue(n-r);break;case t.ui.keyCode.LEFT:if(n===this._valueMin())return;o=this._trimAlignValue(n- -r)}this._slide(e,s,o)},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}},_normValueFromMouse:function(t){var e,i,n,o,r;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/e,n>1&&(n=1),n<0&&(n=0),n=1-n,o=this._valueMax()-this._valueMin(),r=this._valueMin()+n*o,this._trimAlignValue(r)},_refreshValue:function(){var e,i,n,o,r,s=this.options.range,a=this.options,l=this,p=!this._animateOff&&a.animate,d={};if(this.options.values&&this.options.values.length)this.handles.each(function(n){i=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,d["horizontal"===l.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[p?"animate":"css"](d,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[p?"animate":"css"]({left:i+"%"},a.animate),1===n&&l.range[p?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:a.animate})):(0===n&&l.range.stop(1,1)[p?"animate":"css"]({bottom:i+"%"},a.animate),1===n&&l.range[p?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:a.animate}))),e=i});else{n=this.value(),o=this._valueMin(),r=this._valueMax(),i=r!==o?(n-o)/(r-o)*100:0;var c=i;"horizontal"===this.orientation&&(c=100-i),d["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[p?"animate":"css"](d,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[p?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[p?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[p?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[p?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate})}}}),t.cssHooks.backgroundColor={set:function(e,i){return i.indexOf("ufc")===-1?void(e.style.backgroundColor=i):(e.style.backgroundColor=Upfront.Util.colors.get_color(i),t(e).data("ufc",i),void t(e).data("ufc_rule","backgroundColor"))}},t.cssHooks.color={set:function(e,i){return i.indexOf("ufc")===-1?void(e.style.color=i):(e.style.color=Upfront.Util.colors.get_color(i),t(e).data("ufc",i),void t(e).data("ufc_rule","color"))}}}(jQuery),define("scripts/upfront/upfront-views-editor/jquery-plugins",function(){}),function(){define("scripts/upfront/upfront-views-editor/mixins/upfront-icon-mixin",[],function(){return{get_icon_html:function(t,e){if(!t)return"";if(t.match(/^https?:\/\//)){var i={src:t,alt:"",class:"upfront-field-icon-img"};return"<img "+this.get_field_attr_html(i)+" />"}var n=["upfront-field-icon"];return e?(n.push(e),n.push(e+"-"+t)):n.push("upfront-field-icon-"+t),'<i class="'+n.join(" ")+'"></i>'}}})}(),function(t){define("scripts/upfront/upfront-views-editor/mixins/upfront-scroll-mixin",[],function(){return{stop_scroll_propagation:function(e){e.parent().hasClass("sidebar-panel-post-editor")||e.on("DOMMouseScroll mousewheel",function(e){var i=t(this),n=this.scrollTop,o=this.scrollHeight,r=i.outerHeight(),s=e.originalEvent.wheelDelta,a=s>0,l=o>r;if(l){e.stopPropagation();var p=function(){return e.preventDefault(),e.returnValue=!1,!1};return!a&&-s>o-r-n?(i.scrollTop(o),p()):a&&s>n?(i.scrollTop(0),p()):void 0}})}}})}(jQuery),function(){define("scripts/upfront/upfront-views-editor/mixins",["scripts/upfront/upfront-views-editor/mixins/upfront-icon-mixin","scripts/upfront/upfront-views-editor/mixins/upfront-scroll-mixin"],function(t,e){return{Upfront_Scroll_Mixin:e,Upfront_Icon_Mixin:t}})}(),function(){define("scripts/upfront/upfront-views-editor/theme-colors/model",[],function(){return Backbone.Model.extend({defaults:{color:"",prev:"",highlight:"",shade:"",selected:"",luminance:"",alpha:1},get_hover_color:function(){var t=this;return""!==this.get("selected")?this.get(t.get("selected")):"#000000"===this.get("color")&&0==this.get("alpha")?"inherit":this.get("color")}})})}(),function(){define("scripts/upfront/upfront-views-editor/theme-colors/collection",["scripts/upfront/upfront-views-editor/theme-colors/model"],function(t){return Backbone.Collection.extend({model:t,get_colors:function(){return this.pluck("color")?this.pluck("color"):[]},is_theme_color:function(t){return t=this.color_to_hex(t),_.indexOf(this.get_colors(),t)!==-1&&_.indexOf(this.get_colors(),t)+1},get_css_class:function(t,e){t=this.color_to_hex(t);var i=_.isUndefined(e)||e===!1?"upfront_theme_color_":"upfront_theme_bg_color_";if(this.is_theme_color(t)){var n=this.findWhere({color:t});if(n){var o=this.indexOf(n);return i+o}}return!1},get_all_classes:function(t){var e=_.isUndefined(t)||t===!1?"upfront_theme_color_":"upfront_theme_bg_color_",i=[];return _.each(this.get_colors(),function(t,n){i.push(e+n)}),i},remove_theme_color_classes:function(t,e){_.each(this.get_all_classes(e),function(e){t.removeClass(e)})},color_to_hex:function(t){if("function"==typeof tinycolor)return t=tinycolor(t),"#000000"===t.toHexString()&&0==t.alpha?"inherit":t.toHexString();if("#"===t.substr(0,1))return t;t=t.replace(/\s+/g,"");var e=/(.*?)rgb\((\d+),(\d+),(\d+)\)/.exec(t);e=_.isEmpty(e)?/(.*?)rgba\((\d+),(\d+),(\d+),([0-9.]+)\)/.exec(t):e;var i=parseInt(e[2],10),n=parseInt(e[3],10),o=parseInt(e[4],10),r=o|n<<8|i<<16;return e[1]+"#"+r.toString(16)}})})}(),function(){define("scripts/upfront/upfront-views-editor/theme-colors",["scripts/upfront/upfront-views-editor/theme-colors/collection"],function(t){return{colors:new t(Upfront.mainData.themeColors.colors),range:Upfront.mainData.themeColors.range||0}})}(),define("text!upfront/templates/color_picker.html",[],function(){return'<ul class="upfront_color_picker_rgba">\n\t<li class="upfront_color_picker_rgba_r">\n\t\tR:\n\t\t<input type="text" value="{{r}}" data-type=\'r\' name="upfront_color_picker_rgba_r">\n\t</li>\n\t<li class="upfront_color_picker_rgba_g">\n\t\tG:\n\t\t<input type="text" value="{{g}}" data-type=\'g\' name="upfront_color_picker_rgba_g">\n\t</li>\n\t<li class="upfront_color_picker_rgba_b">\n\t\tB:\n\t\t<input type="text" value="{{b}}" data-type=\'b\'  name="upfront_color_picker_rgba_b">\t\t\n\t</li>\n\t<li class="upfront_color_picker_rgba_a">\n\t\tA:\n\t\t<input type="text" value="{{a}}" data-type=\'a\' name="upfront_color_picker_rgba_a">\t\t\t\n\t</li>\n</ul>\n<span class="upfront_color_picker_reset noColor"></span>'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/fields",["scripts/upfront/upfront-views-editor/mixins","scripts/upfront/upfront-views-editor/theme-colors","text!upfront/templates/color_picker.html"],function(i,n,o){var r=Backbone.View.extend({className:"upfront-field-wrap",initialize:function(t){this.options=t,this.multiple="undefined"!=typeof this.options.multiple?this.options.multiple:"undefined"!=typeof this.multiple&&this.multiple,this.label="undefined"!=typeof this.options.label?this.options.label:"",this.default_value="undefined"!=typeof this.options.default_value?this.options.default_value:this.multiple?[]:"",this.options.property?(this.property=this.model.get_property_by_name(this.options.property),this.property===!1&&(this.model.init_property(this.options.property,this.default_value),this.property=this.model.get_property_by_name(this.options.property)),this.property_name=this.options.property,"undefined"!=typeof this.options.use_breakpoint_property&&(this.use_breakpoint_property=this.options.use_breakpoint_property)):this.property=!1,this.name=this.options.name?this.options.name:this.cid,this.selected_state=this.selected_state?this.selected_state:"",this.options.init&&this.options.init(),this.init&&this.init(),this.options.change&&this.on("changed",this.options.change,this),this.options.show&&this.on("changed rendered",this.dispatch_show,this),this.options.focus&&this.on("focus",this.options.focus,this),this.options.blur&&this.on("blur",this.options.blur,this),this.options.rendered&&this.on("rendered",this.options.rendered,this),this.options.on_click&&(this.on_click=this.options.on_click),this.once("rendered",function(){var t=this;this.get_field().on("focus",function(){t.trigger("focus")}).on("blur",function(){t.trigger("blur")})},this)},dispatch_show:function(){var t=this;setTimeout(function(){t.options.show(t.get_value(),t.$el)},100)},get_name:function(){return this.property?this.property.get("name"):this.name},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?this.model.get_breakpoint_property_value(this.property_name,!0):this.property.get("value");if(this.model){var t=this.model.get(this.name);return t?t:this.default_value}return this.default_value},get_value:function(){var e=this.get_field();return!this.multiple||1==e.size()&&e.is("select")?e.val():_.map(e,function(e){return t(e).val()})},set_value:function(t){this.get_field().val(t)},get_field_id:function(){return this.cid+"-"+this.get_name()},get_field_name:function(){return this.get_name()},get_field:function(){return this.$el.find("[name="+this.get_field_name()+"]"+(this.selected_state?":"+this.selected_state:""))},get_label_html:function(){if(this.options.hide_label===!0)return"";var t={for:this.get_field_id(),class:"upfront-field-label "+("inline"==this.options.label_style?"upfront-field-label-inline":"upfront-field-label-block")};return"<label "+this.get_field_attr_html(t)+">"+this.label+"</label>"},get_field_attr_html:function(t){return _.map(t,function(t,e){return e+'="'+t+'"'}).join(" ")}}),s=r.extend({className:"upfront-field-wrap upfront-field-wrap-text",render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html());var e=this;this.get_field().keyup(function(){""===t(this).val()?t(this).addClass("upfront-field-empty"):t(this).hasClass("upfront-field-empty")&&t(this).removeClass("upfront-field-empty")}).trigger("keyup").change(function(){e.trigger("changed",e.get_value())}),this.trigger("rendered")},get_field_html:function(){var t={type:"text",class:"upfront-field upfront-field-text",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),a=s.extend({is_edited:!1,className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-toggleable",render:function(){if(s.prototype.render.call(this),this.is_edited)return!1;this.$el.append(' <a href="#" class="upfront-toggleable-button">Edit</a>');var e=this;this.$el.on("click",".upfront-toggleable-button",function(i){i.preventDefault(),i.stopPropagation();var n=t(this),o=e.get_field();n.hide(),o.replaceWith(e.get_editable_html()),e.is_edited=!0})},has_been_edited:function(){return this.is_edited},reset_state:function(){this.is_edited=a.prototype.is_edited},get_field_html:function(){return this.is_edited?this.get_editable_html():this.get_toggleable_html()},get_field:function(){return this.is_edited?s.prototype.get_field.call(this):this.$el.find(".upfront-field-toggleable-value")},get_value:function(){return this.is_edited?s.prototype.get_value.call(this):t.trim(this.get_field().text())},set_value:function(t){return this.is_edited?this.get_field().val(t):this.get_field().text(t)},get_toggleable_html:function(){var t=this.get_value()||this.get_saved_value();return'<span class="upfront-field-toggleable-value">'+t+"</span>"},get_editable_html:function(){var t={type:"text",class:"upfront-field upfront-field-text upfront-field-toggleable",id:this.get_field_id(),name:this.get_field_name(),value:this.get_value()||this.get_saved_value()};return"inline"===this.options.label_style&&(t.class+=" upfront-has_inline_label"),this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),l=r.extend({className:"upfront-field-wrap upfront-field-wrap-button",events:{click:"on_click"},render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.options.info&&this.$el.append(this.get_info_html()),this.$el.append(this.get_field_html());this.options.classname&&this.$el.addClass(this.options.classname),this.trigger("rendered"),this.delegateEvents()},get_info_html:function(){return'<span class="button-info">'+this.options.info+"</span>"},get_field_html:function(){var t={type:"button",class:"upfront-field upfront-field-button",id:this.get_field_id(),name:this.get_field_name(),value:this.label};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.value=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),p=s.extend({get_field_html:function(){var t={type:"email",class:"upfront-field upfront-field-text upfront-field-email",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),d=s.extend({className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-textarea",get_field_html:function(){var t={cols:"40",rows:"5",class:"upfront-field upfront-field-text upfront-field-textarea",id:this.get_field_id(),name:this.get_field_name()};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<textarea "+this.get_field_attr_html(t)+">"+this.get_saved_value()+"</textarea>"}}),c=s.extend({className:"upfront-field-wrap upfront-field-wrap-number",get_field_html:function(){var t={type:"number",class:"upfront-field upfront-field-number",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return"undefined"!=typeof this.options.min&&(t.min=this.options.min),"undefined"!=typeof this.options.max&&(t.max=this.options.max),"undefined"!=typeof this.options.step&&(t.step=this.options.step)," <input "+this.get_field_attr_html(t)+" /> "+(this.options.suffix?this.options.suffix:"")}}),u=s.extend(_.extend({},i.Upfront_Icon_Mixin,{className:"upfront-field-wrap upfront-field-wrap-slider",initialize:function(t){this.options=t,u.__super__.initialize.apply(this,arguments);var e=this,i={range:this.getOption("range","min"),min:this.getOption("min",0),max:this.getOption("max",0),step:this.getOption("step",1),orientation:this.getOption("orientation","horizontal"),value:this.get_saved_value()};this.value=this.get_saved_value(),"undefined"==typeof this.value&&(this.value=i.min),this.options.callbacks&&_.extend(i,this.options.callbacks),i.slide=function(t,i){var n=i.value;e.value=n,e.$("input").val(e.value).trigger("change"),e.options.valueTextFilter&&(n=e.options.valueTextFilter(n)),e.$(".upfront-field-slider-value").text(n),e.options.callbacks&&e.options.callbacks.slide&&e.options.callbacks.slide(t,i)},this.on("rendered",function(){var t=e.$("#"+e.get_field_id());"vertical"==i.orientation&&t.addClass("upfront-field-slider-vertical"),t.slider(i)})},get_field_html:function(){var t='<input type="hidden" name="'+this.get_field_name()+'" value="'+this.value+'">',e=this.value;return this.options.info&&(t+='<div class="upfront-field-info">'+this.options.info+"</div>"),t+='<div class="upfront-field upfront-field-slider" id="'+this.get_field_id()+'"></div>',this.options.valueTextFilter&&(e=this.options.valueTextFilter(e)),t+='<div class="upfront-field-slider-value"> '+e+"</div>"},getOption:function(t,e){return this.options[t]?this.options[t]:e}})),h=s.extend({className:"upfront-field-wrap upfront-field-wrap-hidden",get_field_html:function(){var t={type:"hidden",id:this.get_field_id(),name:this.get_field_name(),class:"upfront-field upfront-field-hidden",value:this.get_saved_value()};return" <input "+this.get_field_attr_html(t)+" /> "}}),f=s.extend({className:"upfront-field-wrap upfront-field-wrap-color sp-cf",defaults:{blank_alpha:1,autoHide:!0,hideOnOuterClick:!0},spectrumDefaults:{clickoutFiresChange:!1,chooseText:"OK",showSelectionPalette:!0,showAlpha:!0,showPalette:!0,localStorageKey:"spectrum.recent_colors",palette:n.colors.pluck("color").length?n.colors.pluck("color"):[],maxSelectionSize:10,preferredFormat:"hex",showInput:!0,allowEmpty:!0,appendTo:"parent"},events:{"change .upfront_color_picker_rgba input":"rgba_sidebar_changed","change .sp-input":"sp_input_changed","click .upfront_color_picker_reset":"set_to_blank"},initialize:function(i){this.options=_.extend({},this.defaults,i),this.field_options=_.extend({},this.defaults,i),this.options.blank_alpha=_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha,this.sidebar_template=_.template(o);var n=this,r="object"==typeof this.options.spectrum?_.extend({},this.spectrumDefaults,this.options.spectrum):this.spectrumDefaults;this.rgba={r:0,g:0,b:0,a:0},this.spectrumOptions=r,r.move=_.bind(this.on_spectrum_move,this),r.show=_.bind(this.on_spectrum_show,this),r.beforeShow=_.bind(this.on_spectrum_beforeShow,this);var s=function(t){n.options.spectrum&&n.options.spectrum.hide&&n.options.spectrum.hide(t)};r.hide=s,r.autoHide||(r.hide=function(t){n.color=t,s(t),n.$(".sp-replacer").addClass("sp-active"),n.$(".sp-container").removeClass("sp-hidden")}),this.l10n_update=_.debounce(function(){t(".sp-container").each(function(){t(this).find(".sp-input-container").attr("data-label",e.current_color).end().find(".sp-palette-container").attr("data-label",e.theme_colors).end().find(".sp-palette-row:last").attr("data-label",e.recent_colors)})}),f.__super__.initialize.apply(this,arguments),this.on("rendered",this._rendered)},_rendered:function(){var t=this;this.$("input[name="+this.get_field_name()+"]").spectrum(this.spectrumOptions),this.$spectrum=this.$("input[name="+this.get_field_name()+"]"),this.$spectrum.on("reflow.spectrum move.spectrum change",this.l10n_update),this.$(".sp-container").append("<div class='color_picker_rgb_container'></div>"),this.update_input_border_color(this.get_saved_value()),this.$(".sp-container").data("field_color",this),this.$(".sp-container").data("$spectrum",this.$spectrum),this.$(".sp-container").find(".sp-choose").on("click.spectrum",function(e){t.options.spectrum&&t.options.spectrum.choose&&t.color&&t.options.spectrum.choose(t.color),t.options.autoHide!==!0&&(t.$(".sp-replacer").removeClass("sp-active"),t.$(".sp-container").addClass("sp-hidden"),Upfront.Events.trigger("color:spectrum:hide"))}),this.$(".sp-container").find(".sp-choose").text(Upfront.Settings.l10n.global.content.ok)},on_spectrum_move:function(e,i){if(!_.isEmpty(e)){this.color=e;var n=e.toHexString();t(".sp-dragger").css({"border-top-color":n,"border-right-color":n}),this.update_input_border_color(e.toRgbString()),this.update_input_val(n),this.rgba=_.extend(this.rgba,e.toRgb()),this.render_sidebar_rgba(this.rgba)}this.options.spectrum&&this.options.spectrum.move&&this.options.spectrum.move(e),this.toggle_alpha_selector(e,i)},on_spectrum_show:function(e){Upfront.Events.trigger("color:spectrum:show");var i=t(".sp-input"),n=i.val();if(!_.isEmpty(e)){this.color=e;var o=e.toHexString();this.rgba=_.extend(this.rgba,e.toRgb()),this.update_input_border_color(e.toRgbString()),this.render_sidebar_rgba(this.rgba),this.update_input_val(o)}if(!_.isEmpty(n)&&!this.is_hex(n)){var r=tinycolor(n);i.val(r.toHexString())}if(this.options.spectrum&&this.options.spectrum.show&&this.options.spectrum.show(e),t(".sp-container").not(this.$(".sp-container")).each(function(){var e=t(this),i=e.data("sp-options");i&&i.flat||e.addClass("sp-hidden")}),!_.isEmpty(e)){var s=this;tinycolor(e);setTimeout(function(){s.toggle_alpha_selector(e)},100)}!this.options.spectrum||this.options.spectrum.flat||this.field_options&&this.field_options.flat||!this.field_options.hideOnOuterClick||t("html").on("mousedown",_.bind(this.hide_on_outer_click,this))},on_spectrum_beforeShow:function(e){e instanceof Object&&t.extend(e,tinycolor.prototype),this.color=e,this.update_palette(),this.$("input[name="+this.get_field_name()+"]").spectrum("option","palette",this.options.palette),this.options.spectrum&&this.options.spectrum.beforeShow&&this.options.spectrum.beforeShow(e),this.$(".sp-container").data("sp-options",this.options.spectrum)},render:function(){f.__super__.render.apply(this,arguments),this.stopListening(Upfront.Events,"theme_colors:update");var t=_.debounce(this.update_palette,200);this.listenTo(Upfront.Events,"theme_colors:update",t,this)},hide_on_outer_click:function(e){if(!this.$(".sp-container").hasClass("sp-hidden")){var i=t(e.target);i.is(".sp-container")||i.parents(".sp-container").length||(this.revert(),this.$(".sp-container").addClass("sp-hidden"),Upfront.Events.trigger("color:spectrum:hide"),t("html").off("mousedown",_.bind(this.hide_on_outer_click,this)))}},revert:function(){this.$spectrum.trigger("click.spectrum"),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(this.color),this.color&&this.color.toRgbString&&this.update_input_border_color(this.color.toRgbString)},update_palette:function(){this.$spectrum&&this.$spectrum.spectrum&&this.$spectrum.spectrum("option","palette",n.colors.pluck("color").length?n.colors.pluck("color"):[])},is_hex:function(t){return t.indexOf("#")!==-1},get_field_html:function(){var t={type:"text",class:"upfront-field upfront-field-color",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return" <input "+this.get_field_attr_html(t)+" /> "+(this.options.suffix?this.options.suffix:"")},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?Upfront.Util.colors.to_color_value(this.model.get_breakpoint_property_value(this.property_name,!0)):this.property.get("value");if(this.model){var t=this.model.get(this.name);return t?t:this.default_value}return this.default_value},update_input_border_color:function(e){var i=this.$el.find(".sp-preview");t(".sp-input").css({borderColor:e}),i.css({backgroundColor:e}),"rgba(0, 0, 0, 0)"!==e?i.removeClass("uf-unset-color"):0===i.closest(".theme_colors_empty_picker").length&&i.addClass("uf-unset-color")},update_input_val:function(t){this.$(".sp-input").val(t)},render_sidebar_rgba:function(t){var e=this;this.$(".color_picker_rgb_container").html(this.sidebar_template(t)),this.$(".upfront_color_picker_reset").on("click",function(t){t.preventDefault(),e.set_to_blank()})},rgba_sidebar_changed:function(e){var i=t(e.target),n=i.data("type"),o=parseFloat(i.val()),r=this.$spectrum.spectrum("get"),s={};s[n]=o,r=tinycolor(_.extend(r.toRgb(),s)),this.$spectrum.spectrum("set",r.toRgbString()),this.update_input_border_color(r.toRgbString()),this.update_input_val(r.toHexString()),this.render_sidebar_rgba(r.toRgb()),this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(r),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(r),e.stopPropagation(),e.preventDefault(),this.$spectrum.trigger("dragstop.spectrum")},sp_input_changed:function(e){var i=tinycolor(t(e.target).val());this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(i),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(i),this.update_input_border_color(i.toRgbString)},set_to_blank:function(){var t="rgba(0, 0, 0, "+(_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha)+")",e=tinycolor(t);e.reset=!0,this.rgba={r:0,g:0,b:0,a:0},this.$spectrum.spectrum("set",e.toRgbString()),this.update_input_border_color(t),this.update_input_val("#000000"),this.render_sidebar_rgba(this.rgba),this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(e),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(e),this.options&&"function"==typeof this.options.move&&this.options.move(e),this.options&&"function"==typeof this.options.change&&this.options.change(e)},get_value:function(){return this.$el.find(".sp-preview-inner").css("background-color")},set_value:function(t){Upfront.Util.colors.is_theme_color(t)&&(t=Upfront.Util.colors.get_color(t));var e=tinycolor(t);this.color=e,this.$spectrum.spectrum("set",e)},toggle_alpha_selector:function(i){if(!_.isEmpty(i)){var n=this.$(".sp-alpha");Upfront.Views.Theme_Colors.colors.is_theme_color(i)?(n.addClass("sp-alpha-disabled sp-alpha-lower-opacity"),$overlay=t("<span class='sp-alpha-overlay' title='"+e.theme_colors_opacity_disabled+"'>"+e.theme_colors_opacity_disabled+"</span>").on("click",function(t){t.stopPropagation(),t.preventDefault()}),this.$(".sp-alpha-overlay").length||n.before($overlay)):(n.removeClass("sp-alpha-disabled sp-alpha-lower-opacity"),this.$(".sp-alpha-overlay").remove())}}}),g=r.extend(_.extend({},i.Upfront_Icon_Mixin,{get_values_html:function(){return _.map(this.options.values,this.get_value_html,this).join("")},set_value:function(t){this.$el.find('[value="'+t+'"]').trigger("click")}})),m=g.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-field-select-value":"openOptions","mouseup .upfront-field-select":"onMouseUp","change .upfront-field-select-option input":"onChange","click .upfront-field-select-option label":"onOptionClick"},onOptionClick:function(e){if(!this.multiple){if(e.stopPropagation(),t(this).closest(".upfront-field-select-option").hasClass("upfront-field-select-option-disabled"))return;t(e.currentTarget).siblings("input").not(":checked")&&t(e.currentTarget).siblings("input").click(),this.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),this.trigger("blur")}},openOptions:function(e){if(e&&e.stopPropagation(),!this.options.disabled){t(".upfront-field-select-expanded").removeClass("upfront-field-select-expanded"),this.$el.find(".upfront-field-select").css("min-width","").css("min-width",this.$el.find(".upfront-field-select").width()),this.$el.find(".upfront-field-select").addClass("upfront-field-select-expanded");var i=this;_.delay(function(){var e=i.$el.parents("#sidebar-ui").length,n=i.$el.parents("#element-settings-sidebar").length,o=46;if(1==e||1==n){var r=i.$el.find(".upfront-field-select-options"),s=r.parent(),a=s.offset().top-t("#element-settings-sidebar").offset().top;a+=o,r.css("width",s.width()+3),r.css("top",a+"px"),Upfront.Util.isRTL()?r.css("right",t(window).width()-s.offset().left-s.width()+"px"):r.css("left",s.offset().left+"px"),r.css("display","block")}},10),t(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.on_scroll),this.trigger("focus")}},on_scroll:function(t){var e=t.data;e.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),e.trigger("blur")},onMouseUp:function(t){t.stopPropagation()},onChange:function(){this.update_select_display_value(),this.trigger("changed",this.get_value())},selected_state:"checked",className:"upfront-field-wrap upfront-field-wrap-select",render:function(){this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.trigger("rendered")},update_select_display_value:function(){var e=this.options.select_label?this.options.select_label:this.options.placeholder?this.options.placeholder:"",i=this.$el.find(".upfront-field-select-value"),n=this.$el.find(".upfront-field-select-option input:checked");if(1!=n.length||this.multiple){var o=[];n.each(function(){o.push(t(this).closest(".upfront-field-select-option").text())}),i.text(0===n.length?e:o.join(", "))}else{var r=n.closest(".upfront-field-select-option"),s=r.text(),a=r.find(".upfront-field-icon").clone();i.html(""),a&&i.append(a),i.append("<span>"+s+"</span>")}this.$el.find(".upfront-field-select-option").each(function(){t(this).find("input:checked").length>0?t(this).addClass("upfront-field-select-option-selected"):t(this).removeClass("upfront-field-select-option-selected")})},get_field_html:function(){var t={class:"upfront-field-select upfront-no-select",id:this.get_field_id()};return t.class+=" upfront-field-select-"+(this.options.multiple?"multiple":"single"),this.options.disabled&&(t.class+=" upfront-field-select-disabled"),"zebra"==this.options.style&&(t.class+=" upfront-field-select-zebra"),"<div "+this.get_field_attr_html(t)+'><div class="upfront-field-select-value"></div><ul class="upfront-field-select-options">'+this.get_values_html()+"</ul></div>"},get_value_html:function(t,e){var i=this.get_field_id()+"-"+e,n={type:this.multiple?"checkbox":"radio",id:i,name:this.get_field_name(),class:"upfront-field-"+(this.multiple?"checkbox":"radio"),value:t.value},o=this.get_saved_value(),r="upfront-field-select-option";t.disabled&&(n.disabled="disabled",r+=" upfront-field-select-option-disabled");var s=this.options.icon_class?this.options.icon_class:null;this.multiple&&_.contains(o,t.value)?n.checked="checked":this.multiple||o!=t.value||(n.checked="checked"),n.checked&&(r+=" upfront-field-select-option-selected"),r+=" upfront-field-select-option-"+(0===e%2?"odd":"even");var a="<input "+this.get_field_attr_html(n)+" />";
return'<li class="'+r+'"><label for="'+i+'">'+this.get_icon_html(t.icon,s)+'<span class="upfront-field-label-text">'+t.label+"</span></label>"+a+"</li>"}})),v=m.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,initialize:function(e){this.options=e,r.prototype.initialize.call(this,e),t(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.closeChosen)},render:function(){var t=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.$el.find("select").on("chosen:hiding_dropdown",function(){t.allowMouseWheel()}),this.trigger("rendered")},get_field_html:function(){var t=this.multiple?"multiple":"";return['<select class="upfront-chosen-select"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(t,e){var i="";return t.value===this.options.default_value&&(i=' selected="selected"'),['<option value="',t.value,'"',i,">",t.label,"</option>"].join("")},on_change:function(t){this.allowMouseWheel(),this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed")},get_value:function(){return this.$el.find("select").val()},set_value:function(t){this.$el.find("select").val(t).trigger("chosen:updated")},openOptions:function(e){t(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").bind("mousewheel",function(){return!1});var i=this;_.delay(function(){var e=i.$el.parents("#sidebar-ui").length,n=i.$el.parents("#element-settings-sidebar").length,o=44;if(1==e||1==n){var r=i.$el.find(".chosen-drop"),s=r.parent(),a=s.offset().top-t("#element-settings-sidebar").offset().top+s.height();a+=o,r.css("width",s.width()),r.css("top",a+"px"),r.css("left",s.offset().left+"px"),r.css("display","block")}},20),i.$el.find(".chosen-drop").show()},closeChosen:function(t){var e=t.data,i=e.$el.parents("#sidebar-ui").length,n=e.$el.parents("#element-settings-sidebar").length;1!=i&&1!=n||e.$el.find(".chosen-drop").css("display","none"),e.$el.find("select").trigger("chosen:close"),e.allowMouseWheel()},allowMouseWheel:function(){t(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").unbind("mousewheel")}}),b=v.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var t=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-typeface"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(t,e){var i="",n=this.get_saved_value();return t.value===n&&(i=' selected="selected"'),['<option value="',t.value,'"',i,' style="font-family: ',t.value,'">',t.label,"</option>"].join("")},render:function(){v.prototype.render.call(this);var e=this;t(".upfront-chosen-select-typeface",this.$el).chosen({width:this.options.select_width}),setTimeout(function(){e.set_option_font(e.get_saved_value())},50)},on_change:function(t){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(t){this.$el.find(".chosen-single").css("font-family",t)},openOptions:function(t){v.prototype.openOptions.call(this)}}),y=v.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var t=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-style"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(t,e){var i="",n=this.options.font_family,o=Upfront.Views.Font_Model.parse_variant(t.value),r=this.get_saved_value();t.value===r&&(i=' selected="selected"');var s=this.map_labels(o.weight,o.style);return['<option value="',t.value,'"',i,' style="font-family: ',n,"; font-weight: ",o.weight,"; font-style: ",o.style,' ">',s,"</option>"].join("")},render:function(){v.prototype.render.call(this);var e=this;t(".upfront-chosen-select-style",this.$el).chosen({width:this.options.select_width,disable_search:!0}),setTimeout(function(){e.set_option_font(e.get_saved_value())},50)},map_labels:function(t,i){var n,o={100:e.label_thin,200:e.label_extra_light,300:e.label_light,400:e.label_regular,500:e.label_medium,600:e.label_semi_bold,700:e.label_bold,800:e.label_extra_bold,900:e.label_ultra_bold};return n=!_.isUndefined(t)&&t.match(/^(\d+)/)?o[t]:t,"italic"==i&&(n+=" "+i),n},on_change:function(t){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(t){var e=this.$el.parent().parent().find(".upfront-chosen-select-typeface").val(),i=Upfront.Views.Font_Model.parse_variant(t);this.$el.find(".chosen-single").css({"font-family":e,"font-weight":i.weight,"font-style":i.style})},openOptions:function(t){v.prototype.openOptions.call(this)}}),w=v.extend({events:{"change select":"on_change","click .chosen-container-multi":"openOptions"},multiple:!0,get_field_html:function(){var t=this.multiple?"multiple":"";return['<select class="upfront-chosen-select-multiple"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(t,e){var i="",n=this.get_saved_value();return _.contains(n,t.value)&&(i=' selected="selected"'),['<option value="',t.value,'"',i,">",t.label,"</option>"].join("")},render:function(){v.prototype.render.call(this);t(".upfront-chosen-select-multiple",this.$el).chosen({width:this.options.select_width})},on_change:function(t){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none")},openOptions:function(t){v.prototype.openOptions.call(this)}}),k=g.extend({selected_state:"checked",render:function(){var e=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.$el.on("change",".upfront-field-multiple input",function(){e.$el.find(".upfront-field-multiple").each(function(){t(this).find("input:checked").size()>0?t(this).addClass("upfront-field-multiple-selected"):t(this).removeClass("upfront-field-multiple-selected")}),e.trigger("changed",e.get_value())}),this.trigger("rendered")},get_field_html:function(){return this.get_values_html()},get_value_html:function(t,e){var i=this.get_field_id()+"-"+e,n="upfront-field-multiple",o={type:this.type,id:i,name:this.get_field_name(),value:t.value,class:"upfront-field-"+this.type},r=this.get_saved_value(),s=this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(n+=" upfront-field-multiple-"+this.options.layout),t.disabled&&(o.disabled="disabled",n+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(r,t.value)?o.checked="checked":this.multiple||r!=t.value||(o.checked="checked"),t.checked&&(o.checked="checked"),o.checked&&(n+=" upfront-field-multiple-selected"),'<span class="'+n+'"><input '+this.get_field_attr_html(o)+' /><label for="'+i+'">'+this.get_icon_html(t.icon,s)+'<span class="upfront-field-label-text">'+t.label+"</span></label></span>"}}),$=k.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",type:"radio"}),x=k.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",type:"checkbox",multiple:!0}),U=x.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes upfront-field-wrap-optional",events:{"change input":"onChange"},initialize:function(t){var e=this;U.__super__.initialize.apply(this,arguments),this.options=t,this.on("panel:set",function(){this.panel.on("rendered",function(){e.onChange()})}),t.onChange&&(this.onChange=t.onChange)},onChange:function(){var e=this.$("input"),i=this.panel.$("input[name="+this.options.relatedField+"]").closest(".upfront-field-wrap");e.is(":checked")?i.show():i.hide(),t("#settings").height(this.panel.$(".upfront-settings_panel").outerHeight()),this.model.set_property(this.options.property,this.get_value())}}),E=r.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-suggest-add":"add_list","focus .upfront-field-text-suggest":"reveal_suggest","keyup .upfront-field-text-suggest":"update_suggest"},multiple:!0,selected_state:"checked",added_list:[],checked_list:[],suggest_list:[],render:function(){var i=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append('<div class="upfront-suggest-wrap" />');var n=this.$el.find(".upfront-suggest-wrap");n.append(this.get_field_html()),n.append('<div class="upfront-suggest-list-wrap upfront-no-select" />'),this.checked_list=this.get_saved_value();var o=this.$el.find(".upfront-suggest-list-wrap");o.append('<ul class="upfront-suggest-lists">'+this.get_suggest_list_html()+"</ul>"),o.append('<div class="upfront-suggest-add-wrap"><span class="upfront-suggest-add-value"></span><span class="upfront-suggest-add">'+e.add_new+"</span></div>"),this.stop_scroll_propagation(this.$el.find(".upfront-suggest-lists")),this.$el.on("change",".upfront-suggest-list input",function(){var e=t(this).val();!t(this).is(":checked")&&_.contains(i.checked_list,e)?i.checked_list=_.without(i.checked_list,e):i.checked_list.push(e),i.trigger("changed")}),this.$el.on("click",function(t){t.stopPropagation()}),t("#settings").on("click",".upfront-settings_panel",function(){i.$el.find(".upfront-suggest-list-wrap").removeClass("upfront-suggest-list-wrap-expanded")}),this.trigger("rendered")},reveal_suggest:function(){this.$el.find(".upfront-suggest-list-wrap").addClass("upfront-suggest-list-wrap-expanded"),this.update_suggest()},update_suggest:function(){var t=this.get_field_input_value();this.$el.find(".upfront-suggest-lists").html(this.get_suggest_list_html()),t?(this.$el.find(".upfront-suggest-add-wrap").show(),this.$el.find(".upfront-suggest-add-value").text(t),this.$el.find(".upfront-suggest-add").toggle(!_.contains(this.suggest_list,t))):this.$el.find(".upfront-suggest-add-wrap").hide()},get_field_html:function(){var t={type:"text",class:"upfront-field upfront-field-text upfront-field-text-suggest",id:this.get_field_id()};return this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"},get_suggest_list_html:function(){var t=this.get_field_input_value(),e=!!t&&new RegExp("("+t+")","ig"),i=this.get_suggest_list(e),n=this;return _.map(i,function(t,i){var o=n.get_field_id()+"-"+i,r={type:"checkbox",id:o,name:n.get_field_name(),value:t,class:"upfront-field-checkbox"};_.contains(n.checked_list,t)&&(r.checked="checked");var s=e?t.replace(e,'<span class="upfront-suggest-match">$1</span>'):t;return'<li class="upfront-suggest-list"><input '+n.get_field_attr_html(r)+' /><label for="'+o+'">'+s+"</label></li>"}).join("")},get_suggest_list:function(t){var e=[];return _.each([this.options.source,this.added_list,this.get_saved_value()],function(i,n){_.each(i,function(i){2==n&&_.contains(e,i)||!(t&&i.match(t)||!t)||e.push(i)})}),this.suggest_list=e,e},get_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val()},empty_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val("")},add_list:function(t){var e=this.get_field_input_value();this.added_list.push(e),this.checked_list.push(e),this.empty_field_input_value(),this.update_suggest()}})),S=m.extend({initialize:function(t){m.prototype.initialize.call(this,t),this.options.values=this.get_anchors()},get_anchors:function(){var t=Settings_AnchorTrigger.prototype.get_anchors.call(this),e=[];return _(t).each(function(t){e.push({label:t,value:t})}),e}}),C=Backbone.View.extend({tagName:"li",events:{"change input":"on_change"},className:function(){var t="upfront-field-select-option";return this.model.get("default")&&(t+=" upfront-field-select-option-disabled"),this.model.get("enabled")&&(t+=" upfront-field-select-option-selected"),t},template:'<label><span class="upfront-field-label-text">{{ name }} {[ if (width > 0) { ]}({{width}}px){[ } ]}</span></label><input type="checkbox" class="upfront-field-checkbox" value="{{ id }}" {[ if (is_default) { ]} disabled="disabled"{[ } ]}{[ if (enabled) { ]} checked="checked"{[ } ]}>',initilize:function(t){this.options=t||{},this.listenTo(this.model,"change",this.render)},on_change:function(t){this.model.set({enabled:this.$el.find("input").is(":checked")})},render:function(){var t=this.model.toJSON();return t.is_default=t.default,this.$el.append(_.template(this.template,t)),this}}),T=m.extend({className:"upfront-field-select upfront-no-select upfront-field-compact-label-select",template:'<ul class="upfront-field-select-options"><li class="upfront-field-select-option"><label><span class="upfront-field-label-text">{{ label_text }}</span></label></li></ul></div>',initialize:function(t){this.options=t||{},this.listenTo(this.collection,"add remove change:name change:width",this.render)},render:function(){this.$el.html(""),this.$el.append(_.template(this.template,this.options)),this.$el.addClass(" upfront-field-select-"+(this.options.multiple?"multiple":"single")),this.options.disabled&&this.$el.addClass("upfront-field-select-disabled"),"zebra"==this.options.style&&this.$el.addClass("upfront-field-select-zebra"),_.each(this.collection.models,function(t){var e=new C({model:t});e.render(),this.$el.find("ul").append(e.el)},this)},onOptionClick:function(t){this.$el.toggleClass("compact-label-select-open"),m.prototype.onOptionClick.call(this,t)}}),z=r.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input type="checkbox" class = "upfront-field-checkbox" /> <label><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+e.anchor_nag+"</div></div>",initialize:function(t){r.prototype.initialize.call(this,t),this.options.field=new s(this.options)},render:function(){var t=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(e){e.stopPropagation(),t.field_toggle.apply(t)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(e){e.stopPropagation(),t.check_value.apply(t)}),setTimeout(function(){t.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var t=this.$el.find('[name="'+this.options.field.get_name()+'"]'),e=this.$el.find(".upfront-embedded_toggleable"),i=t.length&&t.val?t.val():"";e.removeClass("error").removeClass("ok"),i.length&&!i.match(/^[a-zA-Z]+$/)?e.addClass("error"):i.length&&e.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var t=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:t.html()}))},get_value:function(){var t=this.$el.find(":checkbox"),e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),i=e.val().replace(/[^a-zA-Z]/g,"");return t.is(":checked")&&i?i:""}});return{Field:r,Text:s,Button:l,Email:p,Textarea:d,Color:f,Multiple_Suggest:E,Chosen_Select:v,Typeface_Chosen_Select:b,Typeface_Style_Chosen_Select:y,Multiple_Chosen_Select:w,Number:c,Slider:u,Select:m,Radios:$,Checkboxes:x,Hidden:h,Anchor:S,Optional:U,Field_Compact_Label_Select_Option:C,Field_Compact_Label_Select:T,Field_Complex_Toggleable_Text_Field:z,ToggleableText:a}})}(jQuery),define("text!upfront/templates/popup.html",[],function(){return'<div>\r\n\t<!--\r\n        Wrap everything in a div to convert this file\'s content in a jquery element\r\n        so it is possible to use $.find.\r\n    -->\r\n\t<script type="text/template" id="upfront-post-list-tpl">\r\n\t\t<div id="upfront-list">\r\n\t\t\t<div id="upfront-list-meta" class="upfront-list_item clearfix">\r\n\t\t\t\t<div class="upfront-list_item-component upfront-date upfront-header {{ orderby == \'post_date\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_date">{{Upfront.Settings.l10n.global.content.date}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-title upfront-header {{ orderby == \'post_title\' ? \'active ordered-\' + order : \'\' }}"  data-sortby="post_title">Post Title <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-author upfront-header {{ orderby == \'post_author\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_author">Author <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-comments-count upfront-header {{ orderby == \'post_comments\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_comments"><i class="icon-post-comments"></i> <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-list-items upfront-scroll-panel">\r\n\t\t\t\t{[ if(!posts.length){ ]}\r\n\t\t\t\t<p class="upfront-no-results">{{Upfront.Settings.l10n.global.content.no_posts}}</p>\r\n\t\t\t\t{[ } else { ]}\r\n\t\t\t\t{[ _.each(posts, function (post, idx){ ]}\r\n\t\t\t\t<div class="upfront-list_item-post upfront-list_item clearfix status-{{ post.get("post_status") }}" data-post_id="{{ post.get("ID") }}">\r\n\t\t\t\t<div class="upfront-list_item-component upfront-date post-status-{{ post.get("post_status") }}" title="{[ if(post.get("post_status") == "publish") { ]}Published{[ } else if(post.get("post_status") == "future") { ]}Scheduled{[ } else { ]}Draft{[ } ]}">{[ if(post.get("post_status") == "future") { ]}sched. for{[ } ]}\r\n\t\t\t\t{{ Upfront.Util.format_date(post.get("post_date")) }}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-title upfront-list_item-main">{{ post.get("post_title") }}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-author">{[ if(post.author.get(\'data\')){ ]} {{ post.author.get(\'data\').display_name }} {[ } ]}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-comments-count">{{ post.get("comment_count") }}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-editactions">\r\n\t\t\t\t{[ if (canEdit || (canEditOwn && parseInt(post.get(\'post_author\'), 10) === Upfront.data.currentUser.id)) { ]}\r\n\t\t\t\t<a href="/edit/post/{{ post.get("ID") }}" class="editaction edit">\r\n\t\t\t\t\t{{Upfront.Settings.l10n.global.content.edit}}\r\n\t\t\t\t</a>{[ } ]}<a href="{{ post.get("permalink") }}" class="editaction view">\r\n\t\t\t\t\t{{Upfront.Settings.l10n.global.content.view}}\r\n\t\t\t\t</a>{[ if (canEdit || (canEditOwn && parseInt(post.get(\'post_author\'), 10) === Upfront.data.currentUser.id)) { ]}<a href="#" class="editaction trash">\r\n\t\t\t\t\t{{Upfront.Settings.l10n.global.content.trash}}\r\n\t\t\t\t</a>\r\n\t\t\t\t{[ } ]}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{[ }); } ]}\r\n\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" type="text/template" id="upfront-post-single-tpl">\r\n\t\t<div id="upfront-list-page" style="display:none">\r\n\t\t\t<div id="upfront-list-page-path">\r\n\t\t\t\t<a href="#" class="upfront-path-back">{{Upfront.Settings.l10n.global.content.posts}}</a> &nbsp;&raquo;&nbsp;\r\n\t\t\t\t<a href="#" class="last">{{ post.get(\'post_title\') }}</a>\r\n\t\t\t</div>\r\n\t\t\t<div id="upfront-list-page-preview">\r\n\t\t\t\t<div id="upfront-page_preview-wrapper">\r\n\t\t\t\t\t<div id="upfront-page_preview-featured_image" class="upfront-page_preview-item">\r\n\t\t\t\t\t\t<h4>Featured Image: </h4>\r\n\t\t\t\t\t\t<div class="upfront-thumbnailinfo">{{Upfront.Settings.l10n.global.content.loading}}</div>\r\n\t\t\t\t\t\t<img src="{{post.featuredImage }}" style="{{post.featuredImage ? \'\' : \'display:none\'}}" />\r\n\t\t\t\t\t\t<div class="upfront-page_preview-edit_feature"><a href="#">{{Upfront.Settings.l10n.global.content.edit}} <i class="icon-pencil"></i></a></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class="upfront-page_preview-bottom" id="upfront-page_preview-edit">\r\n\t\t\t\t\t\t<button type="button"><i class="icon-pencil"></i> {{Upfront.Settings.l10n.global.content.edit_post}}</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div id="upfront-list-page-tree" class="upfront-scroll-panel">\r\n\t\t\t\t<div class="upfront-post_content-wrapper">\r\n\t\t\t\t\t<div class="upfront-post_content">\r\n\t\t\t\t\t\t<h3>{{ post.get(\'post_title\') }}</h3>\r\n\t\t\t\t\t\t{{ post.get(\'post_content\') }}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="upfront-page-list-old-tpl">\r\n\t\t<div id="upfront-list-page" class="bordered-bottom clearfix">\r\n\t\t\t<div id="upfront-list-page-path"></div>\r\n\t\t\t<div id="upfront-list-page-preview">\r\n\t\t\t\t<div id="upfront-page_preview-wrapper">\r\n\t\t\t\t\t<h4>{{Upfront.Settings.l10n.global.content.select_page}}</h4>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div id="upfront-list-page-tree" class="upfront-list-items upfront-scroll-panel">\r\n\t\t\t\t{[ _.each(pages, function (page){ ]}\r\n\t\t\t\t{{ pageItemTemplate({page: page, pageItemTemplate: pageItemTemplate}) }}\r\n\t\t\t\t{[ }); ]}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template"  id="upfront-page-list-item-tpl">\r\n\t\t<div class="upfront-list-page_item {{ page.children.length ? \'has_children closed\' : \'\' }}" id="upfront-list-page_item-{{ page.get("ID") }}" data-post_id="{{ page.get("ID") }}">\r\n\t\t{[if(page.children.length){ ]}\r\n\t\t<i class="icon-caret-right"></i>\r\n\t\t<i class="icon-caret-down"></i>\r\n\t\t{[ } ]}\r\n\t\t{{ page.get("post_title") }}\r\n\t\t{[if(page.children.length){ page.children.each(function(child, idx) { ]}\r\n\t\t{{ pageItemTemplate({page: child, pageItemTemplate: pageItemTemplate}) }}\r\n\t\t{[ })}; ]}\r\n\t\t</div>\r\n\t</script>\r\n\r\n\r\n\t<script type="text/template" id="upfront-page-list-tpl">\r\n\t\t<div id="upfront-list">\r\n\t\t\t<div id="upfront-list-meta" class="upfront-list_item clearfix">\r\n\t\t\t\t<div class="upfront-list_item-component upfront-date upfront-header {{ orderby == \'post_date\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_date">{{Upfront.Settings.l10n.global.content.date}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-title upfront-header {{ orderby == \'post_title\' ? \'active ordered-\' + order : \'\' }}"  data-sortby="post_title">Page Title <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-author upfront-header {{ orderby == \'post_author\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_author">Author <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-comments-count upfront-header {{ orderby == \'post_comments\' ? \'active ordered-\' + order : \'\' }}" data-sortby="post_comments"><i class="icon-post-comments"></i> <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-list-items upfront-scroll-panel">\r\n\t\t\t\t{[ if(!pages.length){ ]}\r\n\t\t\t\t<p class="upfront-no-results">{{Upfront.Settings.l10n.global.content.no_posts}}</p>\r\n\t\t\t\t{[ } else { ]}\r\n\t\t\t\t{[ _.each(pages, function (post){ ]}\r\n\t\t\t\t<div class="upfront-list_item-post upfront-list_item clearfix status-{{ post.get("post_status") }}" data-post_id="{{ post.get("ID") }}">\r\n\t\t\t\t<div class="upfront-list_item-component upfront-date post-status-{{ post.get("post_status") }}" title="{[ if(post.get("post_status") == "publish") { ]}Published{[ } else if(post.get("post_status") == "future") { ]}Scheduled{[ } else { ]}Draft{[ } ]}">{[ if(post.get("post_status") == "future") { ]}sched. for{[ } ]}\r\n\t\t\t\t{{ Upfront.Util.format_date(post.get("post_date")) }}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-title upfront-list_item-main">{{ post.get("post_title") }}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-author">{[ if(post.author.get(\'data\')){ ]} {{ post.author.get(\'data\').display_name }} {[ } ]}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-comments-count">{{ post.get("comment_count") }}</div>\r\n\t\t\t<div class="upfront-list_item-component upfront-editactions">\r\n\t\t\t\t{[ if (canEdit || (canEditOwn && parseInt(post.get(\'post_author\'), 10) === Upfront.data.currentUser.id)) { ]}\r\n\t\t\t\t<a href="/edit/page/{{ post.get("ID") }}" class="editaction edit">\r\n\t\t\t\t\t{{Upfront.Settings.l10n.global.content.edit}}\r\n\t\t\t\t</a>{[ } ]}<a href="{{ post.get("permalink") }}" class="editaction view">\r\n\t\t\t\t\t{{Upfront.Settings.l10n.global.content.view}}\r\n\t\t\t\t</a>{[ if (canEdit || (canEditOwn && parseInt(post.get(\'post_author\'), 10) === Upfront.data.currentUser.id)) { ]}<a href="#" class="editaction trash">\r\n\t\t\t\t\t{{Upfront.Settings.l10n.global.content.trash}}\r\n\t\t\t\t</a>\r\n\t\t\t\t{[ } ]}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{[ }); } ]}\r\n\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\r\n\r\n\t<script type="text/template" id="upfront-page-preview-tpl">\r\n\t\t<div id="upfront-page_preview-wrapper" class="upfront-scroll-panel">\r\n\t\t\t<div id="upfront-page_preview-featured_image" class="upfront-page_preview-item">\r\n\t\t\t\t<h4>{{Upfront.Settings.l10n.global.content.featured_image}}: </h4>\r\n\t\t\t\t<div class="upfront-thumbnailinfo" style="{{page.thumbnail ? \'display:none\' : \'\'}}">Loading...</div>\r\n\t\t\t\t<img src="{{page.thumbnail }}" style="{{page.thumbnail ? \'\' : \'display:none\'}}" />\r\n\t\t\t\t<div class="upfront-page_preview-edit_feature"><a href="#">{{Upfront.Settings.l10n.global.content.edit}} <i class="icon-pencil"></i></a></div>\r\n\t\t\t</div>\r\n\t\t\t<div id="upfront-page_preview-template" class="upfront-page_preview-item">\r\n\t\t\t\t<h4>{{Upfront.Settings.l10n.global.content.template}}: </h4>\r\n\t\t\t\t<select id="upfront-page_template-select">\r\n\t\t\t\t\t<option value="0">{{Upfront.Settings.l10n.global.content.default_opt}}</option>\r\n\t\t\t\t\t{[ _.each(allTemplates, function(tpl, name){ var selected = tpl == template ? \'selected="selected"\' : ""; ]}\r\n\t\t\t\t\t<option value="{{tpl}}" {{selected}}>{{name}}</option>\r\n\t\t\t\t\t{[ }) ]}\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t\t<div id="upfront-page_preview-edit">\r\n\t\t\t\t<button type="button"><i class="icon-pencil"></i> {{Upfront.Settings.l10n.global.content.edit_page}}</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template"  id="upfront-comments-tpl">\r\n\t\t<div id="upfront-list" class="upfront-list-comments clearfix bordered-bottom">\r\n\t\t\t{[ if(!comments.length){ ]}\r\n\t\t\t<p class="upfront-no-results">{{Upfront.Settings.l10n.global.content.no_comments}}</p>\r\n\t\t\t{[ } else { ]}\r\n\t\t\t<div id="upfront-list-meta" class="upfront-list_item">\r\n\t\t\t\t<div class="upfront-list_item-component upfront-comment_author upfront-header {{ orderby == \'comment_author\' ? \'active ordered-\' + order : \'\' }}" data-sortby="comment_author">{{Upfront.Settings.l10n.global.content.author}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-date upfront-header {{ orderby == \'comment_date\' ? \'active ordered-\' + order : \'\' }}" data-sortby="comment_date">{{Upfront.Settings.l10n.global.content.date}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t\t<div class="upfront-list_item-component upfront-comment_content upfront-header {{ orderby == \'comment_content\' ? \'active ordered-\' + order : \'\' }}" data-sortby="comment_content">{{Upfront.Settings.l10n.global.content.comment}} <i class="icon-caret-down">&#9660;</i><i class="icon-caret-up">&#9650;</i></div>\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-list-items upfront-list-comment-items upfront-scroll-panel">\r\n\r\n\t\t\t\t{[ _.each(comments, function(comment){ ]}\r\n\t\t\t\t<div class="upfront-list_item-comment upfront-list_item clearfix" id="upfront-list_item-comment-{{ comment.get("comment_ID") }}" data-comment_id="{{ comment.get("comment_ID") }}">\r\n\t\t\t\t{{ commentTpl({comment:comment, excerptLength: excerptLength}) }}\r\n\t\t\t</div>\r\n\t\t\t{[ }) ]}\r\n\t\t</div>\r\n\t\t{[ } ]}\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template"  id="upfront-comment-single-tpl">\r\n\t\t{[ var excerpt = jQuery(\'<div></div>\').html(comment.get(\'comment_content\')).text(); ]}\r\n\t\t<div class="upfront-comment-approved">\r\n\t\t\t{[ if(comment.get("comment_approved") === \'0\'){ ]}\r\n\t\t\t<i class="upfront-comments-approve icon-circle-blank" data-comment_id="{{ comment.get("comment_ID") }}"></i>\r\n\t\t\t{[ } ]}\r\n\t\t</div>\r\n\t\t<div class="upfront-list_item-component upfront-comment_author">\r\n\t\t\t<img src="{{ Upfront.Util.get_avatar(comment) }}" title="{{comment.get("comment_author")}}" class="avatar" /> {{comment.get("comment_author")}}</div>\r\n\t\t<div class="upfront-list_item-component upfront-date">{{ Upfront.Util.format_date(comment.get("comment_date")) }}</div>\r\n\t\t<div class="upfront-list_item-component upfront-comment_content upfront-comment_excerpt upfront-list_item-main upfront-post_content">{{ excerpt.length > excerptLength ? excerpt.substring(0, excerptLength) + \' [...]\' : excerpt }}</div>\r\n\t\t<div class="upfront-list_item-component upfront-comment_content upfront-comment_content-full-wrapper upfront-list_item-main upfront-post_content  upfront-scroll-panel">\r\n\t\t\t<div class="upfront-comment_content-full upfront-comment_togglable">{{ comment.get("comment_content") }}</div>\r\n\t\t\t<div class="upfront-comment_edit upfront-comment_togglable" data-comment_id="{{ comment.get(\'comment_ID\') }}">\r\n\t\t\t\t<textarea class="comment-edit-box" class="edit" rows="16">{{ comment.get("comment_content") }}</textarea>\r\n\t\t\t\t<button type="button" class="comment-edit-ok">{{Upfront.Settings.l10n.global.content.ok}}</button>\r\n\t\t\t\t<button type="button" class="comment-edit-cancel">{{Upfront.Settings.l10n.global.content.cancel}}</button>\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-comment_reply upfront-comment_togglable" data-comment_id="{{ comment.get(\'comment_ID\') }}">\r\n\t\t\t\t<textarea class="comment-edit-box" class="edit" rows="16" placeholder="Reply here..."></textarea>\r\n\t\t\t\t<button type="button" class="comment-reply-ok">{{Upfront.Settings.l10n.global.content.ok}}</button>\r\n\t\t\t\t<button type="button" class="comment-reply-cancel">{{Upfront.Settings.l10n.global.content.cancel}}</button>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="upfront-comment_actions-wrapper">\r\n\t\t\t{[ if(comment.get("comment_approved") !== \'trash\'){ ]}\r\n\t\t\t<a href="#reply" class="reply"><i class="icon-reply"></i> {{Upfront.Settings.l10n.global.content.reply}}</a>\r\n\t\t\t{[ } ]}\r\n\t\t\t<a href="#edit" class="edit"><i class="icon-pencil"></i> {{Upfront.Settings.l10n.global.content.edit}}</a>\r\n\t\t\t{[ if(comment.get("comment_approved") === \'0\'){ ]}\r\n\t\t\t<a href="#approve" class="approve"><i class="icon-ok"></i> {{Upfront.Settings.l10n.global.content.approve}}</a>\r\n\t\t\t{[ } else if(comment.get("comment_approved") === \'1\'){ ]}\r\n\t\t\t<a href="#unapprove" class="unapprove"><i class="icon-circle-blank"></i> {{Upfront.Settings.l10n.global.content.unapprove}}</a>\r\n\t\t\t{[ } if(comment.get("comment_approved") === \'spam\'){ ]}\r\n\t\t\t<a href="#unspam" class="unspam"><i class="icon-comment-alt"></i> {{Upfront.Settings.l10n.global.content.unspam}}</a>\r\n\t\t\t{[ } else if(comment.get("comment_approved") !== \'trash\') { ]}\r\n\t\t\t<a href="#spam" class="spam"><i class="icon-ban-circle"></i> {{Upfront.Settings.l10n.global.content.spam}}</a>\r\n\t\t\t{[ } if(comment.get("comment_approved") === \'trash\'){ ]}\r\n\t\t\t<a href="#unthrash" class="unthrash"><i class="icon-comment"></i> {{Upfront.Settings.l10n.global.content.untrash}}</a>\r\n\t\t\t{[ } else { ]}\r\n\t\t\t<a href="#thrash" class="thrash"><i class="icon-remove"></i> {{Upfront.Settings.l10n.global.content.trash}}</a>\r\n\t\t\t{[ } ]}\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="upfront-slug-tpl">\r\n\t\t<div class="upfront-slug_editor">\r\n\t\t\t<div class="upfront-slug_editor-title">{{Upfront.Settings.l10n.global.content.edit_post_url}}</div>\r\n\t\t\t<p class="upfront-slug_editor-info">{{Upfront.Settings.l10n.global.content.post_url_info}}</p>\r\n\t\t\t<p class="upfront-slug_editor-url">\r\n\t\t\t\t{{ rootURL }}\r\n\t\t\t\t<input type="text" id="upfront-post_slug" value\t="{{ slug }}" />\r\n\t\t\t\t<button id="upfront-post_slug-send" value="{{Upfront.Settings.l10n.global.content.ok}}"><i class="icon-ok"></i> {{Upfront.Settings.l10n.global.content.ok}}</button>\r\n\t\t\t</p>\r\n\t\t</div>\r\n\t</script>\r\n\t<script type="text/template" id="upfront-pagination-tpl">\r\n\t\t<div id="upfront-entity_list-pagination">\r\n\t\t\t<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-prev"></a>\r\n\r\n\r\n\t\t\t<div class="upfront-pagination_navigation">\r\n\t\t\t\t<input type="text" class="upfront-pagination_page-current" value="{{currentPage+1}}" /> of <a class="upfront-pagination_page-item" data-idx="{{pages}}">{{pages}}</a>\r\n\t\t\t</div>\r\n\r\n\t\t\t<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-next"></a>\r\n\r\n\t\t\t<small>{{totalElements}} items</small>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="upfront-pagination-tpl-old">\r\n\t\t<div id="upfront-entity_list-pagination" data-total="{{ pages }}" data-page_size="{{pageSize}}">\r\n\t\t\t{[ if(pages > 1) { ]}\r\n\t\t\t<div class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-prev">\r\n\r\n\t\t\t</div>\r\n\r\n\t\t\t{[ _.each(_.range(pages), function(i){ ]}\r\n\t\t\t<div class="upfront-pagination_item upfront-pagination_page-item {{ i == currentPage ? \'current\' : \'\' }}" data-page_idx="{{ i }}">{{ i + 1}}</div>\r\n\t\t\t{[ }) ]}\r\n\r\n\t\t\t<div class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-next">\r\n\r\n\t\t\t</div>\r\n\t\t\t{[ } ]}\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="upfront-tabs-tpl">\r\n\t\t<ul class="upfront-tabs">\r\n\t\t\t{[ _.each(tabs, function(tab){ ]}\r\n\t\t\t<li data-type="{{tab.id}}" class="{{ tab.id == active ? \'active\' : \'\' }}">{{tab.text}}</li>\r\n\t\t\t{[ }); ]}\r\n\t\t</ul>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="upfront-search-tpl">\r\n\t\t<div class="search_container clearfix">\r\n\t\t\t<div id="upfront-search_action" class="search upfront-icon upfront-icon-popup-search"></div>\r\n\t\t\t<div id="upfront-search_container" style="display:{{ query ? \'block\' : \'none\' }}">\r\n\t\t\t\t<input type="text" id="upfront-list-search_input" value="{{ query ? query : \'\' }}" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="upfront-notifier-tpl">\r\n\t\t<div id="upfront-notifier">\r\n\t\t\t<div id="upfront-notice"></div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="selector-post_type-tpl">\r\n\t\t{[if(postTypes.length > 1){ ]}\r\n\t\t<div id="upfront-selector-post_type">\r\n\t\t\t{{Upfront.Settings.l10n.global.views.select_post_type}}\r\n\t\t\t<div class="upfront-field-select">\r\n\t\t\t\t<div class="upfront-field-select-value">{{postTypes[0].label}}</div>\r\n\t\t\t\t<ul class="upfront-field-select-options">\r\n\t\t\t\t\t{[ _.each(postTypes, function(type){ ]}\r\n\t\t\t\t\t<li class="upfront-field-select-option upfront-selector-option" rel="{{ type.name }}">\r\n\t\t\t\t\t\t{{ type.label }}\r\n\t\t\t\t\t</li>\r\n\t\t\t\t\t{[ }); ]}\r\n\t\t\t\t</ul>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t{[ } ]}\r\n\t\t<div id="upfront-selector-posts" class="upfront-scroll-panel">\r\n\r\n\t\t</div>\r\n\t</script>\r\n\t<script type="text/template" id="selector-post-tpl">\r\n\t\t<table id="upfront-list" class="upfront-list-items">\r\n\t\t\t{[ _.each(posts, function(post){ ]}\r\n\t\t\t<tr class="upfront-selector-post upfront-list_item" rel="{{post.id}}">\r\n\t\t\t\t<td class="upfront-selector-post-checked upfront-list_item-component"></td>\r\n\t\t\t\t<td class="upfront-selector-post-title upfront-list_item-component upfront-list_item-main">{{post.get(\'post_title\')}}</td>\r\n\t\t\t\t<td class="upfront-selector-post-date upfront-list_item-component">{{ Upfront.Util.format_date(post.get(\'post_date\'), false) }}</td>\r\n\t\t\t</tr>\r\n\t\t\t{[ }) ]}\r\n\t\t</table>\r\n\t</script>\r\n\r\n\r\n\t<script type="text/template" id="datepicker-tpl">\r\n\t\t<div class="upfront-date_picker upfront-ui">\r\n\t\t\t<div class="upfront-bar-datepicker">\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-time_picker">\r\n\t\t\t\tTime:\r\n\t\t\t\t<select class="ueditor-hours-select">\r\n\t\t\t\t\t{[ _.each(hours, function(h){ ]}\r\n\t\t\t\t\t<option value="{{h}}" {{h == currentHour ? \'selected=\\\'selected\\\'\' : \'\'}} >{{h}}</option>\r\n\t\t\t\t\t{[ }); ]}\r\n\t\t\t\t</select>:\r\n\t\t\t\t<select class="ueditor-minutes-select">\r\n\t\t\t\t\t{[ _.each(minutes, function(m){ ]}\r\n\t\t\t\t\t<option value="{{m}}" {{m == currentMinute ? \'selected=\\\'selected\\\'\' : \'\'}} >{{m}}</option>\r\n\t\t\t\t\t{[ }); ]}\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t\t<div class="ueditor-datepicker-buttons">\r\n\t\t\t\t<a class="ueditor-action-pickercancel">Cancel</a>\r\n\t\t\t\t<a class="ueditor-action-pickerok button small-button">Ok</a>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script type="text/template" id="microselect-tpl">\r\n\t\t<div class="ueditor-select-options">\r\n\t\t\t{[ _.each(options, function(option){ ]}\r\n\t\t\t<a class="ueditor-select-option ueditor-action-status" data-id="{{option.value}}">{{option.name}}</a>\r\n\t\t\t{[ }); ]}\r\n\t\t</div>\r\n\t\t<input type="text" class="ueditor-select-focus">\r\n\t</script>\r\n\r\n\t<script id="csseditor-tpl" type="text/template">\r\n\t\t<div class="upfront-css-resizable">\r\n\t\t\t<div class="upfront-css-top">\r\n\t\t\t\t{[ if (elementType) { ]}\r\n\t\t\t\t<span class="upfront-css-type">{{ elementType }} Element</span>\r\n\t\t\t\t{[ } ]}\r\n\t\t\t\t{[ if (showToolbar) { ]}\r\n\t\t\t\t<div id="insert-font-widget" class="upfront-icon">\r\n\t\t\t\t\t<a class="upfront-css-font" href="#">{{Upfront.Settings.l10n.global.content.insert_font}}</a>\r\n\t\t\t\t</div>\r\n\t\t\t\t<a class="upfront-css-theme_image upfront-css-image" href="#">{{Upfront.Settings.l10n.global.content.insert_theme_image}}</a>\r\n\t\t\t\t<a class="upfront-css-media_image upfront-css-image" href="#">{{Upfront.Settings.l10n.global.content.insert_image}}</a>\r\n\t\t\t\t<span class="upfront-css-color"></span>\r\n\t\t\t\t{[ } ]}\r\n\t\t\t\t<a class="upfront-css-close" href="#">close</a>\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-css-body">\r\n\t\t\t\t<div class="upfront-css-ace"></div>\r\n\t\t\t\t<div class="upfront-css-sidebar">\r\n\t\t\t\t\t{[ if (selectors) { ]}\r\n\t\t\t\t\t<div class="upfront-css-selectors upfront-scroll-panel">\r\n\t\t\t\t\t\t<p>{{Upfront.Settings.l10n.global.content.available_element_selectors}}</p>\r\n\t\t\t\t\t\t{[ _.each(selectors, function(data, s){ ]}\r\n\t\t\t\t\t\t<span class="upfront-css-selector" title="{{ data.info }}" data-selector="{{ s }}">{{data.label}}</span>\r\n\t\t\t\t\t\t{[ }); ]}\r\n\t\t\t\t\t\t{[ if (elementType) { ]}\r\n\t\t\t\t\t\t{{ _.size(selectors) ? \'\' : \'No selectors available for the \' + elementType.toLowerCase() + \' element.\'}}\r\n\t\t\t\t\t\t{[ } ]}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{[ } ]}\r\n\t\t\t\t\t<div class="upfront-css-save-form">\r\n\t\t\t\t\t\t{[ if (show_style_name) { ]}\r\n\t\t\t\t\t\t<p>{{Upfront.Settings.l10n.global.views.style_name}}</p>\r\n\t\t\t\t\t\t<input type="text" class="upfront-css-save-name-field" value="{{ name }}">\r\n\t\t\t\t\t\t{[ } ]}\r\n\t\t\t\t\t\t<button class="upfront-css-save-ok">{{Upfront.Settings.l10n.global.content.save}}</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script id="icon-fonts-manager-tpl" type="text/template">\r\n\t\t<div class="manage-icon-fonts">\r\n\t\t\t<div class="fonts-manager-panel-title">\r\n\t\t\t\t{{Upfront.Settings.l10n.global.content.choose_icon_fonts}}\r\n\t\t\t</div>\r\n\t\t\t<div class="icon-fonts-list">\r\n\t\t\t\t{[ _.each(fonts, function(font) { ]}\r\n\t\t\t\t\t{[ if (0 === _.keys(font.get("files") || {}).length) return true; ]}\r\n\t\t\t\t<div data-family="{{ font.get(\'family\') }}" class="icon-fonts-list-item {[ if (font.get(\'active\')) { ]}icon-fonts-list-item-active{[ } ]}">\r\n\t\t\t\t\t<div class="font-name">\r\n\t\t\t\t\t\t<span class="icon-font-family">{{ font.get(\'name\') }}</span>\r\n\t\t\t\t\t\t{[ if ("default" !== font.get("type") && font.getUploadStatus() !== true) { ]}\r\n\t\t\t\t\t\t<span class="icon-font-upload-status" title="{{ font.getUploadStatusMessage() }}">*</span>\r\n\t\t\t\t\t\t{[ } ]}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<a href="#expand" class="expand-toggle">\r\n\t\t\t\t\t\t<span class="fileset-count">{{ _.keys(font.get("files") || {}).length || 0 }} files</span>\r\n\t\t\t\t\t\t<i>&hellip;</i>\r\n\t\t\t\t\t</a>\r\n\t\t\t\t\t<div class="font-fileset">\r\n\t\t\t\t\t{[ _.each((font.get("files") || []), function (fname, fidx) { ]}\r\n\t\t\t\t\t\t<div class="font-filename" data-name="{{fname}}" data-idx="{{fidx}}">\r\n\t\t\t\t\t\t\t{{fname}}\r\n\t\t\t\t\t\t{[ if ("theme-defined" === font.get("type")) { ]}\r\n\t\t\t\t\t\t\t<a href="#remove">&times;</a>\r\n\t\t\t\t\t\t{[ } ]}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t{[ });]}\r\n\t\t\t\t\t</div> <!-- font fileset -->\r\n\t\t\t\t</div> <!-- font family -->\r\n\t\t\t\t{[ }); ]}\r\n\t\t\t</div>\r\n\t\t{[ if(Upfront.themeExporter && location.pathname.match(/\\/create_new\\/theme/) === null) { ]}\r\n\t\t\t<div class="icon-fonts-message"><i></i>{{Upfront.Settings.l10n.global.views.icon_font_type_recommendation}}</div>\r\n\t\t\t<div class="upload-icon-font">{{Upfront.Settings.l10n.global.views.upload_icon_font}}</div>\r\n\t\t\t<form style="display: none" id="upfront-upload-icon-font" name="upfront-upload-icon-font" enctype="multipart/form-data" method="post" action="{{url}}" data-url="{{url}}?action=upfront-upload-icon-font">\r\n\t\t\t\t<input type="file" accept=".eot,.woff,.woff2,.ttf,.svg" name="media" id="upfront-icon-font-input">\r\n\t\t\t\t<input type="hidden" name="action" value="upfront-upload-icon-font">\r\n\t\t\t\t<input type="submit" value="Upload">\r\n\t\t\t</form>\r\n\t\t{[ } ]}\r\n\t\t</div>\r\n\t\t<div class="preview-icon-fonts">\r\n\t\t\t<div class="fonts-manager-panel-title">\r\n\t\t\t\t{{Upfront.Settings.l10n.global.content.icon_font_icons_preview}}\r\n\t\t\t</div>\r\n\t\t\t<div class="icon-font-icons-preview">\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="1">1</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="2">2</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="3">3</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="4">4</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="5">5</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="6">6</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="7">7</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="8">8</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="9">9</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="0">0</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="!">!</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="@">@</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="#">#</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="$">$</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="%">%</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="^">^</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="&">&</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="*">*</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="(">(</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title=")">)</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="-">-</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="_">_</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="=">=</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="+">+</div>\r\n\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="A">A</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="a">a</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="B">B</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="b">b</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="C">C</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="c">c</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="D">D</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="d">d</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="E">E</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="e">e</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="F">F</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="f">f</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="G">G</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="g">g</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="H">H</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="h">h</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="I">I</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="i">i</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="J">J</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="j">j</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="K">K</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="k">k</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="L">L</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="l">l</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="M">M</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="m">m</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="N">N</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="n">n</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="O">O</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="o">o</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="P">P</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="p">p</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="Q">Q</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="q">q</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="R">R</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="r">r</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="S">S</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="s">s</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="T">T</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="t">t</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="U">U</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="u">u</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="V">V</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="v">v</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="W">W</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="w">w</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="X">X</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="x">x</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="Y">Y</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="y">y</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="Z">Z</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="z">z</div>\r\n\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="[">[</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="{">{</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="]">]</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="}">}</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title=";">;</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title=":">:</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="\'">\'</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="&quot;">"</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title=",">,</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="<"><</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title=".">.</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title=">">></div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="/">/</div>\r\n\t\t\t\t<div class="icon-font-icon-preview uf_font_icon" title="?">?</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script id="text-fonts-manager-tpl" type="text/template">\r\n\t\t<div class="add-font-panel panel">\r\n\t\t\t<div class="loading-fonts">{{Upfront.Settings.l10n.global.content.loading_fonts}}</div>\r\n\t\t\t<div class="font-weights-list">\r\n\t\t\t\t<div class="font-weights-list-wrapper">\r\n\t\t\t\t\t<div class="fonts-manager-panel-title">\r\n\t\t\t\t\t\t{{Upfront.Settings.l10n.global.content.choose_typeface}}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{[ if (show_no_styles_notice) { ]}\r\n\t\t\t\t\t<div class="fonts-weights-notice-text">\r\n\t\t\t\t\t\t{{Upfront.Settings.l10n.global.content.typeface_info_text}}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{[ } ]}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<span class="add-font-button">Add &raquo;</span>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script id="theme-fonts-panel" type="text/template">\r\n\t\t<h3 class="panel-title">{{Upfront.Settings.l10n.global.content.theme_font_styles}}</h3>\r\n\t\t<div class="font-list">\r\n\t\t\t{[ if (show_no_styles_notice) { ]}\r\n\t\t\t<div class="fonts-manager-panel-title">{{Upfront.Settings.l10n.global.content.no_fonts_added}}</div>\r\n\t\t\t{[ } ]}\r\n\t\t</div>\r\n\t\t<div class="font-stats">\r\n\t\t</div>\r\n\t</script>\r\n\r\n\t<script id="theme-font-list-item" type="text/template">\r\n\t\t{{ family }} ({{ variant }})<span class="delete upfront-icon"></span>\r\n\t</script>\r\n\r\n\t<script id="save-dialog-tpl" type="text/template">\r\n\t\t<div id="upfront-save-dialog">\r\n\t\t\t<p>{{ question }}</p>\r\n\t\t\t<span class="upfront-save-button" data-save-as="this-post">{{ thisPostButton }}</span>\r\n\t\t\t<span class="upfront-save-button" data-save-as="all-posts">{{ allPostsButton }}</span>\r\n\t\t</div>\r\n\t</script>\r\n\r\n\r\n\t<!-- end of the wrap div -->\r\n</div>\r\n';
}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/fonts",["text!upfront/templates/popup.html","scripts/upfront/upfront-views-editor/fields"],function(i,n){var o=Backbone.View.extend({initialize:function(t){this.options=t||{}},className:function(){var t="font-variant-preview";return this.model.get("already_added")&&(t+=" font-variant-already-added"),t},template:_.template('<span class="font-family">{{family}}  {{name}}</span>{[ if(already_added) { ]} <span class="already-added">'+e.already_added+'</span>{[ } ]}{[ if(heading_preview) { ]}<h1 style="font-family: {{family}}; font-weight: {{weight}}; font-style: {{style}};" class="heading-font-preview font-preview">'+e.header_preview_quote+'</h1>{[ } else { ]}<p style="font-family: {{family}}; font-weight: {{weight}}; font-style: {{style}};" class="paragraph-font-preview font-preview">'+e.body_preview_quote+"</p>{[ } ]}"),events:{click:"on_click"},render:function(){return this.$el.html(this.template(_.extend({heading_preview:this.options.heading_preview},this.model.toJSON()))),this},on_click:function(){this.model.get("already_added")||(this.model.set({selected:!this.model.get("selected")}),this.$el.toggleClass("font-variant-selected"))}}),r=Backbone.Model.extend({},{parse_variant:function(t){var e;return"inherit"===t?{weight:"inherit",style:"inherit"}:!_.isUndefined(t)&&t.match(/^(\d+) *(normal|italic|oblique)$/)?(e=t.match(/^(\d+) *(normal|italic|oblique)/),{weight:e[1],style:e[2]}):"italic"===t?{weight:"400",style:"italic"}:!_.isUndefined(t)&&t.match(/^\d+$/)?{weight:t,style:"normal"}:{weight:"400",style:"normal"}},get_variant:function(t,e){return"inherit"===t||"inherit"===e?"inherit":(t=this.normalize_weight(t),""===e&&(e="normal"),"400"===t&&"normal"===e?"regular":"400"===t&&"italic"===e?"italic":t+" "+e)},normalize_variant:function(t){var e=this.parse_variant(t);return this.get_variant(e.weight,e.style)},normalize_weight:function(t){return"normal"==t||""===t?400:"lighter"==t?100:"bold"==t?700:"bolder"==t?900:t},get_default_variant:function(t){return"inherit"}}),s=Backbone.Collection.extend({model:r}),a=function(){var t=!1;this.get_fonts=function(){if(t)return t;var e=Upfront.Util.post({action:"upfront_list_google_fonts"});return e=e.then(function(e){return t=new s(e.data)})}},l=new a,p=function(){var t=[{family:"Andale Mono",category:"monospace"},{family:"Arial",category:"sans-serif"},{family:"Arial Black",category:"sans-serif"},{family:"Courier New",category:"monospace"},{family:"Georgia",category:"serif"},{family:"Impact",category:"sans-serif"},{family:"Times New Roman",category:"serif"},{family:"Trebuchet MS",category:"sans-serif"},{family:"Verdana",category:"sans-serif"}],e=new s,i=function(){var i;i=["Inherit","400","400 italic","700","700 italic"],_.each(t,function(t){t.variants=i,e.add(t)})};this.get_fonts=function(){return e},i()},d=new p,c=Backbone.Model.extend({initialize:function(t){this.set({displayVariant:r.normalize_variant(t.variant)},{silent:!0})}}),u=Backbone.Collection.extend({model:c,get_fonts_for_select:function(){var t=[{label:e.choose_font,value:""}],i=[];return _.each(h.models,function(t){i.push(t.get("font").family)}),_.each(_.uniq(i),function(e){t.push({label:e,value:e})}),_.each(Upfront.mainData.additionalFonts,function(e){t.push({label:e.family,value:e.family})}),_.each(d.get_fonts().models,function(e){t.push({label:e.get("family"),value:e.get("family")})}),t},get_variants:function(t){var e;return _.each(d.get_fonts().models,function(i){t===i.get("family")&&(e=i.get("variants"))}),e?e:(_.each(Upfront.mainData.additionalFonts,function(i){t===i.family&&(e=["inherit"].concat(i.variants))}),e?e:(e=[],_.each(h.models,function(i){t===i.get("font").family&&e.push(i.get("displayVariant"))}),e.unshift("inherit"),e))},get_variants_for_select:function(t){var e=[];return _.each(d.get_fonts().models,function(i){t===i.get("family")&&_.each(i.get("variants"),function(t){e.push({label:t,value:t})})}),_.each(Upfront.mainData.additionalFonts,function(i){t===i.family&&_.each(i.variants,function(t){e.push({label:t,value:t})})}),_.each(h.models,function(i){if(t===i.get("font").family){var n=i.get("displayVariant");e.push({label:n,value:n})}}),e},get_additional_font:function(t){var e=_.findWhere(Upfront.mainData.additionalFonts,{family:t});if(e)return new Backbone.Model(e)}}),h=new u(Upfront.mainData.themeFonts),f=Backbone.Model.extend({getFullCollectionSet:function(){return["eot","woff","ttf","svg"]},getUploadStatus:function(){var t=this.getFullCollectionSet()||[],e=this.get("files")||{};return _.keys(e).length>=t.length},getUploadStatusMessage:function(){var t=e.icon_fonts_collection_incomplete||"",i=this.get("files")||{},n=[];return t?(_.each(this.getFullCollectionSet(),function(t){return t in i||void n.push(t)}),n.length?t.replace(/%s/,n.join(", ")):""):""}}),g=Backbone.Collection.extend({model:f}),m=new g(Upfront.mainData.iconFonts),v=function(t){var i=function(){var t=_.debounce(n,100);h.on("add remove",t)},n=function(){var t={action:"upfront_update_theme_fonts",theme_fonts:h.toJSON()};Upfront.Util.post(t).error(function(){return notifier.addMessage(e.theme_fonts_save_fail)})};i()},b=(new v,Backbone.View.extend({className:"theme-font-list-item",events:{click:"on_click","click .delete":"on_delete"},template:t(i).find("#theme-font-list-item").html(),render:function(){return this.$el.html(_.template(this.template,{family:this.model.get("font").family,variant:this.model.get("displayVariant")})),this},on_click:function(){this.$el.siblings().removeClass("theme-font-list-item-selected"),this.$el.addClass("theme-font-list-item-selected"),this.trigger("selected",this.model.toJSON())},on_delete:function(){h.remove(this.model),this.remove()}})),y=Backbone.View.extend({className:"theme-fonts-panel panel",template:_.template(t(i).find("#theme-fonts-panel").html()),initialize:function(t){this.options=t||{},this.listenTo(this.collection,"add remove",this.update_stats),this.listenTo(this.collection,"add remove",this.render)},render:function(){return this.$el.html(""),this.$el.html(this.template({show_no_styles_notice:0===this.collection.length})),this.collection.length>0&&this.$el.find(".font-list").css("background","white"),_.each(this.collection.models,function(t){this.add_one(t)},this),this.update_stats(),this},update_stats:function(){var t=e.font_styles_selected.replace(/%d/,this.collection.length);this.$el.find(".font-stats").html("<strong>"+t+"</strong>")},add_one:function(t){var e=new b({model:t});this.options.parent_view.listenTo(e,"selected",this.options.parent_view.replaceFont),this.$el.find(".font-list").append(e.render().el)}}),w=Backbone.View.extend({id:"font-variants-preview",initialize:function(t){this.options=t||{}},addOne:function(t){var e=new o({model:t,heading_preview:this.options.heading_preview});this.$el.append(e.render().el)},render:function(){return _.each(this.collection.models,function(t){this.addOne(t)},this),this},get_selected:function(){var t=[];return _.each(this.collection.models,function(e){e.get("selected")&&t.push(e.get("variant"))}),t}}),k=Backbone.View.extend({id:"icon-fonts-manager",className:"clearfix",template:_.template(t(i).find("#icon-fonts-manager-tpl").html()),events:{"click .upload-icon-font":"triggerFileChooser","click .icon-font-upload-status":"triggerFileChooser","click .icon-fonts-list-item":"makeFontActive","click .icon-fonts-list-item a.expand-toggle":"expandListItems","click .font-filename a":"removeFontFile"},triggerFileChooser:function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),this.$el.find("#upfront-icon-font-input").click(),!1},render:function(){return this.$el.html(this.template({url:Upfront.mainData.ajax,show_no_fonts_notice:!1,fonts:this.collection.models})),_.isUndefined(this.collection.findWhere({active:!0}))&&this.$el.find('[data-family="icomoon"]').addClass("icon-fonts-list-item-active"),this.fileUploadInitialized||(this.fileUploadInitialized=!0,this.initializeFileUpload()),this},expandListItems:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var i=t(e.target),n=i.closest(".icon-fonts-list-item");return n.length&&n.toggleClass("expanded"),!1},removeFontFile:function(e){e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation();var i=this,n=t(e.target),o=n.closest(".font-filename"),r=o.attr("data-name"),s=o.attr("data-idx");return!(!r||!s)&&(Upfront.Util.post({action:"upfront_remove_icon_font_file",name:r,idx:s}).error(function(t){var e=((t||{}).responseJSON||{}).error||"Oops, something went wrong";!_.isString(e)&&(e||{}).message&&(e=e.message),Upfront.Views.Editor.notify(e,"error")}).done(function(){i.collection.each(function(t){var e=t.get("files");e&&e[s]&&r===e[s]&&(delete e[s],t.set("files",e))}),i.fileUploadInitialized=!1,i.render()}),!1)},initializeFileUpload:function(){if(!jQuery.fn.fileupload)return!1;var e=this;this.$el.find("#upfront-upload-icon-font").fileupload({dataType:"json",add:function(e,i){if(e.isDefaultPrevented())return!1;var n=!0;return i.files&&i.files.length&&_.each(i.files,function(t){n&&(n=!!(t||{}).name.match(/\.(eot|woff|woff2|ttf|svg)$/))}),!!n&&void((i.autoUpload||i.autoUpload!==!1&&t(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()}))},done:function(t,i){var n,o=i.result.data.font;1===_.keys(o.files).length?(e.$el.find(".icon-fonts-list").append('<div data-family="'+o.family+'" class="icon-fonts-list-item">'+o.name+"</div>"),e.collection.add(o)):(n=e.collection.findWhere({family:o.family}),n.set({files:o.files}),n.get("active")===!0&&e.updateActiveFontStyle(o.family)),e.fileUploadInitialized=!1,e.render()},fail:function(t,e){var i=(((e||{}).jqXHR||{}).responseJSON||{}).error||"Oops, something went wrong";!_.isString(i)&&(i||{}).message&&(i=i.message),Upfront.Views.Editor.notify(i,"error")}})},makeFontActive:function(e){var i=t(e.currentTarget);i.siblings().removeClass("icon-fonts-list-item-active"),i.addClass("icon-fonts-list-item-active");var n={action:"upfront_update_active_icon_font",family:i.data("family")};Upfront.Util.post(n).error(function(){return notifier.addMessage("Could not update active icon font")}),t("#active-icon-font").remove(),_.each(this.collection.models,function(t){t.set({active:!1})}),"icomoon"!==i.data("family")&&(this.collection.findWhere({family:i.data("family")}).set({active:!0}),this.updateActiveFontStyle(i.data("family")))},updateActiveFontStyle:function(e){var i=this.collection.findWhere({family:e}),n="";_.each(i.get("files"),function(t,e){switch(n+="url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+t+"') format('",e){case"eot":n+="embedded-opentype";break;case"woff":n+="woff";break;case"woff2":n+="woff2";break;case"ttf":n+="truetype";break;case"svg":n+="svg"}n+="'),"});var o="@font-face {\tfont-family: '"+i.get("family")+"';";i.get("files").eot&&(o+="src: url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+i.get("files").eot+"');"),o+="\tsrc:"+n.substring(0,n.length-1)+";",o+="\tfont-weight: normal;\tfont-style: normal;}.uf_font_icon, .uf_font_icon * {\tfont-family: '"+i.get("family")+"'!important;}",t("body").append('<style id="active-icon-font">'+o+"</style>")}}),$=Backbone.View.extend({id:"text-fonts-manager",className:"clearfix",template:_.template(t(i).find("#text-fonts-manager-tpl").html()),events:{"click .add-font-button":"add_font","click .preview-size-p":"on_p_click","click .preview-size-h1":"on_h1_click"},initialize:function(){this.theme_fonts_panel=new y({collection:this.collection,parent_view:this}),this.listenTo(this.collection,"remove",this.update_variants_on_remove)},render:function(){var e=this;return this.$el.html(this.template({show_no_styles_notice:0===this.collection.length})),t.when(l.get_fonts()).done(function(t){e.load_google_fonts(t)}),this.$el.find(".add-font-panel").after(this.theme_fonts_panel.render().el),Upfront.mainData.userDoneFontsIntro||this.$el.addClass("no-styles"),this.$el.find(".choose-font").after('<div class="preview-type"><span class="preview-type-title">'+Upfront.Settings.l10n.global.behaviors.preview_size+'</span><span class="preview-size-p selected-preview-size">P</span><span class="preview-size-h1">H1</span></div>'),this},on_p_click:function(){this.$el.find(".preview-size-h1").removeClass("selected-preview-size"),this.$el.find(".preview-size-p").addClass("selected-preview-size"),this.heading_preview=!1,this.update_variants()},on_h1_click:function(){this.$el.find(".preview-size-h1").addClass("selected-preview-size"),this.$el.find(".preview-size-p").removeClass("selected-preview-size"),this.heading_preview=!0,this.update_variants()},add_font:function(){var t,i=l.get_fonts().findWhere({family:this.font_family_select.get_value()});return _.isEmpty(i)?void alert(e.choose_font_weight):(t=this.choose_variants.get_selected(),_.isEmpty(t)?void alert(e.choose_one_font_weight):(_.each(t,function(t){h.add({id:i.get("family")+t,font:i.toJSON(),variant:t})}),void this.update_variants()))},load_google_fonts:function(i){var o=this.$el.find(".add-font-panel"),r=[{label:e.click_to_pick_google_font,value:""}];_.each(i.pluck("family"),function(t){r.push({label:t,value:t})}),o.find(".loading-fonts").remove(),this.font_family_select=new n.Chosen_Select({label:e.typeface,values:r,placeholder:e.choose_font,additional_classes:"choose-font"}),this.font_family_select.render(),o.find(".font-weights-list").before(this.font_family_select.el),t(".upfront-chosen-select",this.$el).chosen({width:"289px"}),this.listenTo(this.font_family_select,"changed",this.update_variants)},update_variants_on_remove:function(){this.update_variants()},update_variants:function(e){if(this.$el.find(".font-weights-list").css("background","white"),e||(e=l.get_fonts().findWhere({family:this.font_family_select.get_value()})),e){var i=new Backbone.Collection;_.each(e.get("variants"),function(n){0===t("#"+e.get("family").toLowerCase()+n+"-css").length&&t("head").append('<link rel="stylesheet" id="'+e.get("family").toLowerCase()+"-"+n+'-css" href="//fonts.googleapis.com/css?family='+e.get("family")+"%3A"+n+'" type="text/css" media="all">');var o=r.parse_variant(n);i.add({family:e.get("family"),name:r.normalize_variant(n),variant:n,already_added:!!h.get(e.get("family")+n),weight:o.weight,style:o.style})}),this.choose_variants&&this.choose_variants.remove(),this.choose_variants=new w({collection:i,heading_preview:this.heading_preview}),this.choose_variants.render(),this.$el.find(".font-weights-list-wrapper").html(this.choose_variants.el)}},set_ok_button:function(t){t.on("click",this.on_ok_click)},on_ok_click:function(t){Upfront.Events.trigger("upfront:render_typography_sidebar"),Upfront.mainData.userDoneFontsIntro||(Upfront.Util.post({action:"upfront_user_done_font_intro"}),Upfront.mainData.userDoneFontsIntro=!0)}}),x=Backbone.View.extend({initialize:function(){var t=this;this.fields=[new n.Typeface_Chosen_Select({label:"",compact:!0,values:h.get_fonts_for_select(),additional_classes:"choose-typeface",select_width:"230px"}),new n.Typeface_Style_Chosen_Select({label:"",compact:!0,values:[],additional_classes:"choose-variant",select_width:"120px"}),new n.Button({label:e.insert_font,compact:!0,on_click:function(){t.preview_font()}})],this.is_responsive=Upfront.Application.get_current()===Upfront.Settings.Application.MODE.RESPONSIVE},render:function(){return t("#insert-font-widget").html("").addClass("open"),this.$el.html(""),_.each(this.fields,function(t){t.render(),this.$el.append(t.el)},this),this.listenTo(this.fields[0],"changed",function(){var t=h.get_variants(this.fields[0].get_value());this.render_variants(t)}),t(".choose-typeface select",this.$el).chosen({width:"230px",disable_search:!0}),t(".choose-variant select",this.$el).chosen({width:"120px",disable_search:!0}),this},render_variants:function(t){var i=this.$el.find(".choose-variant select");i.find("option").remove(),i.append('<option value="">'+e.choose_variant+"</option>"),_.each(t,function(t){i.append('<option value="'+t+'">'+t+"</option>")}),i.trigger("chosen:updated")},preview_font:function(){var t=this.fields[0].get_value();return t?void this.replaceFont({font_family:t,variant:r.parse_variant(this.fields[1].get_value())}):void this.finish()},replaceFont:function(t){var e;this.editor=this.is_responsive?Upfront.Application.generalCssEditor.editor:Upfront.Application.cssEditor.editor,this.style_doc=this.editor.getSession().getDocument(),this.last_selected_font=t,this.font_family_range?this.font_family_range.end=this.end_point:this.font_family_range=this.editor.getSelection().getRange(),this.end_point=this.style_doc.replace(this.font_family_range,t.font_family),this.reset_properties(),e=[],t.variant.weight&&e.push("    font-weight: "+t.variant.weight+";"),t.variant.style&&e.push("    font-style: "+t.variant.style+";"),e.length>0&&this.style_doc.insertLines(this.font_family_range.start.row+1,e),this.finish()},reset_properties:function(){var t,e,i;for(this.editor=this.is_responsive?Upfront.Application.generalCssEditor.editor:Upfront.Application.cssEditor.editor,this.style_doc=this.editor.getSession().getDocument(),i={},t=this.font_family_range.start.row+1,e=this.style_doc.getLine(t);e.indexOf("}")<0&&(e.indexOf("font-weight")!==-1&&(i.weight=t,this.starting_weight||(this.starting_weight=e)),e.indexOf("font-style")!==-1&&(i.style=t,this.starting_style||(this.starting_style=e)),t++,e=this.style_doc.getLine(t)););i.weight&&i.style&&(i.weight>i.style?(this.style_doc.removeLines(i.weight,i.weight),this.style_doc.removeLines(i.style,i.style)):(this.style_doc.removeLines(i.style,i.style),this.style_doc.removeLines(i.weight,i.weight)),i.weight=!1,i.style=!1),i.weight&&this.style_doc.removeLines(i.weight,i.weight),i.style&&this.style_doc.removeLines(i.style,i.style)},finish:function(){t("#insert-font-widget").html('<a class="upfront-css-font" href="#">'+e.insert_font+"</a>").removeClass("open")}});return{System:d,Google:l,Text_Fonts_Manager:$,Icon_Fonts_Manager:k,theme_fonts_collection:h,icon_fonts_collection:m,Insert_Font_Widget:x,Model:r}})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/modal",[],function(){return Backbone.View.extend({attributes:function(){return{class:"upfront-inline-modal upfront-ui upfront-no-select",id:"upfront-inline-modal-"+this.cid}},initialize:function(t){this.options=t,this.$to=t.to,this.button_text=t.button_text?t.button_text:Upfront.Settings.l10n.global.content.ok,this.button="undefined"==typeof t.button||t.button,this.width="undefined"!=typeof t.width?t.width:"50%",this.top="undefined"!=typeof t.top?t.top:-1,this.left="undefined"!=typeof t.left?t.left:-1,this.right="undefined"!=typeof t.right?t.right:-1,this.keep_position="undefined"==typeof t.keep_position||t.keep_position},events:{click:"on_click","click .upfront-inline-modal-content":"on_click_content","click .upfront-inline-modal-save":"on_click_save"},render:function(){this.$el.html('<div class="upfront-inline-modal-wrap"><div class="upfront-inline-modal-content"></div></div>'),this.$el.hide()},open:function(e,i,n){var o,r,s=this.$el.find(".upfront-inline-modal-wrap"),a=this.$el.find(".upfront-inline-modal-content"),l=t('<button type="button" class="upfront-inline-modal-save">'+this.button_text+"</button>"),p={},d=i&&i.for_view&&i.for_view.$el.hasClass("upfront-region-side-lightbox");return this._deferred=t.Deferred(),this.$el.show(),e.apply(i,[a,this.$el]),n="undefined"!=typeof n?n:this.button,n&&l.appendTo(a),p.width=this.width,!d&&this.top>=0?(p.top=this.top,p.bottom="auto"):(r=this.$el.height()>t(window).height()?t(window).height():this.$el.height(),o=a.outerHeight(),this.top=r-o>0?(r-o)/2:0,d&&(this.top=22),p.top=this.top,p.bottom="auto"),this.left>=0?(p.left=this.left,p.right="auto"):this.right>=0&&(p.left="auto",p.width>0&&this.right+p.width<=t(window).width()&&(p.right=this.right)),s.css(p),this.keep_position&&(this.update_pos(),t(window).on("scroll",this,this.on_scroll)),this.trigger("modal:open"),this._deferred.promise()},close:function(e){this.$el.hide(),t(window).off("scroll",this.on_scroll),this.trigger("modal:close"),this._deferred&&(e?this._deferred.resolve(this):this._deferred.reject(this))},on_scroll:function(t){var e=t.data;e.update_pos()},on_click:function(){this.close(!1)},on_click_content:function(t){t.stopPropagation()},on_click_save:function(){this.close(!0)},update_pos:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);if("none"!=this.$el.css("display")){var i=this.$el.find(".upfront-inline-modal-wrap"),n=this.$to.offset(),o=n.top,r=o+this.$to.outerHeight(),s=t(window).height(),a=t(document).scrollTop(),l=a+s,p=e.offset().top,d=50,c=this.$el.offset(),u=c.left+this.$el.width(),h=this.$el.find(".upfront-inline-modal-wrap").outerHeight(),f=o+h;a>=o-p?"fixed"!=this.$el.css("position")&&(this.$el.css({position:"fixed",top:0,bottom:0,left:c.left,right:t(window).width()-u}),i.css({top:p+this.top})):(r>f?r:f)+d>l?"fixed"!=this.$el.css("position")&&(this.$el.css({position:"fixed",top:0,bottom:0,left:c.left,right:t(window).width()-u}),i.css({top:(r>f?s-(r-o>s?s:r-o)-d:s-h-d)+this.top})):(this.$el.css({position:"",top:"",bottom:"",left:"",right:""}),i.css({top:this.top}))}}})})}(jQuery),define("text!upfront/templates/bg_setting.html",[],function(){return'<div>\n\t<!--\n\t\tWrap everything in a div to convert this file\'s content in a jquery element\n\t\tso it is possible to use $.find.\n\t-->\n\t<script type="text/template" id="upfront-bg-setting">\n\n\t\t<div class="upfront-bg-setting-theme-body">\n\t\t\t<div class="upfront-bg-setting-heading">{{Upfront.Settings.l10n.global.views.global_bg_settings}}</div>\n\n\t\t</div>\n\n\t\t<div class="upfront-bg-setting-type">\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.bg_type}}</div>\n\t\t</div>\n\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-color"></div>\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-image"></div>\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-featured"></div>\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-slider"></div>\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-map"></div>\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-video"></div>\n\n\t</script>\n\n\t<script type="text/template" id="upfront-bg-setting-tab">\n\t\t<div class="upfront-bg-setting-tab-primary"></div>\n\t\t<div class="upfront-bg-setting-tab-secondary"></div>\n\t</script>\n\n\t<script type="text/template" id="upfront-bg-setting-tab-color">\n\t\t<div class="upfront-bg-setting-tab-primary">\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.pick_color}}</div>\n\t\t</div>\n\t\t<div class="upfront-bg-setting-tab-secondary"></div>\n\t</script>\n\n\t<script type="text/template" id="upfront-bg-setting-tab-image">\n\t\t<div class="upfront-bg-setting-tab-primary">\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.image_variation}}</div>\n\t\t</div>\n\t\t<div class="upfront-bg-setting-tab-secondary"></div>\n\t</script>\n\n\t<script type="text/template" id="upfront-bg-setting-tab-featured">\n\t\t<div class="upfront-bg-setting-tab-primary">\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.image_variation}}</div>\n\t\t</div>\n\t\t<div class="upfront-bg-setting-tab-secondary"></div>\n\t</script>\n\n\t<script type="text/template" id="upfront-bg-setting-tab-slider">\n\t\t<div class="upfront-bg-setting-tab-primary">\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.slider_transition}}</div>\n\t\t</div>\n\t\t<div class="upfront-bg-setting-tab-secondary"></div>\n\t</script>\n\n\n\t<script type="text/template" id="upfront-bg-setting-tab-video">\n\t\t<div class="upfront-bg-setting-tab-primary">\n\t\t\t<div class="upfront-bg-setting-label">&nbsp;</div>\n\t\t</div>\n\t\t<div class="upfront-bg-setting-tab-secondary"></div>\n\t</script>\n\n\n</div>\n'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/modal-bg-setting",["scripts/upfront/upfront-views-editor/modal","scripts/upfront/upfront-views-editor/fields","text!upfront/templates/bg_setting.html"],function(i,n,o){return i.extend({open:function(){return this._backup={},this._prompt=!1,i.prototype.open.call(this,this.render_modal,this,!0)},close:function(t){return this._prompt&&this.prompt_responsive_change("background_type"),i.prototype.close.call(this,t)},render_modal:function(i,r){var s=Upfront.Settings.LayoutEditor.Grid,a=t(o),l=_.template(a.find("#upfront-bg-setting").html()),p=l(),d=new n.Number({model:this.model,property:"contained_region_width",label:e.contained_region_width,label_style:"inline",default_value:s.size*s.column_width,min:s.size*s.column_width,max:5120,step:1,suffix:e.px,change:function(){var t=this.get_value();t=t<this.options.min?this.options.min:t,this.property.set({value:t}),Upfront.Events.trigger("upfront:layout:contained_region_width",t)}});i.find(".upfront-bg-setting-tab-primary, .upfront-bg-setting-tab-secondary").children().detach(),i.html(p),r.addClass("upfront-modal-bg"),d.render(),i.find(".upfront-bg-setting-theme-body").append(d.$el),this.render_bg_type_settings(i)},render_bg_type_settings:function(t){var e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();e.default||this.$el.addClass("upfront-region-settings-responsive");var i=this,o=e&&!e.default,r=this.model.get_breakpoint_property_value("background_image",!0),s=e&&!e.default?"":r?"image":"color",a=this.model.get_breakpoint_property_value("background_type"),l=new n.Select({model:this.model,name:"background_type",default_value:a?a:s,icon_class:"upfront-region-field-icon",values:this.get_bg_types(),change:function(){var n=this.get_value();if(""===n&&o)i.reset_breakpoint_background(e,!1),t.find(".upfront-bg-setting-tab").hide();else{o&&i.revert_breakpoint_background(e,["background_type"],!0),i.model.set_breakpoint_property("background_type",n),t.find(".upfront-bg-setting-tab").not(".upfront-bg-setting-tab-"+n).hide(),t.find(".upfront-bg-setting-tab-"+n).show(),i.render_modal_tab(n,t.find(".upfront-bg-setting-tab-"+n),t);var r=t.find(".upfront-region-type-icon")[0];r&&(r=r.classList[1],t.find(".upfront-region-type-icon").addClass("upfront-region-type-icon-"+n).removeClass(r))}o||(i._prompt=a!==n),"image"===n||"featured"===n?(this.$el.addClass("upfront-bg-setting-type-image"),this.$el.find(".upfront-field-select").css({"min-width":"140px"})):this.$el.removeClass("upfront-bg-setting-type-image"),Upfront.Events.trigger("region:background:type:changed")}});l.render(),t.find(".upfront-bg-setting-type").append(l.$el),l.trigger("changed")},get_bg_types:function(){return[{label:e.solid_color,value:"color",icon:"color"},{label:e.image,value:"image",icon:"image"},{label:e.video,value:"video",icon:"video"}]},is_responsive_changed:function(t){var e=this,i=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=!1;return!!n.default&&(_.each(i,function(i){if(!o){var i=i.toJSON(),n=e.model.get_breakpoint_property_value(t,!1,!1,i);i.default||!1!==n&&(o=!0)}}),o)},prompt_responsive_change:function(i){if(this.is_responsive_changed(i)){var n=this,o=this.model instanceof Upfront.Models.Region,r=o?this.model.get("title"):e.global_bg,s=new Upfront.Views.Editor.Modal({to:t("body"),button:!1,top:120,width:450});s.render(),t("body").append(s.el),s.open(function(t,i){var o=new Upfront.Views.Editor.Field.Button({name:"confirm",label:e.bg_changed_confirm,compact:!0,classname:"upfront-bg-setting-prompt-button",on_click:function(){n.reset_responsive_background(),s.close()}}),a=new Upfront.Views.Editor.Field.Button({name:"cancel",label:e.bg_changed_cancel,compact:!0,classname:"upfront-bg-setting-prompt-button",on_click:function(){s.close()}});i.addClass("upfront-bg-setting-prompt-modal"),t.html("<p>"+e.bg_changed_prompt.replace("%s",r)+"</p>"),_.each([o,a],function(e){e.render(),e.delegateEvents(),t.append(e.$el)})},this).always(function(){s.remove()})}},reset_responsive_background:function(){var t=this,e=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(e,function(e){var i=e.toJSON();t.reset_breakpoint_background(i,!0)})},reset_breakpoint_background:function(t,e){if(!t.default){var i=this,n=["background_type","background_color","background_image","background_image_ratio","background_style","background_default","background_repeat","background_position","background_slider_transition","background_slider_rotate","background_slider_rotate_time","background_slider_control","background_slider_images","background_video_mute","background_video_autoplay","background_video_style","background_video","background_video_embed","background_video_width","background_video_height","background_map_center","background_map_zoom","background_map_style","background_map_controls","background_show_markers","background_use_custom_map_code","background_map_location"],o=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(o[t.id])||(o[t.id]={}),_.each(n,function(e){_.isUndefined(o[t.id][e])||(_.isObject(i._backup[t.id])||(i._backup[t.id]={}),i._backup[t.id][e]=o[t.id][e],delete o[t.id][e])}),this.model.set_property("breakpoint",o,!0===e)}},revert_breakpoint_background:function(t,e,i){var n=Upfront.Util.clone(this.model.get_property_value_by_name("breakpoint")||{});_.isObject(this._backup)&&_.isObject(this._backup[t.id])&&(e=_.isArray(e)?e:[],_.isObject(n[t.id])||(n[t.id]={}),_.each(this._backup[t.id],function(i,o){_.contains(e,o)||(n[t.id][o]=i)}),delete this._backup[t.id],this.model.set_property("breakpoint",n,!0===i))},render_modal_tab:function(t,e,i){switch(t){case"color":this.render_modal_tab_color(e);break;case"image":this.render_modal_tab_image(e,t);break;case"featured":this.render_modal_tab_image(e,t);break;case"slider":this.render_modal_tab_slider(e);break;case"map":this.render_modal_tab_map(e);break;case"video":this.render_modal_tab_video(e)}},_render_tab_template:function(e,i,n,r){var s=t(o),a=!1,l=!1;l=r?_.template(s.find("#upfront-bg-setting-tab-"+r).html()):_.template(s.find("#upfront-bg-setting-tab").html()),l&&(a=t("<div>"+l()+"</div>")),a.find(".upfront-bg-setting-tab-primary").append(i),n&&a.find(".upfront-bg-setting-tab-secondary").append(n),e.html(""),e.append(a)},render_modal_tab_color:function(t){this._color_item||(this._color_item=new Upfront.Views.Editor.BgSettings.ColorItem({model:this.model}),this._color_item.render()),this._color_item.trigger("show"),this._render_tab_template(t,this._color_item.$el,"")},render_modal_tab_image:function(t,e){this._image_item||(this._image_item=new Upfront.Views.Editor.BgSettings.ImageItem({model:this.model}),this._image_item.render(),this.$_image_primary=this._image_item.$el.find(".uf-bgsettings-image-style, .uf-bgsettings-image-pick")),this._image_item.trigger("show"),this._render_tab_template(t,this.$_image_primary,this._image_item.$el)},render_modal_tab_slider:function(e){this._slider_item||(this.$_slides=t('<div class="upfront-bg-slider-slides"></div>'),this._slider_item=new Upfront.Views.Editor.BgSettings.SliderItem({model:this.model,slides_item_el:this.$_slides}),this._slider_item.render(),this.$_slider_primary=this._slider_item.$el.find(".uf-bgsettings-slider-transition")),this._slider_item.trigger("show"),this._render_tab_template(e,this.$_slider_primary,[this._slider_item.$el,this.$_slides])},render_modal_tab_map:function(t){this._map_item||(this._map_item=new Upfront.Views.Editor.BgSettings.MapItem({model:this.model}),this._map_item.render()),this._map_item.trigger("show"),this._render_tab_template(t,"",this._map_item.$el)},render_modal_tab_video:function(t){this._video_item||(this._video_item=new Upfront.Views.Editor.BgSettings.VideoItem({
model:this.model}),this._video_item.render()),this._video_item.trigger("show"),this._render_tab_template(t,"",this._video_item.$el)}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-item",[],function(){return Backbone.View.extend({group:!0,get_name:function(){return 1==this.fields.length?this.fields[0].get_name():this.fields.length>1?this.fields.map(function(t){return t.get_name()}):void 0},get_value:function(){return 1==this.fields.length?this.fields[0].get_value():this.fields.length>1?this.fields.map(function(t){return t.get_value()}):void 0},get_title:function(){return this.options.title?this.options.title:""},initialize:function(t){var e=this;e.options=t,this.fields=t.fields?_(t.fields):_([]),this.group="undefined"!=typeof t.group?t.group:this.group,this.on("panel:set",function(){e.fields.each(function(t){t.panel=e.panel,t.trigger("panel:set")})})},render:function(){this.group?this.$el.append('<div class="upfront-settings-item"><div class="upfront-settings-item-title"><span>'+this.get_title()+'</span></div><div class="upfront-settings-item-content"></div></div>'):this.$el.append('<div class="upfront-settings-item-content"></div>');var t=this.$el.find(".upfront-settings-item-content");this.fields.each(function(e){e.render(),e.delegateEvents(),t.append(e.$el)}),this.trigger("rendered")},save_fields:function(){var t=_([]);this.fields.each(function(e,i,n){if(e.property){var o=e.get_value()||[],r=e.get_saved_value();e.multiple||o==r?e.multiple&&(r&&o.length!=r.length||0!==_.difference(o,r).length)&&t.push(e):t.push(e)}}),t.each(function(t,e,i){t.use_breakpoint_property?t.model.set_breakpoint_property(t.property_name,t.get_value(),!0):t.property.set({value:t.get_value()},{silent:!0})}),t.size()>0&&(this.panel.is_changed=!0)},wrap:function(t){if(!t)return!1;var e=t.title||"",i=t.markup||t;this.$el.append('<div id="usetting-'+this.get_name()+'" class="upfront-settings-item"><div class="upfront-settings-item-title"><span>'+e+'</span></div><div class="upfront-settings-item-content">'+i+"</div></div>")},remove:function(){this.fields&&this.fields.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-panel",["scripts/upfront/upfront-views-editor/mixins","scripts/upfront/upfront-views-editor/settings/settings-item","scripts/upfront/upfront-views-editor/fields"],function(i,n,o){var r=n.extend({className:"upfront-settings-css",events:{"click .upfront-css-edit":"openEditor"},initialize:function(t){if(n.prototype.initialize.call(this,t),!Upfront.Application.cssEditor)return!1;var i=Upfront.Application.cssEditor.getElementType(this.model),o=[{label:e.default_str,value:"_default"}];Upfront.data.styles[i.id]&&_.each(Upfront.data.styles[i.id],function(t){t.indexOf("_default")>-1||o.push({label:t,value:t})}),this.fields=_([new Upfront.Views.Editor.Field.Button({model:this.model,className:"edit-preset-css-label",compact:!0,label:e.edit_css_label}),new Upfront.Views.Editor.Field.Button({model:this.model,className:"upfront-css-edit",compact:!0,name:"preset_css",label:e.edit_css})])},openEditor:function(t){t.preventDefault(),Upfront.Events.trigger("entity:settings:beforedeactivate"),Upfront.Application.cssEditor.init({model:this.model,stylename:"_default"}),Upfront.Events.trigger("entity:settings:deactivate")}}),s=n.extend({className:"upfront-settings-padding",initialize:function(i){var r=Upfront.Settings.LayoutEditor.Grid.column_padding,s=this.model instanceof Upfront.Models.ModuleGroup,a=new o.Checkboxes({model:this.model,use_breakpoint_property:!0,property:"top_padding_use",label:"",multiple:!1,values:[{label:e.top_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("top_padding_use")||!1,change:function(){var t=this.get_value();this.model.set_breakpoint_property("top_padding_use",t?t:0)},show:function(e,i){"yes"===e?(t(l.$el).css("display","inline-block"),t(p.$el).css("display","inline-block")):(t(l.$el).hide(),t(p.$el).hide())}}),l=new o.Slider({model:this.model,use_breakpoint_property:!0,property:"top_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var t=this.get_value();this.model.set_breakpoint_property("top_padding_slider",t),p.get_field().val(t),this.model.set_breakpoint_property("top_padding_num",t,!0)}}),p=new o.Number({model:this.model,use_breakpoint_property:!0,property:"top_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_num")||r,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("top_padding_num",t),this.model.set_breakpoint_property("top_padding_slider",t,!0),l.$el.find("#"+l.get_field_id()).slider("value",t)}}),d=new o.Checkboxes({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_use",label:"",multiple:!1,values:[{label:e.bottom_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("bottom_padding_use")||!1,change:function(){var t=this.get_value();this.model.set_breakpoint_property("bottom_padding_use",t?t:0)},show:function(e,i){"yes"===e?(t(c.$el).css("display","inline-block"),t(u.$el).css("display","inline-block")):(t(c.$el).hide(),t(u.$el).hide())}}),c=new o.Slider({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("bottom_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var t=this.get_value();this.model.set_breakpoint_property("bottom_padding_slider",t),u.get_field().val(t),this.model.set_breakpoint_property("bottom_padding_num",t,!0)}}),u=new o.Number({model:this.model,use_breakpoint_property:!0,property:"bottom_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bottom_padding_num")||r,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("bottom_padding_num",t),this.model.set_breakpoint_property("bottom_padding_slider",t,!0),c.$el.find("#"+c.get_field_id()).slider("value",t)}});if(!s)var h=new o.Checkboxes({model:this.model,use_breakpoint_property:!0,property:"left_padding_use",label:"",multiple:!1,values:[{label:e.left_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("left_padding_use")||!1,change:function(){var t=this.get_value();this.model.set_breakpoint_property("left_padding_use",t?t:0)},show:function(e,i){"yes"===e?(t(f.$el).css("display","inline-block"),t(g.$el).css("display","inline-block")):(t(f.$el).hide(),t(g.$el).hide())}}),f=new o.Slider({model:this.model,use_breakpoint_property:!0,property:"left_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("left_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var t=this.get_value();this.model.set_breakpoint_property("left_padding_slider",t),g.get_field().val(t),this.model.set_breakpoint_property("left_padding_num",t,!0)}}),g=new o.Number({model:this.model,use_breakpoint_property:!0,property:"left_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("left_padding_num")||r,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("left_padding_num",t),this.model.set_breakpoint_property("left_padding_slider",t,!0),f.$el.find("#"+f.get_field_id()).slider("value",t)}}),m=new o.Checkboxes({model:this.model,use_breakpoint_property:!0,property:"right_padding_use",label:"",multiple:!1,values:[{label:e.right_padding,value:"yes"}],default_value:this.model.get_breakpoint_property_value("right_padding_use")||!1,change:function(){var t=this.get_value();this.model.set_breakpoint_property("right_padding_use",t?t:0)},show:function(e,i){"yes"===e?(t(v.$el).css("display","inline-block"),t(b.$el).css("display","inline-block")):(t(v.$el).hide(),t(b.$el).hide())}}),v=new o.Slider({model:this.model,use_breakpoint_property:!0,property:"right_padding_slider",label:"",default_value:this.model.get_breakpoint_property_value("right_padding_slider")||r,min:0,max:200,step:5,valueTextFilter:function(){return""},change:function(){var t=this.get_value();this.model.set_breakpoint_property("right_padding_slider",t),b.get_field().val(t),this.model.set_breakpoint_property("right_padding_num",t,!0)}}),b=new o.Number({model:this.model,use_breakpoint_property:!0,property:"right_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("right_padding_num")||r,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("right_padding_num",t),this.model.set_breakpoint_property("right_padding_slider",t,!0),v.$el.find("#"+v.get_field_id()).slider("value",t)}});n.prototype.initialize.call(this,i),s?this.fields=_([a,l,p,d,c,u]):this.fields=_([a,l,p,d,c,u,h,f,g,m,v,b])}}),a=n.extend({className:"upfront-settings-item-anchor",initialize:function(t){this.options=t,n.prototype.initialize.call(this,this.options);var i=new o.Field_Complex_Toggleable_Text_Field({element_label:e.make_element_anchor,className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple checkbox-title",model:this.model,property:"anchor"});i.on("anchor:updated",function(){this.trigger("anchor:item:updated")},this),this.fields=_([i])},save_fields:function(){this.fields.invoke("check_value"),n.prototype.save_fields.call(this)}}),l=Backbone.View.extend(_.extend({},i.Upfront_Scroll_Mixin,{className:"upfront-settings_panel_wrap",hide_common_anchors:!1,hide_common_fields:!1,events:{"click .upfront-save_settings":"on_save","click .upfront-cancel_settings":"on_cancel","click .upfront-settings_label":"on_toggle","click .upfront-settings-common_panel .upfront-settings-item-title":"on_toggle_common","click .upfront-settings-padding_panel .upfront-settings-item-title":"on_toggle_padding"},get_title:function(){return this.options.title?this.options.title:""},get_label:function(){return this.options.label?this.options.label:""},initialize:function(t){var e=this;this.hide_common_fields=!_.isUndefined(t.hide_common_fields)&&t.hide_common_fields,this.hide_common_anchors=!_.isUndefined(t.hide_common_anchors)&&t.hide_common_anchors,e.options=t,this.settings=t.settings?_(t.settings):_([]),this.settings.each(function(t){t.panel=e,t.trigger("panel:set")}),this.tabbed="undefined"!=typeof t.tabbed?t.tabbed:this.tabbed},tabbed:!1,is_changed:!1,render:function(){this.$el.html('<div class="upfront-settings_label" /><div class="upfront-settings_panel" ><div class="upfront-settings_panel_scroll" />');var t,i=this.$el.find(".upfront-settings_label"),n=this.$el.find(".upfront-settings_panel"),o=this.$el.find(".upfront-settings_panel_scroll"),r=this;if(i.append(this.get_label()),this.settings.each(function(t){t.panel||(t.panel=r),t.render(),o.append(t.el)}),this.options.min_height&&o.css("min-height",this.options.min_height),this.tabbed){var l=this.settings.first();l.radio||l.reveal(),o.append('<div class="upfront-settings-tab-height" />')}if(this.stop_scroll_propagation(o),this.hide_common_fields===!1&&(this.$el.find(".upfront-settings_panel_scroll").after('<div class="upfront-settings-common_panel"></div>'),t=this.$el.find(".upfront-settings-common_panel"),this.hide_common_anchors===!1)){var p=new a({model:this.model,title:e.anchor_settings});p.panel=r,p.render(),t.append(p.el)}this.$el.find(".upfront-settings_panel_scroll").after('<div class="upfront-settings-padding_panel"></div>'),$padding_panel=this.$el.find(".upfront-settings-padding_panel"),("undefined"==typeof this.paddingEditor||this.paddingEditor)&&(this.paddingEditor=new s({model:this.model,title:e.padding_settings}),this.paddingEditor.panel=r,this.paddingEditor.render(),$padding_panel.append(this.paddingEditor.el)),n.append("<div class='upfront-settings-button_panel'><button type='button' class='upfront-save_settings'><i class='icon-ok'></i> "+e.ok+"</button></div>"),this.$el.fadeIn("fast",function(){var t=r.$el.parent(),e=(t.offset()?t.offset().top:0)+t.height(),i=jQuery(window).height();e+60>i+jQuery("body").scrollTop()&&jQuery("body").animate({scrollTop:e-i+60},"slow")}),this.trigger("rendered")},on_toggle_common:function(){var t=this.$el.find(".upfront-settings-common_panel");t.toggleClass("open")},on_toggle_padding:function(){var t=this.$el.find(".upfront-settings-padding_panel");t.toggleClass("open")},conceal:function(){this.$el.find(".upfront-settings_panel").hide(),this.$el.find(".upfront-settings_label").removeClass("active"),this.trigger("concealed")},reveal:function(){if(this.$el.find(".upfront-settings_label").addClass("active"),this.$el.find(".upfront-settings_panel").show(),this.tabbed){var e=0;this.$el.find(".upfront-settings-item-tab-content").each(function(){var i=t(this).outerHeight(!0);e=i>e?i:e}),this.$el.find(".upfront-settings-tab-height").css("height",e)}this.trigger("revealed")},show:function(){this.$el.show()},hide:function(){this.$el.hide()},is_active:function(){return this.$el.find(".upfront-settings_panel").is(":visible")},on_toggle:function(){this.trigger("upfront:settings:panel:toggle",this),this.show()},start_loading:function(t,e){this.loading=new Upfront.Views.Editor.Loading({loading:t,done:e}),this.loading.render(),this.$el.find(".upfront-settings_panel").append(this.loading.$el)},end_loading:function(t){this.loading?this.loading.done(t):t()},on_save:function(){var t=!1;this.parent_view.panels.each(function(e){e.save_settings(),e.is_changed&&(t=!0,e.is_changed=!1)}),t&&this.parent_view.model.get("properties").trigger("change"),this.trigger("upfront:settings:panel:saved",this),Upfront.Events.trigger("entity:settings:deactivate")},save_settings:function(){if(!this.settings)return!1;var t=this;this.settings.each(function(e){if((e.fields||e.settings).size()>0)e.save_fields();else{var i=t.model.get_property_value_by_name(e.get_name());i!=e.get_value()&&t.model.set_property(e.get_name(),e.get_value())}}),Upfront.Events.trigger("entity:settings:saved")},on_cancel:function(){this.trigger("upfront:settings:panel:close",this)},remove:function(){this.settings&&this.settings.each(function(t){t.remove()}),this.$el.off(),Backbone.View.prototype.remove.call(this)}}));return{Settings_CSS:r,Panel:l,AnchorSetting:a}})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-item-tabbed",["scripts/upfront/upfront-views-editor/mixins"],function(e){return Backbone.View.extend(_.extend({},e.Upfront_Icon_Mixin,{className:"upfront-settings-item-tab-wrap",radio:!1,is_default:!1,events:{"click .upfront-settings-item-tab":"reveal"},initialize:function(t){this.options=t,this.settings=t.settings?_(t.settings):_([]),this.radio="undefined"!=typeof t.radio?t.radio:this.radio,this.is_default="undefined"!=typeof t.is_default?t.is_default:this.is_default},get_title:function(){return this.options.title?this.options.title:""},get_icon:function(){return this.options.icon?this.options.icon:""},get_property:function(){return this.options.property?this.options.property:""},get_value:function(){return this.options.value?this.options.value:""},get_property_model:function(){var t=this.get_property();return!!t&&this.model.get_property_by_name(t)},get_property_value:function(){var t=this.get_property_model();return t?t.get("value"):""},render:function(){var e=this;this.$el.html(""),this.$el.append('<div class="upfront-settings-item-tab" />'),this.$el.append('<div class="upfront-settings-item-tab-content" />');var i=this.$el.find(".upfront-settings-item-tab"),n=this.$el.find(".upfront-settings-item-tab-content");if(this.radio){var o=this.get_property_model();o||this.is_default&&this.model.init_property(this.get_property(),this.get_value());var r=this.cid+"-"+this.get_property(),s=t('<label for="'+r+'" />'),a=this.get_property_value()==this.get_value();s.append(this.get_icon_html(this.get_icon())),s.append('<span class="upfront-settings-item-tab-radio-text">'+this.get_title()+"</span>"),i.append(s),i.append('<input type="radio" id="'+r+'" class="upfront-field-radio" name="'+this.get_property()+'" value="'+this.get_value()+'" '+(a?'checked="checked"':"")+" />"),this.$el.addClass("upfront-settings-item-tab-radio")}else i.text(this.get_title());this.settings.each(function(t){t.panel=e.panel,t.render(),n.append(t.el)}),this.listenTo(this.panel,"rendered",this.panel_rendered),this.trigger("rendered")},conceal:function(){this.$el.removeClass("upfront-settings-item-tab-active")},reveal:function(){this.panel.settings.invoke("conceal"),this.$el.addClass("upfront-settings-item-tab-active"),this.radio&&this.$el.find(".upfront-settings-item-tab input").prop("checked",!0).trigger("change")},panel_rendered:function(){this.radio&&this.get_property_value()==this.get_value()&&this.reveal()},save_fields:function(){if(this.settings.invoke("save_fields"),this.radio&&this.$el.find(".upfront-settings-item-tab input:checked").size()>0){var t=this.get_property_model();t?t.set({value:this.get_value()},{silent:!0}):this.model.init_property(this.get_property(),this.get_value()),this.get_property_value()!=this.get_value()&&(this.panel.is_changed=!0)}},remove:function(){this.settings&&this.settings.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}}))})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-anchor-trigger",["scripts/upfront/upfront-views-editor/settings/settings-item","scripts/upfront/upfront-views-editor/fields"],function(t,e){return t.extend({initialize:function(i){this.options=i;var n=[],o=this.get_anchors();_(o).each(function(t){n.push({label:t,value:t})}),this.options.fields=_([new e.Select({model:this.model,property:"anchor_target",values:n})]),t.prototype.initialize.call(this,this.options)},get_anchors:function(){var t=Upfront.Application.layout.get("regions"),e=[""];return t.each(function(t){t.get("modules").each(function(t){t.get("objects").each(function(t){var i=t.get_property_value_by_name("anchor");i&&i.length&&e.push(i)})})}),e},get_values:function(){return this.fields._wrapped[0].get_value()}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-labeled-anchor-trigger",["scripts/upfront/upfront-views-editor/settings/settings-anchor-trigger","scripts/upfront/upfront-views-editor/fields"],function(t,i){return t.extend({initialize:function(n){this.options=n,t.prototype.initialize.call(this,this.options),this.options.fields.push(new i.Text({model:this.model,property:"anchor_label",label:e.label}))},get_values:function(){return{anchor:this.fields._wrapped[0].get_value(),label:this.fields._wrapped[1].get_value()}}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-lightbox-trigger",["scripts/upfront/upfront-views-editor/settings/settings-item","scripts/upfront/upfront-views-editor/fields"],function(t,e){return t.extend({initialize:function(i){this.options=i;var n=this.get_lightboxes();this.options.fields=_([new e.Select({model:this.model,property:"lightbox_target",values:n})]),t.prototype.initialize.call(this,this.options)},get_lightboxes:function(){var t=Upfront.Application.layout.get("regions"),e=[""];return _.each(t.models,function(t){"lightbox"==t.attributes.sub&&e.push({label:t.attributes.title,value:t.attributes.name})}),e},get_values:function(){return this.fields._wrapped[0].get_value()}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings/settings-labeled-lightbox-trigger",["scripts/upfront/upfront-views-editor/settings/settings-lightbox-trigger","scripts/upfront/upfront-views-editor/fields"],function(t,i){return t.extend({initialize:function(n){this.options=n,t.prototype.initialize.call(this,this.options),this.options.fields.push(new i.Text({model:this.model,property:"lightbox_label",label:e.label}))},get_values:function(){return{anchor:this.fields._wrapped[0].get_value(),label:this.fields._wrapped[1].get_value()}}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/settings",["scripts/upfront/upfront-views-editor/settings/settings-item","scripts/upfront/upfront-views-editor/settings/settings-panel","scripts/upfront/upfront-views-editor/settings/settings-item-tabbed","scripts/upfront/upfront-views-editor/settings/settings-anchor-trigger","scripts/upfront/upfront-views-editor/settings/settings-labeled-anchor-trigger","scripts/upfront/upfront-views-editor/settings/settings-lightbox-trigger","scripts/upfront/upfront-views-editor/settings/settings-labeled-lightbox-trigger"],function(i,n,o,r,s,a,l){var p=Backbone.View.extend({has_tabs:!0,initialize:function(t){this.options=t,this.panels=_([])},get_title:function(){return e.settings},render:function(){var e=this,i=e.for_view.$el.hasClass("upfront-editable_entity")?e.for_view.$el:e.for_view.$el.find(".upfront-editable_entity:first"),n=i.offset(),o=i.outerWidth(),r=n.left+o,s=(i.hasClass("upfront-object")?i.closest(".upfront-module"):i).find("> .upfront-element-controls .upfront-icon-region-settings"),a=s.offset(),l=(a.left+s.outerWidth(),t(Upfront.Settings.LayoutEditor.Selectors.main)),p=l.offset(),d=p.left+l.outerWidth();e.$el.empty().show().html('<div class="upfront-settings_title">'+this.get_title()+"</div>"),Upfront.Events.trigger("settings:prepare"),e.panels.each(function(t){t.render(),e.listenTo(t,"upfront:settings:panel:toggle",e.toggle_panel),e.listenTo(t,"upfront:settings:panel:close",e.close_panel),e.listenTo(t,"upfront:settings:panel:refresh",e.refresh_panel),t.parent_view=e,e.$el.append(t.el)}),this.toggle_panel(this.panels.first());var c=this.panels.first().$el.find(".upfront-settings_label").outerWidth(),u=this.panels.first().$el.find(".upfront-settings_panel").outerWidth();this.has_tabs||(c=0,this.$el.addClass("settings-no-tabs")),this.$el.css({position:"absolute","z-index":1e7}).offset({top:n.top,left:n.left+o-(r+c+u>d?c+u+(r-a.left)+5:0)}).addClass("upfront-ui"),this.trigger("open")},set_title:function(t){return!(!t||!t.length)&&void this.$el.find(".upfront-settings_title").html(t)},toggle_panel:function(t){this.panels.invoke("conceal"),t.$el.find(".upfront-settings_panel").css("height",""),t.show(),t.reveal(),this.set_title(t.get_title());var e=0;this.panels.each(function(t){e+=t.$el.find(".upfront-settings_label").outerHeight()});var i=t.$el.find(".upfront-settings_panel").outerHeight()-1;i>=e?this.$el.css("height",i):(t.$el.find(".upfront-settings_panel").css("height",e),this.$el.css("height",e))},refresh_panel:function(t){t.is_active()&&this.toggle_panel(t)},close_panel:function(t){this.panels.invoke("conceal"),this.panels.invoke("show"),this.set_title(this.get_title())},remove:function(){this.panels&&this.panels.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}});return{Settings:p,Panel:n.Panel,Item:i,ItemTabbed:o,Lightbox:{Trigger:a,LabeledTrigger:l},Anchor:{Trigger:r,LabeledTrigger:s},Settings_CSS:n.Settings_CSS,AnchorSetting:n.AnchorSetting}})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/notifier",["text!upfront/templates/popup.html"],function(i){var n=Backbone.View.extend({notices:new Backbone.Collection([]),elId:"upfront-notice",timer:!1,timeoutTime:5e3,$notice:!1,tpl:_.template(t(i).find("#upfront-notifier-tpl").html()),initialize:function(e){this.notices.on("add",this.messageAdded,this),this.notices.on("remove",this.messageRemoved,this),t("body").append(this.tpl({})),this.setElement(t("#"+this.elId))},addMessage:function(t,i,n){var o={message:t?t:e.no_message,type:i?i:"info",duration:n};this.notices.add(o)},show:function(t){var e=this;this.setMessage(t),this.$el.addClass("notify open").removeClass("out"),this.timer=setTimeout(function(){e.notices.remove(t)},t.get("duration")||this.timeoutTime)},replace:function(t){var e=this;this.setMessage(t),this.timer=setTimeout(function(){e.notices.remove(t)},this.timeoutTime),this.$el.removeClass("notify").addClass("shake"),setTimeout(function(){e.$el.removeClass("shake")},this.timeoutTime/2)},setMessage:function(t){this.$el.removeClass("info warning error").addClass(t.get("type")).html(t.get("message"))},close:function(){this.$el.addClass("out"),this.$el.removeClass("notify shake open")},messageAdded:function(t){this.$el.hasClass("notify")||this.show(t)},messageRemoved:function(t){this.notices.length?this.replace(this.notices.at(0)):this.close()}});return new n})}(jQuery),function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var d=i[s]={exports:{}};e[s][0].call(d.exports,function(t){var i=e[s][1][t];return o(i?i:t)},d,d.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";var n=t("../main");"function"==typeof define&&define.amd?define("scripts/perfect-scrollbar/perfect-scrollbar-library",n):(window.PerfectScrollbar=n,"undefined"==typeof window.Ps&&(window.Ps=n))},{"../main":7}],2:[function(t,e,i){"use strict";function n(t,e){var i=t.className.split(" ");i.indexOf(e)<0&&i.push(e),t.className=i.join(" ")}function o(t,e){var i=t.className.split(" "),n=i.indexOf(e);n>=0&&i.splice(n,1),t.className=i.join(" ")}i.add=function(t,e){t.classList?t.classList.add(e):n(t,e)},i.remove=function(t,e){t.classList?t.classList.remove(e):o(t,e)},i.list=function(t){return t.classList?Array.prototype.slice.apply(t.classList):t.className.split(" ")}},{}],3:[function(t,e,i){"use strict";function n(t,e){return window.getComputedStyle(t)[e]}function o(t,e,i){return"number"==typeof i&&(i=i.toString()+"px"),t.style[e]=i,t}function r(t,e){for(var i in e){var n=e[i];"number"==typeof n&&(n=n.toString()+"px"),t.style[i]=n}return t}var s={};s.e=function(t,e){var i=document.createElement(t);return i.className=e,i},s.appendTo=function(t,e){return e.appendChild(t),t},s.css=function(t,e,i){return"object"==typeof e?r(t,e):"undefined"==typeof i?n(t,e):o(t,e,i)},s.matches=function(t,e){return"undefined"!=typeof t.matches?t.matches(e):"undefined"!=typeof t.matchesSelector?t.matchesSelector(e):"undefined"!=typeof t.webkitMatchesSelector?t.webkitMatchesSelector(e):"undefined"!=typeof t.mozMatchesSelector?t.mozMatchesSelector(e):"undefined"!=typeof t.msMatchesSelector?t.msMatchesSelector(e):void 0},s.remove=function(t){"undefined"!=typeof t.remove?t.remove():t.parentNode&&t.parentNode.removeChild(t)},s.queryChildren=function(t,e){return Array.prototype.filter.call(t.childNodes,function(t){return s.matches(t,e)})},e.exports=s},{}],4:[function(t,e,i){"use strict";var n=function(t){this.element=t,this.events={}};n.prototype.bind=function(t,e){"undefined"==typeof this.events[t]&&(this.events[t]=[]),this.events[t].push(e),this.element.addEventListener(t,e,!1)},n.prototype.unbind=function(t,e){var i="undefined"!=typeof e;this.events[t]=this.events[t].filter(function(n){return!(!i||n===e)||(this.element.removeEventListener(t,n,!1),!1)},this)},n.prototype.unbindAll=function(){for(var t in this.events)this.unbind(t)};var o=function(){this.eventElements=[]};o.prototype.eventElement=function(t){var e=this.eventElements.filter(function(e){return e.element===t})[0];return"undefined"==typeof e&&(e=new n(t),this.eventElements.push(e)),e},o.prototype.bind=function(t,e,i){this.eventElement(t).bind(e,i)},o.prototype.unbind=function(t,e,i){this.eventElement(t).unbind(e,i)},o.prototype.unbindAll=function(){for(var t=0;t<this.eventElements.length;t++)this.eventElements[t].unbindAll()},o.prototype.once=function(t,e,i){var n=this.eventElement(t),o=function(t){n.unbind(e,o),i(t)};n.bind(e,o)},e.exports=o},{}],5:[function(t,e,i){"use strict";e.exports=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}()},{}],6:[function(t,e,i){"use strict";var n=t("./class"),o=t("./dom"),r=i.toInt=function(t){return parseInt(t,10)||0},s=i.clone=function(t){if(t){if(t.constructor===Array)return t.map(s);if("object"==typeof t){var e={};for(var i in t)e[i]=s(t[i]);return e}return t}return null};i.extend=function(t,e){var i=s(t);for(var n in e)i[n]=s(e[n]);return i},i.isEditable=function(t){return o.matches(t,"input,[contenteditable]")||o.matches(t,"select,[contenteditable]")||o.matches(t,"textarea,[contenteditable]")||o.matches(t,"button,[contenteditable]")},i.removePsClasses=function(t){for(var e=n.list(t),i=0;i<e.length;i++){var o=e[i];0===o.indexOf("ps-")&&n.remove(t,o)}},i.outerWidth=function(t){return r(o.css(t,"width"))+r(o.css(t,"paddingLeft"))+r(o.css(t,"paddingRight"))+r(o.css(t,"borderLeftWidth"))+r(o.css(t,"borderRightWidth"))},i.startScrolling=function(t,e){n.add(t,"ps-in-scrolling"),"undefined"!=typeof e?n.add(t,"ps-"+e):(n.add(t,"ps-x"),n.add(t,"ps-y"))},i.stopScrolling=function(t,e){n.remove(t,"ps-in-scrolling"),"undefined"!=typeof e?n.remove(t,"ps-"+e):(n.remove(t,"ps-x"),n.remove(t,"ps-y"))},i.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":2,"./dom":3}],7:[function(t,e,i){"use strict";var n=t("./plugin/destroy"),o=t("./plugin/initialize"),r=t("./plugin/update");e.exports={initialize:o,update:r,destroy:n}},{"./plugin/destroy":9,"./plugin/initialize":17,"./plugin/update":21}],8:[function(t,e,i){"use strict";e.exports={handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,wheelPropagation:!1,wheelSpeed:1,theme:"default"}},{}],9:[function(t,e,i){"use strict";var n=t("../lib/helper"),o=t("../lib/dom"),r=t("./instances");e.exports=function(t){var e=r.get(t);e&&(e.event.unbindAll(),o.remove(e.scrollbarX),o.remove(e.scrollbarY),o.remove(e.scrollbarXRail),o.remove(e.scrollbarYRail),n.removePsClasses(t),r.remove(t))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18}],10:[function(t,e,i){"use strict";function n(t,e){function i(t){return t.getBoundingClientRect()}var n=function(t){t.stopPropagation()};e.event.bind(e.scrollbarY,"click",n),e.event.bind(e.scrollbarYRail,"click",function(n){var o=n.pageY-window.pageYOffset-i(e.scrollbarYRail).top,a=o>e.scrollbarYTop?1:-1;s(t,"top",t.scrollTop+a*e.containerHeight),r(t),n.stopPropagation()}),e.event.bind(e.scrollbarX,"click",n),e.event.bind(e.scrollbarXRail,"click",function(n){var o=n.pageX-window.pageXOffset-i(e.scrollbarXRail).left,a=o>e.scrollbarXLeft?1:-1;s(t,"left",t.scrollLeft+a*e.containerWidth),r(t),n.stopPropagation()})}var o=t("../instances"),r=t("../update-geometry"),s=t("../update-scroll");e.exports=function(t){var e=o.get(t);n(t,e)}},{
"../instances":18,"../update-geometry":19,"../update-scroll":20}],11:[function(t,e,i){"use strict";function n(t,e){function i(i){var o=n+i*e.railXRatio,s=Math.max(0,e.scrollbarXRail.getBoundingClientRect().left)+e.railXRatio*(e.railXWidth-e.scrollbarXWidth);o<0?e.scrollbarXLeft=0:o>s?e.scrollbarXLeft=s:e.scrollbarXLeft=o;var a=r.toInt(e.scrollbarXLeft*(e.contentWidth-e.containerWidth)/(e.containerWidth-e.railXRatio*e.scrollbarXWidth))-e.negativeScrollAdjustment;p(t,"left",a)}var n=null,o=null,a=function(e){i(e.pageX-o),l(t),e.stopPropagation(),e.preventDefault()},d=function(){r.stopScrolling(t,"x"),e.event.unbind(e.ownerDocument,"mousemove",a)};e.event.bind(e.scrollbarX,"mousedown",function(i){o=i.pageX,n=r.toInt(s.css(e.scrollbarX,"left"))*e.railXRatio,r.startScrolling(t,"x"),e.event.bind(e.ownerDocument,"mousemove",a),e.event.once(e.ownerDocument,"mouseup",d),i.stopPropagation(),i.preventDefault()})}function o(t,e){function i(i){var o=n+i*e.railYRatio,s=Math.max(0,e.scrollbarYRail.getBoundingClientRect().top)+e.railYRatio*(e.railYHeight-e.scrollbarYHeight);o<0?e.scrollbarYTop=0:o>s?e.scrollbarYTop=s:e.scrollbarYTop=o;var a=r.toInt(e.scrollbarYTop*(e.contentHeight-e.containerHeight)/(e.containerHeight-e.railYRatio*e.scrollbarYHeight));p(t,"top",a)}var n=null,o=null,a=function(e){i(e.pageY-o),l(t),e.stopPropagation(),e.preventDefault()},d=function(){r.stopScrolling(t,"y"),e.event.unbind(e.ownerDocument,"mousemove",a)};e.event.bind(e.scrollbarY,"mousedown",function(i){o=i.pageY,n=r.toInt(s.css(e.scrollbarY,"top"))*e.railYRatio,r.startScrolling(t,"y"),e.event.bind(e.ownerDocument,"mousemove",a),e.event.once(e.ownerDocument,"mouseup",d),i.stopPropagation(),i.preventDefault()})}var r=t("../../lib/helper"),s=t("../../lib/dom"),a=t("../instances"),l=t("../update-geometry"),p=t("../update-scroll");e.exports=function(t){var e=a.get(t);n(t,e),o(t,e)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],12:[function(t,e,i){"use strict";function n(t,e){function i(i,n){var o=t.scrollTop;if(0===i){if(!e.scrollbarYActive)return!1;if(0===o&&n>0||o>=e.contentHeight-e.containerHeight&&n<0)return!e.settings.wheelPropagation}var r=t.scrollLeft;if(0===n){if(!e.scrollbarXActive)return!1;if(0===r&&i<0||r>=e.contentWidth-e.containerWidth&&i>0)return!e.settings.wheelPropagation}return!0}var n=!1;e.event.bind(t,"mouseenter",function(){n=!0}),e.event.bind(t,"mouseleave",function(){n=!1});var s=!1;e.event.bind(e.ownerDocument,"keydown",function(p){if(!(p.isDefaultPrevented&&p.isDefaultPrevented()||p.defaultPrevented)){var d=r.matches(e.scrollbarX,":focus")||r.matches(e.scrollbarY,":focus");if(n||d){var c=document.activeElement?document.activeElement:e.ownerDocument.activeElement;if(c){if("IFRAME"===c.tagName)c=c.contentDocument.activeElement;else for(;c.shadowRoot;)c=c.shadowRoot.activeElement;if(o.isEditable(c))return}var u=0,h=0;switch(p.which){case 37:u=p.metaKey?-e.contentWidth:p.altKey?-e.containerWidth:-30;break;case 38:h=p.metaKey?e.contentHeight:p.altKey?e.containerHeight:30;break;case 39:u=p.metaKey?e.contentWidth:p.altKey?e.containerWidth:30;break;case 40:h=p.metaKey?-e.contentHeight:p.altKey?-e.containerHeight:-30;break;case 33:h=90;break;case 32:h=p.shiftKey?90:-90;break;case 34:h=-90;break;case 35:h=p.ctrlKey?-e.contentHeight:-e.containerHeight;break;case 36:h=p.ctrlKey?t.scrollTop:e.containerHeight;break;default:return}l(t,"top",t.scrollTop-h),l(t,"left",t.scrollLeft+u),a(t),s=i(u,h),s&&p.preventDefault()}}})}var o=t("../../lib/helper"),r=t("../../lib/dom"),s=t("../instances"),a=t("../update-geometry"),l=t("../update-scroll");e.exports=function(t){var e=s.get(t);n(t,e)}},{"../../lib/dom":3,"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],13:[function(t,e,i){"use strict";function n(t,e){function i(i,n){var o=t.scrollTop;if(0===i){if(!e.scrollbarYActive)return!1;if(0===o&&n>0||o>=e.contentHeight-e.containerHeight&&n<0)return!e.settings.wheelPropagation}var r=t.scrollLeft;if(0===n){if(!e.scrollbarXActive)return!1;if(0===r&&i<0||r>=e.contentWidth-e.containerWidth&&i>0)return!e.settings.wheelPropagation}return!0}function n(t){var e=t.deltaX,i=-1*t.deltaY;return"undefined"!=typeof e&&"undefined"!=typeof i||(e=-1*t.wheelDeltaX/6,i=t.wheelDeltaY/6),t.deltaMode&&1===t.deltaMode&&(e*=10,i*=10),e!==e&&i!==i&&(e=0,i=t.wheelDelta),t.shiftKey?[-i,-e]:[e,i]}function o(e,i){var n=t.querySelector("textarea:hover, select[multiple]:hover, .ps-child:hover");if(n){if(!window.getComputedStyle(n).overflow.match(/(scroll|auto)/))return!1;var o=n.scrollHeight-n.clientHeight;if(o>0&&!(0===n.scrollTop&&i>0||n.scrollTop===o&&i<0))return!0;var r=n.scrollLeft-n.clientWidth;if(r>0&&!(0===n.scrollLeft&&e<0||n.scrollLeft===r&&e>0))return!0}return!1}function a(a){var p=n(a),d=p[0],c=p[1];o(d,c)||(l=!1,e.settings.useBothWheelAxes?e.scrollbarYActive&&!e.scrollbarXActive?(c?s(t,"top",t.scrollTop-c*e.settings.wheelSpeed):s(t,"top",t.scrollTop+d*e.settings.wheelSpeed),l=!0):e.scrollbarXActive&&!e.scrollbarYActive&&(d?s(t,"left",t.scrollLeft+d*e.settings.wheelSpeed):s(t,"left",t.scrollLeft-c*e.settings.wheelSpeed),l=!0):(s(t,"top",t.scrollTop-c*e.settings.wheelSpeed),s(t,"left",t.scrollLeft+d*e.settings.wheelSpeed)),r(t),l=l||i(d,c),l&&(a.stopPropagation(),a.preventDefault()))}var l=!1;"undefined"!=typeof window.onwheel?e.event.bind(t,"wheel",a):"undefined"!=typeof window.onmousewheel&&e.event.bind(t,"mousewheel",a)}var o=t("../instances"),r=t("../update-geometry"),s=t("../update-scroll");e.exports=function(t){var e=o.get(t);n(t,e)}},{"../instances":18,"../update-geometry":19,"../update-scroll":20}],14:[function(t,e,i){"use strict";function n(t,e){e.event.bind(t,"scroll",function(){r(t)})}var o=t("../instances"),r=t("../update-geometry");e.exports=function(t){var e=o.get(t);n(t,e)}},{"../instances":18,"../update-geometry":19}],15:[function(t,e,i){"use strict";function n(t,e){function i(){var t=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===t.toString().length?null:t.getRangeAt(0).commonAncestorContainer}function n(){p||(p=setInterval(function(){return r.get(t)?(a(t,"top",t.scrollTop+d.top),a(t,"left",t.scrollLeft+d.left),void s(t)):void clearInterval(p)},50))}function l(){p&&(clearInterval(p),p=null),o.stopScrolling(t)}var p=null,d={top:0,left:0},c=!1;e.event.bind(e.ownerDocument,"selectionchange",function(){t.contains(i())?c=!0:(c=!1,l())}),e.event.bind(window,"mouseup",function(){c&&(c=!1,l())}),e.event.bind(window,"keyup",function(){c&&(c=!1,l())}),e.event.bind(window,"mousemove",function(e){if(c){var i={x:e.pageX,y:e.pageY},r={left:t.offsetLeft,right:t.offsetLeft+t.offsetWidth,top:t.offsetTop,bottom:t.offsetTop+t.offsetHeight};i.x<r.left+3?(d.left=-5,o.startScrolling(t,"x")):i.x>r.right-3?(d.left=5,o.startScrolling(t,"x")):d.left=0,i.y<r.top+3?(r.top+3-i.y<5?d.top=-5:d.top=-20,o.startScrolling(t,"y")):i.y>r.bottom-3?(i.y-r.bottom+3<5?d.top=5:d.top=20,o.startScrolling(t,"y")):d.top=0,0===d.top&&0===d.left?l():n()}})}var o=t("../../lib/helper"),r=t("../instances"),s=t("../update-geometry"),a=t("../update-scroll");e.exports=function(t){var e=r.get(t);n(t,e)}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],16:[function(t,e,i){"use strict";function n(t,e,i,n){function o(i,n){var o=t.scrollTop,r=t.scrollLeft,s=Math.abs(i),a=Math.abs(n);if(a>s){if(n<0&&o===e.contentHeight-e.containerHeight||n>0&&0===o)return!e.settings.swipePropagation}else if(s>a&&(i<0&&r===e.contentWidth-e.containerWidth||i>0&&0===r))return!e.settings.swipePropagation;return!0}function l(e,i){a(t,"top",t.scrollTop-i),a(t,"left",t.scrollLeft-e),s(t)}function p(){y=!0}function d(){y=!1}function c(t){return t.targetTouches?t.targetTouches[0]:t}function u(t){return!(!t.targetTouches||1!==t.targetTouches.length)||!(!t.pointerType||"mouse"===t.pointerType||t.pointerType===t.MSPOINTER_TYPE_MOUSE)}function h(t){if(u(t)){w=!0;var e=c(t);g.pageX=e.pageX,g.pageY=e.pageY,m=(new Date).getTime(),null!==b&&clearInterval(b),t.stopPropagation()}}function f(t){if(!w&&e.settings.swipePropagation&&h(t),!y&&w&&u(t)){var i=c(t),n={pageX:i.pageX,pageY:i.pageY},r=n.pageX-g.pageX,s=n.pageY-g.pageY;l(r,s),g=n;var a=(new Date).getTime(),p=a-m;p>0&&(v.x=r/p,v.y=s/p,m=a),o(r,s)&&(t.stopPropagation(),t.preventDefault())}}function _(){!y&&w&&(w=!1,clearInterval(b),b=setInterval(function(){return r.get(t)&&(v.x||v.y)?Math.abs(v.x)<.01&&Math.abs(v.y)<.01?void clearInterval(b):(l(30*v.x,30*v.y),v.x*=.8,void(v.y*=.8)):void clearInterval(b)},10))}var g={},m=0,v={},b=null,y=!1,w=!1;i&&(e.event.bind(window,"touchstart",p),e.event.bind(window,"touchend",d),e.event.bind(t,"touchstart",h),e.event.bind(t,"touchmove",f),e.event.bind(t,"touchend",_)),n&&(window.PointerEvent?(e.event.bind(window,"pointerdown",p),e.event.bind(window,"pointerup",d),e.event.bind(t,"pointerdown",h),e.event.bind(t,"pointermove",f),e.event.bind(t,"pointerup",_)):window.MSPointerEvent&&(e.event.bind(window,"MSPointerDown",p),e.event.bind(window,"MSPointerUp",d),e.event.bind(t,"MSPointerDown",h),e.event.bind(t,"MSPointerMove",f),e.event.bind(t,"MSPointerUp",_)))}var o=t("../../lib/helper"),r=t("../instances"),s=t("../update-geometry"),a=t("../update-scroll");e.exports=function(t){if(o.env.supportsTouch||o.env.supportsIePointer){var e=r.get(t);n(t,e,o.env.supportsTouch,o.env.supportsIePointer)}}},{"../../lib/helper":6,"../instances":18,"../update-geometry":19,"../update-scroll":20}],17:[function(t,e,i){"use strict";var n=t("../lib/helper"),o=t("../lib/class"),r=t("./instances"),s=t("./update-geometry"),a={"click-rail":t("./handler/click-rail"),"drag-scrollbar":t("./handler/drag-scrollbar"),keyboard:t("./handler/keyboard"),wheel:t("./handler/mouse-wheel"),touch:t("./handler/touch"),selection:t("./handler/selection")},l=t("./handler/native-scroll");e.exports=function(t,e){e="object"==typeof e?e:{},o.add(t,"ps-container");var i=r.add(t);i.settings=n.extend(i.settings,e),o.add(t,"ps-theme-"+i.settings.theme),i.settings.handlers.forEach(function(e){a[e](t)}),l(t),s(t)}},{"../lib/class":2,"../lib/helper":6,"./handler/click-rail":10,"./handler/drag-scrollbar":11,"./handler/keyboard":12,"./handler/mouse-wheel":13,"./handler/native-scroll":14,"./handler/selection":15,"./handler/touch":16,"./instances":18,"./update-geometry":19}],18:[function(t,e,i){"use strict";function n(t){function e(){l.add(t,"ps-focus")}function i(){l.remove(t,"ps-focus")}var n=this;n.settings=a.clone(p),n.containerWidth=null,n.containerHeight=null,n.contentWidth=null,n.contentHeight=null,n.isRtl="rtl"===d.css(t,"direction"),n.isNegativeScroll=function(){var e=t.scrollLeft,i=null;return t.scrollLeft=-1,i=t.scrollLeft<0,t.scrollLeft=e,i}(),n.negativeScrollAdjustment=n.isNegativeScroll?t.scrollWidth-t.clientWidth:0,n.event=new c,n.ownerDocument=t.ownerDocument||document,n.scrollbarXRail=d.appendTo(d.e("div","ps-scrollbar-x-rail"),t),n.scrollbarX=d.appendTo(d.e("div","ps-scrollbar-x"),n.scrollbarXRail),n.scrollbarX.setAttribute("tabindex",0),n.event.bind(n.scrollbarX,"focus",e),n.event.bind(n.scrollbarX,"blur",i),n.scrollbarXActive=null,n.scrollbarXWidth=null,n.scrollbarXLeft=null,n.scrollbarXBottom=a.toInt(d.css(n.scrollbarXRail,"bottom")),n.isScrollbarXUsingBottom=n.scrollbarXBottom===n.scrollbarXBottom,n.scrollbarXTop=n.isScrollbarXUsingBottom?null:a.toInt(d.css(n.scrollbarXRail,"top")),n.railBorderXWidth=a.toInt(d.css(n.scrollbarXRail,"borderLeftWidth"))+a.toInt(d.css(n.scrollbarXRail,"borderRightWidth")),d.css(n.scrollbarXRail,"display","block"),n.railXMarginWidth=a.toInt(d.css(n.scrollbarXRail,"marginLeft"))+a.toInt(d.css(n.scrollbarXRail,"marginRight")),d.css(n.scrollbarXRail,"display",""),n.railXWidth=null,n.railXRatio=null,n.scrollbarYRail=d.appendTo(d.e("div","ps-scrollbar-y-rail"),t),n.scrollbarY=d.appendTo(d.e("div","ps-scrollbar-y"),n.scrollbarYRail),n.scrollbarY.setAttribute("tabindex",0),n.event.bind(n.scrollbarY,"focus",e),n.event.bind(n.scrollbarY,"blur",i),n.scrollbarYActive=null,n.scrollbarYHeight=null,n.scrollbarYTop=null,n.scrollbarYRight=a.toInt(d.css(n.scrollbarYRail,"right")),n.isScrollbarYUsingRight=n.scrollbarYRight===n.scrollbarYRight,n.scrollbarYLeft=n.isScrollbarYUsingRight?null:a.toInt(d.css(n.scrollbarYRail,"left")),n.scrollbarYOuterWidth=n.isRtl?a.outerWidth(n.scrollbarY):null,n.railBorderYWidth=a.toInt(d.css(n.scrollbarYRail,"borderTopWidth"))+a.toInt(d.css(n.scrollbarYRail,"borderBottomWidth")),d.css(n.scrollbarYRail,"display","block"),n.railYMarginHeight=a.toInt(d.css(n.scrollbarYRail,"marginTop"))+a.toInt(d.css(n.scrollbarYRail,"marginBottom")),d.css(n.scrollbarYRail,"display",""),n.railYHeight=null,n.railYRatio=null}function o(t){return t.getAttribute("data-ps-id")}function r(t,e){t.setAttribute("data-ps-id",e)}function s(t){t.removeAttribute("data-ps-id")}var a=t("../lib/helper"),l=t("../lib/class"),p=t("./default-setting"),d=t("../lib/dom"),c=t("../lib/event-manager"),u=t("../lib/guid"),h={};i.add=function(t){var e=u();return r(t,e),h[e]=new n(t),h[e]},i.remove=function(t){delete h[o(t)],s(t)},i.get=function(t){return h[o(t)]}},{"../lib/class":2,"../lib/dom":3,"../lib/event-manager":4,"../lib/guid":5,"../lib/helper":6,"./default-setting":8}],19:[function(t,e,i){"use strict";function n(t,e){return t.settings.minScrollbarLength&&(e=Math.max(e,t.settings.minScrollbarLength)),t.settings.maxScrollbarLength&&(e=Math.min(e,t.settings.maxScrollbarLength)),e}function o(t,e){var i={width:e.railXWidth};e.isRtl?i.left=e.negativeScrollAdjustment+t.scrollLeft+e.containerWidth-e.contentWidth:i.left=t.scrollLeft,e.isScrollbarXUsingBottom?i.bottom=e.scrollbarXBottom-t.scrollTop:i.top=e.scrollbarXTop+t.scrollTop,a.css(e.scrollbarXRail,i);var n={top:t.scrollTop,height:e.railYHeight};e.isScrollbarYUsingRight?e.isRtl?n.right=e.contentWidth-(e.negativeScrollAdjustment+t.scrollLeft)-e.scrollbarYRight-e.scrollbarYOuterWidth:n.right=e.scrollbarYRight-t.scrollLeft:e.isRtl?n.left=e.negativeScrollAdjustment+t.scrollLeft+2*e.containerWidth-e.contentWidth-e.scrollbarYLeft-e.scrollbarYOuterWidth:n.left=e.scrollbarYLeft+t.scrollLeft,a.css(e.scrollbarYRail,n),a.css(e.scrollbarX,{left:e.scrollbarXLeft,width:e.scrollbarXWidth-e.railBorderXWidth}),a.css(e.scrollbarY,{top:e.scrollbarYTop,height:e.scrollbarYHeight-e.railBorderYWidth})}var r=t("../lib/helper"),s=t("../lib/class"),a=t("../lib/dom"),l=t("./instances"),p=t("./update-scroll");e.exports=function(t){var e=l.get(t);e.containerWidth=t.clientWidth,e.containerHeight=t.clientHeight,e.contentWidth=t.scrollWidth,e.contentHeight=t.scrollHeight;var i;t.contains(e.scrollbarXRail)||(i=a.queryChildren(t,".ps-scrollbar-x-rail"),i.length>0&&i.forEach(function(t){a.remove(t)}),a.appendTo(e.scrollbarXRail,t)),t.contains(e.scrollbarYRail)||(i=a.queryChildren(t,".ps-scrollbar-y-rail"),i.length>0&&i.forEach(function(t){a.remove(t)}),a.appendTo(e.scrollbarYRail,t)),!e.settings.suppressScrollX&&e.containerWidth+e.settings.scrollXMarginOffset<e.contentWidth?(e.scrollbarXActive=!0,e.railXWidth=e.containerWidth-e.railXMarginWidth,e.railXRatio=e.containerWidth/e.railXWidth,e.scrollbarXWidth=n(e,r.toInt(e.railXWidth*e.containerWidth/e.contentWidth)),e.scrollbarXLeft=r.toInt((e.negativeScrollAdjustment+t.scrollLeft)*(e.railXWidth-e.scrollbarXWidth)/(e.contentWidth-e.containerWidth))):e.scrollbarXActive=!1,!e.settings.suppressScrollY&&e.containerHeight+e.settings.scrollYMarginOffset<e.contentHeight?(e.scrollbarYActive=!0,e.railYHeight=e.containerHeight-e.railYMarginHeight,e.railYRatio=e.containerHeight/e.railYHeight,e.scrollbarYHeight=n(e,r.toInt(e.railYHeight*e.containerHeight/e.contentHeight)),e.scrollbarYTop=r.toInt(t.scrollTop*(e.railYHeight-e.scrollbarYHeight)/(e.contentHeight-e.containerHeight))):e.scrollbarYActive=!1,e.scrollbarXLeft>=e.railXWidth-e.scrollbarXWidth&&(e.scrollbarXLeft=e.railXWidth-e.scrollbarXWidth),e.scrollbarYTop>=e.railYHeight-e.scrollbarYHeight&&(e.scrollbarYTop=e.railYHeight-e.scrollbarYHeight),o(t,e),e.scrollbarXActive?s.add(t,"ps-active-x"):(s.remove(t,"ps-active-x"),e.scrollbarXWidth=0,e.scrollbarXLeft=0,p(t,"left",0)),e.scrollbarYActive?s.add(t,"ps-active-y"):(s.remove(t,"ps-active-y"),e.scrollbarYHeight=0,e.scrollbarYTop=0,p(t,"top",0))}},{"../lib/class":2,"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-scroll":20}],20:[function(t,e,i){"use strict";var n,o,r=t("./instances"),s=function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!0),e};e.exports=function(t,e,i){if("undefined"==typeof t)throw"You must provide an element to the update-scroll function";if("undefined"==typeof e)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof i)throw"You must provide a value to the update-scroll function";"top"===e&&i<=0&&(t.scrollTop=i=0,t.dispatchEvent(s("ps-y-reach-start"))),"left"===e&&i<=0&&(t.scrollLeft=i=0,t.dispatchEvent(s("ps-x-reach-start")));var a=r.get(t);"top"===e&&i>=a.contentHeight-a.containerHeight&&(i=a.contentHeight-a.containerHeight,i-t.scrollTop<=1?i=t.scrollTop:t.scrollTop=i,t.dispatchEvent(s("ps-y-reach-end"))),"left"===e&&i>=a.contentWidth-a.containerWidth&&(i=a.contentWidth-a.containerWidth,i-t.scrollLeft<=1?i=t.scrollLeft:t.scrollLeft=i,t.dispatchEvent(s("ps-x-reach-end"))),n||(n=t.scrollTop),o||(o=t.scrollLeft),"top"===e&&i<n&&t.dispatchEvent(s("ps-scroll-up")),"top"===e&&i>n&&t.dispatchEvent(s("ps-scroll-down")),"left"===e&&i<o&&t.dispatchEvent(s("ps-scroll-left")),"left"===e&&i>o&&t.dispatchEvent(s("ps-scroll-right")),"top"===e&&(t.scrollTop=n=i,t.dispatchEvent(s("ps-scroll-y"))),"left"===e&&(t.scrollLeft=o=i,t.dispatchEvent(s("ps-scroll-x")))}},{"./instances":18}],21:[function(t,e,i){"use strict";var n=t("../lib/helper"),o=t("../lib/dom"),r=t("./instances"),s=t("./update-geometry"),a=t("./update-scroll");e.exports=function(t){var e=r.get(t);e&&(e.negativeScrollAdjustment=e.isNegativeScroll?t.scrollWidth-t.clientWidth:0,o.css(e.scrollbarXRail,"display","block"),o.css(e.scrollbarYRail,"display","block"),e.railXMarginWidth=n.toInt(o.css(e.scrollbarXRail,"marginLeft"))+n.toInt(o.css(e.scrollbarXRail,"marginRight")),e.railYMarginHeight=n.toInt(o.css(e.scrollbarYRail,"marginTop"))+n.toInt(o.css(e.scrollbarYRail,"marginBottom")),o.css(e.scrollbarXRail,"display","none"),o.css(e.scrollbarYRail,"display","none"),s(t),a(t,"top",t.scrollTop),a(t,"left",t.scrollLeft),o.css(e.scrollbarXRail,"display",""),o.css(e.scrollbarYRail,"display",""))}},{"../lib/dom":3,"../lib/helper":6,"./instances":18,"./update-geometry":19,"./update-scroll":20}]},{},[1]),function(t){define("scripts/perfect-scrollbar/perfect-scrollbar",["scripts/perfect-scrollbar/perfect-scrollbar-library"],function(t){return t.withDebounceUpdate=function(e,i,n,o){"undefined"!=typeof o&&t.initialize(e,{suppressScrollX:!0});var r=_.debounce(function(){t.update(e)},500,i);"undefined"!=typeof n&&Upfront.Events.on(n,r),setTimeout(r)},t})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/css/css-editor",["text!upfront/templates/popup.html","scripts/upfront/upfront-views-editor/fields","scripts/upfront/upfront-views-editor/fonts","scripts/upfront/upfront-views-editor/notifier","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n,o,r,s){return Backbone.View.extend({className:"upfront-ui",id:"upfront-csseditor",tpl:_.template(t(i).find("#csseditor-tpl").html()),prepareAce:!1,ace:!1,events:{"click .upfront-css-save-ok":"save","click .upfront-css-close":"close","click .upfront-css-theme_image":"openThemeImagePicker","click .upfront-css-media_image":"openImagePicker","click .upfront-css-font":"startInsertFontWidget","click .upfront-css-selector":"addSelector","click .upfront-css-type":"scrollToElement","click .upfront-css-delete":"deleteStyle","change .upfront-css-save-name-field":"updateStylename","mouseenter .upfront-css-selector":"hiliteElement","mouseleave .upfront-css-selector":"unhiliteElement","keyup .upfront-css-save-name-field":"checkDeleteToggle"},elementTypes:{UaccordionModel:{label:e.accordion,id:"uaccordion"},UcommentModel:{label:e.comments,id:"ucomment"},UcontactModel:{label:e.contact_form,id:"ucontact"},UgalleryModel:{label:e.gallery,id:"ugallery"},UimageModel:{label:e.image,id:"image"},LoginModel:{label:e.login,id:"upfront-login_element"},LikeBox:{label:e.like_box,id:"Like-box-object"},MapModel:{label:e.map,id:"upfront-map_element"},UnewnavigationModel:{label:e.navigation,id:"unewnavigation"},ButtonModel:{label:e.button,id:"ubutton"},PostsModel:{label:e.posts,id:"uposts"},UsearchModel:{label:e.search,id:"usearch"},USliderModel:{label:e.slider,id:"uslider"},SocialMediaModel:{label:e.social,id:"SocialMedia"},UtabsModel:{label:e.tabs,id:"utabs"},ThisPageModel:{label:e.page,id:"this_page"},ThisPostModel:{label:e.post,id:"this_post"},UwidgetModel:{label:e.widget,id:"uwidget"},UyoutubeModel:{label:e.youtube,id:"uyoutube"},PlainTxtModel:{label:e.text,id:"plain_text"},CodeModel:{label:e.code,id:"upfront-code_element"},Layout:{label:e.body,id:"layout"},GalleryLightbox:{label:e.body,id:"gallery-lightbox"},RegionContainer:{label:e.region,id:"region-container"},Region:{label:e.inner_region,id:"region"},RegionLightbox:{label:e.ltbox_region,id:"region"},ModuleGroup:{label:e.group,id:"module-group"},PostPart_titleModel:{label:e.postpart_title,id:"PostPart_title"},PostPart_contentsModel:{label:e.postpart_content,id:"PostPart_contents"},PostPart_excerptModel:{label:e.postpart_excerpt,id:"PostPart_excerpt"},PostPart_featured_imageModel:{label:e.postpart_featured,id:"PostPart_featured_image"},PostPart_authorModel:{label:e.postpart_author,id:"PostPart_author"},PostPart_author_gravatarModel:{label:e.postpart_author_gravatar,id:"PostPart_author_gravatar"},PostPart_dateModel:{label:e.postpart_date,id:"PostPart_date"},PostPart_updateModel:{label:e.postpart_update,id:"PostPart_update"},PostPart_comments_countModel:{label:e.postpart_comments,id:"PostPart_comments_count"},PostPart_tagsModel:{label:e.postpart_tags,id:"PostPart_tags"},PostPart_categoriesModel:{label:e.postpart_categories,id:"PostPart_categories"}},initialize:function(){t("#"+this.id).length||t("body").append(this.el),Upfront.Events.on("command:region:edit_toggle",this.close,this),Upfront.plugins.call("insert-css-editor-types",{types:this.elementTypes})},init:function(e){var i=this,n=t.Deferred();this.$style&&this.close(),this.no_render=e.no_render===!0,this.no_stylename_fallback=e.no_stylename_fallback===!0,this.model=e.model,this.sidebar=e.sidebar!==!1,this.toolbar=e.toolbar!==!1,this.readOnly=e.readOnly===!0,this.global=e.global===!0,this.modelType=e.type?e.type:this.model.get_property_value_by_name("type"),this.elementType=this.elementTypes[this.modelType]||{label:"Unknown",id:"unknown"},this.is_global_stylesheet="Layout"===e.type&&"layout"===e.element_id,this.is_global_stylesheet&&(this.sidebar=!0),this.resolve_stylename(e),this.ensure_style_element(),this.selectors=this.elementSelectors[this.modelType]||{},this.element_id=e.element_id?e.element_id:this.model.get_property_value_by_name("element_id"),this.no_render||(this.prepareAce=n.promise(),require([Upfront.Settings.ace_url],function(){n.resolve()}),this.resizeHandler=this.resizeHandler||function(){i.$el.width(t(window).width()-t("#sidebar-ui").width()-1)},t(window).on("resize",this.resizeHandler),"function"==typeof e.change&&this.on("change",e.change),this.render(),Upfront.Events.on("command:undo",function(){setTimeout(function(){var t=Upfront.Util.Transient.pop("css-"+i.element_id);t&&(i.get_style_element().html(t.replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module")),i.render())},200)}),this.startResizable(),Upfront.Events.trigger("csseditor:open",this.element_id))},resolve_stylename:function(e){if(this.stylename="",this.is_global_stylesheet?this.stylename="layout-style":this.stylename=e.stylename,this.is_region_style()){var i=_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type,n="global"==this.model.get("scope"),o=this.elementType.id+"-"+this.model.get("name")+"-style",r=i+"-"+this.model.get("name")+"-style";n?this.stylename=o:(this.stylename=r,_.isArray(Upfront.data.styles[this.elementType.id])&&Upfront.data.styles[this.elementType.id].indexOf(o)!==-1&&Upfront.data.styles[this.elementType.id].indexOf(r)===-1&&!this.no_stylename_fallback&&(this.stylename=o))}""===this.stylename&&(this.stylename=this.get_temp_stylename(),t("#"+this.model.get_property_value_by_name("element_id")).addClass(this.stylename)),this.is_default_style="_default"===this.stylename},is_region_style:function(){return"region-container"===this.elementType.id||"region"===this.elementType.id},get_style_id:function(){return this.is_default_style?this.elementType.id+"_default":this.stylename},get_css_selector:function(){var t=Upfront.plugins.call("get-css-editor-selector",{object:this});return t.status&&"called"===t.status&&t.result?t.result:this.is_global_stylesheet?"":this.is_region_style()?".upfront-"+this.elementType.id+"-"+this.model.get("name"):this.is_default_style===!1?"#page ."+this.stylename:".upfront-output-"+this.elementType.id},ensure_style_element:function(){var e=this.get_style_element();return 0!==e.length?void(this.$style=e):(this.$style=t('<style id="'+this.get_style_id()+'"></style>'),void t("body").append(this.$style))},get_style_element:function(){return t("style#"+this.get_style_id())},close:function(e){e&&_.isFunction(e.preventDefault)&&e.preventDefault(),t(window).off("resize",this.resizeHandler),this.off("change"),this.$style=!1,this.editor&&this.editor.destroy(),t("#page").css("padding-bottom",0),this.$el.hide(),Upfront.Events.trigger("csseditor:closed",this.element_id)},render:function(){var e=this;t("#"+this.id).length||t("#page").append(this.$el),this.sidebar?this.$el.removeClass("upfront-css-no-sidebar"):this.$el.addClass("upfront-css-no-sidebar"),this.$el.html(this.tpl({name:this.stylename,elementType:this.elementType.label,selectors:this.selectors,show_style_name:this.is_region_style()===!1&&this.is_global_stylesheet===!1&&this.sidebar!==!0,showToolbar:this.toolbar})),this.resizeHandler(".");var i=this.$el.height()-this.$(".upfront-css-top").outerHeight();this.$(".upfront-css-body").height(i),this.prepareAce.done(function(){e.startAce()}),this.prepareSpectrum(),this.checkDeleteToggle(this.stylename),this.$el.show()},startAce:function(){var e,i,n,o=this,r=ace.edit(this.$(".upfront-css-ace")[0]),a=r.getSession(),l=!1;a.setUseWorker(!1),r.setShowPrintMargin(!1),r.setReadOnly(this.readOnly),a.setMode("ace/mode/css"),r.setTheme("ace/theme/monokai"),r.on("change",function(e){if(o.timer&&clearTimeout(o.timer),o.timer=setTimeout(function(){o.updateStyles(r.getValue())},800),o.trigger("change",r),"undefined"!=typeof o.editor){var i=t(o.editor.container).get(0).scrollWidth,n=t(o.editor.container).find(".ace_content").innerWidth();i<n+40?(l||o.startResizable(),l=!0):l=!1}}),n=Upfront.Util.colors.convert_string_color_to_ufc(this.get_style_element().html().replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page")),this.is_global_stylesheet===!1&&(e=this.get_css_selector().replace(/[.+*\[\]]/g,"\\$&"),i=new RegExp(e+"\\s*","g"),n=n.replace(i,"")),r.setValue(t.trim(n),-1),r.renderer.scrollBar.width=5,r.renderer.scroller.style.right="5px",s.withDebounceUpdate(this.$el.find(".ace_scrollbar")[0],!1,!1,!0),r.focus(),this.editor=r,o.timer&&clearTimeout(o.timer),o.timer=setTimeout(function(){o.startResizable()},300)},prepareSpectrum:function(){var t=this,e=function(e){var i;i=e.get_is_theme_color()!==!1?e.theme_color:e.alpha<1?e.toRgbString():e.toHexString(),t.editor.insert(i),t.editor.focus()},i=new n.Color({default_value:"#ffffff",showAlpha:!0,showPalette:!0,maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:Upfront.Settings.l10n.global.content.ok,showInput:!0,allowEmpty:!0,autohide:!1,spectrum:{show:function(){},choose:e}});i.render(),t.$(".upfront-css-color").html(i.el)},startResizable:function(){var e=this,i=e.$(".upfront-css-body"),n=0,o=e.$(".upfront-css-selectors"),r=e.$(".upfront-css-save-form"),s=this.$(".upfront-css-resizable"),a=function(a,l){var p=l?l.size.height:e.$(".upfront-css-resizable").height(),d=p-n;i.height(d),e.editor&&e.editor.resize(),o.outerHeight(d-r.outerHeight()),s.css({width:"",height:"",left:"",top:""}),t("#page").css("padding-bottom",p)};s.find(".upfront-css-top").removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),n=e.$(".upfront-css-top").outerHeight(),a(),s.resizable({handles:{n:".upfront-css-top"},resize:a,minHeight:200,delay:100})},scrollToElement:function(){var e=t("#"+this.element_id);if(e.length){var i=e.offset().top-50;t(document).scrollTop(i>0?i:0),this.blink(e,4)}},blink:function(t,e){var i=this;t.css("outline","3px solid #3ea"),setTimeout(function(){t.css("outline","none"),e--,e>0&&setTimeout(function(){i.blink(t,e-1)},100)},100)},hiliteElement:function(e){var i=t(e.target).data("selector");if(i.length){var n=this.is_region_style()===!1?t("#"+this.element_id).parent():t("#"+this.element_id);n.find(i).addClass("upfront-css-hilite")}},unhiliteElement:function(e){var i=t(e.target).data("selector");if(i.length){var n=this.is_region_style()===!1?t("#"+this.element_id).parent():t("#"+this.element_id);n.find(i).removeClass("upfront-css-hilite")}},remove:function(){Backbone.View.prototype.remove.call(this),t(window).off("resize",this.resizeHandler)},updateStyles:function(t){var e=this.get_style_element();Upfront.Util.Transient.push("css-"+this.element_id,e.html()),t=Upfront.Util.colors.convert_string_ufc_to_color(t),e.html(this.stylesAddSelector(t,this.is_default_style?"":this.get_css_selector()).replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module")),this.trigger("updateStyles",this.element_id)},stylesAddSelector:function(e,i){if(this.is_global_stylesheet&&empty(i))return e;var n=this,o=e.split("}"),r="";return _.each(o,function(e){var o=t.trim(e).split("{");if(2!=o.length)return!0;var s=o[0].split(","),a=[];_.each(s,function(e){e=t.trim(e);var o=e.replace(/:[^\s]+/,""),r="@"===o[0]||n.recursiveExistence(i,o),s=r?"":" ";a.push(""+i+s+e)}),r+=a.join(", ")+" {"+o[1]+"\n}\n"}),e.match(/\*\/\s*$/)&&!r.match(/\*\/\s*$/)&&(r+="\n*/"),r},recursiveExistence:function(e,i){for(var n=i.split(" "),o=this;n.length>0;){try{if(t(e+n.join(" ")).closest("#"+o.element_id).length)return!0}catch(t){}n.pop()}return!1},updateStylename:function(){var i=t.trim(this.$(".upfront-css-save-name-field").val()),n=this.stylename;return i=i.replace(/\s/g,"-").replace(/[^A-Za-z0-9_-]/gi,"").replace(/-+/g,"-").toLowerCase(),"_default"===n?(this.$(".upfront-css-save-name-field").val("_default"),void Upfront.Views.Editor.notify(e.default_style_name_nag,"error")):(t("#"+this.model.get_property_value_by_name("element_id")).removeClass(this.stylename),t("#"+this.model.get_property_value_by_name("element_id")).addClass(i),this.get_style_element().attr("id",i),this.stylename=i,this.get_style_element().html(this.get_style_element().html().replace(new RegExp(n,"g"),i)),this.model.set_breakpoint_property("theme_style",i),void(n!==this.get_temp_stylename&&this.save()))},get_temp_stylename:function(){return this.modelType.toLowerCase().replace("model","")+"-new-style"},save:function(i){i&&i.preventDefault();var n,o=this,s=t.trim(this.editor.getValue());if(this.is_global_stylesheet===!1&&this.stylename===this.get_temp_stylename())return r.addMessage(e.style_name_nag,"error");s=this.stylesAddSelector(s,this.is_default_style?"":this.get_css_selector()),n={styles:s,elementType:this.elementType.id,global:this.global};var a=Upfront.plugins.call("css-editor-save-style",{data:n,stylename:this.get_style_id(),isGlobalStylesheet:this.is_global_stylesheet,styles:s});a.status&&"called"===a.status||(n.name=this.get_style_id(),n.action="upfront_save_styles",Upfront.Util.post(n).success(function(t){
var i=t.data,n=o.elementType.id;return Upfront.data.styles[n]||(Upfront.data.styles[n]=[]),Upfront.data.styles[n].indexOf(o.get_style_id())===-1&&Upfront.data.styles[n].push(o.get_style_id()),Upfront.Events.trigger("upfront:themestyle:saved",o.get_style_id()),o.checkDeleteToggle(i.name),r.addMessage(e.style_saved_as.replace(/%s/,o.get_style_id()))}).error(function(t){return r.addMessage(e.there_was_an_error)}))},saveCall:function(i){var n,o=this,s=t.trim(this.get_style_element().html());n={styles:s,elementType:this.elementType.id,global:this.global};var a=Upfront.plugins.call("css-editor-headless-save-style",{data:n,stylename:this.get_style_id()});a.status&&"called"===a.status||(n.name=this.get_style_id(),n.action="upfront_save_styles",Upfront.Util.post(n).success(function(t){var n=(t.data,o.elementType.id);return Upfront.data.styles[n]||(Upfront.data.styles[n]=[]),Upfront.data.styles[n].indexOf(o.get_style_id())===-1&&Upfront.data.styles[n].push(o.get_style_id()),Upfront.Events.trigger("upfront:themestyle:saved",o.get_style_id()),!i||r.addMessage(e.style_saved_as.replace(/%s/,o.get_style_id()))}).error(function(t){return!i||r.addMessage(e.there_was_an_error)}))},checkDeleteToggle:function(i){if(!_.isUndefined(i)){this.deleteToggle||(this.deleteToggle=t('<a href="#" class="upfront-css-delete">'+e.delete_style+"</a>"));var n=_.isString(i)?i:i.target.value,o=this.elementType.id,r=Upfront.data.styles[o],s=r&&r.indexOf(o+"-"+n)!=-1,a=this.deleteToggle.parent().length;s&&!a?this.$(".upfront-css-save-form").append(this.deleteToggle):!s&&a&&this.deleteToggle.detach()}},deleteStyle:function(i){i.preventDefault();var n=this,o=this.elementType.id,s=o+"-"+this.$(".upfront-css-save-name-field").val();if(confirm(e.delete_stylename_nag.replace(/%s/,s))){var a={elementType:o,styleName:s,action:"upfront_delete_styles"};Upfront.Util.post(a).done(function(){var i=Upfront.data.styles[o].indexOf(s);r.addMessage(e.stylename_deleted.replace(/%s/,s)),n.$(".upfront-css-save-name-field").val(""),n.editor.setValue(""),i!=-1&&Upfront.data.styles[o].splice(i,1),t("#upfront-style-"+s).remove(),n.model.get_property_value_by_name("theme_style")==s&&n.model.set_property("theme_style",""),n.deleteToggle.detach()})}},fetchThemeStyles:function(e){var i={action:"upfront_theme_styles",separately:e},n=t.Deferred();return Upfront.Util.post(i).success(function(t){n.resolve(t.data.styles)}),n.promise()},createSelectors:function(t){var e=this,i={};_.each(t,function(t){i[t.cssSelectorsId]=t.cssSelectors||{}}),e.elementSelectors=i},createSelector:function(t,e,i){var n=new t,o=new e({model:n});this.elementSelectors[i]=o.cssSelectors||{},o.remove()},openThemeImagePicker:function(){this._open_media_popup({themeImages:!0})},openImagePicker:function(){this._open_media_popup()},_open_media_popup:function(t){t=_.isObject(t)?t:{};var e=this,i=_.extend({},t);Upfront.Media.Manager.open(i).done(function(t,i){if(Upfront.Events.trigger("upfront:element:edit:stop"),i&&0!==i.length){var n=i.models[0],o=n.get("image")?n.get("image"):i.models[0],r="src"in o?o.src:"get"in o&&o.get("original_url");e.editor.insert('url("'+r+'")'),e.editor.focus()}})},startInsertFontWidget:function(){var e=new o.Insert_Font_Widget({collection:o.theme_fonts_collection});t("#insert-font-widget").html(e.render().el)},getElementType:function(t){var e=t.get_property_value_by_name("type"),i=this.elementTypes[e];return i||e},addSelector:function(e){var i=t(e.target).data("selector");_.isUndefined(this.editor)||(this.editor.insert(i),this.editor.focus())}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/css/general-css-editor",["text!upfront/templates/popup.html","scripts/upfront/upfront-views-editor/theme-colors","scripts/upfront/upfront-views-editor/fonts","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n,o,r){return Backbone.View.extend({className:"upfront-ui",id:"upfront-general-csseditor",tpl:_.template(t(i).find("#csseditor-tpl").html()),prepareAce:!1,ace:!1,events:{"click .upfront-css-save-ok":"fire_save","click .upfront-css-close":"close","click .upfront-css-font":"startInsertFontWidget","click .upfront-css-image":"openImagePicker","click .upfront-css-selector":"addSelector"},initialize:function(e){var i,n,o=this,r=t.Deferred();this.options=e||{},this.model=e.model,this.sidebar=e.sidebar!==!1,this.global=e.global===!0,this.toolbar=e.toolbar!==!1,this.prepareAce=r.promise(),require([Upfront.Settings.ace_url],function(){r.resolve()}),this.resizeHandler=this.resizeHandler||function(){o.$el.width(t(window).width()-t("#sidebar-ui").width()-1)},t(window).on("resize",this.resizeHandler),i=this.model.get("id")+"-breakpoint-style",n=t("#"+i),0===n.length?(this.$style=t('<style id="'+i+'"></style>'),t("body").append(this.$style)):this.$style=n,e.cssSelectors&&(this.selectors=e.cssSelectors),"function"==typeof e.change&&this.listenTo(this,"change",e.change),"function"==typeof e.onClose&&this.listenTo(this,"close",e.onClose),this.render(),this.startResizable()},close:function(e){e&&e.preventDefault(),t(window).off("resize",this.resizeHandler),this.editor&&this.editor.destroy(),t("#page").css("padding-bottom",0),this.remove()},render:function(){var e=this;t("#page").append(this.$el),this.sidebar?this.$el.removeClass("upfront-css-no-sidebar"):this.$el.addClass("upfront-css-no-sidebar"),this.$el.html(this.tpl({selectors:this.selectors,elementType:!1,show_style_name:!1,showToolbar:this.toolbar})),this.resizeHandler(".");var i=this.$el.height()-this.$(".upfront-css-top").outerHeight();this.$(".upfront-css-body").height(i),this.prepareAce.done(function(){e.startAce()}),this.prepareSpectrum(),this.$el.show()},startAce:function(){var e=this,i=ace.edit(this.$(".upfront-css-ace")[0]),n=i.getSession();n.setUseWorker(!1),i.setShowPrintMargin(!1),n.setMode("ace/mode/css"),i.setTheme("ace/theme/monokai"),i.on("change",function(n){var o,r=i.getValue().split("}"),s="\n\n."+e.options.page_class+" ";r=_.map(r,function(e){return t.trim(e)}),r.pop(),o=r.length?s+r.join("\n}"+s)+"\n}":"",e.$style.html(o),e.trigger("change",o)});var o=new RegExp("."+this.options.page_class+"s*","g"),s=this.model.get("styles")?this.model.get("styles").replace(o,""):"";s="GalleryLightbox"===this.options.type?this.model.get("properties").get("styles").get("value").replace(o,""):this.model.get("styles")?this.model.get("styles").replace(o,""):"",i.setValue(t.trim(s),-1),i.renderer.scrollBar.width=5,i.renderer.scroller.style.right="5px",r.withDebounceUpdate(this.$el.find(".ace_scrollbar")[0],!0,!1,!0),i.focus(),this.editor=i},prepareSpectrum:function(){var i=this;i.$(".upfront-css-color").spectrum({showAlpha:!0,showPalette:!0,palette:n.colors.pluck("color").length?n.colors.pluck("color"):["fff","000","0f0"],maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:e.ok,showInput:!0,allowEmpty:!0,show:function(){spectrum=t(".sp-container:visible")},change:function(t){var e=t.alpha<1?t.toRgbString():t.toHexString();i.editor.insert(e),i.editor.focus()},move:function(t){var e=t.toRgbString();spectrum.find(".sp-dragger").css("border-top-color",e),spectrum.parent().find(".sp-dragger").css("border-right-color",e)}})},startResizable:function(){var e=this,i=e.$(".upfront-css-body"),n=e.$(".upfront-css-top").outerHeight(),o=e.$(".upfront-css-selectors"),r=e.$(".upfront-css-save-form"),s=function(s,a){var l=a?a.size.height:e.$(".upfront-css-resizable").height(),p=l-n;i.height(p),e.editor&&e.editor.resize(),o.height(p-r.outerHeight()),t("#page").css("padding-bottom",l)};s(),this.$(".upfront-css-resizable").resizable({handles:{n:".upfront-css-top"},resize:s,minHeight:200,delay:100})},remove:function(){this.trigger("close"),Backbone.View.prototype.remove.call(this),t(window).off("resize",this.resizeHandler)},openImagePicker:function(){var t=this;Upfront.Media.Manager.open({}).done(function(e,i){if(Upfront.Events.trigger("upfront:element:edit:stop"),i){var n=i.models[0].get("image").src;t.editor.insert('url("'+n+'")'),t.editor.focus()}})},startInsertFontWidget:function(){var e=new o.Insert_Font_Widget({collection:o.theme_fonts_collection});t("#insert-font-widget").html(e.render().el)},addSelector:function(e){var i=t(e.target).data("selector");this.editor.insert(i),this.editor.focus()}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/css",["scripts/upfront/upfront-views-editor/css/css-editor","scripts/upfront/upfront-views-editor/css/general-css-editor"],function(t,e){return{CSSEditor:t,GeneralCSSEditor:e}})}(jQuery),function(){define("scripts/upfront/upfront-views-editor/breakpoint/model",[],function(){return Backbone.Model.extend({defaults:{default:!1,name:"Breakpoint",short_name:"breakpoint",fixed:!1,enabled:!1,active:!1,width:240,columns:5,typography:{},styles:""},initialize:function(){0===this.attributes.columns&&this.attributes.width>0&&(this.attributes.columns=Math.round(this.attributes.width/45)),this.on("change:width",this.update_columns,this),this.on("change:columns",this.update_width,this),this.on("change:name",this.update_short_name,this)},update_width:function(t,e){var i=parseInt(e,10);return i>24?void this.set({columns:24}):i<5?void this.set({columns:5}):void(this.attributes.width=45*i)},update_columns:function(t,e){var i,n=parseInt(e,10);return n>1080?void this.set({width:1080}):n<240?void this.set({width:240}):(i=Math.round(n/45),void(this.attributes.columns!==i&&(this.attributes.columns=i)))},update_short_name:function(t,e){this.attributes.short_name=e},get_property_value_by_name:function(t){return this.get(t)},set_property:function(t,e){var i={};i[t]=e,this.set(i)}})})}(),function(t){define("scripts/upfront/upfront-views-editor/breakpoint/collection",["scripts/upfront/upfront-views-editor/breakpoint/model"],function(e){return Backbone.Collection.extend({model:e,initialize:function(){this.on("change:active",this.on_change_active,this),this.on("change:enabled",this.on_change_enabled,this),this.on("change:width",this.on_change_width,this)},on_change_active:function(e){var i=!!this.active&&this.active.toJSON();this.prev_active=this.active,this.active=e,_.each(this.models,function(t){t.get("id")!==e.get("id")&&t.set({active:!1},{silent:!0})}),Upfront.Events.trigger("upfront:layout_size:change_breakpoint",e.toJSON(),i),Upfront.Events.trigger("upfront:layout_size:change_breakpoint:secondary",e.toJSON(),i),Upfront.Events.trigger("upfront:layout_size:change_breakpoint:tertiary",e.toJSON(),i),this.prev_active&&t("#page").removeClass(this.prev_active.get("id")+"-breakpoint"),t("#page").addClass(this.active.get("id")+"-breakpoint"),this.active.get("default")?t("#page").removeClass("responsive-breakpoint").addClass("default-breakpoint"):t("#page").removeClass("default-breakpoint").addClass("responsive-breakpoint"),Upfront.Events.trigger("upfront:layout_size:change_breakpoint:after",e.toJSON(),i)},on_change_enabled:function(t){if(t.get("active")!==!1){var e=this.get_default();e.set({active:!0})}},on_change_width:function(t,e){Upfront.Events.trigger("upfront:layout_size:viewport_width_change",e)},sorted_by_width:function(){return _.sortBy(this.models,function(t){return t.get("width")})},get_active:function(){var t=this.findWhere({active:!0});return _.isUndefined(t)===!1?t:(t=this.get_default(),t.set({active:!0}),t)},get_enabled:function(){var t=this.where({enabled:!0});return _.isUndefined(t)===!1&&t.length>0?t:[this.get_active()]},get_default:function(){var t=this.findWhere({default:!0});if(_.isUndefined(t)&&(t=this.findWhere({id:"desktop"}),t&&t.set({default:!0})),_.isUndefined(t))throw"Breakpoints are not loaded properly.";return t},get_unique_id:function(){for(var t="custom-"+new Date;!_.isUndefined(this.findWhere({id:t}));)t="custom-"+new Date;return t}})})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/breakpoint/storage",["scripts/upfront/upfront-views-editor/breakpoint/collection"],function(e){var i=function(i){var n,o=function(){n=new e(i);var o=n.get_default();o.set({active:!0}),n.on("change:enabled change:width change:name add remove change:typography change:styles",r),_.each(n.models,function(e){var i=t("#"+e.get("id")+"-breakpoint-style");i.length>0||t("body").append('<style id="'+e.get("id")+'-breakpoint-style">'+e.get("styles")+"</style>")})};this.get_breakpoints=function(){return n};var r=function(){var t={action:"upfront_update_breakpoints",breakpoints:n.toJSON()};Upfront.Util.post(t).error(function(){return notifier.addMessage(l10n.breakpoint_save_fail)})};Upfront.Events.once("application:mode:before_switch",o)};return new i(Upfront.mainData.themeInfo.breakpoints)})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/breakpoint/breakpoint-edit-panel",["scripts/upfront/upfront-views-editor/breakpoint/storage"],function(i){return Backbone.View.extend({className:"breakpoint-edit-panel",template:'<div><span class="edit-breakpoint-popup-title">'+e.set_custom_breakpoint+':</span></div><div><label for="breakpoint-name">'+e.name+':</label><input type="text" value="{{ name }}" placeholder="'+e.custom_breakpoint_placeholder+'" id="breakpoint-name" /></div><div><label for="breakpoint-width">'+e.width+':</label><input type="number" min="240" max="1080" value="{{ width }}" id="breakpoint-width" /><label>'+e.px+'</label><label for="breakpoint-columns">'+e.number_of_columns+':</label><input min="5" max="24" type="number" value="{{ columns }}" id="breakpoint-columns" /></div>',events:{"change #breakpoint-name":"on_name_change","change #breakpoint-width":"on_width_change","change #breakpoint-columns":"on_columns_change"},initialize:function(t){this.options=t||{},_.isUndefined(this.model)&&(this.model=i.get_breakpoints().get_active()),this.listenTo(this.model,"change",this.update_values),this.lazy_change_width=_.debounce(function(t){this.model.set({width:t})},500)},render:function(){return this.$el.html(_.template(this.template,this.model.toJSON())),this},update_values:function(){this.$el.find("#breakpoint-name").val(this.model.get("name")),this.$el.find("#breakpoint-width").val(this.model.get("width")),this.$el.find("#breakpoint-columns").val(this.model.get("columns"))},on_name_change:function(e){this.model.set({name:t(e.currentTarget).val()})},on_width_change:function(e){this.lazy_change_width(t(e.currentTarget).val())},on_columns_change:function(e){this.model.set({columns:t(e.currentTarget).val()})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/breakpoint/breakpoint-edit-button",["scripts/upfront/upfront-views-editor/breakpoint/storage","scripts/upfront/upfront-views-editor/breakpoint/breakpoint-edit-panel"],function(i,n){return Backbone.View.extend({className:"breakpoint-edit",events:{"click #edit-breakpoint":"edit_breakpoint"},initialize:function(t){this.options=t||{},this.collection=i.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render)},render:function(){return this.$el.html(""),this.active_breakpoint=this.collection.get_active(),this.active_breakpoint.get("fixed")?this:(this.$el.html('<a href="" id="edit-breakpoint">'+e.edit_breakpoint+"</a>"),this)},edit_breakpoint:function(i){i.preventDefault();var o;o=Upfront.Popup.open(function(i,o,r){o.empty();var s=t(this),a=new n;s.append(a.render().el),r.append('<div class="breakpoint-edit-ok-button">'+e.ok+"</div>"),t("#upfront-popup-close").hide(),t(".breakpoint-edit-ok-button").on("click",function(){Upfront.Popup.close(),t("#upfront-popup-close").show()})},{width:400})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/breakpoint/breakpoint-width-input",["scripts/upfront/upfront-views-editor/breakpoint/storage","scripts/upfront/upfront-views-editor/fields"],function(t,i){return Backbone.View.extend({className:"breakpoint-width-input",initialize:function(e){this.options=e||{},this.collection=t.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render)},render:function(){this.$el.html(""),this.active_breakpoint=this.collection.get_active();var t=_.debounce(this.propagate_change,1e3);return this.active_breakpoint.get("fixed")?this:(this.input=new i.Number({className:"inline-number plaintext-settings",min:1,label:e.viewport_width,suffix:e.px,default_value:this.active_breakpoint.get("width")}),this.input.render(),this.$el.html(this.input.el),this.listenTo(this.input,"changed",t),this)},propagate_change:function(){this.active_breakpoint.set({width:this.input.get_value()})}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/breakpoint/breakpoint-activate-button",[],function(){return Backbone.View.extend({tagName:"li",template:"{{ short_name }} ({{ width }}px)",className:function(){return this.model.get("id")+"-breakpoint-activate"},events:{click:"on_click"},initialize:function(t){this.options=t||{}},render:function(){return this.$el.html(_.template(this.template,this.model.toJSON())),this.model.get("active")&&this.$el.addClass("active"),this},on_click:function(){this.model.set({active:!0}),t(".upfront-region-edit-trigger-small").removeClass("visible")}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/breakpoint/breakpoints-toggler",["scripts/upfront/upfront-views-editor/breakpoint/storage","scripts/upfront/upfront-views-editor/breakpoint/breakpoint-activate-button"],function(t,e){return Backbone.View.extend({tagName:"ul",className:"breakpoints-toggler",initialize:function(){this.collection=t.get_breakpoints(),this.listenTo(this.collection,"add remove change",this.render)},render:function(){return this.$el.html(""),_.each(this.collection.sorted_by_width(),function(t){if(t.get("enabled")!==!1){var i=new e({model:t});this.$el.append(i.render().el)}},this),this}})})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/breakpoint",["scripts/upfront/upfront-views-editor/breakpoint/model","scripts/upfront/upfront-views-editor/breakpoint/collection","scripts/upfront/upfront-views-editor/breakpoint/storage","scripts/upfront/upfront-views-editor/breakpoint/breakpoint-edit-button","scripts/upfront/upfront-views-editor/breakpoint/breakpoint-edit-panel","scripts/upfront/upfront-views-editor/breakpoint/breakpoint-width-input","scripts/upfront/upfront-views-editor/breakpoint/breakpoints-toggler"],function(t,e,i,n,o,r,s){return{Model:t,Collection:e,storage:i,EditButton:n,EditPanel:o,WidthInput:r,Toggler:s}})}(jQuery),function(){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-panel-item",["scripts/upfront/inline-panels/inline-panels"],function(t){return t.Item.extend({initialize:function(){this.on("modal:open",this.on_modal_open,this),this.on("modal:close",this.on_modal_close,this)},on_modal_open:function(){Upfront.Events.trigger("command:region:edit_toggle",!1)},on_modal_close:function(){Upfront.Events.trigger("command:region:edit_toggle",!0)}})})}(),define("text!upfront/templates/region_add_panel.html",[],function(){return'<div class="upfront-add-region-title upfront-settings-title">\r\n\t{{Upfront.Settings.l10n.global.views.create_or_choose_region}}\r\n</div>\r\n<div class="upfront-add-region-choice"></div>\r\n<div class="upfront-add-region-new"></div>\r\n<div class="upfront-add-region-global"></div>\r\n\r\n'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-panel-item-add-region",["scripts/upfront/upfront-views-editor/region/region-panel-item","scripts/upfront/upfront-views-editor/fields","scripts/upfront/upfront-views-editor/modal","text!upfront/templates/region_add_panel.html"],function(i,n,o,r){return i.extend({width:24,height:24,events:{click:"add_region_modal"},className:"upfront-inline-panel-item upfront-region-panel-item-add-region",icon:function(){var t=this.options.to;if(!t.match(/^(top|bottom)-(left|right)$/))return"add add-"+t},tooltip:function(){var t,i=this.options.to;switch(i){case"bottom":t=e.new_region_below;break;case"left":t=e.new_sidebar_region;break;case"right":t=e.new_sidebar_region;break;case"top":t=e.new_region_above;break;case"top-left":case"top-right":case"bottom-left":case"bottom-right":t=e.add_floating_region}return t},tooltip_pos:function(){var t,e=this.options.to;switch(e){case"bottom":t="top";break;case"left":case"top-left":case"bottom-left":t="right";break;case"right":case"top-right":case"bottom-right":t="left";break;case"top":t="bottom"}return t},initialize:function(t){this.options=t,this.options.to||(this.options.to="top"),this.options.width&&(this.width=this.options.width),this.options.height&&(this.height=this.options.height)},add_region_modal:function(t){var i=this.options.to,s=this,a=new o({to:this.panel_view.panels_view.$el,width:500,button:!0,button_text:e.add_region}),l=("left"==i||"right"==i)&&"global"==s.model.get("scope"),p=s.$el.parents(".upfront-region-center");p.addClass("upfront-region-editing-modal"),p.next().find(".upfront-icon-control-region-resize").hide(),fields={from:new n.Radios({name:"from",default_value:"new",layout:"horizontal-inline",values:[{label:e.new_region,value:"new"},{label:e.choose_global_region,value:"global",disabled:l}],change:function(){var t=this.get_value();s.from=t}}),region_title:new n.Text({name:"name",placeholder:e.region_name_placeholder,focus:function(){fields.from.set_value("new"),fields.from.trigger("changed")},change:function(){var t=this.get_value();s.region_title=t}}),make_global:new n.Checkboxes({name:"make_global",multiple:!1,values:[{label:e.make_this_region_global,value:1}],focus:function(){fields.from.set_value("new"),fields.from.trigger("changed")},change:function(){var t=this.get_value();s.make_global=1==t}}),from_region:new n.Select({name:"from_region",values:[{label:Upfront.Settings.l10n.global.behaviors.loading,value:""}],disabled:l,focus:function(){fields.from.set_value("global"),fields.from.trigger("changed")},change:function(){var t=this.get_value();s.from_region=t}})},from_region_values=function(){var t=[],n="top"==i||"bottom"==i,o="left"==i||"right"==i;return t.push({label:e.select_global_region,value:"",disabled:!0}),_.each(Upfront.data.global_regions,function(e){if(!(n&&e.container&&e.name!=e.container||o&&"left"!=e.sub&&"right"!=e.sub)){var i=s.model.collection,r=i.get_by_name(e.name);t.push({label:e.title,value:e.name,disabled:r!==!1})}}),t},a.render(),this.panel_view.panels_view.$el.append(a.$el),this.from="new",this.region_title="",this.make_global=!1,this.from_region="",Upfront.data.global_regions?fields.from_region.options.values=from_region_values():Upfront.Util.post({action:"upfront_list_scoped_regions",scope:"global",storage_key:_upfront_save_storage_key}).done(function(t){Upfront.data.global_regions=t.data,fields.from_region.options.values=from_region_values(),fields.from_region.render(),fields.from_region.delegateEvents()}),a.open(function(t,e){var i=_.template(r,{});_.each(fields,function(t,e){t.render(),t.delegateEvents()}),e.addClass("upfront-add-region-modal"),t.append(i),t.find(".upfront-add-region-choice").append(fields.from.$el),t.find(".upfront-add-region-new").append(fields.region_title.$el),l||t.find(".upfront-add-region-new").append(fields.make_global.$el),t.find(".upfront-add-region-global").append(fields.from_region.$el),this.hide_or_show_resize_controls(!0)},this).done(function(t){"new"!=s.from&&s.from_region?s.add_region_from_global(s.from_region):s.add_region()}).always(function(t){s.hide_or_show_resize_controls(!1),p.removeClass("upfront-region-editing-modal"),p.next().find(".upfront-icon-control-region-resize").show(),t.remove()}),t.stopPropagation()},hide_or_show_resize_controls:function(t){return t?this.$el.parents(".upfront-region-container-active").addClass("upfront-add-region-container-active"):this.$el.parents(".upfront-region-container-active").removeClass("upfront-add-region-container-active")},add_region:function(){var e=this.options.to,i=this.model.collection,n=(i.size()-1,i.indexOf(this.model)),o=this.model.get("position"),r=this.model.get_sub_regions(),s="top"==e||"bottom"==e,a="top"==e||"left"==e,l=this.region_title?this.region_title.replace(/[^A-Za-z0-9\s_-]/g,""):s?"Region ":this.model.get("title")+" "+e.charAt(0).toUpperCase()+e.slice(1),p=l.toLowerCase().replace(/\s/g,"-"),d=!!(i.get_by_name(p)||!this.region_title&&s)&&i.get_new_title(l,1),c=d!==!1?d.title:l,u=d!==!1?d.name:p,h=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:u,container:s?u:this.model.get("name"),title:c})),f={},g=function(t){return t&&t.cid?i.indexOf(t):-1};if(s){h.set_property("row",Upfront.Util.height_to_row(300));var m=_.filter(_.map(r,g),function(t){return t>=0}),v=r.fixed.length>0?_.map(r.fixed,g):[];m=_.union(m,v,[n]),m.length>0&&("top"==e?n=_.min(m):"bottom"==e&&(n=_.max(m))),this.make_global&&h.set({scope:"global"})}else h.set_property("col",5),"left"==e||"right"==e?(h.set("sub",a?"left":"right"),h.set("position",a?o-1:o+1),f.sub=a?"left":"right"):"top-left"!=e&&"top-right"!=e&&"bottom-left"!=e&&"bottom-right"!=e||(h.set("type","fixed"),h.set("sub","fixed"),h.set_property("width",225),h.set_property("height",225),e.match(/^top/)&&h.set_property("top",30),e.match(/^bottom/)&&h.set_property("bottom",30),e.match(/left$/)&&h.set_property("left",30),e.match(/right$/)&&h.set_property("right",30),h.set_property("background_type","color"),h.set_property("background_color","#aeb8c2"),f.sub="fixed"),this.make_global?h.set({scope:"global"}):h.set({scope:this.model.get("scope")});h.get("clip")||!s?(Upfront.Events.once("entity:region:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)):(Upfront.Events.once("entity:region_container:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)),h.add_to(i,a?n:n+1,f);var b=i.where({type:"wide"});b.length>0&&t("div.upfront-regions a#no_region_add_one").remove()},add_region_from_global:function(t){var e=this,i=this.options.to,n=this.model.collection,o=(n.size()-1,n.indexOf(this.model)),r=(this.model.get("position"),this.model.get_sub_regions()),s="top"==i||"bottom"==i,a="top"==i||"left"==i,l=function(t){return t&&t.cid?n.indexOf(t):-1};if(s){var p=_.filter(_.map(r,l),function(t){return t>=0}),d=r.fixed.length>0?_.map(r.fixed,l):[];p=_.union(p,d,[o]),p.length>0&&("top"==i?o=_.min(p):"bottom"==i&&(o=_.max(p)))}s?(Upfront.Events.once("entity:region_container:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)):(Upfront.Events.once("entity:region:before_render",this.before_animation,this),Upfront.Events.once("entity:region:added",this.run_animation,this)),Upfront.Util.post({action:"upfront_get_scoped_regions",scope:"global",name:t,storage_key:_upfront_save_storage_key}).done(function(t){var r=t.data,s=!1,l=[],p=function(){_.each(l,function(t){t.model.add_to(n,t.index,t.options)})};_.each(r,function(t,n){var r=new Upfront.Models.Region(t),p={};r.is_main()?s={model:r,index:a?o:o+1,options:p}:("left"==i||"right"==i?(r.set("container",e.model.get("name")),r.set("sub",a?"left":"right"),p.sub=a?"left":"right"):p.sub=r.get("sub"),l.push({model:r,index:(a?o:o+1)+n,options:p}))}),s!==!1?(Upfront.Events.once("entity:region:added",function(){p()}),s.model.add_to(n,s.index,s.options)):p()})},before_animation:function(t,e){Upfront.Events.trigger("command:region:edit_toggle",!1),Upfront.Events.trigger("command:region:fixed_edit_toggle",!1)},run_animation:function(e,i){function n(){Upfront.Settings.LayoutEditor.Grid.baseline,e.$el.outerHeight();e.$el.removeClass(r),Upfront.Events.trigger("command:region:edit_toggle",!0),Upfront.Events.trigger("command:region:fixed_edit_toggle",!0),e.trigger("activate_region",e)}var o=this.options.to,r="upfront-add-region-ani upfront-add-region-ani-"+o,s=setTimeout(n,500),a="animationstart.region_ani webkitAnimationStart.region_ani MSAnimationStart.region_ani oAnimationStart.region_ani",l="animationend.region_ani webkitAnimationEnd.region_ani MSAnimationEnd.region_ani oAnimationEnd.region_ani";if(e.$el.one(a,function(){clearTimeout(s),e.$el.off(a)}),e.$el.one(l,function(){n(),e.$el.off(l)}),e.$el.addClass(r),"top"==o||"bottom"==o){var p=e.$el.hasClass("upfront-region-container")?e.$el:e.$el.closest(".upfront-region-container"),d=p.offset(),c=t(document).scrollTop(),u=!1,h=p.height(),f=t(window).height();"top"==o&&d.top<c?u=d.top-50:"bottom"==o&&d.top+h>c+f&&(u=d.top+h-f),u!==!1&&t("html,body").animate({scrollTop:u},600)}}})})}(jQuery),function(){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-panel-add",["scripts/upfront/inline-panels/inline-panels","scripts/upfront/upfront-views-editor/region/region-panel-item-add-region"],function(t,e){return t.Panel.extend({initialize:function(t){this.options=t,this.options.to||(this.options.to="bottom");var i=this.options.to,n={model:this.model,to:i};this.options.width&&(n.width=this.options.width),this.options.height&&(n.height=this.options.height),this.items=_([new e(n)]),"top"==i||"bottom"==i?(this.position_v=i,this.position_h="center"):"left"==i||"right"==i?(this.position_v="center",this.position_h=i):"top-left"!=i&&"top-right"!=i&&"bottom-left"!=i&&"bottom-right"!=i||(this.position_v=i.split("-")[0],this.position_h=i.split("-")[1])},items:function(){return _([this.add_region])}})})}(),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-panels",["scripts/upfront/inline-panels/inline-panels","scripts/upfront/upfront-views-editor/region/region-panel-add"],function(i,n){return i.Panels.extend({className:"upfront-inline-panels upfront-region-panels upfront-ui",initialize:function(){this.model.get("container"),this.model.get("name");this.listenTo(this.model.collection,"add",this.render),this.listenTo(this.model.collection,"remove",this.render),this.listenTo(this.model.get("properties"),"change",this.render),this.listenTo(this.model.get("properties"),"add",this.render),this.listenTo(this.model.get("properties"),"remove",this.render),this.listenTo(Upfront.Events,"entity:region:activated",this.on_region_active),this.listenTo(Upfront.Events,"entity:region:deactivated",this.on_region_deactive),this.add_panel_top=new n({model:this.model,to:"top"}),this.add_panel_bottom=new n({model:this.model,to:"bottom"}),this.model.is_main()&&this.model.get("allow_sidebar")&&(this.add_panel_left=new n({model:this.model,to:"left"}),this.add_panel_right=new n({model:this.model,to:"right"}))},panels:function(){var t=_([]),e=this.model.collection;if(_.isUndefined(e))return this._panels=t,t;var i=e.index_container(this.model,["shadow","lightbox"]),n=(e.total_container(["shadow","lightbox"]),0==i),o="full"==this.model.get("type");if(this.model.is_main()){var r=this.model.get_sub_regions();o&&n||t.push(this.add_panel_top),this.model.get("allow_sidebar")&&(r.left===!1&&t.push(this.add_panel_left),r.right===!1&&t.push(this.add_panel_right)),t.push(this.add_panel_bottom)}return this._panels=t,t;
},on_render:function(){this.update_pos()},on_scroll:function(t){var e=t.data;e.update_pos()},on_region_active:function(e){if(e.model==this.model){var i=t(Upfront.Settings.LayoutEditor.Selectors.main);i.hasClass("upfront-region-editing")&&(this.on_active(),this.listenToOnce(Upfront.Events,"sidebar:toggle:done",this.update_pos),t(window).on("scroll",this,this.on_scroll))}},on_region_deactive:function(){t(window).off("scroll",this,this.on_scroll)},update_pos:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main),i=this.$el.closest(".upfront-region-container"),n=this.$el.closest(".upfront-region"),o=i.find(".upfront-region-side-top"),r=i.find(".upfront-region-side-bottom");if((e.hasClass("upfront-region-editing")||e.hasClass("upfront-region-fixed-editing")||e.hasClass("upfront-region-lightbox-editing"))&&i.hasClass("upfront-region-container-active")){var s=this,a=n.offset(),l=a.top,p=l+n.outerHeight(),d=o.length?o.outerHeight():0,c=r.length?r.outerHeight():0,u=t(window).height(),h=t(document).scrollTop(),f=h+u-c,_=e.offset().top+d;this.add_responsive_items(),this._panels.each(function(e){var i=e.$el.offset();if("top"==e.position_v&&h>l-_&&h<p-_)"fixed"!=e.$el.css("position")&&e.$el.css({position:"fixed",top:_,left:i.left,right:"auto"});else if("bottom"==e.position_v&&p>f&&l<f)"fixed"!=e.$el.css("position")&&e.$el.css({position:"fixed",bottom:c,left:i.left,right:"auto"});else if("center"==e.position_v&&(h>l-_||p>f)){var n=h>l-_?_:l-h,o=p>f?0:f-p,r="left"==e.position_h?i.left:"auto",s="right"==e.position_h?t(window).width()-i.left-e.$el.width():"auto";"fixed"!=e.$el.css("position")?e.$el.css({position:"fixed",top:n,bottom:o,left:r,right:s}):e.$el.css({top:n,bottom:o})}else e.$el.css({position:"",top:"",bottom:"",left:"",right:""})}),setTimeout(function(){s.update_padding()},300)}},update_padding:function(){var t={},e=this.$el.closest(".upfront-region");this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")});var i,n,o=("undefined"!=typeof Upfront.Settings.LayoutEditor.Theme.breakpoints?Upfront.Settings.LayoutEditor.Theme.breakpoints:[],"undefined"!=typeof Upfront.Settings.LayoutEditor.CurrentBreakpoint?Upfront.Settings.LayoutEditor.CurrentBreakpoint:"desktop"),r="default"===o?o:o.id,s="undefined"!=typeof t.breakpoint&&"undefined"!=typeof t.breakpoint[r]&&t.breakpoint[r];i="undefined"!=typeof s.top_bg_padding_num?s.top_bg_padding_num:"undefined"!=typeof t.top_bg_padding_num&&t.top_bg_padding_num,n="undefined"!=typeof s.bottom_bg_padding_num?s.bottom_bg_padding_num:"undefined"!=typeof t.bottom_bg_padding_num&&t.bottom_bg_padding_num,e.css({"padding-top":!1===i?"":i+"px","padding-bottom":!1===n?"":n+"px"})},add_responsive_items:function(){var i=this,n=i.$el.parents(".upfront-region"),o=i.model.get_sub_regions(),r=t('<span class="open-responsive-item-controls"></span>'),s=t('<div class="responsive-item-controls">'+e.add_region+"</div>"),a=t('<div class="responsive-item-control responsive-add-region-top">'+e.above+"</div>"),l=t('<div class="responsive-item-control responsive-add-region-bottom">'+e.below+"</div>"),p=t('<div class="responsive-item-control responsive-add-region-left">'+e.left_sidebar+"</div>"),d=t('<div class="responsive-item-control responsive-add-region-right">'+e.right_sidebar+"</div>");0===n.find(".open-responsive-item-controls").length&&(r.click(function(){n.toggleClass("controls-visible")}),n.append(r)),a.click(function(){i.add_panel_top.$el.find(".upfront-icon").trigger("click"),n.toggleClass("controls-visible")}),s.append(a),l.click(function(){i.add_panel_bottom.$el.find(".upfront-icon").trigger("click"),n.toggleClass("controls-visible")}),s.append(l),i.model.is_main()&&this.model.get("allow_sidebar")&&(o.left===!1&&(p.click(function(){i.add_panel_left.$el.find(".upfront-icon").trigger("click"),n.toggleClass("controls-visible")}),s.append(p)),o.right===!1&&(d.click(function(){i.add_panel_right.$el.find(".upfront-icon").trigger("click"),n.toggleClass("controls-visible")}),s.append(d))),n.find(".responsive-item-controls").remove(),n.append(s)},remove:function(){this.add_panel_top.remove(),this.add_panel_bottom.remove(),this.edit_panel=!1,this.delete_panel=!1,this.add_panel_top=!1,this.add_panel_bottom=!1,this.model.is_main()&&this.model.get("allow_sidebar")&&(this.add_panel_left.remove(),this.add_panel_right.remove(),this.add_panel_left=!1,this.add_panel_right=!1),t(window).off("scroll",this,this.on_scroll),Backbone.View.prototype.remove.call(this)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-panel-item-bg-setting",["scripts/upfront/upfront-views-editor/region/region-panel-item"],function(i){return i.extend({events:{"click .upfront-icon":"open_bg_setting"},className:"upfront-inline-panel-item upfront-region-panel-item-bg",icon:function(){return this._active?"bg-setting-active":"bg-setting"},tooltip:e.change_background,_active:!1,open_bg_setting:function(){var e=this.model.get_property_value_by_name("background_type");e||this.model.get_property_value_by_name("background_image")&&this.model.set_property("background_type","image"),this._active=!0,this.render_icon(),this.open_modal(this.render_modal,!0).always(t.proxy(this.on_close_modal,this)).fail(t.proxy(this.notify,this))}})})}(jQuery),function(){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-panel-item-expand-lock",["scripts/upfront/upfront-views-editor/region/region-panel-item"],function(e){return e.extend({events:{"click .upfront-icon":"toggle_lock"},className:"upfront-inline-panel-item upfront-region-panel-item-expand-lock",icon:function(){var t=this.model.get_property_value_by_name("expand_lock");return t?"expand-lock":"expand-unlock"},tooltip:function(){var e=this.model.get_property_value_by_name("expand_lock"),i='<span class="'+(e?"expand-lock-active":"expand-lock-inactive")+'">'+(e?t.off:t.on)+"</span>";return t.autoexpand.replace(/%s/,i)},toggle_lock:function(){var t=this.model.get_property_value_by_name("expand_lock");this.model.set_property("expand_lock",!t),this.render_icon(),this.render_tooltip()}})})}(),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-fixed-edit-position",[],function(){return Backbone.View.extend({className:"upfront-region-fixed-edit-pos",initialize:function(){},render:function(){var t=this,i=Upfront.Settings.LayoutEditor.Grid,n=this.model.get_property_value_by_name("top"),o="number"==typeof n,r=this.model.get_property_value_by_name("left"),s="number"==typeof r,a=this.model.get_property_value_by_name("bottom"),l="number"==typeof a,p=this.model.get_property_value_by_name("right"),d="number"==typeof p;this.fields={width:new Upfront.Views.Editor.Field.Number({model:this.model,property:"width",label:e.width,label_style:"inline",min:3*i.column_width,max:Math.floor(i.size/2)*i.column_width}),height:new Upfront.Views.Editor.Field.Number({model:this.model,property:"height",label:e.height,label_style:"inline",min:3*i.baseline})},o||!l?this.fields.top=new Upfront.Views.Editor.Field.Number({model:this.model,property:"top",label:e.top,label_style:"inline",min:0}):this.fields.bottom=new Upfront.Views.Editor.Field.Number({model:this.model,property:"bottom",label:e.bottom,label_style:"inline",min:0}),s||!d?this.fields.left=new Upfront.Views.Editor.Field.Number({model:this.model,property:"left",label:e.left,label_style:"inline",min:0}):this.fields.right=new Upfront.Views.Editor.Field.Number({model:this.model,property:"right",label:e.right,label_style:"inline",min:0}),_.each(this.fields,function(e){e.render(),e.delegateEvents(),t.$el.append(e.$el)})},update_fields:function(){_.each(this.fields,function(t){var e=t.get_saved_value();t.set_value(e)})}})})}(jQuery),function(){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-fixed-panels",["scripts/upfront/upfront-views-editor/region/region-panels","scripts/upfront/upfront-views-editor/region/region-panel-add"],function(t,e){return t.extend({className:"upfront-inline-panels upfront-region-fixed-panels upfront-ui",initialize:function(){this.model.get("container"),this.model.get("name");this.listenTo(this.model.collection,"add",this.render),this.listenTo(this.model.collection,"remove",this.render),this.listenTo(Upfront.Events,"entity:region:activated",this.on_region_active),this.listenTo(Upfront.Events,"entity:region:deactivated",this.on_region_deactive),this.add_panel_top_left=new e({model:this.model,to:"top-left",width:50,height:50}),this.add_panel_top_right=new e({model:this.model,to:"top-right",width:50,height:50}),this.add_panel_bottom_left=new e({model:this.model,to:"bottom-left",width:50,height:50}),this.add_panel_bottom_right=new e({model:this.model,to:"bottom-right",width:50,height:50})},panels:function(){var t=_([]);return t.push(this.add_panel_top_left),t.push(this.add_panel_top_right),t.push(this.add_panel_bottom_left),t.push(this.add_panel_bottom_right),this._panels=t,t},on_region_active:function(t){if(t.model==this.model){var e=$(Upfront.Settings.LayoutEditor.Selectors.main);e.hasClass("upfront-region-fixed-editing")&&(this.on_active(),this.listenToOnce(Upfront.Events,"sidebar:toggle:done",this.update_pos),$(window).on("scroll",this,this.on_scroll))}},remove:function(){this.add_panel_top_left.remove(),this.add_panel_top_right.remove(),this.add_panel_bottom_left.remove(),this.add_panel_bottom_right.remove(),this.add_panel_top_left=!1,this.add_panel_top_right=!1,this.add_panel_bottom_left=!1,this.add_panel_bottom_right=!1,Backbone.View.prototype.remove.call(this)}})})}(jQuery),define("text!upfront/templates/region_edit_panel.html",[],function(){return'<div>\r\n<!--\r\n\tWrap everything in a div to convert this file\'s content in a jquery element\r\n\tso it is possible to use $.find.\r\n-->\r\n<script type="text/template" id="upfront-region-bg-setting">\r\n\t<div class="upfront-region-bg-setting-header clearfix">\r\n\t\t<div class="upfront-region-bg-setting-name"></div>\r\n\t</div>\r\n\t<div class="uf-region-bg-settings-panel-content ">\r\n\t\t<div class="upfront-region-bg-setting-region-style-container">\r\n\t\t\t<div class="upfront-region-bg-setting-region-type">\r\n\t\t\t\t<!-- <div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.area_type}}</div> -->\r\n\t\t\t</div>\r\n\t\t\t<div class="upfront-region-bg-setting-auto-resize"></div>\r\n\t\t</div>\r\n\t\t<div class="upfront-region-bg-setting-region-behavior">\r\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.element_behavior}}</div>\r\n\t\t</div>\r\n\t\t<div class="upfront-region-bg-setting-region-nav">\r\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.add_sub_region}}</div>\r\n\t\t</div>\r\n\r\n\t\t<div class="upfront-bg-setting-type">\r\n\t\t\t<div>\r\n\t\t\t\t<span class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.bg_type}}</span>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-color"></div>\r\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-image"></div>\r\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-featured"></div>\r\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-slider"></div>\r\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-map"></div>\r\n\t\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-video"></div>\r\n\t\t<div class="upfront-region-bg-setting-footer clearfix">\r\n\t\t\t<div class="upfront-region-bg-setting-sticky"></div>\r\n\t\t\t<div class="upfront-region-bg-setting-edit-css upfront-icon upfront-icon-edit-css">\r\n\t\t\t\t<span>{{Upfront.Settings.l10n.global.views.edit_region_css}}</span>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="uf-settings-panel upfront-settings_panel advanced-settings uf-settings-panel">\r\n\t\t<div class="uf-settings-panel__title">{{Upfront.Settings.l10n.global.views.advanced_settings}}</div>\r\n\t\t<div class="uf-settings-panel__body" style="display: none;">\r\n\t\t\t<div class="upfront-region-bg-setting-padding"></div>\r\n\t\t</div>\r\n\t</div>\r\n\t<button class="upfront-inline-modal-cancel">{{Upfront.Settings.l10n.global.content.cancel}}</button>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-fixed">\r\n\t<div class="upfront-region-bg-setting-header clearfix">\r\n\t\t<div class="upfront-region-bg-setting-name"></div>\r\n\t</div>\r\n\r\n\t<div class="upfront-region-bg-setting-fixed-region clearfix">\r\n\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.floating_region_settings}}:</div>\r\n\t</div>\r\n\r\n\t<div class="upfront-bg-setting-type">\r\n\t\t<div>\r\n\t\t\t<span class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.bg_type}}</span>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-color"></div>\r\n\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-image"></div>\r\n\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-featured"></div>\r\n\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-slider"></div>\r\n\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-map"></div>\r\n\t<div class="upfront-bg-setting-tab upfront-bg-setting-tab-video"></div>\r\n\r\n\t<div class="upfront-region-bg-setting-padding"></div>\r\n\t<div class="upfront-region-bg-setting-footer clearfix">\r\n\t\t<div class="upfront-region-bg-setting-floating-restrict"></div>\r\n\t\t<div class="upfront-region-bg-setting-edit-css upfront-icon upfront-icon-edit-css">\r\n\t\t\t<span>{{Upfront.Settings.l10n.global.views.edit_region_css}}</span>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-lightbox">\r\n\t<div class="upfront-region-bg-setting-header clearfix">\r\n\t\t<div class="upfront-region-bg-setting-name"></div>\r\n\t</div>\r\n\r\n\t<div class="upfront-region-bg-setting-lightbox-region clearfix"></div>\r\n\r\n\t<div class="upfront-region-bg-setting-padding"></div>\r\n\t<div class="upfront-region-bg-setting-footer clearfix">\r\n\t\t<div class="upfront-region-bg-setting-edit-css upfront-icon upfront-icon-edit-css">\r\n\t\t\t<span>{{Upfront.Settings.l10n.global.views.edit_region_css}}</span>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-name">\r\n\t<div class="upfront-region-bg-setting-name-wrap">\r\n\t\t<span class="upfront-region-type-icon"></span>\r\n\t\t<span class="upfront-region-name-edit-value"></span>\r\n\t\t<span class="upfront-region-bg-setting-is-global">{{Upfront.Settings.l10n.global.views.global.toUpperCase()}}</span>\r\n\t\t<a href="#" class="upfront-region-name-edit-trigger">{{Upfront.Settings.l10n.global.views.edit}}</a>\r\n\t</div>\r\n\t<div class="upfront-region-bg-setting-name-edit"></div>\r\n</script>\r\n\r\n<script type="text/template" id="upfront-region-bg-setting-padding">\r\n\t<span class="upfront-settings-item-title">\r\n\t\t{{Upfront.Settings.l10n.global.views.customize_padding.toUpperCase()}}\r\n\t</span>\r\n\t<div class="upfront-region-bg-setting-padding-type"></div>\r\n\t<div class="upfront-region-bg-setting-equal-padding"></div>\r\n\t<div class="upfront-region-bg-setting-varied-padding">\r\n\t\t<div class="upfront-region-bg-setting-padding-top">\r\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.top_padding}}</div>\r\n\t\t</div>\r\n\t\t<div class="upfront-region-bg-setting-padding-bottom">\r\n\t\t\t<div class="upfront-bg-setting-label">{{Upfront.Settings.l10n.global.views.bottom_padding}}</div>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n\r\n\r\n</div>\r\n'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-bg-setting",["scripts/upfront/upfront-views-editor/modal-bg-setting","scripts/upfront/upfront-views-editor/fields","text!upfront/templates/region_edit_panel.html","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n,o,r){return i.extend({events:{"click .upfront-inline-modal-cancel":"on_click_cancel","click .upfront-inline-modal-content":"on_click_content","click .uf-settings-panel__title":"toggle_advanced_settings","click .upfront-inline-modal-save":"on_click_save"},reset_models:function(){if("undefined"!=typeof this.oldData){var t=this.model.get("properties").models,e=this.oldData;this.revert_models_to_previous(t,e)}},revert_models_to_previous:function(t,e){t.map(function(t,i){var n=e[i];n&&"undefined"!=typeof n.name&&(t.set("name",n.name),t.set("value",n.value))})},save_current_models:function(){var t=[],e=this.model.get("properties").models;e.map(function(e){t.push(_.clone(e.attributes))}),this.oldData=t},render_modal:function(e,i){var n=this.get_template(),o=n();e.find(".upfront-region-bg-setting-tab-primary, .upfront-region-bg-setting-tab-secondary").children().detach(),e.html(o),i.addClass("upfront-region-modal-bg"),this.render_header_settings(e.find(".upfront-region-bg-setting-header")),this.render_main_settings(e),this.render_footer_settings(e.find(".upfront-region-bg-setting-footer")),this.render_bg_type_settings(e),this.render_padding_settings(e.find(".upfront-region-bg-setting-padding"));var s=this.$el.find(".uf-region-bg-settings-panel-content");s=s[0]||!1,s&&(this.set_settings_content_max_height(),r.withDebounceUpdate(s,!0,"region:background:type:changed",!0),Upfront.Events.on("color:spectrum:show",function(){t(s).css("position","initial")}),Upfront.Events.on("color:spectrum:hide",function(){t(s).css("position","relative")})),"region-settings-sidebar"===this.$el.parent().attr("id")&&(t("#sidebar-ui").addClass("region-settings-activated"),this.save_current_models())},set_settings_content_max_height:function(){var t=this.$el.height(),e=this.$el.find(".upfront-region-bg-setting-header").first().outerHeight(!0),i=this.$el.find(".upfront-settings_panel.advanced-settings").first().outerHeight(!0);this.$el.find(".uf-region-bg-settings-panel-content").css("max-height",t-e-i-70+"px")},close:function(e){return t("#sidebar-ui").removeClass("region-settings-activated"),i.prototype.close.call(this,e)},get_template:function(){var e=t(o);return _.template(e.find("#upfront-region-bg-setting").html())},get_bg_types:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=this.model.get_property_value_by_name("background_type"),n=[{label:e.solid_color,value:"color",icon:"color"},{label:e.image,value:"image",icon:"image"},{label:e.video,value:"video",icon:"video"},{label:e.image_slider,value:"slider",icon:"slider"},{label:e.map,value:"map",icon:"map"}];return t&&!t.default&&n.unshift({label:e.inherit,value:"",icon:i?i:"color"}),(_upfront_post_data.post_id||!0===Upfront.plugins.isRequiredByPlugin("show feature image region type")&&Upfront.Application.is_single())&&(Upfront.Application.is_single("404_page")||n.push({label:e.featured_image,value:"featured",icon:"feat"})),n},get_region_types:function(t){var i=[{label:e.full_width,value:"wide"},{label:e.contained,value:"clip"}];return t>0?i:_.union([{label:e.full_screen,value:"full"}],i)},render_header_settings:function(i){var r=this,s=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),a=s&&!s.default,l=!this.model.is_main()&&this.model.get("sub"),p=t(o),d=_.template(p.find("#upfront-region-bg-setting-name").html()),c=new n.Text({model:this.model,name:"title",placeholder:e.region_name_placeholder,compact:!0,change:function(){},blur:function(){var e,i,n,o=this.model.collection,s=this.model.get("title"),a=(this.model.get("name"),t.trim(this.get_value().replace(/[^A-Za-z0-9\s_-]/g,""))),l=a.toLowerCase().replace(/\s/g,"-");s!=a&&(o.get_by_name(l)&&(e=o.get_new_title(a+" ",2),a=e.title,l=e.name),n=r.get_region_css_styles(this.model),this.model.is_main()?(i=this.model.get_sub_regions(),_.each(i,function(t,e){_.isArray(t)?_.each(t,function(t){t.set({container:l},{silent:!0})}):_.isObject(t)&&t.set({container:l},{silent:!0})}),this.model.set({title:a,name:l,container:l},{silent:!0})):this.model.set({title:a,name:l},{silent:!0}),g.find(".upfront-region-name-edit-value").text(a),r.set_region_css_styles(this.model,n.styles,n.selector),this.model.get("properties").trigger("change"))},rendered:function(){var t=this;this.get_field().on("keyup",function(e){13===e.which&&t.trigger("blur")})}}),u=new n.Button({model:this.model,name:"scope",classname:"upfront-region-bg-setting-globalize",label:e.make_global,compact:!0,on_click:function(){r.apply_region_scope(this.model,"global"),m.show(),g.find(".upfront-region-bg-setting-is-global").show(),h.$el.show(),this.$el.hide()}}),h=new n.Button({model:this.model,name:"localize",label:e.localize_region,classname:"upfront-region-bg-setting-localize",compact:!0,on_click:function(){r.apply_region_scope(this.model,"local"),m.show(),g.find(".upfront-region-bg-setting-is-global").hide(),u.$el.show(),this.$el.hide()},rendered:function(){this.$el.attr("title",e.localize_region_info)}}),f=new n.Button({model:this.model,name:"save",label:e.ok.toLowerCase(),compact:!0,classname:"upfront-region-bg-setting-name-save",on_click:function(){g.find(".upfront-region-bg-setting-name-wrap").show(),m.show(),g.find(".upfront-region-bg-setting-name-edit").hide(),r.toggle_editable_region_panels(!0),"global"==this.model.get("scope")?(u.$el.hide(),h._no_display||h.$el.show()):u.$el.show()}}),g=i.find(".upfront-region-bg-setting-name"),m=i.parent().find(".upfront-region-bg-setting-auto-resize");if(a)return void i.hide();if(g.append(d()),c.render(),u.render(),h.render(),f.render(),g.find(".upfront-region-bg-setting-name-edit").append([c.$el,u.$el,h.$el,f.$el]).hide(),g.find(".upfront-region-name-edit-value").text(this.model.get("title")),"global"==this.model.get("scope")){if(g.find(".upfront-region-bg-setting-is-global").show(),u.$el.hide(),!this.model.is_main()&&l){var v=this.model.collection.get_by_name(this.model.get("container"));v&&"global"==v.get("scope")&&(h.$el.hide(),h._no_display=!0)}}else g.find(".upfront-region-bg-setting-is-global").hide(),h.$el.hide();g.on("click",".upfront-region-name-edit-trigger",function(t){t.preventDefault(),g.find(".upfront-region-bg-setting-name-wrap").hide(),m.hide(),r.toggle_editable_region_panels(!1),g.find(".upfront-region-bg-setting-name-edit").show(),"global"!=r.model.get("scope")?c.get_field().prop("disabled",!1).trigger("focus").select():c.get_field().prop("disabled",!0)}),this.model.is_main()?(m.on("click",function(e){e.preventDefault(),e.stopPropagation(),r.trigger_expand_lock(t(this))}),this.render_expand_lock(m)):m.hide()},toggle_editable_region_panels:function(e){return e?t(".upfront-bg-setting-type, .upfront-region-bg-setting-region-style-container, .upfront-region-bg-setting-footer, .upfront-bg-setting-tab, .upfront-region-bg-setting-padding").css({pointerEvents:"auto",opacity:1}):t(".upfront-bg-setting-type, .upfront-region-bg-setting-region-style-container, .upfront-region-bg-setting-footer, .upfront-bg-setting-tab, .upfront-region-bg-setting-padding").css({pointerEvents:"none",opacity:.5})},render_main_settings:function(t){var i=this,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),r=o&&!o.default,s=this.model.collection,a=s.indexOf(this.model),l=s.index_container(this.model,["shadow","lightbox"]),p=(s.total_container(["shadow","lightbox"]),new n.Select({model:this.model,name:"type",default_value:"wide",label:e.region_style,layout:"horizontal-inline",values:this.get_region_types(l),change:function(){var t=this.get_value();this.model.set({type:t},{silent:!0}),"full"==t?(f.show(),g.show(),this.model.set({sticky:0},{silent:!0})):(f.hide(),g.hide()),this.model.get("properties").trigger("change"),i.update_pos(),Upfront.Events.trigger("command:region:edit_toggle",!1),Upfront.Events.trigger("command:region:edit_toggle",!0)}})),d=this.model.get_property_value_by_name("nav_region"),c=new n.Checkboxes({model:this.model,property:"sub_regions",default_value:this.model.get_property_value_by_name("sub_regions")?[]:[d],layout:"horizontal-inline",multiple:!0,values:[{label:e.top,value:"top"},{label:e.bottom,value:"bottom"}],change:function(){var t=this.get_value(),e=i.model.get_sub_regions(),n=!1;a=s.indexOf(i.model),!_.contains(t,"top")&&e.top&&(n=Upfront.Util.model_to_json(e.top),i._sub_region_top_copy=new Upfront.Models.Region(n),s.remove(e.top)),!_.contains(t,"bottom")&&e.bottom&&(n=Upfront.Util.model_to_json(e.bottom),i._sub_region_bottom_copy=new Upfront.Models.Region(n),s.remove(e.bottom)),_.each(t,function(t){if(!e[t]){var n=!1,o=!1;if("bottom"==t?(i._sub_region_bottom_copy&&(o=i._sub_region_bottom_copy),n=e.right?a+2:a+1):"top"==t&&(i._sub_region_top_copy&&(o=i._sub_region_top_copy),n=e.left?a-1:a),n!==!1){var r=i.model.get("name")+"_"+t,l=i.model.get("title")+" "+t;o===!1&&(o=new Upfront.Models.Region(_.extend(_.clone(Upfront.data.region_default_args),{name:r,title:l,container:i.model.get("name"),sub:t,scope:i.model.get("scope")}))),o.add_to(s,n,{sub:t}),Upfront.Events.trigger("command:region:edit_toggle",!0)}}}),this.property.set({value:t})}}),u=new n.Radios({model:this.model,name:"behavior",default_value:"keep-position",layout:"horizontal-inline",values:[{label:e.keep_position,value:"keep-position"},{label:e.keep_ratio,value:"keep-ratio"}],change:function(){var t=this.get_value();this.model.set({behavior:t},{silent:!0}),this.model.get("properties").trigger("change")}}),h=t.find(".upfront-region-bg-setting-region-type"),f=t.find(".upfront-region-bg-setting-region-nav"),g=t.find(".upfront-region-bg-setting-region-behavior");!r&&this.model.is_main()?(p.render(),h.append(p.$el),c.render(),f.append(c.$el),u.render(),g.append(u.$el)):(h.hide(),f.hide(),g.hide()),this.model.is_main()&&(this.listenTo(p,"changed",function(){i.render_expand_lock(t.find(".upfront-region-bg-setting-auto-resize"))}),r||p.trigger("changed"))},render_footer_settings:function(t){var e=this,i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=i&&!i.default,o=!this.model.is_main()&&this.model.get("sub"),r=t.find(".upfront-region-bg-setting-sticky");n||!this.model.is_main()&&"top"!=o&&"bottom"!=o?r.hide():this.render_sticky_settings(r),t.find(".upfront-region-bg-setting-edit-css").on("click",function(t){t.preventDefault(),t.stopPropagation(),e.trigger_edit_css()})},render_sticky_settings:function(t){var i=this.model.collection,o=i.findWhere({sticky:"1"}),r=new n.Checkboxes({model:this.model,name:"sticky",default_value:"",layout:"horizontal-inline",values:[{label:e.sticky_region+":",value:"1"}],change:function(){var t=this.get_value();this.model.set({sticky:t},{silent:!0}),this.model.get("properties").trigger("change")},multiple:!1});!o&&this.for_view.$el.height()<=300||this.model.get("sticky")?(r.render(),r.$el.find("label").append('<span class="upfront-bg-setting-sticky-toggle"></span>'),t.append(r.$el)):t.hide()},render_padding_settings:function(i){var r,s,a,l,p=t(o),d=_.template(p.find("#upfront-region-bg-setting-padding").html()),c=new n.Checkboxes({model:this.model,use_breakpoint_property:!0,property:"bg_padding_type",label:"",values:[{label:" ",value:"varied"},{label:e.equal_padding,value:"equal"}],multiple:!1,default_value:this.model.get_breakpoint_property_value("bg_padding_type")||"equal",change:function(){this.model.set_breakpoint_property("bg_padding_type",this.get_value())},show:function(e,n){"varied"===e?(t(".upfront-region-bg-setting-padding-top",i).show(),t(".upfront-region-bg-setting-padding-bottom",i).show(),t(".upfront-region-bg-setting-equal-padding",i).hide()):(t(".upfront-region-bg-setting-equal-padding",i).show(),t(".upfront-region-bg-setting-padding-top",i).hide(),t(".upfront-region-bg-setting-padding-bottom",i).hide())}}),u=new n.Number({model:this.model,use_breakpoint_property:!0,property:"top_bg_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("top_bg_padding_num")||0,prefix:e.bottom_padding,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("top_bg_padding_num",t)}}),h=new n.Number({model:this.model,use_breakpoint_property:!0,property:"bottom_bg_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bottom_bg_padding_num")||0,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("bottom_bg_padding_num",t)}}),f=new n.Number({model:this.model,use_breakpoint_property:!0,property:"bg_padding_num",label:"",default_value:this.model.get_breakpoint_property_value("bg_padding_num")||0,suffix:e.px,min:0,step:5,change:function(){var t=this.get_value();this.model.set_breakpoint_property("bg_padding_num",t),u.get_field().val(t),h.get_field().val(t),this.model.set_breakpoint_property("top_bg_padding_num",t,!0),this.model.set_breakpoint_property("bottom_bg_padding_num",t,!0)}});i.append(d()),r=i.find(".upfront-region-bg-setting-padding-type"),s=i.find(".upfront-region-bg-setting-equal-padding"),a=i.find(".upfront-region-bg-setting-padding-top"),l=i.find(".upfront-region-bg-setting-padding-bottom"),"varied"===this.model.get_breakpoint_property_value("bg_padding_type")?s.hide():(a.hide(),l.hide()),c.render(),r.append(c.$el),u.render(),a.append(u.$el),h.render(),l.append(h.$el),f.render(),s.append(f.$el)},apply_region_scope:function(t,e,i,n){var o,r=this,s=t.get_sub_regions(),a=t.get("title"),l=t.get("name"),p=function(t){var o=r.get_region_css_styles(t);if(t.set({scope:e},{silent:!0}),i&&l!=i){var s=new RegExp("^"+a,"i"),p=new RegExp("^"+l,"i"),d=t.get("title").replace(s,n),c=t.get("name").replace(p,i);t.set({container:i,title:d,name:c},{silent:!0})}r.set_region_css_styles(t,o.styles,o.selector),t.get("properties").trigger("change")};t.is_main()&&_.each(s,function(t){_.isArray(t)?_.each(t,function(t){p(t)}):t&&p(t)}),o=r.get_region_css_styles(t),t.set({scope:e},{silent:!0}),i&&l!=i&&t.set({title:n,name:i,container:i},{silent:!0}),r.set_region_css_styles(t,o.styles,o.selector),t.get("properties").trigger("change")},get_region_css_styles:function(e){return Upfront.Application.cssEditor.init({model:e,type:e.is_main()?"RegionContainer":"Region",element_id:e.is_main()?"region-container-"+e.get("name"):"region-"+e.get("name"),no_render:!0}),{styles:t.trim(Upfront.Application.cssEditor.get_style_element().html()),selector:Upfront.Application.cssEditor.get_css_selector()}},set_region_css_styles:function(t,e,i){e&&(Upfront.Application.cssEditor.init({model:t,type:t.is_main()?"RegionContainer":"Region",element_id:t.is_main()?"region-container-"+t.get("name"):"region-"+t.get("name"),no_stylename_fallback:!0,no_render:!0}),selector=Upfront.Application.cssEditor.get_css_selector(),i!=selector&&(e=e.replace(new RegExp(i.replace(/^\./,"."),"g"),selector)),Upfront.Application.cssEditor.get_style_element().html(e),Upfront.Application.cssEditor.saveCall(!1))},render_expand_lock:function(i){var n=this.model.get_breakpoint_property_value("expand_lock",!0),o=this.model.get("type"),r=t("<span />");"full"==o?(i.addClass("upfront-region-bg-setting-auto-resize-disabled"),i.attr("title",e.auto_resize_disabled_title)):(i.removeClass("upfront-region-bg-setting-auto-resize-disabled"),i.removeAttr("title")),n?r.addClass("auto-resize-off"):r.addClass("auto-resize-on"),i.html(""),i.append("<span>"+e.auto_resize+"</span>"),i.append(r)},trigger_expand_lock:function(t){if(!t.hasClass("upfront-region-bg-setting-auto-resize-disabled")){var e=this.model.get_breakpoint_property_value("expand_lock");this.model.set_breakpoint_property("expand_lock",!e),
this.render_expand_lock(t)}},trigger_edit_css:function(){Upfront.Application.cssEditor.init({model:this.model,type:this.model.is_main()?"RegionContainer":"lightbox"==this.model.get("type")?"RegionLightbox":"Region",element_id:this.model.is_main()?"region-container-"+this.model.get("name"):"region-"+this.model.get("name")}),this.listenTo(Upfront.Application.cssEditor,"updateStyles",this.adjust_grid_padding)},toggle_advanced_settings:function(){this.$el.find(".advanced-settings").hasClass("uf-settings-panel--expanded")?this.$el.find(".advanced-settings").removeClass("uf-settings-panel--expanded").find(".uf-settings-panel__body").hide():this.$el.find(".advanced-settings").addClass("uf-settings-panel--expanded").find(".uf-settings-panel__body").show(),this.set_settings_content_max_height()},on_click_cancel:function(){return this.reset_models(),this.close(!1)},adjust_grid_padding:function(){var t=new Upfront.Views.Editor.Command_ToggleGrid;t.update_grid()}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-bg-setting-fixed",["scripts/upfront/upfront-views-editor/region/region-bg-setting","scripts/upfront/upfront-views-editor/fields","text!upfront/templates/region_edit_panel.html"],function(i,n,o){return i.extend({get_template:function(){var e=t(o);return _.template(e.find("#upfront-region-bg-setting-fixed").html())},render_main_settings:function(t){var i=new n.Checkboxes({model:this.model,name:"restrict_to_container",default_value:"",layout:"horizontal-inline",values:[{label:e.restrict_to_parent,value:"1"}],change:function(){var t=this.get_value();this.model.set({restrict_to_container:t},{silent:!0}),this.model.trigger("restrict_to_container",t),this.model.get("properties").trigger("change")},multiple:!1});this.render_fixed_settings(t.find(".upfront-region-bg-setting-fixed-region")),i.render(),t.find(".upfront-region-bg-setting-floating-restrict").append(i.$el),this.$el.addClass("upfront-modal-bg-settings-fixed")},render_fixed_settings:function(t){var i=Upfront.Settings.LayoutEditor.Grid,n=this.model.get_property_value_by_name("top"),o="number"==typeof n,r=this.model.get_property_value_by_name("left"),s="number"==typeof r,a=this.model.get_property_value_by_name("bottom"),l="number"==typeof a,p=this.model.get_property_value_by_name("right"),d="number"==typeof p,c=function(){var t=this.get_value(),e=this.get_saved_value();if(t!=e){switch(this.options.property){case"top":this.model.remove_property("bottom",!0);break;case"bottom":this.model.remove_property("top",!0);break;case"left":this.model.remove_property("right",!0);break;case"right":this.model.remove_property("left",!0)}this.property.set({value:parseInt(t,10)})}},u={width:new Upfront.Views.Editor.Field.Number({model:this.model,property:"width",label:e.width+":",label_style:"inline",min:3*i.column_width,max:Math.floor(i.size/2)*i.column_width,change:c}),height:new Upfront.Views.Editor.Field.Number({model:this.model,property:"height",label:e.height+":",label_style:"inline",min:3*i.baseline,change:c})};o||!l?u.top=new Upfront.Views.Editor.Field.Number({model:this.model,property:"top",label:e.top+":",label_style:"inline",min:0,change:c}):u.bottom=new Upfront.Views.Editor.Field.Number({model:this.model,property:"bottom",label:e.bottom+":",label_style:"inline",min:0,change:c}),s||!d?u.left=new Upfront.Views.Editor.Field.Number({model:this.model,property:"left",label:e.left+":",label_style:"inline",min:0,change:c}):u.right=new Upfront.Views.Editor.Field.Number({model:this.model,property:"right",label:e.right+":",label_style:"inline",min:0,change:c}),_.each(u,function(e){e.render(),e.delegateEvents(),t.append(e.$el)})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/region/region-bg-setting-lightbox",["scripts/upfront/upfront-views-editor/region/region-bg-setting","scripts/upfront/upfront-views-editor/fields","text!upfront/templates/region_edit_panel.html"],function(i,n,o){return i.extend({get_template:function(){var e=t(o);return _.template(e.find("#upfront-region-bg-setting-lightbox").html())},render_main_settings:function(t){this.render_lightbox_settings(t.find(".upfront-region-bg-setting-lightbox-region"))},render_lightbox_settings:function(t){var i=this,n=Upfront.Settings.LayoutEditor.Grid,o=function(t){i=t.$spectrum?t:this;var e=i.get_value(),n=i.get_saved_value();e!=n&&i.property.set({value:e})},r={width:new Upfront.Views.Editor.Field.Number({model:this.model,property:"col",className:"upfront-field-wrap upfront-field-wrap-number width_cols",label:e.col_width+":",label_style:"inline",min:3,max:24,change:o}),height:new Upfront.Views.Editor.Field.Number({model:this.model,property:"height",label:e.px_height+":",label_style:"inline",min:3*n.baseline,max:99999,change:o}),click_out_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"click_out_close",label:"",values:[{label:e.click_close_ltbox,value:"yes",checked:"yes"==this.model.get_property_value_by_name("click_out_close")&&"checked"}],change:o}),show_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"show_close",label:"",values:[{label:e.show_close_icon,value:"yes",checked:"yes"==this.model.get_property_value_by_name("show_close")&&"checked"}],change:o})};r.overlay_color=new Upfront.Views.Editor.Field.Color({model:this.model,property:"overlay_color",className:"upfront-field-wrap upfront-field-wrap-color sp-cf overlay_color",default_value:"rgba(38,58,77,0.75)",label:e.overlay_bg+":",change:o,spectrum:{move:function(t){var e=t.toRgb(),i="rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")";r.overlay_color.get_field().val(i),o(r.overlay_color)},change:function(t){var e=t.toRgb(),i="rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")";r.overlay_color.get_field().val(i),o(r.overlay_color)}}}),r.lightbox_color=new Upfront.Views.Editor.Field.Color({model:this.model,property:"lightbox_color",default_value:"rgba(248,254,255,0.9)",label:e.active_area_bg+":",change:o,spectrum:{move:function(t){var e=t.toRgb(),i="rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")";r.lightbox_color.get_field().val(i),o(r.lightbox_color)},change:function(t){var e=t.toRgb(),i="rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")";r.lightbox_color.get_field().val(i),o(r.lightbox_color)}}}),_.each(r,function(e){e.render(),e.delegateEvents(),t.append(e.$el)}),this.model.set_property("delete",!1);var i=this;t.on("click","a.upfront-entity-delete_trigger",function(){i.model.set_property("delete",!0),i.close()}),t.closest(".upfront-inline-modal-wrap").draggable()},update_lightbox_overlay:function(t){var e=t.toRgb();"rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")"}})})}(jQuery),function(){define("scripts/upfront/upfront-views-editor/region",["scripts/upfront/upfront-views-editor/region/region-panels","scripts/upfront/upfront-views-editor/region/region-panel-add","scripts/upfront/upfront-views-editor/region/region-panel-item","scripts/upfront/upfront-views-editor/region/region-panel-item-add-region","scripts/upfront/upfront-views-editor/region/region-panel-item-bg-setting","scripts/upfront/upfront-views-editor/region/region-panel-item-expand-lock","scripts/upfront/upfront-views-editor/region/region-fixed-edit-position","scripts/upfront/upfront-views-editor/region/region-fixed-panels","scripts/upfront/upfront-views-editor/region/region-bg-setting","scripts/upfront/upfront-views-editor/region/region-bg-setting-fixed","scripts/upfront/upfront-views-editor/region/region-bg-setting-lightbox"],function(t,e,i,n,o,r,s,a,l,p,d){return{RegionPanels:t,RegionPanelAdd:e,RegionPanelItem:i,RegionPanelItemAddRegion:n,RegionPanelItemBgSetting:o,RegionPanelItemExpandLock:r,RegionFixedEditPosition:s,RegionFixedPanels:a,RegionBgSetting:l,RegionBgSettingFixed:p,RegionBgSettingLightbox:d}})}(),function(t){define("scripts/upfront/upfront-views-editor/region/region-settings-sidebar",[],function(){t("body").append('<div id="region-settings-sidebar" />'),t("#region-settings-sidebar").width(0).css("opacity",0);var e=function(){t("#region-settings-sidebar").width(0).css("opacity",0).html("")},i=function(e){t("#region-settings-sidebar").html(e.el),e.open(),setTimeout(function(){t("#region-settings-sidebar").removeClass("collapsed")},500),Upfront.Events.trigger("region:settings:render")};Upfront.Events.on("region:settings:activate",i),Upfront.Events.on("entity:removed:after",e),Upfront.Events.on("upfront:layout_size:change_breakpoint",e)})}(jQuery),function(){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/commands",[],function(){return Backbone.View.extend({tagName:"ul",initialize:function(){this.commands=_([])},render:function(){this.$el.find("li").remove(),this.commands.each(this.add_command,this)},add_command:function(t){t&&(t.remove(),t.render(),this.$el.append(t.el),t.bind("upfront:command:remove",this.remove_command,this),t.delegateEvents())},remove_command:function(t){var e=this.commands.reject(function(e){return e.remove(),e.cid==t.cid});this.commands=_(e),this.render()}})})}(),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command",[],function(){return Backbone.View.extend({tagName:"li",events:{click:"on_click"},on_click:function(){this.render()},add_module:function(t){var e=this.model.get("regions").active_region;if(!e)return Upfront.Util.log("select a region");Upfront.Events.trigger("entity:module:before_added",t,e);var i=this.model.get("wrappers"),n=Upfront.Util.get_unique_id("wrapper"),o=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:n},{name:"class",value:"c24 clr"}]});t.set_property("wrapper_id",n),i.add(o),e.get("modules").add(t),Upfront.Events.trigger("entity:module:added",t,e)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-cancel-post-layout",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-cancel",render:function(){this.$el.html(e.cancel),this.$el.prop("title",e.cancel)},on_click:function(){Upfront.Events.trigger("post:layout:cancel"),Upfront.plugins.call("cancel-post-layout")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-delete",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({initialize:function(){Upfront.Events.on("entity:activated",this.activate,this),Upfront.Events.on("entity:deactivated",this.deactivate,this),this.deactivate()},render:function(){this.$el.html(e.delete_string)},on_click:function(){var t=this.model.get("regions").active_region,e=t.get("modules"),i=e.active_entity;return i?this.delete_module(t,i):void e.each(function(t){var e=t.get("objects"),i=e.active_entity;i&&e.remove(i)})},activate:function(){this.$el.css("text-decoration","none")},deactivate:function(){this.$el.css("text-decoration","line-through")},delete_module:function(t,e){var i=t.get("modules");i.remove(e)}})})}(jQuery),define("text!upfront/templates/edit_background_area.html",[],function(){return'<div class="command-edit-label">{{Upfront.Settings.l10n.global.views.edit_bg_areas}}</div>\r\n<div class="command-edit-switcher">\r\n\t<span class="switch switch-off">{{Upfront.Settings.l10n.global.views.off}}</span>\r\n\t<span class="switch switch-on">{{Upfront.Settings.l10n.global.views.on}}</span>\r\n\t<span class="knob"></span>\r\n</div>'}),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-edit-background-area",["scripts/upfront/upfront-views-editor/commands/command","text!upfront/templates/edit_background_area.html"],function(e,i){return e.extend({className:"command-edit-background-area",events:{"click .switch":"on_switch"},initialize:function(){Upfront.Events.on("command:newpage:start",this.switchOff,this),Upfront.Events.on("command:newpost:start",this.switchOff,this)},render:function(){var t=_.template(i,{});this.$el.html(t)},on_switch:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);this.$el.find(".switch-on").hasClass("active")?this.switchOff():(this.$el.find(".switch-off").removeClass("active"),this.$el.find(".switch-on").addClass("active"),e.addClass("upfront-region-editing"),Upfront.Events.trigger("command:region:edit_toggle",!0))},switchOff:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);this.$el.find(".switch-off").addClass("active"),this.$el.find(".switch-on").removeClass("active"),e.removeClass("upfront-region-editing"),e.removeClass("upfront-region-lightbox-editing"),Upfront.Events.trigger("command:region:edit_toggle",!1)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-general-edit-custom-css",["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/css"],function(i,n){return i.extend({tagName:"div",className:"command-edit-css upfront-icon upfront-icon-edit-css",initialize:function(){this.lazy_save_styles=_.debounce(function(t){this.model.set({styles:t})},1e3)},render:function(){this.$el.html('<span title="'+e.add_custom_css_rules+'">'+e.add_custom_css_rules+"</span>")},on_click:function(){var e,i=this;e=new n.GeneralCSSEditor({model:this.model,page_class:this.model.get("id")+"-breakpoint",type:"Layout",sidebar:!1,global:!0,change:function(t){i.lazy_save_styles(t)}}),Upfront.Application.generalCssEditor=e,Upfront.Events.on("upfront:layout_size:change_breakpoint",function(){e.close()}),Upfront.Events.on("upfront:exit:responsive",function(){t.contains(document.documentElement,e.$el.get(0))&&e.close()}),Upfront.Events.on("element:settings:activate",function(){t.contains(document.documentElement,e.$el.get(0))&&e.close()})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-edit-custom-css",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({tagName:"div",className:"command-edit-css upfront-icon upfront-icon-edit-css",render:function(){this.$el.html("<span>"+e.add_custom_css_rules+"</span>"),this.$el.prop("title",e.add_custom_css_rules)},on_click:function(){var e=Upfront.Application.cssEditor;e.init({model:this.model,type:"Layout",sidebar:!1,element_id:"layout",global:!0}),Upfront.Events.on("upfront:start:responsive",function(){t.contains(document.documentElement,e.$el.get(0))&&e.close()}),Upfront.Events.on("element:settings:activate",function(){t.contains(document.documentElement,e.$el.get(0))&&e.close()})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-edit-global-regions",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({tagName:"div",className:"command-link command-edit-global-regions",render:function(){this.$el.text(e.edit_global_regions),this.$el.prop("title",e.edit_global_regions)},on_click:function(){Upfront.Events.trigger("command:layout:edit_global_regions")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-edit-layout-background",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({tagName:"div",className:"command-link command-edit-bg",render:function(){this.$el.text(e.edit_global_bg),this.$el.prop("title",e.edit_global_bg)},on_click:function(){Upfront.Events.trigger("command:layout:edit_background")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-exit",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({className:"command-exit upfront-icon upfront-icon-exit",render:function(){this.stopListening(Upfront.Events,"stay:upfront:editor"),this.listenTo(Upfront.Events,"stay:upfront:editor",this.stayed)},on_click:function(){var i=window.location.pathname,n=new Upfront.Views.Editor.Loading({loading:e.exiting_upfront,done:e.exit_done,fixed:!0});return n.render(),t("body").append(n.$el),this.tmout=setTimeout(function(){n.cancel()},1e3),i.indexOf("/create_new/")!==-1?window.location.href=Upfront.Settings.site_url:i.indexOf("/edit/")!==-1&&_upfront_post_data&&_upfront_post_data.post_id?window.location.href=Upfront.Settings.site_url+"/?p="+_upfront_post_data.post_id:window.location.search.match(/(\?|\&)editmode/)?window.location.search=window.location.search.replace(/(\?|\&)editmode(=[^?&]+)?/,""):void window.location.reload(!0)},stayed:function(){clearTimeout(this.tmout)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-export-history",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({render:function(){this.$el.html(e.export_history)},on_click:function(){alert("Check console output"),console.log({undo:Upfront.Util.Transient.get_all("undo"),redo:Upfront.Util.Transient.get_all("redo")})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-go-to-type-preview-page",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({tagName:"div",className:"command-go-to-type-preview",render:function(){this.$el.text(e.go_to_preview_page)},on_click:function(){alert("This is just placeholder :)")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-load-layout",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({render:function(){this.$el.html(e.alternate_layout),this.$el.prop("title",e.alternate_layout)},on_click:function(){Upfront.Events.trigger("command:layout:load",2)}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-logo",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-logo",render:function(){var t=Upfront.Settings.site_url;"/"!=t[t.length-1]&&(t+="/"),Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.CONTENT?this.$el.html('<a class="upfront-logo" href="'+t+'"></a>'):this.$el.html('<a class="upfront-logo upfront-logo-small" href="'+t+'"></a>')},on_click:function(){_upfront_post_data&&(_upfront_post_data.post_id=!1),Upfront.Events.trigger("click:edit:navigate",!1)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-merge",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({render:function(){return!!this.model.merge.length&&void this.$el.html(e.merge_selected)},on_click:function(){var e=this.model.merge,i=this.model.get("regions").active_region,n=i.get("modules"),o=[];_(e).each(function(t){t.get("objects").each(function(t){o.push(t)}),n.remove(t)});var r=Upfront.Util.get_unique_id("module"),s=new Upfront.Models.Module({name:"Merged module",properties:[{name:"element_id",value:r},{name:"class",value:"c24"}],objects:o});this.add_module(s),t("#"+r).trigger("click"),this.remove(),this.trigger("upfront:command:remove",this),Upfront.Events.trigger("command:merge")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-new-post",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({className:"command-new-post",postView:!1,postType:"post",setMode:!1,initialize:function(){this.setMode=Upfront.Application.MODE.CONTENT},render:function(){Upfront.Events.trigger("command:newpost:start",!0),this.$el.html(e.new_post),this.$el.prop("title",e.new_post)},on_click:function(i){if(i.preventDefault(),Upfront.Settings.LayoutEditor.newpostType==this.postType)return Upfront.Views.Editor.notify(e.already_creating_post.replace(/%s/,this.postType),"warning");var n=new Upfront.Views.Editor.Loading({loading:e.loading,fixed:!0});n.render(),t("body").append(n.$el),Upfront.Util.post({action:"upfront-create-post_type",data:_.extend({post_type:this.postType},{})}).done(function(t){n.remove(),_upfront_post_data&&(_upfront_post_data.post_id=t.data.post_id),Upfront.Application.navigate("/edit/post/"+t.data.post_id,{trigger:!0}),Upfront.Events.trigger("click:edit:navigate",t.data.post_id)})},on_post_loaded:function(t){this.postView||(this.postView=t,t.editPost(t.post),Upfront.data.currentEntity=t,Upfront.Events.off("elements:this_post:loaded",this.on_post_loaded,this),Upfront.Events.on("upfront:application:contenteditor:render",this.select_title,this))},select_title:function(){var e=this.postView.$(".post_title input").focus();e.val(e.val()),t("#upfront-loading").remove(),Upfront.Events.off("upfront:application:contenteditor:render",this.select_title,this)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-new-page",["scripts/upfront/upfront-views-editor/commands/command-new-post","scripts/upfront/upfront-views-editor/fields"],function(i,n){return i.extend({className:"command-new-page",postType:"page",_default_label:e.new_page,initialize:function(){this.setMode=Upfront.Application.MODE.LAYOUT},render:function(){Upfront.Events.trigger("command:newpage:start",!0),this.$el.html(this._default_label),this.$el.prop("title",this._default_label)},on_click:function(i){i.preventDefault();var n=this,o=new Upfront.Views.Editor.Loading({loading:e.loading,fixed:!0});o.render(),t("body").append(o.$el),Upfront.Util.post({action:"upfront-create-post_type",data:_.extend({post_type:n.postType,title:n._default_label},{})}).done(function(t){_upfront_post_data&&(_upfront_post_data.post_id=t.data.post_id),o.remove(),Upfront.Application.navigate("/edit/page/"+t.data.post_id,{trigger:!0}),Upfront.Events.trigger("click:edit:navigate",t.data.post_id)})},render_modal:function(){var t=this,i=this.modal.$el.find(".upfront-inline-modal-content");i.empty().append("<h2>"+e.add_new_page+"</h2>"),_.each(t.modal._fields,function(t){t.render(),t.delegateEvents(),i.append(t.$el)})},spawn_modal:function(){if(this.modal)return this.initialize_modal_data();var i=this,o=function(){if(_.each(i.modal._fields,function(t,e){i.modal._data[e]=t.get_value()}),!i.modal._fields.permalink.has_been_edited()){var e=t.trim(i.modal._data.title||i._default_label),n=e.replace(/^[^a-z0-9]+/gi,"").replace(/[^a-z0-9]+$/gi,"").replace(/[^-_0-9a-z]/gi,"-").toLowerCase();i.modal._fields.permalink.set_value(n)}},r=[{label:e.none,value:""}],s=Upfront.Util.post({action:"upfront-wp-model",model_action:"get_post_extra",postId:"fake",allTemplates:!0});this.modal=new Upfront.Views.Editor.Modal({to:t("body"),button:!0,top:120,width:540,button_text:e.create_page}),this.modal._fields={title:new Upfront.Views.Editor.Field.Text({label:"",name:"title",default_value:this._default_label,change:o}),permalink:new n.ToggleableText({label:"<b>"+e.permalink+":</b> "+Upfront.Settings.site_url.replace(/\/$/,"")+"/",label_style:"inline",name:"permalink",change:o}),template:new Upfront.Views.Editor.Field.Select({label:e.page_template,name:"template",values:r})},this.initialize_modal_data(),this.on("new_page:modal:open",o,this),this.on("new_page:modal:close",o,this),s.done(function(t){return i.modal._fields.template.options.values=r,!(!t.data||!t.data.allTemplates)&&(_.each(t.data.allTemplates,function(t,e){i.modal._fields.template.options.values.push({label:e,value:t})}),void i.modal._fields.template.render())})},initialize_modal_data:function(){var t=this;this.modal._data={},_.each(_.keys(this.modal._fields),function(e){t.modal._data[e]="",t.modal._fields[e].reset_state&&t.modal._fields[e].reset_state()})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-open-font-manager",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({tagName:"div",className:"command-open-font-manager upfront-icon upfront-icon-open-font-manager",render:function(){this.$el.html('<span title="'+e.theme_font_manager+'">'+e.theme_font_manager+"</span>")},on_click:function(){Upfront.Events.trigger("command:themefontsmanager:open")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-preview-layout",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-preview",can_preview:!1,render:function(){this.$el.addClass("command-save command-preview upfront-icon upfront-icon-save"),this.preview_built(),Upfront.Events.on("preview:build:start",this.building_preview,this),Upfront.Events.on("preview:build:stop",this.preview_built,this)},on_click:function(){this.can_preview&&Upfront.Events.trigger("command:layout:preview")},building_preview:function(){this.$el.html(e.building),this.can_preview=!1},preview_built:function(){this.$el.html(e.preview),this.$el.prop("title",e.preview),this.can_preview=!0}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-publish-layout",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-publish-layout",render:function(){this.$el.html(e.publish_layout)},on_click:function(){Upfront.Events.trigger("command:layout:publish")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-redo",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({className:"command-redo",initialize:function(){Upfront.Events.on("command:undo",this.render,this),this.deactivate()},render:function(){this.$el.addClass("upfront-icon upfront-icon-redo"),this.$el.prop("title",e.redo),this.model.has_redo_states()?this.activate():this.deactivate()},activate:function(){this.$el.css("opacity",1)},deactivate:function(){this.$el.css("opacity",.5)},on_click:function(){var i=this,n=!1,o=new Upfront.Views.Editor.Loading({loading:e.redoing,done:e.redoing_done,fixed:!0});o.render(),t("body").append(o.$el),n=i.model.restore_redo_state(),n&&n.done?n.done(function(){Upfront.Events.trigger("command:redo"),i.render(),o.done()}):setTimeout(function(){o.done()},100)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-reset-everything",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-reset-everything",render:function(){this.$el.html("<span title='"+e.destroy_layout+"'>"+e.reset_everything+"</span>")},on_click:function(){Upfront.Util.reset().success(function(){Upfront.Util.log("layout reset"),window.location.reload()}).error(function(){Upfront.Util.log("error resetting layout")})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-save-layout",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-save",render:function(){Upfront.Events.on("upfront:save:label",this.update_label,this),this.$el.html(e.save),this.$el.prop("title",e.save)},update_label:function(t){var e=this;setTimeout(function(){e.$el.html(t),e.$el.prop("title",t)},200)},on_click:function(){_upfront_post_data.layout.specificity&&_upfront_post_data.layout.item&&!_upfront_post_data.layout.item.match(/-page/)?Upfront.Events.trigger("command:layout:save_as"):Upfront.Events.trigger("command:layout:save")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-save-layout-as",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({render:function(){this.$el.html(e.save_as),this.$el.prop("title",e.save_as)},on_click:function(){Upfront.Events.trigger("command:layout:save_as")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-save-post-layout",["scripts/upfront/upfront-views-editor/commands/command-save-layout"],function(t){return t.extend({className:"command-save",render:function(){this.$el.addClass("upfront-icon upfront-icon-save"),this.$el.html(e.save_layout),this.$el.prop("title",e.save_layout)},on_click:function(){Upfront.Events.trigger("post:layout:save")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-select",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({initialize:function(){Upfront.Events.on("command:merge",this.on_click,this)},render:function(){this.$el.html("Select mode "+(this._selecting?"on":"off")),this.$el.html(this._selecting?e.select_mode_on:e.select_mode_off)},on_click:function(){this._selecting?Upfront.Events.trigger("command:deselect"):Upfront.Events.trigger("command:select"),this._selecting=!this._selecting,this.render()}})})}(jQuery),define("text!upfront/templates/overlay_grid.html",[],function(){return'<div class="upfront-overlay-grid upfront-overlay-grid-{{style}}">\r\n\t{[ _(columns).times(function(i){ var c = i+1; ]}<div class="c1 t1 m1 upfront-grid-border">{{c}}</div>{[ }) ]}\r\n</div>\r\n'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-toggle-grid",["scripts/upfront/upfront-views-editor/commands/command","text!upfront/templates/overlay_grid.html"],function(i,n){return i.extend({className:"command-grid",render:function(){this.$el.addClass("upfront-icon upfront-icon-grid"),
this.$el.prop("title",e.toggle_grid),this.listenTo(Upfront.Events,"entity:region:added",this.update_grid),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.update_grid),this.listenTo(Upfront.Events,"grid:toggle",this.on_click)},on_click:function(){t(".upfront-overlay-grid").size()||this.create_grid(),this.toggle_grid()},create_grid:function(){this.update_grid()},toggle_grid:function(){Upfront.Application.get_gridstate()?this.hide_grid():this.show_grid()},show_grid:function(){this.$el.addClass("upfront-icon-grid-active"),t(".upfront-overlay-grid").addClass("upfront-overlay-grid-show"),Upfront.Application.set_gridstate(!0)},hide_grid:function(){this.$el.removeClass("upfront-icon-grid-active"),t(".upfront-overlay-grid").removeClass("upfront-overlay-grid-show"),Upfront.Application.set_gridstate(!1)},update_grid:function(e){var i=(t(Upfront.Settings.LayoutEditor.Selectors.main),Upfront.Settings.LayoutEditor.Grid);t(".upfront-overlay-grid").remove(),t(".upfront-grid-layout, .upfront-region-side-fixed .upfront-modules_container, .upfront-region-side-lightbox .upfront-modules_container").each(function(){var e=i.size,o=_.template(n,{columns:e,size_class:i.class,style:"simple"});t(this).prepend(o),Upfront.Application.adjust_grid_padding_settings(this)}),Upfront.Application.get_gridstate()&&this.show_grid()}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-toggle-mode",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-toggle-mode",enabled:!0,initialize:function(){Upfront.Events.on("upfront:element:edit:start",this.disable_toggle,this),Upfront.Events.on("upfront:element:edit:stop",this.enable_toggle,this)},render:function(){this.$el.html(_.template("<span title='toggle editing mode'>"+e.current_mode+"</span>",{mode:Upfront.Application.get_current()}))},on_click:function(){if(!this.enabled)return!1;var t=Upfront.Application.mode&&Upfront.Application.mode.current&&Upfront.Application.mode.current!=Upfront.Application.MODE.CONTENT?Upfront.Application.MODE.CONTENT:Upfront.Application.mode.last;Upfront.Application.start(t)},disable_toggle:function(){this.$el.css("opacity",.5),this.enabled=!1},enable_toggle:function(){this.$el.css("opacity",1),this.enabled=!0}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-toggle-mode-small",["scripts/upfront/upfront-views-editor/commands/command-toggle-mode"],function(t){return t.extend({className:"command-toggle-mode upfront-icon",current_mode:!1,render:function(){this.current_mode&&this.$el.removeClass("command-toggle-mode-"+this.current_mode+" upfront-icon-collapse upfront-icon-expand"),this.current_mode=Upfront.Application.get_current();var t=this.current_mode!=Upfront.Application.MODE.CONTENT?"upfront-icon-collapse":"upfront-icon-expand";this.$el.addClass("command-toggle-mode-"+this.current_mode+" "+t)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-trash",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-trash upfront-icon upfront-icon-trash",render:function(){this.listenTo(Upfront.Events,"click:edit:navigate",this.toggle),this.$el.html(e.trash),this.toggle()},toggle:function(t){"undefined"!=typeof t?t===!1?this.$el.hide():this.$el.show():"undefined"==typeof _upfront_post_data||_upfront_post_data.post_id===!1?this.$el.hide():this.$el.show()},on_click:function(){Upfront.Events.trigger("command:layout:trash")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-undo",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({className:"command-undo",initialize:function(){Upfront.Events.on("command:undo",this.render,this),Upfront.Events.on("command:redo",this.render,this),Upfront.Events.on("upfront:undo:state_stored",this.render,this),this.deactivate()},render:function(){this.$el.addClass("upfront-icon upfront-icon-undo"),this.$el.prop("title",e.undo),this.model.has_undo_states()?this.activate():this.deactivate()},activate:function(){this.$el.css("opacity",1)},deactivate:function(){this.$el.css("opacity",.5)},on_click:function(){var i=this,n=!1,o=new Upfront.Views.Editor.Loading({loading:e.undoing,done:e.undoing_done,fixed:!0});o.render(),t("body").append(o.$el),n=i.model.restore_undo_state(),n&&n.done?n.done(function(){Upfront.Events.trigger("command:undo"),i.render(),o.done()}):setTimeout(function(){o.done()},100)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/responsive/command-create-responsive-layouts",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({enabled:!0,className:"command-create-responsive-layouts upfront-icon upfront-icon-start-responsive",render:function(){this.$el.html("<span title='"+e.create_responsive_layouts+"'>"+e.create_responsive_layouts+"</span>")},on_click:function(){Upfront.Application.start(Upfront.Application.MODE.RESPONSIVE)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/responsive/command-start-responsive-mode",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({enabled:!0,className:"command-start-responsive upfront-icon upfront-icon-start-responsive",render:function(){this.$el.html("<span title='"+e.responsive_mode+"'>"+e.responsive_mode+"</span>")},on_click:function(){Upfront.Events.trigger("upfront:start:responsive"),Upfront.Application.start(Upfront.Application.MODE.RESPONSIVE)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/responsive/command-stop-responsive-mode",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({enabled:!0,className:"exit-responsive",render:function(){this.$el.html("<span title='"+e.exit_responsive+"'>"+e.exit_responsive+"</span>")},on_click:function(){t("li.desktop-breakpoint-activate").trigger("click"),Upfront.Events.trigger("upfront:exit:responsive"),Upfront.Application.start(Upfront.Application.mode.last)}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/responsive/command-responsive-redo",["scripts/upfront/upfront-views-editor/commands/command-redo"],function(t){return t.extend({on_click:function(){alert("This is just placeholder.")}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/responsive/command-responsive-undo",["scripts/upfront/upfront-views-editor/commands/command-undo"],function(t){return t.extend({on_click:function(){alert("This is just placeholder.")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/breakpoint/command-add-custom-breakpoint",["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/breakpoint/model","scripts/upfront/upfront-views-editor/breakpoint/storage"],function(i,n,o){return Backbone.View.extend({tagName:"li",className:"upfornt-icon upfront-icon-add",id:"new-custom-breakpoint",events:{click:"add_breakpoint"},render:function(){this.$el.html(e.new_breakpoint)},initialize:function(t){this.collection=o.get_breakpoints()},add_breakpoint:function(i){i.preventDefault();var o,r=new Breakpoint_Model({id:this.collection.get_unique_id()});this.collection.add(r),r.set({enabled:!0}),r.set({active:!0}),o=Upfront.Popup.open(function(i,o,s){o.empty();var a=t(this),l=new n({model:r});a.append(l.render().el),s.append('<div class="breakpoint-edit-ok-button">'+e.ok+"</div>"),t("#upfront-popup-close").hide(),t(".breakpoint-edit-ok-button").on("click",function(){Upfront.Popup.close(),t("#upfront-popup-close").show()})},{width:400})}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/breakpoint/command-breakpoint-dropdown",["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/fields","scripts/upfront/upfront-views-editor/breakpoint/storage"],function(t,i,n){return t.extend({className:"activate-breakpoints-dropdown",enabled:!0,initialize:function(){var t=n.get_breakpoints();this.fields=[new i.Field_Compact_Label_Select({multiple:!0,label_text:e.activate_breakpoints,collection:t})]},render:function(){this.fields[0].render(),this.$el.append(this.fields[0].el),this.fields[0].delegateEvents()},on_click:function(){}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-open-media-gallery",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({tagName:"li",className:"command-open-media-gallery upfront-icon upfront-icon-open-gallery",render:function(){this.$el.html('<a title="'+e.media+'">'+e.media+"</a>")},on_click:function(){Upfront.Media.Manager.open({media_type:["images","videos","audios","other"]})}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/content-editor/content-editor-sidebar-command",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({tagName:"div",className:"upfront-sidebar-content_editor-sidebar_command",post:!1,initialize:function(){this.setPost(),Upfront.Events.on("data:current_post:change",this.setPost,this)},setPost:function(){var t=Upfront.data.currentPost;return t?this.post&&this.post.id==t.id||(this.post=Upfront.data.currentPost,this.onPostChange&&this.onPostChange()):this.post=new Upfront.Models.Post({post_type:"post",id:"0"}),this}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/content-editor/content-editor-search",["text!upfront/templates/popup.html"],function(e){return Backbone.View.extend({id:"upfront-entity_list-search",searchTpl:_.template(t(e).find("#upfront-search-tpl").html()),events:{"click #upfront-search_action":"dispatch_search_click","keydown #upfront-list-search_input":"dispatch_search_enter"},render:function(){var t=!!this.collection.lastFetchOptions&&this.collection.lastFetchOptions.search;this.$el.html(this.searchTpl({query:t}))},dispatch_search_click:function(e){return t("#upfront-search_container").is(":visible")?this.handle_search_request(e):this.handle_search_reveal(e)},dispatch_search_enter:function(t){if(13==t.which)return this.handle_search_request(t)},handle_search_request:function(e){e.preventDefault();var i=t("#upfront-search_container input").val();this.collection.fetch({search:i})},handle_search_reveal:function(){t("#upfront-search_container").show()}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/content-editor/content-editor-pagination",["text!upfront/templates/popup.html"],function(e){return Backbone.View.extend({paginationTpl:_.template(t(e).find("#upfront-pagination-tpl").html()),events:{"click .upfront-pagination_page-item":"handle_pagination_request","click .upfront-pagination_item-next":"handle_next","click .upfront-pagination_item-prev":"handle_prev","keypress .upfront-pagination_page-current":"set_page_keypress"},initialize:function(t){this.options=t},render:function(){this.$el.html(this.paginationTpl(this.collection.pagination))},handle_pagination_request:function(e,i){i=i?i:parseInt(t(e.target).attr("data-page_idx"),10)||0;var n=this;this.collection.pagination;this.collection.fetchPage(i).done(function(t){n.collection.trigger("reset")})},handle_next:function(t){var e=this.collection.pagination,i=e.currentPage!=e.pages-1&&e.currentPage+1;i&&this.handle_pagination_request(t,i)},handle_prev:function(t){var e=this.collection.pagination,i=0!=e.currentPage&&e.currentPage-1;i!==!1&&this.handle_pagination_request(t,i)},set_page_keypress:function(e){if(e.stopPropagation(),13!==e.which)return!0;var i=t.trim(t(e.target).val()),n=parseInt(i,10);return!(!n||n<1)&&(n>this.collection.pagination.pages&&(n=this.collection.pagination.pages),void this.handle_pagination_request(e,n-1))}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/content-editor/content-editor-posts",["text!upfront/templates/popup.html","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n){return Backbone.View.extend({className:"upfront-entity_list-posts bordered-bottom",postListTpl:_.template(t(i).find("#upfront-post-list-tpl").html()),postSingleTpl:_.template(t(i).find("#upfront-post-single-tpl").html()),paginationTpl:_.template(t(i).find("#upfront-pagination-tpl").html()),events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","click .editaction.edit":"handle_post_edit","click .editaction.view":"handle_post_view","click #upfront-list-page-path a.upfront-path-back":"handle_return_to_posts","click .editaction.trash":"trash_post"},initialize:function(t){this.collection.on("change reset",this.render,this),this.listenTo(Upfront.Events,"post:saved",this.post_saved)},render:function(){this.$el.empty().append(this.postListTpl({posts:this.collection.getPage(this.collection.pagination.currentPage),orderby:this.collection.orderby,order:this.collection.order,canEdit:Upfront.Application.user_can("EDIT"),canEditOwn:Upfront.Application.user_can("EDIT_OWN")})),n.withDebounceUpdate(this.$el.find(".upfront-scroll-panel")[0],!0,!1,!0)},handle_sort_request:function(e){var i=t(e.target).closest(".upfront-list_item-component"),n=i.attr("data-sortby"),o=this.collection.order;n&&(n==this.collection.orderby&&(o="desc"==o?"asc":"desc"),this.collection.reSort(n,o))},handle_post_edit:function(e){e.preventDefault();var i=t(e.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");_upfront_post_data&&(_upfront_post_data.post_id=i),Upfront.Application.navigate("/edit/post/"+i,{trigger:!0}),Upfront.Events.trigger("click:edit:navigate",i)},handle_post_view:function(e){e.preventDefault();var i=t(e.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");window.location.href=this.collection.get(i).get("permalink")},trash_post:function(e){var i=this,n=t(e.currentTarget).closest(".upfront-list_item-post.upfront-list_item"),o=n.attr("data-post_id");confirm(Upfront.Settings.l10n.global.content.delete_confirm.replace(/%s/,this.collection.get(o).get("post_type")))&&this.collection.get(o).set("post_status","trash").save().done(function(){i.collection.remove(i.collection.get(o))})},expand_post:function(i){var n=this;i.featuredImage||this.collection.post({action:"get_post_extra",postId:i.id,thumbnail:!0,thumbnailSize:"medium"}).done(function(t){t.data.thumbnail&&t.data.postId==i.id?(n.$("#upfront-page_preview-featured_image img").attr("src",t.data.thumbnail[0]).show(),n.$(".upfront-thumbnailinfo").hide(),i.featuredImage=t.data.thumbnail[0]):(n.$(".upfront-thumbnailinfo").text(e.no_image),n.$(".upfront-page_preview-edit_feature a").html('<i class="icon-plus"></i> '+e.add))}),t("#upfront-list-page").show("slide",{direction:"right"},"fast"),this.$el.find("#upfront-list").hide(),t("#upfront-page_preview-edit button").one("click",function(){var t="/edit/post/"+i.id;window.location.search.indexOf("dev=true")>-1&&(t+="?dev=true"),Upfront.Popup.close(),_upfront_post_data&&(_upfront_post_data.post_id=i.id),Upfront.Application.navigate(t,{trigger:!0})}),this.bottomContent=t("#upfront-popup-bottom").html(),t("#upfront-popup-bottom").html(t('<a href="#" id="upfront-back_to_posts">'+e.back_to_posts+"</a>").on("click",function(t){n.handle_return_to_posts()}))},post_saved:function(){this.collection.fetch()},handle_return_to_posts:function(){var e=this;this.$el.find("#upfront-list").show("slide",{direction:"left"},function(){e.collection.trigger("reset")}),t("#upfront-list-page").hide()}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/content-editor/content-editor-pages",["text!upfront/templates/popup.html","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n){return Backbone.View.extend({events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","click .upfront-list-page_item":"handle_page_activate","click .upfront-page-path-item":"handle_page_activate","change #upfront-page_template-select":"template_change","click .editaction.trash":"trash_page","click .editaction.edit":"handle_post_edit","click .editaction.view":"handle_post_view"},currentPage:!1,pageListTpl:_.template(t(i).find("#upfront-page-list-tpl").html()),pageListItemTpl:_.template(t(i).find("#upfront-page-list-item-tpl").html()),pagePreviewTpl:_.template(t(i).find("#upfront-page-preview-tpl").html()),allTemplates:[],initialize:function(t){this.collection.on("change reset",this.render,this),this.listenTo(Upfront.Events,"post:saved",this.post_saved)},render:function(){var t=this.collection.getPage(this.collection.pagination.currentPage);this.$el.html(this.pageListTpl({pages:t,pageItemTemplate:this.pageListItemTpl,orderby:this.collection.orderby,order:this.collection.order,canEdit:Upfront.Application.user_can("EDIT"),canEditOwn:Upfront.Application.user_can("EDIT_OWN")})),n.withDebounceUpdate(this.$el.find(".upfront-scroll-panel")[0],!0,!1,!0)},renderPreview:function(t){var e=this.$el.find("#upfront-list-page-preview");e.html(this.pagePreviewTpl({page:t,template:t.template?t.template:"Default",allTemplates:this.allTemplates?this.allTemplates:[]})),this.$el.find("#upfront-page_preview-edit button").one("click",function(){var e="/edit/page/"+t.get("ID");window.location.search.indexOf("dev=true")>-1&&(e+="?dev=true"),Upfront.Popup.close(),_upfront_post_data&&(_upfront_post_data.post_id=t.get("ID")),Upfront.Application.navigate(e,{trigger:!0})})},handle_sort_request:function(e){var i=t(e.target).closest(".upfront-list_item-component"),n=i.attr("data-sortby"),o=this.collection.order;n&&(n==this.collection.orderby&&(o="desc"==o?"asc":"desc"),this.collection.reSort(n,o))},handle_post_edit:function(e){e.preventDefault();var i=t(e.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");_upfront_post_data&&(_upfront_post_data.post_id=i),Upfront.Application.navigate("/edit/page/"+i,{trigger:!0}),Upfront.Events.trigger("click:edit:navigate",i)},handle_post_view:function(e){e.preventDefault();var i=t(e.currentTarget).closest(".upfront-list_item-post").attr("data-post_id");window.location.href=this.collection.get(i).get("permalink")},handle_page_activate:function(e){var i=this.collection.get(t(e.target).attr("data-post_id"));e.preventDefault(),e.stopPropagation(),this.$(".upfront-list-page_item").removeClass("active"),this.$("#upfront-list-page_item-"+i.id).addClass("active").toggleClass("closed"),this.update_path(i),this.update_page_preview(i),this.currentPage=i},trash_page:function(e){var i=this,n=t(e.currentTarget).closest(".upfront-list_item-post.upfront-list_item"),o=n.attr("data-post_id");confirm(Upfront.Settings.l10n.global.content.delete_confirm.replace(/%s/,this.collection.get(o).get("post_type")))&&this.collection.get(o).set("post_status","trash").save().done(function(){i.collection.remove(i.collection.get(o)),n.remove()})},post_saved:function(){this.collection.fetch()},update_path:function(t){for(var e=t,i=[{id:t.get("ID"),title:t.get("post_title")}],n=this.$el.find("#upfront-list-page-path"),o="";e.get("post_parent");)e=this.collection.get(e.get("post_parent")),i.unshift({id:e.get("ID"),title:e.get("post_title")});_.each(i,function(e){o&&(o+="&nbsp;&nbsp;"),o+=e.id==t.id?'<span class="upfront-page-path-current last">'+e.title+"</span>":'<a href="#" class="upfront-page-path-item" data-post_id="'+e.id+'">'+e.title+"</a>"}),n.html(o)},update_page_preview:function(t){var i=this,n=!t.thumbnail||!i.allTemplates||!t.template,o=n?{thumbnail:!t.thumbnail,thumbnailSize:"medium",allTemplates:!i.allTemplates,template:!t.template,action:"get_post_extra",postId:t.get("ID")}:{};n&&this.collection.post(o).done(function(n){n.data.thumbnail&&n.data.postId==t.get("ID")?(i.$("#upfront-page_preview-featured_image img").attr("src",n.data.thumbnail[0]).show(),i.$(".upfront-thumbnailinfo").hide(),t.thumbnail=n.data.thumbnail[0]):(i.$(".upfront-thumbnailinfo").text(e.no_image),i.$(".upfront-page_preview-edit_feature a").html('<i class="icon-plus"></i> '+e.add)),n.data.allTemplates&&(i.allTemplates=n.data.allTemplates),n.data.template&&(t.template=n.data.template,i.renderPreview(t))}),this.renderPreview(t)},template_change:function(e){var i=this,n=t(e.target),o=n.val();this.currentPage.post({action:"update_page_template",postId:this.currentPage.get("ID"),template:o}).done(function(t){i.currentPage.get("ID")==t.data.postId&&(i.currentPage.template=t.data.template)})}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/content-editor/content-editor-comments",["text!upfront/templates/popup.html"],function(e){return Backbone.View.extend({events:{"click #upfront-list-meta .upfront-list_item-component":"handle_sort_request","mouseenter .upfront-list_item-comment":"start_reveal_counter","mouseleave .upfront-list_item-comment":"stop_reveal_counter","click .upfront-list_item-comment":"toggle_full_post","click .upfront-comments-approve":"handle_approval_request","click .upfront-comment_actions-wrapper a":"handle_action_bar_request","click .comment-edit-ok":"edit_comment","click .comment-reply-ok":"reply_to_comment","click .comment-reply-cancel":"cancel_edit","click .comment-edit-box":"stop_propagation"},excerptLength:60,commentsTpl:_.template(t(e).find("#upfront-comments-tpl").html()),commentTpl:_.template(t(e).find("#upfront-comment-single-tpl").html()),initialize:function(t){this.collection.on("change",this.renderComment,this),this.collection.on("add",this.addComment,this)},render:function(){var t=0==this.collection.postId?[]:this.collection.getPage(this.collection.pagination.currentPage);this.$el.html(this.commentsTpl({comments:t,excerptLength:45,commentTpl:this.commentTpl,orderby:this.collection.orderby,order:this.collection.order}))},renderComment:function(t){this.$("#upfront-list_item-comment-"+t.get("comment_ID")).html(this.commentTpl({comment:t,excerptLength:60}))},addComment:function(e){var i=e.get("comment_parent"),n=e.get("comment_ID"),o=t('<div class="upfront-list_item-comment upfront-list_item clearfix expanded" id="upfront-list_item-comment-'+n+'" data-comment_id="'+n+'">'+this.commentTpl({comment:e,excerptLength:this.excerptLength})+"</div>").hide();this.$("div.upfront-list_item-comment").removeClass("expanded"),this._currently_working=!1,i?this.$("#upfront-list_item-comment-"+i).after(o):this.$("div.upfront-list-comment-items").append(o),o.slideDown()},handle_sort_request:function(e){var i=t(e.target).closest(".upfront-list_item-component"),n=i.attr("data-sortby"),o=this.collection.order;n&&(n==this.collection.orderby&&(o="desc"==o?"asc":"desc"),this.collection.reSort(n,o))},start_reveal_counter:function(e){var i=this;return!t(e.target).is(".upfront-comment-approved")&&!t(e.target).parents(".upfront-comment-approved").length&&(!this._currently_working&&(clearTimeout(i._reveal_counter),void(i._reveal_counter=setTimeout(function(){i.reveal_comment(e)},500))))},reveal_comment:function(e){this.$(".upfront-list-comments .upfront-list_item").removeClass("expanded"),t(e.currentTarget).addClass("expanded"),clearTimeout(this._reveal_counter)},revert_comment:function(e){t(e.currentTarget).removeClass("expanded"),clearTimeout(this._reveal_counter)},toggle_full_post:function(e){t(e.currentTarget).toggleClass("expanded")},stop_reveal_counter:function(t){return!this._currently_working&&void this.revert_comment(t)},handle_approval_request:function(e,i){i=i?i:this.collection.get(t(e.target).attr("data-comment_id")),this.$("#upfront-list_item-comment-"+i.id+" i.upfront-comments-approve").animate({"font-size":"1px",opacity:0},400,"swing",function(){i.approve(!0).save()})},handle_action_bar_request:function(e){var i=t(e.currentTarget),n=this.collection.get(i.parents(".upfront-list_item-comment").attr("data-comment_id"));return i.is(".edit")?this._edit_comment(n):i.is(".reply")?this._reply_to_comment(n):i.is(".approve")?this.handle_approval_request(!1,n):i.is(".unapprove")?n.approve(!1).save():i.is(".thrash")?n.trash(!0).save():i.is(".unthrash")?n.trash(!1).save():i.is(".spam")?n.spam(!0).save():i.is(".unspam")&&n.spam(!1).save(),!1},edit_comment:function(e){var i=t(e.target).parent(),n=this.collection.get(i.attr("data-comment_id"));n.set("comment_content",i.find("textarea").attr("disabled",!0).val()).save()},reply_to_comment:function(e){var i=this,n=t(e.target).parent(),o=this.collection.get(n.attr("data-comment_id")),r=this.$("#upfront-list_item-comment-"+o.get("comment_ID")),s=n.find("textarea").val(),a=Upfront.data.currentUser;if(s){var l=new Upfront.Models.Comment({comment_author:a.get("data").display_name,comment_post_ID:this.collection.postId,comment_parent:o.get("comment_ID"),comment_content:s,comment_approved:"1",user_id:a.get("ID")});(new Date).getTime();r.find("textarea").attr("disabled",!0),l.save().done(function(t){i.renderComment(o),l.set("comment_ID",t.data.comment_ID),i.collection.add(l),i.$("#upfront-list_item-comment-"+t.data.comment_ID).hide().slideDown()})}},cancel_edit:function(e){var i=t(e.target).parent(),n=this.collection.get(i.attr("data-comment_id"));this.renderComment(n)},stop_propagation:function(t){t.stopPropagation()},_edit_comment:function(t){var e=this.$("#upfront-list_item-comment-"+t.get("comment_ID"));e.find(".upfront-comment_togglable").hide(),e.find(".upfront-comment_edit").show(),this._currently_working=!0},_reply_to_comment:function(t){var e=this.$("#upfront-list_item-comment-"+t.get("comment_ID"));e.find(".upfront-comment_togglable").show(),e.find(".upfront-comment_edit").hide(),this._currently_working=!0}})})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/content-editor",["scripts/upfront/upfront-views-editor/content-editor/content-editor-sidebar-command","scripts/upfront/upfront-views-editor/content-editor/content-editor-search","scripts/upfront/upfront-views-editor/content-editor/content-editor-pagination","scripts/upfront/upfront-views-editor/content-editor/content-editor-posts","scripts/upfront/upfront-views-editor/content-editor/content-editor-pages","scripts/upfront/upfront-views-editor/content-editor/content-editor-comments"],function(t,e,i,n,o,r){return{SidebarCommand:t,Search:e,Pagination:i,Posts:n,Pages:o,Comments:r}})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-popup-list",["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/content-editor"],function(i,n){return n.SidebarCommand.extend({tagName:"li",className:"command-popup-list",$popup:{},views:{},currentPanel:!1,render:function(){this.$el.addClass("upfront-entity_list upfront-icon upfront-icon-browse"),Upfront.Application.is_single("post")?this.$el.html('<a title="'+e.posts_pages_comments+'">'+e.posts_pages_comments+"</a>"):this.$el.html('<a title="'+e.posts_pages+'">'+e.posts_pages+"</a>")},on_click:function(){var i=this,n=Upfront.Popup.open(function(n,o,r){var s=t(this);s.empty().append('<p class="upfront-popup-placeholder">'+e.popup_preloader+"</p>"),i.$popup={top:o,content:s,bottom:r}}),o=!1,r=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;o=!!r,r&&Upfront.data.posts&&Upfront.data.posts.length&&(o=!(!Upfront.data.posts[r]||!Upfront.data.posts[r].get)&&!!parseInt(Upfront.data.posts[r].get("comment_count"),10)),i.$popup.top.html('<ul class="upfront-tabs"><li data-type="posts" class="active">'+e.posts+'</li><li data-type="pages">'+e.pages+"</li>"+(o?'<li data-type="comments">'+e.comments+"</li>":"")+"</ul>"+i.$popup.top.html()).find(".upfront-tabs li").on("click",function(){i.dispatch_panel_creation(this)}),i.dispatch_panel_creation(),n.done(function(){Upfront.Events.off("upfront:posts:sort"),Upfront.Events.off("upfront:posts:post:expand"),Upfront.Events.off("upfront:pages:sort"),Upfront.Events.off("upfront:comments:sort")})},dispatch_panel_creation:function(e){var i=this,o=e?t(e):i.$popup.top.find(".upfront-tabs li.active"),r=o.attr("data-type"),s=(r.charAt(0).toUpperCase()+r.slice(1).toLowerCase(),!1),a=(this.post.id,{});if(i.$popup.top.find(".upfront-tabs li").removeClass("active"),o.addClass("active"),this.currentPanel=r,i.views[r]&&"pages"!=r&&"posts"!=r&&("comments"!=r||Upfront.data.currentPost&&Upfront.data.currentPost.id&&i.views[r].view.collection.postId==Upfront.data.currentPost.id))return this.render_panel(i.views[r]);if("posts"==r)s=new Upfront.Collections.PostList([],{postType:"post"}),s.orderby="post_date",a={filterContent:!0,withAuthor:!0,limit:15};else if("pages"==r)s=new Upfront.Collections.PostList([],{postType:"page"}),s.orderby="post_date",a={limit:15};else{var l=Upfront.data.currentPost&&Upfront.data.currentPost.id?Upfront.data.currentPost.id:_upfront_post_data.post_id;s=new Upfront.Collections.CommentList([],{postId:l}),s.orderby="comment_date"}return s.fetch(a).done(function(t){var e,o;switch(r){case"posts":if(e=null,"undefined"!=typeof i.views[r]&&(e=i.views[r].view.collection.pagination.totalElements),o=s.pagination.totalElements,e==o)return i.render_panel(i.views[r]);s.on("reset sort",i.render_panel,i),views={view:new n.Posts({collection:s,$popup:i.$popup}),search:new n.Search({collection:s}),pagination:new n.Pagination({collection:s})},i.views.posts=views;break;case"pages":if(e=null,"undefined"!=typeof i.views[r]&&(e=i.views[r].view.collection.pagination.totalElements),o=s.pagination.totalElements,e==o)return i.render_panel(i.views[r]);s.on("reset sort",i.render_panel,i),views={view:new n.Pages({collection:s,$popup:i.$popup}),search:new n.Search({collection:s}),pagination:new n.Pagination({collection:s})},i.views.pages=views;break;case"comments":s.on("reset sort",i.render_panel,i),views={view:new n.Comments({collection:s,$popup:i.$popup}),search:new n.Search({collection:s}),pagination:new n.Pagination({collection:s})},i.views.comments=views}i.render_panel()}),!1},render_panel:function(){var t=this,e=this.views[this.currentPanel];e.view.render(),t.$popup.content.html(e.view.$el),
e.view.setElement(e.view.$el),t.$popup.bottom.empty(),e.pagination&&(e.pagination.render(),t.$popup.bottom.html(e.pagination.$el),e.pagination.setElement(e.pagination.$el)),e.search.render(),t.$popup.bottom.append(e.search.$el),e.search.setElement(e.search.$el)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/menu/command-close",["scripts/upfront/upfront-views-editor/commands/command"],function(i){return i.extend({render:function(){this.stopListening(Upfront.Events,"stay:upfront:editor"),this.listenTo(Upfront.Events,"stay:upfront:editor",this.stayed),this.$el.html(e.close_upfront)},on_click:function(){var i=window.location.pathname,n=new Upfront.Views.Editor.Loading({loading:e.exiting_upfront,done:e.exit_done,fixed:!0});return n.render(),t("body").append(n.$el),this.tmout=setTimeout(function(){n.cancel()},1e3),i.indexOf("/create_new/")!==-1?window.location.href=Upfront.Settings.site_url:i.indexOf("/edit/")!==-1&&_upfront_post_data&&_upfront_post_data.post_id?window.location.href=Upfront.Settings.site_url+"/?p="+_upfront_post_data.post_id:window.location.search.match(/(\?|\&)editmode/)?window.location.search=window.location.search.replace(/(\?|\&)editmode(=[^?&]+)?/,""):void window.location.reload(!0)},stayed:function(){clearTimeout(this.tmout)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/menu/command-wpadmin",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({render:function(){this.$el.html(e.wp_admin)},on_click:function(){window.location.href=Upfront.Settings.admin_url}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/menu/command-help",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({render:function(){this.$el.html(e.help_and_support)},on_click:function(){var t="https://premium.wpmudev.org/upfront-documentation",e=window.open(t,"_blank");e.focus()}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-menu",["scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/commands/commands","scripts/upfront/upfront-views-editor/commands/menu/command-close","scripts/upfront/upfront-views-editor/commands/menu/command-wpadmin","scripts/upfront/upfront-views-editor/commands/menu/command-help"],function(e,i,n,o,r){var s=i.extend({className:"command-more-menu-list",initialize:function(){this.commands=_([new n({model:this.model}),new o({model:this.model}),new r({model:this.model})])}});return e.extend({className:"command-more-menu",initialize:function(){this.menu=new s({model:this.model}),this.opened=!1},render:function(){this.menu.render(),this.$el.html('<i class="upfront-icon upfront-icon-more-menu"></i>'),this.$el.append(this.menu.el),t(document).off("click.more_menu"),t(document).on("click.more_menu",this,this.on_document_click)},on_click:function(){this.toggle_menu(),this.menu.commands.each(function(t){t.delegateEvents()})},on_document_click:function(e){var i=t(e.target),n=e.data;i.closest(n.$el).length>0||i.is(n.$el)||n.close_menu()},toggle_menu:function(){this.opened?this.close_menu():this.open_menu()},open_menu:function(){this.$el.addClass("menu-open"),this.$el.find(".upfront-icon-more-menu").addClass("upfront-icon-more-menu-active"),this.opened=!0,Upfront.Events.trigger("upfront:more_menu:open")},close_menu:function(){this.$el.removeClass("menu-open"),this.$el.find(".upfront-icon-more-menu").removeClass("upfront-icon-more-menu-active"),this.opened=!1,Upfront.Events.trigger("upfront:more_menu:close")}})})}(jQuery),function(){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands",["scripts/upfront/upfront-views-editor/fields","scripts/upfront/upfront-views-editor/commands/commands","scripts/upfront/upfront-views-editor/commands/command","scripts/upfront/upfront-views-editor/commands/command-cancel-post-layout","scripts/upfront/upfront-views-editor/commands/command-delete","scripts/upfront/upfront-views-editor/commands/command-edit-background-area","scripts/upfront/upfront-views-editor/commands/command-general-edit-custom-css","scripts/upfront/upfront-views-editor/commands/command-edit-custom-css","scripts/upfront/upfront-views-editor/commands/command-edit-global-regions","scripts/upfront/upfront-views-editor/commands/command-edit-layout-background","scripts/upfront/upfront-views-editor/commands/command-exit","scripts/upfront/upfront-views-editor/commands/command-export-history","scripts/upfront/upfront-views-editor/commands/command-go-to-type-preview-page","scripts/upfront/upfront-views-editor/commands/command-load-layout","scripts/upfront/upfront-views-editor/commands/command-logo","scripts/upfront/upfront-views-editor/commands/command-merge","scripts/upfront/upfront-views-editor/commands/command-new-page","scripts/upfront/upfront-views-editor/commands/command-new-post","scripts/upfront/upfront-views-editor/commands/command-open-font-manager","scripts/upfront/upfront-views-editor/commands/command-preview-layout","scripts/upfront/upfront-views-editor/commands/command-publish-layout","scripts/upfront/upfront-views-editor/commands/command-redo","scripts/upfront/upfront-views-editor/commands/command-reset-everything","scripts/upfront/upfront-views-editor/commands/command-save-layout","scripts/upfront/upfront-views-editor/commands/command-save-layout-as","scripts/upfront/upfront-views-editor/commands/command-save-post-layout","scripts/upfront/upfront-views-editor/commands/command-select","scripts/upfront/upfront-views-editor/commands/command-toggle-grid","scripts/upfront/upfront-views-editor/commands/command-toggle-mode","scripts/upfront/upfront-views-editor/commands/command-toggle-mode-small","scripts/upfront/upfront-views-editor/commands/command-trash","scripts/upfront/upfront-views-editor/commands/command-undo","scripts/upfront/upfront-views-editor/commands/responsive/command-create-responsive-layouts","scripts/upfront/upfront-views-editor/commands/responsive/command-start-responsive-mode","scripts/upfront/upfront-views-editor/commands/responsive/command-stop-responsive-mode","scripts/upfront/upfront-views-editor/commands/responsive/command-responsive-redo","scripts/upfront/upfront-views-editor/commands/responsive/command-responsive-undo","scripts/upfront/upfront-views-editor/commands/breakpoint/command-add-custom-breakpoint","scripts/upfront/upfront-views-editor/commands/breakpoint/command-breakpoint-dropdown","scripts/upfront/upfront-views-editor/commands/command-open-media-gallery","scripts/upfront/upfront-views-editor/commands/command-popup-list","scripts/upfront/upfront-views-editor/commands/command-menu"],function(t,e,i,n,o,r,s,a,l,p,d,c,u,h,f,g,m,v,b,y,w,k,$,x,U,E,S,C,T,z,I,P,M,j,O,D,A,L,N,V,B,R){var e=e.extend({tagName:"ul",initialize:function(){this.commands=_([new m({model:this.model}),new v({model:this.model}),new x({model:this.model}),new U({model:this.model}),new P({model:this.model}),new k({model:this.model}),new o({model:this.model}),new S({model:this.model}),new C({model:this.model}),new $({model:this.model})]),Upfront.Settings.Debug.transients&&this.commands.push(new c({model:this.model}))}});return{Command:i,Commands:e,Command_CancelPostLayout:n,Command_Delete:o,Command_EditBackgroundArea:r,Command_GeneralEditCustomCss:s,Command_EditCustomCss:a,Command_EditGlobalRegions:l,Command_EditLayoutBackground:p,Command_Exit:d,Command_ExportHistory:c,Command_GoToTypePreviewPage:u,Command_LoadLayout:h,Command_Logo:f,Command_Merge:g,Command_NewPage:m,Command_NewPost:v,Command_OpenFontManager:b,Command_PreviewLayout:y,Command_PublishLayout:w,Command_Redo:k,Command_ResetEverything:$,Command_SaveLayout:x,Command_SaveLayoutAs:U,Command_SavePostLayout:E,Command_Select:S,Command_ToggleGrid:C,Command_ToggleMode:T,Command_ToggleModeSmall:z,Command_Trash:I,Command_Undo:P,Command_CreateResponsiveLayouts:M,Command_StartResponsiveMode:j,Command_StopResponsiveMode:O,Command_ResponsiveRedo:D,Command_ResponsiveUndo:A,Command_AddCustomBreakpoint:L,Command_BreakpointDropdown:N,Command_OpenMediaGallery:V,Command_PopupList:B,Command_Menu:R}})}(),function(t){define("scripts/upfront/upfront-views-editor/topbar",["scripts/upfront/upfront-views-editor/breakpoint"],function(e){return Backbone.View.extend({id:"upfront-ui-topbar",content_views:[],initialize:function(){this.listenTo(Upfront.Events,"sidebar:toggle",this.on_sidebar_toggle)},render:function(){return _.each(this.content_views,function(t){t.render(),this.$el.append(t.el)},this),this},start:function(){this.content_views=[],Upfront.Application.get_current()===Upfront.Settings.Application.MODE.RESPONSIVE&&(this.content_views.push(new e.EditButton),this.content_views.push(new e.Toggler)),t("body").prepend(this.render().el)},stop:function(){this.remove()},on_sidebar_toggle:function(t){t?this.$el.css("left",""):this.$el.css("left",0)}})})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/loading",[],function(){return Backbone.View.extend({className:"upfront-loading",is_done:!1,done_callback:[],done_timeout:!1,initialize:function(t){this.options=t},render:function(){var t=this;this.$el.html('<div class="upfront-loading-ani" />'),this.options.fixed&&this.$el.addClass("upfront-loading-fixed"),this.options.loading_type&&this.$el.addClass(this.options.loading_type),this.options.loading&&this.$el.append('<p class="upfront-loading-text">'+this.options.loading+"</p>"),this.options.loading_notice&&this.$el.append('<p class="upfront-loading-notice">'+this.options.loading_notice+"</p>"),t.options.remove_on_event&&Upfront.Events.once(t.options.remove_on_event,function(){t.remove(),clearTimeout(t.done_timeout),t.done_callback&&_(t.done_callback).each(function(e){e&&e.call&&e.call(t)})}),this.$el.find(".upfront-loading-ani").on("animationend webkitAnimationEnd MSAnimationEnd oAnimationEnd",function(){var e=t.$el.hasClass("upfront-loading-repeat")?"repeat":t.$el.hasClass("upfront-loading-done")?"done":"start";if("start"==e)if(t.is_done&&!t.options.remove_on_event){var i=t.done_text||t.options.done;t.$el.addClass("upfront-loading-done"),t.$el.find(".upfront-loading-text").text(i)}else t.$el.addClass("upfront-loading-repeat");else if("repeat"==e)t.$el.removeClass("upfront-loading-repeat");else if("done"==e){if(t.options.remove_on_event)return;t.remove(),clearTimeout(t.done_timeout),t.done_callback&&_(t.done_callback).each(function(e){e&&e.call&&e.call(t)})}})},update_loading_text:function(t){this.$el.find(".upfront-loading-text").text(t)},on_finish:function(t){this.done_callback.push(t)},done:function(t,e){var i=this,n=i.options.timeout||6e3;this.is_done=!0,this.done_timeout=setTimeout(function(){i&&(i.remove(),_(i.done_callback).each(function(t){t&&t.call&&t.call(i)}))},n),t&&t.call(i),this.done_text=e},cancel:function(t,e){this.remove(),t&&t()}})})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/post-selector/post-selector-navigation",["scripts/upfront/upfront-views-editor/content-editor/content-editor-pagination"],function(e){return e.extend({className:"upfront-selector-navigation",handle_pagination_request:function(e,i){i=i?i:parseInt(t(e.target).attr("data-page_idx"),10)||0;this.collection.pagination;this.options.pageSelection(i)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/post-selector",["scripts/upfront/upfront-views-editor/post-selector/post-selector-navigation","scripts/upfront/upfront-views-editor/loading","text!upfront/templates/popup.html"],function(i,n,o){return Backbone.View.extend({postTypeTpl:_.template(t(o).find("#selector-post_type-tpl").html()),postListTpl:_.template(t(o).find("#selector-post-tpl").html()),postType:"post",posts:[],pagination:!1,selected:!1,deferred:!1,popup:!1,defaultOptions:{title:e.select_content_to_link,postTypes:[{name:"post",label:e.posts},{name:"page",label:e.pages}]},events:{"click .upfront-field-select-value":"openTypesSelector","click .upfront-field-select-option":"selectType","click .upfront-selector-post":"selectPost","click .use":"postOk","click #upfront-search_action":"search","keyup .search_container>input":"inputSearch"},initialize:function(){("post_types"in Upfront.mainData.content_settings?Upfront.mainData.content_settings:{post_types:[]}).post_types.length&&(this.defaultOptions.postTypes=Upfront.mainData.content_settings.post_types)},open:function(n){var o=this,r=!1;return n=_.extend({},this.defaultOptions,n),t("#upfront-popup").length||"upfront-popup"==this.$el.attr("id")||(r=!0),this.popup=Upfront.Popup.open(function(){}),this.deferred=t.Deferred(),this.posts=new Upfront.Collections.PostList([],{postType:"page"}),this.posts.pagination.pageSize=20,this.pagination=new i({collection:this.posts,pageSelection:function(t){o.fetch({page:t})}}),this.setElement(t("#upfront-popup")),this.$("#upfront-popup-top").html('<h3 class="upfront-selector-title">'+n.title+"</h3>"),this.$("#upfront-popup-content").html(this.postTypeTpl(n)),this.fetch({}),this.$("#upfront-popup-bottom").html('<div class="use_selection_container inactive"><a href="#use" class="use">'+Upfront.Settings.l10n.global.content.ok+'</a></div><div class="search_container clearfix"><input type="text" placeholder="'+e.search+'" value=""><div class="search upfront-icon upfront-icon-popup-search" id="upfront-search_action"></div></div>').append(this.pagination.$el),t("#upfront-popup").addClass("upfront-postselector-popup"),this.$(".upfront-field-select-value").text(e.pages),this.deferred.promise()},openTypesSelector:function(){var t=this.$(".upfront-field-select");t.hasClass("open")?t.removeClass("open"):t.addClass("open")},selectType:function(e){var i=t(e.target).attr("rel");i!=this.posts.postType&&(this.$(".upfront-field-select-value").text(t(e.target).text()),this.$(".upfront-field-select").removeClass("open"),this.fetch({postType:i}))},selectPost:function(e){t(e.currentTarget);this.$(".upfront-selector-post.selected").removeClass("selected"),this.selected=t(e.currentTarget).addClass("selected").attr("rel"),this.$(".use_selection_container").removeClass("inactive")},postOk:function(t){if(t.preventDefault(),this.selected)return Upfront.Popup.close(),this.deferred.resolve(this.posts.get(this.selected))},fetch:function(t){var i=this,o=new n({loading:e.loading,done:e.thank_you_for_waiting,fixed:!1});this.$(".use_selection_container").addClass("inactive"),this.selected=!1,o.render(),this.$("#upfront-selector-posts").append(o.$el),t.postType&&t.postType!=this.posts.postType&&(t.flush=!0,this.posts.postType=t.postType);var r=t.page;r||(r=0),this.posts.fetchPage(r,t).done(function(t){o.done(),i.$("#upfront-selector-posts").find("table").remove(),i.$("#upfront-selector-posts").append(i.postListTpl({posts:i.posts.getPage(r)})),i.pagination.render()})},search:function(t){t.preventDefault();var e=this.$(".search_container input").val();e?this.fetch({search:e,flush:!0}):this.$(".search_container input").focus()},inputSearch:function(t){13==t.which&&this.search(t)}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel",["scripts/upfront/upfront-views-editor/mixins","scripts/perfect-scrollbar/perfect-scrollbar"],function(e,i){return Backbone.View.extend(_.extend({},e.Upfront_Scroll_Mixin,{tagName:"li",className:"sidebar-panel",events:{"click .sidebar-panel-title":"on_click","click .sidebar-panel-tab":"show_tab"},get_title:function(){return""},render:function(){var t=this;this.active?this.$el.addClass("active"):this.$el.removeClass("active"),this.$el.html('<h3 class="sidebar-panel-title">'+this.get_title()+'</h3><div class="sidebar-panel-content" />'),this.stop_scroll_propagation(this.$el.find(".sidebar-panel-content")),this.sections&&(t.$el.find(".sidebar-panel-title").after("<ul class='sidebar-panel-tabspane'></ul>"),this.sections.each(function(e){e.render(),t.$el.find(".sidebar-panel-tabspane").append("<li data-target='"+e.cid+"' class='sidebar-panel-tab'>"+e.get_title()+"</li>"),t.$el.find(".sidebar-panel-content").append("<div class='sidebar-tab-content' id='"+e.cid+"'></div>"),t.$el.find(".sidebar-panel-content").find(".sidebar-tab-content").last().html(e.el),i.withDebounceUpdate(t.$el.find(".sidebar-panel-content")[0],!0,"entity:object:refresh",!0)})),this.on_render&&this.on_render(),this.$el.find(".sidebar-panel-tab").first().addClass("active"),this.$el.find(".sidebar-tab-content").first().show()},get_section:function(t){return!!this.sections&&this.sections.find(function(e){return e.get_name()==t})},on_click:function(){t(".sidebar-panel").not(this.$el).removeClass("expanded"),this.$el.addClass("expanded"),t(".sidebar-panel").not(this.$el).find(".sidebar-panel-tabspane").hide(),this.$el.find(".sidebar-panel-tabspane").not(".sidebar-panel-tabspane-hidden").show(),i.withDebounceUpdate(this.$el.find(".sidebar-panel-content")[0],!1,!1,!1)},show_tab:function(e){var i="#"+t(e.target).data("target");this.$el.find(".sidebar-panel-tab").removeClass("active"),t(e.target).addClass("active"),this.$el.find(".sidebar-tab-content").hide(),this.$el.find(i).show()}}))})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/draggable-element",[],function(){return Backbone.View.extend({tagName:"span",className:"draggable-element upfront-no-select",shadow_id:"",draggable:!0,priority:1e4,initialize:function(t){this.options=t,this.title=t.title||e.no_title},render:function(){this.$el.html(this.title)},add_module:function(t){var e=this.model.get("regions").get_by_name("shadow");return!(!e||!e.get)&&(this.shadow_id=Upfront.Util.get_unique_id("shadow"),t.set({shadow:this.shadow_id},{silent:!0}),void e.get("modules").add(t))}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-profile",[],function(){return Backbone.View.extend({className:"sidebar-profile",render:function(){var t=Upfront.data.currentUser;t||(t=new Backbone.Model);var i,n=t.get("data")||{},o=t.get("roles")||[];i='<div class="sidebar-profile-avatar"><img src="//www.gravatar.com/avatar/{{ gravatar ? gravatar : "gravatar" }}?s=25" /></div><div class="sidebar-profile-detail"><span class="sidebar-profile-name">{{name}}</span><span class="sidebar-profile-role">{{role}}</span></div>'+(o.length?'<div class="sidebar-profile-edit"><a class="upfront-icon upfront-icon-edit" data-bypass="true" title="'+e.edit_profile+'" href="{{edit_url}}">'+e.edit_profile+"</a></div>":""),this.$el.html(_.template(i,{gravatar:n.gravatar,name:n.display_name||e.anonymous,role:o[0]||e.none,edit_url:Upfront.Settings.admin_url+"profile.php"}))}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section",[],function(){return Backbone.View.extend({tagName:"div",className:"panel-section",initialize:function(){this.settings=_([])},get_title:function(){},render:function(){var t=this;this.$el.html(""),this.$el.append('<div class="panel-section-content" />'),this.settings.each(function(e){e.render(),e.delegateEvents(),t.$el.find(".panel-section-content").append(e.el)}),this.on_render&&this.on_render()}})})}(jQuery),function(t,e){var i=["text!upfront/templates/content.html","upfront/post-editor/upfront-post-content","upfront/post-editor/upfront-post-layout"];define("content",i,function(e,i){var n=function(t){var e=this;this.postId=t.post_id,this.autostart=t.autostart||!1,this.content_mode=t.content_mode,this.changed={},_.extend(this,Backbone.Events),this.contentEditor=!1,this.reboot=_.throttle(this._reboot,1e3,{leading:!1,trailing:!0}),this.getPost().done(function(){e.contentEditor=new i.PostContentEditor({post:e.post,content_mode:e.content_mode}),e.reboot()})};n.prototype={_partViews:[],_reboot:function(){this.trigger("loaded",this.contentEditor),this.stopListening(this.contentEditor,"cancel"),this.listenTo(this.contentEditor,"cancel",this.cancelChanges),this.stopListening(this.contentEditor,"publish"),this.listenTo(this.contentEditor,"publish",this.publish),this.stopListening(this.contentEditor,"draft"),this.listenTo(this.contentEditor,"draft",this.saveDraft),this.stopListening(this.contentEditor,"auto-draft"),this.listenTo(this.contentEditor,"auto-draft",this.saveAutoDraft),this.stopListening(this.contentEditor,"trash"),this.listenTo(this.contentEditor,"trash",this.trash),this.stopListening(this.contentEditor,"edit:start"),this.listenTo(this.contentEditor,"edit:start",this.editStart),this.stopListening(this.contentEditor,"edit:stop"),this.listenTo(this.contentEditor,"edit:stop",this.editStop),this.stopListening(this.contentEditor,"change:title"),this.listenTo(this.contentEditor,"change:title",this.changeTitle),this.stopListening(Upfront.Events,"change:title"),this.listenTo(Upfront.Events,"change:title",this.changeTitle),this.stopListening(this.contentEditor,"change:content"),this.listenTo(this.contentEditor,"change:content",this.changeContent),this.stopListening(this.contentEditor,"change:author"),this.listenTo(this.contentEditor,"change:author",this.changeAuthor),this.stopListening(this.contentEditor,"change:date"),this.listenTo(this.contentEditor,"change:date",this.changeDate),this.stopListening(this.contentEditor,"bar:date:updated"),this.listenTo(this.contentEditor,"bar:date:updated",this.changeDate)},addPartView:function(e,i,n,o){var r=new t.Deferred;return this._partViews.push({type:e,el:i,model:n,parentModel:o,deferred:r}),this.setPartViews(),r.promise()},setPartViews:function(){if(this.contentEditor){var t=this._partViews.pop();if(t){var e=this.contentEditor.setView(t.type,t.el,t.model,t.parentModel);t.deferred.resolve(e)}}},setDefaults:function(){this.mode="content"},remove:function(){this.contentEditor&&this.contentEditor.box&&(this.contentEditor.box.remove(),this.contentEditor.box.undelegateEvents())},getPost:function(){var e=t.Deferred();if(this.post&&(e.resolve(this.post),this.loadingPost=e.promise()),this.loadingPost)return this.loadingPost;Upfront.data.posts[this.postId];return this.fetchPost()},fetchPost:function(){var e=this,i=t.Deferred();return this.post=new Upfront.Models.Post({ID:this.postId}),e.loadingPost=i.promise(),this.post.fetch({withMeta:!0}).done(function(t){Upfront.data.posts||(Upfront.data.posts={}),Upfront.data.posts[e.postId]=e.post,i.resolve(e.post)}),this.loadingPost},stopEditContents:function(){this.contentEditor.stopEditors(),this.trigger("stop")},cancelChanges:function(){this.stopEditContents(),this.trigger("post:cancel")},publish:function(t){var e="publish";"undefined"!=typeof t.status&&"publish"!==t.status&&(e=t.status),this.save(t,e,Upfront.Settings.l10n.global.content.publishing.replace(/%s/,this.post.get("post_type")),Upfront.Settings.l10n.global.content.published.replace(/%s/,this.capitalize(this.post.get("post_type"))))},saveDraft:function(t){this.save(t,"draft",Upfront.Settings.l10n.global.content.saving.replace(/%s/,this.post.get("post_type")),Upfront.Settings.l10n.global.content.drafted.replace(/%s/,this.capitalize(this.post.get("post_type"))))},saveAutoDraft:function(t){this.save(t,"auto-draft")},trash:function(){var e=this,i=this.post.get("post_type"),n=t(Upfront.Settings.LayoutEditor.Selectors.main),o=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.content.deleting.replace(/%s/,i),done:Upfront.Settings.l10n.global.content.here_we_are,fixed:!1});o.render(),n.append(o.$el),this.post.set("post_status","trash").save().done(function(){o.$el.remove(),Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.content.deleted.replace(/%s/,i)),e.stopEditContents(),e.trigger("post:trash"),_upfront_post_data&&(_upfront_post_data.post_id=!1),Upfront.Application.navigate("/",{trigger:!0}),Upfront.Events.trigger("click:edit:navigate",!1)})},save:function(e,i,n,o){var r=this,s=(this.changed,!0),a=!s,l="auto-draft"===i,p=this.post.get("post_name"),d=(t(Upfront.Settings.LayoutEditor.Selectors.main),!1);l&&(i="draft"),e.title&&this.post.set("post_title",e.title),e.excerpt&&this.post.set("post_excerpt",e.excerpt),e.content&&this.post.set("post_content",e.content),e.author&&this.post.set("post_author",e.author),e.inserts&&this.post.meta.setValue("_inserts_data",e.inserts),e.date&&this.post.set("post_date",e.date),e.visibility&&(this.post.setVisibility(e.visibility),e.pass&&this.post.set("post_password",e.pass)),e.date&&this.post.set("post_date",e.date),this.post.set("post_status",i),!t("body").hasClass("is_new")||"undefined"!=typeof _upfront_post_data.post_name_updated&&_upfront_post_data.post_name_updated||this.post.set("post_name",""),_upfront_post_data.post_name_updated=!1,this.post.save().done(function(t){r.post.is_new&&p.length&&r.post.set("post_name",p).save(),r.post.set("post_name",t.data.post_name),r.post.permalink=t.data.permalink,a&&(l||(Upfront.Views.Editor.notify(o),r.stopEditContents(),r.trigger("post:saved"))),Upfront.Events.trigger("post:saved"),d=!0}),s?r.post.meta.save().done(function(){d&&(l||(Upfront.Views.Editor.notify(o),r.stopEditContents(),r.trigger("post:saved"))),a=!0}):a=!0,this.post.is_new=!1},capitalize:function(t){return t.charAt(0).toUpperCase()+t.slice(1)},preventLinkNavigation:function(t){t.preventDefault()},editStart:function(){this.trigger("editor:edit:start")},editStop:function(){this.trigger("editor:edit:stop")},changeTitle:function(t){this.trigger("editor:change:title",t)},changeContent:function(t,e){this.trigger("editor:change:content",t,e)},changeAuthor:function(t){this.trigger("editor:change:author",t)},changeDate:function(t){this.trigger("editor:change:date",t)}},_.extend(n.prototype,Backbone.Events.prototype);var o=Backbone.View.extend(_.extend({},n.prototype,{tpl:Upfront.Util.template(e),events:{dblclick:"editContents","click a":"preventLinkNavigation"},initialize:function(e){this.postId=e.post_id,this.setElement(e.node),this.autostart=e.autostart||!1,this.content_mode=e.content_mode,this.changed={},Upfront.data.posts[this.postId]&&(this.post=Upfront.data.posts[this.postId],this.post.meta.length||this.post.meta.fetch(),this.loadingPost=new t.Deferred,this.loadingPost.resolve(this.post)),this.postView=e.view,this.getPost(),this.getPostLayout()},getPostLayout:function(){if(this.loadingLayout)return this.loadingLayout;var e,i=this,n=t.Deferred();return i.postView.postLayout&&i.postView.parts[i.postId]?(e={postLayout:i.postView.postLayout,partOptions:i.postView.partOptions||{}},i.layoutData=!0,i.parts=i.postView.parts[i.postId],n.resolve(e),this.loadingLayout=n.promise(),this.loadingLayout):(this.loadingLayout=this.fetchPostLayout(),this.loadingLayout)},fetchPostLayout:function(){var e=t.Deferred(),i=this,n="ThisPostModel"==i.postView.property("type")?"single":"archive",o="single"==n?this.postId:i.postView.property("element_id").replace("uposts-object-",""),r={hide_featured_image:i.postView.property("hide_featured_image"),full_featured_image:i.postView.property("full_featured_image")};return this.getPost().done(function(){Upfront.Util.post({action:"upfront_get_postlayout",type:n,id:o,layout_cascade:Upfront.Application.current_subapplication.get_layout_data().layout,post_id:i.postId,post_type:i.post.get("post_type"),properties:r}).done(function(t){var n=t.data;n.partOptions||(n.partOptions={}),_.extend(i.postView,n),i.postView.parts||(i.postView.parts={}),i.postView.parts[i.postId]=n.partContents,i.parts=n.partContents,i.layoutData=!0,e.resolve(n)}).fail(function(t){console.log("error!!")})}),e.promise()},render:function(){var t=this,e=i.getMarkupper();if(!this.layoutData)return this.$el.html(Upfront.Settings.l10n.global.content.loading),this.loadingLayout.done(function(){t.render()});var n=this.postView.postLayout||{},o=this.postView.partOptions||{},r={wrappers:n,wrappersLength:n.length,extraClasses:{},attributes:{}};_.each(n,function(i){i.objectsLength=i.objects.length,_.each(i.objects,function(i){var n=o&&o[i.slug]&&o[i.slug].attributes?o[i.slug].attributes:{},s="";_.each(n,function(t,e){s+=e+'="'+t+'" '}),r.attributes[i.slug]=s,r.extraClasses[i.slug]=o&&o[i.slug]&&o[i.slug].extraClasses?o[i.slug].extraClasses:"",i.slug in t.parts.classes&&t.parts.classes[i.slug]&&t.parts.classes[i.slug].length&&(r.extraClasses[i.slug]=t.parts.classes[i.slug].join(" ")),i.markup=e.markup(i.slug,t.parts.replacements,t.getTemplate(i.slug))})}),this.$el.html(this.tpl(r)),this.setContentPadding(),this.trigger("rendered")},getTemplate:function(t){var e=this.postView.partTemplates;return"contents"==t&&"post_excerpt"==this.content_mode&&(t="excerpt"),e&&e[t]?e[t]:Upfront.data.thisPost.templates[t]},editContents:function(e,n){if(Upfront.Application.user_can("EDIT")!==!1||parseInt(this.post.get("post_author"),10)===Upfront.data.currentUser.id&&Upfront.Application.user_can("EDIT_OWN")===!0){var o=this,r=function(){arguments.callee.iter=arguments.callee.iter||0,arguments.callee.iter++,arguments.callee.iter<30&&setTimeout(function(){o.editContents(e,n)},100)};if(!this.contentEditor&&!0!==Upfront.plugins.isForbiddenByPlugin("trigger post editor")){if(!this.layoutData||!this.post)return void r();if(this.$el.find(".upfront-content-marker").length<1)return this.render(),void r();var s=e?t(e.currentTarget):n;this.contentEditor=new i.PostContentEditorLegacy({post:this.post,postView:this.postView,content_mode:this.content_mode,el:this.el,triggeredBy:s,authorTpl:this.getTemplate("author"),partOptions:this.postView.partOptions,rawContent:this.parts.replacements["%raw_content%"],rawExcerpt:this.parts.replacements["%raw_excerpt%"]}),this.$el.closest(".upfront-wrapper").addClass("upfront-postcontent-editor"),Upfront.Events.trigger("post:content:edit:start",this.contentEditor),this.listenTo(this.contentEditor,"cancel",this.cancelChanges),this.listenTo(this.contentEditor,"publish",this.publish),this.listenTo(this.contentEditor,"draft",this.saveDraft),this.listenTo(this.contentEditor,"auto-draft",this.saveAutoDraft),this.listenTo(this.contentEditor,"trash",this.trash),this.contentEditor.focus(this.contentEditor.parts.titles,!0)}}},stopEditContents:function(){this.stopListening(this.contentEditor),this.contentEditor.stop(),this.contentEditor=!1,this.$el.closest(".upfront-wrapper").removeClass("upfront-postcontent-editor"),Upfront.Events.trigger("post:content:edit:stop",this.contentEditor)},cancelChanges:function(){this.stopEditContents(),this.render()},trash:function(){var t=this,e=this.post.get("post_type"),i=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.content.deleting.replace(/%s/,e),done:Upfront.Settings.l10n.global.content.here_we_are,fixed:!1});i.render(),this.$el.append(i.$el),this.post.set("post_status","trash").save().done(function(){i.$el.remove(),Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.content.deleted.replace(/%s/,e)),t.stopEditContents(),"UpostsModel"==t.postView.property("type")&&t.postView.refreshMarkup(),Upfront.Application.sidebar.toggleSidebar(),_upfront_post_data&&(_upfront_post_data.post_id=!1),Upfront.Application.navigate("/",!0)})},save:function(t,e,i,o){var r=this,s=function(){r.fetchPostLayout().then(function(){
r.render()})};this.once("post:saved",s),t.content&&"excerpt"==this.postView.property("content_type")&&(t.excerpt=t.content,t.content=!1),n.prototype.save.call(this,t,e,i,o)},setContentPadding:function(){var e=Upfront.Behaviors.GridEditor.col_size,i=this.postView.partOptions,n=i.contents?i.contents.padding_right*e:0,o=i.contents?i.contents.padding_left*e:0,r=this.postView.$(".upfront-post-padding"),s="#"+this.postView.property("element_id")+" .upfront-content-marker-contents>* {";r.length||(r=t('<style class="upfront-post-padding"></style>'),this.postView.$el.append(r)),s+="padding-left: "+o+"px; padding-right: "+n+"px;}",r.html(s)}}));Upfront.Content||(Upfront.Content={}),Upfront.Content.PostEditor=n,Upfront.Content.PostEditorLegacy=o})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-post-details",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section"],function(t){return t.extend({initialize:function(t){this.options=t,this.settings=_([]);var e=this;return Upfront.Views.PostDataEditor?void this.initialize_post_data_editor():void require(["content"],function(){e.getPostId()!==!1&&(setTimeout(e.prepare_editor(e)),e.initialize_post_data_editor())})},initialize_post_data_editor:function(){var t=this;this.listenTo(Upfront.Views.PostDataEditor,"loaded",function(e){e&&Upfront.Views.PostDataEditor&&(Upfront.Views.PostDataEditor.contentEditor=e,Upfront.Views.PostBox=Upfront.Views.PostDataEditor.contentEditor.prepareBox(),t.append_box())}),this.listenTo(Upfront.Views.PostDataEditor,"post:saved",function(){this.render()}),this.stopListening(Upfront.Events,"click:edit:navigate"),this.listenTo(Upfront.Events,"click:edit:navigate",function(e){"undefined"!=typeof e&&e&&setTimeout(t.prepare_editor(t))}),"undefined"!=typeof Upfront.Views.PostDataEditor&&Upfront.Views.PostDataEditor.contentEditor!==!1&&(Upfront.Views.PostBox=Upfront.Views.PostDataEditor.contentEditor.prepareBox()),Upfront.Views.PostDataEditor&&Upfront.Views.PostBox&&t.append_box(Upfront.Views.PostBox),this.editor=Upfront.Views.PostDataEditor},get_name:function(){return"post_details"},get_title:function(){return Upfront.Application.is_single("page")?e.page_settings:e.post_settings},on_render:function(){Upfront.Views.PostDataEditor&&Upfront.Views.PostBox&&this.append_box(Upfront.Views.PostBox)},prepare_editor:function(t){return"undefined"!=typeof Upfront.Views.PostDataEditor&&(Upfront.Views.PostDataEditor||{}).postId===t.getPostId()?(Upfront.Views.PostDataEditor.reboot(),!0):("undefined"!=typeof Upfront.Views.PostDataEditor&&Upfront.Views.PostDataEditor.remove(),void(Upfront.Views.PostDataEditor=new Upfront.Content.PostEditor({editor_id:"this_post_"+t.getPostId(),post_id:t.getPostId(),content_mode:"post_content"})))},getPostId:function(){return postId=_upfront_post_data.post_id?_upfront_post_data.post_id:!!Upfront.Settings.LayoutEditor.newpostType&&0,this.postId||!0!==Upfront.plugins.isRequiredByPlugin("generate fake post id")?this.postId||!0!==Upfront.plugins.isRequiredByPlugin("generate fake post id")||Upfront.Application.mode.current!==Upfront.Application.MODE.CONTENT_STYLE||(postId="fake_styled_post"):postId="fake_post",postId},append_box:function(){var t=this,e=Upfront.Views.PostBox;setTimeout(function(){t.$el.empty(),t.$el.append(e.$el),e.rebindEvents()},50)},on_cancel:function(){this.child_view&&this.child_view.rerender()},on_edit_start:function(){this.child_view&&(this.child_view._do_cache=!1)},on_edit_stop:function(){this.child_view&&(this.child_view._do_cache=!0)},on_title_change:function(t){},on_content_change:function(t,e){},on_author_change:function(t){if(this.child_view){var e=this.model.get_property_value_by_name("data_type");this.authorId=t,"author"==e&&this.child_view.render()}},on_date_change:function(t){if(this.child_view){var e=this.model.get_property_value_by_name("data_type");this.postDate=Upfront.Util.format_date(t,!0,!0).replace(/\//g,"-"),"post_data"==e&&this.child_view.render(["date_posted"])}}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-post-tag-category",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section","upfront/post-editor/upfront-post-edit"],function(t,e){return t.extend({initialize:function(t){this.options=t,this.options.call=!1,this.settings=_([])},get_name:function(){return"tag_category"},get_title:function(){return"Cats / Tags"},on_render:function(){var t=this;this.options.call||(this.$el.append('<div class="upfront-categories-wrapper"></div>'),this.$el.append('<div class="upfront-tags-wrapper"></div>'),post=new Upfront.Models.Post({ID:this.options.postId}),post.fetch().done(function(e){t.renderTaxonomyEditor(t.options.postId,"category",post),t.renderTaxonomyEditor(t.options.postId,"post_tag",post)}),this.options.call=!0)},renderTaxonomyEditor:function(t,i,n){i="undefined"==typeof i?"category":i;var o=this,r=new Upfront.Collections.TermList([],{postId:t,taxonomy:i});return!!this._post_type_has_taxonomy(i,n)&&void r.fetch({allTerms:!0}).done(function(t){var n=t.data.taxonomy.hierarchical?e.ContentEditorTaxonomy_Hierarchical:e.ContentEditorTaxonomy_Flat,s=new n({collection:r,tax:i});s.allTerms=new Upfront.Collections.TermList(t.data.allTerms),s.render(),t.data.taxonomy.hierarchical?o.$el.find(".upfront-categories-wrapper").append(s.$el):o.$el.find(".upfront-tags-wrapper").append(s.$el)})},_post_type_has_taxonomy:function(t,e){if(!t)return!0;var i=e.get("post_type")||"post";return"page"!==i}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-page-template",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section","upfront/post-editor/upfront-post-edit"],function(t,i){return t.extend({initialize:function(t){this.options=t,this.settings=_([]),this.templates=_([]),this.layouts=_([]),this.options.call=!1,this.layoutList=new Upfront.Collections.PageTemplateList([],{postId:this.options.postId}),this.load_dev=_upfront_storage_key!=_upfront_save_storage_key?1:0},get_name:function(){return"templates"},get_title:function(){return e.label_page_template},on_render:function(){var t=this;this.options.call||(this.layoutList.fetch({load_dev:t.load_dev,template_type:"layout"}).done(function(e){t.layouts=new Upfront.Collections.PageTemplateList(e.data.results),t.layoutList.fetch({load_dev:t.load_dev,template_type:"page"}).done(function(e){t.templates=new Upfront.Collections.PageTemplateList(e.data.results),t.append_template_box()})}),this.options.call=!0)},append_template_box:function(){var t=this,n=new i.PageTemplateEditor({collection:t.layoutList,label:e.label_page_template});setTimeout(function(){n.allPageTemplates=t.templates,n.allPageLayouts=t.layouts,n.render(),n.delegateEvents(),t.$el.empty(),t.$el.append(n.$el),n.after_append()},300)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-post-editor",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-post-details","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-post-tag-category","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-page-template"],function(t,i,n,o){return t.extend({className:"sidebar-panel sidebar-panel-post-editor",initialize:function(t){var e=this;this.active=!0,this.postId=this.getPostId(),this.sections=_([new i({model:this.model,postId:this.postId})]),Upfront.Application.is_single("post")?e.sections.push(new n({model:e.model,postId:this.postId})):Upfront.Application.is_single("page")&&e.sections.push(new o({model:e.model,postId:this.postId})),Upfront.Events.off("command:layout:save",this.on_save,this),Upfront.Events.on("command:layout:save",this.on_save,this),Upfront.Events.off("command:layout:save_as",this.on_save,this),Upfront.Events.on("command:layout:save_as",this.on_save,this),Upfront.Events.off("command:layout:save_post_layout",this.on_save,this),Upfront.Events.on("command:layout:save_post_layout",this.on_save,this),Upfront.Events.off("command:layout:publish",this.on_save,this),Upfront.Events.on("command:layout:publish",this.on_save,this),Upfront.Events.off("command:layout:save_success",this.on_save_after,this),Upfront.Events.on("command:layout:save_success",this.on_save_after,this),Upfront.Events.off("command:layout:save_error",this.on_save_after,this),Upfront.Events.on("command:layout:save_error",this.on_save_after,this),Upfront.Events.off("entity:drag_stop",this.reset_modules,this),Upfront.Events.on("entity:drag_stop",this.reset_modules,this),Upfront.Events.off("layout:render",this.apply_state_binding,this),Upfront.Events.on("layout:render",this.apply_state_binding,this)},get_title:function(){return Upfront.Application.is_single("page")?e.page_settings:e.post_settings},on_save:function(){var t=this.model.get("regions");this._shadow_region=t.get_by_name("shadow"),t.remove(this._shadow_region,{silent:!0})},on_preview:function(){return this.on_save()},apply_state_binding:function(){Upfront.Events.on("command:undo",this.reset_modules,this),Upfront.Events.on("command:redo",this.reset_modules,this)},on_render:function(){var t=this;setTimeout(function(){t.$el.find(".sidebar-panel-title").trigger("click")},200)},_post_type_has_taxonomy:function(t,e){if(!t)return!0;var i=e.get("post_type")||"post";return"page"!==i},getPostId:function(){return postId=_upfront_post_data.post_id?_upfront_post_data.post_id:!!Upfront.Settings.LayoutEditor.newpostType&&0,this.postId||!0!==Upfront.plugins.isRequiredByPlugin("generate fake post id")?this.postId||!0!==Upfront.plugins.isRequiredByPlugin("generate fake post id")||Upfront.Application.mode.current!==Upfront.Application.MODE.CONTENT_STYLE||(postId="fake_styled_post"):postId="fake_post",postId}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-layout-elements",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section"],function(e){return e.extend({initialize:function(){this.settings=_([]),this.elements=_([])},get_name:function(){return"layout"},get_title:function(){return"Layout"},on_render:function(){this.elements.each(this.render_element,this)},render_element:function(e){if(e.draggable){t(Upfront.Settings.LayoutEditor.Selectors.main);e.remove(),e.render(),this.$el.find(".panel-section-content").append(e.el),e.$el.on("mousedown",function(i){var n=t(Upfront.Settings.LayoutEditor.Selectors.main),o=t("[data-shadow="+e.shadow_id+"]"),r=n.offset(),s=o.position(),a=o.offset(),l=(e.$el.offset(),o.outerHeight()),p=o.outerWidth(),d=e.$el.clone(),c=e.$el.outerHeight(),u=e.$el.outerWidth(),h=t('<div id="element-drag-wrapper" class="upfront-ui" />'),f=t(".upfront-grid-layout-gutter-left:first, .upfront-grid-layout-gutter-right:first");o.css({position:"absolute",top:i.pageY-(a.top-s.top)-l/2,left:i.pageX-(a.left-s.left)-p/2,visibility:"hidden",zIndex:-1}).one("mousedown",function(t){}).trigger(i).one("dragstart",function(i,n){e.$el.addClass("element-drag-active"),t("body").append(h),d.appendTo(h),d.addClass("element-dragging"),d.css({position:"absolute",top:i.pageY-c/2,left:i.pageX-u/2,zIndex:999})}).on("drag",function(e,i){var n=!1;f.each(function(){if(!n){var i=t(this).offset(),o=t(this).width();e.pageX>=r.left&&e.pageX>=i.left+10&&e.pageX<=i.left+o-10&&(n=!0)}}),n?d.addClass("element-dragging-no-drop"):d.removeClass("element-dragging-no-drop"),d.css({top:e.pageY-c/2,left:e.pageX-u/2})}).one("dragstop",function(t,i){e.$el.removeClass("element-drag-active"),d.remove(),h.remove()})})}}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-data-elements",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-layout-elements"],function(t){return t.extend({get_name:function(){return"data"},get_title:function(){return"Data"}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-plugins-elements",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-layout-elements"],function(t){return t.extend({get_name:function(){return"plugins"},get_title:function(){return"Plugins"}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-draggable-elements",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-layout-elements","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-data-elements","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-plugins-elements"],function(t,i,n,o){return t.extend({className:"sidebar-panel sidebar-panel-elements",initialize:function(){this.active=!0,this.sections=_([new i({model:this.model}),new n({model:this.model}),new o({model:this.model})]),this.elements=_([]),Upfront.Events.on("command:layout:save",this.on_save,this),Upfront.Events.on("command:layout:save_as",this.on_save,this),Upfront.Events.on("command:layout:publish",this.on_save,this),Upfront.Events.on("command:layout:save_success",this.on_save_after,this),Upfront.Events.on("command:layout:save_error",this.on_save_after,this),Upfront.Events.on("entity:drag_stop",this.reset_modules,this),Upfront.Events.on("layout:render",this.apply_state_binding,this)},get_title:function(){return e.draggable_elements},on_save:function(){var t=this.model.get("regions");this._shadow_region=t.get_by_name("shadow"),t.remove(this._shadow_region,{silent:!0})},on_preview:function(){return this.on_save()},apply_state_binding:function(){Upfront.Events.on("command:undo",this.reset_modules,this),Upfront.Events.on("command:redo",this.reset_modules,this)},on_render:function(){var t=this;this.reset_modules(),!1===Upfront.plugins.isForbiddenByPlugin("toggle first sidebar panel")&&setTimeout(function(){t.$el.find(".sidebar-panel-title").trigger("click")},100)},on_save_after:function(){var t=this.model.get("regions");this._shadow_region?t.add(this._shadow_region,{silent:!0}):this.reset_modules()},get_elements:function(){var t=[];return this.sections&&this.sections.each(function(e){e.elements.size()&&t.push(e.elements.value())}),_(_.flatten(t))},update_sections:function(){if(this.sections){var t=this,e=0;this.sections.each(function(i){i.elements&&i.elements.size()>0?e++:(t.$el.find(".sidebar-panel-tabspane [data-target="+i.cid+"]").hide(),t.$el.find(".sidebar-panel-content #"+i.cid).hide())}),e<=1?this.$el.find(".sidebar-panel-tabspane").addClass("sidebar-panel-tabspane-hidden"):this.$el.find(".sidebar-panel-tabspane").removeClass("sidebar-panel-tabspane-hidden")}},reset_modules:function(){var t=this.model.get("regions"),e=!!t&&t.get_by_name("shadow"),i=this.get_elements();if(this.update_sections(),!t)return!1;if(e||(e=new Upfront.Models.Region({name:"shadow",container:"shadow",title:"Shadow Region"}),this.model.get("regions").add(e)),e.get("modules").length!=i.size()){var n=e.get("modules");i.each(function(t){var e=!1;n.forEach(function(i){i.get("shadow")==t.shadow_id&&(e=!0)}),e||t.add_element()},this)}}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-posts",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-draggable-elements"],function(t){return t.extend({className:"sidebar-panel upfront-panel-post_panel",parts:["Title","Contents","Excerpt","Featured Image","Author","Author Gravatar","Date","Update","Comments Count","Tags","Categories"],partElements:[],initialize:function(t){this.active=!1,this.elements=_([]),Upfront.Events.on("entity:drag_stop",this.reset_modules,this),Upfront.Events.on("layout:render",this.apply_state_binding,this)},get_title:function(){return e.post_components},loadElements:function(){this.elements=_([]);var t=this,e=Upfront.Content.PostElement,i=Upfront.Application.LayoutEditor.Objects;return _.each(this.parts,function(n){var o=new e({title:n,model:Upfront.Application.layout}),r="PostPart_"+o.slug;t.elements.push(o),i[r]||(i[r]={Model:o.Model,View:o.View,Element:e,Settings:o.Settings},Upfront.Models[r+"Model"]=o.Model,Upfront.Views[r+"View"]=o.View),t.partElements.push(o)}),Upfront.Events.trigger("sidebar:postparts:loaded"),this},unloadElements:function(){var t=Upfront.Application.LayoutEditor.Objects;return _.each(this.partElements,function(e){var i="PostPart_"+e.slug;e.remove(),delete t[i],delete Upfront.Models[i+"Model"],delete Upfront.Views[i+"View"]}),this.partElements=[],Upfront.Events.trigger("sidebar:postparts:unloaded"),this}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item",[],function(){return Backbone.View.extend({tagName:"div",className:"panel-setting upfront-no-select",render:function(){this.on_render&&this.on_render()}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item-typography-editor",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item","scripts/upfront/upfront-views-editor/fonts","scripts/upfront/upfront-views-editor/commands/command-open-font-manager","scripts/upfront/upfront-views-editor/fields","scripts/upfront/upfront-views-editor/breakpoint"],function(i,n,o,r,s){return i.extend({fields:{},current_element:"h1",elements:["h1","h2","h3","h4","h5","h6","p","a","a:hover","pre","ul","ol","blockquote","blockquote.upfront-quote-alternative"],inline_elements:["a","a:hover"],typefaces:{},styles:{},sizes:{},colors:{},line_heights:{},initialize:function(){var e=this;i.prototype.initialize.call(this);var o=n.Google.get_fonts();o&&o.state&&t.when(o).done(function(){e.render()}),this.listenTo(Upfront.Events,"upfront:render_typography_sidebar",this.render),this.listenTo(Upfront.Events,"entity:object:after_render",this.update_typography_elements),this.listenTo(Upfront.Events,"theme_colors:update",this.update_typography_elements,this)},on_render:function(){var i=this,a=t('<div class="upfront-typography-fields-left" />'),l=t('<div class="upfront-typography-fields-right" />'),p=this.model.get_property_value_by_name("typography"),d=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"typography"}),c={},u=!0,h=Upfront.plugins.call("get-default-typography",{default_typography:c});h.status&&"called"===h.status&&h.result&&(c=h.result),(!d||"value"in d&&_.isEmpty(d.value))&&(u=!1),d=d&&"value"in d?d.value:c;var f,g,m;if(_.isEmpty(p))if(_.contains(["tablet","mobile"],this.model.get("id"))||"big-tablet"===this.model.get("name"))switch(m="big-tablet"===this.model.get("name")?"big-tablet":this.model.get("id")){case"big-tablet":p=_.clone(d);break;case"tablet":var f=s.storage.get_breakpoints().findWhere({name:"big-tablet"});p=_.isUndefined(f)||_.isUndefined(f.get("typography"))||_.isUndefined(f.get("typography").h2)?d:_.clone(f.get("typography"));break;case"mobile":var g=s.storage.get_breakpoints().findWhere({id:"tablet"});p=_.isUndefined(g)||_.isUndefined(g.get("typography"))||_.isUndefined(g.get("typography").h2)?_.clone(d):_.clone(g.get("typography"))}else p=_.isEmpty(d)?c:d;this.typography=p,Upfront.mainData.global_typography=p,_.each(p,function(t,e){i.typefaces[e]=t.font_face,i.colors[e]=t.color,i.styles[e]=n.Model.get_variant(t.weight,t.style),t.size&&(i.sizes[e]=t.size),t.line_height&&(i.line_heights[e]=t.line_height)}),this.update_typography(void 0,u);var v,b=(Upfront.Application.get_current(),!0===Upfront.plugins.isRequiredByPlugin("show choose fonts button")),y=Upfront.mainData.userDoneFontsIntro,w=b&&!y||!b&&0===n.theme_fonts_collection.length&&!y;return v=w?new r.Button({label:e.select_fonts_to_use,compact:!0,classname:"open-theme-fonts-manager",on_click:function(t){Upfront.Events.trigger("command:themefontsmanager:open")}}):new o,0===n.theme_fonts_collection.length&&Upfront.mainData.userDoneFontsIntro===!1?(this.$el.html('<p class="sidebar-info-notice upfront-icon">'+e.no_defined_fonts+"</p>"),v.render(),void this.$el.append(v.el)):(this.fields.length||(this.fields={start_font_manager:v,element:new r.Select({label:e.type_element,default_value:"h1",values:[{label:e.h1,value:"h1"},{label:e.h2,value:"h2"},{label:e.h3,value:"h3"},{label:e.h4,value:"h4"},{label:e.h5,value:"h5"},{label:e.h6,value:"h6"},{label:e.p,value:"p"},{label:e.a,value:"a"},{label:e.ahover,value:"a:hover"},{label:e.pre,value:"pre"},{label:e.ul,value:"ul"},{label:e.ol,value:"ol"},{label:e.bq,value:"blockquote"},{label:e.bqalt,value:"blockquote.upfront-quote-alternative"}],change:function(){var e=this.get_value(),n=_.contains(i.inline_elements,e);i.current_element=e,i.fields.typeface.set_value(i.typefaces[e]),i.update_styles_field(),n?t([i.fields.size.el,i.fields.line_height.el]).hide():(t([i.fields.size.el,i.fields.line_height.el]).show(),i.fields.size.set_value(i.sizes[e]),i.fields.line_height.set_value(i.line_heights[e]||"1.1")),i.fields.color.set_value(i.colors[e]),i.fields.color.update_input_border_color(i.colors[e]);var o=i.fields.typeface.get_value();i.fields.typeface.set_option_font(o)}}),typeface:new r.Typeface_Chosen_Select({label:e.typeface,values:n.theme_fonts_collection.get_fonts_for_select(),default_value:i.typefaces.h1,select_width:"225px",change:function(){var t=this.get_value(),e=i.current_element;i.typefaces[e]!=t&&(i.typefaces[e]=t,i.styles[e]=n.Model.get_default_variant(t),i.update_typography(),i.update_styles_field())}}),style:this.get_styles_field(),color:new Upfront.Views.Editor.Field.Color({label:e.color,default_value:i.colors.h1,autoHide:!1,spectrum:{choose:function(t){var e=t.toRgb(),n="rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")",o=i.current_element;n=t.get_is_theme_color()!==!1?t.theme_color:n,i.colors[o]!=n&&(i.colors[o]=n,i.update_typography(t))}}}),size:new r.Number({label:e.size,min:0,max:100,suffix:e.px,default_value:i.sizes.h1,change:function(){var t=this.get_value(),e=i.current_element;i.sizes[e]!=t&&(i.sizes[e]=t,i.update_typography())}}),line_height:new r.Number({label:e.line_height,min:0,max:10,step:.1,default_value:i.line_heights.h1,change:function(){var t=this.get_value(),e=i.current_element;i.line_heights[e]!=t&&(i.line_heights[e]=t,i.update_typography())}})}),this.$el.html(""),this.$el.addClass("typography-panel"),_.each(this.fields,function(t){t.render(),t.delegateEvents()}),this.$el.append([this.fields.start_font_manager.el,this.fields.element.el,this.fields.typeface.el]),t(".upfront-chosen-select",this.$el).chosen({width:"230px"}),a.append([this.fields.style.el,this.fields.size.el]),this.$el.append(a),l.append([this.fields.color.el,this.fields.line_height.el]),void this.$el.append(l))},update_styles_field:function(){this.fields.style.remove(),this.fields.style=this.get_styles_field(this.typefaces[this.current_element]),this.fields.style.render(),this.fields.style.delegateEvents(),t(".upfront-typography-fields-left").prepend(this.fields.style.el)},get_styles_field:function(t){var i=this;return new r.Typeface_Style_Chosen_Select({label:e.weight_style,values:this.get_styles(),default_value:i.get_styles_field_default_value(),font_family:t,select_width:"120px",change:function(){var t=this.get_value(),e=i.current_element;i.styles[e]!=t&&(i.styles[e]=t,i.update_typography())},show:function(t){i.fields.style.set_option_font(t)}})},get_styles_field_default_value:function(){var t,e=this.get_styles(),i=this.typefaces[this.current_element],o=this.styles[this.current_element];return t=o?o:i?n.Model.get_default_variant(i):"regular","regular"===t&&!_.findWhere(e,{value:"regular"})&&_.findWhere(e,{value:"400 normal"})?t="400 normal":"400 normal"===t&&!_.findWhere(e,{value:"400 normal"})&&_.findWhere(e,{value:"regular"})&&(t="regular"),"italic"===t&&!_.findWhere(e,{value:"italic"})&&_.findWhere(e,{value:"400 italic"})?t="400 italic":"400 italic"===t&&!_.findWhere(e,{value:"400 italic"})&&_.findWhere(e,{value:"italic"})&&(t="italic"),t},get_styles:function(){var t,e=this.typography,i=this.current_element,o=[];return!1===e&&(e={}),(_.isUndefined(e[i])||_.isUndefined(e[i].font_face))&&(e[i]={font_face:"Arial"}),t=n.theme_fonts_collection.get_variants(e[i].font_face),o=[],_.each(t,function(t){o.push({label:t,value:t})}),o},update_typography:function(e,i){var o=this,r=[],s=[],a={};if(_.each(this.elements,function(e){var i,l,p,d,c=[],u=_.contains(o.inline_elements,e),h=o.typefaces[e],f=!1,g=!1,m=!1,v=!1;t(".upfront-object-content "+e);if(p=n.Model.parse_variant(o.styles[e]||"regular"),m=p.weight,g=p.style,""===h&&(l=n.System.get_fonts().models[0]),_.isUndefined(l)&&(l=n.System.get_fonts().findWhere({family:h})),_.isUndefined(l)&&(l=n.theme_fonts_collection.get_additional_font(h)),_.isUndefined(l)){var b=n.Google.get_fonts();if(b&&b.findWhere&&(l=b.findWhere({family:h})),!l)return!0;i="//fonts.googleapis.com/css?family="+l.get("family").replace(/ /g,"+"),400!==parseInt(""+m,10)&&"inherit"!==m&&(i+=":"+m),t("head").append('<link href="'+i+'" rel="stylesheet" type="text/css" />')}f='"'+l.get("family")+'",'+l.get("category"),"inherit"!==f&&c.push("font-family: "+f),"inherit"!==m&&c.push("font-weight: "+m),"inherit"!==g&&c.push("font-style: "+g),u||(c.push("font-size: "+o.sizes[e]+"px"),c.push("line-height: "+o.line_heights[e]+"em")),!_.isEmpty(o.colors[e])&&Upfront.Views.Theme_Colors.colors.is_theme_color(o.colors[e])?d=Upfront.Views.Theme_Colors.colors.get_css_class(o.colors[e]):c.push("color: "+o.colors[e]),v="blockquote"===e?".upfront-object-content blockquote, .upfront-object-content blockquote p":"a"===e?".upfront-object-content a, .upfront-object-content a:link, .upfront-object-content a:visited":"h1"===e||"h2"===e||"h3"===e||"h4"===e||"h5"===e||"h6"===e?".upfront-object-content "+e+", .upfront-object-content "+e+" a, .upfront-ui "+e+".tag-list-tag":".upfront-object-content "+e+", .upfront-ui "+e+".tag-list-tag",r.push(v+"{ "+c.join("; ")+"; }"),_.contains(["tablet","mobile"],o.model.get("id"))&&s.push(v.replace(/\.upfront-object-content/g,"."+o.model.get("id")+"-breakpoint .upfront-object-content")+" { "+c.join("; ")+"; }"),a[e]={weight:m,style:g,size:!u&&o.sizes[e],line_height:!u&&(o.line_heights[e]||"1.1"),font_face:l.get("family"),font_family:l.get("category"),color:o.colors[e],theme_color_class:d}}),this.update_typography_elements(),i||(this.model.set_property("typography",a),this.typography=a),_.contains(["tablet","mobile"],this.model.get("id"))){var l=this.model.get("id")+"-breakpoint-typography",p=s.join("\n");t("#"+l).length?t("#"+l).html(p):t("body").find("style").first().before('<style id="'+l+'">'+p+"</style>")}else t("head").find("#upfront-default-typography-inline").length?t("head").find("#upfront-default-typography-inline").html(r.join("\n")):t('<style id="upfront-default-typography-inline">'+r.join("\n")+"</style>").insertAfter(t("head").find('link[rel="stylesheet"]').first())},update_typography_elements:function(e){var i=this,n=[],o=!1;o=t("style#typography-colors"),o.length||(t("body").append('<style id="typography-colors" />'),o=t("style#typography-colors")),_.each(this.elements,function(t){i.colors[t]&&n.push(".upfront-object-content "+t+"{ color:"+Upfront.Util.colors.to_color_value(i.colors[t])+"; }")}),o.empty().append(n.join("\n"))}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-typography",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item-typography-editor","scripts/upfront/upfront-views-editor/commands/command-edit-custom-css","scripts/upfront/upfront-views-editor/commands/command-edit-layout-background","scripts/upfront/upfront-views-editor/commands/command-edit-global-regions"],function(t,i,n,o,r){return t.extend({initialize:function(){this.settings=_([new i({model:this.model})]),this.edit_css=new n({model:this.model}),this.edit_background=new o({model:this.model}),this.edit_global_regions=new r({model:this.model})},get_title:function(){return e.typography},on_render:function(){this.$el.find(".panel-section-content").addClass("typography-section-content"),this.edit_css.render(),this.edit_css.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_css.el),Upfront.plugins.call("insert-command-after-typography-commands",{rootEl:this.$el,model:this.model}),this.edit_background.render(),this.edit_background.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_background.el),this.edit_global_regions.render(),this.edit_global_regions.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_global_regions.el);var t=this;Upfront.Events.on("color:spectrum:show",function(){t.$el.closest(".sidebar-panel-content.ps-theme-default").css("position","static"),t.$el.closest(".sidebar-panel-settings").css("position","relative")}),Upfront.Events.on("color:spectrum:hide",function(){t.$el.closest(".sidebar-panel-content.ps-theme-default").css("position","relative"),t.$el.closest(".sidebar-panel-settings").css("position","static")})}})})}(jQuery),define("text!upfront/templates/sidebar_settings_theme_colors.html",[],function(){return'<div class="panel-setting-theme-colors">\n    <div class="pabel-setting-theme-colors-top">\n        <div id="panel-setting-theme-colors-pane">\n            {[ if (!colors.length){ ]}\n            <div id="theme-colors-no-color-notice" class="upfront-icon">\n                {{Upfront.Settings.l10n.global.views.no_colors_click_plus}}\n            </div>\n            {[ } ]}\n            <div id="theme-colors-swatches">\n                <span class="theme-colors-swatch"></span>\n                <p class="theme-colors-explanation">{{Upfront.Settings.l10n.global.views.theme_colors_explanation}} <span class="theme-colors-eg-attribute">color:</span> <span class="theme-colors-eg-sharp">#</span><span class="theme-colors-eg-value">ufc2</span><span class="theme-colors-eg-semicolon">;</span></p>\n                {[ _.each(colors, function (color, idx){ ]}\n                                <span class="theme-colors-color-picker color-{{idx}}" data-index="{{idx}}" data-color="{{color.color}}"></span>\n                {[ }); ]}\n\n            </div>\n        </div>\n    </div>\n    <!--<div class="panel-setting-theme-colors-bottom">-->\n        <!--<div class="panel-setting-theme-colors-shades-wrap">-->\n            <!--{[ if( colors.length ){ ]}-->\n                        <!--{{Upfront.Settings.l10n.global.views.define_swatch_hovers}}-->\n            <!--<label id="panel-setting-theme-colors-shades-label"  for="panel-setting-theme-colors-shades-range">-->\n                            <!--Color change value (<span class="panel-setting-theme-colors-shades-range-number">{{range}}</span>)-->\n                        <!--</label>-->\n                        <!--<div class="upfront-field upfront-field-slider panel-setting-theme-colors-shades-range"></div>-->\n                        <!--<ul class="panel-setting-theme-colors-shades-range-labels">-->\n                                <!--<li>0</li>-->\n                                <!--<li>50</li>-->\n                        <!--</ul>-->\n            <!--<div class="panel-setting-theme-colors-meta">-->\n                <!--{{Upfront.Settings.l10n.global.views.click_hilite_shade}}-->\n                                <!--<p class="swatch-title">{{Upfront.Settings.l10n.global.views.hilite}}:</p>-->\n                <!--<div class="panel-setting-theme-colors-highlights">-->\n                    <!--{[ _.each(colors, function (color, idx){ ]}-->\n                                        <!--<span class="theme-colors-color-box theme-colors-highlight{[ if(color.selected === \'highlight\') { ]} theme-colors-color-box-selected{[ } ]} {{color.luminance}} color-{{idx}}" style="background-color: {{color.highlight}}" data-color="{{color.highlight}}" data-index="{{idx}}" data-type="highlight"></span>-->\n                    <!--{[ }); ]}-->\n                <!--</div>-->\n                <!--<p class="swatch-title">Shade:</p>-->\n                <!--<div class="panel-setting-theme-colors-shades">-->\n                    <!--{[ _.each(colors, function (color, idx){ ]}-->\n                                        <!--<span class="theme-colors-color-box theme-colors-shade{[ if(color.selected === \'shade\') { ]} theme-colors-color-box-selected{[ } ]} {{color.luminance}} color-{{idx}}"  style="background-color: {{color.shade}}" data-index="{{idx}}" data-color="{{color.shade}}" data-type="shade"></span>-->\n                    <!--{[ }); ]}-->\n                <!--</div>-->\n            <!--</div>-->\n            <!--{[ } ]}-->\n        <!--</div>-->\n    <!--</div>-->\n</div>\n';
}),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item-colors-editor",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item","scripts/upfront/upfront-views-editor/theme-colors","scripts/upfront/upfront-views-editor/fields","text!upfront/templates/sidebar_settings_theme_colors.html"],function(e,i,n,o){return e.extend({initialize:function(){this.template=_.template(o),Upfront.Events.off("command:layout:save",this.on_save),Upfront.Events.off("command:layout:save_as",this.on_save),Upfront.Events.on("command:layout:save",this.on_save,this),Upfront.Events.on("command:layout:save_as",this.on_save,this),Upfront.Settings.Application.NO_SAVE&&Upfront.Events.on("preview:build:start",this.on_save,this),this.update_styles(),i.colors.bind("change reset add",this.update_styles,this)},events:{"change .panel-setting-theme-colors-shades-range":"change_range","click .theme-colors-color-box":"select_variation"},on_save:function(){Upfront.Application.colorSaver.queue([i.colors.toJSON(),i.range,this.styles])},update_styles:function(){this.styles="";var e=this;i.colors.each(function(t,i){var n="#000000"===t.get("color")&&0==t.get("alpha")?"inherit":t.get("color");e.styles+=" .upfront_theme_color_"+i+"{ color: "+n+";}",e.styles+=" a .upfront_theme_color_"+i+":hover{ color: "+t.get_hover_color()+";}",e.styles+=" button .upfront_theme_color_"+i+":hover{ color: "+t.get_hover_color()+";}",e.styles+=" .upfront_theme_bg_color_"+i+"{ background-color: "+n+";}",e.styles+=" a .upfront_theme_bg_color_"+i+":hover{ background-color: "+t.get_hover_color()+";}",e.styles+=" button .upfront_theme_bg_color_"+i+":hover{ background-color: "+t.get_hover_color()+";}",Upfront.Util.colors.update_colors_in_dom(t.get("prev"),n,i)}),t("#upfront_theme_colors_dom_styles").remove(),t("<style id='upfront_theme_colors_dom_styles' type='text/css'>"+this.styles+"</style>").appendTo("body"),Upfront.Events.trigger("theme_colors:update")},on_render:function(){var t;for(this.theme_colors=i,this.theme_color_range=i.range,this.$el.html(this.template({colors:this.theme_colors.colors.toJSON(),range:i.range})),this.add_previous_pickers(),t=this.theme_colors.colors.length;t<10;)this.add_unset_color(t),t++;this.add_slider()},add_empty_picker:function(t){var e=this,i=new n.Color({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch theme_color_swatch_empty",hide_label:!0,default_value:"#ffffff",blank_alpha:0,spectrum:{choose:function(n){if(!_.isObject(n))return!1;var o=i.get_value();o&&"undefined"!=typeof tinycolor&&(n=tinycolor(o)),e.add_new_color(n,t)},change:function(t){return!!_.isObject(t)&&void i.update_input_val(t.toHexString())}}});i.render(),this.$(".theme_colors_empty_picker").html(i.$el).prepend('<span class="theme-colors-color-name">ufc'+t+"</span>")},add_unset_color:function(t){var e=this,i=new n.Color({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch",hide_label:!0,default_value:"#ffffff",blank_alpha:0,spectrum:{choose:function(n){if(!_.isObject(n))return!1;var o=i.get_value();o&&"undefined"!=typeof tinycolor&&(n=tinycolor(o)),e.add_new_color(n,t)},change:function(n){return!!_.isObject(n)&&(i.update_input_val(n.toHexString()),void(e.theme_colors.colors.at(t)?e.update_colors(this,n,t):(e.add_new_color(n,t),e.update_colors(this,n,t))))}}});i.render(),i.$(".sp-preview").addClass("uf-unset-color"),this.$("#theme-colors-swatches").append(i.$el),i.$el.wrap('<span class="theme-colors-color-picker color-index">'.replace("index",t)),i.$el.closest(".theme-colors-color-picker").prepend('<span class="theme-colors-color-name">ufcindex</span>'.replace("index",t))},add_previous_pickers:function(){var e=this;this.$(".theme-colors-color-picker").each(function(i){var o=t(this),r=o.data("color"),s=e.theme_colors.colors.at(i),a=new n.Color({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch",hide_label:!0,default_value:r,blank_alpha:0,spectrum:{change:function(t){e.update_colors(this,t,i)},move:function(t){a.$(".sp-preview").css({backgroundColor:t.toRgbString(),backgroundImage:"none"})},hide:function(t){a.$(".sp-preview").css({backgroundColor:t.toRgbString(),backgroundImage:"none"})}}});a.render(),a.$(".sp-preview").css({backgroundColor:r,backgroundImage:"none"}),"#000000"===s.get("color")&&0==s.get("alpha")?a.$(".sp-preview").addClass("uf-unset-color"):a.$(".sp-preview").removeClass("uf-unset-color"),o.html(a.$el),o.prepend('<span class="theme-colors-color-name">ufc'+i+"</span>")})},add_new_color:function(e,o){for(var r=parseInt(i.range,10)/100||0,s=this.theme_colors.colors.length;s<o;s++)this.theme_colors.colors.push({color:"#000000",prev:"#000000",highlight:"#000000",shade:"#000000",alpha:0});var a=this,l=this.theme_colors.colors.add({color:e.toHexString(),prev:e.toHexString(),highlight:a.color_luminance(e.toHex(),r),shade:a.color_luminance(e.toHex(),r*-1),alpha:e.alpha}),p=new n.Color({className:"upfront-field-wrap upfront-field-wrap-color sp-cf theme_color_swatch theme-colors-color-picker",hide_label:!0,default_value:e.toRgbString(),blank_alpha:0,change:function(e){var n=parseInt(i.range,10)/100||0;e=tinycolor(e),l.set({color:e.toHexString(),highlight:a.color_luminance(e.toHex(),n),shade:a.color_luminance(e.toHex(),n*-1),alpha:e.alpha}),t(this).parent().find(".sp-preview").css({backgroundColor:e.toRgbString(),backgroundImage:"none"}),this.default_value=e.toRgbString(),a.render_bottom()}}),d=i.colors.length-1,c=t('<span class="theme-colors-color-picker color-'+d+'" data-index="'+d+'" data-color="'+e.toHexString()+'"><span class="theme-colors-color-name">ufc'+d+"</span></span>");p.render(),p.$(".sp-preview").css({backgroundColor:e.toRgbString(),backgroundImage:"none"}),"#000000"===e.toHexString()&&0==e.alpha?p.$(".sp-preview").addClass("uf-unset-color"):p.$(".sp-preview").removeClass("uf-unset-color"),c.append(p.$el),this.$("#theme-colors-no-color-notice").hide(),this.render_bottom(),this.on_save()},render_bottom:function(){},color_luminance:function(t,e){t=String(t).replace(/[^0-9a-f]/gi,""),t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),e=e||0;var i,n,o="#";for(n=0;n<3;n++)i=parseInt(t.substr(2*n,2),16),i=Math.round(Math.min(Math.max(0,i+i*e),255)).toString(16),o+=("00"+i).substr(i.length);return o},change_range:function(t){var e=this;i.range=t,percentage=parseInt(t,10)/100||0,i.colors.each(function(t){var i=t.get("color");t.set("highlight",e.color_luminance(i,percentage)),t.set("shade",e.color_luminance(i,percentage*-1))}),this.render_bottom()},select_variation:function(e){var n=this,o=t(e.target),r=o.data("type"),s=o.data("index"),a=o.data("color"),l=i.colors.at(s);l.get("selected")?(l.set("selected",""),l.set("luminance",n.luminance(a))):(l.set("selected",r),l.set("luminance",n.luminance(a))),this.render_bottom()},luminance:function(t){t=t.substring(1);var e=parseInt(t,16),i=e>>16&255,n=e>>8&255,o=e>>0&255,r=.2126*i+.7152*n+.0722*o;return r<80?"dark":"light"},add_slider:function(){var t=this;this.$(".panel-setting-theme-colors-shades-range").slider({value:i.range,min:0,max:50,change:function(e,i){t.change_range(i.value)}})},update_colors:function(e,n,o){var r=i.colors.at(o),s=parseInt(i.range,10)/100||0;r&&(r.set({color:n.toHexString(),prev:r.get("color"),highlight:this.color_luminance(n.toHex(),s),shade:this.color_luminance(n.toHex(),s*-1),alpha:n.alpha}),t(e).parent().find(".sp-preview").css({backgroundColor:n.toRgbString(),backgroundImage:"none"}),"#000000"===n.toHexString()&&0==n.alpha?t(e).parent().find(".sp-preview").addClass("uf-unset-color"):t(e).parent().find(".sp-preview").removeClass("uf-unset-color"),e.default_value=n.toRgbString(),this.render_bottom())}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-colors",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item-colors-editor"],function(t,i){return t.extend({initialize:function(){this.settings=_([]),this.edit_colors=new i({model:this.model})},get_title:function(){return e.colors_section},on_render:function(){this.edit_colors.render(),this.edit_colors.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_colors.el),this.$el.addClass("colors-panel-section")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-typography","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section-colors"],function(t,i,n){return t.extend({className:"sidebar-panel sidebar-panel-settings",initialize:function(){this.active=!0,this.global_option=!0,this.sections=_([new i({model:this.model}),new n({model:this.model})])},get_title:function(){return e.theme_settings},on_render:function(){Upfront.plugins.call("do-action-after-sidebar-settings-render",{settingsEl:this.$el})}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panels",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-post-editor","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-posts","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-draggable-elements","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings"],function(t,e,i,n){return Backbone.View.extend({tagName:"ul",className:"sidebar-panels",initialize:function(){this.init_modules(),this.listenTo(Upfront.Events,"click:edit:navigate",this.init_modules)},init_modules:function(o){this.panels={post_editor:new t({model:this.model}),posts:new e({model:this.model}),elements:new i({model:this.model}),settings:new n({model:this.model})},"undefined"!=typeof o?o===!1&&(this.panels=_.omit(this.panels,"post_editor")):"undefined"!=typeof _upfront_post_data.post_id&&_upfront_post_data.post_id!==!1||(this.panels=_.omit(this.panels,"post_editor"))},render:function(){var t=this;t.$el.empty(),_.each(this.panels,function(e,i){e.remove(),e=t.panels[i],"post_editor"===i&&e.initialize(),e.render(),"undefined"!=typeof e.global_option&&e.global_option?Upfront.Settings.Application.PERMS.OPTIONS&&t.$el.append(e.el):Upfront.Application.user_can_save_content()&&"post_editor"===i?t.$el.append(e.el):Upfront.Application.user_can_modify_layout()&&t.$el.append(e.el),e.delegateEvents()})}})})}(jQuery),function(t){Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/commands/sidebar-commands-primary-post-type",["scripts/upfront/upfront-views-editor/commands"],function(t){return t.Commands.extend({className:"sidebar-commands sidebar-commands-primary clearfix",initialize:function(){this.commands=_([]),Upfront.Application.user_can("CREATE_POST_PAGE")&&(this.commands.push(new t.Command_NewPost({model:this.model})),this.commands.push(new t.Command_NewPage({model:this.model}))),this.commands.push(new t.Command_PopupList({model:this.model})),Upfront.Application.user_can_modify_layout()&&this.commands.push(new t.Command_OpenMediaGallery)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-responsive-section-typography",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-section","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-settings-item-typography-editor","scripts/upfront/upfront-views-editor/commands/command-general-edit-custom-css"],function(t,i,n){return t.extend({initialize:function(){this.settings=_([new i({model:this.model})]),this.edit_css=new n({model:this.model})},get_title:function(){return e.typography_and_colors},on_render:function(){this.edit_css.render(),this.edit_css.delegateEvents(),this.$el.find(".panel-section-content").append(this.edit_css.el)}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/commands/command-save-post",["scripts/upfront/upfront-views-editor/commands/command"],function(t){return t.extend({className:"command-save",render:function(){Upfront.Events.on("upfront:save:label",this.update_label,this),this.$el.html(e.save),this.$el.prop("title",e.save)},update_label:function(t){var e=this;setTimeout(function(){e.$el.html(t),e.$el.prop("title",t)},200)},on_click:function(){Upfront.Events.trigger("command:post:save")}})})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/upfront-views-editor/sidebar",["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel","scripts/upfront/upfront-views-editor/sidebar/draggable-element","scripts/upfront/upfront-views-editor/commands","scripts/upfront/upfront-views-editor/sidebar/sidebar-profile","scripts/upfront/upfront-views-editor/sidebar/sidebar-panels","scripts/upfront/upfront-views-editor/sidebar/commands/sidebar-commands-primary-post-type","scripts/upfront/upfront-views-editor/breakpoint","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-responsive-section-typography","scripts/upfront/upfront-views-editor/commands/command-save-post","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n,o,r,s,a,l,p,d,c){var u=o.Commands.extend({className:function(){var t="sidebar-commands sidebar-commands-control",e=Upfront.plugins.call("add-sidebar-commands-class",{className:t});return e.status&&"called"===e.status&&e.result&&(t=e.result),t},initialize:function(){Upfront.Application.user_can_modify_layout()?!1===Upfront.plugins.isForbiddenByPlugin("show undo redo and responsive commands")?(this.commands=_([new o.Command_Undo({model:this.model}),new o.Command_Redo({model:this.model})]),Upfront.Application.user_can("RESPONSIVE_MODE")&&this.commands.push(new o.Command_StartResponsiveMode({model:this.model})),this.commands.push(new o.Command_ToggleGrid({model:this.model}))):this.commands=_([new o.Command_ToggleGrid({model:this.model})]):this.commands=_([]),Upfront.Application.user_can("RESPONSIVE_MODE")&&Upfront.plugins.call("insert-responsive-buttons",{commands:this.commands,model:this.model}),Upfront.plugins.call("insert-save-buttons",{commands:this.commands,model:this.model}),this.commands.push(new o.Command_Trash({model:this.model})),!Upfront.Settings.Application.NO_SAVE&&!1===Upfront.plugins.isForbiddenByPlugin("show save layout command")&&Upfront.Application.user_can_modify_layout()?this.commands.push(new o.Command_SaveLayout({model:this.model})):!Upfront.Settings.Application.NO_SAVE&&!1===Upfront.plugins.isForbiddenByPlugin("show save layout command")&&Upfront.Application.user_can_save_content()?this.commands.push(new d({model:this.model})):!1===Upfront.plugins.isForbiddenByPlugin("show preview layout command")&&Upfront.Settings.Application.PERMS.REVISIONS&&this.commands.push(new o.Command_PreviewLayout({model:this.model})),Upfront.Settings.Debug.dev&&(Upfront.Settings.Application.NO_SAVE||!1!==Upfront.plugins.isForbiddenByPlugin("show reset everything command")||this.commands.push(new o.Command_ResetEverything({model:this.model})),Upfront.Settings.Application.DEBUG||!1!==Upfront.plugins.isForbiddenByPlugin("show publish layout command")||Upfront.Settings.Application.NO_SAVE||this.commands.push(new o.Command_PublishLayout({model:this.model})))}}),h=o.Commands.extend({className:"sidebar-commands sidebar-commands-header",initialize:function(){this.commands=_([new o.Command_Logo({model:this.model})]),this.commands.push(new o.Command_Menu({model:this.model})),this.listenTo(Upfront.Events,"upfront:more_menu:open",this.on_menu_open),this.listenTo(Upfront.Events,"upfront:more_menu:close",this.on_menu_close)},on_menu_open:function(){this.$el.addClass("more-menu-open clearfix")},on_menu_close:function(){this.$el.removeClass("more-menu-open clearfix")}}),f=Backbone.View.extend({tagName:"li",className:"sidebar-panel sidebar-panel-settings expanded",template:'<div class="sidebar-panel-content"></div>',initialize:function(){this.collection=l.storage.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render),this.global_option=!0},render:function(){var t=l.storage.get_breakpoints().get_active();t.get("default")&&(this.model.attributes.id="default");var e=new p({model:t.get("default")?this.model:t});e.render(),this.$el.html(this.template),this.$el.find(".sidebar-panel-content").html(e.el);var i=this.$el.find(".sidebar-panel-content");c.initialize(i[0],{suppressScrollX:!0});Upfront.Events.on("color:spectrum:show",function(){i.css("position","static"),i.closest("li.sidebar-panel-settings").css("position","relative")}),Upfront.Events.on("color:spectrum:hide",function(){i.css("position","relative"),i.closest("li.sidebar-panel-settings").css("position","static")})}}),g=Backbone.View.extend({tagName:"ul",className:"sidebar-commands sidebar-commands-responsive",initialize:function(){this.views=[new o.Command_BreakpointDropdown,new o.Command_AddCustomBreakpoint],this.views.push(new f({model:this.model}))},render:function(){return!!Upfront.Application.user_can_modify_layout()&&(_.each(this.views,function(t){t.render(),"undefined"!=typeof t.global_option&&t.global_option?Upfront.Settings.Application.PERMS.OPTIONS&&this.$el.append(t.el):this.$el.append(t.el)},this),this)},destroy:function(){this.remove(),_.each(this.views,function(t){t.remove()})}}),m=o.Commands.extend({className:"sidebar-commands sidebar-commands-responsive-control sidebar-commands-control",initialize:function(){Upfront.Application.user_can_modify_layout()?this.commands=_([new o.Command_ResponsiveUndo({model:this.model}),new o.Command_ResponsiveRedo({model:this.model}),new o.Command_ToggleGrid({model:this.model}),new o.Command_SaveLayout,new o.Command_StopResponsiveMode]):this.commands=_([new o.Command_StopResponsiveMode])},render:function(){this.$el.find("li").remove(),this.commands.each(this.add_command,this)}}),v=Backbone.View.extend({tagName:"div",visible:1,events:{"click #sidebar-ui-toggler-handle":"toggleSidebar"},initialize:function(){this.sidebar_profile=new r({model:this.model}),this.sidebar_commands={header:new h({model:this.model}),primary:new a({model:this.model}),additional:!1,control:new u({model:this.model}),responsive:new g({model:this.model})},this.sidebar_panels=new s({model:this.model}),this.fetch_current_user(),Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.CONTENT&&(Upfront.Events.on("upfront:element:edit:start",this.preventUsage,this),Upfront.Events.on("upfront:element:edit:stop",this.allowUsage,this),Upfront.Events.on("element:settings:deactivate",this.allowUsage,this),Upfront.Events.on("element:settings:canceled",this.allowUsage,this)),Upfront.Events.on("application:mode:after_switch",this.render,this),Upfront.Events.on("application:user:fetch",this.render,this)},preventUsage:function(i){var n=e.not_available_in_text_edit;"media-upload"===i&&(n=e.not_available_in_media_upload),"write"===i&&(this.writingIsOn=!0,n=e.publish_first_nag),this.prevented_usage_type||(this.prevented_usage_type=i),t("#preventUsageOverlay span").html(n),t("#preventUsageOverlay").show(),t("#preventElementsUsageOverlay span").html(n),t("#preventElementsUsageOverlay").show()},allowUsage:function(e){return this.writingIsOn&&"write"!==e?void this.preventUsage("write"):(this.prevented_usage_type=!1,this.writingIsOn=!1,t("#preventUsageOverlay").hide(),void t("#preventElementsUsageOverlay").hide())},render:function(){var e=Upfront.Application.get_current(),i=e===Upfront.Settings.Application.MODE.RESPONSIVE,n=t('<div id="sidebar-ui-wrapper" class="upfront-ui"></div>');if(Upfront.Events.trigger("sidebar:add_classes",n),this.sidebar_commands.header.render(),n.append(this.sidebar_commands.header.el),this.addHoverSidebarClasses(),!1!==Upfront.plugins.isForbiddenByPlugin("show sidebar profile")||i||(this.sidebar_profile.render(),n.append(this.sidebar_profile.el)),i||(this.sidebar_commands.primary.render(),n.append(this.sidebar_commands.primary.el)),this.sidebar_commands.additional&&!i&&(this.sidebar_commands.additional.render(),n.append(this.sidebar_commands.additional.el)),i&&(this.sidebar_commands.responsive.render(),n.append(this.sidebar_commands.responsive.el)),e===Upfront.Settings.Application.MODE.CONTENT||i){if(i){var o=new m({model:this.model});o.render(),n.append(o.el)}}else this.sidebar_panels.render(),n.append(this.sidebar_panels.el),this.sidebar_commands.control.render(),n.append(this.sidebar_commands.control.el),n.append('<div id="preventUsageOverlay"><span></span></div>');this.$el.html(n),Upfront.Events.trigger("sidebar:rendered")},get_panel:function(t){return!!this.sidebar_panels.panels[t]&&this.sidebar_panels.panels[t]},get_commands:function(t){return!!this.sidebar_commands[t]&&this.sidebar_commands[t]},to_content_editor:function(){},from_content_editor:function(){},fetch_current_user:function(){var t=Upfront.data.currentUser;t||(t=new Upfront.Models.User,Upfront.data.loading.currentUser=t.fetch().done(function(){Upfront.data.currentUser=t,Upfront.Events.trigger("application:user:fetch")}))},addCollapsibleEvents:function(){var e=this;this.$el.append('<div id="sidebar-ui-toggler"><div id="sidebar-ui-toggler-handle" class="sidebar-ui-hide"></div></div>'),t("body").on("mousemove",function(i){300*e.visible+100>i.pageX?e.collapsibleHint||(t("#sidebar-ui-toggler").fadeIn(),e.collapsibleHint=!0):e.collapsibleHint&&(t("#sidebar-ui-toggler").fadeOut(),e.collapsibleHint=!1)}),this.resizeCollapseHandle(),t(window).on("resize",function(){e.resizeCollapseHandle()})},resizeCollapseHandle:function(){var e=t(window).height();this.$("#sidebar-ui-toggler").height(e)},addHoverSidebarClasses:function(){t("#sidebar-ui, #element-settings-sidebar, #region-settings-sidebar").hover(function(){t("#sidebar-ui, #element-settings-sidebar, #region-settings-sidebar").addClass("upfront-sidebar-hover")},function(){t("#sidebar-ui, #element-settings-sidebar, #region-settings-sidebar").removeClass("upfront-sidebar-hover")})},toggleSidebar:function(e){var i=this,n={marginLeft:"260px"};unmargined_css={marginLeft:"0px"},_margin=Upfront.Util.isRTL()?"marginRight":"marginLeft",this.visible?(t("#sidebar-ui, #element-settings-sidebar").stop().animate({width:"0px"},300,function(){t("#sidebar-ui, #element-settings-sidebar").addClass("collapsed")}),Upfront.Util.isRTL()&&(unmargined_css={marginRight:"0px"}),t("#page").stop().animate(unmargined_css,300,function(){Upfront.Events.trigger("sidebar:toggle:done",i.visible)}),this.$("#sidebar-ui-toggler-handle").removeClass().addClass("sidebar-ui-show"),this.visible=0):(Upfront.Util.isRTL()&&(n={marginRight:"260px"}),t("#sidebar-ui").removeClass("collapsed").stop().animate({width:"260px"},300),t("#element-settings-sidebar").removeClass("collapsed"),0!==t("#element-settings-sidebar").contents().length&&t("#element-settings-sidebar").removeClass("collapsed").stop().animate({width:"260px"},300),t("#page").stop().animate(n,300,function(){Upfront.Events.trigger("sidebar:toggle:done",i.visible)}),this.$("#sidebar-ui-toggler-handle").removeClass().addClass("sidebar-ui-hide"),this.visible=1),Upfront.Events.trigger("sidebar:toggle",this.visible)}});return{Sidebar:v,Panel:i,Element:n}})}(jQuery),function(){define("scripts/upfront/upfront-views-editor/presets/button/model",[],function(){return Backbone.Model.extend({initialize:function(t){this.set({presets:t})}})})}(),function(){define("scripts/upfront/upfront-views-editor/presets/button/collection",["scripts/upfront/upfront-views-editor/presets/button/model"],function(t){var e=Backbone.Collection.extend({model:t});return new e(Upfront.mainData.buttonPresets)})}(),define("text!upfront/templates/property.html",[],function(){return'<dt class="upfront-property">{{name}}</dt>\r\n<dd class="upfront-property">\r\n\t{{value}}\r\n\t<div class="upfront-property-actions">\r\n\t\t<a href="#" class="upfront-property-change">{{Upfront.Settings.l10n.global.views.edit}}</a>\r\n\t\t<a href="#" class="upfront-property-remove">{{Upfront.Settings.l10n.global.views.remove}}</a>\r\n\t</div>\r\n</dd>'}),define("text!upfront/templates/property_edit.html",[],function(){return'<input type="text" id="upfront-new_property-name" placeholder="name" value="{{name}}" />\r\n<input type="text" id="upfront-new_property-value" placeholder="value" value="{{value}}" />\r\n<button type="button" class="upfront-property-save">{{Upfront.Settings.l10n.global.views.save}}</button>'}),function(t){define("scripts/upfront/upfront-views-editor/property",["text!upfront/templates/property.html","text!upfront/templates/property_edit.html"],function(t,e){return Backbone.View.extend({events:{"click .upfront-property-change":"show_edit_property_partial","click .upfront-property-save":"save_property","click .upfront-property-remove":"remove_property"},render:function(){var e=_.template(t,this.model.toJSON());this.$el.html(e)},remove_property:function(){this.model.destroy()},save_property:function(){var t=this.$("#upfront-new_property-name").val(),e=this.$("#upfront-new_property-value").val();this.model.set({name:t,value:e}),this.render()},show_edit_property_partial:function(){var t=_.template(e,this.model.toJSON());this.$el.html(t)}})})}(jQuery),define("text!upfront/templates/properties.html",[],function(){return'<h3>{{name}}</h3>\r\n\r\n<dl class="upfront-properties_collection">\r\n</dl>\r\n\r\n<button type="button" id="add-property">{{Upfront.Settings.l10n.global.views.add_new}}</button>\r\n\r\n<div id="upfront-new_property" style="display:none">\r\n\t<input type="text" id="upfront-new_property-name" placeholder="name" />\r\n\t<input type="text" id="upfront-new_property-value" placeholder="value" />\r\n\t<button type="button" id="done-adding-property">{{Upfront.Settings.l10n.global.views.add}}</button>\r\n</div>'}),function(t){define("scripts/upfront/upfront-views-editor/properties",["scripts/upfront/upfront-views-editor/property","text!upfront/templates/properties.html"],function(t,e){return Backbone.View.extend({events:{"click #add-property":"show_new_property_partial","click #done-adding-property":"add_new_property"},initialize:function(){this.listenTo(this.model.get("properties"),"change",this.render),this.listenTo(this.model.get("properties"),"add",this.render),this.listenTo(this.model.get("properties"),"remove",this.render)},render:function(){var i=_.template(e,this.model.toJSON()),n=this;this.$el.html(i),this.model.get("properties").each(function(e){var i=new t({model:e});i.render(),n.$el.find("dl").append(i.el)})},show_new_property_partial:function(){this.$("#add-property").hide(),this.$("#upfront-new_property").slideDown()},add_new_property:function(){var t=this.$("#upfront-new_property-name").val(),e=this.$("#upfront-new_property-value").val();this.model.get("properties").add(new Upfront.Models.Property({name:t,value:e})),this.$("#upfront-new_property").slideUp().find("input").val("").end(),this.$("#add-property").show()}})})}(jQuery),function(t){define("scripts/upfront/preset-settings/preset-saver",[],function(){var e=function(){var e={},i=function(t,e,n){var o=e.pop();Upfront.Util.post({action:"upfront_save_"+t+"_preset",data:o}).done(function(){e.length>0?i(t,e,n):n.resolve()}).fail(function(){n.reject(),Upfront.Views.Editor.notify("Preset "+o.name+" save failed.")})};this.save=function(){var n=[],o=t.Deferred();return _.each(e,function(e,o){if(e.length>0){var r=t.Deferred();n.push(r),i(o,e,r)}}),n.length>0?(t.when.apply(t,n).done(function(){o.resolve()}).fail(function(){o.reject()}),o):o.resolve()},this.queue=function(t,i){e[i]=e[i]||[],e[i]=_.reject(e[i],function(e){return e.id===t.id}),e[i].push(t)}},i=new e;return i})}(jQuery),function(t){define("scripts/upfront/upfront-views-editor/theme-colors/color-saver",[],function(){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,i=function(){var i=[],n=function(t,i,n){var o={action:"upfront_update_theme_colors",theme_colors:t[0],range:t[1]};Upfront.Util.post(o).done(function(){i.resolve()}).fail(function(){i.reject(),Upfront.Views.Editor.notify(e.theme_colors_save_fail)});var r={action:"upfront_save_theme_colors_styles",styles:t[2]};Upfront.Util.post(r).done(function(){n.resolve()}).fail(function(){n.reject(),Upfront.Views.Editor.notify(e.theme_color_style_save_fail)})};this.save=function(){for(var e=[],o=t.Deferred();i.length;){var r=t.Deferred(),s=t.Deferred();e.push(r),e.push(s),n(i.pop(),r,s)}return e.length>0?(t.when.apply(t,e).done(function(){o.resolve()}).fail(function(){o.reject()}),o):o.resolve()},this.queue=function(t){i.push(t)}},n=new i;return n})}(jQuery),define("text!upfront/templates/sidebar_settings_lock_area.html",[],function(){return'<div class="panel-setting-item">\r\n\t<div class="region-lock-switch upfront-icon upfront-icon-unlock {{lock_class}}">{{Upfront.Settings.l10n.global.views.lock_areas}}</div>\r\n</div>\r\n<div class="panel-setting-dialog panel-setting-dialog-info">{{Upfront.Settings.l10n.global.views.unlock_areas}}</div>'}),define("text!upfront/templates/sidebar_settings_background.html",[],function(){return'<div class="panel-setting-item">\r\n\t<div class="panel-setting-sub-label">{{Upfront.Settings.l10n.global.views..background}}:</div>\r\n\t<div class="panel-setting-background clearfix">\r\n\t\t<input type="text" id="region-bg-color" name="color" />\r\n\t\t<a href="#" id="region-bg-image-upload" class="panel-setting-button upfront-icon upfront-icon-edit thickbox">{{Upfront.Settings.l10n.global.views..upload_image}}</a>\r\n\t\t<a href="#" id="region-bg-image-edit" class="panel-setting-button upfront-icon upfront-icon-edit" style="display: none;">{{Upfront.Settings.l10n.global.views..edit_image}}</a>\r\n\t</div>\r\n\t<div class="panel-setting-background-more">\r\n\t\t<div class="background-image-wrap"></div>\r\n\t\t<div class="panel-setting-sub-label">{{Upfront.Settings.l10n.global.views..edit_image_position}}:</div>\r\n\t\t<div class="panel-setting-background-position">\r\n\t\t\t<div class="background-position-select">\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="left top" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="center top" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="right top" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="left center" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="center" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="right center" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="left bottom" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="center bottom" /></span>\r\n\t\t\t\t<span class="position-select-wrap"><input type="radio" class="position-select" name="position" value="right bottom" /></span>\r\n\t\t\t</div>\r\n\t\t\t<div class="or-round">or</div>\r\n\t\t\t<div class="background-tile-select">\r\n\t\t\t\t<label class="tile-select-wrap"><input type="checkbox" class="upfront-field-checkbox tile-select" name="tile" value="repeat-x" />{{Upfront.Settings.l10n.global.views..tile_horizontally}}</label>\r\n\t\t\t\t<label class="tile-select-wrap"><input type="checkbox" class="upfront-field-checkbox tile-select" name="tile" value="repeat-y" />{{Upfront.Settings.l10n.global.views..tile_vertically}}</label>\r\n\t\t\t\t<label class="tile-select-wrap"><input type="checkbox" class="upfront-field-checkbox tile-select" name="tile" value="fill" />{{Upfront.Settings.l10n.global.views..fill_space}}</label>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</div>';
}),function(t,e,n){function o(t,e,i){for(var n=[],o=0;o<t.length;o++){var r=t[o];if(r){var s=tinycolor(r),a=s.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";a+=tinycolor.equals(e,r)?" sp-thumb-active":"";var l=m?"background-color:"+s.toRgbString():"filter:"+s.toFilter();n.push('<span title="'+s.toRgbString()+'" data-color="'+s.toRgbString()+'" class="'+a+'"><span class="sp-thumb-inner" style="'+l+';" /></span>')}else{var p="sp-clear-display";n.push('<span title="No Color Selected" data-color="" style="background-color:transparent;" class="'+p+'"></span>')}}return"<div class='sp-cf "+i+"'>"+n.join("")+"</div>"}function r(){for(var t=0;t<_.length;t++)_[t]&&_[t].hide()}function s(t,i){var n=e.extend({},f,t);return n.callbacks={move:c(n.move,i),change:c(n.change,i),show:c(n.show,i),hide:c(n.hide,i),beforeShow:c(n.beforeShow,i)},n}function a(a,p){function c(){if(W.showPaletteOnly&&(W.showPalette=!0),W.palette){ct=W.palette.slice(0),ut=e.isArray(ct[0])?ct:[ct],ht={};for(var t=0;t<ut.length;t++)for(var i=0;i<ut[t].length;i++){var n=tinycolor(ut[t][i]).toRgbString();ht[n]=!0}}wt.toggleClass("sp-flat",q),wt.toggleClass("sp-input-disabled",!W.showInput),wt.toggleClass("sp-alpha-enabled",W.showAlpha),wt.toggleClass("sp-clear-enabled",Gt),wt.toggleClass("sp-buttons-disabled",!W.showButtons),wt.toggleClass("sp-palette-disabled",!W.showPalette),wt.toggleClass("sp-palette-only",W.showPaletteOnly),wt.toggleClass("sp-initial-disabled",!W.showInitial),wt.addClass(W.className),V()}function f(){function t(t){return t.data&&t.data.ignore?(M(e(this).data("color")),D()):(M(e(this).data("color")),D(),N(!0),I()),!1}if(g&&wt.find("*:not(input)").attr("unselectable","on"),c(),At&&bt.after(Lt).hide(),Gt||Mt.hide(),q)bt.after(wt).hide();else{var i="parent"===W.appendTo?bt.parent():e(W.appendTo);1!==i.length&&(i=e("body")),i.append(wt)}w(),Nt.bind("click.spectrum touchstart.spectrum",function(t){yt||T(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(bt.is(":disabled")||W.disabled===!0)&&H(),wt.click(d),Tt.change(C),Tt.bind("paste",function(){setTimeout(C,1)}),Tt.keydown(function(t){13==t.keyCode&&C()}),Pt.text(W.cancelText),Pt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),I("cancel")}),Mt.attr("title",W.clearText),Mt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),qt=!0,D(),q&&N(!0)}),jt.text(W.chooseText),jt.bind("click.spectrum",function(t){t.stopPropagation(),t.preventDefault(),O()&&(N(!0),I())}),u(St,function(t,e,i){dt=t/ot,qt=!1,i.shiftKey&&(dt=Math.round(10*dt)/10),D()},E,S),u(xt,function(t,e){at=parseFloat(e/it),qt=!1,W.showAlpha||(dt=1),D()},E,S),u(kt,function(t,e,i){if(i.shiftKey){if(!mt){var n=lt*Z,o=tt-pt*tt,r=Math.abs(t-n)>Math.abs(e-o);mt=r?"x":"y"}}else mt=null;var s=!mt||"x"===mt,a=!mt||"y"===mt;s&&(lt=parseFloat(t/Z)),a&&(pt=parseFloat((tt-e)/tt)),qt=!1,W.showAlpha||(dt=1),D()},E,S),Bt?(M(Bt),A(),Ht=Ft||tinycolor(Bt).format,k(Bt)):A(),q&&z();var n=g?"mousedown.spectrum":"click.spectrum touchstart.spectrum";zt.delegate(".sp-thumb-el",n,t),It.delegate(".sp-thumb-el:nth-child(1)",n,{ignore:!0},t)}function w(){if(Q&&t.localStorage){try{var i=t.localStorage[Q].split(",#");i.length>1&&(delete t.localStorage[Q],e.each(i,function(t,e){k(e)}))}catch(t){}try{ft=t.localStorage[Q].split(";")}catch(t){}}}function k(e){if(G){var i=tinycolor(e).toRgbString();if(!ht[i]&&ft.indexOf(i)===-1)for(ft.push(i);ft.length>_t;)ft.shift();if(Q&&t.localStorage)try{t.localStorage[Q]=ft.join(";")}catch(t){}}}function $(){var t=[];if(W.showPalette)for(i=0;i<ft.length;i++){var e=tinycolor(ft[i]).toRgbString();ht[e]||t.push(ft[i])}return t.reverse().slice(0,W.maxSelectionSize)}function x(){var t=j(),i=e.map(ut,function(e,i){return o(e,t,"sp-palette-row sp-palette-row-"+i)});w(),ft&&i.push(o($(),t,"sp-palette-row sp-palette-row-selection")),zt.html(i.join(""))}function U(){if(W.showInitial){var t=Rt,e=j();It.html(o([t,e],e,"sp-palette-row-initial"))}}function E(){(tt<=0||Z<=0||it<=0)&&V(),wt.addClass(gt),mt=null,bt.trigger("dragstart.spectrum",[j()])}function S(){wt.removeClass(gt),bt.trigger("dragstop.spectrum",[j()])}function C(){var t=Tt.val();if(null!==t&&""!==t||!Gt){var e=tinycolor(t);e.ok?(M(e),N(!0)):Tt.addClass("sp-validation-error")}else M(null),N(!0)}function T(){K?I():z()}function z(){var i=e.Event("beforeShow.spectrum");return K?void V():(bt.trigger(i,[j()]),void(Y.beforeShow(j())===!1||i.isDefaultPrevented()||(r(),K=!0,e(vt).bind("click.spectrum",I),e(t).bind("resize.spectrum",X),Lt.addClass("sp-active"),wt.removeClass("sp-hidden"),V(),A(),Rt=j(),U(),Y.show(Rt),bt.trigger("show.spectrum",[Rt]))))}function I(i){if((!i||"click"!=i.type||2!=i.button)&&K&&!q){K=!1,e(vt).unbind("click.spectrum",I),e(t).unbind("resize.spectrum",X),Lt.removeClass("sp-active"),wt.addClass("sp-hidden");var n=!tinycolor.equals(j(),Rt);n&&(Wt&&"cancel"!==i?N(!0):P()),Y.hide(j()),bt.trigger("hide.spectrum",[j()])}}function P(){M(Rt,!0)}function M(t,e){if(tinycolor.equals(t,j()))return void A();var i,n;!t&&Gt?qt=!0:(qt=!1,i=tinycolor(t),n=i.toHsv(),at=n.h%360/360,lt=n.s,pt=n.v,dt=n.a),A(),i&&i.ok&&!e&&(Ht=Ft||i.format)}function j(t){return t=t||{},Gt&&qt?null:tinycolor.fromRatio({h:at,s:lt,v:pt,a:Math.round(100*dt)/100},{format:t.format||Ht})}function O(){return!Tt.hasClass("sp-validation-error")}function D(){A(),Y.move(j()),bt.trigger("move.spectrum",[j()])}function A(){Tt.removeClass("sp-validation-error"),L();var t=tinycolor.fromRatio({h:at,s:1,v:1});kt.css("background-color",t.toHexString());var e=Ht;dt<1&&(0!==dt||"name"!==e)&&("hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb"));var i=j({format:e}),n="";if(Vt.removeClass("sp-clear-display"),Vt.css("background-color","transparent"),!i&&Gt)Vt.addClass("sp-clear-display");else{var o=i.toHexString(),r=i.toRgbString();if(m||1===i.alpha?Vt.css("background-color",r):(Vt.css("background-color","transparent"),Vt.css("filter",i.toFilter())),W.showAlpha){var s=i.toRgb();s.a=0;var a=tinycolor(s).toRgbString(),l="linear-gradient(left, "+a+", "+o+")";g?Et.css("filter",tinycolor(a).toFilter({gradientType:1},o)):(Et.css("background","-webkit-"+l),Et.css("background","-moz-"+l),Et.css("background","-ms-"+l),Et.css("background","linear-gradient(to right, "+a+", "+o+")"))}n=i.toString(e)}W.showInput&&Tt.val(n),W.showPalette&&x(),U()}function L(){var t=lt,e=pt;if(Gt&&qt)Ct.hide(),Ut.hide(),$t.hide();else{Ct.show(),Ut.show(),$t.show();var i=t*Z,n=tt-e*tt;i=Math.max(-et,Math.min(Z-et,i-et)),n=Math.max(-et,Math.min(tt-et,n-et)),$t.css({top:n+"px",left:i+"px"});var o=dt*ot;Ct.css({left:o-rt/2+"px"});var r=at*it;Ut.css({top:r-st+"px"})}}function N(t){var e=j(),i="",n=!tinycolor.equals(e,Rt);e&&(i=e.toString(Ht),k(e)),Ot&&bt.val(i),Rt=e,t&&n&&(Y.change(e),bt.trigger("change",[e]))}function V(){Z=kt.width(),tt=kt.height(),et=$t.height(),nt=xt.width(),it=xt.height(),st=Ut.height(),ot=St.width(),rt=Ct.width(),q||(wt.css("position","absolute"),wt.offset(l(wt,Nt))),L(),W.showPalette&&x(),bt.trigger("reflow.spectrum")}function B(){bt.show(),Nt.unbind("click.spectrum touchstart.spectrum"),wt.remove(),Lt.remove(),_[Qt.id]=null}function R(t,i){return t===n?e.extend({},W):i===n?W[t]:(W[t]=i,void c())}function F(){yt=!1,bt.attr("disabled",!1),Nt.removeClass("sp-disabled")}function H(){I(),yt=!0,bt.attr("disabled",!0),Nt.addClass("sp-disabled")}var W=s(p,a),q=W.flat,G=W.showSelectionPalette,Q=W.localStorageKey,J=W.theme,Y=W.callbacks,X=h(V,10),K=!1,Z=0,tt=0,et=0,it=0,nt=0,ot=0,rt=0,st=0,at=0,lt=0,pt=0,dt=1,ct=[],ut=[],ht={},ft=W.selectionPalette.slice(0),_t=W.maxSelectionSize,gt="sp-dragging",mt=null,vt=a.ownerDocument,bt=(vt.body,e(a)),yt=!1,wt=e(y,vt).addClass(J),kt=wt.find(".sp-color"),$t=wt.find(".sp-dragger"),xt=wt.find(".sp-hue"),Ut=wt.find(".sp-slider"),Et=wt.find(".sp-alpha-inner"),St=wt.find(".sp-alpha"),Ct=wt.find(".sp-alpha-handle"),Tt=wt.find(".sp-input"),zt=wt.find(".sp-palette"),It=wt.find(".sp-initial"),Pt=wt.find(".sp-cancel"),Mt=wt.find(".sp-clear"),jt=wt.find(".sp-choose"),Ot=bt.is("input"),Dt=Ot&&v&&"color"===bt.attr("type"),At=Ot&&!q,Lt=At?e(b).addClass(J).addClass(W.className):e([]),Nt=At?Lt:bt,Vt=Lt.find(".sp-preview-inner"),Bt=W.color||Ot&&bt.val(),Rt=!1,Ft=W.preferredFormat,Ht=Ft,Wt=!W.showButtons||W.clickoutFiresChange,qt=!Bt,Gt=W.allowEmpty&&!Dt;f();var Qt={show:z,hide:I,toggle:T,reflow:V,option:R,enable:F,disable:H,set:function(t){M(t),N()},get:j,destroy:B,container:wt};return Qt.id=_.push(Qt)-1,Qt}function l(t,i){var n=0,o=t.outerWidth(),r=t.outerHeight(),s=i.outerHeight(),a=t[0].ownerDocument,l=a.documentElement,p=l.clientWidth+e(a).scrollLeft(),d=l.clientHeight+e(a).scrollTop(),c=i.offset();return c.top+=s,c.left-=Math.min(c.left,c.left+o>p&&p>o?Math.abs(c.left+o-p):0),c.top-=Math.min(c.top,c.top+r>d&&d>r?Math.abs(r+s-n):n),c}function p(){}function d(t){t.stopPropagation()}function c(t,e){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return t.apply(e,n.concat(i.call(arguments)))}}function u(i,n,o,r){function s(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.returnValue=!1}function a(t){if(c){if(g&&document.documentMode<9&&!t.button)return p();var e=t.originalEvent.touches,o=e?e[0].pageX:t.pageX,r=e?e[0].pageY:t.pageY,a=Math.max(0,Math.min(o-u.left,f)),l=Math.max(0,Math.min(r-u.top,h));_&&s(t),n.apply(i,[a,l,t])}}function l(t){var n=t.which?3==t.which:2==t.button;t.originalEvent.touches;n||c||o.apply(i,arguments)!==!1&&(c=!0,h=e(i).height(),f=e(i).width(),u=e(i).offset(),e(d).bind(m),e(d.body).addClass("sp-dragging"),_||a(t),s(t))}function p(){c&&(e(d).unbind(m),e(d.body).removeClass("sp-dragging"),r.apply(i,arguments)),c=!1}n=n||function(){},o=o||function(){},r=r||function(){};var d=i.ownerDocument||document,c=!1,u={},h=0,f=0,_="ontouchstart"in t,m={};m.selectstart=s,m.dragstart=s,m["touchmove mousemove"]=a,m["touchend mouseup"]=p,e(i).bind("touchstart mousedown",l)}function h(t,e,i){var n;return function(){var o=this,r=arguments,s=function(){n=null,t.apply(o,r)};i&&clearTimeout(n),!i&&n||(n=setTimeout(s,e))}}var f={beforeShow:p,move:p,change:p,show:p,hide:p,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",clearText:"Clear Color Selection",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1},_=[],g=!!/msie/i.exec(t.navigator.userAgent),m=function(){function t(t,e){return!!~(""+t).indexOf(e)}var e=document.createElement("div"),i=e.style;return i.cssText="background-color:rgba(0,0,0,.5)",t(i.backgroundColor,"rgba")||t(i.backgroundColor,"hsla")}(),v=function(){var t=e("<input type='color' value='!' />")[0];return"color"===t.type&&"!"!==t.value}(),b=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),y=function(){var t="";if(g)for(var e=1;e<=6;e++)t+="<div class='sp-"+e+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",t,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),w="spectrum.id";e.fn.spectrum=function(t,i){if("string"==typeof t){var n=this,o=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=_[e(this).data(w)];if(i){var r=i[t];if(!r)throw new Error("Spectrum: no such method: '"+t+"'");"get"==t?n=i.get():"container"==t?n=i.container:"option"==t?n=i.option.apply(i,o):"destroy"==t?(i.destroy(),e(this).removeData(w)):r.apply(i,o)}}),n}return this.spectrum("destroy").each(function(){var i=e.extend({},t,e(this).data()),n=a(this,i);e(this).data(w,n.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=u,e.fn.spectrum.defaults=f,e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){v||e("input[type=color]").spectrum({preferredFormat:"hex6"})},function(){function e(t,n){if(t=t?t:"",n=n||{},"object"==typeof t&&t.hasOwnProperty("_tc_id"))return t;var r=i(t),a=r.r,d=r.g,h=r.b,f=r.a,_=E(100*f)/100,g=n.format||r.format;return a<1&&(a=E(a)),d<1&&(d=E(d)),h<1&&(h=E(h)),{ok:r.ok,format:g,_tc_id:x++,alpha:f,getAlpha:function(){return f},get_is_theme_color:function(){var t=Upfront.Views.Theme_Colors.colors.is_theme_color(this);return t!==!1?(this.is_theme_color=!0,t-=1,this.theme_color="#ufc"+t,this.theme_color_code=Upfront.Util.colors.convert_string_ufc_to_color(this.theme_color)):this.is_theme_color=!1,t},setAlpha:function(t){f=c(t),_=E(100*f)/100},toHsv:function(){var t=s(a,d,h);return{h:360*t.h,s:t.s,v:t.v,a:f}},toHsvString:function(){var t=s(a,d,h),e=E(360*t.h),i=E(100*t.s),n=E(100*t.v);return 1==f?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+_+")"},toHsl:function(){var t=o(a,d,h);return{h:360*t.h,s:t.s,l:t.l,a:f}},toHslString:function(){var t=o(a,d,h),e=E(360*t.h),i=E(100*t.s),n=E(100*t.l);return 1==f?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+_+")"},toHex:function(t){return l(a,d,h,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(){return p(a,d,h,f)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:E(a),g:E(d),b:E(h),a:f}},toRgbString:function(){return 1==f?"rgb("+E(a)+", "+E(d)+", "+E(h)+")":"rgba("+E(a)+", "+E(d)+", "+E(h)+", "+_+")"},toPercentageRgb:function(){return{r:E(100*u(a,255))+"%",g:E(100*u(d,255))+"%",b:E(100*u(h,255))+"%",a:f}},toPercentageRgbString:function(){return 1==f?"rgb("+E(100*u(a,255))+"%, "+E(100*u(d,255))+"%, "+E(100*u(h,255))+"%)":"rgba("+E(100*u(a,255))+"%, "+E(100*u(d,255))+"%, "+E(100*u(h,255))+"%, "+_+")"},toName:function(){return 0===f?"transparent":I[l(a,d,h,!0)]||!1},toFilter:function(t){var i="#"+p(a,d,h,f),o=i,r=n&&n.gradientType?"GradientType = 1, ":"";if(t){var s=e(t);o=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+i+",endColorstr="+o+")"},toString:function(t){var e=!!t;t=t||this.format;var i=!1,n=!e&&f<1&&f>0,o=n&&("hex"===t||"hex6"===t||"hex3"===t||"name"===t);return"rgb"===t&&(i=this.toRgbString()),"prgb"===t&&(i=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(i=this.toHexString()),"hex3"===t&&(i=this.toHexString(!0)),"hex8"===t&&(i=this.toHex8String()),"name"===t&&(i=this.toName()),"hsl"===t&&(i=this.toHslString()),"hsv"===t&&(i=this.toHsvString()),o?this.toRgbString():i||this.toHexString()}}}function i(t){var e={r:0,g:0,b:0},i=1,o=!1,s=!1;return"string"==typeof t&&(t=w(t)),"object"==typeof t&&(t.hasOwnProperty("r")&&t.hasOwnProperty("g")&&t.hasOwnProperty("b")?(e=n(t.r,t.g,t.b),o=!0,s="%"===String(t.r).substr(-1)?"prgb":"rgb"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("v")?(t.s=v(t.s),t.v=v(t.v),e=a(t.h,t.s,t.v),o=!0,s="hsv"):t.hasOwnProperty("h")&&t.hasOwnProperty("s")&&t.hasOwnProperty("l")&&(t.s=v(t.s),t.l=v(t.l),e=r(t.h,t.s,t.l),o=!0,s="hsl"),t.hasOwnProperty("a")&&(i=t.a)),i=c(i),{ok:o,format:t.format||s,r:S(255,C(e.r,0)),g:S(255,C(e.g,0)),b:S(255,C(e.b,0)),a:i}}function n(t,e,i){return{r:255*u(t,255),g:255*u(e,255),b:255*u(i,255)}}function o(t,e,i){t=u(t,255),e=u(e,255),i=u(i,255);var n,o,r=C(t,e,i),s=S(t,e,i),a=(r+s)/2;if(r==s)n=o=0;else{var l=r-s;switch(o=a>.5?l/(2-r-s):l/(r+s),r){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:o,l:a}}function r(t,e,i){function n(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}var o,r,s;if(t=u(t,360),e=u(e,100),i=u(i,100),0===e)o=r=s=i;else{var a=i<.5?i*(1+e):i+e-i*e,l=2*i-a;o=n(l,a,t+1/3),r=n(l,a,t),s=n(l,a,t-1/3)}return{r:255*o,g:255*r,b:255*s}}function s(t,e,i){t=u(t,255),e=u(e,255),i=u(i,255);var n,o,r=C(t,e,i),s=S(t,e,i),a=r,l=r-s;if(o=0===r?0:l/r,r==s)n=0;else{switch(r){case t:n=(e-i)/l+(e<i?6:0);break;case e:n=(i-t)/l+2;break;case i:n=(t-e)/l+4}n/=6}return{h:n,s:o,v:a}}function a(t,e,i){t=6*u(t,360),e=u(e,100),i=u(i,100);var n=U.floor(t),o=t-n,r=i*(1-e),s=i*(1-o*e),a=i*(1-(1-o)*e),l=n%6,p=[i,s,r,r,a,i][l],d=[a,i,i,s,r,r][l],c=[r,r,a,i,i,s][l];return{r:255*p,g:255*d,b:255*c}}function l(t,e,i,n){var o=[m(E(t).toString(16)),m(E(e).toString(16)),m(E(i).toString(16))];return n&&o[0].charAt(0)==o[0].charAt(1)&&o[1].charAt(0)==o[1].charAt(1)&&o[2].charAt(0)==o[2].charAt(1)?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0):o.join("")}function p(t,e,i,n){var o=[m(b(n)),m(E(t).toString(16)),m(E(e).toString(16)),m(E(i).toString(16))];return o.join("")}function d(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}function c(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function u(t,e){_(t)&&(t="100%");var i=g(t);return t=S(e,C(0,parseFloat(t))),i&&(t=parseInt(t*e,10)/100),U.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function h(t){return S(1,C(0,t))}function f(t){return parseInt(t,16)}function _(t){return"string"==typeof t&&t.indexOf(".")!=-1&&1===parseFloat(t)}function g(t){return"string"==typeof t&&t.indexOf("%")!=-1}function m(t){return 1==t.length?"0"+t:""+t}function v(t){return t<=1&&(t=100*t+"%"),t}function b(t){return Math.round(255*parseFloat(t)).toString(16)}function y(t){return f(t)/255}function w(t){t=t.replace(k,"").replace($,"").toLowerCase();var e=!1;if(z[t])t=z[t],e=!0;else if("transparent"==t)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=P.rgb.exec(t))?{r:i[1],g:i[2],b:i[3]}:(i=P.rgba.exec(t))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=P.hsl.exec(t))?{h:i[1],s:i[2],l:i[3]}:(i=P.hsla.exec(t))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=P.hsv.exec(t))?{h:i[1],s:i[2],v:i[3]}:(i=P.hex8.exec(t))?{a:y(i[1]),r:f(i[2]),g:f(i[3]),b:f(i[4]),format:e?"name":"hex8"}:(i=P.hex6.exec(t))?{r:f(i[1]),g:f(i[2]),b:f(i[3]),format:e?"name":"hex"}:!!(i=P.hex3.exec(t))&&{r:f(i[1]+""+i[1]),g:f(i[2]+""+i[2]),b:f(i[3]+""+i[3]),format:e?"name":"hex"}}var k=/^[\s,#]+/,$=/\s+$/,x=0,U=Math,E=U.round,S=U.min,C=U.max,T=U.random;e.fromRatio=function(t,i){if("object"==typeof t){var n={};for(var o in t)t.hasOwnProperty(o)&&("a"===o?n[o]=t[o]:n[o]=v(t[o]));t=n}return e(t,i)},e.equals=function(t,i){return!(!t||!i)&&e(t).toRgbString()==e(i).toRgbString()},e.random=function(){return e.fromRatio({r:T(),g:T(),b:T()})},e.desaturate=function(t,i){i=0===i?0:i||10;var n=e(t).toHsl();return n.s-=i/100,n.s=h(n.s),e(n)},e.saturate=function(t,i){i=0===i?0:i||10;var n=e(t).toHsl();return n.s+=i/100,n.s=h(n.s),e(n)},e.greyscale=function(t){return e.desaturate(t,100)},e.lighten=function(t,i){i=0===i?0:i||10;var n=e(t).toHsl();return n.l+=i/100,n.l=h(n.l),e(n)},e.darken=function(t,i){i=0===i?0:i||10;var n=e(t).toHsl();return n.l-=i/100,n.l=h(n.l),e(n)},e.complement=function(t){var i=e(t).toHsl();return i.h=(i.h+180)%360,e(i)},e.triad=function(t){var i=e(t).toHsl(),n=i.h;return[e(t),e({h:(n+120)%360,s:i.s,l:i.l}),e({h:(n+240)%360,s:i.s,l:i.l})]},e.tetrad=function(t){var i=e(t).toHsl(),n=i.h;return[e(t),e({h:(n+90)%360,s:i.s,l:i.l}),e({h:(n+180)%360,s:i.s,l:i.l}),e({h:(n+270)%360,s:i.s,l:i.l})]},e.splitcomplement=function(t){var i=e(t).toHsl(),n=i.h;return[e(t),e({h:(n+72)%360,s:i.s,l:i.l}),e({h:(n+216)%360,s:i.s,l:i.l})]},e.analogous=function(t,i,n){i=i||6,n=n||30;var o=e(t).toHsl(),r=360/n,s=[e(t)];for(o.h=(o.h-(r*i>>1)+720)%360;--i;)o.h=(o.h+r)%360,s.push(e(o));return s},e.monochromatic=function(t,i){i=i||6;for(var n=e(t).toHsv(),o=n.h,r=n.s,s=n.v,a=[],l=1/i;i--;)a.push(e({h:o,s:r,v:s})),s=(s+l)%1;return a},e.readability=function(t,i){var n=e(t).toRgb(),o=e(i).toRgb(),r=(299*n.r+587*n.g+114*n.b)/1e3,s=(299*o.r+587*o.g+114*o.b)/1e3,a=Math.max(n.r,o.r)-Math.min(n.r,o.r)+Math.max(n.g,o.g)-Math.min(n.g,o.g)+Math.max(n.b,o.b)-Math.min(n.b,o.b);return{brightness:Math.abs(r-s),color:a}},e.readable=function(t,i){var n=e.readability(t,i);return n.brightness>125&&n.color>500},e.mostReadable=function(t,i){for(var n=null,o=0,r=!1,s=0;s<i.length;s++){var a=e.readability(t,i[s]),l=a.brightness>125&&a.color>500,p=3*(a.brightness/125)+a.color/500;(l&&!r||l&&r&&p>o||!l&&!r&&p>o)&&(r=l,o=p,n=e(i[s]))}return n};var z=e.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},I=e.hexNames=d(z),P=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",i="(?:"+e+")|(?:"+t+")",n="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",o="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+o),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+o),hsv:new RegExp("hsv"+n),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();t.tinycolor=e}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})}(window,jQuery),define("spectrum",function(){}),function(t){define("editor_views",["chosen","scripts/upfront/global-event-handlers","scripts/upfront/inline-panels/inline-panels","scripts/upfront/element-settings/sidebar","scripts/upfront/link-panel","upfront/post-editor/upfront-post-edit","scripts/upfront/upfront-views-editor/jquery-plugins","scripts/upfront/upfront-views-editor/mixins","scripts/upfront/upfront-views-editor/fields","scripts/upfront/upfront-views-editor/fonts","scripts/upfront/upfront-views-editor/theme-colors","scripts/upfront/upfront-views-editor/modal","scripts/upfront/upfront-views-editor/modal-bg-setting","scripts/upfront/upfront-views-editor/settings","scripts/upfront/upfront-views-editor/css","scripts/upfront/upfront-views-editor/breakpoint","scripts/upfront/upfront-views-editor/region","scripts/upfront/upfront-views-editor/region/region-settings-sidebar","scripts/upfront/upfront-views-editor/commands","scripts/upfront/upfront-views-editor/topbar","scripts/upfront/upfront-views-editor/notifier","scripts/upfront/upfront-views-editor/loading","scripts/upfront/upfront-views-editor/post-selector","scripts/upfront/upfront-views-editor/sidebar","scripts/upfront/upfront-views-editor/presets/button/collection","scripts/upfront/upfront-views-editor/property","scripts/upfront/upfront-views-editor/properties","scripts/upfront/preset-settings/preset-saver","scripts/upfront/upfront-views-editor/theme-colors/color-saver","text!upfront/templates/property.html","text!upfront/templates/properties.html","text!upfront/templates/property_edit.html","text!upfront/templates/overlay_grid.html","text!upfront/templates/edit_background_area.html","text!upfront/templates/sidebar_settings_lock_area.html","text!upfront/templates/sidebar_settings_background.html","text!upfront/templates/popup.html","text!upfront/templates/region_add_panel.html","text!upfront/templates/region_edit_panel.html","text!upfront/templates/sidebar_settings_theme_colors.html","text!upfront/templates/color_picker.html","spectrum"],function(t,e,i,n,o,r,s,a,l,p,d,c,u,h,f,g,m,v,b,y,w,k,$,x,U,E,S,C,T){var z=["text!upfront/templates/property.html","text!upfront/templates/properties.html","text!upfront/templates/property_edit.html","text!upfront/templates/overlay_grid.html","text!upfront/templates/edit_background_area.html","text!upfront/templates/sidebar_settings_lock_area.html","text!upfront/templates/sidebar_settings_background.html","text!upfront/templates/popup.html","text!upfront/templates/region_add_panel.html","text!upfront/templates/region_edit_panel.html","text!upfront/templates/sidebar_settings_theme_colors.html","text!upfront/templates/color_picker.html"],I=_.rest(arguments,29),P={};return _(z).each(function(t,e){t.match(/text!/)&&(P[t.replace(/text!upfront\/templates\//,"").replace(/\.html/,"")]=I[e])}),Upfront.Events.on("data:ready",function(){Upfront.data.tpls=P}),{Editor:{Property:E,Properties:S,Commands:b.Commands,Command:b.Command,Command_SaveLayout:b.Command_SaveLayout,Command_SavePostLayout:b.Command_SavePostLayout,Command_CancelPostLayout:b.Command_CancelPostLayout,Command_Undo:b.Command_Undo,Command_ToggleGrid:b.Command_ToggleGrid,Command_Merge:b.Command_Merge,Settings:h,Button:{Presets:U},Fonts:p,Field:l,Sidebar:x,Topbar:{Topbar:y},notify:function(t,e,i){w.addMessage(t,e,i)},Loading:k,Modal:c,ModalBgSetting:u,PostSelector:new $,InlinePanels:i,RegionPanels:m.RegionPanels,RegionPanelsAddRegion:m.RegionPanelItemAddRegion,RegionFixedPanels:m.RegionFixedPanels,RegionFixedEditPosition:m.RegionFixedEditPosition,RegionBgSetting:m.RegionBgSetting,RegionBgSettingFixed:m.RegionBgSettingFixed,RegionBgSettingLightbox:m.RegionBgSettingLightbox,CSSEditor:f.CSSEditor,Insert_Font_Widget:p.Insert_Font_Widget,GeneralCSSEditor:f.GeneralCSSEditor,LinkPanel:o},Mixins:a,Theme_Colors:d,breakpoints_storage:g.storage,Font_Model:p.Model,PresetSaver:C,ColorSaver:T}})}(jQuery),function(t){var e={selection:[],selecting:!1,create_mergeable:function(e,i){var n=this,o=Upfront.Behaviors.LayoutEditor;n.layout.get("regions");e.$el.selectable({distance:10,filter:".upfront-module",cancel:".upfront-module:not(.upfront-module-spacer), .upfront-module-group, .upfront-region-side-fixed, .upfront-entity_meta, .upfront-region-edit-trigger, .upfront-region-edit-fixed-trigger, .upfront-region-finish-edit, .upfront-icon-control-region-resize, .upfront-inline-modal, .upfront-inline-panels",selecting:function(e,i){var n,r=t(i.selecting);if(!(r.closest(".upfront-module-group").length>0)){if(o.selection.length>0){if(n=t(o.selection[0]).closest(".upfront-region"),r.closest(".upfront-region").get(0)!=n.get(0))return;o._add_selections(n.find(".ui-selecting"),n.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),n.find(".upfront-module-group"))}else o._add_selection(i.selecting);o._update_selection_outline()}},unselecting:function(e,i){var n,r,s=t(i.unselecting);if(o.selection.length>1){if(n=t(o.selection[0]).closest(".upfront-region"),s.closest(".upfront-region").get(0)!=n.get(0))return;return t(".upfront-ui-selected").each(function(){o._remove_selection(this)}),r=n.find(".ui-selecting"),r.length>0&&(o._add_selection(r.get(0)),o._add_selections(r,n.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),n.find(".upfront-module-group"))),void o._update_selection_outline()}o._remove_selection(i.unselecting),o._update_selection_outline()},unselected:function(e,i){var n=t(i.unselected);n.find(".upfront-selected-border").remove(),t(".upfront-module-group-group").remove()},start:function(t,e){o.remove_selections(),o.selection=[],o.selecting=!0},stop:function(t,e){o.parse_selections()}})},refresh_mergeable:function(){this.remove_selections(),t(".ui-selectable").each(function(){t(this).selectable("refresh")})},enable_mergeable:function(){this.remove_selections(),t(".ui-selectable").each(function(){t(this).selectable("enable")})},disable_mergeable:function(){this.remove_selections(),t(".ui-selectable").each(function(){t(this).selectable("disable")})},destroy_mergeable:function(){this.remove_selections(),t(".ui-selectable").each(function(){t(this).selectable("destroy")})},parse_selections:function(){if(!t(".upfront-ui-selected").length)return!1;if(!Upfront.Application.user_can_modify_layout())return!1;var e=this,i=Upfront.Application.layout.get("regions"),n=t(".upfront-ui-selected:first").closest(".upfront-region"),o=i.get_by_name(n.data("name")),r=!!o&&o.get("modules"),s=!!o&&o.get("wrappers"),a=t(".upfront-ui-selected");if(a.length<2)return a.each(function(){e._remove_selection(this)}),t("#upfront-group-selection").remove(),!1;t(".upfront-module-group-group").remove();var l=t('<div class="upfront-module-group-toggle upfront-module-group-group">'+Upfront.Settings.l10n.global.behaviors.group+"</div>"),p=sel_left=sel_right=sel_bottom=!1,d=wrap_left=wrap_right=wrap_bottom=!1,c=group_left=0;t("body").append(l),a.each(function(){var e=t(this).offset(),i=t(this).outerWidth(),n=t(this).outerHeight(),o=t(this).closest(".upfront-wrapper"),r=o.offset(),s=o.outerWidth(),a=o.outerHeight();e.right=e.left+i,e.bottom=e.top+n,p=p===!1||e.top<p?e.top:p,sel_bottom=sel_bottom===!1||e.bottom>sel_bottom?e.bottom:sel_bottom,sel_left=sel_left===!1||e.left<sel_left?e.left:sel_left,sel_right=sel_right===!1||e.right>sel_right?e.right:sel_right,r.right=r.left+s,r.bottom=r.top+a,d=d===!1||r.top<d?r.top:d,wrap_bottom=wrap_bottom===!1||r.bottom>wrap_bottom?r.bottom:wrap_bottom,wrap_left=wrap_left===!1||r.left<wrap_left?r.left:wrap_left,wrap_right=wrap_right===!1||r.right>wrap_right?r.right:wrap_right}),c=p+Math.round((sel_bottom-p)/2)-Math.round(l.outerHeight()/2),group_left=sel_left+Math.round((sel_right-sel_left)/2)-Math.round(l.outerWidth()/2),
l.css({position:"absolute",zIndex:999999,top:c,left:group_left}),setTimeout(function(){e.selecting=!1},1e3),l.on("click",function(){var i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),l=Upfront.Behaviors.GridEditor,p=!1,d=(Math.round((wrap_right-wrap_left)/l.grid.column_width),l.parse_modules_to_lines(r,s,i.id,i.columns)),c=[],u=[],h=[],f=0,g=0,m=0,v=!1;_.each(d,function(e){var i=[],n=[],o=[],r=[],s=[],l=0,d=0,v=0;_.each(e.wrappers,function(e){var c=[],u=[],h=[];_.each(e.modules,function(e){var i=!1;a.each(function(){var n=t(this).attr("id");e.model.get_element_id()==n&&(p===!1&&(p=Upfront.data.module_views[e.model.cid]),c.push(e),i=!0)}),i||(0==c.length?u.push(e):h.push(e))}),c.length>0?(i.push({modules:c,top_modules:u,bottom_modules:h,model:e.model,col:e.col,clear:e.clear,spacer:e.spacer,order:e.order}),l+=e.col,u.length&&r.push({modules:u,model:e.model,col:e.col,clear:e.clear,spacer:e.spacer,order:e.order}),h.length&&s.push({modules:h,model:e.model,col:e.col,clear:e.clear,spacer:e.spacer,order:e.order})):((0==i.length?n:o).push({modules:e.modules,model:e.model,col:e.col,clear:e.clear,spacer:e.spacer,order:e.order}),0==i.length?d+=e.col:v+=e.col)}),i.length>0&&(c.push({wrappers:i,top_wrappers:r,bottom_wrappers:s,col:l}),f=l>f?l:f,n.length>0&&(u.push({wrappers:n,col:d}),g=d>g?d:g),o.length>0&&(h.push({wrappers:o,col:v}),m=v>m?v:m))}),l.start(p,p.model),u.length>1&&(e._do_combine(u,o)||e._do_group(u,o)),0==u.length&&0==h.length&&(v=!0),e._do_group(c,o,!1,v),h.length>1&&(e._do_combine(h,o)||e._do_group(h,o)),l.update_position_data(n.find(".upfront-editable_entities_container:first")),l.update_wrappers(o),t(this).remove(),t("#upfront-group-selection").remove(),e.selection=[]})},_do_group:function(t,e,i,n){var o=this,r=Upfront.Behaviors.GridEditor,s=i===!0,n=n===!0,a=e.get("modules"),l=e.get("wrappers"),p=Upfront.Util.get_unique_id("module-group"),d=new Upfront.Models.ModuleGroup,c=d.get("modules"),u=d.get("wrappers"),h=!1,f=!1,g=!1,m=0,v=!1,b=!1,y=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(t,function(t,i){m=t.col>m?t.col:m,_.each(t.wrappers,function(t,e){var n=new Upfront.Models.Wrapper({}),o=Upfront.Util.get_unique_id("wrapper"),s=Upfront.data.wrapper_views[t.model.cid],p="top_modules"in t&&t.top_modules.length>0,d="bottom_modules"in t&&t.bottom_modules.length>0;n.set_property("wrapper_id",o),n.set_property("class",t.model.get_property_value_by_name("class")),n.replace_class(r.grid.class+t.col),0==e&&(n.add_class("clr"),0==i&&(h=t.clear)),u.add(n),_.each(t.modules,function(t,e){var i=a.indexOf(t.model),n=Upfront.data.module_views[t.model.cid];v===!1&&(v=i),t.model.set_property("wrapper_id",o,!0),a.remove(t.model,{silent:!0}),n.$el.detach(),p||d||s.$el.detach(),c.add(t.model)}),0==i&&0==e?(g=t.model.get_wrapper_id(),f=t.model):p||l.remove(t.model)}),"bottom_wrappers"in t&&t.bottom_wrappers.length>1&&(n?o._do_split(t.bottom_wrappers,e):o._do_group([{wrappers:t.bottom_wrappers,col:t.col}],e)),"top_wrappers"in t&&t.top_wrappers.length>1&&(n?(_.each(t.top_wrappers,function(t,e){_.each(t.modules,function(t,e){var i=a.indexOf(t.model);return b===!1?void(b=i):(a.remove(t.model,{silent:!0}),b++,void t.model.add_to(a,b))})}),b!==!1&&(v=b+1),s=!0):o._do_group([{wrappers:t.top_wrappers,col:t.col}],e))}),s&&(f=new Upfront.Models.Wrapper({}),g=Upfront.Util.get_unique_id("wrapper"),l.add(f)),f.set_property("wrapper_id",g),f.replace_class(r.grid.class+m),h&&f.add_class("clr"),d.set_property("wrapper_id",g),d.set_property("element_id",p),d.replace_class(r.grid.class+m),d.set_property("original_col",m);var w=f&&f.get_property_value_by_name("breakpoint")||{},k=d.get_property_value_by_name("breakpoint")||{};_.each(y,function(t){var e=t.toJSON();e.default||w&&w[e.id]&&w[e.id].edited&&(_.isObject(k[e.id])||(k[e.id]={edited:!1}),!k[e.id].edited&&_.isNumber(w[e.id].col)&&(k[e.id].col=w[e.id].col,k[e.id].edited=!0,d.set_property("breakpoint",Upfront.Util.clone(k))))}),d.add_to(a,v),Upfront.Events.trigger("entity:module_group:group",d,e)},_do_combine:function(t,e){var i=(Upfront.Behaviors.GridEditor,e.get("modules")),n=e.get("wrappers"),o=[],r=[],s=!0;if(_.each(t,function(t,e){e in o||(o[e]=[]),_.each(t.wrappers,function(t,i){i in r||(r[i]=[]),o[e][i]=t.col,r[i].push(t)})}),o.length>1)for(var a=1;a<o.length;a++)if(!_.isEqual(o[a-1],o[a])){s=!1;break}return!!s&&(_.each(r,function(t){var e,o=0,r=_.filter(t,function(t){return t.spacer}),s=t.length==r.length;_.each(t,function(t,r){return 0==r?(e=t.model.get_wrapper_id(),o=i.indexOf(_.last(t.modules).model),void(t.spacer&&!s&&(_.each(t.modules,function(t){i.remove(t.model)}),o--))):(n.remove(t.model),void(t.spacer?_.each(t.modules,function(t){i.remove(t.model)}):_.each(t.modules,function(t,n){t.model.set_property("wrapper_id",e,!0),i.remove(t.model,{silent:!0}),o++,t.model.add_to(i,o)})))})}),!0)},_do_split:function(t,e){var i=(Upfront.Behaviors.GridEditor,e.get("modules")),n=e.get("wrappers");return _.each(t,function(t,e){var o=new Upfront.Models.Wrapper({}),r=Upfront.Util.get_unique_id("wrapper");o.set_property("wrapper_id",r),o.set_property("class",t.model.get_property_value_by_name("class")),n.add(o),_.each(t.modules,function(t,e){var n=i.indexOf(t.model);t.model.set_property("wrapper_id",r,!0),i.remove(t.model,{silent:!0}),t.model.add_to(i,n)})}),!0},_get_group_position:function(e){var i=sel_left=sel_right=sel_bottom=!1,n=wrap_left=wrap_right=wrap_bottom=!1;return e.each(function(){var e=t(this).offset(),o=Math.round(parseFloat(t(this).css("width"))),r=Math.round(parseFloat(t(this).css("height"))),s=t(this).closest(".upfront-wrapper"),a=s.offset(),l=Math.round(parseFloat(s.css("width"))),p=Math.round(parseFloat(s.css("height")));e.left=Math.round(e.left),e.top=Math.round(e.top),e.right=e.left+o,e.bottom=e.top+r,i=i===!1||e.top<i?e.top:i,sel_bottom=sel_bottom===!1||e.bottom>sel_bottom?e.bottom:sel_bottom,sel_left=sel_left===!1||e.left<sel_left?e.left:sel_left,sel_right=sel_right===!1||e.right>sel_right?e.right:sel_right,a.left=Math.round(a.left),a.top=Math.round(a.top),a.right=a.left+l,a.bottom=a.top+p,n=n===!1||a.top<n?a.top:n,wrap_bottom=wrap_bottom===!1||a.bottom>wrap_bottom?a.bottom:wrap_bottom,wrap_left=wrap_left===!1||a.left<wrap_left?a.left:wrap_left,wrap_right=wrap_right===!1||a.right>wrap_right?a.right:wrap_right}),{element:{top:i,bottom:sel_bottom,left:sel_left,right:sel_right},wrapper:{top:n,bottom:wrap_bottom,left:wrap_left,right:wrap_right}}},_find_affected_el:function(e,i){if(0==this.selection.length)return!1;var n=!1;return e.each(function(){var e=t(this).offset(),o=Math.round(parseFloat(t(this).css("width"))),r=Math.round(parseFloat(t(this).css("height"))),s=Math.round(e.top),a=Math.round(e.left),l=s+r,p=a+o;i.top<l&&i.bottom>s&&i.left<p&&i.right>a&&(n=n!==!1?n.add(t(this)):t(this))}),n},_update_selection_outline:function(){var e=t("#upfront-group-selection"),i=this._get_group_position(t(this.selection));e.length||(e=t('<div id="upfront-group-selection" />'),e.appendTo("body")),e.css({top:i.element.top,left:i.element.left,height:i.element.bottom-i.element.top,width:i.element.right-i.element.left})},_add_selection:function(e){var i=_.find(this.selection,function(t){return t==e});i||(this.selection.push(e),t(e).addClass("upfront-ui-selected"))},_add_selections:function(e,i,n){var o,r,s,a=this,l=[];e.each(function(){var e=this,p=_.find(a.selection,function(t){return t==e}),d=t(i);if(!p){for(l=[],o=a._get_group_position(t(a.selection).add(this)),r=a._find_affected_el(d,o.element);r!==!1;)r.each(function(){l.push(this)}),d=d.not(r),o=a._get_group_position(t(a.selection).add(l)),r=a._find_affected_el(d,o.element);s=a._find_affected_el(n,o.element),s===!1&&_.each(l,function(t){a._add_selection(t)})}})},_remove_selection:function(e){this.selection=_.reject(this.selection,function(t){return t==e}),t(e).find(".upfront-selected-border").remove(),t(e).removeClass("upfront-ui-selected ui-selected")},remove_selections:function(){var e=Upfront.Behaviors.LayoutEditor;t(".upfront-ui-selected").each(function(){e._remove_selection(this)}),e._update_selection_outline(),t(".upfront-module-group-group").remove()},create_undo:function(){this.layout.store_undo_state()},apply_history_change:function(){var t=Upfront.Application.layout.get("regions"),e=!!t&&t.get_by_name("shadow");t&&e&&(t.remove(e),e=!1),Upfront.Application.layout_view.render()},save_dialog:function(e,i,n,o){t("body").append("<div id='upfront-save-dialog-background' />"),t("body").append("<div id='upfront-save-dialog' />");var r=t("#upfront-save-dialog"),s=t("#upfront-save-dialog-background"),a=(Upfront.Application.layout.get("current_layout"),"");o=!0===o,a+=o?"<p>"+Upfront.Settings.l10n.global.behaviors.this_archive_only+"</p>":"<p>"+Upfront.Settings.l10n.global.behaviors.this_post_only+"</p>",t.each(_upfront_post_data.layout,function(t,e){"type"!=t&&(a+=o?'<span class="upfront-save-button" data-save-as="'+e+'">'+Upfront.Settings.LayoutEditor.ArchiveSpecificity[t]+"</span>":'<span class="upfront-save-button" data-save-as="'+e+'">'+Upfront.Settings.LayoutEditor.Specificity[t]+"</span>")}),!0===Upfront.plugins.isForbiddenByPlugin("show save as dialog")||n!==!0?(s.remove(),r.remove(),e.apply(i,["single-post"])):(r.html(a),t("#upfront-save-dialog").on("click",".upfront-save-button",function(){var n=t(this).attr("data-save-as");return s.remove(),r.remove(),e.apply(i,[n]),Upfront.Events.trigger("command:proceed:save:post"),!1}),t("#upfront-save-dialog-background").on("click",function(){return s.remove(),r.remove(),!1}))},clean_region_css:function(){var e=Upfront.Application.cssEditor,i=(Upfront.Behaviors.LayoutEditor,[e.elementTypes.RegionContainer,e.elementTypes.Region]),n=_upfront_post_data.layout,o=n.specificity||n.item||n.type,r=Upfront.Application.layout.get("regions"),s=[],a=[],l=function(e){if(!a[e])return Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.region_css_cleaned),void p.resolve();var i,n=a[e].elementType,o=a[e].styleName,r=Upfront.plugins.call("prepare-delete-element-styles-data",{styleName:o,elementType:n});i=r.status&&"called"===r.status&&r.result?r.result:{action:"upfront_delete_styles",styleName:o,elementType:n},Upfront.Util.post(i).done(function(){var i=Upfront.data.styles[n].indexOf(o);i!=-1&&Upfront.data.styles[n].splice(i,1),t("#upfront-style-"+o).remove(),l(e+1)})},p=new t.Deferred;return r.each(function(t){var i=t.is_main()?e.elementTypes.RegionContainer.id:e.elementTypes.Region.id,n=o+"-"+t.get("name")+"-style";"global"==t.get("scope");_.isArray(Upfront.data.styles[i])&&Upfront.data.styles[i].indexOf(n)!=-1&&s.push(n),n=i+"-"+t.get("name")+"-style",_.isArray(Upfront.data.styles[i])&&Upfront.data.styles[i].indexOf(n)!=-1&&s.push(n)}),Upfront.plugins.call("clean-region-css",{elementTypes:i,layout_id:o,styleExists:s,deleteDatas:a,deleteFunc:l}),p.promise()},_build_query:function(t){return _.map(t,function(t,e){return e+"="+t}).join("&")},clean_global_regions:function(){Upfront.data.global_regions=!1},open_global_region_manager:function(){var e=Upfront.Behaviors.LayoutEditor;Upfront.Popup.open(function(i,n,o){var r=t(this);r.html('<p class="upfront-popup-placeholder">'+Upfront.Settings.l10n.global.behaviors.loading_content+"</p>"),Upfront.data.global_regions?e._render_global_region_manager(r):e._refresh_global_regions().done(function(){e._render_global_region_manager(r)})},{width:600},"global-region-manager")},open_theme_fonts_manager:function(){var e={},i=new Upfront.Views.Editor.Fonts.Text_Fonts_Manager({collection:Upfront.Views.Editor.Fonts.theme_fonts_collection});if(i.render(),Upfront.Application.mode.current===Upfront.Application.MODE.THEME){var n=new Upfront.Views.Editor.Fonts.Icon_Fonts_Manager({collection:Upfront.Views.Editor.Fonts.icon_fonts_collection});n.render()}Upfront.Popup.open(function(i,n,o){var r=t(this);r.empty().append('<p class="upfront-popup-placeholder">'+Upfront.Settings.l10n.global.behaviors.loading_content+"</p>"),e.$popup={top:n,content:r,bottom:o}},{width:750},"font-manager-popup");e.$popup.top.html('<ul class="upfront-tabs"><li id="theme-text-fonts-tab" class="active">'+Upfront.Settings.l10n.global.behaviors.theme_text_fonts+"</li>"+(Upfront.Application.mode.current===Upfront.Application.MODE.THEME?'<li id="theme-icon-fonts-tab">'+Upfront.Settings.l10n.global.behaviors.theme_icon_fonts+"</li>":"")+"</ul>"+e.$popup.top.html()),e.$popup.top.on("click","#theme-text-fonts-tab",function(n){e.$popup.content.html(i.el),t("#theme-icon-fonts-tab").removeClass("active"),t("#theme-text-fonts-tab").addClass("active"),t(".theme-fonts-ok-button").css("margin-top","30px")}),e.$popup.top.on("click","#theme-icon-fonts-tab",function(){e.$popup.content.html(n.el),t("#theme-text-fonts-tab").removeClass("active"),t("#theme-icon-fonts-tab").addClass("active"),t(".theme-fonts-ok-button").css("margin-top",0)}),e.$popup.bottom.append('<a class="theme-fonts-ok-button">'+Upfront.Settings.l10n.global.behaviors.ok+"</a>"),e.$popup.content.html(i.el),i.set_ok_button(e.$popup.bottom.find(".theme-fonts-ok-button")),e.$popup.bottom.find(".theme-fonts-ok-button").on("click",function(){Upfront.Popup.close()})},_refresh_global_regions:function(){return Upfront.Util.post({action:"upfront_list_scoped_regions",scope:"global",storage_key:_upfront_save_storage_key}).done(function(t){Upfront.data.global_regions=t.data})},_render_global_region_manager:function(e){var i=Upfront.Behaviors.LayoutEditor,n=Upfront.Application.layout.get("regions"),o=[{title:Upfront.Settings.l10n.global.behaviors.global_regions,classname:"global",data:_.sortBy(Upfront.data.global_regions,function(t,e,i){return t.container&&t.name!=t.container?3*_.indexOf(i,_.findWhere(i,{name:t.container}))+1:3*e})},{title:Upfront.Settings.l10n.global.behaviors.lightboxes,classname:"lightbox",data:Upfront.Util.model_to_json(n.filter(function(t){return"lightbox"==t.get("sub")}))}];e.html(""),_.each(o,function(n){var o=t('<div class="global-region-manager-wrap global-region-manager-'+n.classname+'"></div>'),r=t('<h3 class="global-region-manager-title">'+n.title+"</h3>"),s=t('<div class="global-region-manager-content upfront-scroll-panel"></div>');o.append([r,s]),i._render_regions(n.data,s,n.classname),e.append(o),Upfront.Views.Mixins.Upfront_Scroll_Mixin.stop_scroll_propagation(s)}),e.on("click",".region-list-edit",function(t){t.preventDefault()}),e.on("click",".region-list-trash",function(o){o.preventDefault();var r=t(this).attr("data-name");t(this).closest(".global-region-manager-wrap").hasClass("global-region-manager-global")&&confirm("Deleting the global regions will remove it from all layouts. Continue?")&&Upfront.Util.post({action:"upfront_delete_scoped_regions",scope:"global",name:r,storage_key:_upfront_save_storage_key}).done(function(t){t.data&&(_.each(t.data,function(t){var e=n.get_by_name(t);n.remove(e)}),i._refresh_global_regions().done(function(){i._render_global_region_manager(e)}))})})},_render_regions:function(e,i,n){var o=t('<ul class="global-region-manager-lists"></ul>');if(_.each(e,function(t){var i=["global-region-manager-list"],n=!1;t.container&&t.name!=t.container?(n=_.find(e,function(e){return e.name==t.container}),i.push("region-list-sub"),i.push("region-list-sub-"+t.sub),n&&i.push("region-list-sub-has-main")):i.push("region-list-main"),o.append('<li class="'+i.join(" ")+'"><span class="region-list-name">'+t.title+'</span><span class="region-list-control">'+(!1===Upfront.plugins.isForbiddenByPlugin("show region list trash")?'<a href="#" class="region-list-trash" data-name="'+t.name+'">'+Upfront.Settings.l10n.global.behaviors.trash+"</a>":"")+"</span></li>")}),e.length<1){if("lightbox"===n)var r=Upfront.Settings.l10n.global.behaviors.no_lightboxes;else var r=Upfront.Settings.l10n.global.behaviors.no_global_regions;o='<span class="region-list-empty">'+r+"</span>"}i.append(o)},import_image_dialog:function(){var t=Upfront.Behaviors.LayoutEditor,e=[],i=[];Upfront.Events.trigger("upfront:import_image:populate_theme_images",e),e.length<=0||Upfront.Util.post({action:"upfront_list_import_image",images:e}).done(function(e){0===parseInt(e.data.error,10)&&(_.each(e.data.images,function(t){"not_exists"===t.status?i.push(t.filepath):"exists"===t.status&&Upfront.Events.trigger("upfront:import_image:imported",t)}),i.length>0&&t.open_import_image_dialog(i))})},open_import_image_dialog:function(e){var i=Upfront.Behaviors.LayoutEditor;i.import_image_modal||(i.import_image_modal=new Upfront.Views.Editor.Modal({to:t("body"),button:!1,top:120,width:600}),i.import_image_modal.render(),t("body").append(i.import_image_modal.el)),i.import_image_modal.open(function(n,o){var r=!1,s=new Upfront.Views.Editor.Field.Button({name:"import_image",label:Upfront.Settings.l10n.global.behaviors.import_image_button,compact:!0,classname:"upfront-import-image-button",on_click:function(){r||(i.do_import_image(e).done(function(){n.html("<p>"+Upfront.Settings.l10n.global.behaviors.import_image_done_description+"</p>"),setTimeout(function(){i.import_image_modal.close()},3e3)}),r=!0)}}),a=new Upfront.Views.Editor.Field.Button({name:"import_image_ignore",label:Upfront.Settings.l10n.global.behaviors.import_image_ignore_button,compact:!0,classname:"upfront-import-image-button",on_click:function(){i.import_image_modal.close()}}),l=t('<ul class="upfront-import-image-list upfront-scroll-panel"></ul>');o.addClass("upfront-import-image-modal"),n.html("<p>"+Upfront.Settings.l10n.global.behaviors.import_image_description+"</p>"),_.each(e,function(t,e){l.append('<li class="upfront-import-image-each" id="import-image-'+e+'"><img src="'+t+'" alt="" /></li>')}),n.append(l),_.each([s,a],function(t){t.render(),t.delegateEvents(),n.append(t.$el)})},i)},do_import_image:function(e){var i,n=Upfront.Behaviors.LayoutEditor,o=4,r=function(e){for(var i=n._import_image_index;i<n._import_image_index+o;i++)t("#import-image-"+i).removeClass("processing done").addClass(e)};return n._import_image_index||(n._import_image_index=0),n._import_image_deferred||(n._import_image_deferred=new t.Deferred),i=e.slice(n._import_image_index,n._import_image_index+o),0===i.length?(n._import_image_deferred.resolve(),void(n._import_image_index=!1)):(r("processing"),Upfront.Util.post({action:"upfront_import_image",images:i}).done(function(t){_.each(t.data.images,function(t){"import_success"===t.status&&Upfront.Events.trigger("upfront:import_image:imported",t)}),r("done"),n._import_image_index+=o,n.do_import_image(e)}),n._import_image_deferred.promise())}};define("scripts/upfront/behaviors/layout-editor",e)}(jQuery),function(t){define("scripts/upfront/behaviors/dragdrop",[],function(){var e=function(t,e){this.initialize(t,e)};return e.prototype={module_selector:"> .upfront-module-view > .upfront-module, > .upfront-module-group",object_selector:"> .upfront-object-view > .upfront-object",el_selector:"",view:!1,model:!1,$me:!1,$wrap:!1,$region:!1,$main:!1,$layout:!1,me:!1,wrap:!1,region:!1,current_region:!1,$container:!1,$current_container:!1,region_model:!1,current_region_model:!1,current_wrappers:!1,is_group:!1,is_object:!1,is_parent_group:!1,is_disabled:!1,$helper:!1,event:!1,ui:!1,breakpoint:!1,app:!1,ed:!1,drop_areas:!1,drop_areas_created:!1,drops:!1,drop:!1,drop_col:0,drop_left:0,drop_top:0,area_col:0,current_area_col:0,current_row_wraps:!1,wrapper_id:!1,wrap_only:!1,new_wrap_view:!1,move_region:!1,has_siblings:!1,sibling_index:-1,move_siblings:!1,$wrap_move:!1,current_grid:!1,current_grid_pos:!1,compare_area:!1,compare_area_position:!1,compare_col:0,compare_row:0,_last_drag_position:!1,_last_drag_time:0,_last_coord:!1,_t:!1,_focus_t:!1,focus:!1,focus_coord:!1,initialize:function(t,e){this.view=t,this.model=e,this.app=Upfront.Application,this.ed=Upfront.Behaviors.GridEditor,this.drop_areas=[],this.drop_areas_created=[],this.drops=[],this.current_row_wraps=[],this.current_grid={},this.current_grid_pos={},this.compare_area={},this.compare_area_position={},this._last_coord={x:0,y:0},this.focus_coord={x:0,y:0},this.setup()},setup:function(){return this.is_group=this.view.$el.hasClass("upfront-module-group"),this.is_object=this.view.$el.hasClass("upfront-object-view"),this.is_parent_group="undefined"!=typeof this.view.group_view,this.is_disabled=this.is_parent_group&&!this.view.group_view.$el.hasClass("upfront-module-group-on-edit")||this.is_object&&this.view.object_group_view&&!this.view.object_group_view.$el.hasClass("upfront-object-group-on-edit"),this.$me=this.is_group?this.view.$el:this.view.$el.find(".upfront-editable_entity:first"),this.$main=t(Upfront.Settings.LayoutEditor.Selectors.main),this.$layout=this.$main.find(".upfront-layout"),this.el_selector=this.is_object?this.object_selector:this.module_selector,(!1!==Upfront.plugins.isRequiredByPlugin("setup drag and drop")||!this.model.get_property_value_by_name("disable_drag"))&&(!this.$me.hasClass("upfront-module-spacer")&&!this.$me.hasClass("upfront-object-spacer")&&((!this.is_object||"undefined"!=typeof this.view.object_group_view)&&(this.$me.data("ui-draggable")?(!this.is_group&&this.is_disabled||this.$me.draggable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?void this.$me.draggable({revert:!0,revertDuration:0,zIndex:100,helper:"clone",disabled:this.is_disabled,cancel:".upfront-entity_meta, .upfront-element-controls",distance:10,appendTo:this.$main,iframeFix:!0,start:t.proxy(this.on_start,this),drag:t.proxy(this.on_drag,this),stop:t.proxy(this.on_stop,this)}):(this.$me.data("ui-draggable")&&(!this.is_group&&this.is_disabled||this.$me.draggable("option","disabled",!1)),!1))))},on_start:function(t,e){this.ed.time_start("drag start"),this.event=t,this.ui=e,this.breakpoint=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),this.is_parent_group="undefined"!=typeof this.view.group_view,this.prepare_drag(),this.ed.time_end("drag start"),this.ed.time_start("drag start - trigger"),Upfront.Events.trigger("entity:drag_start",this.view,this.model),this.ed.time_end("drag start")},on_drag:function(t,e){var i=this;this.event=t,this.ui=e,clearTimeout(this._t),this._t=setTimeout(function(){i.update_drop_timeout()},this.ed.timeout),this.update_drop_position(),this.update_siblings_position(),this.ed.show_debug_element&&this.$helper.find(".upfront-debug-info").text("grid: "+this.current_grid.x+","+this.current_grid.y+" | current: ("+this.current_grid_pos.left+","+this.current_grid_pos.top+"),("+this.current_grid_pos.right+","+this.current_grid_pos.bottom+") | margin size: "+this.drop_top+"/"+this.drop_left)},on_stop:function(e,i){var n=this;this.ed.time_start("drag stop"),this.event=e,this.ui=i,clearTimeout(this._t),clearTimeout(this._focus_t),this.drop.is_me||this.render_drop(),this.clean_elements(),this.update_models(),this.update_views(),this.reset();var o=this.is_group?this.view.$el:this.view.$el.find(".upfront-editable_entity:first"),r="animationend.drop_ani webkitAnimationEnd.drop_ani MSAnimationEnd.drop_ani oAnimationEnd.drop_ani";o.one(r,function(){t(this).removeClass("upfront-dropped"),Upfront.Events.trigger("entity:drag_animate_stop",n.view,n.model),o.off(r)}).addClass("upfront-dropped"),Upfront.Events.trigger("entity:drag_stop",this.view,this.model),this.view.trigger("entity:drop",{col:this.drop_col,left:this.drop_left,top:this.drop_top},this.view,this.model),this.view.trigger("entity:self:drag_stop"),this.ed.time_end("drag stop")},update_vars:function(){var e=this.app.layout.get("regions");this.$helper=t(".ui-draggable-dragging"),this.$wrap=this.$me.closest(".upfront-wrapper"),this.$region=this.$me.closest(".upfront-region"),this.me=this.ed.get_el(this.$me),this.wrap=this.ed.get_wrap(this.$wrap),this.region=this.ed.get_region(this.$region),this.region_model=e.get_by_name(this.region.region),this.$container=this.$region.find(".upfront-modules_container > .upfront-editable_entities_container:first")},create_drop_point:function(){var e=this.ed;e.time_start("fn create_drop_point");var i=this.breakpoint,n=this,o=this.me,r=this.wrap,s=(o.$el.data("margin"),o.col),a=o.$el.hasClass("upfront-image_module")?1:s>e.min_col?e.min_col:s,l=o.row>e.max_row?e.max_row:o.row,p=o.$el.hasClass("upfront-module-spacer")||o.$el.hasClass("upfront-object-spacer"),d=this.app.layout.get("regions"),c=this.has_siblings,u=this.sibling_index;_.each(this.drop_areas,function(s,h){if(!_.contains(o.drop_areas_created,s)){var f=s.$el.hasClass("upfront-region"),g=!!f&&s.$el.get(0)==n.current_region.$el.get(0);if(!f||g){var m=s.$el.find(".upfront-editable_entities_container:first"),v=f?s.$el:s.$el.closest(".upfront-region"),b=v.data("name"),y=f?s:e.get_region(v),w=d.get_by_name(b),k=f?w:s.view?s.view.model:w.get("modules").get_by_element_id(s.$el.attr("id"));if(k){var $=k.get("modules")||k.get("objects"),x=k.get("wrappers"),U=e.parse_modules_to_lines($,x,i.id,s.col),E=v.hasClass("upfront-region-expand-lock"),S=s.grid.top,C=function(t,e){return!E||E&&e-t+1>=o.row},T=function(t){var i=Upfront.data.wrapper_views[t.model.cid];return!!i&&e.get_wrap(i.$el)};if(_.each(U,function(l,d){_.each(l.wrappers,function(h,f){var g=Upfront.data.wrapper_views[h.model.cid];if(g){var m=g.$el,v=e.get_wrap(m),b=h.spacer,w=0==f,k=r&&v._id==r._id,$=1==h.modules.length,x=k&&$,E=f>0?l.wrappers[f-1]:d>0&&_.last(U[d-1].wrappers),z=!!E&&Upfront.data.wrapper_views[E.model.cid],I=!!z&&z.$el,P=!!I&&e.get_wrap(I),M=1==f||0==f&&d>0&&1==U[d-1].wrappers.length,j=P&&r&&P._id==r._id,O=!!E&&E.spacer,D=j&&1==E.modules.length,A=f+1<l.wrappers.length?l.wrappers[f+1]:d+1<U.length&&U[d+1].wrappers[0],L=!!A&&Upfront.data.wrapper_views[A.model.cid],N=!!L&&L.$el,V=!!N&&e.get_wrap(N),B=f+1==l.wrappers.length,R=V&&r&&V._id==r._id,F=!!A&&A.spacer,H=(R&&1==A.modules.length,d+1<U.length&&U[d+1].wrappers[0]),W=!!H&&Upfront.data.wrapper_views[H.model.cid],q=!!W&&W.$el,G=!!q&&e.get_wrap(q),Q=(e.get_wrap_el_min(v),e.get_wrap_el_min(v,!1,!0),!!P&&e.get_wrap_el_min(P),!!V&&e.get_wrap_el_min(V,!1,!0),!!V&&e.get_wrap_el_min(V)),J=!!G&&e.get_wrap_el_min(G,!1,!0),Y=_.map(l.wrappers,T),X=_.map(_.filter(l.wrappers,function(t){return!t.spacer}),T),K=_.sortBy(X,function(t){return e.get_wrap_el_max(t,!1,!0).grid.bottom}),Z=_.sortBy(X,function(t){return e.get_wrap_el_min(t,!1,!0).grid.top}),tt=_.last(K),et=_.first(Z),it=e.get_wrap_el_min(et,!1,!0),nt=e.get_wrap_el_max(tt,!1,!0),ot=_.find(Y,function(t){return r&&r._id==t._id});if(ot&&n.current_row_wraps===!1&&(n.current_row_wraps=Y),!p&&!b&&((!i||i.default)&&v.col>=a&&(V&&!B&&!x||P&&!w&&!x||V&&P&&!B&&!w||!P&&!V&&k&&c)||i&&!i.default&&k&&c)){var rt=v.grid.top,st=V&&!B&&Q?Q.grid.left-1:s.grid.right;$els=Upfront.Util.find_sorted(m,n.el_selector),$els.each(function(i){if(t(this).get(0)!=o.$el.get(0)){var r=t(this),s=e.get_el(r),a=s.outer_grid.top==v.grid.top?v.grid.top:rt,l=Math.ceil(s.grid_center.y),p=!!$els[i-1]&&$els.eq(i-1),d=!!p&&e.get_el(p),c=d&&d._id==o._id;n.drops.push({_id:e._new_id(),top:a,bottom:l,left:v.grid.left,right:st,priority:{top:c?d.outer_grid.top:s.outer_grid.top-1,bottom:s.grid.top-1,left:v.grid.left,right:st,index:c?3:5},priority_index:5,type:"inside",insert:["before",r],region:y,is_me:c,is_clear:!1,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1}),rt=l+1}});var at=$els.last(),lt=at.size()>0&&e.get_el(at),pt=lt&&lt._id==o._id,dt=i&&!i.default&&J?Math.ceil(J.grid_center.y):tt.grid.bottom;n.drops.push({_id:e._new_id(),top:rt,bottom:dt,left:v.grid.left,right:st,priority:{top:pt?lt.outer_grid.top:v.grid.bottom,bottom:i&&!i.default&&J?J.grid.top:dt,left:v.grid.left,right:st,index:pt?3:5},priority_index:5,type:"inside",insert:["append",v.$el],region:y,is_me:pt,is_clear:!1,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1})}if(!(i&&!i.default&&c&&u>0)){if(!p&&w&&(!k||V&&!B)){var ct=v.grid.top==s.grid.top?s.grid.top-5:S,ut=e.get_wrap_el_min(v,!1,!0),ht=Math.ceil(ut.grid_center.y),ft=M&&j&&!c,_t=ft?P.grid.top:v.grid.top,gt=_.last(K,2);C(_t,ut.grid.top-1)&&(i&&!i.default&&(k||M&&j)&&c?S=ht+1:(n.drops.push({_id:e._new_id(),top:ct,bottom:ht,left:s.grid.left,right:s.grid.right,priority:{top:_t,bottom:it.grid.top-1,left:s.grid.left,right:s.grid.right,index:ft?2:3},priority_index:8,type:"full",insert:["before",v.$el],region:y,is_me:ft,is_clear:!0,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1}),2===gt.length?_.each(gt,function(t,i){var n=_.sortBy(e.get_wrap_els(t),function(t){return t.grid.bottom}),o=_.last(n,2),r=_.last(o),s=r.grid.bottom;0===i?S=s:((2===o.length&&S<o[0].grid.bottom||r.grid_center.y>S)&&(S=r.grid_center.y),S+=Math.ceil((s-S)/2))}):S=Math.ceil(nt.grid_center.y+Math.ceil((nt.grid.bottom-nt.grid_center.y)/2))+1))}if((!p||p&&ot&&(x||!b&&(!V||B||!F)))&&(!V||B)&&(!x||!w)&&(!i||i.default||!i.default&&(!c||!k))){var mt=!1,vt=Math.ceil(v.grid_center.x)+1,bt=!V||B?s.grid.right:v.grid.right,ht=k&&v.grid.bottom>tt.grid.bottom?v.grid.bottom:tt.grid.bottom;C(v.grid.top,ht)&&n.drops.push({_id:e._new_id(),top:v.grid.top,bottom:ht,left:x?v.grid.left:vt,right:bt,priority:{top:v.grid.top,bottom:ht,left:x?v.grid.left:vt+Math.ceil((bt-vt)/2),right:bt,index:x?1:4},priority_index:10,type:"side-after",insert:["after",v.$el],region:y,is_me:x,is_clear:!1,is_use:!1,is_switch:mt,switch_dir:!!mt&&"left",row_wraps:Y,me_in_row:!!ot})}if((!p||p&&ot&&(x||!b&&(w||!O)))&&(!x||V&&!B)&&(w||!D)&&(!i||i.default||!i.default&&(!c||!k&&!j))){var yt=!1,wt=!1,vt=P&&!w?Math.ceil(P.grid_center.x)+1:v.grid.left,bt=Math.ceil(v.grid_center.x),ht=k&&v.grid.bottom>tt.grid.bottom?v.grid.bottom:tt.grid.bottom;C(v.grid.top,ht)&&n.drops.push({_id:e._new_id(),top:v.grid.top,bottom:ht,left:vt,right:x&&Q?Q.grid.left-1:bt,priority:{top:v.grid.top,bottom:ht,left:P&&!w?vt+Math.ceil((P.grid.right-vt)/2):vt,right:x&&Q?Q.grid.left-1:v.grid.left+Math.ceil((bt-v.grid.left)/2)-1,index:x?1:4},priority_index:10,type:"side-before",insert:[yt?"after":"before",v.$el],region:y,is_me:x,is_clear:w,is_use:!1,is_switch:yt||wt,switch_dir:yt?"left":!!wt&&"right",row_wraps:Y,me_in_row:!!ot})}}}})}),!(i&&!i.default&&c&&u>0||p))if(U.length>0){var z=U[U.length-1],I=_.last(z.wrappers),P=Upfront.data.wrapper_views[I.model.cid],M=e.get_wrap(P.$el),j=M&&1==z.wrappers.length,O=r&&j&&M._id==r._id&&!c,D=E?s.grid.bottom:s.grid.bottom-S>l?s.grid.bottom+5:S+l,A=_.map(z.wrappers,T),L=_.max(A,function(t){return r&&r._id==t._id?0:t.grid.bottom}),N=L.grid.bottom+1,V=!r||L&&r&&L._id!=r._id,B=V&&N>S?N:S;(C(B,D)||O)&&n.drops.push({_id:e._new_id(),top:S,bottom:D,left:s.grid.left,right:s.grid.right,priority:{top:B,bottom:D,left:s.grid.left,right:s.grid.right,index:O?2:3},priority_index:8,type:"full",insert:["append",m],region:y,is_me:O,is_clear:!0,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1})}else{var D=E?s.grid.bottom:s.grid.bottom-s.grid.top>l?s.grid.bottom:s.grid.top+l;C(s.grid.top,D)&&n.drops.push({_id:e._new_id(),top:s.grid.top,bottom:D,left:s.grid.left,right:s.grid.right,priority:null,priority_index:8,type:"full",insert:["append",m],region:y,is_me:"shadow"==b&&o.region==b,is_clear:!0,is_use:!1,is_switch:!1,switch_dir:!1,row_wraps:!1,me_in_row:!1})}}}}}),e.time_end("fn create_drop_point")},select_drop_point:function(e){var i=this.ed;if(e&&!e.is_use){i.time_start("fn select_drop");var n="object"==typeof this.drop&&!e.is_me;_.each(this.drops,function(t){t.is_use=t._id==e._id}),this.drop=e,i.show_debug_element&&(t(".upfront-drop-view-current").removeClass("upfront-drop-view-current"),t("#drop-view-"+e._id).addClass("upfront-drop-view-current")),t(".upfront-drop").remove();var o=this,r=this.me,s=t('<div class="upfront-drop upfront-drop-use"></div>'),a=function(){Upfront.Events.trigger("entity:drag:drop_change",o.view,o.model)},l="inside"!=e.type||e.insert[1].hasClass("upfront-module-group")?e.insert[1]:e.insert[1].parent(),p=e.insert[1].data("breakpoint_order")||0;r.width,r.height;switch(e.insert[0]){case"before":s.insertBefore(l);break;case"after":s.insertAfter(l);break;case"append":e.insert[1].append(s),p=e.insert[1].children().length}if(s.css("order",p),"full"==e.type||"inside"==e.type)s.css("width",(e.right-e.left+1)*i.col_size),e.priority&&!e.is_me||(e.is_me?(s.css("margin-top",r.height*-1),s.css("height",r.height)):s.css("height",(e.bottom-e.top+1)*i.baseline));else if("side-before"==e.type||"side-after"==e.type){
var d=l.position();s.css("height",(e.bottom-e.top+1)*i.baseline),e.is_me&&(s.css("width",r.width),"side-before"==e.type?s.css("margin-right",r.width*-1):s.css("margin-left",r.width*-1)),s.css({position:"absolute",top:d.top,left:Upfront.Util.isRTL()?d.left+("side-after"==e.type?0:l.width()):d.left+("side-after"==e.type?l.width():0)})}else n&&a();this.setup_moving_siblings(),i.time_end("fn select_drop")}},setup_moving_siblings:function(){if(this.breakpoint&&!this.breakpoint.default&&this.has_siblings&&0===this.sibling_index)if(this.move_siblings)"inside"==this.drop.type&&(this.$wrap_move.remove(),this.$wrap.css({visibility:"",opacity:""}),this.move_siblings=!1);else if("inside"!=this.drop.type){var t=this.$helper.position();this.$wrap_move=this.$wrap.clone(),this.$wrap_move.css({position:"absolute",top:t.top,left:t.left,width:this.$wrap.width(),height:this.$wrap.height(),zIndex:100}),this.$wrap_move.addClass("upfront-wrapper-moving"),this.$wrap_move.appendTo(this.$main),this.$wrap.css({visibility:"hidden",opacity:0}),this.move_siblings=!0}},update_siblings_position:function(){if(this.move_siblings&&this.$wrap_move){var t=this.$helper.position();this.$wrap_move.css({top:t.top,left:t.left})}},prepare_drag:function(){var e=this.ed,i=this.breakpoint;this.$main.addClass("upfront-dragging"),this.view.$el.css("position",""),e.start(this.view,this.model),e.normalize(e.els,e.wraps),e.update_position_data(e.containment.$el),this.update_vars(),this.set_current_region(this.region);var n=this.$me,o=this.me,r=this.$helper,s=n.offset(),a=e.max_row*e.baseline,l=n.data("ui-draggable"),p=this.event.pageY-s.top,d=this.is_parent_group?e.get_position(this.view.group_view.$el):this.is_object?e.get_position(this.view.object_group_view.$el):e.get_region(this.$region),c=Upfront.Util.find_sorted(o.$el.closest(".upfront-wrapper"),this.el_selector);if(this.has_siblings=c.length>1,this.sibling_index=c.index(o.$el),p>a/2&&l._adjustOffsetFromHelper({top:Math.round((o.height>a?a:o.height)/2)}),n.css("visibility","hidden"),r.css("max-width",o.width),r.css("height",o.height),r.css("max-height",a),r.css("margin-left",n.css("margin-left")),this.area_col=d.col,this.is_parent_group||this.is_object)d.region=this.$region.data("name"),d.group=this.is_parent_group?this.view.group_view.$el.attr("id"):"",d.view=this.is_parent_group?this.view.group_view:this.view.object_group_view,this.drop_areas=[d],this.current_area_col=d.col;else if(i&&!i.default)this.drop_areas=[d];else{var u,h=!1;e.lightbox_cols=!1,_.each(e.regions,function(t){t.$el.hasClass("upfront-region-side-lightbox")&&"block"==t.$el.css("display")&&(h=t,e.lightbox_cols=t.col),t.$el.hasClass("upfront-region-shadow")&&(u=t)}),h?this.drop_areas=[h,u]:this.drop_areas=e.regions}this.current_row_wraps=!1,this.create_drop_point(),this.$wrap.css("min-height","1px"),t(".upfront-drop-me").css("height",(o.outer_grid.bottom-o.outer_grid.top)*e.baseline),this.show_debug_data(),this.select_drop_point(_.find(this.drops,function(t){return t.is_me})),this.$region.addClass("upfront-region-drag-active")},update_drop_timeout:function(){var t=this.breakpoint;this.update_compare_area(),this.update_focus_state(),t&&!t.default||this.is_parent_group||this.is_object?this.set_current_region():this.update_current_region(),this.update_current_drop_point()},update_compare_area:function(){var t=this.ed,e=this.$helper,i=Math.ceil(e.outerHeight()/t.baseline)*t.baseline,n=e.outerWidth(),o=e.offset(),r=Upfront.Util.isRTL()?o.left+n:o.left,s=o.top,a=s+i,l=Upfront.Util.isRTL()?r-n:r+n,p=(Upfront.Util.isRTL()?r-n/2:r+n/2,t.get_grid(r,s)),d=p.x,c=p.y,u=t.get_grid(l,a),h=u.x-1,f=u.y-1,_=t.get_grid(this.event.pageX,this.event.pageY),g=(this.me.col,this.focus?t.focus_compare_col:t.compare_col),m=this.focus?t.focus_compare_row:t.compare_row,v=_.y-m/2,v=v<c?c:v,b=_.x-g/2,b=b<d?d:b,y=b+g-1,y=y>h?h:y,w=v+m-1,w=w>f?f:w,w=w>v+t.max_row?v+t.max_row:w,k=[_.x,_.y,v,y,w,b];this.current_grid=_,this.current_grid_pos={top:c,left:d,right:h,bottom:f},this.compare_area={top:v,left:b,right:y,bottom:w},this.compare_area_position=k},update_focus_state:function(){var t=this,e=this.ed,i=this._last_coord?Math.sqrt(Math.pow(this.event.pageX-this._last_coord.x,2)+Math.pow(this.event.pageY-this._last_coord.y,2)):0,n=Date.now();if(this._last_drag_position&&i<=e.update_distance)return void(this._focus_t||(this._focus_t=setTimeout(function(){t.focus=!0,t.focus_coord.x=t.event.pageX,t.focus_coord.y=t.event.pageY,t._last_drag_time=Date.now(),t.update_drop_timeout()},e.focus_timeout)));if(clearTimeout(this._focus_t),this._focus_t=!1,this._last_drag_position=this.compare_area_position,this._last_coord.x=this.event.pageX,this._last_coord.y=this.event.pageY,this._last_drag_time=n,this.focus){var o=Math.sqrt(Math.pow(this.event.pageX-this.focus_coord.x,2)+Math.pow(this.event.pageY-this.focus_coord.y,2));o>e.focus_out_distance&&(this.focus=!1)}},update_current_drop_point:function(){var t=this,e=_.map(this.drops,function(e){if(e.region._id!=t.current_region._id)return!1;var i=t.get_area_compared(e);return{area:i,drop:e}}).filter(function(t){return t!==!1}),i=_.max(e,function(t){return t.area});if(i.area>0)var n=_.filter(e,function(t){return t.area==i.area}),o=_.sortBy(n,function(e,i,n){var o=e.drop.priority?t.get_area_compared(e.drop.priority):0;return 1*o>=e.area?e.drop.priority.index:e.drop.priority_index}),r=_.first(o).drop;else{var r=_.find(this.drops,function(t){return t.is_me});this.region._id!=this.current_region._id&&this.set_current_region()}this.select_drop_point(r),this.update_drop_position()},update_drop_position:function(){if(this.drop){var e=this.ed,i=this.drop,n=this.breakpoint,o=(this.current_region?this.current_region.col:this.me.col,this.$me.hasClass("upfront-module-spacer")||this.$me.hasClass("upfront-object-spacer")),r=1==this.$wrap.find(this.el_selector).length;i.priority?i.priority.top-i.top:0,i.priority?i.priority.left-i.left:0,i.region.$el.hasClass("upfront-region-expand-lock"),i.priority?i.priority.bottom-i.priority.top+1:i.bottom-i.top+1;if(this.drop_top=0,this.drop_left=0,n&&!n.default&&(r="inside"!=i.type),i.is_me||i.me_in_row&&r||o)this.drop_col=this.me.col;else if("side-before"==i.type||"side-after"==i.type){var s=this.find_column_distribution(i.row_wraps,i.me_in_row&&r,!0,this.current_area_col,!1);this.drop_col=s.apply_col}else this.drop_col=i.priority?i.priority.right-i.priority.left+1:i.right-i.left+1;adjust_bottom=!0,e.show_debug_element&&t("#upfront-compare-area").css({top:(this.compare_area.top-1)*e.baseline,left:(this.compare_area.left-1)*e.col_size+(e.grid_layout.left-e.grid_layout.layout_left),width:(this.compare_area.right-this.compare_area.left+1)*e.col_size,height:(this.compare_area.bottom-this.compare_area.top+1)*e.baseline}).text("("+this.compare_area.left+","+this.compare_area.right+") ("+this.compare_area.top+","+this.compare_area.bottom+")")}},update_current_region:function(){var e=this,i=this.ed,n=t(".upfront-region-container-wide, .upfront-region-container-clip").not(".upfront-region-container-shadow").last(),o=_.map(i.regions,function(t){var o,r=t.$el.closest(".upfront-region-container").get(0)==n.get(0),s=r&&(!t.$el.hasClass("upfront-region-side")||t.$el.hasClass("upfront-region-side-left")||t.$el.hasClass("upfront-region-side-right"))?999999:t.grid.bottom,a=t.$el.hasClass("upfront-region-drag-active"),l=t.$el.hasClass("upfront-region-side-top")||t.$el.hasClass("upfront-region-side-bottom"),o=e.get_area_compared({top:t.grid.top-5,bottom:s+5,left:t.grid.left,right:t.grid.right}),p=t.$el.data("type"),d=i.region_type_priority[p];return o*=d,l&&(o*=2),a&&(o*=1.5),{area:o,region:t}}),r=_.max(o,function(t){return t.area});r.area>0&&r.region.$el.get(0)!=this.current_region.$el.get(0)&&(this.set_current_region(r.region),i.update_position_data(this.$current_container,!1),this.create_drop_point()),i.show_debug_element&&_.each(o,function(t){t.region.$el.find(">.upfront-debug-info").text(t.area)})},set_current_region:function(e){var i=this.app.layout.get("regions");this.current_region=e&&e.$el?e:this.ed.get_region(this.$region),this.current_region.$el.hasClass("upfront-region-drag-active")||(t(".upfront-region-drag-active").removeClass("upfront-region-drag-active"),this.current_region.$el.addClass("upfront-region-drag-active")),this.current_region_model=i.get_by_name(this.current_region.region);var n=!!this.current_region_model&&this.current_region_model.get("wrappers");this.current_wrappers=this.is_parent_group?this.view.group_view.model.get("wrappers"):this.is_object?this.view.object_group_view.model.get("wrappers"):n,this.$current_container=this.is_parent_group?this.view.group_view.$el.find(".upfront-editable_entities_container:first"):this.is_object?this.view.object_group_view.$el.find(".upfront-editable_entities_container:first"):this.current_region.$el.find(".upfront-modules_container > .upfront-editable_entities_container:first"),this.move_region=this.region._id!=this.current_region._id,this.is_parent_group||this.is_object||(this.current_area_col=this.current_region.col)},get_area_compared:function(t){var e,i,n,o,r,s=this.compare_area;return s.left>=t.left&&s.left<=t.right?n=s.left:s.left<t.left?n=t.left:s.left>t.right&&s.left-t.right<=1&&(n=t.right),s.right>=t.left&&s.right<=t.right?o=s.right:s.right>t.right?o=t.right:s.right<t.left&&t.left-s.right<=1&&(o=t.left),s.top>=t.top&&s.top<=t.bottom?e=s.top:s.top<t.top&&(e=t.top),s.bottom>=t.top&&s.bottom<=t.bottom?i=s.bottom:s.bottom>t.bottom&&(i=t.bottom),r=e&&i&&n&&o?(o-n+1)*(i-e+1):0,r?r:0},render_drop:function(){var e=this.ed,i=this.breakpoint,n=t(".upfront-drop-use");if(this.wrap_only=!1,Upfront.Events.trigger("entity:drop:before_render",this,this.region.$el.closest(".upfront-region-container")),!i||i.default){if("inside"!=this.drop.type){var o=Upfront.Util.get_unique_id("wrapper"),r=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:o},{name:"class",value:e.grid.class+this.drop_col}]}),s=new Upfront.Views.Wrapper({model:r});if(("full"==this.drop.type||this.drop.is_clear)&&r.add_class("clr"),this.current_wrappers.add(r),s.parent_view=this.view.parent_view,this.view.wrapper_view=s,s.render(),s.$el.append(this.view.$el),"side-before"==this.drop.type&&this.drop.is_clear&&n.nextAll(".upfront-wrapper").eq(0).removeClass("clr"),n.before(s.$el),this.new_wrap_view=s,Upfront.data.wrapper_views[r.cid]=s,!this.move_region){var a=this.current_wrappers.get_by_wrapper_id(this.$wrap.attr("id"));a&&r.set_property("breakpoint",Upfront.Util.clone(a.get_property_value_by_name("breakpoint")),!0)}}else{var l=n.closest(".upfront-wrapper"),o=l.attr("id"),r=this.current_wrappers.get_by_wrapper_id(o),s=Upfront.data.wrapper_views[r.cid];n.before(this.view.$el),s&&(this.view.wrapper_view=s)}this.wrapper_id=o,this.model.set_property("wrapper_id",this.wrapper_id),0==this.$wrap.find(this.el_selector).length&&(this.wrap&&this.wrap.grid.left==this.current_region.grid.left&&this.$wrap.nextAll(".upfront-wrapper").eq(0).addClass("clr"),this.$wrap.remove(),this.wrap_only=!0)}else this.wrap_only="inside"!=this.drop.type},update_models:function(){var e=this,i=this.ed,n=this.breakpoint,o=this.current_wrappers,r=this.$me,s=this.$wrap,a=Upfront.data.region_views[this.current_region_model.cid],l=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();if(_.each(i.wraps,function(t){var e=!n||n.default?t.$el.hasClass("clr"):t.$el.data("breakpoint_clear");t.$el.data("clear",e?"clear":"none")}),!this.drop.is_me&&"side-before"==this.drop.type){var p=this.drop.insert[1];if(p.size()>0){var d=(i.get_wrap(p),!n||n.default?p.hasClass("clr"):p.data("breakpoint_clear"));d&&!this.drop.is_clear||p.data("clear","none")}}if(i.update_model_margin_classes(r,[i.grid.class+this.drop_col]),n&&!n.default&&"inside"!=this.drop.type&&this.$wrap.find(this.el_selector).not(r).each(function(){i.update_model_margin_classes(t(this),[i.grid.class+e.drop_col])}),this.move_region){var c=o.get_by_wrapper_id(s.attr("id"));c&&c.remove_property("breakpoint",!0),this.model.remove_property("breakpoint",!0)}if((!n||n.default)&&"inside"==this.drop.type){var c=o.get_by_wrapper_id(this.wrapper_id);if(c){var u=c.get_property_value_by_name("breakpoint")||{},h=this.model.get_property_value_by_name("breakpoint")||{};_.each(l,function(t){var i=t.toJSON();i.default||u&&u[i.id]&&u[i.id].edited&&(_.isObject(h[i.id])||(h[i.id]={edited:!1}),!h[i.id].edited&&_.isNumber(u[i.id].col)&&(h[i.id].col=u[i.id].col,h[i.id].edited=!0,e.model.set_property("breakpoint",Upfront.Util.clone(h))))})}}if(!(this.drop.is_me||this.drop.me_in_row&&this.wrap_only||"side-before"!=this.drop.type&&"side-after"!=this.drop.type)){var f=this.find_column_distribution(this.drop.row_wraps,!1,!0,this.current_area_col,!1),g=f.remaining_col-(this.drop_col-f.apply_col),m=0,v=!1,b=!1;_.each(this.drop.row_wraps,function(n){n.$el.find(e.el_selector).each(function(){if(t(this).hasClass("upfront-module-spacer")||t(this).hasClass("upfront-object-spacer")){var r=o.get_by_wrapper_id(n.$el.attr("id")),s=i.get_el_model(t(this));o.remove(r),e.model.collection.remove(s),0==m&&(v=!0,"side-after"!=e.drop.type&&"side-before"!=e.drop.type||e.drop.insert[1].get(0)!=n.$el.get(0)||(b=!0))}else{var a=f.apply_col;g>0&&(a+=1,g-=1),i.update_model_margin_classes(t(this),[i.grid.class+a]),1==m&&v&&("side-before"==e.drop.type&&e.drop.insert[1].get(0)==n.$el.get(0)?b=!0:b||n.$el.data("clear","clear"))}m++})}),b&&(e.new_wrap_view!==!1?e.new_wrap_view.$el.data("clear","clear"):e.$wrap.data("clear","clear"))}if(!this.drop.is_me&&!this.drop.me_in_row&&this.wrap_only&&this.current_row_wraps&&!_.isEqual(this.drop.row_wraps,this.current_row_wraps)){var f=this.find_column_distribution(this.current_row_wraps,!0,!1,this.area_col),g=f.remaining_col;f.total>0?_.each(this.current_row_wraps,function(n){e.wrap.$el.get(0)!=n.$el.get(0)&&n.$el.find(e.el_selector).each(function(){if(!t(this).hasClass("upfront-module-spacer")&&!t(this).hasClass("upfront-object-spacer")){var e=f.apply_col;g>0&&(e+=1,g-=1),i.update_model_margin_classes(t(this),[i.grid.class+e])}})}):f.spacer_total>0&&_.each(this.current_row_wraps,function(n){e.wrap.$el.get(0)!=n.$el.get(0)&&n.$el.find(e.el_selector).each(function(){if(t(this).hasClass("upfront-module-spacer")||t(this).hasClass("upfront-object-spacer")){var r=o.get_by_wrapper_id(n.$el.attr("id")),s=i.get_el_model(t(this));o.remove(r),e.model.collection.remove(s,{update:!1})}})})}if(this.is_parent_group?i.update_wrappers(this.view.group_view.model,this.view.group_view.$el):this.is_object?i.update_wrappers(this.view.object_group_view.model,this.view.object_group_view.$el):i.update_wrappers(this.current_region_model,this.current_region.$el),this.move_region&&(i.update_model_margin_classes(this.$container.find(".upfront-wrapper").find(this.el_selector)),i.update_wrappers(this.region_model,this.region.$el)),!n||n.default)if(this.move_region){var y=this.current_region_model.get("modules"),w=[];this.view.region_view._modules_view.preserve_wrappers_breakpoint_order(),this.model.collection.remove(this.model,{silent:!0}),this.model.get("shadow")&&(this.view.trigger("on_layout"),this.model.unset("shadow",{silent:!0})),this.view.region_view._modules_view.normalize_child_spacing(),a._modules_view.preserve_wrappers_breakpoint_order(),r.removeAttr("data-shadow"),this.$current_container.find(".upfront-wrapper").find(this.el_selector).each(function(){var i=t(this).attr("id"),n=y.get_by_element_id(i);n||i!=r.attr("id")?n&&w.push(n):w.push(e.model)}),y.reset(w)}else this.view.parent_view.preserve_wrappers_breakpoint_order(),this.view.resort_bound_collection(),this.view.parent_view.normalize_child_spacing();else{var k=[],$=0,x="inside"!=this.drop.type,U=x?Upfront.Util.find_sorted(this.$current_container,"> .upfront-wrapper"):Upfront.Util.find_sorted(r.closest(".upfront-wrapper"),this.el_selector),E=x?0:r.closest(".upfront-wrapper").find(this.el_selector).length,S=!1;!this.drop.is_me&&"append"==this.drop.insert[0]&&x&&(S=U.length-1),U.each(function(){var n=x?i.get_wrap(t(this)):i.get_el(t(this));n&&(S===$&&$++,e.drop.is_me||"append"!=e.drop.insert[0]||(x||S!==!1||t(this).closest(".upfront-wrapper").get(0)!=e.drop.insert[1].get(0)||(S=$+E-1),(x&&s.get(0)==this||!x&&r.get(0)==this)&&$--),e.drop.is_me||e.drop.insert[1].get(0)!=this?k.push({$el:t(this),order:$,clear:n.outer_grid.left==e.current_region.grid.left}):("before"==e.drop.insert[0]?(S=$,k.push({$el:t(this),order:$+1,clear:"side-before"!=e.drop.type})):"side-after"==e.drop.type&&"after"==e.drop.insert[0]&&(S=$+1,k.push({$el:t(this),order:$,clear:n.outer_grid.left==e.current_region.grid.left})),$++),$++)}),_.each(k,function(t){var a,l,p=t.$el.attr("id"),d=x?o.get_by_wrapper_id(p):i.get_el_model(t.$el);d&&((x&&t.$el.get(0)==s.get(0)||!x&&t.$el.get(0)==r.get(0))&&(t.order=S!==!1?S:t.order,t.clear=e.drop.is_clear),a=Upfront.Util.clone(d.get_property_value_by_name("breakpoint")||{}),_.isObject(a[n.id])||(a[n.id]={}),l=a[n.id],l.order=t.order,l.edited=!0,x&&(l.clear=t.clear),d.set_property("breakpoint",a))})}i.update_position_data(this.$current_container),i.normalize(i.els,i.wraps)},update_views:function(){var t=this.view,e=this.model;this.move_region&&(t.region=this.current_region_model,t.region_view=Upfront.data.region_views[t.region.cid],t.parent_view=t.region_view._modules_view,this.new_wrap_view.parent_view=t.parent_view,_.isUndefined(t._modules_view)||(t._modules_view.region_view=t.region_view,_.isUndefined(e.get("modules"))||e.get("modules").each(function(e){var i=Upfront.data.module_views[e.cid];i&&(i.region=t.region,i.region_view=t.region_view)})),t.trigger("region:updated"))},clean_elements:function(){t(".upfront-drop").remove(),t(".upfront-drop-view").remove(),t("#upfront-compare-area").remove(),this.$wrap_move&&this.$wrap_move.length>0&&this.$wrap_move.remove(),this.$me.css({position:"",top:"",left:"","z-index":"",visibility:"visible"}),this.$wrap.css({"min-height":"",visibility:"",opacity:""}),this.$current_container.find(".upfront-wrapper").find(this.el_selector).css("max-height",""),t(".upfront-region-drag-active").removeClass("upfront-region-drag-active"),this.$main.removeClass("upfront-dragging")},reset:function(){this.drop_areas_created=[],this.drops=[],this.drop=!1},find_column_distribution:function(t,e,i,n,o){var i=i!==!1,r=_.filter(t,function(t){return t.$el.find("> .upfront-module-view > .upfront-module-spacer, > .upfront-object-view > .upfront-object-spacer").length>0}),s=_.reduce(r,function(t,e){return t+e.col},0),a=(e?t.length-1:t.length)-r.length,o=o!==!1,l=o?n-s:n,p=0,d=0;return i&&a++,a>0?(p=Math.floor(l/a),d=l-p*a):(p=l,d=0),{apply_col:p,remaining_col:d,total_col:l,spacers_col:s,total:a,spacer_total:r.length}},show_debug_data:function(){if(this.ed.show_debug_element){var e=this.ed,i=this.$layout,n=this.$helper;_.each(e.els,function(t){t.$el.find(".upfront-debug-info").size()||t.$el.find(".upfront-editable_entity:first").append('<div class="upfront-debug-info"></div>'),t.$el.find(".upfront-debug-info").text("grid: ("+t.grid.left+","+t.grid.right+"),("+t.grid.top+","+t.grid.bottom+") | outer: ("+t.outer_grid.left+","+t.outer_grid.right+"),("+t.outer_grid.top+","+t.outer_grid.bottom+") | center: "+t.grid_center.x+","+t.grid_center.y)}),_.each(this.drops,function(n){var o=t('<div class="upfront-drop-view"><div class="upfront-drop-priority-view"></div><span class="upfront-drop-view-pos"></span></div>');o.addClass("upfront-drop-view-"+n.type),n.is_me&&o.addClass("upfront-drop-view-me"),o.attr("id","drop-view-"+n._id),o.css({top:(n.top-1)*e.baseline,left:(n.left-1)*e.col_size+(e.grid_layout.left-e.grid_layout.layout_left),width:(n.right-n.left+1)*e.col_size,height:(n.bottom-n.top+1)*e.baseline}),n.priority&&o.find(".upfront-drop-priority-view").css({top:(n.priority.top-n.top)*e.baseline,left:(n.priority.left-n.left)*e.col_size,width:(n.priority.right-n.priority.left+1)*e.col_size,height:(n.priority.bottom-n.priority.top+1)*e.baseline}),o.find(".upfront-drop-view-pos").text("("+n.left+","+n.right+")("+n.top+","+n.bottom+")("+n.type+")"+(n.priority?"("+n.priority.left+","+n.priority.right+")("+n.priority.top+","+n.priority.bottom+")":"")),i.append(o)}),i.append('<div id="upfront-compare-area"></div>'),n.find(".upfront-debug-info").size()||n.append('<div class="upfront-debug-info"></div>')}}},e})}(jQuery),function(t){var e=function(t,e){};e.prototype={view:!1,model:!1},define("scripts/upfront/behaviors/resize",e)}(jQuery),function(t){define("scripts/upfront/behaviors/grid-editor",["scripts/upfront/behaviors/dragdrop","scripts/upfront/behaviors/resize"],function(e,i){var n={lightbox_cols:!1,main:{$el:null,top:0,left:0,right:0},grid_layout:{top:0,left:0,right:0},containment:{$el:null,top:0,left:0,right:0,col:0,grid:{top:0,left:0,right:0}},min_col:1,max_row:0,compare_col:2,compare_row:10,focus_compare_col:1,focus_compare_row:3,update_distance:10,timeout:0,focus_timeout:500,focus:!1,focus_out_distance:50,focus_coord:{x:0,y:0},_t:null,_t_focus:null,col_size:0,baseline:0,grid:null,region_type_priority:{wide:1,clip:1,full:1,fixed:2,lightbox:2},els:[],wraps:[],regions:[],drops:[],drop:null,el_selector:"",el_selector_direct:"",module_selector:".upfront-module-view > .upfront-module, .upfront-module-group",module_selector_direct:"> .upfront-module-view > .upfront-module, > .upfront-module-group",object_selector:".upfront-object-view > .upfront-object",object_selector_direct:"> .upfront-object-view > .upfront-object",_id:0,drag_instances:{},resize_instances:{},wrapper_resize_instances:{},show_debug_element:!1,resizing:!1,_new_id:function(){var t=Upfront.Behaviors.GridEditor;return t._id++,t._id},get_grid:function(t,e){var i=Upfront.Behaviors.GridEditor,n=Upfront.Util.isRTL()?Math.round((i.grid_layout.right-t)/i.col_size)+1:Math.round((t-i.grid_layout.left)/i.col_size)+1,o=Math.ceil((e-i.grid_layout.top)/i.baseline)+1;return{x:n,y:o}},get_position:function(e){var i=Upfront.Behaviors.GridEditor,n=t(e),o=parseFloat(n.css("width")),r=parseFloat(n.css("height")),s=n.offset(),a=s.top,l=a+r,p=Upfront.Util.isRTL()?s.left+o:s.left,d=Upfront.Util.isRTL()?p-o:p+o,c=i.get_grid(p,a),u=n.data("current_col")?n.data("current_col"):Math.round(o/i.col_size),h=Math.floor(r/i.baseline),f={top:Math.round(a),left:Math.round(p),bottom:Math.round(l),right:Math.round(d)},_={top:c.y,left:c.x,right:c.x+u-1,bottom:c.y+h-1};return{$el:n,_id:i._new_id(),position:f,outer_position:f,width:o,height:r,center:{y:Math.round(a+r/2),x:Upfront.Util.isRTL()?Math.round(p-o/2):Math.round(p+o/2)},col:u,row:h,grid:_,outer_grid:_,grid_center:{y:c.y+h/2-1,x:c.x+u/2-1}}},get_region_position:function(e){var i=Upfront.Behaviors.GridEditor,n=t(e),o=n.find(".upfront-modules_container"),r=i.get_position(o);return r.$el=n,r},init_margin:function(t){var e=Upfront.Behaviors.GridEditor,i=Math.round(parseFloat(t.$el.css("margin-left"))/e.col_size),n=Math.round(parseFloat(t.$el.css("margin-top"))/e.baseline);t.$el.data("margin",{original:{left:i,top:n},current:{left:i,top:n}})},get_affected_els:function(t,e,i,n){var o={top:[],left:[],bottom:[],right:[]},r=t.outer_grid;if(Array.isArray(i)?i.push(t):i=[t],n=!!n,_.each(_.reject(e,function(t){var e=_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)});return!!e}),function(e){t.region==e.region&&t.group==e.group&&((e.outer_grid.top>=r.top&&e.outer_grid.top<r.bottom||e.outer_grid.bottom>=r.top&&e.outer_grid.bottom<=r.bottom||r.top>=e.outer_grid.top&&r.top<e.outer_grid.bottom||r.bottom>=e.outer_grid.top&&r.bottom<=e.outer_grid.bottom)&&(r.left>e.outer_grid.right&&o.left.push(e),r.right<e.outer_grid.left&&o.right.push(e)),r.top>e.outer_grid.bottom&&o.top.push(e),r.bottom<e.outer_grid.top&&o.bottom.push(e))}),n){var s=_.max(o.left,function(t){return t.outer_grid.right});o.left=_.filter(o.left,function(t){return t.outer_grid.right==s.outer_grid.right});var a=_.min(o.right,function(t){return t.outer_grid.left});o.right=_.filter(o.right,function(t){return t.outer_grid.left==a.outer_grid.left});var l=_.max(o.top,function(t){return t.outer_grid.top});o.top=_.filter(o.top,function(t){return t.outer_grid.top==l.outer_grid.top});var p=_.min(o.bottom,function(t){return t.outer_grid.top});o.bottom=_.filter(o.bottom,function(t){return t.outer_grid.top==p.outer_grid.top})}return o},get_affected_wrapper_els:function(t,e,i,n){var o=Upfront.Behaviors.GridEditor,r=o.get_affected_els(t,e,i,n),s={top:_.flatten(_.map(r.top,function(t){var e=_.reject(o.get_wrap_els(t),function(t){return!!i&&_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)})}),n=o.get_wrap_el_max(t,i,!0);return _.filter(e,function(t){return t.outer_grid.bottom==n.outer_grid.bottom})})),bottom:_.flatten(_.map(r.bottom,function(t){var e=_.reject(o.get_wrap_els(t),function(t){return!!i&&_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)})}),n=o.get_wrap_el_min(t,i,!0);return _.filter(e,function(t){return t.outer_grid.top==n.outer_grid.top})})),left:_.flatten(_.map(r.left,function(t){var e=_.reject(o.get_wrap_els(t),function(t){return!!i&&_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)})}),n=o.get_wrap_el_max(t,i,!1);return _.filter(e,function(t){return t.outer_grid.right==n.outer_grid.right})})),right:_.flatten(_.map(r.right,function(t){var e=_.reject(o.get_wrap_els(t),function(t){return!!i&&_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)})}),n=o.get_wrap_el_min(t,i,!1);return _.filter(e,function(t){return t.outer_grid.left==n.outer_grid.left})}))};return s},get_move_limit:function(t,e){var i=[e.grid.left,e.grid.right];return _.each(t.left,function(t){t.grid.right>i[0]&&(i[0]=t.grid.right+1)}),_.each(t.right,function(t){t.grid.left<i[1]&&(i[1]=t.grid.left-1)}),i},get_resize_limit:function(t,e){var i=[e.grid.left,e.grid.right];return _.each(t.left,function(t){t.grid.left>i[0]&&(i[0]=t.grid.left)}),_.each(t.right,function(t){t.grid.right<i[1]&&(i[1]=t.grid.right)}),i},get_max_size:function(t,e,i,n){var o=Upfront.Behaviors.GridEditor,r=o.get_class_num(t.$el,o.grid.class),n=/all|nw|se/.test(n)?n:"all",s=t.$el.data("margin"),a=o.get_affected_els(t,e,[],!0),l=o.get_move_limit(a,o.containment),p="nw"==n?r+t.grid.left-l[0]:"se"==n?r+l[1]-t.grid.right:l[1]-l[0]+1,d=i.$el.hasClass("upfront-region-expand-lock"),c=!!a.bottom.length&&_.min(a.bottom,function(t){return t.grid.top}),u=c?c.grid.top-t.grid.top:i.grid.bottom-t.grid.top,h="nw"==n?s.original.top+t.row:"se"==n?u:u+s.original.top;return{col:p,row:!(!d&&"nw"!=n)&&h}},get_wrap_els:function(e){var i=Upfront.Behaviors.GridEditor,n=e.$el.find(i.el_selector_direct);return _.map(n,function(e){var e=i.get_el(t(e));return _.find(i.els,function(t){return t._id==e._id})})},get_wrap_el_min:function(t,e,i){var n=Upfront.Behaviors.GridEditor,o=n.get_wrap_els(t),r=_.min(_.reject(o,function(t){return!!e&&_.find(e,function(e){return e.$el.get(0)==t.$el.get(0)})}),function(t){return i?t.grid.top:t.grid.left});return!!_.isObject(r)&&r},get_wrap_el_max:function(t,e,i){var n=Upfront.Behaviors.GridEditor,o=n.get_wrap_els(t),r=_.max(_.reject(o,function(t){return!!e&&_.find(e,function(e){return e.$el.get(0)==t.$el.get(0)})}),function(t){return i?t.grid.bottom:t.grid.right});return!!_.isObject(r)&&r},get_el:function(t){var e=Upfront.Behaviors.GridEditor;return _.find(e.els,function(e){return t.get(0)==e.$el.get(0)})},get_wrap:function(t){var e=Upfront.Behaviors.GridEditor;return _.find(e.wraps,function(e){return t.get(0)==e.$el.get(0)})},get_region:function(t){var e=Upfront.Behaviors.GridEditor;return _.find(e.regions,function(e){return t.get(0)==e.$el.get(0)})},get_drop:function(t){var e=Upfront.Behaviors.GridEditor;return _.find(e.drops,function(e){return t.get(0)==e.$el.get(0)})},get_class_num:function(t,e){var i=_.isString(t)?t:t.attr("class"),n=new RegExp("\\b"+e+"(\\d+)"),o=i.match(n);return o&&o[1]?parseInt(o[1],10):0},get_el_model:function(t){var e,i=Upfront.Application,n=(Upfront.Behaviors.GridEditor,i.layout.get("regions")),o=t.attr("id"),r=function(t){if(!t)return!1;if(!t.get_by_element_id&&"function"!=typeof t.get_by_element_id)return!1;var e,i=t.get_by_element_id(o);return i?i:(t.find(function(t){return t.get("modules")?(e=r(t.get("modules")),!!e):t.get("objects")?(e=s(t.get("objects")),!!e):void 0}),e)},s=function(t){if(!t)return!1;if(!t.get_by_element_id&&"function"!=typeof t.get_by_element_id)return!1;var e,i=t.get_by_element_id(o);return i?i:(t.find(function(t){if(t.get("objects"))return e=s(t.get("objects")),!!e}),e)};return n.find(function(t){return e=r(t.get("modules")),!!e}),!!e&&e},update_class:function(t,e,i){var n,o,r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,s=new RegExp("\\b"+e+"\\d+");!r||r.default?t.hasClass(e+i)||(t.attr("class").match(s)?t.attr("class",t.attr("class").replace(s,e+i)):t.addClass(e+i)):(n=t.parent(),o=Math.round(n.width()/this.col_size),"c"==e?t.css("width",i/o*100+"%"):"ml"==e?t.css("margin-left",i/o*100+"%"):"mt"==e&&t.css("margin-top",i*this.baseline+"px"))},update_margin_classes:function(t){this.time_start("fn update_margin_classes");var e=t.data("margin"),i=Upfront.Behaviors.GridEditor;e.current!=e.original&&(i.update_class(t,i.grid.left_margin_class,e.current.left),i.update_class(t,i.grid.top_margin_class,e.current.top)),this.time_end("fn update_margin_classes")},update_model_classes:function(t,e){this.time_start("fn update_model_classes");var i=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=this.get_el_model(t);!n||i&&!i.default||n.replace_class(e.join(" ")),this.time_end("fn update_model_classes")},update_model_breakpoint:function(t,e){var i,n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=this.get_el_model(t);o&&n&&!n.default&&(i=Upfront.Util.clone(o.get_property_value_by_name("breakpoint")||{}),_.isObject(i[n.id])||(i[n.id]={}),i[n.id]=_.extend(i[n.id],e),i[n.id].edited=!0,o.set_property("breakpoint",i))},update_model_margin_classes:function(e,i){var n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=Upfront.Behaviors.GridEditor;e.each(function(){var e,r,s,a,l=t(this),p=l.data("margin");(p&&(p.original.left!=p.current.left||p.original.top!=p.current.top)||i)&&(s=p?p.current.top:0,a=p?p.current.left:0,!n||n.default?(e=[o.grid.left_margin_class+a,o.grid.top_margin_class+s],i&&(e=_.union(e,i)),o.update_model_classes(l,e)):(r={left:a,top:s},i&&_.each(i,function(t){var e=t.match(/^([A-Za-z])(\d+)$/);e&&e[1]==o.grid.class&&(r.col=parseInt(e[2]))}),o.update_model_breakpoint(l,r)))})},adjust_els_right:function(t,e,i){this.time_start("fn adjust_els_right");var n=Upfront.Behaviors.GridEditor;_.each(t,function(t){var o=t.$el.data("margin"),r=t.grid.left>e?t.grid.left-e-1:o.current.left;o.current.left!=r&&(o.current.left=r,i&&n.update_margin_classes(t.$el),t.$el.data("margin",o))}),this.time_end("fn adjust_els_right")},adjust_affected_right:function(t,e,i,n,o){this.time_start("fn adjust_affected_right");var r=Upfront.Behaviors.GridEditor,s=r.get_wrap_el_max(t,i),a=s?n&&n>s.grid.right?n:s.grid.right:n?n:t.grid.left-1;e=_.reject(e,function(t){return!!i&&_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)})}),r.adjust_els_right(e,a,o),n+1==r.containment.grid.left&&0==r.get_wrap_els(t).length&&t.$el.nextAll(".upfront-wrapper:eq(0)").data("clear","clear"),this.time_end("fn adjust_affected_right")},adjust_els_bottom:function(t,e,i){this.time_start("fn adjust_els_bottom");var n=Upfront.Behaviors.GridEditor;_.each(t,function(t){var o=t.$el.data("margin"),r=t.grid.top>e?t.grid.top-e-1:0;o.current.top!=r&&(o.current.top=r,i&&n.update_margin_classes(t.$el),t.$el.data("margin",o))}),this.time_end("fn adjust_els_bottom")},adjust_affected_bottom:function(t,e,i,n,o){this.time_start("fn adjust_affected_bottom");var r=Upfront.Behaviors.GridEditor,s=r.get_wrap_el_max(t,i,!0),a=s?n&&n>s.grid.bottom?n:s.grid.bottom:n?n:t.grid.bottom-1;e=_.reject(e,function(t){return!!i&&_.find(i,function(e){return e.$el.get(0)==t.$el.get(0)})}),r.adjust_els_bottom(e,a,o),this.time_end("fn adjust_affected_bottom")},normalize:function(e,i){this.time_start("fn normalize");var n=Upfront.Application,o=Upfront.Behaviors.GridEditor,r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,s=n.layout.get("regions"),a=[],l=[],p=[],d=[],c=r&&!r.default;
i=_.filter(i,function(t){return t.$el.is(":visible")||t.height>0}),_.each(i,function(e){var n=e.$el.find(o.module_selector_direct+", "+o.object_selector_direct),u=o.get_region(e.$el.closest(".upfront-region")),h=0==e.$el.closest(".upfront-objects_container").length&&e.$el.closest(".upfront-module-group"),f=h!==!1&&h.length>0,g=!!f&&o.get_el(h),m=!f&&e.$el.closest(".upfront-object-group"),v=m!==!1&&m.length>0,b=!!v&&o.get_el(m),y=c?e.$el.data("breakpoint_order"):e.$el.index(".upfront-wrapper"),w=!1,k=!1,$=!1,x=!1;n.each(function(e){if(!(this.offsetWidth<=0)){var i=o.get_el(t(this)),n=!r||r.default?o.get_class_num(i.$el,o.grid.class):i.$el.data("breakpoint_col");i.col<n&&i.col>0&&o.update_model_margin_classes(i.$el,[o.grid.class+i.col])}}),n.each(function(n){var r=o.get_el(t(this)),g=o.get_affected_els(r,i,[],!1);r.$el.data("margin");if(0==n&&(g.left.length>0||g.right.length>0)){var b=_.max(_.union(g.left,g.right),function(t){return t.outer_grid.bottom});if(b.outer_grid.bottom<r.grid.top){var U=o.get_el_model(r.$el),E=U.collection,S=E.indexOf(U),C=_.max(_.union(g.left,g.right),function(t){return t.outer_grid.left}),T=c?C.$el.data("breakpoint_order"):C.$el.index(".upfront-wrapper"),z=_.last(o.get_wrap_els(C)),I=o.get_el_model(z.$el),P=E.indexOf(I),M=r.grid.top-b.outer_grid.bottom;if(k=r.grid.top-M+1,$=u.grid.left,w=!0,r.outer_grid.top=k,!c&&P>S||c&&T>y)if(c){var j=f?o.get_el_model(h).get("wrappers"):s.get_by_name(r.region).get("wrappers"),O=e.$el.parent().find("> .upfront-wrapper").each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb),D=!1;O.each(function(i){var n=j.get_by_wrapper_id(t(this).attr("id"));this==e.$el.get(0)?(D=!0,n.set_breakpoint_property("order",T)):(n.set_breakpoint_property("order",i-1),this==C.$el.get(0)&&(D=!1))})}else x=P,e.$el.insertAfter(C.$el),d.push({collection:E,model:U,index:x});f?l.push(h):v?p.push(m):a.push(r.region)}}else if(w&&!c&&x!==!1){var U=o.get_el_model(r.$el),E=U.collection;d.push({collection:E,model:U,index:x})}}),w&&(e.outer_grid.top=k,e.grid.top=k,e.outer_grid.left=$,e.$el.data("clear","clear")),c||n.size()>1&&n.each(function(){var n=o.get_el(t(this)),r=o.get_affected_els(e,i,[],!1);if(0==r.left.length&&0==r.right.length){var s=o.get_el_model(n.$el),d=v?Upfront.data.object_views[s.cid]:Upfront.data.module_views[s.cid],c=f&&d.group_view?d.group_view:v&&d.object_group_view?d.object_group_view:d.region_view,_=f&&g?g:v&&b?b:u,y=c.model.get("wrappers"),w=Upfront.Util.get_unique_id("wrapper"),k=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:w},{name:"class",value:o.grid.class+(n.grid.left+n.col-_.grid.left)}]}),$=new Upfront.Views.Wrapper({model:k});y.add(k),k.add_class("clr"),$.parent_view=d.parent_view,d.wrapper_view=$,$.render(),n.$el.closest(".upfront-wrapper").before($.$el),$.$el.append(d.$el),s.set_property("wrapper_id",w),Upfront.data.wrapper_views[k.cid]=$,o.init_margin(n),f?l.push(h):v?p.push(m):a.push(n.region)}})}),_.each(i,function(t){var e=o.get_region(t.$el.closest(".upfront-region"));e&&(c||t.outer_grid.left!=e.grid.left||t.$el.hasClass("clr")||t.$el.addClass("clr"))}),_.each(_.uniq(a),function(t){var e=s.get_by_name(t),i=Upfront.data.region_views[e.cid];o.update_wrappers(e,i.$el)}),_.each(_.uniq(l),function(t){var e=o.get_el_model(t),i=Upfront.data.module_views[e.cid];o.update_wrappers(e,i.$el)}),_.each(_.uniq(p),function(t){var e=o.get_el_model(t),i=Upfront.data.object_views[e.cid];o.update_wrappers(e,i.$el)}),c||_.each(d,function(t){t.collection.remove(t.model,{silent:!0}),t.model.add_to(t.collection,t.index)}),_.each(i,function(t){t.$el.removeData("clear")}),this.time_end("fn normalize")},init:function(){var e=(Upfront.Application,Upfront.Behaviors.GridEditor),i=t(Upfront.Settings.LayoutEditor.Selectors.main),n=i.offset();i.find(".upfront-layout");e.baseline=Upfront.Settings.LayoutEditor.Grid.baseline,e.grid=Upfront.Settings.LayoutEditor.Grid,e.col_size=e.grid.column_width,e.max_row=Math.floor(.5*t(window).height()/e.baseline),e.main={$el:i,top:n.top,bottom:n.top+i.outerHeight(),left:n.left,right:n.left+i.outerWidth()};var o=15;t(document).on("scroll",function(t){e.resizing!==!1&&e.resizing!=window.scrollY&&(window.scrollY>e.resizing?e.resizing+=o:e.resizing-=o,window.scrollTo(window.scrollX,e.resizing))})},start:function(t,e,i){this.time_start("fn start");var n=(Upfront.Application,Upfront.Behaviors.GridEditor),o=n.main.$el.offset(),r=n.main.$el.find(".upfront-layout"),s=r.offset(),a=t.$el.find(".upfront-editable_entity").eq(0).is(".upfront-object"),l=i||t.$el.closest(".upfront-editable_entities_container"),p=l.offset();n.col_size=n.grid.column_width,n.el_selector=a?n.object_selector:n.module_selector,n.el_selector_direct=a?n.object_selector_direct:n.module_selector_direct,n.main.top=o.top,n.main.bottom=o.top+n.main.$el.outerHeight(),n.main.left=o.left,n.main.right=o.left+n.main.$el.outerWidth();var d=s.left+(r.outerWidth()-n.grid.size*n.col_size)/2;n.grid_layout={top:s.top,bottom:s.top+r.outerHeight(),left:d,right:d+n.grid.size*n.col_size,layout_left:s.left,layout_right:s.left+r.outerWidth()};var c=l.outerWidth(),u=l.outerHeight(),h=Math.round(c/n.col_size),f=Math.round(u/n.baseline),_=n.get_grid(p.left,p.top);n.containment={$el:l,top:p.top,bottom:p.top+u,left:p.left,right:p.left+c,col:h,grid:{top:_.y,bottom:_.y+f-1,left:_.x,right:_.x+h-1}},n.update_position_data(l),this.time_end("fn start")},update_position_data:function(t,e){this.time_start("fn update_position_data");var i=(Upfront.Application,Upfront.Behaviors.GridEditor),n=i.main.$el.find(".upfront-layout"),o=(i.el_selector==i.object_selector,!1),r=t.find("> .upfront-wrapper"),s=n.find(".upfront-region").not(".upfront-region-locked"),a=t.closest(".upfront-region"),l=a.data("name"),p=t.closest(".upfront-module-group"),d=p.length>0&&p.attr("id");"shadow"!==l?(r=r.filter(":visible"),o=r.find(i.el_selector_direct)):o=t.find("> .upfront-module-view > .upfront-module"),i.els=_.map(o,i.get_position),_.each(i.els,function(t){t.region=l,t.group=d,i.init_margin(t)}),i.wraps=_.map(r,i.get_position),_.each(i.wraps,function(t){t.region=l,t.group=d}),!1!==e&&(i.regions=_.map(s,i.get_region_position),_.each(i.regions,function(t){t.region=t.$el.closest(".upfront-region").data("name"),t.group=!1})),this.time_end("fn update_position_data")},update_wrappers:function(e,i){if(e){this.time_start("fn update_wrappers");var n=(Upfront.Application,Upfront.Behaviors.GridEditor),o=Upfront.Settings.LayoutEditor.CurrentBreakpoint,r=(n.el_selector==n.object_selector,t(Upfront.Settings.LayoutEditor.Selectors.main)),s=r.find(".upfront-layout"),a=e.get("wrappers");(i?i:s).find(".upfront-wrapper:visible").each(function(){var e=t(this),i=e.attr("id"),r=a.get_by_wrapper_id(i),s=e.data("clear"),l=_.map(e.find(n.el_selector_direct),function(e){var i=t(e);return!(!i||!i.length)&&i}).filter(function(t){return t!==!1});if(0==l.length)return void(r&&a.remove(r));if(!e.hasClass("upfront-wrapper-preview")&&!(e.height()<=0)&&r){var p,d=!o||o.default?n.get_class_num(e,n.grid.class):e.data("breakpoint_col"),c=_.map(l,function(t){return{$el:t,col:!o||o.default?n.get_class_num(t,n.grid.class):t.data("breakpoint_col")}}),u=_.max(c,function(t){if(t)return t.col}),h=u.col;n.update_class(e,n.grid.class,h),!o||o.default?(d!=h&&r.replace_class(n.grid.class+h),s&&"clear"==s||!s&&e.hasClass("clr")?r.add_class("clr"):r.remove_class("clr")):(p=Upfront.Util.clone(r.get_property_value_by_name("breakpoint")||{}),_.isObject(p[o.id])||(p[o.id]={}),p[o.id].col=h,s&&(p[o.id].clear="clear"==s),r.set_property("breakpoint",p))}});var l=[];a.each(function(e){0==t("#"+e.get_wrapper_id()).size()&&l.push(e)}),_.each(l,function(t){a.remove(t)}),Upfront.Events.trigger("entity:wrappers:update",e),this.time_end("fn update_wrappers")}},create_resizable:function(e,i){var n,o,r,s=this,a=Upfront.Behaviors.GridEditor,l=e.$el.hasClass("upfront-module-group"),p=e.$el.hasClass("upfront-object-view"),d=l?e.$el:e.$el.find(">.upfront-editable_entity"),c="undefined"!=typeof e.group_view,u=t(Upfront.Settings.LayoutEditor.Selectors.main);u.find(".upfront-layout");return(!1!==Upfront.plugins.isRequiredByPlugin("setup resizeable")||!i.get_property_value_by_name("disable_resize"))&&(!d.hasClass("upfront-module-spacer")&&!d.hasClass("upfront-object-spacer")&&((!p||"undefined"!=typeof e.object_group_view)&&(d.data("ui-resizable")?(d.resizable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?(d.append('<span class="upfront-icon-control upfront-icon-control-resize-s upfront-resize-handle-s ui-resizable-handle ui-resizable-s"></span>'),void d.resizable({containment:"document",autoHide:!1,delay:50,handles:{s:".upfront-resize-handle-s"},start:function(s,l){a.start(e,i),a.resizing=window.scrollY;var p=a.get_el(d),c=d.data("margin"),u=t(this).data("ui-resizable");r=u.axis?u.axis:"se",o=t('<div class="upfront-resize-placeholder"></div>'),o.css({marginLeft:c.original.left/(p.col+c.original.left)*100+"%",marginTop:c.original.top*a.baseline,width:p.col/(p.col+c.original.left)*100+"%",height:l.originalSize.height}),n=t('<div class="upfront-resize" style="height:'+p.height+'px;"></div>'),n.css({height:p.height,width:p.width,minWidth:p.width,maxWidth:p.width,position:"absolute"}),"nw"==r?n.css({top:p.position.top,right:t("body").width()-p.position.right}):n.css({top:p.position.top,left:p.position.left}),t("body").append(n),_.each(a.els,function(t,e){a.els[e]=a.get_position(t.$el)}),_.each(a.wraps,function(t,e){a.wraps[e]=a.get_position(t.$el)}),a.normalize(a.els,a.wraps),a.update_position_data(a.containment.$el);var h=d.position(),f={left:h.left+c.original.left*a.col_size,top:h.top+c.original.top*a.baseline};d.css({marginLeft:0,marginTop:0,position:"absolute",left:f.left,top:f.top,minHeight:""}),u.originalPosition.left=f.left,u.originalPosition.top=f.top,u._updateCache({left:f.left,top:f.top}),o.insertBefore(d),e.trigger("entity:resize_start",{row:p.row,col:p.col,height:p.height,width:p.width,axis:r},e,e.model),Upfront.Events.trigger("entity:resize_start",e,e.model)},resize:function(i,s){var l=d.closest(".upfront-wrapper"),p=d.closest(".upfront-region"),c=a.get_el(d),u=a.get_wrap(l),h=a.get_region(p),f=p.hasClass("upfront-region-expand-lock"),g=c.col,m=u?a.get_affected_wrapper_els(u,a.wraps,[],!0):a.get_affected_els(c,a.els,[],!0),v=a.get_move_limit(m,a.containment),b=g+("nw"==r?c.grid.left-v[0]:v[1]-c.grid.right),y=!!m.bottom.length&&_.min(m.bottom,function(t){return t.grid.top}),w=y?y.grid.top-c.grid.top:h.grid.bottom-c.grid.top+1,k=Math.ceil(s.size.width/a.col_size),$=k>b?Math.round(b*a.col_size):s.size.width,x=(s.size.height>15?s.size.height:0)||s.originalSize.height,U=Math.ceil(x/a.baseline),E=k>b?b:k,S=f&&U>w&&w>0?w:U;Math.abs(t(window).height()-i.clientY)<50&&(x+=10*a.baseline,t(window).scrollTop(t(window).scrollTop()+10*a.baseline)),d.css({height:S*a.baseline,width:$,minWidth:$,maxWidth:$}),d.data("resize-col",E),d.data("resize-row",S),n.css({height:S*a.baseline,width:E*a.col_size,minWidth:E*a.col_size,maxWidth:E*a.col_size}),"nw"==r&&n.css({top:c.$el.find(">.upfront-resize-handle-nw").offset().top,marginTop:c.$el.find(">.upfront-resize-handle-se").offset().top+c.$el.find(">.upfront-resize-handle-se").height()-c.$el.find(">.upfront-resize-handle-nw").offset().top-S*a.baseline}),f||"nw"==r||o.css("height",S*a.baseline),e.update_size_hint(E*a.col_size,S*a.baseline),e.trigger("entity:resizing",{row:S,col:E,height:S*a.baseline,width:E*a.col_size,axis:r},e,e.model)},stop:function(t,l){Upfront.Events.trigger("entity:pre_resize_stop",e,e.model,l);var u,h,f=Upfront.Settings.LayoutEditor.CurrentBreakpoint,g=d.closest(".upfront-wrapper"),m=d.closest(".upfront-region"),v=a.get_el(d),b=(d.data("margin"),a.get_wrap(g)),y=(m.hasClass("upfront-region-expand-lock"),b?a.get_affected_wrapper_els(b,a.wraps,[],!0):a.get_affected_els(v,a.els,[],!0)),w=(a.get_move_limit(y,a.containment),Math.ceil(l.originalSize.width/a.col_size),Math.ceil(l.originalSize.height/a.baseline),!!d.find(".upost-data-object").length&&d.find(".upost-data-object"),d.data("resize-col")),k=parseFloat(d.data("resize-row")),$=s.layout.get("regions");$.get_by_name(m.data("name")),p?a.containment.$el:c?e.group_view.$el.find(".upfront-editable_entities_container:first"):m.find(".upfront-modules_container > .upfront-editable_entities_container:first");if(a.resizing=!1,o.remove(),n.remove(),d.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!f||f.default){var x=i.get("objects");x&&1==x.length&&x.each(function(t){t.set_property("row",k)}),i.set_property("row",k)}else{var x=i.get("objects");x&&1==x.length&&x.each(function(t){var e=Upfront.Util.clone(t.get_property_value_by_name("breakpoint")||{});_.isObject(e[f.id])||(e[f.id]={}),e[f.id].row=k,t.set_property("breakpoint",e)}),u=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(u[f.id])||(u[f.id]={}),h=u[f.id],h.edited=!0,h.row=k,i.set_property("breakpoint",u)}a.update_position_data(a.containment.$el),a.normalize(a.els,a.wraps),d.removeData("resize-col"),d.removeData("resize-row"),e.trigger("entity:resize_stop",{row:k,col:w,height:k*a.baseline,width:w*a.col_size,axis:r},e,e.model),Upfront.Events.trigger("entity:resize_stop",e,e.model,l),Upfront.Events.trigger("entity:resized",e,e.model)}})):(d.data("ui-resizable")&&d.resizable("option","disabled",!1),!1))))},toggle_resizables:function(e){t(".upfront-editable_entity.ui-resizable").resizable("option","disabled",!e)},resize:function(e,i,n,o,r,s){var a=Upfront.Application,l=Upfront.Behaviors.GridEditor,r=/all|nw|se/.test(r)?r:"all",p=t(Upfront.Settings.LayoutEditor.Selectors.main);p.find(".upfront-layout");l.start(e,i);var d=e.$el.find(".upfront-editable_entity:first"),c=d.find(".upfront-editable_entity"),u=d.closest(".upfront-wrapper"),h=d.closest(".upfront-region"),f=(d.data("margin"),l.get_el(d)),_=l.get_wrap(u),g=l.get_region(h),m=(h.hasClass("upfront-region-expand-lock"),_?l.get_affected_wrapper_els(_,l.wraps,[],!0):l.get_affected_els(f,l.els,[],!0),l.get_max_size(f,l.els,g,r)),v="undefined"!=typeof e.group_view,b=!!v&&e.group_view.model,y=a.layout.get("regions"),w=y.get_by_name(h.data("name")),k=(v?b:w).get("wrappers"),$=k.get_by_wrapper_id(u.attr("id"));Upfront.data.wrapper_views[$.cid];if(n<1||o<1)return!1;if(!s){d.css("min-height",""),c.css("min-height","");var x=Math.ceil(d.outerHeight()/l.baseline);o=o>x?o:x,d.css("min-height",o*l.baseline),c.css("min-height",(o-2)*l.baseline)}n=n?n>m.col?m.col:n:f.col,o=o?m.row&&o>m.row?m.row:o:f.row,l.normalize(l.els,l.wraps),l.update_position_data(l.containment.$el),l.update_class(d,l.grid.class,n),i.set_property("row",o);var U=i.get("objects");return U&&1==U.length&&U.each(function(t){t.set_property("row",o)}),"se"!=r?i.replace_class([l.grid.class+n].join(" ")):i.replace_class(l.grid.class+n),"undefined"!=typeof e.group_view?l.update_wrappers(e.group_view.model,e.group_view.$el):l.update_wrappers(w,g.$el),e.trigger("entity:resize_stop",{row:o,col:n},e,e.model),Upfront.Events.trigger("entity:resized",e,e.model),!0},create_wrapper_resizable:function(e,i){var n,o,r,s,a,l,p,d,c,u,h,f,g,m,v,b,y,w,k,$,x,U,E,S,C=this,T=Upfront.Behaviors.GridEditor,z=e.$el,I=t(Upfront.Settings.LayoutEditor.Selectors.main);I.find(".upfront-layout");return(!1!==Upfront.plugins.isRequiredByPlugin("setup resizeable")||!i.get_property_value_by_name("disable_resize"))&&(z.data("ui-resizable")?(z.resizable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?void z.resizable({containment:"document",autoHide:!1,delay:50,handles:{w:".upfront-resize-handle-wrapper-w",e:".upfront-resize-handle-wrapper-e"},start:function(C,I){T.time_start("fn wrapper_resize_start"),T.start(e,i),T.resizing=window.scrollY,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),r=!_.isUndefined(e.parent_view.object_group_view),r?(a=e.parent_view.object_group_view,l=T.get_position(a.$el)):(s=!_.isUndefined(e.parent_view.group_view),a=s?e.parent_view.group_view:e.parent_view.region_view,l=s?T.get_position(a.$el):T.get_region(a.$el));var P,M=T.get_wrap(z),j=t(this).data("ui-resizable"),O=(Upfront.Util.find_sorted(z.parent(),"> .upfront-wrapper"),T.get_affected_els(M,T.wraps,[],!0),a.model.get("wrappers")),D=r?a.model.get("objects"):a.model.get("modules"),A=T.parse_modules_to_lines(D,O,o.id,l.col);n=z.closest(".upfront-region"),y=j.axis?j.axis:"e",h=!1,P=!1,f=!1,g=!1,b=!1,p=z.find("> .upfront-module-group").length>0,$=M.col,w=T.min_col,k=T.min_col,_.each(A,function(t){_.each(t.wrappers,function(e,n){var o=!1;e.model==i&&(E=0===n,S=n===t.wrappers.length-1,v=e.spacer,E||"w"!=y?S||"e"!=y||(o=t.wrappers[n+1]):o=t.wrappers[n-1],o!==!1&&(f=o.model,g=Upfront.data.wrapper_views[f.cid],h=g.$el,P=T.get_wrap(h),b=o.spacer))})}),x=[],z.find(T.el_selector_direct).each(function(){var e=T.get_el_model(t(this)),i=r?Upfront.data.object_views[e.cid]:Upfront.data.module_views[e.cid];i&&x.push({view:i,is_group:!r&&t(this).hasClass("upfront-module-group"),el:T.get_el(t(this))})}),p&&_.each(x,function(t){if(t.is_group){var e=T.get_group_min_col(t.view);w=e>w?e:w}}),c=t('<div class="upfront-resize" style="height:'+M.height+'px;"></div>'),c.css({height:M.height,width:M.width,minWidth:M.width,maxWidth:M.width,position:"absolute"}),"w"==y?c.css({top:M.position.top,right:t("body").width()-M.position.right}):c.css({top:M.position.top,left:M.position.left}),t("body").append(c),U=[],h&&h.length&&(d=h.find("> .upfront-module-group").length>0,h.find(T.el_selector_direct).each(function(){var e=T.get_el_model(t(this)),i=r?Upfront.data.object_views[e.cid]:Upfront.data.module_views[e.cid];i&&U.push({view:i,is_group:!r&&t(this).hasClass("upfront-module-group"),el:T.get_el(t(this))})}),d&&_.each(U,function(t){if(t.is_group){var e=T.get_group_min_col(t.view);k=e>k?e:k}}),$=M.col+P.col,v||b?v&&($-=k,w=0):$-=k,b&&(k=0)),u=t('<div class="upfront-resize-placeholder"></div>'),u.css({width:(P?P.col+M.col:M.col)/l.col*100+"%",height:I.originalSize.height,position:"relative"}),o&&!o.default&&u.css("order",z.css("order")),(v||b)&&(m=t('<div class="upfront-spacer-feed"></div>'),m.css({width:T.col_size,height:"auto",top:0,bottom:0,position:"absolute"}),u.append(m)),_.each(T.els,function(t,e){T.els[e]=T.get_position(t.$el)}),_.each(T.wraps,function(t,e){T.wraps[e]=T.get_position(t.$el)}),T.normalize(T.els,T.wraps),T.update_position_data(T.containment.$el);var L=z.position(),N=!!h&&h.position();z.css({marginLeft:0,marginTop:0,position:"absolute",left:L.left,top:L.top,minHeight:""}),h&&h.css({marginLeft:0,marginTop:0,position:"absolute",top:N.top,left:N.left}),j.originalPosition.left=L.left,j.originalPosition.top=L.top,j._updateCache({left:L.left,top:L.top}),u.insertBefore(z),_.each(x,function(t){t.view.trigger("entity:resize_start",{row:t.el.row,col:t.el.col,height:t.el.height,width:t.el.width,axis:y},t.view,t.view.model)}),_.each(U,function(t){t.view.trigger("entity:resize_start",{row:t.el.row,col:t.el.col,height:t.el.height,width:t.el.width,axis:"w"==y?"e":"w"},t.view,t.view.model)}),e.trigger("entity:wrapper:resize_start",{row:M.row,col:M.col,height:M.height,width:M.width,axis:y},e,e.model),g&&g.trigger("entity:wrapper:resize_start",{row:P.row,col:P.col,height:P.height,width:P.width,axis:"w"==y?"e":"w"},g,g.model),Upfront.Events.trigger("entity:wrapper:resize_start",e,e.model,g,g.model),T.time_end("fn wrapper_resize_start")},resize:function(t,i){T.time_start("fn wrapper_resize_resizing");var o=T.get_wrap(z),r=!!h&&T.get_wrap(h),s=(T.get_region(n),w*T.col_size),a=l>$?Math.round($*T.col_size):s>i.size.width?s:i.size.width,l=Math.round(a/T.col_size),p=(i.size.height>15?i.size.height:0)||i.originalSize.height,d="w"==y?i.originalPosition.left+i.originalSize.width-a:i.position.left,u=l>$?$:l,f=$-u+k,E=($+k)*T.col_size-a;if(z.css({left:d,height:p,width:a,minWidth:a,maxWidth:a}),z.data("resize-col",u),v&&a<T.col_size){var S=.5*Math.round((T.col_size-a)/T.col_size*100)/100;m.css({left:"e"==y?0:"auto",right:"e"==y?"auto":0,backgroundColor:"rgba(200, 0, 0, "+S+")"})}if(h&&(h.css({width:E,minWidth:E,maxWidth:E}),"e"==y&&h.css("margin-left",r.width-E),h.data("resize-col",f),b&&E<T.col_size)){var S=.5*Math.round((T.col_size-E)/T.col_size*100)/100;m.css({left:"w"==y?0:"auto",right:"w"==y?"auto":0,backgroundColor:"rgba(200, 0, 0, "+S+")"})}c.css({height:p,width:u*T.col_size,minWidth:u*T.col_size,maxWidth:u*T.col_size}),_.each(x,function(t){t.view.trigger("entity:resizing",{row:t.el.row,col:u,height:t.el.height,width:u*T.col_size,axis:y},t.view,t.view.model)}),_.each(U,function(t){t.view.trigger("entity:resizing",{row:t.el.row,col:f,height:t.el.height,width:f*T.col_size,axis:"w"==y?"e":"w"},t.view,t.view.model)}),e.trigger("entity:wrapper:resizing",{row:o.row,col:u,height:o.height,width:u*T.col_size,axis:y},e,e.model),g&&g.trigger("entity:wrapper:resizing",{row:r.row,col:f,height:r.height,width:f*T.col_size,axis:"w"==y?"e":"w"},g,g.model),T.time_end("fn wrapper_resize_resizing")},stop:function(t,s){T.time_start("fn wrapper_resize_stop"),Upfront.Events.trigger("entity:wrapper:pre_resize_stop",e,e.model,s);var l=T.get_wrap(z),p=!!h&&T.get_wrap(h),d=(Math.ceil(s.originalSize.width/T.col_size),z.data("resize-col")),m=h?h.data("resize-col"):0,w=C.layout.get("regions"),k=(w.get_by_name(n.data("name")),"w"==y&&E),I="e"==y&&S;T.resizing=!1,u.remove(),c.remove(),z.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),h&&h.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!f&&(k||I)&&$-d>0?e.add_spacer(k?"left":"right",$-d,$,r):(d>0?o&&!o.default?(i.set_breakpoint_property("edited",!0,!0),i.set_breakpoint_property("col",d),_.each(x,function(t){t.view.model.set_breakpoint_property("edited",!0,!0),t.view.model.set_breakpoint_property("col",d)})):(i.replace_class(T.grid.class+d),_.each(x,function(t){t.view.model.replace_class(T.grid.class+d)})):v&&(i.collection.remove(i),_.each(x,function(t){t.view.model.collection.remove(t.view.model)})),f&&(m>0?o&&!o.default?(f.set_breakpoint_property("edited",!0,!0),f.set_breakpoint_property("col",m),_.each(U,function(t){t.view.model.set_breakpoint_property("edited",!0,!0),t.view.model.set_breakpoint_property("col",m)})):(f.replace_class(T.grid.class+m),_.each(U,function(t){t.view.model.replace_class(T.grid.class+m)})):b&&(f.collection.remove(f),_.each(U,function(t){t.view.model.collection.remove(t.view.model)})))),r?a.model.get("objects").each(function(t){t.set_breakpoint_property("edited",!0,!0)}):a.model.get("modules").each(function(t){t.set_breakpoint_property("edited",!0,!0)}),a.model.get("wrappers").each(function(t){t.set_breakpoint_property("edited",!0,!0)}),T.update_position_data(T.containment.$el),T.normalize(T.els,T.wraps),z.removeData("resize-col"),h&&h.removeData("resize-col"),_.each(x,function(t){t.view.trigger("entity:resize_stop",{row:t.el.row,col:d,height:t.el.height,width:d*T.col_size,axis:y},t.view,t.view.model)}),_.each(U,function(t){t.view.trigger("entity:resize_stop",{row:t.el.row,col:m,height:t.el.height,width:m*T.col_size,axis:"w"==y?"e":"w"},t.view,t.view.model)}),e.trigger("entity:wrapper:resize_stop",{row:l.row,col:d,height:l.height,width:d*T.col_size,axis:y},e,e.model),e.trigger("entity:wrapper:resize",{col:d},e,e.model),g&&(g.trigger("entity:wrapper:resize_stop",{row:p.row,col:m,height:p.height,width:d*T.col_size,axis:"w"==y?"e":"w"},g,g.model),g.trigger("entity:wrapper:resize",{col:m},g,g.model)),Upfront.Events.trigger("entity:wrapper:resize_stop",e,e.model,g,g.model,s),Upfront.Events.trigger("entity:wrapper:resized",e,e.model,g,g.model),T.time_end("fn wrapper_resize_stop")}}):(z.data("ui-resizable")&&z.resizable("option","disabled",!1),z.find(".upfront-resize-handle-wrapper").remove(),!1))},get_group_min_col:function(t){var e=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=Upfront.Behaviors.GridEditor,n=t.model.get("modules"),o=t.model.get("wrappers"),r=!e||e.default?i.get_class_num(t.$el,i.grid.class):t.$el.data("breakpoint_col"),s=i.parse_modules_to_lines(n,o,e?e.id:"desktop",r),a=i.min_col;return _.each(s,function(t){var e=0;_.each(t.wrappers,function(t){e+=t.spacer?1:i.min_col}),e>a&&(a=e)}),a},create_draggable:function(t,i){var n=Upfront.Behaviors.GridEditor;n.drag_instances[t.cid]?n.drag_instances[t.cid].setup():(n.drag_instances[t.cid]=new e(t,i),i.on("remove",function(){delete n.drag_instances[t.cid]}))},toggle_draggables:function(e){t(".upfront-editable_entity.ui-draggable").draggable("option","disabled",!e)},parse_modules_to_lines:function(t,e,i,n){var o=Upfront.Behaviors.GridEditor,r={},s=[],a=[],l=0,p=0;return t.each(function(t,s){var a=t.get_wrapper_id(),l=e.get_by_wrapper_id(a),p=!!l&&l.get_property_value_by_name("breakpoint"),d=p&&i in p?p[i]:{},c=l?l.get_property_value_by_name("class"):"",u=o.get_class_num(c,o.grid.class),h=!!c.match(/clr/),f=t.get_property_value_by_name("breakpoint"),_=f&&i in f?f[i]:{},g=t.get_property_value_by_name("default_hide"),m=t.get_property_value_by_name("hide"),v=t.get_property_value_by_name("class"),b=o.get_class_num(v,o.grid.class),y=!!v.match(/(upfront-module-spacer|upfront-object-spacer)/),w=s,k=s,$={};l&&("desktop"!=i&&(m="hide"in _?_.hide:g,b="col"in _?parseInt(_.col,10):b,w="order"in _?1e4*parseInt(_.order,10)+w:w,u="col"in d?parseInt(d.col,10):u,k="order"in d?1e4*parseInt(d.order,10)+k:k,h="clear"in d?d.clear:h),m===!1&&(m=g),m&&y||($={model:t,col:b,order:w,spacer:y,hide:m},b>u&&(u=b),u>n&&(u=n),a in r?(r[a].modules.push($),r[a].col=u):r[a]={model:l,modules:[$],order:k,col:u,clear:h,spacer:y}))}),s=_.sortBy(r,function(t,e){return t.order}),_.each(s,function(t,e){(e>0&&t.clear||l>0&&l+t.col>n)&&(a[p].col=l,p++,l=0),_.isUndefined(a[p])&&(a[p]={wrappers:[],col:0}),l+=t.col,a[p].wrappers.push(t),a[p].col=l}),a},get_container_col:function(t,e){var i=Upfront.Behaviors.GridEditor,n=!_.isUndefined(t.group_view),o=!_.isUndefined(t.object_group_view),r=(n?t.group_view:o?t.object_group_view.parent_module_view:t.region_view).model.get_property_value_by_name("breakpoint"),s=r&&e.id in r?r[e.id]:{},a=o?t.object_group_view.parent_module_view.$el.find("> .upfront-module"):(n?t.group_view:t.region_view).$el,l=e.default?i.get_class_num(a,i.grid.class):_.isNumber(s.col)?s.col:e.columns;return l>e.columns?e.columns:l},normalize_module_remove:function(t,e,i,n,o){var r=(Upfront.Application,Upfront.Behaviors.GridEditor),s=(i.indexOf(e),Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled());!_.isUndefined(t.group_view),!_.isUndefined(t.object_group_view);_.each(s,function(n){var s,a,l,p,d,c,u=n.toJSON(),h=r.get_container_col(t,u),f=r.parse_modules_to_lines(i,o,u.id,h),g=!1,m=!1,v=[],b=[];if(_.each(f,function(t){s||(l=!1,p=!1,_.each(t.wrappers,function(i){a&&!p&&(p=i),_.each(i.modules,function(n){e==n.model&&(a=i,s=t)}),a||(l=i)}))}),s){if(p&&(c=p.model.get_property_value_by_name("class"),c.match(/clr/g)||(m=!0)),l&&(d=l.model.get_property_value_by_name("class"),d.match(/clr/g)&&!m&&(g=!0)),_.each(s.wrappers,function(t){t!=a&&(v.push(t),t.spacer&&b.push(t))}),v.length>=2&&(m=!1),1==a.modules.length){var y=h,w=0,k=0;_.each(b,function(t){y-=t.col}),v.length==b.length?_.each(v,function(t,e){_.each(t.modules,function(t){i.remove(t.model)}),o.remove(t.model)}):(w=Math.floor(y/(v.length-b.length)),k=y-(v.length-b.length)*w,_.each(v,function(t,e){if(!_.contains(b,t)){var i=t.model.get_property_value_by_name("class"),n=t.model.get_property_value_by_name("breakpoint"),o=n&&u.id in n?n[u.id]:{},s=w;k>0&&(s+=1,k-=1),u.default?(t.model.replace_class(r.grid.class+s+(0!=e||i.match(/clr/g)?"":" clr")),_.each(t.modules,function(t){t.model.replace_class(r.grid.class+s)})):(o.col=s,0!=e||o.clear||(o.clear=!0),t.model.set_property("breakpoint",Upfront.Util.clone(n)),_.each(t.modules,function(t){var e=t.model.get_property_value_by_name("breakpoint"),i=e&&u.id in e?e[u.id]:{};i.col=s,t.model.set_property("breakpoint",Upfront.Util.clone(e))}))}}))}if(u.default&&(g||m)){var $=!1;_.each(g?l.modules:p.modules,function(t,e){var i=t.model.get_property_value_by_name("class"),n=r.get_class_num(i,r.grid.class),s=Upfront.data.module_views[t.model.cid],a=g?l:p,d=Upfront.data.wrapper_views[a.model.cid],c=$?Upfront.data.wrapper_views[$.cid]:d;if(e>0){var u=Upfront.Util.get_unique_id("wrapper"),h=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:u},{name:"class",value:r.grid.class+n+" clr"}]}),f=new Upfront.Views.Wrapper({model:h});o.add(h),f.parent_view=s.parent_view,s.wrapper_view=f,f.render(),f.$el.append(s.$el),c.$el.after(f.$el),Upfront.data.wrapper_views[h.cid]=f,t.model.set_property("wrapper_id",u),$=h}})}}})},adapt_to_breakpoint:function(t,e,i,n,o){var r=(Upfront.Application,Upfront.Behaviors.GridEditor),s=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:i}).toJSON(),a=Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON(),o=o===!0,l=r.parse_modules_to_lines(t,e,a.id,a.columns),p=r.parse_modules_to_lines(t,e,i,n),d=r._filter_edited_lines(p,s),c=[],u=[],h=[],f=[],g=[],m=[],v=[];r._wrapper_index=0,_.each(l,function(t,e){_.each(t.wrappers,function(i,n){if(!i.spacer){var o=i.model.get_breakpoint_property_value("edited",!1,!1,s);if(o)return void r._wrapper_index++;r._wrapper_index++,c.push({prev:r._find_prev_wrapper_from_lines(i,n,t,e,l),next:r._find_next_wrapper_from_lines(i,n,t,e,l),current:i,order:r._wrapper_index})}})}),0!=c.length&&(c=_.filter(c,function(t,e){return e==t.order-1?(u.push(t),!1):r._wrapper_index!=t.order+(c.length-e-1)||(h.push(t),!1)}),m=r._adapt_wrappers_to_line(u,n),f=r._adapt_wrappers_to_line(c,n),g=f.slice(0),v=r._adapt_wrappers_to_line(h,n),r._wrapper_index=0,_.each(m,function(t){r._set_adapt_wrappers(t.wrappers,n,o,s)}),_.each(d,function(t,e){var i=e>0&&d[e-1];e<d.length-1&&d[e+1];_.each(t.wrappers,function(e,a){var l=[];_.each(g,function(e,a){var p=e.prev_wrapper,d=e.next_wrapper,c=!1,u=Math.floor(n/e.wrappers.length);n-u*e.wrappers.length;_.each(e.wrappers,function(e){r._find_wrapper_in_line(p,i)?c=!0:r._find_wrapper_in_line(d,t)&&!r._find_wrapper_in_line(p,t)&&(c=!0)}),c&&(r._set_adapt_wrappers(e.wrappers,n,o,s),l.push(a))}),_.each(l,function(t,e){g.splice(t-e,1)}),r._wrapper_index++,e.model.set_breakpoint_property("order",r._wrapper_index,o,s)})}),_.each(_.union(g,v),function(t){r._set_adapt_wrappers(t.wrappers,n,o,s)}))},_set_adapt_wrappers:function(t,e,i,n){var o=Math.floor(e/t.length),r=e-o*t.length,s=this;_.each(t,function(t,e){var a=o;r>0&&(a++,r--),s._wrapper_index++,t.current.model.set_breakpoint_property("clear",0==e,i,n),t.current.model.set_breakpoint_property("col",a,i,n),t.current.model.set_breakpoint_property("order",s._wrapper_index,i,n),_.each(t.current.modules,function(t,e){t.model.set_breakpoint_property("col",a,i,n)})})},_filter_edited_lines:function(t,e){return _.filter(t,function(t){var i=!1;return _.each(t.wrappers,function(t){if(!t.spacer&&!i){var n=t.model.get_breakpoint_property_value("edited",!1,!1,e);return n?void 0:void(i=!0)}}),!i})},_adapt_wrappers_to_line:function(t,e){var i=0,n=[],o=[],r=!1,s=!1,a=!1;return _.each(t,function(l,p){var d=r&&l.order-r.order>1;if((d||i+l.current.col>e)&&o.length>0&&(n.push({wrappers:o,col:i,prev_wrapper:s,next_wrapper:a}),o=[],i=0,d&&(s=!1,a=!1)),s===!1&&(s=l.prev),a===!1){a=l.next;for(var c=p+1;c<t.length&&!(t[c].order-l.order>1);c++)a=t[c].next}i+=l.current.col,o.push(l),r=l}),o.length>0&&n.push({wrappers:o,col:i,prev_wrapper:s,next_wrapper:a}),n},_find_prev_wrapper_from_lines:function(t,e,i,n,o){if(e>0){if(!i.wrappers[e-1].spacer)return i.wrappers[e-1];if(e>1)return i.wrappers[e-2]}if(n>0)for(var r=o[n-1].wrappers.length-1;r>=0;r--)if(!o[n-1].wrappers[r].spacer)return o[n-1].wrappers[r];return!1},_find_next_wrapper_from_lines:function(t,e,i,n,o){if(e<i.wrappers.length-1){if(!i.wrappers[e+1].spacer)return i.wrappers[e+1];if(e<i.wrappers.length-2)return i.wrappers[e+2]}if(n<o.length-1)for(var r=0;r<o[n+1].wrappers.length;r++)if(!o[n+1].wrappers[r].spacer)return o[n+1].wrappers[r];return!1},_find_wrapper_in_line:function(t,e){
return!!(e&&e.wrappers&&t)&&(0!=e.wrappers.length&&_.find(e.wrappers,function(e,i){return t.model.cid==e.model.cid}))},adapt_region_to_breakpoint:function(t,e,i,n){var o=(Upfront.Application,Upfront.Behaviors.GridEditor,Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON()),n=n===!0;t.each(function(t){var r=Upfront.Util.clone(t.get_property_value_by_name("breakpoint")||{}),s=t.get_property_value_by_name("col"),a=t.get("sub");_.isObject(r[e])||(r[e]={edited:!1}),r[e].edited||(t.is_main()||!a||a.match(/^(left|right)$/)?r[e].col=o.columns:a.match(/^lightbox$/)&&s>i&&(r[e].col=i)),t.set_property("breakpoint",r,n)})},create_region_resizable:function(e,i){var n,o,r,s=Upfront.Behaviors.GridEditor,a=e.$el,l=t(Upfront.Settings.LayoutEditor.Selectors.main),p=(l.find(".upfront-layout"),i.collection),d=(p.indexOf(i),p.size()-1,i.get("sub")),c=(i.get("container"),{}),u=function(){var t={top:i.get_property_value_by_name("top"),left:i.get_property_value_by_name("left"),bottom:i.get_property_value_by_name("bottom"),right:i.get_property_value_by_name("right"),width:i.get_property_value_by_name("width"),height:i.get_property_value_by_name("height")};return t.is_top="number"==typeof t.top,t.is_left="number"==typeof t.left,t.is_bottom="number"==typeof t.bottom,t.is_right="number"==typeof t.right,t};return!a.data("ui-resizable")&&void((i.is_main()||!d||d.match(/^(fixed|left|right)$/))&&(i.is_main()?(n=["s"],o={s:".upfront-region-resize-handle-s"}):"left"==d?(n=["e","s"],o={e:".upfront-region-resize-handle-e",s:".upfront-region-resize-handle-s"}):"right"==d?(n=["w","s"],o={w:".upfront-region-resize-handle-w",s:".upfront-region-resize-handle-s"}):"fixed"==d&&(c=u(),c.is_top&&c.is_left||c.is_bottom&&c.is_right?(n=["nw","se"],o={nw:".upfront-region-resize-handle-nw",se:".upfront-region-resize-handle-se"}):(n=["ne","sw"],o={ne:".upfront-region-resize-handle-ne",sw:".upfront-region-resize-handle-sw"})),_.each(n,function(t){var e=t.match(/^(e|w|s|n)$/)?"upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-"+t:"upfront-icon-control upfront-icon-control-resize upfront-icon-control-resize-"+t;a.append('<div class="'+e+" upfront-region-resize-handle upfront-region-resize-handle-"+t+" ui-resizable-handle ui-resizable-"+t+'"></div>')}),a.resizable({containment:"document",handles:o,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(i,n){var o=(s.get_class_num(a,s.grid.class),t(this).data("ui-resizable")),l=n.helper;if(r=o.axis?o.axis:"se",s.resizing=window.scrollY,t(this).resizable("option","minWidth",3*s.col_size),"fixed"!=d)t(this).resizable("option","maxWidth",10*s.col_size);else{t(this).resizable("option","minHeight",3*s.baseline),a.css("position",""),e.update_region_position(),c=u();var p=a.position();o.originalPosition.left=p.left,o.originalPosition.top=p.top,o.originalSize.width=c.width,o.originalSize.height=c.height,o._updateCache({left:p.left,top:p.top}),l.css({marginLeft:0,marginTop:0,left:p.left,top:p.top,position:"fixed"})}Upfront.Events.trigger("entity:region:resize_start",e,e.model)},resize:function(t,i){var n=i.helper;if("fixed"!=d)if("s"==r){var o=Math.abs(Math.ceil(i.size.height/s.baseline)),p=Math.round(o*s.baseline);n.css({height:p,width:i.originalSize.width,minWidth:i.originalSize.width,maxWidth:i.originalSize.width}),e.update_size_hint(i.originalSize.width,p),a.data("resize-row",o)}else{var u=s.get_class_num(a,s.grid.class),h=a.prevAll(".upfront-region:first"),f=a.nextAll(".upfront-region:first"),_=h.size()>0?s.get_class_num(h,s.grid.class):0,g=f.size()>0?s.get_class_num(f,s.grid.class):0,m=u+(g>_?g:_),v=Math.abs(Math.ceil(i.size.width/s.col_size)),b=v>m?m:v,y=Math.round(b*s.col_size);n.css({height:i.originalSize.height,width:y,minWidth:y,maxWidth:y,marginLeft:"w"==r?i.size.width-y:0}),e.update_size_hint(y,i.originalSize.height),a.data("resize-col",b)}else{var w,k,$=(a.offset(),l.offset(),a.height()),x=a.width(),U=max_width=!1;c.is_top&&(U=("nw"==r||"ne"==r)&&c.top+$),!c.is_top&&c.is_bottom&&(U=("se"==r||"sw"==r)&&c.bottom+$),c.is_left&&(max_width=("nw"==r||"sw"==r)&&c.left+x),!c.is_left&&c.is_right&&(max_width=("se"==r||"ne"==r)&&c.right+x),k=Math.round(U&&i.size.height>U?U:i.size.height),w=Math.round(max_width&&i.size.width>max_width?max_width:i.size.width),n.css({height:k,width:w}),e.update_size_hint(w,k,n),a.data("resize-height",k),a.data("resize-width",w)}},stop:function(t,n){var o,l,p=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(s.resizing=!1,a.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",right:"",bottom:""}),"fixed"!=d){var u=a.data("resize-col"),h=a.data("resize-row");!p||p.default?(u&&i.set_property("col",u),h&&i.set_property("row",h)):(u||h)&&(o=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(o[p.id])||(o[p.id]={}),l=o[p.id],l.edited=!0,u&&(l.col=u),h&&(l.row=h),i.set_property("breakpoint",o)),a.removeData("resize-col"),a.removeData("resize-row")}else{var f=a.data("resize-width"),g=a.data("resize-height"),u=Math.floor(f/s.col_size);"nw"!=r&&"ne"!=r||!c.is_top||i.set_property("top",c.top+c.height-g),"se"!=r&&"sw"!=r||c.is_top||!c.is_bottom||i.set_property("bottom",c.bottom+c.height-g),"nw"!=r&&"sw"!=r||!c.is_left||i.set_property("left",c.left+c.width-f),"se"!=r&&"ne"!=r||c.is_left||!c.is_right||i.set_property("right",c.right+c.width-f),i.set_property("width",f,!0),i.set_property("height",g,!0),i.set_property("col",u,!0),i.get("properties").trigger("change"),a.removeData("resize-width"),a.removeData("resize-height")}Upfront.Events.trigger("entity:region:resize_stop",e,e.model)}})))},create_region_draggable:function(e,i){if(i.get("container")&&i.get("container")!=i.get("name")){var n=(Upfront.Behaviors.GridEditor,e.$el),o=t(Upfront.Settings.LayoutEditor.Selectors.main),r=(o.find(".upfront-layout"),e.parent_view.get_container_view(i)),s=i.get("sub"),a={},l=!1,p=function(){var t={top:i.get_property_value_by_name("top"),left:i.get_property_value_by_name("left"),bottom:i.get_property_value_by_name("bottom"),right:i.get_property_value_by_name("right"),width:i.get_property_value_by_name("width"),height:i.get_property_value_by_name("height")};return t.is_top="number"==typeof t.top,t.is_left="number"==typeof t.left,t.is_bottom="number"==typeof t.bottom,t.is_right="number"==typeof t.right,t},d={},c="";return"fixed"==s&&(!n.data("ui-draggable")&&void n.draggable({disabled:!0,revert:!0,revertDuration:0,zIndex:100,helper:"clone",delay:15,scroll:!1,iframeFix:!0,start:function(t,e){var o=e.helper,r=n.width(),s=n.height();o.css("width",r),o.css("height",s),n.hide(),a=p(),l=i.get("restrict_to_container"),c=o.css("position")},drag:function(i,n){var s,a,l,p,u=n.helper,h=o.offset(),f=o.width(),_=r.$el.offset(),g=r.$el.height(),m=_.top+g,v=t(window).scrollTop(),b=t(window).height(),y=v+b,w=f/2+h.left,k="fixed"==c||g>b?b/2:g/2,$=n.position.left,x=n.position.top,U=u.width(),E=u.height(),S=U/2+$,C=E/2+x;d={},"absolute"==c&&g>b&&m<=y&&(k=g-b/2),C<=k?(s="fixed"==c||g<b||m>=y?0:g-b,l=x<s?s:x,d.top=l-s):(s="fixed"==c||g>b&&_.top>=v?b-E:g-E,l=x>s?s:x,d.bottom=s-l),S<=w?(a=h.left,p=$<a?a:$,d.left=p-a):(a=f-U+h.left,p=$>a?a:$,d.right=a-p),e.update_position_hint(d,u),n.position.top=l,n.position.left=p},stop:function(t,e){n.show(),"number"==typeof d.top?(i.set_property("top",d.top,!0),i.remove_property("bottom",!0)):"number"==typeof d.bottom&&(i.set_property("bottom",d.bottom,!0),i.remove_property("top",!0)),"number"==typeof d.left?(i.set_property("left",d.left,!0),i.remove_property("right",!0)):"number"==typeof d.right&&(i.set_property("right",d.right,!0),i.remove_property("left",!0)),i.get("properties").trigger("change")}}))}},create_region_container_resizable:function(e,i){var n=Upfront.Behaviors.GridEditor,o=e.$el,r=t(Upfront.Settings.LayoutEditor.Selectors.main),s=i.get("sub"),a="s",l={},p=r.find(".upfront-layout");return!o.data("ui-resizable")&&(i.is_main()||"bottom"!=s||(a="n"),o.append('<div class="upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-'+a+" upfront-region-resize-handle upfront-region-resize-handle-"+a+" ui-resizable-handle ui-resizable-"+a+'"></div>'),l[a]=".upfront-region-resize-handle-"+a,void o.resizable({containment:"document",handles:l,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(t,i){Upfront.Events.trigger("entity:region_container:resize_start",e,e.model),Upfront.Events.trigger("command:region:edit_toggle",!1),n._prepare_resize_auto_scroll(i,p.find("> .upfront-regions"))},resize:function(r,s){var a=s.helper,l=(s.size.height>15?s.size.height:0)||s.originalSize.height,p=Math.ceil(l/n.baseline),d=t(this).data("ui-resizable");a.css({width:o.width(),height:p*n.baseline}),o.data("resize-row",p);var c=Upfront.data.region_views[i.cid];c&&c.update_size_hint(c.$el.width(),p*n.baseline),_.each(e.sub_model,function(t){var e=Upfront.data.region_views[t.cid];e&&(e.$el.hasClass("upfront-region-side-left")||e.$el.hasClass("upfront-region-side-right"))&&e.update_size_hint(e.$el.width(),p*n.baseline)}),n._start_resize_auto_scroll(r,s,l,d)},stop:function(t,r){var s,a,l=Upfront.Settings.LayoutEditor.CurrentBreakpoint,p=o.data("resize-row");o.css({width:"",minHeight:"",height:"",maxHeight:"",position:"",top:"",left:""}),n._clear_resize_auto_scroll(),!l||l.default?i.set_property("row",p):(s=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(s[l.id])||(s[l.id]={}),a=s[l.id],a.edited=!0,a.row=p,i.set_property("breakpoint",s)),o.removeData("resize-row"),Upfront.Events.trigger("entity:region_container:resize_stop",e,e.model),Upfront.Events.trigger("command:region:edit_toggle",!0),n.resizing=!1}}))},_auto_scroll_t:!1,_auto_scroll_data:{},_auto_scroll_step:3,_auto_scroll_timeout:100,_prepare_resize_auto_scroll:function(e,i){var n=t(document).height(),o=t('<div class="upfront-auto-scroller"></div>');o.css({width:1,height:0,visibility:"hidden"}).appendTo(i?i:"body"),this._auto_scroll_data={document_height:n,position_top:e.originalPosition.top,position_height:e.originalSize.height,position_rest:n-(e.originalPosition.top+e.originalSize.height),$scroller:o}},_start_resize_auto_scroll:function(e,i,n,o){var r=this,s=t(window).height(),a=Math.abs(s-e.clientY),l=n-this._auto_scroll_data.position_height,p=l-this._auto_scroll_data.position_rest,d=0,c=this._auto_scroll_step*this.baseline,u=i.helper;clearTimeout(this._auto_scroll_t),a>50||(this._auto_scroll_t=setTimeout(function(){d+=c,p+d>0&&r._auto_scroll_data.$scroller.height(p+d+a),o.size.height=n+d,o.parentData.height=t(document).height(),u.css("height",o.size.height),t(window).scrollTop(t(window).scrollTop()+c),o._trigger("resize",e,i)},this._auto_scroll_timeout))},_clear_resize_auto_scroll:function(){this._auto_scroll_data.$scroller.remove(),clearTimeout(this._auto_scroll_t)},toggle_region_resizable:function(e){var i,n=t(Upfront.Settings.LayoutEditor.Selectors.main);e?(i=t(n.hasClass("upfront-region-fixed-editing")?".upfront-region-side-fixed":".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip, .upfront-region-sub-container"),i.each(function(){t(this).data("ui-resizable")&&t(this).resizable("option","disabled",!1)})):t(".upfront-region, .upfront-region-container").each(function(){t(this).data("ui-resizable")&&t(this).resizable("option","disabled",!0)})},toggle_region_draggable:function(e){var i,n=t(Upfront.Settings.LayoutEditor.Selectors.main);e?(i=t(n.hasClass("upfront-region-fixed-editing")?".upfront-region-side-fixed":".upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip"),i.each(function(){t(this).data("ui-draggable")&&t(this).draggable("option","disabled",!1)})):t(".upfront-region, .upfront-region-container").each(function(){t(this).data("ui-draggable")&&t(this).draggable("option","disabled",!0)})},update_grid:function(e){var i=Upfront.Application,n=Upfront.Settings.LayoutEditor.Grid,o=i.layout.get_property_value_by_name("grid")||{column_widths:{},column_paddings:{},baselines:{},type_paddings:{}},r=Upfront.Settings.LayoutEditor.CurrentBreakpoint||Upfront.Settings.LayoutEditor.Grid.size_name,s=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:_.isObject(r)?r.id:r}),a=!1;e.column_width&&(o.column_widths[n.size_name]=e.column_width,s.get_property_value_by_name("column_width")!=e.column_width&&(s.set_property("column_width",e.column_width),a=!0)),"column_padding"in e&&(o.column_paddings[n.size_name]=e.column_padding,s.get_property_value_by_name("column_padding")!=e.column_padding&&(s.set_property("column_padding",e.column_padding),a=!0)),e.baseline&&(e.baseline!=n.baseline&&(clearTimeout(this._load_editor_css),this._load_editor_css=setTimeout(function(){Upfront.Util.post({action:"upfront_load_editor_grid",baseline:e.baseline},"text").success(function(e){t("#upfront-editor-grid-inline").length?t("#upfront-editor-grid-inline").html(e):t("head").append('<style id="upfront-editor-grid-inline">'+e+"</style>")})},1e3)),o.baselines[n.size_name]=e.baseline,s.get_property_value_by_name("baseline")!=e.baseline&&(s.set_property("baseline",e.baseline),a=!0)),e.type_padding&&(o.type_paddings[n.size_name]=e.type_padding,s.get_property_value_by_name("type_padding")!=e.type_padding&&(s.set_property("type_padding",e.type_padding),a=!0)),Upfront.Settings.LayoutEditor.Grid=_.extend(n,e),i.layout.set_property("grid",o),i.layout_view.update_grid_css(),this.init(),i.layout_ready&&(Upfront.Events.trigger("upfront:grid:updated"),Upfront.Events.trigger("upfront:grid:updated:after")),a&&!0===Upfront.plugins.isRequiredByPlugin("update grid")&&s.trigger("change:enabled",s)},time_start:function(t){this.show_debug_element&&console.time(t)},time_end:function(t){this.show_debug_element&&console.timeEnd(t)},set_timeout:function(t){this.timeout=t},set_compare_size:function(t,e){this.compare_col=t,this.compare_row=e},toggle_debug:function(){this.show_debug_element=!this.show_debug_element,this.show_debug_element?this.render_debug():this.delete_debug()},render_debug:function(){var e=this,i=t(Upfront.Settings.LayoutEditor.Selectors.main);$modal=t('<div id="behavior-debug" class="upfront-inline-modal"></div>'),$wrap=t('<div class="upfront-inline-modal-wrap"></div>'),field_delay=new Upfront.Views.Editor.Field.Number({name:"delay",label:Upfront.Settings.l10n.global.behaviors.delay_before_drag,label_style:"inline",min:0,max:2e3,step:1,default_value:300,change:function(){t(".upfront-module.ui-draggable, .upfront-module-group.ui-draggable, .upfront-object.ui-draggable").draggable("option","delay",this.get_value())}}),field_timeout=new Upfront.Views.Editor.Field.Number({name:"timeout",label:Upfront.Settings.l10n.global.behaviors.delay_before_changing_position,label_style:"inline",min:0,max:2e3,step:1,default_value:e.timeout,change:function(){e.timeout=parseInt(this.get_value(),10)}}),field_debug=new Upfront.Views.Editor.Field.Checkboxes({name:"debug",multiple:!1,default_value:!0,values:[{label:Upfront.Settings.l10n.global.behaviors.show_debug_info,value:!0}],change:function(){e.show_debug_element=!!this.get_value()}}),$close=t('<a href="#" class="upfront-close-debug">'+Upfront.Settings.l10n.global.behaviors.close+"</a>"),i.addClass("show-debug"),field_delay.render(),$wrap.append(field_delay.$el),field_timeout.render(),$wrap.append(field_timeout.$el),field_debug.render(),$wrap.append(field_debug.$el),$wrap.append($close),$modal.append($wrap),t("body").append($modal),$modal.css({top:"auto",left:"auto",bottom:0,right:0,position:"fixed"}),$wrap.css({width:360,top:0,padding:"10px",position:"relative"}),$close.on("click",function(){e.show_debug_element=!1,e.delete_debug()})},delete_debug:function(){var e=t(Upfront.Settings.LayoutEditor.Selectors.main);e.removeClass("show-debug"),t("#behavior-debug").remove()}};return n})}(jQuery),function(t){var e={init:function(){t(document).on("keyup",t.proxy(this._dispatch,this))},keys:{a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111},control_keys:{backspace:8,delete:46,down:40,enter:13,space:32,esc:27,tab:9,ctrl:17,meta:91,shift:16,alt:18,right:39,left:37,left_win:91},shortcuts:{"alt+g":"toggle_grid"},_dispatch:function(t){for(var e in this.shortcuts){e=e.replace(/^\s+|\s/g,"");var i=this.shortcuts[e].replace(/^\s+|\s/g,""),n=e.split(",");for(var o in n){var r=n[o].split("+"),s=r.length>1&&r[0].toLowerCase()+"Key",a=r[1];s&&t[s]&&this.keys[a]===t.keyCode?this._call_method(t,i):!1===s&&this.control_keys[a]===t.keyCode&&this._call_method(t,i)}}},_call_method:function(t,e){"function"==typeof this[e]?this[e](t):console.log('Undefined function "{fn}"'.replace("{fn}",e))},show_grid:function(){this.$el.addClass("upfront-icon-grid-active"),t(".upfront-overlay-grid").addClass("upfront-overlay-grid-show"),Upfront.Application.set_gridstate(!0)},hide_grid:function(){this.$el.removeClass("upfront-icon-grid-active"),t(".upfront-overlay-grid").removeClass("upfront-overlay-grid-show"),Upfront.Application.set_gridstate(!1)},toggle_grid:function(t){Upfront.Events.trigger("grid:toggle")}};define("scripts/upfront/behaviors/shortcuts",e)}(jQuery);!function(t){define("behaviors",["scripts/upfront/behaviors/layout-editor","scripts/upfront/behaviors/grid-editor","scripts/upfront/behaviors/shortcuts"],function(t,e,i){return i.init(),{Behaviors:{LayoutEditor:t,GridEditor:e}}})}(jQuery);var DateFormat={};!function(t){var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o=["January","February","March","April","May","June","July","August","September","October","November","December"],r={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"},s=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[Z\-+]?(\d{2}:?\d{2})?/;t.format=function(){function t(t){return e[parseInt(t,10)]||t}function a(t){return i[parseInt(t,10)]||t}function l(t){var e=parseInt(t,10)-1;return n[e]||t}function p(t){var e=parseInt(t,10)-1;return o[e]||t}function d(t){return r[t]||t}function c(t){var e,i,n,o,r,s=t,a="";return-1!==s.indexOf(".")&&(o=s.split("."),s=o[0],a=o[1]),r=s.split(":"),3===r.length?(e=r[0],i=r[1],n=r[2].replace(/\s.+/,"").replace(/[a-z]/gi,""),s=s.replace(/\s.+/,"").replace(/[a-z]/gi,""),{time:s,hour:e,minute:i,second:n,millis:a}):{time:"",hour:"",minute:"",second:"",millis:""}}function u(t,e){for(var i=e-String(t).length,n=0;i>n;n++)t="0"+t;return t}return{parseDate:function(t){var e={date:null,year:null,month:null,dayOfMonth:null,dayOfWeek:null,time:null};if("number"==typeof t)return this.parseDate(new Date(t));if("function"==typeof t.getFullYear)e.year=String(t.getFullYear()),e.month=String(t.getMonth()+1),e.dayOfMonth=String(t.getDate()),e.time=c(t.toTimeString());else if(-1!=t.search(s))values=t.split(/[T\+-]/),e.year=values[0],e.month=values[1],e.dayOfMonth=values[2],e.time=c(values[3].split(".")[0]);else switch(values=t.split(" "),6===values.length&&isNaN(values[5])&&(values[values.length]="()"),values.length){case 6:e.year=values[5],e.month=d(values[1]),e.dayOfMonth=values[2],e.time=c(values[3]);break;case 2:subValues=values[0].split("-"),e.year=subValues[0],e.month=subValues[1],e.dayOfMonth=subValues[2],e.time=c(values[1]);break;case 7:case 9:case 10:e.year=values[3],e.month=d(values[1]),e.dayOfMonth=values[2],e.time=c(values[4]);break;case 1:subValues=values[0].split(""),e.year=subValues[0]+subValues[1]+subValues[2]+subValues[3],e.month=subValues[5]+subValues[6],e.dayOfMonth=subValues[8]+subValues[9],e.time=c(subValues[13]+subValues[14]+subValues[15]+subValues[16]+subValues[17]+subValues[18]+subValues[19]+subValues[20]);break;default:return null}return e.date=new Date(e.year,e.month-1,e.dayOfMonth),e.dayOfWeek=String(e.date.getDay()),e},date:function(e,i){try{var n=this.parseDate(e);if(null===n)return e;for(var o=(n.date,n.year),r=n.month,s=n.dayOfMonth,d=n.dayOfWeek,c=n.time,h="",f="",_="",g=!1,m=0;m<i.length;m++){var v=i.charAt(m),b=i.charAt(m+1);if(g)"'"==v?(f+=""===h?"'":h,h="",g=!1):h+=v;else switch(h+=v,_="",h){case"ddd":f+=t(d),h="";break;case"dd":if("d"===b)break;f+=u(s,2),h="";break;case"d":if("d"===b)break;f+=parseInt(s,10),h="";break;case"D":s=1==s||21==s||31==s?parseInt(s,10)+"st":2==s||22==s?parseInt(s,10)+"nd":3==s||23==s?parseInt(s,10)+"rd":parseInt(s,10)+"th",f+=s,h="";break;case"MMMM":f+=p(r),h="";break;case"MMM":if("M"===b)break;f+=l(r),h="";break;case"MM":if("M"===b)break;f+=u(r,2),h="";break;case"M":if("M"===b)break;f+=parseInt(r,10),h="";break;case"y":case"yyy":if("y"===b)break;f+=h,h="";break;case"yy":if("y"===b)break;f+=String(o).slice(-2),h="";break;case"yyyy":f+=o,h="";break;case"HH":f+=u(c.hour,2),h="";break;case"H":if("H"===b)break;f+=parseInt(c.hour,10),h="";break;case"hh":hour=0===parseInt(c.hour,10)?12:c.hour<13?c.hour:c.hour-12,f+=u(hour,2),h="";break;case"h":if("h"===b)break;hour=0===parseInt(c.hour,10)?12:c.hour<13?c.hour:c.hour-12,f+=parseInt(hour,10),h="";break;case"mm":f+=u(c.minute,2),h="";break;case"m":if("m"===b)break;f+=c.minute,h="";break;case"ss":f+=u(c.second.substring(0,2),2),h="";break;case"s":if("s"===b)break;f+=c.second,h="";break;case"S":case"SS":if("S"===b)break;f+=h,h="";break;case"SSS":f+=c.millis.substring(0,3),h="";break;case"a":f+=c.hour>=12?"PM":"AM",h="";break;case"p":f+=c.hour>=12?"p.m.":"a.m.",h="";break;case"E":f+=a(d),h="";break;case"'":h="",g=!0;break;default:f+=v,h=""}}return f+=_}catch(t){return console&&console.log&&console.log(t),e}},prettyDate:function(t){var e,i,n;return("string"==typeof t||"number"==typeof t)&&(e=new Date(t)),"object"==typeof t&&(e=new Date(t.toString())),i=((new Date).getTime()-e.getTime())/1e3,n=Math.floor(i/86400),isNaN(n)||0>n?void 0:60>i?"just now":120>i?"1 minute ago":3600>i?Math.floor(i/60)+" minutes ago":7200>i?"1 hour ago":86400>i?Math.floor(i/3600)+" hours ago":1===n?"Yesterday":7>n?n+" days ago":31>n?Math.ceil(n/7)+" weeks ago":n>=31?"more than 5 weeks ago":void 0},toBrowserTimeZone:function(t,e){return this.date(new Date(t),e||"MM/dd/yyyy HH:mm:ss")}}}()}(DateFormat),function(t){t.format=DateFormat.format}(jQuery),define("jquery-df",function(){}),function(t,e){function i(e){var i,n=t(e.ownerDocument);return e=t(e),i=e.offset(),{x:i.left+e.outerWidth()/2-n.scrollLeft(),y:i.top+e.outerHeight()/2-n.scrollTop()}}var n=/^key/,o=/^(?:mouse|contextmenu)|click/;t.fn.simulate=function(e,i){return this.each(function(){new t.simulate(this,e,i)})},t.simulate=function(e,i,n){var o=t.camelCase("simulate-"+i);this.target=e,this.options=n,this[o]?this[o]():this.simulateEvent(e,i,n)},t.extend(t.simulate,{keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},buttonCode:{LEFT:0,MIDDLE:1,RIGHT:2}}),t.extend(t.simulate.prototype,{simulateEvent:function(t,e,i){var n=this.createEvent(e,i);this.dispatchEvent(t,e,n,i)},createEvent:function(t,e){return n.test(t)?this.keyEvent(t,e):o.test(t)?this.mouseEvent(t,e):void 0},mouseEvent:function(i,n){var o,r,s,a;return n=t.extend({bubbles:!0,cancelable:"mousemove"!==i,view:window,detail:0,screenX:0,screenY:0,clientX:1,clientY:1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:e},n),document.createEvent?(o=document.createEvent("MouseEvents"),o.initMouseEvent(i,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget||document.body.parentNode),0===o.pageX&&0===o.pageY&&Object.defineProperty&&(r=o.relatedTarget.ownerDocument||document,s=r.documentElement,a=r.body,Object.defineProperty(o,"pageX",{get:function(){return n.clientX+(s&&s.scrollLeft||a&&a.scrollLeft||0)-(s&&s.clientLeft||a&&a.clientLeft||0)}}),Object.defineProperty(o,"pageY",{get:function(){return n.clientY+(s&&s.scrollTop||a&&a.scrollTop||0)-(s&&s.clientTop||a&&a.clientTop||0)}}))):document.createEventObject&&(o=document.createEventObject(),t.extend(o,n),o.button={0:1,1:4,2:2}[o.button]||o.button),o},keyEvent:function(i,n){var o;if(n=t.extend({bubbles:!0,cancelable:!0,view:window,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:e},n),document.createEvent)try{o=document.createEvent("KeyEvents"),o.initKeyEvent(i,n.bubbles,n.cancelable,n.view,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.keyCode,n.charCode)}catch(e){o=document.createEvent("Events"),o.initEvent(i,n.bubbles,n.cancelable),t.extend(o,{view:n.view,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,metaKey:n.metaKey,keyCode:n.keyCode,charCode:n.charCode})}else document.createEventObject&&(o=document.createEventObject(),t.extend(o,n));return(/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())||"[object Opera]"==={}.toString.call(window.opera))&&(o.keyCode=n.charCode>0?n.charCode:n.keyCode,o.charCode=e),o},dispatchEvent:function(t,e,i){t[e]?t[e]():t.dispatchEvent?t.dispatchEvent(i):t.fireEvent&&t.fireEvent("on"+e,i)},simulateFocus:function(){function e(){n=!0}var i,n=!1,o=t(this.target);o.bind("focus",e),o[0].focus(),n||(i=t.Event("focusin"),i.preventDefault(),o.trigger(i),o.triggerHandler("focus")),o.unbind("focus",e)},simulateBlur:function(){function e(){n=!0}var i,n=!1,o=t(this.target);o.bind("blur",e),o[0].blur(),setTimeout(function(){o[0].ownerDocument.activeElement===o[0]&&o[0].ownerDocument.body.focus(),n||(i=t.Event("focusout"),i.preventDefault(),o.trigger(i),o.triggerHandler("blur")),o.unbind("blur",e)},1)}}),t.extend(t.simulate.prototype,{simulateDrag:function(){var t=0,e=this.target,n=this.options,o=i(e),r=Math.floor(o.x),s=Math.floor(o.y),a=n.dx||0,l=n.dy||0,p=n.moves||3,d={clientX:r,clientY:s};for(this.simulateEvent(e,"mousedown",d);t<p;t++)r+=a/p,s+=l/p,d={clientX:Math.round(r),clientY:Math.round(s)},this.simulateEvent(document,"mousemove",d);this.simulateEvent(e,"mouseup",d),this.simulateEvent(e,"click",d)}})}(jQuery),define("jquery-simulate",function(){}),function(t,e){"object"==typeof exports&&t.require?module.exports=e(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define("scripts/backbone-query-parameters/backbone-query-parameters",["underscore","backbone"],function(i,n){return e(i||t._,n||t.Backbone)}):e(_,Backbone)}(this,function(t,e){function i(n,o){function r(t){return String(t).replace(s,encodeURIComponent(s))}var s=e.Router.arrayValueSplit;if(!n)return"";o=o||"";var a=[];return t.each(n,function(e,n){if(n=o+n,t.isString(e)||t.isNumber(e)||t.isBoolean(e)||t.isDate(e))null!=e&&a.push(n+"="+r(encodeURIComponent(e)));else if(t.isArray(e)){for(var l="",p=0;p<e.length;p++){var d=e[p];null!=d&&(l+=s+r(d))}l&&a.push(n+"="+l)}else{var c=i(e,n+".");c&&a.push(c)}}),a.join("&")}function n(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}}function o(e,i){var n=e.split("&");t.each(n,function(t){var e=t.split("=");i(e.shift(),e.join("="))})}var r=/^\?(.*)/,s=/\((.*?)\)/g,a=/(\(\?)?:\w+/g,l=/\*\w+/g,p=/[\-{}\[\]+?.,\\\^$|#\s]/g,d=/^([^\?]*)/,c=/[\:\*]([^\:\?\/]+)/g,u=/^[#\/]|\s+$/g,h=/\/$/;e.Router.arrayValueSplit="|",t.extend(e.History.prototype,{getFragment:function(t,e){if(null==t)if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(h,""),n=this.location.search;t.indexOf(i)||(t=t.substr(i.length)),n&&this._hasPushState&&(t+=n)}else t=this.getHash();return t.replace(u,"")},getQueryParameters:function(e,i){e=this.getFragment(e,i);var s=e.replace(d,""),a=s.match(r);if(a){s=a[1];var l={};return o(s,function(e,i){i=n(i),l[e]?t.isString(l[e])?l[e]=[l[e],i]:l[e].push(i):l[e]=i}),l}return{}}}),t.extend(e.Router.prototype,{initialize:function(t){this.encodedSplatParts=t&&t.encodedSplatParts},_routeToRegExp:function(e){var i=l.exec(e)||{index:-1},n=a.exec(e)||{index:-1},o=e.match(c)||[];e=e.replace(p,"\\$&").replace(s,"(?:$1)?").replace(a,function(t,e){return e?t:"([^\\/\\?]+)"}).replace(l,"([^??]*?)"),e+="(\\?.*)?";var r=new RegExp("^"+e+"$");return i.index>=0&&(n>=0?r.splatMatch=i.index-n.index:r.splatMatch=-1),r.paramNames=t.map(o,function(t){return t.substring(1)}),r.namedParameters=this.namedParameters,r},_extractParameters:function(i,s){var a=i.exec(s).slice(1),l={};a.length>0&&t.isUndefined(a[a.length-1])&&a.splice(a.length-1,1);var p=a.length&&a[a.length-1]&&a[a.length-1].match(r);if(p){var d=p[1],c={};if(d){var u=this;o(d,function(t,e){u._setParamValue(t,e,c)})}a[a.length-1]=c,t.extend(l,c)}var h=a.length;if(i.splatMatch&&this.encodedSplatParts){if(i.splatMatch<0)return a;h-=1}for(var f=0;f<h;f++)t.isString(a[f])&&(a[f]=n(a[f]),i.paramNames&&i.paramNames.length>=f-1&&(l[i.paramNames[f]]=a[f]));return e.Router.namedParameters||i.namedParameters?[l]:a},_setParamValue:function(t,e,i){t=t.replace("[]",""),t=t.replace("%5B%5D","");for(var n=t.split("."),o=i,r=0;r<n.length;r++){var s=n[r];r===n.length-1?o[s]=this._decodeParamValue(e,o[s]):o=o[s]=o[s]||{}}},_decodeParamValue:function(i,o){var r=e.Router.arrayValueSplit;if(r&&i.indexOf(r)>=0){for(var s=i.split(r),a=s.length-1;a>=0;a--)s[a]?s[a]=n(s[a]):s.splice(a,1);return s}return i=n(i),o?t.isArray(o)?(o.push(i),o):[o,i]:i},toFragment:function(e,n){return n&&(t.isString(n)||(n=i(n)),n&&(e+="?"+n)),e}})}),function(t){t.fn.responsiveElement=function(){return this.each(function(){function e(e){var i=t(_.isString(e)&&""!=e?e:".upfront-layout");return o(i)}function i(t){return o(t.$el.parent())}function n(t){if(l.match(/\.upfront-region-container/))e();else{var i=t.$el.hasClass(".upfront-region")?t.$el:t.$el.closest(".upfront-region");o(l.match(/\.upfront-region/)?i.parent():i)}}function o(e,i){var n=!1;if((!p||d)&&(e.find(l+":visible").each(function(){var e=i?t(this).closest(".upfront-module"):t(this),o=t(this).attr("id")||"bind-"+Math.floor(1e5*Math.random()),r=parseFloat(e.css("width")),s=parseFloat(e.css("height"));t(this).attr("id")||t(this).attr("id",o);var a=(c&&r>=c||!c)&&(u&&r<=u||!u)&&(h&&s>=h||!h)&&(f&&s<=f||!f);"undefined"==typeof m[o]&&(m[o]=""),a?""==m[o]&&(m[o]=g.replace(/\( ?this ?\)/gim,"#"+o),n=!0):""!=m[o]&&(m[o]="",n=!0)}),n)){var o=function(){var e,i=t.map(m,function(t,e){return t});t("#"+a).length?t("#"+a).html(i.join("\n")):(e=t('<style id="'+a+'">'+i.join("\n")+"</style>"),t("body").append(e))};v?b.push(o):o()}}function r(t){if("undefined"==typeof t)return!1;var e=/^(\d+)px$/i;return t.match(e)?t.match(e)[1]:void 0}var s,a="responsive-"+Math.floor(1e5*Math.random()),l=t(this).attr("data-bind"),p=1==t(this).attr("data-editor"),d=!1,c=r(t(this).attr("data-min-width")),u=r(t(this).attr("data-max-width")),h=r(t(this).attr("data-min-height")),f=r(t(this).attr("data-max-height")),g=t(this).html(),m={},v=!0,b=[],s=_.throttle(function(i){i.target==this?e():o(t(i.target),!0)},100);t(window).on("load",e),t(window).on("resize",s),t(document).on("upfront-load",function(){"undefined"!=typeof Upfront.Events&&(Upfront.Events.once("layout:render",function(){d=!0,e(),Upfront.Events.on("layout:after_render",function(){e()}),Upfront.Events.on("entity:modules:render_module",i),Upfront.Events.on("entity:regions:render_region",n),Upfront.Events.on("entity:regions:render_container",i),Upfront.Events.on("upfront:wrappers:after_fix_height",i),Upfront.Events.on("entity:region_container:resize_stop",i),Upfront.Events.on("upfront:editor:image_on",function(t){e()}),Upfront.Events.on("upfront:editor:image_align",function(t,i){e()})}),Upfront.Events.on("upfront:renderingqueue:done",function(){v=!1,_.each(b,function(t){t()}),b=[]}),Upfront.Events.on("upfront:renderingqueue:start",function(){v=!0}))})})},t('[type="text/responsive_css"]').responsiveElement();
}(jQuery),define("responsive",function(){}),window.findAndReplaceDOMText=function(){function t(t){return String(t).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function e(){return i.apply(null,arguments)||n.apply(null,arguments)}function i(t,i,o,r,s){if(i&&!i.nodeType&&arguments.length<=2)return!1;var a="function"==typeof o;a&&(o=function(t){return function(e,i){return t(e.text,i.startIndex)}}(o));var l=n(i,{find:t,wrap:a?null:o,replace:a?o:"$"+(r||"&"),prepMatch:function(t,e){if(!t[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(r>0){var i=t[r];t.index+=t[0].indexOf(i),t[0]=i}return t.endIndex=t.index+t[0].length,t.startIndex=t.index,t.index=e,t},filterElements:s});return e.revert=function(){return l.revert()},!0}function n(t,e){return new o(t,e)}function o(t,e){e.portionMode=e.portionMode||r,this.node=t,this.options=e,this.prepMatch=e.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var r="retain",s="first",a=document;({}).toString;return e.Finder=o,o.prototype={search:function(){var e,i=0,n=this.options.find,o=this.getAggregateText(),r=[];if(n="string"==typeof n?RegExp(t(n),"g"):n,n.global)for(;e=n.exec(o);)r.push(this.prepMatch(e,i++));else(e=o.match(n))&&r.push(this.prepMatch(e,0));return r},prepMatch:function(t,e){if(!t[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return t.endIndex=t.index+t[0].length,t.startIndex=t.index,t.index=e,t},getAggregateText:function(){function t(i){if(3===i.nodeType)return i.data;if(e&&!e(i))return"";var n="";if(i=i.firstChild)do n+=t(i);while(i=i.nextSibling);return n}var e=this.options.filterElements;return t(this.node)},processMatches:function(){var t,e,i,n=this.matches,o=this.node,r=this.options.filterElements,s=[],a=o,l=n.shift(),p=0,d=0,c=0,u=[o];t:for(;;){if(3===a.nodeType&&(!e&&a.length+p>=l.endIndex?e={node:a,index:c++,text:a.data.substring(l.startIndex-p,l.endIndex-p),indexInMatch:p-l.startIndex,indexInNode:l.startIndex-p,endIndexInNode:l.endIndex-p,isEnd:!0}:t&&s.push({node:a,index:c++,text:a.data,indexInMatch:p-l.startIndex,indexInNode:0}),!t&&a.length+p>l.startIndex&&(t={node:a,index:c++,indexInMatch:0,indexInNode:l.startIndex-p,endIndexInNode:l.endIndex-p,text:a.data.substring(l.startIndex-p,l.endIndex-p)}),p+=a.data.length),i=1===a.nodeType&&r&&!r(a),t&&e){if(a=this.replaceMatch(l,t,s,e),p-=e.node.data.length-e.endIndexInNode,t=null,e=null,s=[],l=n.shift(),c=0,d++,!l)break}else if(!i&&(a.firstChild||a.nextSibling)){a.firstChild?(u.push(a),a=a.firstChild):a=a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a=u.pop(),a===o)break t}}},revert:function(){for(var t=this.reverts.length;t--;)this.reverts[t]();this.reverts=[]},prepareReplacementString:function(t,e,i,n){var o=this.options.portionMode;return o===s&&e.indexInMatch>0?"":(t=t.replace(/\$(\d+|&|`|')/g,function(t,e){var n;switch(e){case"&":n=i[0];break;case"`":n=i.input.substring(0,i.startIndex);break;case"'":n=i.input.substring(i.endIndex);break;default:n=i[+e]}return n}),o===s?t:e.isEnd?t.substring(e.indexInMatch):t.substring(e.indexInMatch,e.indexInMatch+e.text.length))},getPortionReplacementNode:function(t,e,i){var n=this.options.replace||"$&",o=this.options.wrap;if(o&&o.nodeType){var r=a.createElement("div");r.innerHTML=o.outerHTML||(new XMLSerializer).serializeToString(o),o=r.firstChild}if("function"==typeof n)return n=n(t,e,i),n&&n.nodeType?n:a.createTextNode(String(n));var s="string"==typeof o?a.createElement(o):o;return n=a.createTextNode(this.prepareReplacementString(n,t,e,i)),n.data&&s?(s.appendChild(n),s):n},replaceMatch:function(t,e,i,n){var o,r,s=e.node,l=n.node;if(s===l){var p=s;e.indexInNode>0&&(o=a.createTextNode(p.data.substring(0,e.indexInNode)),p.parentNode.insertBefore(o,p));var d=this.getPortionReplacementNode(n,t);return p.parentNode.insertBefore(d,p),n.endIndexInNode<p.length&&(r=a.createTextNode(p.data.substring(n.endIndexInNode)),p.parentNode.insertBefore(r,p)),p.parentNode.removeChild(p),this.reverts.push(function(){o===d.previousSibling&&o.parentNode.removeChild(o),r===d.nextSibling&&r.parentNode.removeChild(r),d.parentNode.replaceChild(p,d)}),d}o=a.createTextNode(s.data.substring(0,e.indexInNode)),r=a.createTextNode(l.data.substring(n.endIndexInNode));for(var c=this.getPortionReplacementNode(e,t),u=[],h=0,f=i.length;h<f;++h){var _=i[h],g=this.getPortionReplacementNode(_,t);_.node.parentNode.replaceChild(g,_.node),this.reverts.push(function(t,e){return function(){e.parentNode.replaceChild(t.node,e)}}(_,g)),u.push(g)}var m=this.getPortionReplacementNode(n,t);return s.parentNode.insertBefore(o,s),s.parentNode.insertBefore(c,s),s.parentNode.removeChild(s),l.parentNode.insertBefore(m,l),l.parentNode.insertBefore(r,l),l.parentNode.removeChild(l),this.reverts.push(function(){o.parentNode.removeChild(o),c.parentNode.replaceChild(s,c),r.parentNode.removeChild(r),m.parentNode.replaceChild(l,m)}),m}},e}(),define("findandreplace",function(){}),function(t){define("upfront/objects/loading",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){this.init_property("type","LoadingModel"),this.init_property("view_class","LoadingView"),this.init_property("element_id",Upfront.Util.get_unique_id("please_wait")),this.init_property("content","Please, wait..."),this.init_property("class","c24")}}),e=Upfront.Views.ObjectView.extend({model:t,get_content_markup:function(){return'<img src="'+Upfront.Settings.root_url+'/img/loading.gif" /> <i>'+this.model.get_content()+"</i>"}});Upfront.Models.LoadingModel=t,Upfront.Views.LoadingView=e})}(jQuery),function(){define("objects",["upfront/objects/loading"],function(){if(!Upfront||!Upfront.Application.LayoutEditor||!Upfront.Application.LayoutEditor.add_object)return Upfront.Util.log("Unable to add object"),!1})}(),function(t){define("scripts/upfront/upfront-media/insert-options-item-control",[],function(){var t=Upfront.Settings.l10n.media,e={uf_insert:"image_insert",wp_insert:"wp_default"},i=Backbone.View.extend({initialize:function(t){},render:function(){var i=new Upfront.Views.Editor.Field.Radios({label:t.insert_options,model:this.model,name:"insert_option",layout:"horizontal-inline",default_value:this.model.at(0).get("insert_option")||"image_insert",values:[{label:t.image_inserts,value:e.uf_insert},{label:t.wp_default,value:e.wp_insert}],change:function(t){this.model.at(0).set("insert_option",t)}});return i.render(),this.$el.html(i.el),this}});return{Options_Control:i,INSERT_OPTIONS:e}})}(jQuery),function(t,e){define("media",["scripts/upfront/upfront-media/insert-options-item-control","scripts/perfect-scrollbar/perfect-scrollbar"],function(i,n){var o={FULL:"full",to_size:function(t){return t.width+"x"+t.height}},r=Upfront.Settings.l10n.media,s=i.INSERT_OPTIONS,a=Backbone.Model.extend({defaults:{thumbnail:"<span class='upfront-image-upload-placeholder'></span>",insert_option:"image_insert"}}),l=Backbone.Collection.extend({defaults:{thumbnail:"",title:""}}),p=Backbone.Collection.extend({model:a,initialize:function(){Upfront.Events.on("media_manager:media:labels_loaded",this.global_labels_loaded,this)},get_shared_labels:function(){var t=h.get("label"),e=[],i=[],n={};return this.each(function(t){n[t.get("ID")]=t.get("labels")||[]}),e=_.intersection.apply(this,_(n).values()),t.each(function(t){(e.indexOf(t.get("value"))>=0||e.indexOf(parseInt(t.get("value"),10))>=0)&&i.push(t)}),i},get_additional_sizes:function(){if(!h.multiple_sizes)return!1;var t=this.invoke("get","additional_sizes"),e=[];return _(t).each(function(t,i){var n=[];i||(e=_(t).map(function(t){return o.to_size(t)})),_(t).each(function(t){n.push(o.to_size(t))}),e=_.intersection(e,n)}),e.push(o.FULL),e},is_used_label:function(t){return _(this.get_shared_labels()).invoke("get","value").indexOf(t.get("value"))>=0},update_label_state:function(t){return this.is_used_label(t)?this.disassociate_label(t):this.associate_label(t)},associate_label:function(t){this._update_label("",t)},disassociate_label:function(t){this._update_label("dis",t)},_update_label:function(t,e){t=t||"";var i=this,n=e.get("value"),o={action:"upfront-media-"+t+"associate_label",term:n,post_ids:this.invoke("get","ID")};Upfront.Util.post(o).success(function(t){i.each(function(e){var i=t.data[e.get("ID")];i&&e.set({labels:i},{silent:!0})}),i.trigger("change")})},add_new_label:function(t){var e=this,i={action:"upfront-media-add_label",term:t,post_ids:this.invoke("get","ID")};Upfront.Util.post(i).success(function(t){e.each(function(e){var i=t.data[e.get("ID")];i&&e.set({labels:i},{silent:!0})}),Upfront.Events.trigger("media_manager:media:labels_updated"),e.trigger("change")})},delete_media_items:function(){var t=this,e={action:"upfront-media-remove_item",post_ids:this.invoke("get","ID")};Upfront.Util.post(e).success(function(e){t.reset([]),Upfront.Events.trigger("media_manager:media:list",h)})},delete_theme_items:function(){var t=this,e={action:"upfront-media-remove_theme_item",post_ids:this.invoke("get","post_title")};Upfront.Util.post(e).success(function(e){t.reset([]),Upfront.Events.trigger("media_manager:media:list",h)})},global_labels_loaded:function(){this.trigger("change")}}),d=Backbone.Model.extend({}),c=Backbone.Collection.extend({model:d}),u=Backbone.Model.extend({CONST:{CUTOFF_SIZE:8,CUTOFF_BIT:3},labels_cache:!1,default_media_types:["images","videos","audios","other"],allowed_media_types:[],image_sizes:!0,showing_titles:!0,current_keys:[],current_models:[],current_page:1,max_pages:1,max_items:1,media_limit:20,initialize:function(){this.to_defaults(),Upfront.Events.on("media_manager:media:filters_updated",this.update_active_filters,this),Upfront.Events.on("media_manager:media:labels_updated",this.reload_labels,this),Upfront.Events.on("media_manager:media:toggle_titles",this.toggle_titles,this)},to_defaults:function(){var t=new c([]),e=this.allowed_media_types.indexOf("other")>=0;this.allowed_media_types.length||(this.allowed_media_types=this.default_media_types),this.allowed_media_types.indexOf("images")>=0&&t.add(new d({filter:r.filter.images,value:"images",state:!e}),{silent:!0}),this.allowed_media_types.indexOf("videos")>=0&&t.add(new d({filter:r.filter.videos,value:"videos",state:!e}),{silent:!0}),this.allowed_media_types.indexOf("audios")>=0&&t.add(new d({filter:r.filter.audios,value:"audios",state:!e}),{silent:!0}),this.allowed_media_types.indexOf("other")>=0&&t.add(new d({filter:r.filter.all,value:"other",state:e}),{silent:!0}),this.set("type",t,{silent:!0}),this.set("recent",new c([new d({filter:"5",value:5,state:!1}),new d({filter:"10",value:10,state:!1}),new d({filter:"20",value:20,state:!1}),new d({filter:"40",value:40,state:!1}),new d({filter:"100",value:100,state:!1})]),{silent:!0}),this.set("order",new c([new d({filter:r.filter.newest,value:"date_desc",state:!0}),new d({filter:r.filter.oldest,value:"date_asc",state:!1}),new d({filter:r.filter.a_z,value:"title_asc",state:!1}),new d({filter:r.filter.z_a,value:"title_desc",state:!1})]),{silent:!0}),this.set({search:new c([])},{silent:!0}),this.themeImages=!1,this.current_page=1,this.set_labels_to_defaults()},set_max_pages:function(t){this.max_pages=t||1},set_max_items:function(t){this.max_items=t||1},prev_page:function(){if(this.current_page>1)return this.set_page(this.current_page-1)},next_page:function(){if(this.current_page<this.max_pages)return this.set_page(this.current_page+1)},set_page:function(t){return!!t&&(t>=1&&t<this.max_pages&&(t!=this.current_page&&(this.current_page=t,!0)))},toggle_titles:function(){this.showing_titles=!this.showing_titles},set_labels_to_defaults:function(){if(this.labels_cache){var t=[];_(this.labels_cache).each(function(e){t.push(new d({filter:e.name,value:e.term_id,state:!1}))}),this.set("label",new c(t),{silent:!0}),Upfront.Events.trigger("media_manager:media:labels_loaded")}else this.reload_labels()},reload_labels:function(){var t=this;Upfront.Util.post({action:"upfront-media-get_labels"}).success(function(e){e.data&&(t.labels_cache=e.data,t.set_labels_to_defaults())})},update_active_filters:function(t,e){if(t&&this.get(t)){var i=e&&e.get?e.get(t).toArray():e,n=this.get(t);_(i).each(function(t){if(t.get("state")){var e=n.where({filter:t.get("filter")});e.length&&e[0].set({state:t.get("state")},{silent:!0})}})}else this.to_defaults(),Upfront.Events.trigger("media_manager:media:filters_reset");Upfront.Events.trigger("media_manager:media:list",this)},to_request_json:function(){var t={},e=this;return _(this.attributes).each(function(i,n){var o=e.get(n).where({state:!0});t[n]=_(o).invoke("get","value")}),t.page=this.current_page,t},to_list:function(){var t={},e=this;return _(this.attributes).each(function(i,n){var o=e.get(n).where({state:!0}),r=[];r=_(o).filter(function(t){var e=t.get("value");return"other"!==e&&"date_desc"!==e}),t[n]=_(r).invoke("get","filter")}),t},has_upload:function(){return!!Upfront.Settings.Application.PERMS.UPLOAD&&(!this.themeImages||!0===Upfront.plugins.isRequiredByPlugin("media filter upload"))}}),h=new u,f=Backbone.View.extend({className:"upfront-media-controls",is_search_active:!1,initialize:function(t){Upfront.Events.on("media:item:selection_changed",this.switch_controls,this),Upfront.Events.on("media:search:requested",this.switch_to_search,this),this.options=t.options},render:function(){this.render_filters()},render_filters:function(){this.control=this.is_search_active?new k:new $,this.control.render(),this.$el.empty().append(this.control.$el),this.is_search_active?this.$el.removeClass("upfront-media-controls-search-selected").addClass("upfront-media-controls-search"):this.$el.removeClass("upfront-media-controls-search")},render_media:function(t){var e=new b({model:new p(t),options:this.options});e.render(),this.$el.empty(),this.is_search_active?(this.control=new k,this.control.render(),this.$el.append(this.control.$el),this.$el.removeClass("upfront-media-controls-search").addClass("upfront-media-controls-search-selected")):this.$el.removeClass("upfront-media-controls-search-selected"),this.$el.append(e.$el)},switch_controls:function(t){var e=t.where({selected:!0});e.length?this.render_media(e):this.render_filters()},switch_to_search:function(t){this.is_search_active=t&&t.get("state"),this.render_filters()},remove:function(){this.control&&this.control.remove(),Upfront.Events.off("media:item:selection_changed",this.switch_controls),Upfront.Events.off("media:search:requested",this.switch_to_search)}}),g=Backbone.View.extend({className:"upfront-media-aux_controls",initialize:function(){Upfront.Events.on("media:item:selection_changed",this.switch_controls,this)},render:function(){this.render_selection()},render_selection:function(){var t=new m({model:this.model});t.render(),this.$el.empty().append(t.$el),this.$el.removeClass("upfront-media-aux_controls-has-select")},render_delete:function(t){var e=new v({model:new p(t)});e.render(),this.render_selection(),this.$el.append(e.$el),this.$el.addClass("upfront-media-aux_controls-has-select")},switch_controls:function(t){var e=t&&t.where?t.where({selected:!0}):[];e.length?this.render_delete(e):this.render_selection()},remove:function(){Upfront.Events.off("media:item:selection_changed",this.switch_controls)}}),m=Backbone.View.extend({className:"select_control_container",events:{"click a.none":"select_none","click a.all":"select_all"},initialize:function(){this.display_values=[{label:"20",value:20},{label:"40",value:40},{label:"60",value:60},{label:"80",value:80},{label:"100",value:100}]},render:function(){var t=this;t.$el.empty().append(r.select+' <a href="#all" class="all">'+r.all+'</a>&nbsp;|&nbsp;<a href="#none" class="none">'+r.none+"</a>"),t.select_display_field=new Upfront.Views.Editor.Field.Select({label:r.display+":",className:"upfront-field-wrap upfront-field-wrap-select upfront-filter_display_control",name:"display-selection",width:"70px",values:t.display_values,multiple:!1,default_value:h.media_limit,change:function(){t.select_display(this.get_value())}}),t.select_display_field.render(),t.$el.append(t.select_display_field.$el)},select_display:function(t){h.media_limit=t,Upfront.Events.trigger("media_manager:media:list",h)},select_none:function(t){t.preventDefault(),t.stopPropagation();var e=this.model.where({selected:!0});if(e.length){this.model.each(function(t){t.set({selected:!1},{silent:!0})}),this.model.trigger("change"),Upfront.Events.trigger("media:item:selection_changed",this.model);var i=new p(h.current_models);Upfront.Events.trigger("media:item:selection_changed",i)}},select_all:function(t){t.preventDefault(),t.stopPropagation();var e=[];this.model.each(function(t){t.set({selected:!0},{silent:!0}),e.push(t)}),this.model.trigger("change"),Upfront.Events.trigger("media:item:selection_changed",this.model);var i=new p(h.current_models);Upfront.Events.trigger("media:item:selection_changed",i)}}),v=Backbone.View.extend({className:"delete_control_container",events:{click:"delete_selection"},render:function(){this.$el.empty().append('<a href="#delete">'+r.del_command+"</a>")},delete_selection:function(t){if(t.preventDefault(),t.stopPropagation(),confirm(r.confirm_delete_items)){var e=!1;if(this.model.each(function(t){t.get("parent")&&(e=!0)}),!e||e&&confirm(r.item_in_use_nag))return h.current_keys=[],h.current_models=[],h.themeImages?this.model.delete_theme_items():this.model.delete_media_items()}}}),b=Backbone.View.extend({className:"upfront-item-control",options:{insert_options:!1,hide_sizes:!1},templates:{caption:_.template('<label class="upfront-field-label upfront-field-label-block">{{title}}</label>'),shared_label:_.template('<a href="#remove" class="upfront-icon upfront-icon-media-label-delete" data-idx="{{value}}">{{filter}}</a>'),additional_size:_.template('<option value="{{size}}">{{size}}</option>')},events:{"click .existing_labels a":"drop_label"},initialize:function(t){this.model.on("change",this.render,this),this.options=_.extend(this.options,t.options)},render:function(){var t=this,e=_(["change_title","size_hints","add_labels","existing_labels","insert_options","additional_sizes"]),i=_(["render_title","render_size_hint","render_labels_adding","render_shared_labels","render_additional_sizes","render_insert_options"]);this.$el.empty(),this.options.insert_options||(e=_(e.reject(function(t){return"insert_options"===t})),i=_(i.reject(function(t){return"render_insert_options"===t}))),_.indexOf(this.options.media_type,"videos")!==-1&&(e=_(e.reject(function(t){return"additional_sizes"===t})),i=_(i.reject(function(t){return"render_additional_sizes"===t}))),e.each(function(e){t.$el.append('<div class="'+e+'" />')}),i.each(function(e){t[e]()})},render_size_hint:function(){var i=this.$el.find(".size_hints");if(i.empty(),1===this.model.length){var n=this.model.at(0).get("image"),o=t('<div class="upfront-size-hints upfront-field-wrap upfront-field-wrap-text"><label class="upfront-field-label upfront-field-label-block">'+r.natural_size+"</label></div>");n!==e&&(o.append('<span class="upfront-size-hint-width">'+r.width_label+": <span>"+n.width+r.px_label+"</span></span>"),o.append('<span class="upfront-size-hint-height">'+r.height_label+": <span>"+n.height+r.px_label+"</span></span>"),i.append(o))}},render_title:function(){var t=this,e=this.$el.find(".change_title");e.empty(),this.model.length>1?e.append('<span class="selected_length">'+r.files_selected.replace(/%d/,this.model.length)+"</span>"):(this.title_field=new Upfront.Views.Editor.Field.Text({model:this.model.at(0),label:r.media_title,name:"post_title",change:function(){t.change_title()}}),this.title_field.render(),e.append(this.title_field.$el))},render_labels_adding:function(){var t=this.$el.find(".add_labels"),e=new y({model:this.model});t.empty().append(this.templates.caption({title:r.add_labels})),e.render(),t.append(e.$el),this.$el.on("click",function(t){t.stopPropagation(),e.trigger("filters:selection:click")})},render_shared_labels:function(){var t=this,e=this.$el.find(".existing_labels"),i=this.model.get_shared_labels(),n=i.length>1?r.current_labels:"";e.empty().append(this.templates.caption({title:n})),_(i).each(function(i){e.append(t.templates.shared_label(i.toJSON()))})},render_additional_sizes:function(){var t=this,e=this.$el.find(".additional_sizes"),i=this.model.get_additional_sizes(),n=r.additional_sizes,a=[];if(e.empty(),this.options.insert_options&&this.model.at(0).get("insert_option")===s.wp_insert||!this.options.hide_sizes&&!this.options.insert_options){if(!i.length)return!1;_(i).each(function(t){a.push({label:t===o.FULL?r.size_full:t,value:t})}),this.size_field=new Upfront.Views.Editor.Field.Select({model:this.model.at(0),label:n,name:"selected_size",width:"100%",values:a,default_value:o.FULL,change:function(){t.select_size()}}),this.size_field.render(),e.append(this.size_field.$el),this.size_field.$el.on("click",function(t){t.stopPropagation()})}this.model.length<2&&this.add_url_label(e)},add_url_label:function(t){var e=new Upfront.Views.Editor.Field.Text({model:this.model.at(0),label:r.url,name:"document_url"});e.render(),t.append(e.$el)},select_size:function(t){var e=this.size_field.get_value()||o.FULL;this.model.each(function(t){t.set({selected_size:e},{silent:!0})})},change_title:function(t){var e=this.model.at(0);e.set({post_title:this.title_field.get_value()});var i={action:"upfront-media-update_media_item",data:e.toJSON()};Upfront.Util.post(i).done(function(){e.trigger("change")}),e.trigger("appearance:update")},drop_label:function(e){e.preventDefault(),e.stopPropagation();var i=t(e.target),n=i.attr("data-idx"),o=this.model.get_shared_labels(),r=_(o).invoke("get","value").indexOf(n),s=!!(r>=0&&o[r])&&o[r];s&&this.model.update_label_state(s)},render_insert_options:function(){var t=this.$(".insert_options"),e=new i.Options_Control({model:this.model});e.render(),t.html(e.el)}}),y=Backbone.View.extend({className:"upfront-additive_multiselection",selection:"",events:{"click :text":"stop_prop","click .title":"show_labels","keyup .search_labels :text":"update_selection","click .add_labels a":"add_new_labels"},stop_prop:function(t){t.stopPropagation()},show_labels:function(t){t.stopPropagation(),t.preventDefault(),this.$el.addClass("active")},hide_labels:function(t){this.$el.removeClass("active")},render:function(){this.$el.empty().append('<div class="title">'+r.please_select_labels+"</div>").append('<div class="search_labels" />').append('<div class="labels_list"><ul></ul></div>').append('<div class="add_labels" />'),this.render_search(),this.render_labels(),this.render_addition(),this.on("filters:selection:click",function(){this.hide_labels()},this)},render_search:function(){var t=this.$el.find(".search_labels");t.empty().append('<input type="text" class="upfront-field upfront-field-text" value="'+this.selection+'"/>')},render_labels:function(){var t=this,e=this.$el.find(".labels_list ul"),i=h.get("label"),n=this.model.get_shared_labels(),o=!1;e.empty(),i.each(function(i){var r=new w({model:i});r.shared=n,r.media_items=t.model,r.selection=t.selection,r.render(),r.$el.find("input").size()>0&&(o=!0,e.append(r.$el))}),o?e.removeClass("empty"):e.addClass("empty")},render_addition:function(){var t=this.$el.find(".add_labels");t.empty(),this.selection?t.append('<b class="add_value">'+this.selection+'</b> <a class="add_link" href="#add">'+r.add+"</a>").removeClass("empty"):t.addClass("empty")},update_selection:function(t){t.preventDefault(),t.stopPropagation();var e=this.$el.find(".search_labels :text"),i=e.val();this.selection=i,this.render_labels(),this.render_addition()},add_new_labels:function(t){t.preventDefault(),t.stopPropagation();var e=this.$el.find(".search_labels :text"),i=e.val();this.model.add_new_label(i)}}),w=Backbone.View.extend({tagName:"li",events:{click:"toggle_label_assignment"},render:function(){var t=this.media_items.is_used_label(this.model),e=_.template('<input type="checkbox" id="{{id}}" class="upfront-field-checkbox" value="{{value}}" checked />'),i=_.template('<input type="checkbox" id="{{id}}" class="upfront-field-checkbox" value="{{value}}" />'),n=_.template('<label for="{{id}}">{{name}}</label>'),o=this.model.get("filter")||"",r=!!this.selection&&new RegExp("^("+this.selection+")","i"),s=this.model.toJSON();return this.$el.empty(),!!o.match(r)&&(s.id=this.cid,s.name=o.replace(r,'<span class="selection">$1</span>'),void this.$el.append(n(s)).append((t?e:i)(s)))},toggle_label_assignment:function(t){t.preventDefault(),t.stopPropagation(),this.media_items.update_label_state(this.model)}}),k=Backbone.View.extend({className:"upfront-search_filter-control",events:{"click a":"clear_search"},render:function(){var t=h.get("search").first(),e=t.toJSON();e.total=h.max_items,this.$el.empty().append(_.template(r.showing_total_results+' <b class="search-text">{{value}}</b> <a href="#clear" class="clear_search">'+r.clear_search+"</a>",e))},clear_search:function(t){t.preventDefault(),t.stopPropagation();var e=new d({filter:!1,value:!1,state:!1});h.set({search:new c([e])}),Upfront.Events.trigger("media_manager:media:list",h),Upfront.Events.trigger("media:search:requested",e)}}),$=Backbone.View.extend({className:"upfront-filter-control",events:{click:"stop_prop"},stop_prop:function(t){t.stopPropagation(),this.filter_selection&&this.filter_selection.trigger("filters:outside_click")},initialize:function(){this.filter_selection=new U,this.filters_selected=new x({model:h})},render:function(){this.filter_selection.render(),this.filters_selected.render(),this.$el.empty().append(this.filter_selection.$el).append(this.filters_selected.$el)},toggle_titles:function(t){t.stopPropagation(),Upfront.Events.trigger("media_manager:media:toggle_titles")},remove:function(){this.filters_selected.remove()}}),x=Backbone.View.extend({className:"upfront-filter_selected-control",events:{"click a.filter":"drop_filter","click a.all_filters":"drop_all"},initialize:function(){Upfront.Events.on("media_manager:media:list",this.set_filters,this)},render:function(){this.$el.empty();var t=this,e=_(this.model.to_list()),i=_([]),n=_.template(' <a href="#" class="filter upfront-icon upfront-icon-media-label-delete" data-type="{{type}}" data-filter="{{filter}}">{{filter}}</a>');return e.each(function(t,e){_(t).each(function(t){i.push({filter:t,type:e})})}),!!i.size()&&(this.$el.append('<label class="upfront-field-label upfront-field-label-block">'+r.active_filters+"</label>"),i.each(function(e){t.$el.append(n(e))}),void this.$el.append(" <a href='#' class='all_filters'>"+r.clear_all_filters+"</a>"))},set_filters:function(t){this.model=t,this.render()},drop_filter:function(e){e.preventDefault(),e.stopPropagation();var i=t(e.target),n=this.model,o=i.attr("data-type"),r=i.attr("data-filter");if(o&&n.get(o)){var s=n.get(o).where({filter:r});s&&s.length&&_(s).invoke("set",{state:!1},{silent:!0})}else _(this.model.attributes).each(function(t,e){var i=n.get(e).where({filter:r});i.length&&(o=e,_(i).invoke("set",{state:!1},{silent:!0}))});Upfront.Events.trigger("media_manager:media:filters_updated",o,this.model)},drop_all:function(t){t.preventDefault(),t.stopPropagation(),Upfront.Events.trigger("media_manager:media:filters_updated",!1,!1)},remove:function(){Upfront.Events.off("media_manager:media:list",this.set_filters)}}),U=Backbone.View.extend({className:"upfront-filter_selection-control clearfix",initialize:function(){this.controls=_([new M,new j,new O]),this.on("filters:outside_click",function(){this.controls.each(function(t){t.trigger("filters:selection:click")})},this)},render:function(){var t=this,e=(_.template("<li style='display:none'><a href='#' data-idx='{{idx}}'>{{name}}</a></li>"),[{label:r.select_filter,value:"false"}]);this.controls.each(function(t,i){e.push({label:t.get_name(),value:i})}),this.$el.empty(),this.$el.append('<div class="upfront-filter_control" />'),this.$control=this.$el.find("div.upfront-filter_control"),this.control_field=new Upfront.Views.Editor.Field.Select({label:r.filter_label,name:"filter-selection",width:"100%",values:e,multiple:!1,default_value:"false",change:function(){t.select_control(this.get_value())}}),this.control_field.render(),this.$el.prepend(this.control_field.$el)},select_control:function(t){if(this.$control.empty(),"false"===t)return!1;var e=this.controls.toArray()[t];return e.render(),this.$control.append(e.$el),!1}}),E=Backbone.View.extend({tagName:"ul",get_name:function(){return this.filter_name},initialize_model:function(){this.model=h.get(this.filter_type),this.model.on("change",this.apply_changes,this)},render:function(){var t=this;this.$el.empty(),this.model.each(function(e){if(t.allowed_values&&t.allowed_values.indexOf(e.get("value"))<0)return!1;var i=new T({model:e});i.render(),t.$el.append(i.$el)})},apply_changes:function(){var t={};t=this.model.where({state:!0}),Upfront.Events.trigger("media_manager:media:filters_updated",this.filter_type,t)},update_selection:function(){var t=h.get(this.filter_type);return t?this.model.each(function(e){var i=t.where({filter:e.get("filter"),state:!0});e.set({state:!!i.length})}):this.model.invoke("set",{state:!1}),this.render(),!1}}),S=E.extend({tagName:"div",className:"upfront-additive_multiselection",events:{click:"stop_prop","keyup :text.filter":"show_matching_labels"},stop_prop:function(t){t.stopPropagation(),this.$el.addClass("active")},update_state:function(t){this.$el.removeClass("active")},render:function(){var t=this.selection||"";this.$el.empty().append('<div class="title">'+r.please_select_labels+"</div>").append('<input type="text" class="filter upfront-field upfront-field-text" value="'+t+'" />').append('<div class="labels_list"><ul></ul></div>'),this.render_items(),this.on("filters:selection:click",function(){this.update_state()},this)},render_items:function(){var t=this,e=this.$el.find("div.labels_list ul");return e.empty(),!!this.$el.is(".active")&&void this.model.each(function(i){if(t.allowed_values&&t.allowed_values.indexOf(i.get("value"))<0)return!1;var n=new I({model:i});n.selection=t.selection,n.render(),i.on("change:state",t.update_state,t),e.append(n.$el)})},show_matching_labels:function(t){var e=this.$el.find(":text.filter"),i=e.val();this.selection=i,this.render_items()}}),C=E.extend({render:function(){var t=this;this.$el.empty(),this.model.each(function(e){if(t.allowed_values&&t.allowed_values.indexOf(e.get("value"))<0)return!1;var i=new z({model:e});i.render(),t.$el.append(i.$el),i.on("model:unique_state:change",t.change_state,t)})},change_state:function(t){this.model.each(function(e){e.get("value")!=t.get("value")&&e.set({state:!1},{silent:!0})}),t.set({state:!0},{silent:!0}),this.apply_changes(),this.render()}}),T=Backbone.View.extend({tagName:"li",events:{click:"on_click"},initialize:function(){this.model.on("change",this.render,this)},render:function(){var t=this.model.get("filter");return"other"!==this.model.get("value")&&(this.model.get("state")&&(t="<b>"+t+"</b>"),void this.$el.empty().append(t))},on_click:function(t){t.preventDefault(),t.stopPropagation(),this.model.set({state:!this.model.get("state")})}}),z=T.extend({on_click:function(t){t.preventDefault(),t.stopPropagation(),this.model.set({state:!this.model.get("state")},{silent:!0}),this.trigger("model:unique_state:change",this.model)}}),I=T.extend({render:function(){var t=_.template('<input type="checkbox" for="{{id}}" class="upfront-field-checkbox" name="{{filter}}" value="{{value}}" checked />'),e=_.template('<input type="checkbox" for="{{id}}" class="upfront-field-checkbox" name="{{filter}}" value="{{value}}" />'),i=_.template('<label for="{{id}}">{{name}}</label>'),n=this.model.get("filter")||"",o=!!this.selection&&new RegExp("^("+this.selection+")","i"),r=this.model.toJSON();return this.$el.empty(),!(o&&!n.match(o))&&(r.id=this.cid,r.name=n.replace(o,'<span class="selection">$1</span>'),void this.$el.append(i(r)).append((this.model.get("state")?t:e)(r)))}}),P=(Backbone.View.extend({render:function(){var t=this;this.$el.empty(),this.model.each(function(e){var i=new P({model:e});i.render(),t.$el.append(i.$el)})}}),Backbone.View.extend({render:function(){this.$el.empty().append(this.model.get("filter"));
}})),M=E.extend({initialize:function(){this.filter_name=r.media_type,this.filter_type="type",this.initialize_model(),Upfront.Events.on("media_manager:media:filters_updated",this.update_selection,this),Upfront.Events.on("media_manager:media:filters_reset",this.initialize_model,this)},apply_changes:function(t){var e=(this.model.where({state:!0}),this.model.where({value:"other"})),i=t.previousAttributes();if(e.length){if(e=e[0],i&&i.value&&"other"===i.value){var n=!!i.state;this.model.each(function(t){t.set({state:n},{silent:!0})}),e.set({state:!n},{silent:!0})}else e.get("state")&&e.set({state:!1},{silent:!0});E.prototype.apply_changes.call(this)}}}),j=C.extend({allowed_values:["title_desc","title_asc"],initialize:function(){this.filter_name=r.file_name,this.filter_type="order",this.initialize_model(),Upfront.Events.on("media_manager:media:filters_updated",this.update_selection,this),Upfront.Events.on("media_manager:media:filters_reset",this.initialize_model,this)}}),O=S.extend({initialize:function(){this.filter_name=r.labels,this.filter_type="label",this.initialize_model(),Upfront.Events.on("media_manager:media:filters_updated",this.update_selection,this),Upfront.Events.on("media_manager:media:filters_reset",this.initialize_model,this),Upfront.Events.on("media_manager:media:labels_loaded",this.reinitialize_model,this)},reinitialize_model:function(){this.initialize_model(),this.render()}}),D=Backbone.View.extend({events:{"click .library":"switch_to_library","click .upload":"switch_to_upload","click .shortcode":"switch_to_shortcode","click .markup":"switch_to_markup"},switch_template:_.template('<ul class="upfront-tabs upfront-media_manager-tabs"> <li class="library">'+r.library+'</li> <li class="embed">'+r.embed+"</li> </ul> "),upload_template:_.template('<button type="button" class="upload">'+r.upload+"</button>"),initialize:function(){Upfront.Events.on("media_manager:media:show_library",this.switch_to_library,this)},render:function(){this.$el.empty().append(this.switch_template({})+(h.has_upload()?this.upload_template({}):"")),this.$el.addClass("clearfix"),this.switch_to_library()},remove:function(){this.undelegateEvents(),this.$el.empty()},switch_to_library:function(t){var e={};this.$el.find("li").removeClass("active").filter(".library").addClass("active"),t&&t.preventDefault?(t.preventDefault(),t.stopPropagation()):t&&(e=t),this.trigger("media_manager:switcher:to_library",e)},switch_to_embed:function(t){return!1},switch_to_upload:function(t){t.preventDefault(),t.stopPropagation(),this.trigger("media_manager:switcher:to_upload")},switch_to_shortcode:function(t){t.preventDefault(),t.stopPropagation(),this.$el.find("li").removeClass("active").filter(".shortcode").addClass("active"),this.trigger("media_manager:switcher:to_shortcode")},switch_to_markup:function(t){t.preventDefault(),t.stopPropagation(),this.$el.find("li").removeClass("active").filter(".markup").addClass("active"),this.trigger("media_manager:switcher:to_markup")},is_in_editing_mode:function(){var t=Upfront.Application.sidebar.prevented_usage_type;return!t.match(/media/)}}),A=Backbone.View.extend({_request_in_progress:!1,initialize:function(t){t=_.extend({type:"PostImage",multiple_selection:!1},t);var e=(t.type,t.multiple_selection),i=t.button_text;this.popup_data=t.data,h.to_defaults(),this.switcher_view=new D({el:this.popup_data.$top}),this.listenTo(this.switcher_view,"media_manager:switcher:to_library",this.render_library,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_embed",this.render_embed,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_upload",this.render_upload,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_shortcode",this.render_shortcode,this),this.listenTo(this.switcher_view,"media_manager:switcher:to_markup",this.render_markup,this),this.command_view=new L({el:this.popup_data.$bottom,button_text:i,ck_insert:t.ck_insert}),this.library_view=new q(t.collection,t),this.library_view.multiple_selection=e,t.themeImages&&(h.themeImages=!0,this.library_view.multiple_selection=!1)},remove:function(){this.library_view.remove(),this.switcher_view.remove(),Upfront.Events.off("media_manager:media:list",this.switch_media_type,this)},render:function(){this.switcher_view.render(),this.command_view.render(),this.render_library(),Upfront.Events.off("media_manager:media:list",this.switch_media_type).on("media_manager:media:list",this.switch_media_type,this)},render_library:function(){if(this.load(),this.library_view.render(),this.$el.empty().append(this.library_view.$el),arguments.length){var t=arguments[0],e=this;"ID"in t&&this.library_view.media_collection.once("reset",function(){var i=e.library_view.media_collection.where({ID:t.ID});i.length&&i[0].set({selected:!0})})}},render_embed:function(){return!1},render_upload:function(t){if(this.library_view.$el.is(":visible")||this.render_library(),!window._upfront_media_upload||!_upfront_media_upload.image_ref)return alert(r.disabled),!1;var e=this,i=0,n=0,o=0,s=[],l=e.library_view._subviews.media,p=h.themeImages?_upfront_media_upload.theme:_upfront_media_upload.normal;this.$("#fileupload").remove(),this.$el.append('<input id="fileupload" type="file" style="display:none" name="media" data-url="'+p+'" multiple >'),this.$("#fileupload").off("click").on("click",function(t){t.stopPropagation()}).fileupload({dataType:"json",add:function(t,e){var n=e.files[0],o=i,r=n.name||"tmp";i+=1,s[o]=new a({progress:0}),s[o].set({post_title:r}),l.model.add(s[o],{at:0}),e.submit(),s[o].on("upload:abort",function(){e.abort(),s[o].get("ID")&&!h.themeImages&&Upfront.Util.post({action:"upfront-media-remove_item",item_id:s[o].get("ID")}).always(function(){l.model.trigger("change")}),l.model.remove(s[o]),l.model.trigger("change")}),s[o].trigger("upload:start",n)},progressall:function(t,e){var i=n;n+=1;var o=parseInt(e.loaded/e.total*100,10);s[i]&&s[i].trigger("upload:progress",o)},done:function(t,i){var n=o;if(o+=1,h.themeImages)return s[n].set(i.result.data,{silent:!0}),s[n].trigger("upload:finish",e);var r=i.result.data||[],a=r[0];s[n].set({ID:a},{silent:!0}),Upfront.Util.post({action:"upfront-media-get_item",item_id:a}).done(function(t){s[n].set(t.data,{silent:!0}),s[n].trigger("upload:finish",e)}).fail(function(){Upfront.Events.trigger("media_manager:media:list",h)})},fail:function(t,e){e.jqXHR.responseJSON&&e.jqXHR.responseJSON.error&&Upfront.Views.Editor.notify(e.jqXHR.responseJSON.error,"error"),Upfront.Events.trigger("media_manager:media:list",h)}}).trigger("click")},render_shortcode:function(){},render_markup:function(){},load:function(t){this._request_in_progress=!0,t=t&&t.type?t:h.to_request_json(),t.media_limit=h.media_limit,t.action=h.themeImages?"upfront-media-list_theme_images":"upfront-media-list_media";var e=this;this.library_view.media_view&&this.library_view.media_view.start_loading&&this.library_view.media_view.start_loading(),Upfront.Util.post(t).done(function(t){h.set_max_pages(t.data.meta.max_pages),h.set_max_items(t.data.meta.max_items),e.library_view.update(t.data.items),e.command_view.render()}).fail(function(t){e.library_view.update([]),e.command_view.render()}).always(function(){e._request_in_progress=!1})},switch_media_type:function(t){return!this._request_in_progress&&void this.load(t.to_request_json())}}),L=Backbone.View.extend({initialize:function(t){this.options=t},render:function(){var t=this.options.button_text,e=new N,i=new V,n=this.options.ck_insert?new R({button_text:t}):new B({button_text:t});e.render(),i.render(),n.render(),this.$el.empty().append(e.$el).append(n.$el).append(i.$el)},switch_to_upload:function(t){this.trigger("media_manager:switcher:to_upload")}}),N=Backbone.View.extend({events:{"click .upfront-pagination_item-prev":"prev_page","click .upfront-pagination_item-next":"next_page","click .upfront-pagination_page-item":"set_page","click .upfront-pagination_page-current":"stop_prop","keypress .upfront-pagination_page-current":"set_page_keypress"},stop_prop:function(t){t.stopPropagation()},render:function(){var t="";h.max_pages>1&&(t+='<div id="upfront-entity_list-pagination">',t+='<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-prev"></a>',t+='<div class="upfront-pagination_navigation">',t+='<input type="text" class="upfront-pagination_page-current" value="'+h.current_page+'" />',t+="&nbsp;"+r.n_of_x+"&nbsp;",t+='<a class="upfront-pagination_page-item" data-idx="'+(h.max_pages-1)+'">'+(h.max_pages-1)+"</a>",t+="</div>",t+='<a class="upfront-pagination_item upfront-pagination_item-skip upfront-pagination_item-next"></a>',t+="<small>("+_.template(r.entity_list_info,{items:h.max_items,pages:h.max_pages-1})+")</small>",t+="</div>"),this.$el.empty().append(t)},prev_page:function(t){t.preventDefault(),t.stopPropagation(),h.prev_page()&&Upfront.Events.trigger("media_manager:media:list",h)},next_page:function(t){t.preventDefault(),t.stopPropagation(),h.next_page()&&Upfront.Events.trigger("media_manager:media:list",h)},set_page:function(e){e.preventDefault(),e.stopPropagation(),h.set_page(t(e.target).data("idx"))&&Upfront.Events.trigger("media_manager:media:list",h)},set_page_keypress:function(e){if(e.stopPropagation(),13!==e.which)return!0;var i=t.trim(t(e.target).val()),n=parseInt(i,10);return!!n&&(n>h.max_pages&&(n=h.max_pages),void(h.set_page(n)&&Upfront.Events.trigger("media_manager:media:list",h)))}}),V=Backbone.View.extend({className:"search_container clearfix",events:{"click .search":"do_search","click .clear":"clear_search","keyup :text":"on_keyup"},render:function(){var t=h.get("search"),e=!!t.length&&t.first(),i=!!e&&e.get("state");this.$el.empty().append('<input type="text" placeholder="'+r.search+'" value="'+(i&&e?e.get("value"):"")+'" />'),i?(this.$el.append('<a href="#clear" class="clear upfront-icon upfront-icon-popup-search-clear"></a>'),this.$el.addClass("has_search")):this.$el.removeClass("has_search"),this.$el.append('<div class="search upfront-icon upfront-icon-popup-search" id="upfront-search_action"></div>')},do_search:function(t){t.preventDefault(),t.stopPropagation();var e=this.$el.find(":text"),i=e.val(),n=new d({filter:i,value:i,state:!0});i||(n=new d({filter:!1,value:!1,state:!1})),h.to_defaults(),h.current_keys=[],h.current_models=[],h.set("search",new c([n])),Upfront.Events.trigger("media_manager:media:list",h),Upfront.Events.trigger("media:search:requested",n),this.render();var o=new p(h.current_models);Upfront.Events.trigger("media:item:selection_changed",o)},clear_search:function(t){t.preventDefault(),t.stopPropagation();var e=this.$el.find(":text");e.val(""),this.do_search(t)},on_keyup:function(t){13==t.keyCode?this.$el.find(".search").trigger("click"):27==t.keyCode&&this.$el.find(".clear").trigger("click")}}),B=Backbone.View.extend({className:"use_selection_container",events:{"click a":"use_selection"},initialize:function(t){this.options=t,Upfront.Events.on("media:item:selection_changed",this.update_model,this)},render:function(){var t=this.options.button_text||"Ok";this.$el.empty().append('<a href="#use" class="use">'+t+"</a>")},update_model:function(t){for(var i in t.models){var n=t.models[i],o=(n||{}).attributes||{};index=h.current_keys.indexOf(o.ID),index==-1?o.selected&&(h.current_keys.push(o.ID),h.current_models.push(n)):o.selected&&o.selected!==e||(h.current_keys.splice(index,1),h.current_models.splice(index,1))}},use_selection:function(t){t.preventDefault(),t.stopPropagation();var e=new p(h.current_models);Upfront.Popup.close(e)}}),R=B.extend({use_selection:function(t){t.preventDefault(),t.stopPropagation(),this.model&&this.model.length>1?this.open_dialog():Upfront.Popup.close(this.model)},open_dialog:function(){var e=t('<div id="media-manager-multi-dialog" class="upfront-ui" />');e.append('<h3 class="multi-dialog-title">'+r.insertion_question+"</h3>"),e.append('<ul class="multi-dialog-choices"><li class="multi-dialog-choice upfront-icon upfront-icon-media-insert-multi-plain" data-choice="plain">'+r.plain_images+'</li><li class="multi-dialog-choice upfront-icon upfront-icon-media-insert-multi-slider" data-choice="slider">'+r.image_slider+'</li><li class="multi-dialog-choice upfront-icon upfront-icon-media-insert-multi-gallery" data-choice="gallery">'+r.image_gallery+"</li></ul>"),Upfront.Popup.$popup.find("#upfront-popup-content").append(e),e.on("click",".multi-dialog-choice",this,this.select_dialog)},select_dialog:function(e){e.preventDefault(),e.stopPropagation();var i=t("#media-manager-multi-dialog"),n=t(this).attr("data-choice")||"plain",o=e.data;o.model.type=n,i.remove(),Upfront.Popup.close(o.model)}}),F=(Backbone.View.extend({className:"upfront-embed_media clearifx",initialize:function(){this.model=new a},render:function(){this.embed_pane=new F({model:this.model}),this.embed_pane.on("embed:editable:updated",this.embed_updated,this),this.preview_pane=new H({model:this.model}),this.embed_pane.render(),this.preview_pane.render(),this.$el.empty().append(this.embed_pane.$el).append(this.preview_pane.$el)},embed_updated:function(){this.preview_pane.render_progress();var t=this;Upfront.Util.post(_.extend({action:"upfront-media-embed",media:this.model.get("original_url")},_upfront_media_upload.embed_ref)).done(function(e){t.model.set(e.data,{silent:!0}),t.preview_pane.trigger("embed:media:imported"),t.embed_pane.clear_updating_flag(),t.embed_pane.render(),t.preview_pane.render()})}}),Backbone.View.extend({className:"upfront-pane",embed_is_being_updated:!1,events:{"click button":"save"},initialize:function(){this.editables=_([new Z({model:this.model}),new tt({model:this.model}),new et({model:this.model})])},render:function(){this.$el.empty();var t=this;this.editables.each(function(e){e.render(),e.on("embed:updated",t.editable_updated,t),t.$el.append(e.$el)}),this.$el.append('<button type="button">'+r.ok+"</button>")},editable_updated:function(){this.embed_is_being_updated=!0,this.trigger("embed:editable:updated")},clear_updating_flag:function(){this.embed_is_being_updated=!1},save:function(){if(!this.model)return!1;var t=this;if(!this.model.get("ID")&&this.embed_is_being_updated)return setTimeout(function(){t.save()},500),!1;var e={action:"upfront-media-update_media_item",data:this.model.toJSON()};Upfront.Util.post(e).done(function(){t.model.trigger("change"),Upfront.Events.trigger("media_manager:media:show_library",e.data)})}})),H=Backbone.View.extend({className:"upfront-pane",initialize:function(){},render:function(){this.preview_view=new W({model:this.model}),this.labels_view=new J({model:this.model}),this.on("embed:media:imported",this.update_media_preview,this),this.preview_view.render(),this.$el.empty().append(this.preview_view.$el)},render_progress:function(){this.$el.empty().append('<div class="preview_loader" />');var t=this.$el.find(".preview_loader");t.css({position:"relative",minHeight:"250px",width:"100%"}),this.loading=new Upfront.Views.Editor.Loading({loading:r.loading_embeddable_preview,done:"Loaded"}),this.loading.render(),t.append(this.loading.$el)},update_media_preview:function(){this.preview_view.render(),this.labels_view.render(),this.labels_view.delegateEvents()}}),W=Backbone.View.extend({className:"upfront-media_manager-embed-preview",template:_.template('{{thumbnail}} <div class="progress"></div>'),render:function(){if(!this.model.get("original_url"))return this.$el.empty();var t=this.is_image(),e=t?this.model.get("thumbnail"):this.get_media_thumbnail();this.$el.empty().append(this.template({thumbnail:e}))},is_image:function(){return(this.model.get("original_url")||"").match(/\.(jpe?g|gif|png)$/i)},get_media_thumbnail:function(){return this.model.get("thumbnail")}}),q=A.extend({className:"upfront-media_manager upfront-media_manager-post_image clearfix",_subviews:{media:!1,aux:!1,controls:!1},initialize:function(t,e){t=(t||{}).models?new l(t):new l,this.media_collection=t,this.options=e},render:function(){this._subviews.media||(this._subviews.media=new G({model:this.media_collection}));var t=this._subviews.media;this._subviews.aux||(this._subviews.aux=new g({model:this.media_collection}));var e=this._subviews.aux;this._subviews.controls||(this._subviews.controls=new f({model:this.media_collection,options:this.options}));var i=this._subviews.controls;t.multiple_selection=this.multiple_selection,i.render(),e.render(),t.render(),this.$el.empty().append(i.$el).append(e.$el).append(t.$el),this.media_view=t,this.media_view.start_loading()},update:function(t){var e=this;this.media_view.model.reset(t),this.media_view.end_loading(function(){e.media_view.render()})},remove:function(){_.each(this._subviews,function(t,e){return!t||(t.remove(),void(this._subviews[e]=!1))},this)}}),G=Backbone.View.extend({tagName:"ul",className:"upfront-media_collection",initialize:function(){this.model.on("add",this.render,this),this.model.on("remove",this.render,this),this.model.on("change",this.update,this),this.model.on("change:selected",this.propagate_selection,this)},render:function(){this.subviews=[];var t=this;if(this.$el.empty(),this.model.length){this.model.each(function(e){var i=new Q({model:e});if(t.subviews.push(i),i.parent_view=t,i.render(),t.$el.append(i.$el),h.current_keys.length){var n=h.current_keys.indexOf(((e||{}).attributes||{}).ID);n!=-1&&(e.set({selected:!0},{silent:!0}),e.trigger("appearance:update"))}});var e=new p(h.current_models);Upfront.Events.trigger("media:item:selection_changed",e),n.withDebounceUpdate(this.el,!0,!1,!0)}else this.$el.append("&nbsp;")},update:function(){this.model.length&&this.model.each(function(t){t.trigger("appearance:update")})},start_loading:function(){this.loading=new Upfront.Views.Editor.Loading({loading:r.loading_media_files,timeout:500,done:"Loaded"}),this.loading.render(),this.loading.$el.insertAfter(this.$el)},end_loading:function(t){this.loading&&this.loading.done?this.loading.done(t):t()},propagate_selection:function(t){if(!this.multiple_selection){var e=this.model.where({selected:!0}),i=!0===t.get("selected");e.length&&_(e).each(function(t){t.set({selected:!1},{silent:!0}),t.trigger("appearance:update")}),i&&t.set({selected:!0},{silent:!0}),t.trigger("appearance:update")}Upfront.Events.trigger("media:item:selection_changed",this.model);var n=new p(h.current_models);Upfront.Events.trigger("media:item:selection_changed",n)},remove:function(){_.each(this.subviews,function(t){t.remove()})}}),Q=Backbone.View.extend({tagName:"li",className:"upfront-media_item",events:{click:"toggle_item_selection"},initialize:function(){this.template=_.template("<div class='thumbnail'>{{thumbnail}}</div> <div class='title'>{{post_title}}</div> <div class='upfront-media_item-editor-container' />"),Upfront.Events.on("media_manager:media:toggle_titles",this.toggle_title,this),this.model.on("appearance:update",this.update,this),this.model.on("upload:start",this.upload_start,this),this.model.on("upload:progress",this.upload_progress,this),this.model.on("upload:finish",this.upload_finish,this)},render:function(){this.$el.empty().append(this.template(this.model.toJSON())),this.update(),this.toggle_title()},update:function(){this.model.get("parent")?this.$el.addClass("has-parent"):this.$el.removeClass("has-parent"),this.model.get("selected")&&!this.$el.hasClass("selected")?this.$el.addClass("selected"):this.model.get("selected")||this.$el.removeClass("selected"),this.$el.find(".title").text(this.model.get("post_title"))},toggle_title:function(){var t=h.showing_titles,e=this.$el.find(".title");t&&!e.is(":visible")?e.show():e.hide()},toggle_item_selection:function(t){t.stopPropagation(),t.preventDefault(),this.model.set({selected:!this.model.get("selected")})},upload_start:function(t){this.parent_view.$el.scrollTop(0),this.$el.find(".thumbnail").append('<div class="upfront-media-progress-bar" />')},upload_progress:function(t){this.$el.find(".upfront-media-progress-bar").css("width",t+"%")},upload_finish:function(t){this.$el.find(".thumbnail .upfront-image-upload-placeholder").replaceWith(this.model.get("thumbnail")),this.$el.find(".upfront-media-progress-bar").remove(),h.current_models.push(this.model),h.themeImages||(h.current_keys.push(this.model.attributes.ID),t.render_library())},remove:function(){Upfront.Events.off("media_manager:media:toggle_titles",this.toggle_title)}}),J=(Backbone.View.extend({className:"upfront-media_item-editor",events:{"click button":"save"},initialize:function(t){this.editables=_([new tt({model:this.model})]),t&&t.media&&(this.media=t.media)},render:function(){this.$el.empty();var t=this;this.editables.each(function(e){e.render(),t.$el.append(e.$el)});var e=new J({model:this.model});if(e.render(),this.$el.append(e.$el),this.$el.append('<button type="button">'+r.ok+"</button>"),!this.media)return!0;var i=this.media.type||"application/octet-stream",n=i.match(/^image/i);if(n)return!0;var o=new Y({model:this.model,media:this.media});o.render(),this.$el.append(o.$el)},save:function(){this.editables.invoke("update");var t=this,e={action:"upfront-media-update_media_item",data:this.model.toJSON()};Upfront.Util.post(e).done(function(){t.model.trigger("change")})}}),Backbone.View.extend({className:"upfront-media_labels",events:{"click button":"create_label","click a.own_label":"drop_label","click a.all_label":"add_label"},initialize:function(){this.labels=h.get("label"),Upfront.Events.on("media_manager:media:labels_loaded",this.reset_labels,this)},reset_labels:function(){this.labels=h.get("label"),this.render()},render:function(){var t=_.template('<a class="own_label" href="#" data-idx="{{value}}">{{filter}}</a> '),e=_.template('<a class="all_label" href="#" data-idx="{{value}}">{{filter}}</a> '),i=this,n=this.model.get("labels"),o=[],s=[];this.$el.empty(),this.labels&&this.labels.each(function(i){n&&n.length&&n.indexOf(i.get("value"))>=0?o.push(t(i.toJSON())):s.push(e(i.toJSON()))}),i.$el.append(r.applied_labels+"&nbsp;"),_(o).each(function(t){i.$el.append(t)}),this.$el.append('<input type="text" placeholder="label..." /><button type="button">'+r.add+"</button>"),i.$el.append("All labels: "),_(s).each(function(t){i.$el.append(t)})},create_label:function(t){t.preventDefault(),t.stopPropagation();var e=this.$el.find(":text").val(),i={action:"upfront-media-add_label",term:e,post_id:this.model.get("ID")};Upfront.Util.post(i).success(function(t){Upfront.Events.trigger("media_manager:media:labels_updated")})},add_label:function(t){t.preventDefault(),t.stopPropagation(),this._update_labels(t)},drop_label:function(t){t.preventDefault(),t.stopPropagation(),this._update_labels(t,"dis")},_update_labels:function(e,i){i=i||"",e.preventDefault(),e.stopPropagation();var n=this,o=t(e.target),r=o.attr("data-idx"),s={action:"upfront-media-"+i+"associate_label",term:r,post_id:this.model.get("ID")};Upfront.Util.post(s).success(function(t){var e=n.model.get("ID"),i=t.data||{},o=i[e]||i;n.model.set("labels",o,{silent:!0}),n.render()})}})),Y=Backbone.View.extend({className:"upload_type-nag",events:{"click .keep":"keep_file","click .remove":"remove_file"},render:function(){this.$el.empty().append(r.video_recommendation_nag).append('<a href="#" class="button keep">'+r.keep_file+"</a>").append('<a href="#" class="button remove">'+r.remove_file+"</a>")},keep_file:function(t){t.preventDefault(),t.stopPropagation()},remove_file:function(t){t.preventDefault(),t.stopPropagation(),this.model.trigger("upload:abort")}}),X=Backbone.View.extend({className:"upfront-media_item-editable",events:{change:"update"},template:_.template("<label>{{label}}<input type='text' name='{{name}}' value='{{value}}' placeholder='{{placeholder}}' /></label>"),get_name:function(){},get_label:function(){},get_placeholder:function(){},get_value:function(){return this.$el.find('[name="'+this.get_name()+'"]:first').val()},render:function(){var t=this.get_name()||"",e=this.get_label()||"",i=this.get_placeholder()||"",n=this.model.get(this.get_name())||"",o={name:t,label:e,placeholder:i,value:n};this.$el.empty().append(this.template(o))},update:function(){var t={};t[this.get_name()]=this.get_value(),this.model.set(t,{silent:!0})}}),K=X.extend({update:function(){var t={};t[this.get_name()]=this.get_value(),this.model.set(t,{silent:!0}),this.trigger("embed:updated")}}),Z=K.extend({get_name:function(){return"original_url"},get_label:function(){return r.media_url},get_placeholder:function(){return"http://sample.com/path-to-image/image.jpg"}}),tt=X.extend({get_name:function(){return"post_title"},get_label:function(){return r.image_title},get_placeholder:function(){return r.your_image_title}}),et=X.extend({get_label:function(){return r.labels},render:function(){var t=new p([this.model]),e=new y({model:t});e.render(),t.on("change",e.render_labels,e),this.$el.empty().append("<label>"+this.get_label()+"</label>").append(e.$el)}}),it=Backbone.View.extend({initialize:function(t){this.options=t},open:function(e){e=_.extend({media_type:["images"],multiple_sizes:!0,multiple_selection:!0,button_text:r.ok,ck_insert:!1,hold_editor:!1},e);var i=this,n=!1,o=e.media_type;e.multiple_selection,e.button_text;return h.allowed_media_types=o,h.multiple_sizes=e.multiple_sizes,n=Upfront.Popup.open(function(t,n,o){i.out=this,i.popup_data=t,i.popup_data.$top=n,i.popup_data.$bottom=o,i.load(e)},{width:800,hold_editor:e.hold_editor},"media-manager"),n.always(_.bind(this.cleanup_active_filters,this)),n.progress(t.proxy(this.clean_up,this)),Upfront.Events.trigger("upfront:element:edit:start","media-upload"),n},clean_up:function(t){"before_close"===t&&Upfront.Events.trigger("upfront:element:edit:stop","media-upload")},cleanup_active_filters:function(){h.allowed_media_types=[],h.current_keys=[],h.current_models=[],this.cleanup_manager_view()},cleanup_manager_view:function(){this.media_manager&&(this.media_manager.undelegateEvents(),this.media_manager.remove(),this.media_manage_options=e)},load:function(t){return this.cleanup_manager_view(),_.isUndefined(this.media_manage_options)?(this.media_manage_options=_.extend({el:this.out,data:this.popup_data},t),this.media_manager=new A(this.media_manage_options)):_.isEqual(this.media_manage_options,_.extend({el:this.out,data:this.popup_data},t))||(this.media_manage_options=_.extend({el:this.out,data:this.popup_data},t),this.media_manager=new A(this.media_manage_options)),this.media_manager.render(),!1},results_html:function(t){var e="";return t&&t.each&&t.each(function(i){var n=i.toJSON(),r=i.get("selected_size")||o.FULL,s=i.get("additional_sizes");r&&o.FULL!=r&&_(s).each(function(t){return o.to_size(t)!=r||void(n.image=t)}),"gallery"==t.type&&(n.link={href:"#",class:"popup"}),n.type=t.type,e+=_.template(n.link?Upfront.Media.Templates.image_link:Upfront.Media.Templates.image,n)}),t&&t.length&&t.length>1&&("plain"==t.type?e=_.template(Upfront.Media.Templates.multiple,{content:e}):"gallery"==t.type?e=_.template(Upfront.Media.Templates.gallery,{content:e}):"slider"==t.type&&(e=_.template(Upfront.Media.Templates.slider,{content:e}))),e}});Upfront.Media={Manager:new it,Templates:{image:'<p class="upfront-inserted_image-wrapper upfront-inserted_image-{{type}}"><img src="{{image.src}}" title="{{post_title}}" alt="{{post_title}}" height="{{image.height}}" width="{{image.width}}" /></p>',image_link:'<p class="upfront-inserted_image-wrapper upfront-inserted_image-{{type}}"><a href="{{link.href}}" class="{{link.class}}"><img src="{{image.src}}" title="{{post_title}}" alt="{{post_title}}" height="{{image.height}}" width="{{image.width}}" /></a></p>',embeddable:"<div>{{post_content}}<br />{{post_title}}</div>",gallery:"[upfront-gallery]{{content}}[/upfront-gallery]",slider:"[upfront-slider]{{content}}[/upfront-slider]",multiple:"{{content}}"},Transformations:{_transformations:_([]),add:function(t){this._transformations.push(t)},apply:function(t){return this._transformations.each(function(e){t=e.apply(this,[t])}),t}},Ref:(window._upfront_media_upload||{image_ref:""}).image_ref}})}(jQuery),function(t){define("scripts/upfront/bg-settings/mixins",[],function(){return{bind_toggles:function(){this.on("show",function(){this.$el.show()}),this.on("hide",function(){this.$el.hide()})},save_fields:function(){},preview_color:function(t){if(_.isObject(t)){var e=t.toRgb(),i="rgba("+e.r+","+e.g+","+e.b+","+t.alpha+")";i=t.get_is_theme_color()!==!1?t.theme_color:i,"undefined"!=typeof this.is_featured_fallback_bg_color&&this.is_featured_fallback_bg_color?this.model.set_breakpoint_property("featured_fallback_background_color",i):this.model.set_breakpoint_property("background_color",i)}},update_color:function(t){this.preview_color(t),"undefined"!=typeof this.is_featured_fallback_bg_color&&this.is_featured_fallback_bg_color?this._default_color=this.model.get_breakpoint_property_value("featured_fallback_background_color",!0):this._default_color=this.model.get_breakpoint_property_value("background_color",!0)},reset_color:function(){"undefined"!=typeof this.is_featured_fallback_bg_color&&this.is_featured_fallback_bg_color?this.model.set_breakpoint_property("featured_fallback_background_color",this._default_color):this.model.set_breakpoint_property("background_color",this._default_color)},upload_image:function(){var e=this;Upfront.Views.Editor.ImageSelector.open().done(function(i){var n,o={};_.each(i,function(t,e){o=t,n=e}),t("<img>").attr("src",o.full[0]).load(function(){Upfront.Views.Editor.ImageSelector.close(),e.model.set_breakpoint_property("background_image",o.full[0]),e.model.set_breakpoint_property("background_image_ratio",Math.round(o.full[2]/o.full[1]*100)/100)})})}}})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/color-item",["scripts/upfront/bg-settings/mixins"],function(t){var i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},t,{group:!1,initialize:function(t){var i=this,n={model:this.model,property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(t){i.preview_color(t)},change:function(t){i.update_color(t)},hide:function(t){i.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-color-pick")}};t.hideLabel!==!0&&(n.label=e.bg_color_short),t.fields=[new Upfront.Views.Editor.Field.Color(n)],this.$el.addClass("uf-bgsettings-item uf-bgsettings-coloritem"),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)}}));return i})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/image-item",["scripts/upfront/bg-settings/mixins"],function(t){var i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},t,{group:!1,initialize:function(t){var i=this,n={default_value:50,min:0,max:100,step:1},o=this.toggle_bg_size_field(),r=["bg_tile"],s=["bg_color","bg_position_x","bg_position_y","bg_position_x_num","bg_position_y_num","use_bg_size","bg_size"],a=["origin_position_x","origin_position_y","origin_position_x_num","origin_position_y_num","use_bg_size","bg_size"],l={pick_image:new Upfront.Views.Editor.Field.Button({label:e.browse,compact:!0,classname:"uf-button-alt uf-bgsettings-image-pick",on_click:function(){i.upload_image()}}),bg_style:new Upfront.Views.Editor.Field.Select({model:this.model,label:e.image_type,className:"upfront-field-wrap upfront-field-wrap-select background-image-field",property:"background_style",use_breakpoint_property:!0,default_value:"full",icon_class:"upfront-region-field-icon",values:this.get_bg_style_values(),change:function(){var t=this.get_value();"tile"===t?(_.each(r,function(t){l[t].$el.show()}),_.each(s,function(t){l[t].$el.hide()}),_.each(a,function(t){l[t].$el.hide()})):"fixed"===t?(_.each(r,function(t){l[t].$el.hide()}),_.each(a,function(t){l[t].$el.hide()}),_.each(s,function(t){if("background_size_percent"==l[t].property_name){var e=i.model.get_breakpoint_property_value("use_background_size_percent",!0)||!1;e!==!1&&l[t].$el.show()}else l[t].$el.show()})):"parallax"===t?(_.each(r,function(t){l[t].$el.hide()}),_.each(s,function(t){l[t].$el.hide();
}),_.each(a,function(t){if("background_size_percent"==l[t].property_name){var e=i.model.get_breakpoint_property_value("use_background_size_percent",!0)||!1;e!==!1&&l[t].$el.show()}else l[t].$el.show()})):(_.each(r,function(t){l[t].$el.hide()}),_.each(s,function(t){l[t].$el.hide()}),_.each(a,function(t){l[t].$el.hide()})),i._bg_style=t,i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-style")}}),bg_tile:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,layout:"horizontal-inline",default_value:["y","x"],values:[{label:e.tile_vertically,value:"y"},{label:e.tile_horizontally,value:"x"}],change:function(){var t=this.get_value();i._bg_tile=t,i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-tile")}}),bg_color:new Upfront.Views.Editor.Field.Color({model:this.model,label:e.bg_color_short,property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(t){i.preview_color(t)},change:function(t){i.update_color(t)},hide:function(t){i.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-image-color")}}),bg_position_y:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,label:e.image_position,orientation:"vertical",property:"background_position_y",use_breakpoint_property:!0,range:!1,change:function(){var t=this.get_value();l.bg_position_y_num.get_field().val(t),i._bg_position_y=t,this.model.set_breakpoint_property(this.property_name,t),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y")}},n)),bg_position_x:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,property:"background_position_x",use_breakpoint_property:!0,range:!1,change:function(){var t=this.get_value();l.bg_position_x_num.get_field().val(t),i._bg_position_x=t,this.model.set_breakpoint_property(this.property_name,t),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x")}},n)),bg_position_y_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"Y:",label_style:"inline",suffix:"%",change:function(){var t=this.get_value(),e=l.bg_position_y;e.$el.find("#"+e.get_field_id()).slider("value",t),e.get_field().val(t),e.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y-num")}},n)),bg_position_x_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"X:",label_style:"inline",suffix:"%",change:function(){var t=this.get_value(),e=l.bg_position_x;e.$el.find("#"+e.get_field_id()).slider("value",t),e.get_field().val(t),e.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x-num")}},n)),origin_position_y:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,label:e.origin_position,orientation:"vertical",property:"origin_position_y",use_breakpoint_property:!0,range:!1,change:function(){var t=this.get_value();l.origin_position_y_num.get_field().val(t),i._origin_position_y=t,this.model.set_breakpoint_property(this.property_name,t),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y")}},{default_value:50,min:-50,max:150,step:1})),origin_position_x:new Upfront.Views.Editor.Field.Slider(_.extend({model:this.model,property:"origin_position_x",use_breakpoint_property:!0,range:!1,change:function(){var t=this.get_value();l.origin_position_x_num.get_field().val(t),i._origin_position_x=t,this.model.set_breakpoint_property(this.property_name,t),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x")}},{default_value:50,min:-50,max:150,step:1})),origin_position_y_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"Y:",label_style:"inline",suffix:"%",change:function(){var t=this.get_value(),e=l.origin_position_y;e.$el.find("#"+e.get_field_id()).slider("value",t),e.get_field().val(t),e.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-y-num uf-bgsettings-origin-pos-y-num")}},{default_value:50,min:-50,max:150,step:1})),origin_position_x_num:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,label:"X:",label_style:"inline",suffix:"%",change:function(){var t=this.get_value(),e=l.origin_position_x;e.$el.find("#"+e.get_field_id()).slider("value",t),e.get_field().val(t),e.trigger("changed")},rendered:function(){this.$el.addClass("uf-bgsettings-image-pos-x-num uf-bgsettings-origin-pos-x-num")}},{default_value:50,min:-50,max:150,step:1})),use_bg_size:new o({model:this.model,property:"use_background_size_percent",label:"",multiple:!1,use_breakpoint_property:!0,values:[{label:e.resize_image,value:"yes"}],change:function(){var t=this.get_value(),e=i.$el.find(".uf-bgsettings-image-size"),n=t||!1;this.model.set_breakpoint_property(this.property_name,t),e.find('input[name="background_size_percent"]').val(100),i.model.set_breakpoint_property("background_size_percent",100),n===!1?(e.hide(),i._bg_size="auto",i.update_image()):(i._bg_size=100,i.update_image(),e.show())},rendered:function(){this.$el.addClass("uf-bgsettings-use-image-size")}}),bg_size:new Upfront.Views.Editor.Field.Number(_.extend({model:this.model,property:"background_size_percent",label:"",use_breakpoint_property:!0,suffix:e.resize_image_percent,change:function(){var t=this.get_value();i._bg_size=t,this.model.set_breakpoint_property(this.property_name,t),i.update_image()},rendered:function(){this.$el.addClass("uf-bgsettings-image-size")}},{default_value:100,min:0,max:1e3,step:1})),bg_default:new Upfront.Views.Editor.Field.Select({model:this.model,label:e.featured_default,className:"upfront-field-wrap upfront-field-wrap-select background-image-field",property:"background_default",use_breakpoint_property:!0,default_value:"hide",icon_class:"upfront-region-field-icon",values:[{label:e.featured_default_hide,value:"hide"},{label:e.featured_default_color,value:"color"},{label:e.featured_default_image,value:"image"}],change:function(){var t=this.get_value(),e=i.model.get_breakpoint_property_value("background_image",!0);this.$el.removeClass("uf-bgsettings-image-default-image uf-bgsettings-image-default-color uf-bgsettings-image-default-hide"),"image"==t?(l.featured_fallback_pick_image.$el.show(),l.featured_fallback_bg_color.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-image"),e||i.upload_image()):"color"==t?(l.featured_fallback_bg_color.$el.show(),l.featured_fallback_pick_image.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-color")):"featured"==t?(l.featured_fallback_bg_color.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-image")):(l.featured_fallback_bg_color.$el.hide(),l.featured_fallback_pick_image.$el.hide(),this.$el.addClass("uf-bgsettings-image-default-hide")),this.model.set_breakpoint_property(this.property_name,t),i.update_image()},rendered:function(){var t=this.get_saved_value();this.$el.addClass("uf-bgsettings-image-default"),"image"==t?this.$el.addClass("uf-bgsettings-image-default-image"):"color"==t?this.$el.addClass("uf-bgsettings-image-default-color"):this.$el.addClass("uf-bgsettings-image-default-hide")}}),featured_fallback_bg_color:new Upfront.Views.Editor.Field.Color({model:this.model,label:e.bg_color_short,property:"featured_fallback_background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(t){i.is_featured_fallback_bg_color=!0,i.preview_color(t),i.is_featured_fallback_bg_color=!1},change:function(t){i.is_featured_fallback_bg_color=!0,i.update_color(t),i.is_featured_fallback_bg_color=!1},hide:function(t){i.is_featured_fallback_bg_color=!0,i.reset_color(),i.is_featured_fallback_bg_color=!1}},rendered:function(){this.$el.addClass("uf-bgsettings-featured-fallback-image-color")}}),featured_fallback_pick_image:new Upfront.Views.Editor.Field.Button({label:e.browse,compact:!0,classname:"uf-button-alt uf-bgsettings-featured-fallback-image-pick",on_click:function(){i.upload_image()}})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-imageitem"),t.fields=_.map(l,function(t){return t}),this.on("show",function(){var t=i.model.get_breakpoint_property_value("background_type",!0),e=i.model.get_breakpoint_property_value("background_image",!0);i.model.get_breakpoint_property_value("background_default",!0);i._bg_style=l.bg_style.get_value(),i._bg_tile=l.bg_tile.get_value(),i._bg_size=l.bg_size.get_value(),l.bg_size.trigger("changed"),i._bg_position_y=l.bg_position_y.get_value(),l.bg_position_y.trigger("changed"),i._origin_position_y=l.origin_position_y.get_value(),l.origin_position_y.trigger("changed"),i._bg_position_x=l.bg_position_x.get_value(),l.bg_position_x.trigger("changed"),i._origin_position_x=l.origin_position_y.get_value(),l.origin_position_x.trigger("changed"),l.bg_style.trigger("changed"),"featured"==t?(l.pick_image.$el.hide(),l.bg_default.$el.show(),l.bg_default.trigger("changed")):("image"==t&&l.pick_image.$el.show(),l.bg_default.$el.hide(),l.featured_fallback_bg_color.$el.hide(),l.featured_fallback_pick_image.$el.hide(),e||i.upload_image())}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)},toggle_bg_size_field:function(){var t=Upfront.Views.Editor.Field.Checkboxes.extend({get_value_html:function(t,e){var i=this.get_field_id()+"-"+e,n="upfront-field-multiple",o={type:this.type,id:i,name:this.get_field_name(),value:t.value,class:"upfront_toggle_checkbox upfront-field-"+this.type},r=this.get_saved_value();this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(n+=" upfront-field-multiple-"+this.options.layout),t.disabled&&(o.disabled="disabled",n+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(r,t.value)?o.checked="checked":this.multiple||r!=t.value||(o.checked="checked"),t.checked&&(o.checked="checked"),o.checked&&(n+=" upfront-field-multiple-selected"),'<div class="'+n+' upfront_toggle"><span class="upfront-field-label-text">'+t.label+"</span><input "+this.get_field_attr_html(o)+' /><label for="'+i+'" class="upfront_toggle_label"><span class="upfront_toggle_switch"></span></label></div>'}});return t},update_image:function(){var t=this._bg_style,e=this._bg_tile,i=_.contains(e,"y"),n=_.contains(e,"x"),o=this._bg_position_y,r=this._bg_position_x,s=this.model.get_breakpoint_property_value("use_background_size_percent",!0)||!1,a=s===!1&&"auto"!==this._bg_size?"auto":this._bg_size;"full"==t?this.model.set_breakpoint_property("background_style","full"):"tile"==t?(this.model.set_breakpoint_property("background_style","tile"),n&&i?this.model.set_breakpoint_property("background_repeat","repeat"):i?this.model.set_breakpoint_property("background_repeat","repeat-y"):n?this.model.set_breakpoint_property("background_repeat","repeat-x"):this.model.set_breakpoint_property("background_repeat","no-repeat")):"fixed"==t?(this.model.set_breakpoint_property("background_style","fixed"),this.model.set_breakpoint_property("background_repeat","no-repeat"),this.model.set_breakpoint_property("background_position",r+"% "+o+"%"),this.model.set_breakpoint_property("background_size","auto"==a?a:a+"%")):"parallax"===t?(this.model.set_breakpoint_property("background_style","parallax"),this.model.set_breakpoint_property("background_position",this._origin_position_x+"% "+this._origin_position_y+"%"),this.model.set_breakpoint_property("background_size","auto"==a?a:a+"%")):this.model.set_breakpoint_property("background_style",t)},get_bg_style_values:function(){var t=[{label:e.full_width_bg,value:"full",icon:"bg-image-full"},{label:e.tiled_pattern,value:"tile",icon:"bg-image-tile"},{label:e.fixed_position,value:"fixed",icon:"bg-image-fixed"}];return this.model instanceof Upfront.Models.Region&&t.push({label:e.parallax,value:"parallax",icon:"bg-image-full"}),t}}));return i})}(jQuery),define("text!scripts/upfront/templates/map-editor.html",[],function(){return'\n<div class="upfront_map-editor-complex-wrapper">\n\t<div class="upfront-css-top">\n\t\t<div class="upfront_map-custom_map_code" data-for="script">{{ l10n.custom_map_code }}</div>\n\t\t<i class="upfront-icon-info">{{ l10n.paste_below }}</i>\n\t\t<div class="upfront_map-jsalert error javascript"><i class="upfront-icon-button" title="{{ l10n.code_error }}"></i></div>\n\t\t<a class="upfront-css-close" href="#">{{ l10n.close }}</a>\n\t</div>\n\t<div class="upfront-css-body">\n\t\t<div class="upfront_map-editor-section upfront_map-script active">\n\t\t\t<div class="upfront_map-ace" data-type="script" >{{script}}</div>\n\t\t</div>\n\t\t<button>{{ l10n.save }}</button>\n\t</div>\n</div>\n'}),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/inline-panels/map-editor",["text!scripts/upfront/templates/map-editor.html"],function(i){var n=Upfront.Views.ObjectView.extend({is_editing:!1,script_error:!1,SYNTAX_TYPES:{script:"json"},MIN_HEIGHT:200,editorTpl:_.template(i),content_editable_selector:".editable",initialize:function(){var t=this.fallback("script");this.checkJSon(t)},on_render:function(){this.start_json_editor()},start_json_editor:function(){if(this.is_editing)return!1;this.is_editing=!0;var e=t("#upfront_map-editor"),i=this;e.length||(e=t('<section id="upfront_map-editor" class="upfront-ui upfront_map-editor upfront_map-editor-complex"></section>'),t("body").append(e)),require([Upfront.Settings.ace_url],function(){i.createEditor(e)})},on_edit:function(){if(this.is_editing)return!1;var e=this.$el.find(".upfront_map-element "+this.content_editable_selector);if(e.length)return this.bootContentEditors(e);this.is_editing=!0;var i=t("#upfront_map-editor");i.length||(i=t('<section id="upfront_map-editor" class="upfront-ui upfront_map-editor upfront_map-editor-complex"></section>'),t("body").append(i)),this.createEditor(i)},bootContentEditors:function(e){if(!e||!e.length)return!1;var i=t(this.fallback("markup")),n=this;e.each(function(e){var o=t(this),r=e<=0;return!!o.data("ueditor")||void o.ueditor({autostart:r,placeholder:"",disableLineBreak:!0}).on("start",function(){n.is_editing=!0}).on("stop",function(){n.is_editing=!1}).on("syncAfter",function(){var r=t(i.find(n.content_editable_selector)[e]);return!!r.length&&(r.html(o.html()),void n.property("markup",t("<div />").append(i).html()))})})},startResizable:function(t){var e=this,i=t.find(".upfront-css-body"),n=0,o=t.find(".upfront_map-editor-complex-wrapper"),r=function(r,s){var a=s?s.size.height:t.find(".upfront_map-editor-complex-wrapper").height(),l=a-n;i.height(l),_.each(e.editors,function(t){t.resize()}),o.css({width:"",height:"",left:"",top:""})};o.find(".upfront-css-top").removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),n=t.find(".upfront-css-top").outerHeight(),r(),o.resizable({handles:{n:".upfront-css-top"},resize:r,minHeight:200,delay:100})},createEditor:function(i){var n=this;i.html(this.editorTpl({markup:this.fallback("markup"),style:this.fallback("style"),script:this.fallback("script"),l10n:e.template})),t("#page").css("padding-bottom","200px"),i.show(),this.resizeHandler=this.resizeHandler||function(){i.width(t(window).width()-t("#sidebar-ui").width()-1)},t(window).on("resize",this.resizeHandler),this.resizeHandler(),this.editors={},this.timers={},i.find(".upfront_map-ace").each(function(){var o=t(this),r=o.html(),s=ace.edit(this),a=o.data("type");s.getSession().setUseWorker(!1),s.setTheme("ace/theme/monokai"),s.getSession().setMode("ace/mode/"+n.SYNTAX_TYPES[a]),s.setShowPrintMargin(!1),"markup"===a&&r&&s.getSession().setValue(r),s.on("change",function(){n.timers[a]&&clearTimeout(n.timers[a]),n.timers[a]=setTimeout(function(){var t=s.getValue();"script"==a&&n.checkJSon(t),n.script_error?i.find(".upfront_map-jsalert").show().find("i").attr("title",e.create.js_error+" "+n.script_error):i.find(".upfront_map-jsalert").hide(),n.property(a,t,!1)},1e3)}),s.renderer.scrollBar.width=5,s.renderer.scroller.style.right="5px",n.editors[a]=s}),this.currentEditor=this.editors.markup;var o=i.find(".upfront-css-top"),r=i.find(".upfront-css-body");r.height(this.MIN_HEIGHT-o.outerHeight()),this.startResizable(i),i.find("button").on("click",function(t){_.each(n.editors,function(t,e){n.property(e,t.getValue())}),n.property("map_styles",n.fallback("script"),!1),n.is_editing=!1,n.destroyEditor()}),i.on("click",".upfront-css-type",function(t){n.hiliteElement(t)}).on("click",".upfront-css-close",function(e){e.preventDefault(),n.destroyEditor(),t("#page").css("padding-bottom",0)})},destroyEditor:function(){var e=this;this.editors&&this.editors.length&&(_.each(this.editors,function(t){t.destroy()}),e.editors=!1),this.currentEditor=!1,t("#upfront_map-editor").html("").hide(),t(window).off("resize",this.resizeHandler),this.is_editing=!1},hiliteElement:function(e){e.preventDefault();var i=this.$el.find(".upfront-object-content"),n=i.offset().top-50;t(document).scrollTop(n>0?n:0),this.blink(i,4)},blink:function(t,e){var i=this;t.css("outline","3px solid #3ea"),setTimeout(function(){t.css("outline","none"),e--,e>0&&setTimeout(function(){i.blink(t,e-1)},100)},100)},checkJSon:function(t){this.script_error=!1;try{JSON.parse(t)}catch(t){this.script_error=t.message}},fallback:function(t){return this.model.get_property_value_by_name(t)||Upfront.data.upfront_code.defaults.fallbacks[t]},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)}});return n})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/map-item",["scripts/upfront/bg-settings/mixins","scripts/upfront/inline-panels/map-editor"],function(i,n){var o=Upfront.Views.Editor.Settings.Item.extend(_.extend({},i,{events:{"click .open-map-code-panel-button":"init_code_panel"},group:!1,initialize:function(i){var n=this,o=this.model.get_property_value_by_name("background_map_center"),r=function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t)};o||(this.model.init_property("background_map_center",[-37.818,144.976]),this.model.init_property("background_map_zoom",10),this.model.init_property("background_map_style","ROADMAP"),this.model.init_property("background_map_controls",""),this.model.init_property("background_show_markers",""),this.model.init_property("background_use_custom_map_code",""));var s={location:new Upfront.Views.Editor.Field.Text({model:this.model,label:e.location+":",property:"background_map_location",use_breakpoint_property:!0,placeholder:"e.g 123 Nice St",change:function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t,!0),n._location=t,n._location_changed=!0},rendered:function(){this.$el.addClass("uf-bgsettings-map-location")}}),refresh:new Upfront.Views.Editor.Field.Button({label:"",compact:!0,classname:"upfront-field-icon upfront-field-icon-refresh-2 upfront-refresh-map",on_click:function(){var t=n.$el.find('input[name="background_map_location"]');t.length&&(n._location=t.val()),n._location_changed=!0,n.geocode_location()}}),zoom:new Upfront.Views.Editor.Field.Slider({model:this.model,label:e.zoom+":",property:"background_map_zoom",use_breakpoint_property:!0,default_value:8,min:1,max:19,step:1,change:r,rendered:function(){this.$el.addClass("uf-bgsettings-map-zoom")}}),style:new Upfront.Views.Editor.Field.Select({model:this.model,label:e.map_style+":",property:"background_map_style",use_breakpoint_property:!0,values:[{label:e.roadmap,value:"ROADMAP"},{label:e.satellite,value:"SATELLITE"},{label:e.hybrid,value:"HYBRID"},{label:e.terrain,value:"TERRAIN"}],change:r,rendered:function(){this.$el.addClass("uf-bgsettings-map-style")}}),controls:new Upfront.Views.Editor.Field.Select({model:this.model,label:e.map_controls+":",placeholder:e.choose_ctrl,property:"background_map_controls",use_breakpoint_property:!0,multiple:!0,default_value:["pan"],values:[{label:e.pan,value:"pan"},{label:e.zoom,value:"zoom"},{label:e.map_type,value:"map_type"},{label:e.scale,value:"scale"},{label:e.street_view,value:"street_view"},{label:e.overview_map,value:"overview_map"}],change:r,rendered:function(){this.$el.addClass("uf-bgsettings-map-controls")}}),show_markers:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:e.show_markers,property:"background_show_markers",use_breakpoint_property:!0,hide_label:!0,values:[{label:e.show_markers,value:1}],multiple:!1,change:r,rendered:function(){this.$el.addClass("uf-bgsettings-map-show-marker")}}),custom_map_code:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:e.custom_map_code,property:"background_use_custom_map_code",hide_label:!0,values:[{label:e.custom_map_code+'<span class="checkbox-info" title="'+e.custom_map_code_info+'"></span>',value:1}],multiple:!1,change:function(){var e=this.get_value();this.property.set({value:e}),1==e?t(".open-map-code-panel-button",this.$el.parent()).show():t(".open-map-code-panel-button",this.$el.parent()).hide()},rendered:function(){this.$el.addClass("uf-bgsettings-map-custom-map-code")}}),open_map_code_panel:new Upfront.Views.Editor.Field.Button({model:n.model,label:e.open_map_code_panel,className:"open-map-code-panel-button",compact:!0})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-mapitem"),i.fields=_.map(s,function(t){return t}),this._location=s.location.get_value(),this.$el.on("keypress",'input[name="background_map_location"]',function(e){13===e.keyCode&&(n._location=t(this).val(),n._location_changed=!0,n.geocode_location())}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,i)},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),t('[name="background_use_custom_map_code"]',this.$el).trigger("change")},geocode_location:function(){if(!(window._upfront_api_keys||{}).gmaps)return!1;if(1!=this._geocoding&&this._location_changed){var t=this,e=this._location,i=new google.maps.Geocoder;e&&(this._geocoding=!0,i.geocode({address:e},function(e,i){if(i!=google.maps.GeocoderStatus.OK)return t._geocoding=!1,t._location_changed=!1,!1;var n=e[0].geometry.location;t.model.set_breakpoint_property("background_map_center",[n.lat(),n.lng()]),t._geocoding=!1,t._location_changed=!1}))}},init_code_panel:function(){var t=new n({model:this.model});t.render()}}));return o})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/slider-item",["scripts/upfront/bg-settings/mixins"],function(i){var n=Upfront.Views.Editor.Settings.Item.extend(_.extend({},i,{group:!1,initialize:function(t){var i=this,n=function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t)},r={transition:new Upfront.Views.Editor.Field.Select({model:this.model,label:e.slider_transition+":",property:"background_slider_transition",use_breakpoint_property:!0,default_value:"crossfade",icon_class:"upfront-region-field-icon",values:[{label:e.slide_down,value:"slide-down",icon:"bg-slider-slide-down"},{label:e.slide_up,value:"slide-up",icon:"bg-slider-slide-up"},{label:e.slide_left,value:"slide-left",icon:"bg-slider-slide-left"},{label:e.slide_right,value:"slide-right",icon:"bg-slider-slide-right"},{label:e.crossfade,value:"crossfade",icon:"bg-slider-crossfade"}],change:n,rendered:function(){this.$el.addClass("uf-bgsettings-slider-transition")}}),rotate:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_slider_rotate",use_breakpoint_property:!0,default_value:!0,layout:"horizontal-inline",multiple:!1,values:[{label:e.autorotate_each+" ",value:!0}],change:function(){var t=this.get_value();this.property.set({value:!!t})},rendered:function(){this.$el.addClass("uf-bgsettings-slider-rotate")}}),rotate_time:new Upfront.Views.Editor.Field.Number({model:this.model,property:"background_slider_rotate_time",use_breakpoint_property:!0,default_value:5,min:1,max:60,step:1,suffix:"sec",change:n,rendered:function(){this.$el.addClass("uf-bgsettings-slider-time")}}),control:new Upfront.Views.Editor.Field.Select({model:this.model,property:"background_slider_control",use_breakpoint_property:!0,default_value:"always",label:e.show_ctrl+":",values:[{label:e.always,value:"always"},{label:e.on_hover,value:"hover"}],change:n,rendered:function(){this.$el.addClass("uf-bgsettings-slider-control")}}),control_style:new Upfront.Views.Editor.Field.Select({model:this.model,property:"background_slider_control_style",use_breakpoint_property:!0,default_value:"both",label:e.controls_style+":",values:[{label:Upfront.Settings.l10n.slider_element.dots,value:"dots"},{label:Upfront.Settings.l10n.slider_element.arrows,value:"arrows"},{label:Upfront.Settings.l10n.slider_element.both,value:"both"}],change:n,rendered:function(){this.$el.addClass("uf-bgsettings-slider-control-style")}})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-slideritem"),t.fields=_.map(r,function(t){return t}),this.slides_item=new o({model:this.model,title:e.slides_order+":"}),_.isUndefined(t.slides_item_el)?this.on("panel:set",function(){i.panel.settings.push(i.slides_item),i.slides_item.panel=i.panel,i.slides_item.trigger("panel:set")}):(this.slides_item.render(),t.slides_item_el.append(this.slides_item.$el)),this.on("show",function(){var t=this.model.get_breakpoint_property_value("background_slider_images",!0);t||i.upload_slider_images(),i.slides_item.trigger("show")}),this.on("hide",function(){i.slides_item.trigger("hide")}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)},upload_slider_images:function(){var t=this;Upfront.Views.Editor.ImageSelector.open({multiple:!0,multiple_sizes:!1}).done(function(e){var i=[];_.each(e,function(t,e){e=parseInt(e,10),e&&i.push(e)}),t.model.set_breakpoint_property("background_slider_images",i),t.slides_item.update_slider_slides(),Upfront.Views.Editor.ImageSelector.close()})}})),o=Upfront.Views.Editor.Settings.Item.extend(_.extend({},i,{initialize:function(e){var i=this;this.$el.on("click",".upfront-bg-slider-add-image",function(t){t.preventDefault(),t.stopPropagation(),Upfront.Views.Editor.ImageSelector.open({multiple:!0,multiple_sizes:!1}).done(function(t){var e=_.clone(i.model.get_breakpoint_property_value("background_slider_images",!0)||[]);_.each(t,function(t,i){i=parseInt(i,10),i&&e.push(i)}),i.model.set_breakpoint_property("background_slider_images",e),Upfront.Views.Editor.ImageSelector.close(),i.update_slider_slides()})}),this.$el.on("click",".upfront-bg-slider-delete-image",function(e){e.preventDefault(),e.stopPropagation();var n=t(this).closest(".upfront-bg-slider-image"),o=n.data("image-id"),r=n.index(),s=_.clone(i.model.get_breakpoint_property_value("background_slider_images",!0)||[]);_.isString(o)&&o.match(/^[0-9]+$/)&&(o=parseInt(o,10)),r!=-1&&s.length>0&&s.splice(r,1),i.model.set_breakpoint_property("background_slider_images",s),n.remove()}),this.on("show",function(){i.update_slider_slides()}),this.$el.addClass("uf-bgsettings-item uf-bgsettings-slider-slidesitem"),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e)},update_slider_slides:function(){var e=this,i=e.model.get_breakpoint_property_value("background_slider_images",!0),n=t('<div class="upfront-bg-slider-add-image upfront-icon upfront-icon-region-add-slide"></div>'),o=this.$el.find(".upfront-settings-item-content");o.html(""),i.length>0?Upfront.Views.Editor.ImageEditor.getImageData(i).done(function(r){var s=r.data.images;_.each(i,function(e){var i=_.isNumber(e)||e.match(/^\d+$/)?s[e]:_.find(s,function(t){return t.full[0].split(/[\\/]/).pop()==e.split(/[\\/]/).pop()}),n=t('<div class="upfront-bg-slider-image" />');n.data("image-id",e),"undefined"!=typeof i.thumbnail&&n.css({background:'url("'+i.thumbnail[0]+'") no-repeat 50% 50%',backgroundSize:"100% auto"}),n.append('<span href="#" class="upfront-bg-slider-delete-image">&times;</span>'),o.append(n)}),o.hasClass("ui-sortable")?o.sortable("refresh"):o.sortable({items:">  .upfront-bg-slider-image",update:function(){var i=[];o.find(".upfront-bg-slider-image").each(function(){var e=t(this).data("image-id");e=parseInt(e,10),e&&i.push(e)}),e.model.set_breakpoint_property("background_slider_images",i)}}),o.append(n)}):o.append(n)}}));return n})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("scripts/upfront/bg-settings/video-item",["scripts/upfront/bg-settings/mixins"],function(t){var i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},t,{group:!1,initialize:function(t){var i=this,n={video:new Upfront.Views.Editor.Field.Text({model:this.model,label:e.video_url+":",property:"background_video",use_breakpoint_property:!0,default_value:"",placeholder:e.video_source,change:function(){var t=this.get_value();t&&(i.model.set_breakpoint_property("background_video_embed",""),i.get_video_embed(t).done(function(t){t.data&&t.data.width&&t.data.height&&(i.model.set_breakpoint_property("background_video_width",t.data.width),i.model.set_breakpoint_property("background_video_height",t.data.height),i.model.set_breakpoint_property("background_video_embed",t.data.html))})),this.model.set_breakpoint_property(this.property_name,t)},rendered:function(){this.$el.addClass("uf-bgsettings-video-url")}}),mute:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_video_mute",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:e.mute_on_play,value:1}],change:function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-mute")}}),autoplay:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_video_autoplay",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:e.autoplay,value:1}],change:function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-autoplay")}}),loop:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"background_video_loop",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:e.loop,value:1}],change:function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-loop")}}),style:new Upfront.Views.Editor.Field.Select({model:this.model,property:"background_video_style",use_breakpoint_property:!0,layout:"horizontal-inline",default_value:["crop"],values:[{label:e.scale_and_crop,value:"crop"},{label:e.no_crop_embed,value:"full"},{label:e.no_crop_bg,value:"inside"}],change:function(){var t=this.get_value();"inside"==t?n.color.$el.show():n.color.$el.hide(),this.model.set_breakpoint_property(this.property_name,t)},rendered:function(){this.$el.addClass("uf-bgsettings-video-style")}}),color:new Upfront.Views.Editor.Field.Color({model:this.model,label:e.bg_color_short,label_style:"inline",property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(t){i.preview_color(t)},change:function(t){i.update_color(t)},hide:function(t){i.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-video-color")}})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-videoitem"),t.fields=_.map(n,function(t){return t}),this.on("show",function(){n.style.trigger("changed")}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)},get_video_embed:function(t){return Upfront.Util.post({action:"upfront-media-get_embed_raw",media:t})}}));return i})}(jQuery),define("scripts/upfront/element-settings/settings-container",[],function(){var t=Backbone.View.extend({save_settings:function(){if(this.settings){var t=this;this.settings.each(function(e){if(!e.handlesSaving&&(e.fields||e.settings).size()>0)e.save_fields();else if(!e.handlesSaving){
var i=t.model.get_property_value_by_name(e.get_name());i!=e.get_value()&&t.model.set_property(e.get_name(),e.get_value())}}),this.on_save&&this.on_save(),this.onSaveSettings&&this.onSaveSettings()}},cleanUp:function(){this.settings&&this.settings.each(function(t){(t||{}).remove&&t.remove()}),this.$el.off(),this.remove()}});return t}),function(t){define("scripts/upfront/element-settings/root-panel-mixin",[],function(){var e={className:"uf-settings-panel upfront-settings_panel",events:{"click .uf-settings-panel__title":"toggleBody"},getTitle:function(){var t=this.options.title?this.options.title:this.title;return t=t?t:"Default Panel Title"},getBody:function(){var e=t("<div />");return e.append("<p>Implement getBody() in child class</p>"),e},toggleBody:function(){this.$el.find(".uf-settings-panel__body").toggle(),this.$el.toggleClass("uf-settings-panel--expanded")},hideBody:function(){this.$el.find(".uf-settings-panel__body").hide(),this.$el.removeClass("uf-settings-panel--expanded")},showBody:function(){this.$el.find(".uf-settings-panel__body").show(),this.$el.addClass("uf-settings-panel--expanded")},render:function(){var t;this.$el.html('<div class="uf-settings-panel__title">'+this.getTitle()+"</div>"),t=this.getBody(),t.addClass("uf-settings-panel__body"),this.$el.append(t),this.$el.addClass("uf-settings-panel--expanded")}};return e})}(jQuery),define("text!elements/upfront-slider/tpl/backend.html",[],function(){return'<div>\n<script type="text/template" id="slides-setting-tpl">\n<div class="uslider-slides-setting">\n{[ slides.each(function(slide){ ]}\n<div class="uslider_content_imgslide uslider_content_slide" rel="{{slide.id}}">\n\t\t<div class="uslider_content_img" style="background-image:url({{slide.get(\'src\')}});"></div>\n\t\t<img src="{{slide.get(\'src\')}}" />\n\t\t<span class="remove-slide"></span>\n\t</div>\n{[ }) ]}\n<div class="uslider-add upfront-bg-slider-add-image upfront-icon upfront-icon-region-add-slide">{{l10n.add_slide}}</div>\n</div>\n</script>\n\n\n<script type="text/template" id="startingTpl">\n\t<div class="upfront-image-starting-select upfront-ui upfront-initial-overlay-wrapper" style="min-height:{{startingHeight}}px">\n\t\t<div class="uslider-starting-centered upfront-initial-overlay-wrapper" style="height: 100px">\n\t\t\t<div class="uslider-starting-title">{{l10n.choose_type}}</div>\n\t\t\t<div class="uslider-starting-info">{{l10n.can_change}}</div>\n\t\t\t<div class="uslider-starting-options">\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t<input type="radio" class="upfront-field-radio" checked="checked" id="uslider-starting-default" value="default" name="upfront-starting-style">\n\t\t\t\t\t<label for="uslider-starting-default">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-nocaption"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text">{{l10n.default}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t<input type="radio" class="upfront-field-radio" id="uslider-starting-notext" value="notext" name="upfront-starting-style">\n\t\t\t\t\t<label for="uslider-starting-notext">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-nocaption"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text">{{l10n.img_only}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t<input type="radio" class="upfront-field-radio" id="uslider-starting-over" value="over" name="upfront-starting-style">\n\t\t\t\t\t<label for="uslider-starting-over">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-bottomOver"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text">{{l10n.txt_over_img}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t<input type="radio" class="upfront-field-radio" id="uslider-starting-below" value="below" name="upfront-starting-style">\n\t\t\t\t\t<label for="uslider-starting-below">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-below"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text">{{l10n.txt_below_img}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t<input type="radio" class="upfront-field-radio" id="uslider-starting-side" value="side" name="upfront-starting-style">\n\t\t\t\t\t<label for="uslider-starting-side">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-right"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text">{{l10n.txt_on_side}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<a href="#" class="button upfront-image-select">{{l10n.choose_img}}</a>\n\t\t</div>\n\t</div>\n</script>\n\n\n</div>\n'}),function(t){define("scripts/upfront/settings/fields/slides",["text!elements/upfront-slider/tpl/backend.html"],function(e){var i=Upfront.Settings.l10n.slider_element,n=Upfront.Views.Editor.Field.Field.extend({template:_.template(t(e).find("#slides-setting-tpl").html()),events:{"click .uslider-add":"addSlides","click .remove-slide":"onRemoveSlide"},initialize:function(){this.listenTo(this.model.slideCollection,"add remove sort reset",this.render)},onRemoveSlide:function(e){this.model.view.removeSlide(t(e.currentTarget).parent())},render:function(){var e=this;this.$el.html(this.template({slides:this.model.slideCollection,l10n:i})),this.$(".uslider-slides-setting").sortable({items:".uslider_content_imgslide",start:function(t,e){e.item.addClass("uslider-is-dragged")},stop:function(t,i){var n=i.item.attr("rel"),o=e.getSlidePosition(n),r=!1;o!=-1&&(r=e.model.slideCollection.get(n),e.model.slideCollection.remove(n,{silent:!0}),e.model.slideCollection.add(r,{at:o}))}}),setTimeout(function(){var e=t("#settings");e.height(e.find(".upfront-settings_panel:visible").outerHeight())},100)},addSlides:function(){this.model.trigger("addRequest")},getSlidePosition:function(e){var i=0,n=!1;return this.$("div.uslider_content_slide").each(function(o){t(this).attr("rel")==e&&(n=i),i++}),n!==!1?n:-1},get_name:function(){return"slides"},get_value:function(){return this.model.slideCollection.toJSON()}});return n})}(jQuery),define("scripts/upfront/settings/field-factory",["scripts/upfront/settings/fields/slides"],function(t){var e=function(){var e={SlidesField:t};this.createField=function(t,i){var n=Upfront.Views.Editor.Field[t];if(_.isUndefined(n)&&(n=e[t]),"Settings_CSS"===t&&(n=Upfront.Views.Editor.Settings.Settings_CSS),_.isUndefined(n))throw"There is no '"+t+"' field class defined.";return _.isFunction(i.values)&&(i.values=i.values()),new n(i)}};return fieldFactory=new e,fieldFactory}),function(t){define("scripts/upfront/settings/modules/base-module",[],function(){var t=Backbone.View.extend({initialize:function(t){var e=this;e.options=t,this.fields=t.fields?_(t.fields):_([]),this.on("panel:set",function(){e.fields.each(function(t){t.panel=e.panel,t.trigger("panel:set")})})},render:function(){this.$el.html(""),this.options.title&&this.options.toggle!==!0&&this.$el.append('<div class="upfront-settings-item-title">'+this.options.title+"</div>"),this.$el.append('<div class="upfront-settings-item-content"></div>');var t=this.$el.find(".upfront-settings-item-content");this.fields.each(function(e){e.render(),e.delegateEvents(),t.append(e.el)}),this.trigger("rendered")},save_fields:function(){var t=_([]);this.fields.each(function(e,i,n){if(e.property){var o=e.get_value(),r=e.get_saved_value();e.multiple||o==r?!e.multiple||o.length==r.length&&0===_.difference(o,r).length||t.push(e):t.push(e)}}),t.each(function(t,e,i){t.use_breakpoint_property?t.model.set_breakpoint_property(t.property_name,t.get_value(),!0):t.property.set({value:t.get_value()},{silent:!0})}),t.size()>0&&(this.panel.is_changed=!0)},remove:function(){this.fields&&this.fields.each(function(t){t.remove()}),Backbone.View.prototype.remove.call(this)}});return t})}(jQuery),define("scripts/upfront/settings/modules/typography",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"settings_module typography_settings_item",group:!0,get_title:function(){return this.options.title},initialize:function(t){this.options=t||{},this.fieldCounter=0,this.currentElement="";var i=this,n=this.options.state,o="no-toggle";"undefined"!=typeof i.options.elements&&this.fieldCounter++,"undefined"!=typeof this.options.default_element&&(this.currentElement=this.options.default_element+"-"),"undefined"!=typeof this.model.get(n+"-element-type")&&"undefined"!=typeof this.options.elements&&(this.currentElement=this.model.get(n+"-element-type")+"-"),this.options.toggle===!0&&(this.fieldCounter++,o="element-toggled"),this.fields=_([new Upfront.Views.Editor.Field.Typeface_Chosen_Select({name:this.currentElement+this.options.fields.typeface,model:this.model,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_fonts_for_select(),default_value:this.model.get(this.currentElement+this.options.fields.typeface),label:e.typeface,select_width:"225px",label_style:"inline",className:n+"-font-face static typeFace "+o,change:function(t){i.model.set(i.currentElement+i.options.fields.typeface,t),i.fields._wrapped[1+i.fieldCounter].stopListening(),i.fields._wrapped[1+i.fieldCounter]=new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({model:this.model,name:i.currentElement+i.options.fields.fontstyle,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(i.model.get(i.currentElement+i.options.fields.typeface)),label:e.weight_style,font_family:i.model.get(i.options.fields.typeface),select_width:"225px",label_style:"inline",className:n+"-font-style static weightStyle "+o,change:function(t){var e=Upfront.Views.Font_Model.parse_variant(t),n={};n[i.currentElement+i.options.fields.fontstyle]=t,n[i.currentElement+i.options.fields.weight]=e.weight,n[i.currentElement+i.options.fields.style]=e.style,i.model.set(n)},show:function(t){null!==t&&i.fields._wrapped[1+i.fieldCounter].set_option_font(t)}}),i.$el.empty(),i.render()}}),new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({model:this.model,name:this.currentElement+this.options.fields.fontstyle,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(i.model.get(this.currentElement+i.options.fields.typeface)),default_value:this.model.get(this.currentElement+this.options.fields.fontstyle),label:e.weight_style,font_family:i.model.get(this.options.fields.typeface),select_width:"225px",label_style:"inline",className:n+"-font-style static weightStyle "+o,change:function(t){var e=Upfront.Views.Font_Model.parse_variant(t);i.model.set(i.currentElement+i.options.fields.fontstyle,t),i.model.set(i.currentElement+i.options.fields.weight,e.weight),i.model.set(i.currentElement+i.options.fields.style,e.style)},show:function(t){null!==t&&i.fields._wrapped[1+i.fieldCounter].set_option_font(t)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-font-size fontSize "+o,name:this.currentElement+this.options.fields.size,default_value:this.model.get(this.currentElement+this.options.fields.size),label:e.size,label_style:"inline",suffix:e.px,change:function(t){i.model.set(i.currentElement+i.options.fields.size,t)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-font-lineheight lineHeight "+o,name:this.currentElement+this.options.fields.line_height,label:e.line_height,label_style:"inline",default_value:this.model.get(this.currentElement+this.options.fields.line_height),min:0,step:.1,change:function(t){i.model.set(i.currentElement+i.options.fields.line_height,t)}}),new Upfront.Views.Editor.Field.Color({model:this.model,className:n+"-font-color upfront-field-wrap upfront-field-wrap-color sp-cf fontColor "+o,name:this.currentElement+this.options.fields.color,default_value:this.model.get(this.currentElement+this.options.fields.color),blank_alpha:0,label_style:"inline",label:e.color,spectrum:{preferredFormat:"rgb",change:function(t){if(!t)return!1;var e=t.get_is_theme_color()!==!1?t.theme_color:t.toRgbString();i.model.set(i.currentElement+i.options.fields.color,e)},move:function(t){if(!t)return!1;var e=t.get_is_theme_color()!==!1?t.theme_color:t.toRgbString();i.model.set(i.currentElement+i.options.fields.color,e)}}})]),"undefined"!=typeof i.options.elements&&this.fields.unshift(new Upfront.Views.Editor.Field.Select({model:this.model,label:e.type_element,label_style:"inline",name:n+"-element-type",className:n+"-select-element selectElement "+o,values:i.options.elements,change:function(t){i.model.set(n+"-element-type",t),i.$el.empty(),i.render()},show:function(t){i.currentElement=t+"-";var e=i.get_field_values(t);i.update_fields(e)}})),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useTypography checkbox-title "+o,name:i.options.fields.use,label:"",multiple:!1,values:[{label:e.typography,value:"yes",checked:this.model.get(i.options.fields.use)}],change:function(t){console.log("triggered change on checkbox"),i.model.set(i.options.fields.use,t),i.reset_fields(t)},show:function(t,e){var i=e.closest(".state_modules");"yes"==t?(i.find("."+n+"-select-element").show(),i.find("."+n+"-font-face").show(),i.find("."+n+"-font-style").show(),i.find("."+n+"-font-size").show(),i.find("."+n+"-font-lineheight").show(),i.find("."+n+"-font-color").show()):(i.find("."+n+"-select-element").hide(),i.find("."+n+"-font-face").hide(),i.find("."+n+"-font-style").hide(),i.find("."+n+"-font-size").hide(),i.find("."+n+"-font-lineheight").hide(),i.find("."+n+"-font-color").hide())}})))},reset_fields:function(t){var e,i=this;"undefined"!=typeof t&&"yes"===t&&("undefined"!=typeof this.options.elements?_.each(this.options.elements,function(t){var n=t.value+"-";e=i.get_static_field_values(i.options.prepend,n),i.update_fields(e),i.save_static_values(e,n)}):(e=this.get_static_field_values(this.options.prepend,""),i.update_fields(e),this.save_static_values(e,"")),this.$el.empty(),this.render())},save_static_values:function(t,e){var i=Upfront.Views.Font_Model.parse_variant(t.fontstyle);this.model.set(e+this.options.fields.typeface,t.typeface),this.model.set(e+this.options.fields.fontstyle,t.fontstyle),this.model.set(e+this.options.fields.weight,i.weight),this.model.set(e+this.options.fields.style,i.style),this.model.set(e+this.options.fields.size,t.fontsize),this.model.set(e+this.options.fields.line_height,t.line_height),this.model.set(e+this.options.fields.color,t.color)},get_static_field_values:function(t,e){var i={},n="";return"undefined"!=typeof this.options.prefix&&(n=this.options.prefix+"-"),i.typeface=this.model.get(this.clear_prepend(e+n+this.options.fields.typeface,t))||"",i.fontstyle=this.model.get(this.clear_prepend(e+n+this.options.fields.fontstyle,t))||"",i.fontsize=this.model.get(this.clear_prepend(e+n+this.options.fields.size,t))||"",i.line_height=this.model.get(this.clear_prepend(e+n+this.options.fields.line_height,t))||"",i.color=this.model.get(this.clear_prepend(e+n+this.options.fields.color,t))||"",i},clear_prepend:function(t,e){return t.replace(e,"")},get_field_values:function(t){var e={};if("undefined"!=typeof this.options.global_typography&&this.options.global_typography===!0){var i=Upfront.mainData.global_typography[this.normalize_elements_selector(t)];i=i||{},e.typeface=this.model.get(this.currentElement+this.options.fields.typeface)||i.font_face||"",e.fontstyle=this.model.get(this.currentElement+this.options.fields.fontstyle)||i.weight+" "+i.style||"",e.fontsize=this.model.get(this.currentElement+this.options.fields.size)||i.size||"",e.line_height=this.model.get(this.currentElement+this.options.fields.line_height)||i.line_height||"",e.color=this.model.get(this.currentElement+this.options.fields.color)||i.color||""}else e.typeface=this.model.get(this.currentElement+this.options.fields.typeface)||"",e.fontstyle=this.model.get(this.currentElement+this.options.fields.fontstyle)||"",e.fontsize=this.model.get(this.currentElement+this.options.fields.size)||"",e.line_height=this.model.get(this.currentElement+this.options.fields.line_height)||"",e.color=this.model.get(this.currentElement+this.options.fields.color)||"";return e},update_fields:function(t){this.fields._wrapped[this.fieldCounter].set_value(t.typeface),this.fields._wrapped[this.fieldCounter].set_option_font(t.typeface),this.fields._wrapped[this.fieldCounter+1].options.values=Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(t.typeface),this.fields._wrapped[this.fieldCounter+1].set_value(t.fontstyle),this.fields._wrapped[this.fieldCounter+1].set_option_font(t.fontstyle),this.fields._wrapped[this.fieldCounter+2].set_value(t.fontsize),this.fields._wrapped[this.fieldCounter+3].set_value(t.line_height),this.fields._wrapped[this.fieldCounter+4].set_value(t.color),this.fields._wrapped[this.fieldCounter+4].update_input_border_color(t.color)},normalize_elements_selector:function(t){return"a-hover"===t?"a:hover":"blockquote-alternative"===t?"blockquote.upfront-quote-alternative":t}});return i}),define("scripts/upfront/settings/modules/border",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"settings_module border_settings_item clearfix",group:!1,initialize:function(t){this.options=t||{},this.fieldCounter=0,this.currentElement="";var i=this,n=this.options.state,o="";"undefined"!=typeof this.options.elements&&this.fieldCounter++,"undefined"!=typeof this.options.default_element&&(this.currentElement=this.options.default_element+"-",o="border-with-fields"),this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useBorder checkbox-title",name:i.options.fields.use,label:"",default_value:1,multiple:!1,values:[{label:i.options.label||e.border,value:"yes"}],change:function(t){i.model.set(i.options.fields.use,t),i.reset_fields(t)},show:function(t,e){var i=e.closest(".state_modules");"yes"==t?(i.find("."+n+"-border-width").show(),i.find("."+n+"-border-type").show(),i.find("."+n+"-border-color").show(),i.find("."+n+"-border-select-element").css("opacity","1")):(i.find("."+n+"-border-width").hide(),i.find("."+n+"-border-type").hide(),i.find("."+n+"-border-color").hide(),i.find("."+n+"-border-select-element").css("opacity","0.5"))}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-border-width borderWidth "+o,name:this.currentElement+i.options.fields.width,label:"",default_value:1,suffix:e.px,values:[{label:"",value:"1"}],change:function(t){i.model.set(i.currentElement+i.options.fields.width,t),"undefined"!=typeof i.options.elements&&_.each(i.options.elements,function(e){i.model.set(e.value+"-"+i.options.fields.width,t)}),this.trigger("change")}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-border-type borderType "+o,name:this.currentElement+i.options.fields.type,default_value:"solid",values:[{label:e.solid,value:"solid"},{label:e.dashed,value:"dashed"},{label:e.dotted,value:"dotted"}],change:function(t){i.model.set(i.currentElement+i.options.fields.type,t),"undefined"!=typeof i.options.elements&&_.each(i.options.elements,function(e){i.model.set(e.value+"-"+i.options.fields.type,t)})}}),new Upfront.Views.Editor.Field.Color({model:this.model,className:n+"-border-color upfront-field-wrap upfront-field-wrap-color sp-cf borderColor "+o,name:this.currentElement+i.options.fields.color,blank_alpha:0,label_style:"inline",label:e.color,default_value:"#000",spectrum:{preferredFormat:"rgb",change:function(t){if(!t)return!1;var e=t.get_is_theme_color()!==!1?t.theme_color:t.toRgbString();i.model.set(i.currentElement+i.options.fields.color,e),"undefined"!=typeof i.options.elements&&_.each(i.options.elements,function(t){i.model.set(t.value+"-"+i.options.fields.color,e)})},move:function(t){if(!t)return!1;var e=t.get_is_theme_color()!==!1?t.theme_color:t.toRgbString();i.model.set(i.currentElement+i.options.fields.color,e),"undefined"!=typeof i.options.elements&&_.each(i.options.elements,function(t){i.model.set(t.value+"-"+i.options.fields.color,e)})}}})]),"undefined"!=typeof i.options.elements&&this.fields.unshift(new Upfront.Views.Editor.Field.Select({className:n+"-border-select-element border_selectElement",name:"tagsToApply",default_value:i.model.get("tagsToApply")||"field-button",values:i.options.elements,change:function(){var t=this.get_value();i.model.set({tagsToApply:t}),i.currentElement=t+"-"}}))},reset_fields:function(t){var e,i=this;"undefined"!=typeof t&&"yes"===t&&("undefined"!=typeof this.options.elements?_.each(this.options.elements,function(t){var n=t.value+"-";e=i.get_static_field_values(i.options.prepend,n),i.update_fields(e),i.save_static_values(e,n)}):(e=this.get_static_field_values(this.options.prepend,""),this.update_fields(e),this.save_static_values(e,"")),this.$el.empty(),this.render())},save_static_values:function(t,e){this.model.set(e+this.options.fields.width,t.width),this.model.set(e+this.options.fields.type,t.type),this.model.set(e+this.options.fields.color,t.color)},get_static_field_values:function(t,e){var i={},n="";return"undefined"!=typeof this.options.prefix&&(n=this.options.prefix+"-"),i.width=this.model.get(this.clear_prepend(e+n+this.options.fields.width,t))||"",i.type=this.model.get(this.clear_prepend(e+n+this.options.fields.type,t))||"",i.color=this.model.get(this.clear_prepend(e+n+this.options.fields.color,t))||"",i},clear_prepend:function(t,e){return t.replace(e,"")},update_fields:function(t){this.fields._wrapped[this.fieldCounter+1].set_value(t.width),this.fields._wrapped[this.fieldCounter+2].set_value(t.type),this.fields._wrapped[this.fieldCounter+3].set_value(t.color),this.fields._wrapped[this.fieldCounter+3].update_input_border_color(t.color)}});return i}),define("scripts/upfront/settings/modules/hov-animation",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"settings_module hov_animation_settings_item clearfix",group:!1,initialize:function(t){this.options=t||{};var i=this,n=this.options.state,o="no-toggle";i.options.toggle===!0&&(o="element-toggled"),this.fields=_([new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-duration duration "+o,name:i.options.fields.duration,min:0,label:e.animate_hover_changes,step:.1,values:[{label:"",value:"12"}],change:function(t){i.model.set(i.options.fields.duration,t)}}),new Upfront.Views.Editor.Field.Select({model:this.model,name:i.options.fields.easing,label:e.sec,step:.1,label_style:"inline",values:[{label:"ease",value:"ease"},{label:"linear",value:"linear"},{label:"ease-in",value:"ease-in"},{label:"ease-out",value:"ease-out"},{label:"ease-in-out",value:"ease-in-out"}],className:n+"-transition transition "+o,change:function(t){i.model.set(i.options.fields.easing,t)}})]),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useAnimation checkbox-title",name:i.options.fields.use,label:"",default_value:1,multiple:!1,values:[{label:e.animate_hover_changes,value:"yes"}],change:function(t){i.model.set(i.options.fields.use,t)},show:function(t,e){var i=e.closest(".state_modules");"yes"==t?(i.find("."+n+"-transition").show(),i.find("."+n+"-duration").show()):(i.find("."+n+"-transition").hide(),i.find("."+n+"-duration").hide())}})))}});return i}),define("scripts/upfront/settings/modules/radius",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"settings_module corner_radius_settings_item clearfix",group:!1,get_title:function(){return this.options.title},initialize:function(t){this.options=t||{},this.options.max_value&&this.options.max_value<200&&(this.options.max_value=200),this.options.max_value||(this.options.max_value=200);var i=this,n=this.options.state,o=function(){var t=this.get_value(),e={};e[i.options.fields.radius1]=t,e[i.options.fields.radius2]=t,e[i.options.fields.radius3]=t,e[i.options.fields.radius4]=t,e[i.options.fields.radius]=t,i.model.set(e,{silent:!0}),i.model.set(i.options.fields.radius_number,t),i.$el.find("input[name="+i.options.fields.radius1+"]").val(t),i.$el.find("input[name="+i.options.fields.radius2+"]").val(t),i.$el.find("input[name="+i.options.fields.radius3+"]").val(t),i.$el.find("input[name="+i.options.fields.radius4+"]").val(t),i.$el.find("input[name="+i.options.fields.radius_number+"]").val(t),i.$el.closest(".state_modules").find("."+n+"-radius-slider").css("opacity",1)},r=_.throttle(o,16),a=function(t){s=i.fields._wrapped[2],s.$el.find("#"+s.get_field_id()).slider("value",t),s.get_field().val(t),o.apply(s),t>i.options.max_value?i.$el.closest(".state_modules").find("."+n+"-radius-slider").css("opacity",.6):i.$el.closest(".state_modules").find("."+n+"-radius-slider").css("opacity",1)},l=_.throttle(a,16);this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useRadius checkbox-title",name:i.options.fields.use,label:"",default_value:1,multiple:!1,values:[{label:e.rounded_corners,value:"yes"}],change:function(t){i.model.set(i.options.fields.use,t),i.reset_fields(t)},show:function(t,e){var o=e.closest(".state_modules"),r=i.model.get(i.options.fields.lock);"yes"==t?"yes"==r?(o.find("."+n+"-radius-slider").show(),o.find("."+n+"-radius-slider-number").show()):(o.find("."+n+"-radius-slider").hide(),o.find("."+n+"-radius-slider-number").hide(),o.find("."+n+"-radius1").show(),o.find("."+n+"-radius2").show(),o.find("."+n+"-radius3").show(),o.find("."+n+"-radius4").show()):(o.find("."+n+"-radius1").hide(),o.find("."+n+"-radius2").hide(),o.find("."+n+"-radius3").hide(),o.find("."+n+"-radius4").hide(),o.find("."+n+"-radius-slider").hide(),o.find("."+n+"-radius-slider-number").hide())}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:n+"-radius-lock border_radius_lock",name:i.options.fields.lock,label:"",default_value:0,multiple:!1,values:[{label:"",value:"yes"}],show:function(t){i.model.set(i.options.fields.lock,t);var e=i.$el.closest(".state_modules"),o=i.model.get(i.options.fields.use);"yes"==t&&"yes"==o?(e.find("."+n+"-radius-slider").show(),e.find("."+n+"-radius-slider-number").show(),e.find("."+n+"-radius1").hide(),e.find("."+n+"-radius2").hide(),e.find("."+n+"-radius3").hide(),e.find("."+n+"-radius4").hide()):"yes"==o&&(e.find("."+n+"-radius-slider").hide(),e.find("."+n+"-radius-slider-number").hide(),e.find("."+n+"-radius1").show(),e.find("."+n+"-radius2").show(),e.find("."+n+"-radius3").show(),e.find("."+n+"-radius4").show())}}),new Upfront.Views.Editor.Field.Slider({className:n+"-radius-slider upfront-field-wrap upfront-field-wrap-slider radius-slider",model:this.model,name:i.options.fields.radius,suffix:e.px,min:0,max:i.options.max_value,step:10,change:r,show:function(){var t=i.model.get(i.options.fields.radius_number);t>i.options.max_value?i.$el.closest(".state_modules").find("."+n+"-radius-slider").css("opacity",.6):i.$el.closest(".state_modules").find("."+n+"-radius-slider").css("opacity",1)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-radius-slider-number border_radius_number",name:i.options.fields.radius_number,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:l}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-radius1 border_radius border_radius1",name:i.options.fields.radius1,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(t){i.model.set(i.options.fields.radius1,t)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-radius2 border_radius border_radius2 border_radius2_static",name:i.options.fields.radius2,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(t){i.model.set(i.options.fields.radius2,t)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-radius4 border_radius border_radius4",name:i.options.fields.radius4,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(t){i.model.set(i.options.fields.radius4,t)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-radius3 border_radius border_radius3",name:i.options.fields.radius3,label:"",min:0,max:1e3,default_value:0,values:[{label:"",value:"0"}],change:function(t){i.model.set(i.options.fields.radius3,t)}})])},reset_fields:function(t){if("undefined"!=typeof t&&"yes"===t){var e=this.get_static_field_values(t,this.options.prepend);this.update_fields(t,e),this.save_static_values(t,e),this.$el.empty(),this.render()}},save_static_values:function(t,e){this.model.set(this.options.fields.lock,e.lock),this.model.set(this.options.fields.radius,e.radius),this.model.set(this.options.fields.radius_number,e.radius_number),this.model.set(this.options.fields.radius1,e.radius1),this.model.set(this.options.fields.radius2,e.radius2),this.model.set(this.options.fields.radius3,e.radius3),this.model.set(this.options.fields.radius4,e.radius4)},get_static_field_values:function(t,e){var i={},n="";return"undefined"!=typeof this.options.prefix&&(n=this.options.prefix+"-"),i.lock=this.model.get(this.clear_prepend(n+this.options.fields.lock,e))||"",i.radius=this.model.get(this.clear_prepend(n+this.options.fields.radius,e))||"",i.radius_number=this.model.get(this.clear_prepend(n+this.options.fields.radius_number,e))||"",i.radius1=this.model.get(this.clear_prepend(n+this.options.fields.radius1,e))||"",i.radius2=this.model.get(this.clear_prepend(n+this.options.fields.radius2,e))||"",i.radius3=this.model.get(this.clear_prepend(n+this.options.fields.radius3,e))||"",i.radius4=this.model.get(this.clear_prepend(n+this.options.fields.radius4,e))||"",i},clear_prepend:function(t,e){return t.replace(e,"")},update_fields:function(t,e){s=this.fields._wrapped[2],s.$el.find("#"+s.get_field_id()).slider("value",e.radius),s.get_field().val(e.radius),s.trigger("changed")}});return i}),define("scripts/upfront/settings/modules/selectbox",["scripts/upfront/settings/modules/base-module"],function(t){var e=t.extend({className:"settings_module selectbox_settings_item clearfix",group:!0,get_title:function(){return this.options.title},initialize:function(t){this.options=t||{},"undefined"==typeof this.options.title&&(this.group=!1);var e=this,i=this.options.custom_class,n=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-select select-module "+i,name:e.options.fields.name,default_value:e.options.default_value,label:e.options.label,values:e.options.values,change:function(t){e.model.set(e.options.fields.name,t)}})])}});return e}),define("scripts/upfront/settings/modules/checkbox",["scripts/upfront/settings/modules/base-module"],function(t){var e=(Upfront.Settings.l10n.preset_manager,t.extend({className:"settings_module checkbox_settings_item clearfix",group:!1,initialize:function(t){this.options=t||{};var e=this,i=(this.options.state,Upfront.Views.Editor.Field.Text.extend({get_field_html:function(){return'<button class="checkbox-tooltip" title="'+e.options.tooltip_label+'">&nbsp;</button>'}}));this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"checkbox-module checkbox-title",name:e.options.fields.checkbox,label:"",default_value:1,multiple:!1,values:[{label:e.options.label,value:"yes"}],change:function(t){e.model.set(e.options.fields.checkbox,t)},show:function(t,e){}})]),"undefined"!=typeof e.options.tooltip&&e.options.tooltip&&this.fields.push(new i({model:this.model,label:"",className:"tooltip-icon"}))}}));return e}),define("scripts/upfront/settings/modules/caption-location",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.image_element,i=t.extend({className:"settings_module image-caption-location caption_location clearfix",
group:!1,initialize:function(t){this.options=t||{};var i=this,n=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useCaptions checkbox-title",name:"use_captions",label:"",default_value:1,multiple:!1,values:[{label:e.settings.show_caption,value:"yes"}],change:function(t){i.model.set("use_captions",t)},show:function(t,e){var i=e.closest(".state_modules");"yes"==t?(i.find("."+n+"-caption-select").show(),i.find("."+n+"-caption-trigger").show()):(i.find("."+n+"-caption-select").hide(),i.find("."+n+"-caption-trigger").hide())}}),new Upfront.Views.Editor.Field.Radios({className:n+"-caption-trigger field-caption_trigger upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios over_image_field",model:this.model,name:"caption-trigger",label:"",layout:"horizontal-inline",values:[{label:e.settings.always,value:"always_show"},{label:e.settings.hover,value:"hover_show"}],change:function(t){i.model.set("caption-trigger",t)},init:function(){i.listenTo(this.model,"change",i.render)},rendered:function(){_.delay(this.options.disable_hover_show,200)},disable_hover_show:function(){i.$el.find("[value='hover_show']").attr("disabled",!1),"below_image"===i.model.get("caption-position")&&i.$el.find("[value='hover_show']").attr("disabled",!0)}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-caption-select caption_select",name:"caption-position-value",default_value:"topOver",label:e.ctrl.caption_position,values:[{label:e.ctrl.over_top,value:"topOver",icon:"topOver"},{label:e.ctrl.over_bottom,value:"bottomOver",icon:"bottomOver"},{label:e.ctrl.cover_top,value:"topCover",icon:"topCover"},{label:e.ctrl.cover_middle,value:"middleCover",icon:"middleCover"},{label:e.ctrl.cover_bottom,value:"bottomCover",icon:"bottomCover"},{label:e.ctrl.below,value:"below",icon:"below"}],change:function(t){switch(i.model.set("caption-position-value",t),t){case"topOver":i.model.set("caption-position","over_image"),i.model.set("caption-alignment","top");break;case"bottomOver":i.model.set("caption-position","over_image"),i.model.set("caption-alignment","bottom");break;case"topCover":i.model.set("caption-position","over_image"),i.model.set("caption-alignment","fill");break;case"middleCover":i.model.set("caption-position","over_image"),i.model.set("caption-alignment","fill_middle");break;case"bottomCover":i.model.set("caption-position","over_image"),i.model.set("caption-alignment","fill_bottom");break;case"below":i.model.set("caption-position","below_image"),i.model.set("caption-alignment",!1),i.model.set("caption-trigger","always_show")}}})])}});return i}),define("scripts/upfront/settings/modules/gallery-caption-location",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.gallery_element,i=t.extend({className:"settings_module caption_location gallery-caption-location clearfix",group:!1,initialize:function(t){this.options=t||{};var i=this,n=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useCaptions checkbox-title",name:"use_captions",label:"",default_value:1,multiple:!1,values:[{label:e.panel.show_caption,value:"yes"}],change:function(t){i.model.set("use_captions",t)},show:function(t,e){var o=e.closest(".state_modules");if("yes"==t){o.find("."+n+"-caption-select").show(),o.find("."+n+"-caption-trigger").show(),o.find("."+n+"-caption-height").show();var r=i.model.get("caption-height",t);"fixed"===r&&o.find("."+n+"-caption-height-number").show()}else o.find("."+n+"-caption-select").hide(),o.find("."+n+"-caption-trigger").hide(),o.find("."+n+"-caption-height").hide(),o.find("."+n+"-caption-height-number").hide()}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-caption-select caption_select",name:"captionType",default_value:"below",label:e.panel.caption_location,values:[{value:"over",label:e.panel.over,icon:"over"},{value:"below",label:e.panel.under,icon:"below"}],change:function(t){i.model.set("captionType",t),"below"==t&&i.model.set("showCaptionOnHover","0")},show:function(t,e){var i=e.closest(".state_modules");"below"===t||"undefined"==typeof t?i.find(".gallery-caption-on-hover").hide():i.find(".gallery-caption-on-hover").show()}}),new Upfront.Views.Editor.Field.Radios({className:n+"-caption-trigger field-caption_trigger gallery-caption-on-hover upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios over_image_field",model:this.model,name:"showCaptionOnHover",label:"",layout:"horizontal-inline",values:[{label:e.panel.always,value:"0"},{label:e.panel.hover,value:"1"}],change:function(t){i.model.set("showCaptionOnHover",t)}}),new Upfront.Views.Editor.Field.Radios({className:n+"-caption-height field-caption-height upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",model:this.model,name:"caption-height",label:e.panel.caption_height,layout:"horizontal-inline",values:[{label:e.panel.auto,value:"auto"},{label:e.panel.fixed,value:"fixed"}],change:function(t){i.model.set("caption-height",t)},show:function(t,e){var o=e.closest(".state_modules"),r=i.model.get("use_captions");"yes"===r&&("fixed"===t?o.find("."+n+"-caption-height-number").show():o.find("."+n+"-caption-height-number").hide())}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:n+"-caption-height-number caption-height-number",name:"thumbCaptionsHeight",min:1,label:"",default_value:20,values:[{label:"px",value:"1"}],change:function(t){i.model.set("thumbCaptionsHeight",t)}})]),this.listenToOnce(this,"rendered",function(){setTimeout(function(){if("yes"===i.model.get("use_captions")){i.$el.find("."+n+"-caption-select").show(),i.$el.find("."+n+"-caption-trigger").show(),i.$el.find("."+n+"-caption-height").show();var t=i.model.get("caption-height");"fixed"===t&&i.$el.find("."+n+"-caption-height-number").show()}else i.$el.find("."+n+"-caption-select").hide(),i.$el.find("."+n+"-caption-trigger").hide(),i.$el.find("."+n+"-caption-height").hide(),i.$el.find("."+n+"-caption-height-number").hide()},500)})}});return i}),define("scripts/upfront/settings/modules/colors",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"settings_module colors_settings_item clearfix",group:!0,get_title:function(){return this.options.title},initialize:function(t){this.options=t||{},this.fieldCounter=0;var i=this,n=this.options.state,o="single",r="no-toggle",s=[];this.options.toggle===!0&&this.fieldCounter++,this.options.single!==!0&&(o="two"),_.each(this.options.abccolors,function(t){i.options.toggle===!0&&(r="element-toggled");var e=new Upfront.Views.Editor.Field.Color({className:n+"-color-field upfront-field-wrap-color color-module module-color-field "+r+" "+o,blank_alpha:0,model:i.model,name:t.name,default_value:i.model.get(t.name),label_style:"inline",label:t.label,spectrum:{preferredFormat:"hex",change:function(e){if(!e)return!1;var n=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();i.model.set(t.name,n)},move:function(e){if(!e)return!1;var n=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();i.model.set(t.name,n)}}});s.push(e)}),this.fields=_(s),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useColors checkbox-title",name:i.options.fields.use,label:"",multiple:!1,values:[{label:e.color,value:"yes",checked:this.model.get(i.options.fields.use)}],change:function(t){i.model.set(i.options.fields.use,t),i.reset_fields(t)},show:function(t,e){var i=e.closest(".state_modules");"yes"==t?i.find("."+n+"-color-field").show():i.find("."+n+"-color-field").hide()}})))},reset_fields:function(t){var e=this;"undefined"!=typeof t&&"yes"===t&&(_.each(this.options.abccolors,function(t){var i=e.get_static_field_value(t,e.options.prepend);e.update_field(t,i),e.save_static_value(t,i),this.fieldCounter++}),this.$el.empty(),this.render())},save_static_value:function(t,e){this.model.set(t.name,e.color)},get_static_field_value:function(t,e){var i={},n="";return"undefined"!=typeof this.options.prefix&&(n=this.options.prefix+"-"),i.color=this.model.get(this.clear_prepend(n+t.name,e))||"",i},clear_prepend:function(t,e){return t.replace(e,"")},update_field:function(t,e){this.fields._wrapped[this.fieldCounter].set_value(e.color),this.fields._wrapped[this.fieldCounter].update_input_border_color(e.color)},render:function(){var t=this;this.constructor.__super__.render.call(this),this.fields.each(function(e){if("undefined"!=typeof e.spectrumOptions){var i=t.model.get(e.name);e.set_value(i),e.update_input_border_color(Upfront.Util.colors.to_color_value(i))}})}});return i}),define("scripts/upfront/settings/modules/element-style",["scripts/upfront/settings/modules/base-module"],function(t){var e=(Upfront.Settings.l10n.preset_manager,t.extend({className:"upfront-settings-item-anchor",initialize:function(t){this.options=t;var e=this,i=new Upfront.Views.Editor.Field.Text({model:this.model,property:"theme_style",label:"Element style:"}),n=new Upfront.Views.Editor.Field.Button({label:"Show style",compact:!0,on_click:function(){e.openCssEditor()},display:"inline"}),o=new Upfront.Views.Editor.Field.Button({label:"Remove style",compact:!0,on_click:function(){e.removeStyle()},display:"inline"});this.listenTo(i,"rendered",function(){i.$el.find("input").attr("readonly","readonly")}),this.fields=_([i,n,o]),this.on("panel:set",function(){e.fields.each(function(t){t.panel=e.panel,t.trigger("panel:set")})})},openCssEditor:function(){var t=this.model.get_property_value_by_name("theme_style");Upfront.Application.cssEditor.init({model:this.model,stylename:t,sidebar:!1,toolbar:!1,readOnly:!0})},removeStyle:function(){this.$el.find("input[type=text]").val(""),this.$el.hide(),this.model.set_property("theme_style","")}}));return e}),define("scripts/upfront/settings/modules/padding",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"padding-settings sidebar-settings clearfix",initialize:function(t){this.options=t||{};var i=this,n=Upfront.Settings.LayoutEditor.Grid.column_padding;this.listenTo(Upfront.Events,"upfront:paddings:updated",this.refresh),this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"use-padding checkbox-title",use_breakpoint_property:!0,property:"use_padding",label:"",default_value:this.model.get_breakpoint_property_value("top_padding_use")||this.model.get_breakpoint_property_value("bottom_padding_use")||this.model.get_breakpoint_property_value("left_padding_use")||this.model.get_breakpoint_property_value("right_padding_use"),multiple:!1,values:[{label:"Customize Padding",value:"yes"}],change:function(t){i.model.set_breakpoint_property("use_padding",t),"undefined"==typeof t&&(i.model.set_breakpoint_property("left_padding_num",n,!0),i.model.set_breakpoint_property("top_padding_num",n,!0),i.model.set_breakpoint_property("right_padding_num",n,!0),i.model.set_breakpoint_property("bottom_padding_num",n,!0),padding_left.get_field().val(n),padding_top.get_field().val(n),padding_right.get_field().val(n),padding_bottom.get_field().val(n),i.disable_paddings())},show:function(t,e){var n=e.closest(".upfront-settings-item-content"),o=i.model.get_breakpoint_property_value("lock_padding");"yes"==t?"yes"==o?(n.find(".padding-slider").show(),n.find(".padding-number").show()):(n.find(".padding-top").show(),n.find(".padding-bottom").show(),n.find(".padding-left").show(),n.find(".padding-right").show()):(n.find(".padding-top").hide(),n.find(".padding-bottom").hide(),n.find(".padding-left").hide(),n.find(".padding-right").hide(),n.find(".padding-slider").hide(),n.find(".padding-number").hide())}}),lock_padding=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"padding-lock",use_breakpoint_property:!0,property:"lock_padding",label:"",default_value:0,multiple:!1,values:[{label:"",value:"yes"}],show:function(t){i.model.set_breakpoint_property("lock_padding",t);var e=i.$el,n=i.model.get_breakpoint_property_value("use_padding"),o=i.model.get_breakpoint_property_value("padding_number");"yes"==t&&"yes"==n?(e.find(".padding-slider").show(),e.find(".padding-number").show(),e.find(".padding-top").hide(),e.find(".padding-bottom").hide(),e.find(".padding-left").hide(),e.find(".padding-right").hide(),i.model.set_breakpoint_property("left_padding_num",o),i.model.set_breakpoint_property("top_padding_num",o),i.model.set_breakpoint_property("right_padding_num",o),i.model.set_breakpoint_property("bottom_padding_num",o),padding_left.get_field().val(o),padding_top.get_field().val(o),padding_right.get_field().val(o),padding_bottom.get_field().val(o),"undefined"!=typeof Upfront.data.currentEntity.paddingControl&&Upfront.data.currentEntity.paddingControl.refresh()):"yes"==n&&(e.find(".padding-slider").hide(),e.find(".padding-number").hide(),e.find(".padding-top").show(),e.find(".padding-bottom").show(),e.find(".padding-left").show(),e.find(".padding-right").show())},change:function(t){i.model.set_breakpoint_property("lock_padding",t)}}),locked_slider=new Upfront.Views.Editor.Field.Slider({className:"padding-slider upfront-field-wrap",model:this.model,use_breakpoint_property:!0,property:"padding_slider",default_value:this.model.get_breakpoint_property_value("padding_slider")||n,suffix:e.px,step:5,min:0,max:250,change:function(t){i.model.set_breakpoint_property("padding_slider",t),i.model.set_breakpoint_property("padding_number",t,!0),i.model.set_breakpoint_property("left_padding_num",t,!0),i.model.set_breakpoint_property("top_padding_num",t,!0),i.model.set_breakpoint_property("right_padding_num",t,!0),i.model.set_breakpoint_property("bottom_padding_num",t,!0),locked_num.get_field().val(t),padding_left.get_field().val(t),padding_top.get_field().val(t),padding_right.get_field().val(t),padding_bottom.get_field().val(t),i.enable_lock_padding(),i.re_render_entity()},show:function(){var t=i.model.get_property_value_by_name("padding_number");t>250?i.$el.find(".padding-slider").css("opacity",.6):i.$el.find(".padding-slider").css("opacity",1)}}),locked_num=new Upfront.Views.Editor.Field.Number({className:"padding-number",model:this.model,use_breakpoint_property:!0,property:"padding_number",default_value:this.model.get_breakpoint_property_value("padding_number")||n,label:"",step:5,min:0,change:function(t){i.model.set_breakpoint_property("padding_slider",t),i.model.set_breakpoint_property("padding_number",t),locked_slider.$el.find("#"+locked_slider.get_field_id()).slider("value",t),i.model.set_breakpoint_property("left_padding_num",t,!0),i.model.set_breakpoint_property("top_padding_num",t,!0),i.model.set_breakpoint_property("right_padding_num",t,!0),i.model.set_breakpoint_property("bottom_padding_num",t,!0),padding_left.get_field().val(t),padding_top.get_field().val(t),padding_right.get_field().val(t),padding_bottom.get_field().val(t),i.enable_lock_padding(),i.re_render_entity(),t>250?i.$el.find(".padding-slider").css("opacity",.6):i.$el.find(".padding-slider").css("opacity",1)}}),padding_top=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-top",use_breakpoint_property:!0,property:"top_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("top_padding_num")||n,change:function(t){i.model.set_breakpoint_property("top_padding_num",t),i.enable_padding("top_padding_use")},focus:function(){i.$el.find(".padding-bottom label").css("border-top","3px solid #7bebc6")},blur:function(){i.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}}),padding_left=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-left",use_breakpoint_property:!0,property:"left_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("left_padding_num")||n,change:function(t){i.model.set_breakpoint_property("left_padding_num",t),i.enable_padding("left_padding_use")},focus:function(){i.$el.find(".padding-bottom label").css("border-left","3px solid #7bebc6")},blur:function(){i.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}}),padding_right=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-right",use_breakpoint_property:!0,property:"right_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("right_padding_num")||n,change:function(t){i.model.set_breakpoint_property("right_padding_num",t),i.enable_padding("right_padding_use")},focus:function(){i.$el.find(".padding-bottom label").css("border-right","3px solid #7bebc6")},blur:function(){i.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}}),padding_bottom=new Upfront.Views.Editor.Field.Number({model:this.model,className:"padding-bottom",use_breakpoint_property:!0,property:"bottom_padding_num",label:"",step:5,min:0,default_value:this.model.get_breakpoint_property_value("bottom_padding_num")||n,change:function(t){i.model.set_breakpoint_property("bottom_padding_num",t),i.enable_padding("bottom_padding_use")},focus:function(){i.$el.find(".padding-bottom label").css("border-bottom","3px solid #7bebc6")},blur:function(){i.$el.find(".padding-bottom label").css("border","1px dotted #7d99b3")}})])},refresh:function(){this.model.set_breakpoint_property("use_padding","yes");var t=this.model.get_breakpoint_property_value("lock_padding"),e=this.fields._wrapped[1].$el.find("input"),i=this.model.get_breakpoint_property_value("top_padding_num"),n=this.model.get_breakpoint_property_value("bottom_padding_num"),o=this.model.get_breakpoint_property_value("left_padding_num"),r=this.model.get_breakpoint_property_value("right_padding_num");t?e.attr("checked","checked"):e.removeAttr("checked"),e.trigger("change"),i&&this.fields._wrapped[4].get_field().val(i),o&&this.fields._wrapped[5].get_field().val(o),r&&this.fields._wrapped[6].get_field().val(r),n&&this.fields._wrapped[7].get_field().val(n)},enable_padding:function(t){this.model.set_breakpoint_property(t,"yes"),Upfront.Events.trigger("upfront:paddings:updated")},disable_paddings:function(){this.model.set_breakpoint_property("top_padding_use",""),this.model.set_breakpoint_property("bottom_padding_use",""),this.model.set_breakpoint_property("left_padding_use",""),this.model.set_breakpoint_property("right_padding_use",""),Upfront.Events.trigger("upfront:paddings:updated")},enable_lock_padding:function(){var t=this.model instanceof Upfront.Models.ModuleGroup;this.enable_padding("top_padding_use"),this.enable_padding("bottom_padding_use"),t||(this.enable_padding("left_padding_use"),this.enable_padding("right_padding_use"))},re_render_entity:function(){var t=Upfront.data.currentEntity;clearTimeout(this.refresh_timer),this.refresh_timer=setTimeout(function(){"function"==typeof t.render&&t.render()},200)}});return i}),define("scripts/upfront/settings/modules/anchor",["scripts/upfront/settings/modules/base-module"],function(t){var e=(Upfront.Settings.l10n.preset_manager,Upfront.Views.Editor.Field.Field.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input id="upfront-anchor-element-checkbox" type="checkbox" class = "upfront-field-checkbox" /> <label for="upfront-anchor-element-checkbox"><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+Upfront.Settings.l10n.global.views.anchor_nag+"</div></div>",initialize:function(t){Upfront.Views.Editor.Field.Field.prototype.initialize.call(this,t),this.options.field=new Upfront.Views.Editor.Field.Text(this.options)},render:function(){var t=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(e){e.stopPropagation(),t.field_toggle.apply(t)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(e){e.stopPropagation(),t.check_value.apply(t)}),setTimeout(function(){t.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var t=this.$el.find('[name="'+this.options.field.get_name()+'"]'),e=this.$el.find(".upfront-embedded_toggleable"),i=t.length&&t.val?t.val():"";e.removeClass("error").removeClass("ok"),i.length&&!i.match(/^[a-zA-Z]+$/)?e.addClass("error"):i.length&&e.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var t=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:t.html()}))},get_value:function(){var t=this.$el.find(":checkbox"),e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),i=e.val().replace(/[^a-zA-Z]/g,"");return t.is(":checked")&&i?i:""}})),i=t.extend({className:"upfront-settings-item-anchor",initialize:function(t){this.options=t;var i=new e({element_label:Upfront.Settings.l10n.global.views.make_element_anchor,className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple checkbox-title",model:this.model,property:"anchor"});i.on("anchor:updated",function(){this.trigger("anchor:item:updated")},this),this.fields=_([i])},save_fields:function(){this.fields.invoke("check_value"),t.prototype.save_fields.call(this)}});return i}),define("elements/upfront-newnavigation/js/menu-util",[],function(){var t=(Upfront.Settings.l10n.newnavigation_element,function(){var t=this,e=Upfront.mainData.menus,i=_.map(e,function(t,e){return{label:t.name,value:t.term_id}});this.getMenuById=function(t){var i=t+"",n=parseInt(i,10),o=_.findWhere(e,{term_id:n});return _.isUndefined(o)&&(o=_.findWhere(e,{term_id:i})),o},this.getMenuSlugById=function(t){return(this.getMenuById(t)||{}).slug},this.getSelectMenuOptions=function(){return i},this.addMenu=function(t){t.term_id=t.term_id+"",e.push(t),i.unshift({label:t.slug,value:t.term_id})},this.deleteMenu=function(t){i=_.reject(i,function(e){return e.value===t}),e=_.reject(e,function(e){return e.term_id===t})},Upfront.Events.on("menu_element:menu_created",function(e){t.addMenu(e)}),Upfront.Events.on("menu_element:delete",function(e){t.deleteMenu(e)})}),e=new t;return e}),define("text!scripts/upfront/settings/modules/menu-structure/menu-item-editor.tpl",[],function(){return'<form>\n\t<label>{{Upfront.Settings.l10n.global.content.menu_item_label}}</label>\n\t<input type="text" class="menu-item-title" value="{{ title }}">\n\t<label class="item-links-to-label">{{Upfront.Settings.l10n.global.content.links_to}}</label>\n\t<div class="menu-item-type-editor">\n\t\t{[if(type == \'external\') { ]}\n\t\t\t<input type="text" class="menu-item-external-input" value="{{url}}" placeholder="{{Upfront.Settings.l10n.global.content.type_link_url}}" >\n\t\t{[ } ]}\n\t\t{[if(type == \'entry\') { ]}\n\t\t\t<span class="menu-item-entry-display">{{url}}</span>\n\t\t\t<span class="menu-item-entry-input" >{{Upfront.Settings.l10n.global.content.edit_link}}</span>\n\t\t{[ } ]}\n\t\t{[if(type == \'anchor\') { ]}\n\t\t<div class="anchor-selector">\n\t\t</div>\n\t\t{[ } ]}\n\t\t{[if(type == \'email\') { ]}\n\t\t<div class="upfront-field-wrap ulinkpanel-external-wrap">\n\t\t\t<input type="text" value="{{url}}" placeholder="johnsmith@example.com" class="menu-item-email-input">\n\t\t</div>\n\t\t{[ } ]}\n\t\t{[if(type == \'lightbox\') { ]}\n\t\t\t{[ if(lightboxes.length) { ]}\n\t\t\t\t<div class="lightbox-selector">\n\t\t\t\t</div>\n\t\t\t{[ } else { ]}\n\n\t\t\t{[ } ]}\n\n\t\t\t\t<div class="new-lightbox">\n\t\t\t\t\t\t<label>{{Upfront.Settings.l10n.global.content.create_lightbox}}</label>\n\t\t\t\t\t\t<input type="text" name="menu-item-lightbox-input" class="menu-item-lightbox-input upfront-field upfront-field-text upfront-field-empty" value="" placeholder="{{Upfront.Settings.l10n.global.content.lightbox_name}}" />\n\t\t\t\t</div>\n\t\t{[ } ]}\n\t\t{[if(type !== \'lightbox\' && type !== \'anchor\') { ]}\n\t\t\t<label class="menu-item-target-label">{{Upfront.Settings.l10n.global.content.link_opens_in}}</label>\n\t\t{[ } ]}\n\t</div>\n</form>\n'}),function(t){define("scripts/upfront/settings/modules/menu-structure/menu-item-editor",["text!scripts/upfront/settings/modules/menu-structure/menu-item-editor.tpl"],function(e){var i=function(){var t=[],e=Upfront.Application.layout.get("regions");return _.each(e.models,function(e){"lightbox"==e.attributes.sub&&t.push({id:"#"+e.get("name"),label:e.get("title")})}),t},n=function(){var t,e=Upfront.Application.layout.get("regions"),i=[];return t=function(e){e.each(function(e){var n=e.get_property_value_by_name("anchor");n&&n.length&&i.push({id:"#"+n,label:n}),e.get("objects")?e.get("objects").each(function(t){var e=t.get_property_value_by_name("anchor");e&&e.length&&i.push({id:"#"+e,label:e})}):e.get("modules")&&t(e.get("modules"))})},e.each(function(e){t(e.get("modules"))}),i},o=function(){var t=[];return _.each(Upfront.data.ugallery.postTypes,function(e){"attachment"!=e.name&&t.push({name:e.name,label:e.label})}),t},r=Backbone.View.extend({className:"menu-item-editor",events:{"click .menu-item-entry-input":"showPagePostSelector","keydown .menu-item-lightbox-input":"onLightboxNameInputChange","keydown .menu-item-external-input":"onUrlNameKeydown","change .menu-item-external-input":"onUrlNameChange","keydown .menu-item-email-input":"onEmailNameKeydown","change .menu-item-email-input":"onEmailNameChange","keydown .menu-item-title":"onItemNameKeydown","change .menu-item-title":"onItemNameChange"},initialize:function(t){this.options=t||{},this.type=Upfront.Util.guessLinkType(this.model.get("menu-item-url"))},render:function(){return this.$el.html(_.template(e,{title:this.model.get("menu-item-title"),type:this.type,lightboxes:i(),url:this.model.get("menu-item-url")})),this.renderTypeSelect(),"anchor"===this.type&&this.renderAnchorSelect(),"lightbox"===this.type&&i()&&this.renderLightBoxesSelect(),"anchor"!==this.type&&"anchor"!==this.type&&this.renderLinkTargetSelect(),this},renderTypeSelect:function(){var t=this,e=[];_.each(["unlink","external","entry","anchor","lightbox","email"],function(t){e.push(this.getLinkTypeValue(t))},this),this.typeSelect=new Upfront.Views.Editor.Field.Select({label:"",values:e,default_value:this.type||"external",change:function(e){t.onTypeChange(e)}}),this.typeSelect.render(),this.$el.find(".item-links-to-label").after(this.typeSelect.el)},renderLinkTargetSelect:function(){var t=this,e=new Upfront.Views.Editor.Field.Select({label:"",values:[{value:"",label:"Same Browser Tab"},{value:"_blank",label:"New Browser Tab"}],default_value:this.model.get("menu-item-target"),change:function(e){t.onTargetChange(e)}});e.render(),this.$el.find(".menu-item-target-label").after(e.el)},getLinkTypeValue:function(t){var e=Upfront.Settings.l10n.global.content;switch(t){case"unlink":return{value:"unlink",label:e.no_link};case"external":return{value:"external",label:e.url};case"email":return{value:"email",label:e.email_address};case"entry":return{value:"entry",label:e.post_or_page};case"anchor":return{value:"anchor",label:e.anchor};case"image":return{value:"image",label:e.larger_image};case"lightbox":return{value:"lightbox",label:e.lightbox}}},showPagePostSelector:function(t){t&&t.preventDefault();var e=this,i={postTypes:o()};Upfront.Views.Editor.PostSelector.open(i).done(function(t){e.model.set({"menu-item-url":t.get("permalink")}),e.saveItem(),e.render()})},saveItem:function(){var t=this;Upfront.Util.post({action:"upfront_update_single_menu_item",menuId:this.options.menuId,menuItemData:this.model.toJSON()}).done(function(){t.trigger("change")})},onTypeChange:function(t){this.model.set({"menu-item-url":""}),this.type=t,this.render(),"entry"===this.type?this.showPagePostSelector():"unlink"===this.type&&this.saveItem(),this.$el.parent().find(".menu-item-type").first().text(this.getLinkTypeLabel(t))},onTargetChange:function(t){this.model.set({"menu-item-target":t}),this.saveItem()},renderAnchorSelect:function(){var t=this,e=[{label:"Choose Anchor...",value:""}];_.each(n(),function(t){e.push({label:t.label,value:t.id})});var i=this.model.get("menu-item-url");i=i?i:"",i=i.match(/^#/)?i:"",this.anchorSelect=new Upfront.Views.Editor.Field.Select({label:"",values:e,default_value:i,change:function(){t.model.set({"menu-item-url":this.get_value()}),t.saveItem()}}),this.anchorSelect.render(),this.$el.find(".anchor-selector").append(this.anchorSelect.el)},renderLightBoxesSelect:function(){var t=this,e=[{label:"Choose Lightbox...",value:""}];_.each(i()||[],function(t){e.push({label:t.label,value:t.id})});var n=this.model.get("menu-item-url");n=n?n:"",n=n.match(/^#/)?n:"",this.lightboxSelect=new Upfront.Views.Editor.Field.Select({label:"",values:e,default_value:n,change:function(){t.model.set({"menu-item-url":this.get_value()}),t.saveItem()}}),this.lightboxSelect.render(),this.$el.find(".lightbox-selector").append(this.lightboxSelect.el)},onLightboxNameInputChange:function(t){13==t.which&&(t.preventDefault(),this.createLightBox())},createLightBox:function(){var e=t.trim(this.$(".menu-item-lightbox-input").val());return e?(this.model.set({"menu-item-url":"#"+Upfront.Application.LayoutEditor.createLightboxRegion(e)}),this.saveItem(),void this.render()):(Upfront.Views.Editor.notify(l10n.ltbox_empty_name_nag,"error"),!1)},onUrlNameKeydown:function(t){13==t.which&&(t.preventDefault(),this.onUrlNameChange())},onUrlNameChange:function(){this.model.set({"menu-item-url":t.trim(this.$el.find(".menu-item-external-input").val())}),this.saveItem()},onEmailNameKeydown:function(t){13==t.which&&(t.preventDefault(),this.onEmailNameChange())},onEmailNameChange:function(){this.model.set({"menu-item-url":"mailto:"+t.trim(this.$el.find(".menu-item-email-input").val())}),this.saveItem()},onItemNameKeydown:function(t){13==t.which&&(t.preventDefault(),this.onItemNameChange())},onItemNameChange:function(){var e=t.trim(this.$el.find(".menu-item-title").val());this.model.set({"menu-item-title":e}),this.$el.parent().find(".menu-item-title").first().text(e),this.saveItem()},getLinkTypeLabel:function(t){var e=Upfront.Settings.l10n.global.content;switch(t){case"unlink":return e.no_link;case"external":return e.url;case"email":return e.email_address;case"entry":return e.post_or_page;case"anchor":return e.anchor;case"image":return e.larger_image;case"lightbox":return e.lightbox}}});return r})}(jQuery),define("text!scripts/upfront/settings/modules/menu-structure/menu-item.tpl",[],function(){return'<div class="menu-item-header">\n\t<span class="menu-item-title" title="{{ title }}">{{ title }}</span>\n\t<span class="menu-item-type" title="{{ type }}">{{ type }}</span>\n\t<i class="menu-item-delete">x</i>\n</div>\n'}),define("scripts/upfront/settings/modules/menu-structure/menu-item",["scripts/upfront/settings/modules/menu-structure/menu-item-editor","text!scripts/upfront/settings/modules/menu-structure/menu-item.tpl"],function(t,e){var i=Backbone.View.extend({className:"menu-structure-module-item",events:{"click .menu-item-header":"toggleEditor","click .menu-item-delete":"deleteItem"},initialize:function(t){this.options=t||{},this.subViews=[],this.depth=this.options.depth||0,this.parent_view=t.parent_view;var e=this.model.get("sub");e&&_.each(e,function(t){this.subViews.unshift(new i({model:new Backbone.Model(t),depth:this.depth+1,menuId:this.options.menuId}))},this)},render:function(){var i=this;this.$el.html(_.template(e,{title:this.model.get("menu-item-title"),type:this.getLinkTypeLabel(Upfront.Util.guessLinkType(this.model.get("menu-item-url")))})),this.$el.data("menu-item-object-id",this.model.get("menu-item-object-id")),this.$el.data("menu-item-depth",this.depth),this.$el.addClass("menu-structure-item-depth-"+this.depth);
var n=new t({model:this.model,menuId:this.options.menuId});return this.$el.append(n.render().el),this.listenTo(n,"change",function(){i.trigger("change",i.model.toJSON())}),setTimeout(function(){_.each(i.subViews,function(t){i.$el.after(t.render().el)})},100),this.delegateEvents(),this},toggleEditor:function(){this.$el.toggleClass("menu-item-expanded"),this.$el.find(".menu-item-editor").toggle()},getLinkTypeLabel:function(t){var e=Upfront.Settings.l10n.global.content;switch(t){case"unlink":return e.no_link;case"external":return e.url;case"email":return e.email_address;case"entry":return e.post_or_page;case"anchor":return e.anchor;case"image":return e.larger_image;case"lightbox":return e.lightbox}},deleteItem:function(t){t.preventDefault(),t.stopPropagation(),"undefined"!=typeof this.model.get("menu-item-db-id")&&Upfront.Util.post({action:"upfront_new_delete_menu_item",menu_item_id:this.model.get("menu-item-db-id")}).success(function(t){Upfront.Events.trigger("menu_element:edit")}).error(function(t){Upfront.Util.log("Error Deleting Menu Item")})}});return i}),define("text!scripts/upfront/settings/modules/menu-structure/menu-structure.tpl",[],function(){return'<div class="menu-structure-header">\n\t<span class="upfront-settings-item-title">MENU STRUCTURE</span>\n\t<span class="add-menu-item">Add item</span>\n</div>\n<div class="menu-structure-body"></div>\n'}),function(t){define("scripts/upfront/settings/modules/menu-structure",["elements/upfront-newnavigation/js/menu-util","scripts/upfront/settings/modules/menu-structure/menu-item","text!scripts/upfront/settings/modules/menu-structure/menu-structure.tpl"],function(e,i,n){var o=(Upfront.Settings.l10n.preset_manager,!1),r=Backbone.View.extend({className:"settings_module menu_structure_module clearfix",handlesSaving:!0,events:{"mouseenter .menu-item-header":"enableSorting","mouseleave .menu-item-header":"disableSortingOnHeaderLeave","click .add-menu-item":"addItem"},initialize:function(t){var e=this;this.options=t||{},this.listenTo(this.model.get("properties"),"change",function(){e.reloadItems()}),Upfront.Events.on("menu_element:edit",function(t){e.reloadItems()}),this.setup()},reloadItems:function(){this.setup(),this.render()},setup:function(){this.menuId=this.model.get_property_value_by_name("menu_id"),this.menuItems=[],this.menuItemViews=[],this.menu=e.getMenuById(this.menuId),this.menuId!==!1&&this._load_items()},_has_promise:function(t){var e=JSON.stringify(t);return!!(this._promises||{})[e]},_add_promise:function(t,e){var i=JSON.stringify(t);return this._promises=this._promises||{},this._promises[i]=e,!0},_drop_promise:function(t){var e=JSON.stringify(t);return this._promises=this._promises||{},this._promises[e]=!1,!0},_load_items:function(){var t,e=this,n={action:"upfront_new_load_menu_array",data:this.menuId+""};return!!this._has_promise(n)||(t=Upfront.Util.post(_.extend({},n)),this._add_promise(n,t),t.success(function(t){e.menuItems=t.data||[],_.each(e.menuItems,function(t,n){var o=new i({model:new Backbone.Model(t),menuId:e.menuId});e.menuItemViews.push(o),e.listenTo(o,"change",function(t){e.menuItems[n]=t,e.model.trigger("change",e.model)})}),e.model.set_property("menu_items",t.data,!0),e.model.id&&e.model.trigger("change"),e.render(),e._drop_promise(n)}).error(function(t){Upfront.Util.log("Error loading menu items")}),!0)},render:function(){var t,e=this;if(this.$el.html(n),this.menuId!==!1){if(t=this.$el.find(".menu-structure-body"),_.each(this.menuItemViews,function(e){t.append(e.render().el)}),o){var i=e.$el.closest(".uf-settings-panel--expanded"),r=i.closest("#sidebar-scroll-wrapper");r.scrollTop(i.height()-175),o=!1}return Upfront.Events.trigger("menu_element:settings:rendered")}},enableSorting:function(e){if(this.sortingInProggres!==!0){var i,n=this.$el.find(".menu-structure-module-item"),o=t(e.target).parent(),r=!1,s=this;n.addClass("menu-structure-sortable-item"),n.each(function(){if(!r)return!_.isUndefined(i)&&t(this).data("menuItemDepth")<=i?void(r=!0):!_.isUndefined(i)&&t(this).data("menuItemDepth")>i?(t(this).addClass("hovered-item-group-member"),void t(this).removeClass("menu-structure-sortable-item")):void(_.isUndefined(i)&&t(this).is(o)&&(i=t(this).data("menuItemDepth"),t(this).addClass("hovered-item-group-member"),t(this).removeClass("menu-structure-sortable-item")))}),this.$el.find(".hovered-item-group-member").wrapAll('<div class="menu-structure-sortable-item"></div>'),this.$el.sortable({axis:"y",items:".menu-structure-sortable-item",start:function(t,e){s.sortingInProggres=!0,s.watchItemDepth(e.item)},stop:function(t,e){s.stopWatchingItemDepth(e.item),s.updateItemsPosition(e.item),s.sortingInProggres=!1}})}},disableSortingOnHeaderLeave:function(){this.sortingInProggres!==!0&&this.disableSorting()},disableSorting:function(){var t=this.$el.find(".menu-structure-module-item"),e=this.$el.find(".hovered-item-group-member");e.unwrap(),e.removeClass("hovered-item-group-member"),t.removeClass("menu-structure-sortable-item"),this.$el.sortable("destroy")},watchItemDepth:function(t){var e,i=this;this.$el.on("mousemove",function(n){return _.isUndefined(e)?void(e=n.pageX):void(Math.abs(e-n.pageX)<15||(i.updateSortableDepth(e,n.pageX,t),e=n.pageX))})},updateSortableDepth:function(t,e,i){var n=i.hasClass("menu-structure-module-item")?i.data("menuItemDepth"):i.children().first().data("menu-item-depth"),o=i.prev().data("menu-item-depth"),r=i.nextAll().not(".ui-sortable-placeholder").first().data("menu-item-depth");t>e&&this.decreaseGroupDepth(n,o,r,i),t<e&&this.increaseGroupDepth(n,o,r,i)},decreaseGroupDepth:function(e,i,n,o){var r=this;if(i<e&&n<e||i===e&&n<e||_.isUndefined(n)||n<e){if(o.hasClass("menu-structure-module-item")){if(0===o.data("menuItemDepth"))return;return void this.decreaseItemDepth(o)}if(0===o.children().first().data("menuItemDepth"))return;o.children().each(function(){r.decreaseItemDepth(t(this))})}},increaseGroupDepth:function(e,i,n,o){var r=this;if(i>=e||i===e&&n<e){if(o.hasClass("menu-structure-module-item"))return void this.increaseItemDepth(o);o.children().each(function(){r.increaseItemDepth(t(this))})}},decreaseItemDepth:function(t){t.removeClass("menu-structure-item-depth-"+t.data("menuItemDepth")),t.data("menu-item-depth",t.data("menuItemDepth")-1),t.addClass("menu-structure-item-depth-"+t.data("menuItemDepth"))},increaseItemDepth:function(t){t.removeClass("menu-structure-item-depth-"+t.data("menuItemDepth")),t.data("menuItemDepth",t.data("menuItemDepth")+1),t.addClass("menu-structure-item-depth-"+t.data("menuItemDepth"))},stopWatchingItemDepth:function(){this.$el.off("mousemove")},flattenItem:function(t){var e=this,i=[t];return t.sub&&_.each(t.sub,function(t){i=_.union(i,e.flattenItem(t))}),i},updateItemsPosition:function(){var e=this,i=[];_.each(this.menuItems,function(t){i=_.union(i,e.flattenItem(t))});var n,o,r=this.$el.find(".menu-structure-module-item"),s=[],a=[0],l=0,p=1,d=0;r.each(function(){var e=_.findWhere(i,{"menu-item-object-id":t(this).data("menuItemObjectId")}),r=t(this).data("menuItemDepth");if(r>d)a.push(l),d+=1;else if(r===d);else if(r<d){for(n=d-r,o=0;o<n;o++)a=_.initial(a);d=r}s.push(_.extend(e,{"menu-item-parent-id":_.last(a)||0,"menu-item-position":p})),p+=1,l=e["menu-item-object-id"]}),Upfront.Util.post({action:"upfront_update_menu_items",data:{items:s,menuId:this.menuId}}).done(function(){e.model.trigger("change")}).fail(function(t){Upfront.Util.log("Failed saving menu items.")})},addItem:function(){var t=this,e={"menu-item-object":"custom","menu-item-parent-id":0,"menu-item-target":"","menu-item-title":"New Item","menu-item-type":"custom","menu-item-url":""};Upfront.Util.post({action:"upfront_update_single_menu_item",menuId:this.menuId,menuItemData:e}).done(function(i){e["menu-item-db-id"]=i.data.itemId,e["menu-item-object-id"]=i.data.itemId+"",Upfront.Util.post({action:"upfront_update_single_menu_item",menuId:t.menuId,menuItemData:e}).done(function(){t.model.get_property_value_by_name("menu_items").unshift(e),t.model.get("properties").trigger("change"),o=!0})}).fail(function(t){Upfront.Util.log("Failed saving menu items.")})},save_fields:function(){}});return r})}(jQuery),define("elements/upfront-newnavigation/js/settings/menu-style",[],function(){var t=Upfront.Settings.l10n.newnavigation_element,e=Upfront.Views.Editor.Settings.Item.extend({className:"settings_module menustyle_settings_item clearfix",group:!0,get_title:function(){return this.options.title},initialize:function(e){this.options=e||{};var i=this,n=this.options.state;this.fields=_([new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-select select-module menu_style",name:"menu_style",default_value:this.model.get("menu_style"),label:t.mnu.style,values:[{label:t.mnu.horiz,value:"horizontal"},{label:t.mnu.vert,value:"vertical"},{label:t.mnu.triggered,value:"burger"}],change:function(t){i.model.set("menu_style",t),"burger"!==t?(i.fields._wrapped[3].$el.hide(),i.fields._wrapped[3].set_value("over")):"top"===i.model.get("burger_alignment")&&i.fields._wrapped[3].$el.show()},show:function(t,e){"burger"===t?e.parent().find(".burger_alignment").show():e.parent().find(".burger_alignment").hide()}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-select select-module menu_alignment",name:"menu_alignment",default_value:this.model.get("menu_alignment"),label:t.mnu.alignment,values:[{label:t.mnu.left,value:"left"},{label:t.mnu.center,value:"center"},{label:t.mnu.right,value:"right"}],change:function(t){i.model.set("menu_alignment",t)}}),new Upfront.Views.Editor.Field.Select({model:this.model,className:n+"-select select-module burger_alignment",name:"burger_alignment",default_value:this.model.get("burger_alignment"),label:t.mnu.show_on_click,values:[{label:t.mnu.left,value:"left",icon:"burger-left"},{label:t.mnu.right,value:"right",icon:"burger-right"},{label:t.mnu.top,value:"top",icon:"burger-top"},{label:t.mnu.whole,value:"whole",icon:"burger-whole"}],change:function(t){i.model.set("burger_alignment",t),"left"===t||"right"===t||"whole"===t?(i.fields._wrapped[3].$el.hide(),i.fields._wrapped[3].set_value("over")):i.fields._wrapped[3].$el.show()}}),new Upfront.Views.Editor.Field.Radios({model:this.model,default_value:this.model.get("burger_over"),name:"burger_over",label:"",layout:"vertical",values:[{label:t.mnu.over,value:"over"},{label:t.mnu.push,value:"pushes"}],change:function(t){i.model.set("burger_over",t)}})]),this.listenTo(this,"rendered",function(){var t=i.model.get("burger_alignment");"left"===t||"right"===t||"whole"===t?(i.fields._wrapped[3].$el.hide(),i.fields._wrapped[3].set_value("over")):i.fields._wrapped[3].$el.show();var e=i.model.get("menu_style");"burger"!==e&&(i.fields._wrapped[3].$el.hide(),i.fields._wrapped[3].set_value("over"))})}});return e}),define("scripts/upfront/settings/module-factory",["scripts/upfront/settings/modules/typography","scripts/upfront/settings/modules/border","scripts/upfront/settings/modules/hov-animation","scripts/upfront/settings/modules/radius","scripts/upfront/settings/modules/selectbox","scripts/upfront/settings/modules/checkbox","scripts/upfront/settings/modules/caption-location","scripts/upfront/settings/modules/gallery-caption-location","scripts/upfront/settings/modules/colors","scripts/upfront/settings/modules/element-style","scripts/upfront/settings/modules/padding","scripts/upfront/settings/modules/anchor","scripts/upfront/settings/modules/menu-structure","elements/upfront-newnavigation/js/settings/menu-style"],function(t,e,i,n,o,r,s,a,l,p,d,c,u,h){var f=function(){var f={Typography:t,Border:e,HovAnimation:i,Radius:n,Selectbox:o,Checkbox:r,CaptionLocation:s,GalleryCaptionLocation:a,Colors:l,ElementStyle:p,Padding:d,Anchor:c,MenuStructure:u,MenuStyle:h};this.createModule=function(t,e,i){var n=_.extend({},e,{model:i});return"string"==typeof t?new f[t](n):new t(n)}};return moduleFactory=new f,moduleFactory}),function(t){define("scripts/upfront/element-settings/root-settings-panel",["scripts/upfront/element-settings/settings-container","scripts/upfront/element-settings/root-panel-mixin","scripts/upfront/settings/field-factory","scripts/upfront/settings/module-factory"],function(e,i,n,o){var r=(Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,e.extend(_.extend({},i,{initialize:function(t){var e=this,i=[];this.options=t,this.settings=_(this.settings),this.settings.each(function(t){var r;r="SettingsItem"===t.type?new Upfront.Views.Editor.Settings.Item({title:t.title,model:e.model,className:t.className,fields:[]}):o.createModule(t.type,t||{},e.model),t.identifier&&(r.identifier=t.identifier),_.each(t.fields,function(i){var o;"change"in i&&(i.preservedChangeCallback||(i.preservedChangeCallback=i.change),i.change=function(t){i.preservedChangeCallback(t,e)},Upfront.Events.once("entity:settings:deactivate",function(){i.change=i.preservedChangeCallback})),"show"in i&&(i.preservedShowCallback||(i.preservedShowCallback=i.show),i.show=function(t){i.preservedShowCallback(t,e)},Upfront.Events.once("entity:settings:deactivate",function(){i.show=i.preservedShowCallback})),o=n.createField(i.type,_.extend({model:e.model},_.omit(i,["type"]))),t.triggerChange&&e.listenTo(o,"change changed",function(){e.save_settings(),e.model.trigger("change",e.model)}),i.identifier&&(o.identifier=i.identifier),r.fields.push(o)}),r.panel=e,r.trigger("panel:set"),i.push(r)}),this.settings=_(i)},getBody:function(){var e=t("<div />"),i=this;return this.settings.each(function(t){t.panel||(t.panel=i),t.render(),e.append(t.el)}),e}})));return r})}(jQuery),define("scripts/upfront/settings/fields/select-preset",[],function(){var t=Upfront.Settings.l10n.preset_manager,e=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"preset select-preset-field",render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);var e=this;this.$el.find(".upfront-chosen-select").val();if(this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:"175px",disable_search:!Upfront.Application.user_can("MODIFY_PRESET")}),Upfront.Application.user_can("MODIFY_PRESET")){var i=['<a href="#" title="'+t.add_preset_label+'" class="upfront-preset-add">'+t.add_label+"</a>"];this.$el.find(".chosen-search").append(i.join(""))}return this.$el.on("click",".upfront-preset-add",function(i){if(i.preventDefault(),!Upfront.Application.user_can("MODIFY_PRESET"))return!1;var n=e.$el.find(".chosen-search input").val();return""===n.trim()?void alert(t.not_empty_label):n.match(/[^A-Za-z0-9 ]/)?void alert(t.special_character_label):n.match(/^[A-Za-z][A-Za-z0-9 ]*$/)?void e.trigger("upfront:presets:new",n.trim()):void alert(t.invalid_preset_label)}),this},get_value_html:function(e,i){var n="",o=this.get_saved_value()?this.get_saved_value():"default";if(e.value===this.clear_preset_name(o)&&(n=' selected="selected"'),"default"===e.value){e.label=t.default_label;var r=this.get_element_type(this.model.get_property_value_by_name("type"));"undefined"!=typeof r&&"undefined"!=typeof r.label&&(e.label=t.default_label+" "+r.label)}return['<option value="',e.value,'"',n,">",e.label,"</option>"].join("")},clear_preset_name:function(t){return t=t.replace(" ","-"),t=t.replace(/[^-a-zA-Z0-9]/,"")},get_element_type:function(e){var i={UaccordionModel:{label:t.accordion,id:"accordion"},UcommentModel:{label:t.comments,id:"comment"},UcontactModel:{label:t.contact_form,id:"contact"},UgalleryModel:{label:t.gallery,id:"gallery"},UimageModel:{label:t.image,id:"image"},LoginModel:{label:t.login,id:"login"},LikeBox:{label:t.like_box,id:"likebox"},MapModel:{label:t.map,id:"map"},UnewnavigationModel:{label:t.navigation,id:"nav"},ButtonModel:{label:t.button,id:"button"},PostsModel:{label:t.posts,id:"posts"},UsearchModel:{label:t.search,id:"search"},USliderModel:{label:t.slider,id:"slider"},SocialMediaModel:{label:t.social,id:"social"},UtabsModel:{label:t.tabs,id:"tab"},ThisPageModel:{label:t.page,id:"this_page"},ThisPostModel:{label:t.post,id:"this_post"},UwidgetModel:{label:t.widget,id:"widget"},UyoutubeModel:{label:t.youtube,id:"youtube"},PlainTxtModel:{label:t.text,id:"text"}};return i[e]}});return e}),define("scripts/upfront/settings/modules/select-preset",["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/fields/select-preset"],function(t,e){var i=Upfront.Settings.l10n.preset_manager,n=t.extend({className:"select-presets",initialize:function(t){this.options=t||{},this.group=!1;var n=this;this.selectPresetField=new e({model:this.model,label:i.select_preset_label,property:"preset",values:this.get_presets(),change:function(t){n.model.set_property("preset",this.get_value())}}),this.fields=_([this.selectPresetField]),Upfront.Application.user_can("MODIFY_PRESET")&&this.listenTo(this.selectPresetField,"upfront:presets:new",this.createPreset),Upfront.Application.user_can("SWITCH_PRESET")&&this.listenTo(this.selectPresetField,"changed",this.changePreset)},changePreset:function(){return!!Upfront.Application.user_can("SWITCH_PRESET")&&void this.trigger("upfront:presets:change",this.selectPresetField.get_value())},createPreset:function(t){return!!Upfront.Application.user_can("MODIFY_PRESET")&&void this.trigger("upfront:presets:new",t)},get_title:function(){return i.select_preset},get_presets:function(){var t=[];return _.each(this.options.presets.models,function(e){"undefined"==typeof e.get("legacy")&&("undefined"==typeof e.get("name")?t.push({label:e.get("id"),value:e.get("id")}):t.push({label:e.get("name"),value:e.get("id")}))}),t}});return n}),define("scripts/upfront/settings/fields/show-state",[],function(){var t=Upfront.Views.Editor.Field.Button.extend({className:"state_settings_button",initialize:function(t){this.options=t||{},this.label=this.options.state,this.options.compact=!0,this.$el.addClass("state_settings_button_"+this.options.state.toLowerCase())},on_click:function(){this.trigger("upfront:presets:state_show",this.options.state.toLowerCase())}});return t}),define("scripts/upfront/settings/modules-container",["scripts/upfront/settings/module-factory"],function(t){var e=Backbone.View.extend({initialize:function(e){this.options=e||{};var i=[],n=this,o=this.options.modules;_.isUndefined(o)&&(o=this.modules),"function"==typeof this.getAdditionalModules&&(o=this.getAdditionalModules(_.clone(o))),_.each(o,function(e){e.options=e.options||{},"change"in e.options&&(e.options.preservedChangeCallback||(e.options.preservedChangeCallback=e.options.change),e.options.change=function(t){e.options.preservedChangeCallback(t,n)},Upfront.Events.once("entity:settings:deactivate",function(){e.options.change=e.options.preservedChangeCallback}));var o=t.createModule(e.moduleType,e.options||{},this.options.model);o.panel=this,i.push(o)},this),this.modules=_(i),this.onInitialize&&this.onInitialize(e)},render:function(){this.$el.html(""),this.$el.append('<div class="upfront-settings-item-content"></div>');var t=this.$el.find(".upfront-settings-item-content");this.modules.each(function(e){e.render(),e.delegateEvents(),t.append(e.el)})},save_settings:function(){if(this.modules){this.modules.each(function(t){t.fields.size()>0&&t.save_fields()})}}});return e}),define("scripts/upfront/preset-settings/state-settings",["scripts/upfront/settings/modules-container"],function(t){var e=t.extend({onInitialize:function(t){"Global"!==this.options.state?this.$el.addClass("state_modules state_settings state_settings_"+this.options.state.toLowerCase()):this.$el.addClass("state_modules global_modules")}});return e}),define("scripts/upfront/settings/modules/edit-preset",["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/fields/show-state","scripts/upfront/preset-settings/state-settings"],function(t,e,i){var n=Upfront.Settings.l10n.preset_manager,o=t.extend({className:"preset_specific",initialize:function(t){this.options=t||{},this.listenTo(this.model,"change",this.onPresetUpdate);var o=this,r=!1,s=!1,a=[];a=Upfront.Application.get_current()!==Upfront.Application.MODE.THEME&&this.options.model.get("theme_preset")===!0||"default"===this.options.model.get("id")||!Upfront.Application.user_can("DELETE_PRESET")?Upfront.Application.get_current()===Upfront.Application.MODE.THEME||"default"!==this.options.model.get("id")&&this.options.model.get("theme_preset")!==!0||!Upfront.Application.user_can("MODIFY_PRESET")?[]:[new Upfront.Views.Editor.Field.Button({model:this.model,label:"Reset",className:"delete_preset",compact:!0,on_click:function(){o.resetPreset()}})]:[new Upfront.Views.Editor.Field.Button({model:this.model,label:n.delete_label,className:"delete_preset",compact:!0,on_click:function(){confirm("Are you sure to delete this preset?")&&o.deletePreset()}})],Upfront.Application.user_can("MODIFY_PRESET")&&(_.each(this.options.stateModules,function(t,e){if("Global"===e){var n=new i({model:this.model,modules:t,state:e});a.push(n)}},this),_.each(this.options.stateModules,function(t,i){if("Global"!==i){var n=new e({state:i});a.push(n),this.listenTo(n,"upfront:presets:state_show",this.showState),r||(r=n)}},this),_.each(this.options.stateModules,function(t,e){if("Global"!==e){var n=new i({model:this.model,modules:t,state:e});a.push(n),s?n.$el.hide():s=n}},this),setTimeout(function(){o.$el.find(".state_settings_button").wrapAll('<div class="state_settings_button_wrapper">');var t=o.$el.find(".state_settings_button_wrapper");t.prev().hasClass("delete_preset")&&t.addClass("move-wrapper-top")},50)),r&&r.$el.addClass("active"),s&&s.$el.show(),this.fields=_(a)},onPresetUpdate:function(){return!!Upfront.Application.user_can("MODIFY_PRESET")&&void this.trigger("upfront:presets:update",this.model.toJSON())},deletePreset:function(){return!!Upfront.Application.user_can("DELETE_PRESET")&&void this.trigger("upfront:presets:delete",this.model)},resetPreset:function(){return!!Upfront.Application.user_can("DELETE_PRESET")&&void this.trigger("upfront:presets:reset",this.model)},showState:function(t){this.$el.find(".state_settings_button").removeClass("active"),this.$el.find(".state_settings_button_"+t).addClass("active"),this.$el.find(".state_settings").hide(),this.$el.find(".state_settings_"+t).show(),this.trigger("upfront:presets:state_show",t)}});return o}),define("scripts/upfront/settings/modules/migrate-preset",["scripts/upfront/settings/modules/base-module"],function(t){var e=Upfront.Settings.l10n.preset_manager,i=t.extend({className:"migrate-preset-overlay",initialize:function(t){this.options=t||{};var i=this,n=Upfront.Views.Editor.Field.Text.extend({get_field_html:function(){return""}}),o=Upfront.Views.Editor.Field.Chosen_Select.extend({className:"preset select-preset-field-overlay",render:function(){Upfront.Views.Editor.Field.Chosen_Select.prototype.render.call(this);this.$el.find(".upfront-chosen-select").val();return this.$el.find(".upfront-chosen-select").chosen({search_contains:!0,width:"171px"}),this},get_value_html:function(t,e){var i="",n=this.get_saved_value()?this.get_saved_value():"default";return this.model.get_property_value_by_name("usingNewAppearanche")||(n=""),t.value===this.clear_preset_name(n)&&(i=' selected="selected"'),['<option value="',t.value,'"',i,">",t.label,"</option>"].join("")},clear_preset_name:function(t){return t=t.replace(" ","-"),t=t.replace(/[^-a-zA-Z0-9]/,"")},on_change:function(t){this.trigger("change",this.get_value())}});this.selectPresetField=new o({model:this.model,label:"",values:this.get_presets(),change:function(t){}}),this.listenTo(this.selectPresetField,"change",this.previewPreset);var r=[new Upfront.Views.Editor.Settings.Item({model:this.model,className:"new-preset-module",fields:[new n({model:this.model,label:e.convert_preset_info,className:"migrate-preset-info migrate-info-icon"}),new n({model:this.model,label:e.select_preset_info,className:"migrate-preset-info"}),this.selectPresetField,new Upfront.Views.Editor.Field.Button({model:this.model,label:e.apply_label,className:"migrate-preset-apply",compact:!0,on_click:function(){i.trigger("upfront:presets:change",i.selectPresetField.get_value())}}),new n({model:this.model,label:e.save_as_preset_button_info,className:"migrate-preset-info save-as-preset-info"}),new Upfront.Views.Editor.Field.Button({model:this.model,label:e.convert_style_to_preset,className:"migrate-preset-button",compact:!0,on_click:function(){i.show_new_preset_fields()}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:e.cancel_label,className:"new-preset-button-cancel",compact:!0,on_click:function(){i.hide_new_preset_fields()}}),new Upfront.Views.Editor.Field.Text({model:this.model,label:"",default_value:i.suggestPresetName(this.options.elementPreset),className:"new-preset-button-input"}),new Upfront.Views.Editor.Field.Button({model:this.model,label:e.ok_label,className:"new-preset-button-submit",compact:!0,on_click:function(){var t=i.$el.find(".new-preset-button-input input").val();return""===t.trim()?void alert(e.not_empty_label):t.match(/[^A-Za-z0-9 ]/)?void alert(e.special_character_label):t.match(/^[A-Za-z][A-Za-z0-9 ]*$/)?void i.trigger("upfront:presets:new",t.trim()):void alert(e.invalid_preset_label)}})]})];setTimeout(function(){i.hide_new_preset_fields()},20),this.fields=_(r)},suggestPresetName:function(t){for(var i=this.capitalisePreset(t.replace(/-preset/,"")),n=i+e.preset,o=n,r=1,s=this.get_all_preset_names();0<s.indexOf(o);)o=n+r,r++;return o},capitalisePreset:function(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()},hide_new_preset_fields:function(){var t=this;t.$el.find(".new-preset-button-cancel").hide(),t.$el.find(".new-preset-button-input").hide(),t.$el.find(".new-preset-button-submit").hide(),t.$el.find(".migrate-preset-button").show(),t.$el.find(".existing-preset-overlay-layout").remove()},show_new_preset_fields:function(){var t=this;t.$el.find(".new-preset-button-cancel").show(),t.$el.find(".new-preset-button-input").show(),t.$el.find(".new-preset-button-submit").show(),t.$el.find(".migrate-preset-button").hide(),t.$el.find(".existing-preset-module").append('<div class="existing-preset-overlay-layout">&nbsp;</div>')},previewPreset:function(t){this.trigger("upfront:presets:preview",t)},get_all_preset_names:function(){var t=[];return _.each(this.options.presets.models,function(e){var i="undefined"==typeof e.get("name")?e.get("id"):e.get("name");t.push(i)}),t},get_presets:function(){var t=[{label:"No preset",value:""}];return _.each(this.options.presets.models,function(e){"undefined"==typeof e.get("legacy")&&("undefined"==typeof e.get("name")?t.push({label:e.get("id"),value:e.get("id")}):t.push({label:e.get("name"),value:e.get("id")}))}),t}});return i}),function(t){define("scripts/upfront/preset-settings/preset-css-editor",["text!upfront/templates/popup.html","scripts/perfect-scrollbar/perfect-scrollbar"],function(e,i){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,o=Backbone.View.extend({className:"upfront-ui",id:"upfront-csseditor",tpl:_.template(t(e).find("#csseditor-tpl").html()),prepareAce:!1,ace:!1,events:{"click .upfront-css-save-ok":"save","click .upfront-css-close":"close","click .upfront-css-theme_image":"openThemeImagePicker","click .upfront-css-media_image":"openImagePicker","click .upfront-css-font":"startInsertFontWidget","click .upfront-css-selector":"addSelector","click .upfront-css-type":"scrollToElement","mouseenter .upfront-css-selector":"hiliteElement","mouseleave .upfront-css-selector":"unhiliteElement"},elementTypes:{UaccordionModel:{label:n.accordion,id:"accordion"},UcommentModel:{label:n.comments,id:"comment"},UcontactModel:{label:n.contact_form,id:"contact"},UgalleryModel:{label:n.gallery,id:"gallery",preset_container:"inline"},UimageModel:{label:n.image,id:"image"},LoginModel:{label:n.login,id:"upfront-login_element"},LikeBox:{label:n.like_box,id:"Like-box-object"},MapModel:{label:n.map,id:"upfront-map_element"},UnewnavigationModel:{label:n.navigation,id:"nav",preset_container:"inline"},ButtonModel:{label:n.button,id:"button",preset_container:"inline"},PostsModel:{label:n.posts,id:"posts",preset_container:"inline"},UsearchModel:{label:n.search,id:"search"},USliderModel:{label:n.slider,id:"slider"},SocialMediaModel:{label:n.social,id:"SocialMedia"},UtabsModel:{label:n.tabs,id:"tab",preset_container:"inline"},ThisPageModel:{label:n.page,id:"this_page"},ThisPostModel:{label:n.post,id:"this_post"},UwidgetModel:{label:n.widget,id:"widget"},UyoutubeModel:{label:n.youtube,id:"youtube"},PlainTxtModel:{label:n.text,id:"text",preset_container:"inline"}},postElementTypes:{post_data:{label:n.post_data,id:"post_data"},author:{label:n.author,id:"author"},featured_image:{label:n.featured_image,id:"featured_image"},taxonomy:{label:n.taxonomy,id:"taxonomy"},comments:{label:n.comments,id:"comments"},meta:{label:n.meta,id:"meta"}},initialize:function(e){var i=this,o=t.Deferred();this.options=e||{},this.model=e.model,this.sidebar=e.sidebar!==!1,this.global=e.global===!0,this.prepareAce=o.promise(),require(["//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ace.js"],function(){o.resolve()}),this.resizeHandler=this.resizeHandler||function(){i.$el.width(t(window).width()-t("#sidebar-ui").width()-1)},Upfront.Events.on("element:settings:saved",this.close,this),Upfront.Events.on("element:settings:canceled",this.close,this),t(window).on("resize",this.resizeHandler),this.dataPartType=this.model.get_property_value_by_name("data_type"),this.modelType=this.options.model.get_property_value_by_name("type"),this.elementType=this.elementTypes[this.modelType]||{label:"Unknown",id:"unknown"},this.createSelectors(Upfront.Application.LayoutEditor.Objects),this.selectors=this.elementSelectors[this.modelType]||{},"PostDataModel"===this.modelType&&(this.elementType=this.postElementTypes[this.dataPartType]||{label:n.post_data,id:"post_data"},this.selectors=this.elementSelectors["post_"+this.dataPartType]||{}),this.element_id=e.element_id?e.element_id:this.model.get_property_value_by_name("element_id"),"function"==typeof e.change&&this.listenTo(this,"change",e.change),this.options.doNotRender!==!0&&(this.render(),this.startResizable())},close:function(e){e&&e.preventDefault(),t(window).off("resize",this.resizeHandler),this.editor&&this.editor.destroy(),t("#page").css("padding-bottom",0),this.remove()},render:function(){var e=this;t("#page").append(this.$el),this.sidebar?this.$el.removeClass("upfront-css-no-sidebar"):this.$el.addClass("upfront-css-no-sidebar"),this.$el.html(this.tpl({name:this.stylename,elementType:this.elementType.label,selectors:this.selectors,show_style_name:!1,showToolbar:!0})),this.resizeHandler(".");var i=this.$el.height()-this.$(".upfront-css-top").outerHeight();this.$(".upfront-css-body").height(i),this.prepareAce.done(function(){e.startAce()}),this.prepareSpectrum(),this.$el.show()},renderCss:function(e){var i,n=this.get_css_selector();return i=this.stylesAddSelector(t.trim(e),"#page "+n),i=Upfront.Util.colors.convert_string_ufc_to_color(i.replace(new RegExp(Upfront.Util.preg_quote(this.get_css_selector())+" .upfront-button","g"),this.get_css_selector()+".upfront-button"))},cleanUpStyles:function(t){if(!this.get_css_selector())return"";var e=new RegExp(Upfront.Util.preg_quote(this.get_css_selector())+"\\s*","g");return t=t.replace(new RegExp("#page "+Upfront.Util.preg_quote(this.get_css_selector())+"\\s*","g"),""),t=t.replace(e,""),t=t.replace(/\\'/g,"'"),t=t.replace(/\\'/g,"'"),t=t.replace(/\\'/g,"'"),t=t.replace(/\\"/g,'"'),t=t.replace(/\\"/g,'"'),t=t.replace(/\\"/g,'"'),t=t.replace(/\.tablet-breakpoint/g,""),t=t.replace(/\.mobile-breakpoint/g,""),t=t.replace(/#page/g,""),t=Upfront.Util.colors.convert_string_color_to_ufc(t.replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page"))},startAce:function(){var e=this,n=ace.edit(this.$(".upfront-css-ace")[0]),o=n.getSession();o.setUseWorker(!1),n.setShowPrintMargin(!1),o.setMode("ace/mode/css"),n.setTheme("ace/theme/monokai"),n.on("change",function(t){var i=e.renderCss(n.getValue());e.trigger("change",i)});var r=this.options.preset.get("preset_style")?this.options.preset.get("preset_style"):"";
r=this.cleanUpStyles(r),n.setValue(t.trim(r),-1),n.renderer.scrollBar.width=5,n.renderer.scroller.style.right="5px",i.withDebounceUpdate(this.$el.find(".ace_scrollbar")[0],!0,!1,!0),n.focus(),this.editor=n},prepareSpectrum:function(){var t=this,e=new Upfront.Views.Editor.Field.Color({default_value:"#ffffff",showAlpha:!0,showPalette:!0,maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:"Ok",showInput:!0,allowEmpty:!0,autohide:!1,spectrum:{show:function(){},choose:function(e){var i;i=e.get_is_theme_color()!==!1?e.theme_color:e.alpha<1?e.toRgbString():e.toHexString(),t.editor.insert(i),t.editor.focus()}}});e.render(),t.$(".upfront-css-color").html(e.el)},createSelectors:function(t){var e=this,i={};_.each(t,function(t){i[t.cssSelectorsId]=t.cssSelectors||{}}),e.elementSelectors=i},createSelector:function(t,e,i){var n=new t,o=new e({model:n});this.elementSelectors[i]=o.cssSelectors||{},o.remove()},startResizable:function(){var e=this,i=e.$(".upfront-css-body"),n=0,o=e.$(".upfront-css-selectors"),r=e.$(".upfront-css-save-form"),s=this.$(".upfront-css-resizable"),a=function(a,l){var p=l?l.size.height:e.$(".upfront-css-resizable").height(),d=p-n;i.height(d),e.editor&&e.editor.resize(),o.height(d-r.outerHeight()),s.css({width:"",height:"",left:"",top:""}),t("#page").css("padding-bottom",p)};s.find(".upfront-css-top").removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),n=e.$(".upfront-css-top").outerHeight(),a(),s.resizable({handles:{n:".upfront-css-top"},resize:a,minHeight:200,delay:100})},remove:function(){Backbone.View.prototype.remove.call(this),t(window).off("resize",this.resizeHandler)},openThemeImagePicker:function(){this._open_media_popup({themeImages:!0})},openImagePicker:function(){this._open_media_popup()},_open_media_popup:function(t){t=_.isObject(t)?t:{};var e=this,i=_.extend({},t);Upfront.Media.Manager.open(i).done(function(t,i){if(Upfront.Events.trigger("upfront:element:edit:stop"),i&&0!==i.length){var n=i.models[0],o=n.get("image")?n.get("image"):i.models[0],r="src"in o?o.src:"get"in o&&o.get("original_url");e.editor.insert('url("'+r+'")'),e.editor.focus()}})},startInsertFontWidget:function(){var e=new r({editor:this.editor,collection:Upfront.Views.Editor.Fonts.theme_fonts_collection});t("#insert-font-widget").html(e.render().el)},scrollToElement:function(){var e=t("#"+this.element_id);if(e.length){var i=e.offset().top-50;t(document).scrollTop(i>0?i:0),this.blink(e,4)}},hiliteElement:function(e){var i=this.get_css_selector();"posts"!==this.elementType.id&&(i+=" ");var n=i+t(e.target).data("selector");if(n.length){var o=t("#"+this.element_id+n);o.addClass("upfront-css-hilite")}},unhiliteElement:function(e){var i=this.get_css_selector();"posts"!==this.elementType.id&&(i+=" ");var n=i+t(e.target).data("selector");if(n.length){var o=t("#"+this.element_id+n);o.removeClass("upfront-css-hilite")}},addSelector:function(e){var i=t(e.target).data("selector");this.editor.insert(i),this.editor.focus()},get_css_selector:function(){if(this.is_global_stylesheet)return"";if("undefined"==typeof this.options.preset.get("id")||!this.options.preset.get("id"))return"";var t="."+this.options.preset.get("id");return this.dataPartType&&(t=t+".upost-data-object-"+this.dataPartType),"undefined"==typeof this.elementType.preset_container&&(t+=" "),t},updateStyles:function(t){var e=this.get_style_element();Upfront.Util.Transient.push("css-"+this.element_id,e.html()),t=Upfront.Util.colors.convert_string_ufc_to_color(t),e.html(this.stylesAddSelector(t,this.is_default_style?"":"#page "+this.get_css_selector()).replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module")),this.trigger("updateStyles",this.element_id)},stylesAddSelector:function(e,i){if(this.is_global_stylesheet&&empty(i))return e;var n=this,o=e.split("}"),r="";return _.each(o,function(e){var o=t.trim(e).split("{");if(2!=o.length)return!0;var s=o[0].split(","),a=[];_.each(s,function(e){e=t.trim(e);var o=e.replace(/:[^\s]+/,""),r="@"===o[0]||n.recursiveExistence(i,o),s=r?"":" ";a.push(""+i+s+e)}),r+=a.join(", ")+" {"+o[1]+"\n}\n"}),e.match(/\*\/\s*$/)&&!r.match(/\*\/\s*$/)&&(r+="\n*/"),r},recursiveExistence:function(e,i){for(var n=i.split(" "),o=this;n.length>0;){try{if(t(e+n.join(" ")).closest("#"+o.element_id).length)return!0}catch(t){}n.pop()}return!1},save:function(e){e&&e.preventDefault();t.trim(this.editor.getValue());return this.is_global_stylesheet===!1&&this.stylename===this.get_temp_stylename()?Upfront.Views.Editor.notify(n.style_name_nag,"error"):Upfront.Views.Editor.notify(n.preset_style_saved.replace(/%s/,this.elementType.id))}}),r=Backbone.View.extend({initialize:function(t){var e=this;this.editor=t.editor,this.fields=[new Upfront.Views.Editor.Field.Typeface_Chosen_Select({label:"",compact:!0,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_fonts_for_select(),additional_classes:"choose-typeface",select_width:"230px"}),new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({label:"",compact:!0,values:[],additional_classes:"choose-variant",select_width:"120px"}),new Upfront.Views.Editor.Field.Button({label:n.insert_font,compact:!0,on_click:function(){e.preview_font()}})]},render:function(){return t("#insert-font-widget").html("").addClass("open"),this.$el.html(""),_.each(this.fields,function(t){t.render(),this.$el.append(t.el)},this),this.listenTo(this.fields[0],"changed",function(){var t=Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants(this.fields[0].get_value());this.render_variants(t)}),this},render_variants:function(t){var e=this.$el.find(".choose-variant select");e.find("option").remove(),e.append('<option value="">'+n.choose_variant+"</option>"),_.each(t,function(t){e.append('<option value="'+t+'">'+t+"</option>")}),e.trigger("chosen:updated")},preview_font:function(){var t=this.fields[0].get_value();return t?void this.replaceFont({font_family:t,variant:Upfront.Views.Font_Model.parse_variant(this.fields[1].get_value())}):void this.finish()},replaceFont:function(t){var e;this.style_doc=this.editor.getSession().getDocument(),this.last_selected_font=t,this.font_family_range?this.font_family_range.end=this.end_point:this.font_family_range=this.editor.getSelection().getRange(),this.end_point=this.style_doc.replace(this.font_family_range,t.font_family),this.reset_properties(),e=[],t.variant.weight&&e.push("    font-weight: "+t.variant.weight+";"),t.variant.style&&e.push("    font-style: "+t.variant.style+";"),e.length>0&&this.style_doc.insertLines(this.font_family_range.start.row+1,e),this.finish()},reset_properties:function(){var t,e,i;for(this.style_doc=this.editor.getSession().getDocument(),i={},t=this.font_family_range.start.row+1,e=this.style_doc.getLine(t);e.indexOf("}")<0&&(e.indexOf("font-weight")!==-1&&(i.weight=t,this.starting_weight||(this.starting_weight=e)),e.indexOf("font-style")!==-1&&(i.style=t,this.starting_style||(this.starting_style=e)),t++,e=this.style_doc.getLine(t)););i.weight&&i.style&&(i.weight>i.style?(this.style_doc.removeLines(i.weight,i.weight),this.style_doc.removeLines(i.style,i.style)):(this.style_doc.removeLines(i.style,i.style),this.style_doc.removeLines(i.weight,i.weight)),i.weight=!1,i.style=!1),i.weight&&this.style_doc.removeLines(i.weight,i.weight),i.style&&this.style_doc.removeLines(i.style,i.style)},finish:function(){t("#insert-font-widget").html('<a class="upfront-css-font" href="#">'+n.insert_font+"</a>").removeClass("open")}});return o})}(jQuery),define("scripts/upfront/settings/modules/preset-css",["scripts/upfront/settings/modules/base-module","scripts/upfront/preset-settings/preset-css-editor"],function(t,e){var i=Upfront.Settings.l10n.preset_manager,n=t.extend({className:"upfront-settings-css",events:{"click input[name=preset_css]":"openEditor"},initialize:function(e){var n=this;t.prototype.initialize.call(this,e),this.fields=_([new Upfront.Views.Editor.Field.Button({model:n.model,className:"edit_preset_label",compact:!0,label:i.edit_preset_label}),new Upfront.Views.Editor.Field.Button({model:n.model,className:"edit_preset_css",compact:!0,name:"preset_css",label:i.edit_preset_css})])},onPresetUpdate:function(t){this.trigger("upfront:presets:update",t)},updateCss:function(t,e,i){e.replace(/'/g,'"'),t.set({preset_style:e})},openEditor:function(t){var i=this;t.preventDefault(),Upfront.Events.trigger("entity:settings:beforedeactivate");var n=Upfront.Application.cssEditor.getElementType(this.model),o=n.label.toLowerCase()+"-preset-"+this.options.preset.get("id");this.presetCSSEditor=new e({model:this.model,preset:this.options.preset,stylename:o});var r=_.debounce(this.updateCss,1e3);this.listenTo(this.presetCSSEditor,"upfront:presets:update",this.onPresetUpdate),this.listenTo(this.presetCSSEditor,"change",function(t){r(i.options.preset,t,i)}),Upfront.Events.trigger("entity:settings:deactivate")}});return n}),function(t){define("scripts/upfront/preset-settings/util",[],function(){var e=function(t){return t.breakpoint&&t.breakpoint.tablet&&(t.tablet=[],_.each(t.breakpoint.tablet,function(e,i){t.tablet[i]=e})),t.breakpoint&&t.breakpoint.mobile&&(t.mobile=[],_.each(t.breakpoint.mobile,function(e,i){t.mobile[i]=e})),t},i=function(t,i,n){var o=Upfront.Util.template(i);return"undefined"!=typeof t.preset_style&&(t.preset_style=t.preset_style.replace(/#page/g,"#page.upfront-layout-view .upfront-editable_entity.upfront-module"),"thispost"===n&&(t.preset_style=t.preset_style.replace(/.default/g,".default.upfront-this_post")),"ucomment"===n&&(t.preset_style=t.preset_style.replace(/.default/g,".default.upfront-comment")),t.preset_style=Upfront.Util.colors.convert_string_ufc_to_color(t.preset_style,!0)),o({properties:e(t)}).replace(/#page/g,"div#page.upfront-layout-view").replace(new RegExp(t.id+" .upfront-button","g"),t.id+".upfront-button").replace(/\\'/g,"'").replace(/\\'/g,"'").replace(/\\'/g,"'").replace(/\\"/g,'"').replace(/\\"/g,'"').replace(/\\"/g,'"')},n={generateCss:i,generatePresetsToPage:function(t,i){_.each(Upfront.mainData[t+"Presets"],function(o){n.updatePresetStyle(t,e(o),i)})},getPresetProperties:function(e,i){var n=Upfront.mainData[e+"Presets"]||[],o={};return t.each(n,function(t,e){return!e||!e.id||i!==e.id||void(o=_.extend({},e))}),o},updatePresetStyle:function(e,n,o){var r=e+"-preset-"+n.id,s=_.extend({},n);_.each(s,function(t,e){Upfront.Util.colors.is_theme_color(t)&&(s[e]=t)}),0===t("style#"+r).length&&t("body").append('<style class="preset-style" id="'+r+'"></style>'),t("style#"+r).text(Upfront.Util.colors.convert_string_ufc_to_color(i(s,o,e),!0))}};return n})}(jQuery),function(t){define("scripts/upfront/preset-settings/preset-manager",["scripts/upfront/element-settings/root-settings-panel","scripts/upfront/settings/modules/select-preset","scripts/upfront/settings/modules/edit-preset","scripts/upfront/settings/modules/migrate-preset","scripts/upfront/settings/modules/preset-css","scripts/upfront/preset-settings/util","scripts/upfront/preset-settings/preset-css-editor"],function(e,i,n,o,r,s,a){var l=Upfront.Settings.l10n.preset_manager,p=e.extend({className:"uf-settings-panel upfront-settings_panel preset-manager-panel",initialize:function(t){var e=this;this.options=t,_.each(this.options,function(t,e){this[e]=t},this);var i=!1;_.each(Upfront.mainData[this.mainDataCollection],function(t,e){"default"===t.id&&(i=!0)}),i||(Upfront.mainData[this.mainDataCollection]=_.isArray(Upfront.mainData[this.mainDataCollection])?Upfront.mainData[this.mainDataCollection]:[],Upfront.mainData[this.mainDataCollection].unshift(this.getPresetDefaults("default")),s.generatePresetsToPage(this.ajaxActionSlug,this.styleTpl)),this.presets=new Backbone.Collection(Upfront.mainData[this.mainDataCollection]||[]);var n=function(t){return Upfront.Application.user_can("MODIFY_PRESET")?(e.model.trigger("preset:updated",t.id),void Upfront.Application.presetSaver.queue(t,e.ajaxActionSlug)):(e.model.trigger("preset:updated",t.id),!1)};this.debouncedSavePreset=_.debounce(n,1e3),this.createBackup(),this.defaultOverlay(),this.listenToOnce(Upfront.Events,"element:settings:canceled",function(){this.updateCanceledPreset(this.backupPreset)}),this.listenToOnce(Upfront.Events,"upfront:layout_size:change_breakpoint",this.cancelPresetChanges)},createBackup:function(){var t=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",e=this.presets.findWhere({id:t});"undefined"==typeof e&&(e=this.presets.findWhere({id:"default"})),"undefined"==typeof this.backupPreset&&(this.backupPreset=Upfront.Util.clone(e.toJSON()))},defaultOverlay:function(){var t=this,e=this.property("preset")?this.clear_preset_name(this.property("preset")):"default";"default"===e&&setTimeout(function(){t.$el.find(".preset_specific").next().andSelf().wrapAll('<div class="default-overlay-wrapper" />'),t.$el.find(".default-overlay-wrapper").append('<div class="default-overlay"><div class="overlay-title">'+l.default_overlay_title+'</div><div class="overlay-text">'+l.default_overlay_text+'</div><div class="overlay-button"><button type="button" class="overlay-button-input">'+l.default_overlay_button+"</button></div></div>"),t.$el.find(".delete_preset input").prop("disabled",!0),t.$el.find(".delete_preset input").css({opacity:.6})},100),this.$el.on("click",".overlay-button-input",function(e){e.preventDefault(),t.$el.find(".default-overlay").remove(),t.$el.find(".default-overlay-wrapper").css("min-height","30px"),t.$el.find(".delete_preset input").prop("disabled",!1),t.$el.find(".delete_preset input").css({opacity:1})})},updateMainDataCollectionPreset:function(t){var e;_.each(Upfront.mainData[this.mainDataCollection],function(i,n){i.id===t.id&&(e=n)}),"undefined"!=typeof e?Upfront.mainData[this.mainDataCollection][e]=t:Upfront.mainData[this.mainDataCollection].push(t)},migratePresetProperties:function(t){return t},migrateElementStyle:function(t,e){return t},migrateDefaultStyle:function(t){return t},setupItems:function(){this.trigger("upfront:presets:setup-items",this);var t,e,s,a=this.clear_preset_name(this.model.decode_preset()||"default"),l=this.presets.findWhere({id:a});"undefined"==typeof l&&(l=this.presets.findWhere({id:"default"})),this.selectPresetModule&&this.selectPresetModule.stopListening&&(this.selectPresetModule.stopListening(),this.stopListening(this.selectPresetModule)),Upfront.Application.user_can("SWITCH_PRESET")&&(this.selectPresetModule=new i({model:this.model,presets:this.presets})),this.options.hasBreakpointSettings===!0&&(t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),e=l.get("breakpoint")||{},s=e[t.id]||{},_.each(this.options.breakpointSpecificPresetSettings,function(t){if(!_.isUndefined(s[t.name])){var e={};e[t.name]=s[t.name],l.set(e,{silent:!0})}},this)),this.editPresetModule&&this.editPresetModule.stopListening&&(this.editPresetModule.stopListening(),this.stopListening(this.editPresetModule)),Upfront.Application.user_can("SWITCH_PRESET")&&(Upfront.Application.user_can("MODIFY_PRESET")||Upfront.Application.user_can("DELETE_PRESET"))&&(this.editPresetModule=new n({model:l,stateModules:this.stateModules})),this.presetCssModule&&this.presetCssModule.stopListening&&(this.presetCssModule.stopListening(),this.stopListening(this.presetCssModule)),Upfront.Application.user_can("SWITCH_PRESET")&&Upfront.Application.user_can("MODIFY_PRESET")&&(this.presetCssModule=new r({model:this.model,preset:l})),this.migratePresetModule=new o({model:this.model,presets:this.presets,elementPreset:this.styleElementPrefix}),Upfront.Application.user_can("SWITCH_PRESET")&&(this.selectPresetModule&&Upfront.Application.user_can("SWITCH_PRESET")&&this.listenTo(this.selectPresetModule,"upfront:presets:change",this.changePreset),this.selectPresetModule&&Upfront.Application.user_can("SWITCH_PRESET")&&this.listenTo(this.selectPresetModule,"upfront:presets:migrate",this.migratePreset),this.editPresetModule&&Upfront.Application.user_can("DELETE_PRESET")&&this.listenTo(this.editPresetModule,"upfront:presets:delete",this.deletePreset),this.editPresetModule&&Upfront.Application.user_can("DELETE_PRESET")&&this.listenTo(this.editPresetModule,"upfront:presets:reset",this.resetPreset),this.editPresetModule&&Upfront.Application.user_can("MODIFY_PRESET")&&this.listenTo(this.editPresetModule,"upfront:presets:state_show",this.stateShow),this.editPresetModule&&Upfront.Application.user_can("MODIFY_PRESET")&&this.listenTo(this.editPresetModule,"upfront:presets:update",this.updatePreset),this.presetCssModule&&Upfront.Application.user_can("MODIFY_PRESET")&&this.listenTo(this.presetCssModule,"upfront:presets:update",this.updatePreset),this.selectPresetModule&&Upfront.Application.user_can("MODIFY_PRESET")&&this.listenTo(this.selectPresetModule,"upfront:presets:new",this.createPreset)),this.listenTo(this.migratePresetModule,"upfront:presets:preview",this.previewPreset),this.listenTo(this.migratePresetModule,"upfront:presets:change",this.applyExistingPreset),this.listenTo(this.migratePresetModule,"upfront:presets:new",this.migratePreset),this.settings=_([this.selectPresetModule,this.editPresetModule,this.presetCssModule])},getTitle:function(){return"Appearance"},getPresetDefaultsMigration:function(t){var e=this.styleElementPrefix.replace(/-preset/,"");return"tab"===e||"accordion"===e||"contact"===e||"button"===e?_.extend({},{id:t.toLowerCase().replace(/ /g,"-"),name:t}):_.extend(this.presetDefaults,{id:t.toLowerCase().replace(/ /g,"-"),name:t})},getPresetDefaults:function(t){return _.extend(this.presetDefaults,{id:t.toLowerCase().replace(/ /g,"-"),name:t,preset_style:""})},updateCanceledPreset:function(t){s.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),t,this.styleTpl),this.debouncedSavePreset(t),this.updateMainDataCollectionPreset(t)},updatePreset:function(t){var e,i;this.options.hasBreakpointSettings===!0&&(e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),i=t.breakpoint||{},i[e.id]=i[e.id]||{},_.each(this.options.breakpointSpecificPresetSettings,function(n){i[e.id][n.name]=t[n.name],delete t[n.name]},this),t.breakpoint=i),s.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),t,this.styleTpl),this.debouncedSavePreset(t),this.updateMainDataCollectionPreset(t)},migratePreset:function(e){var i=this.presets.findWhere({id:e.toLowerCase().replace(/ /g,"-")}),n="";if("undefined"!=typeof i)return void Upfront.Views.Editor.notify(l.preset_already_exist.replace(/%s/,e),"error");var o=this.property("theme_style");o||(o="_default"),"_default"!==o&&(Upfront.Application.cssEditor.init({model:this.model,stylename:"_default",no_render:!0}),n=t.trim(Upfront.Application.cssEditor.get_style_element().html().replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page")),n=n.replace(/#page/g,""),n=this.migrateDefaultStyle(n),n=Upfront.Application.stylesAddSelectorMigration(t.trim(n),"#page ."+e.toLowerCase().replace(/ /g,"-"))),Upfront.Application.cssEditor.init({model:this.model,stylename:o,no_render:!0});var r=t.trim(Upfront.Application.cssEditor.get_style_element().html().replace(/div#page.upfront-layout-view .upfront-editable_entity.upfront-module/g,"#page"));r=r.replace(new RegExp(o,"g"),e.toLowerCase().replace(/ /g,"-")),"_default"!==o?r=n+r:(r=this.migrateDefaultStyle(r),r=Upfront.Application.stylesAddSelectorMigration(t.trim(r),"#page ."+e.toLowerCase().replace(/ /g,"-"))),r=this.migrateElementStyle(r,"#page ."+e.toLowerCase().replace(/ /g,"-")),newPreset=new Backbone.Model(this.getPresetDefaultsMigration(e)),"undefined"!=typeof r&&newPreset.set({preset_style:r}),this.migratePresetProperties(newPreset),this.property("preset",newPreset.id),this.presets.add(newPreset),presetOptions=newPreset,properties=newPreset.toJSON(),this.property("theme_style",""),s.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),properties,this.styleTpl),this.debouncedSavePreset(properties),this.updateMainDataCollectionPreset(properties),this.property("usingNewAppearance",!0),this.model.get("properties").trigger("change"),Upfront.Views.Editor.notify(l.preset_created.replace(/%s/,e)),this.render(),Upfront.Events.trigger("element:preset:updated")},createPreset:function(t){var e=this.presets.findWhere({id:t.toLowerCase().replace(/ /g,"-")});if("undefined"!=typeof e)return void Upfront.Views.Editor.notify(l.preset_already_exist.replace(/%s/,t),"error");var i=this.getPresetDefaults(t);this.presets.add(i),this.model.set_property("preset",i.id),this.updatePreset(i),this.model.encode_preset(i.id),Upfront.Views.Editor.notify(l.preset_created.replace(/%s/,t)),this.render(),Upfront.Events.trigger("element:preset:updated")},deletePreset:function(t){var e;Upfront.Util.post({data:t.toJSON(),action:"upfront_delete_"+this.ajaxActionSlug+"_preset"}),_.each(Upfront.mainData[this.mainDataCollection],function(i,n){i.id===t.get("id")&&(e=n)}),Upfront.mainData[this.mainDataCollection].splice(e,1),this.model.set_property("preset","default"),this.model.encode_preset("default"),this.presets.remove(t),this.render(),Upfront.Events.trigger("element:preset:updated"),this.defaultOverlay()},resetPreset:function(t){var e=this;Upfront.Util.post({data:t.toJSON(),action:"upfront_reset_"+this.ajaxActionSlug+"_preset"}).success(function(i){var n=i.data;(_.isEmpty(i.data)||i.data===!1)&&(n=e.getPresetDefaults("default")),s.updatePresetStyle(e.styleElementPrefix.replace(/-preset/,""),n,e.styleTpl),e.updateMainDataCollectionPreset(n),e.presets=new Backbone.Collection(Upfront.mainData[e.mainDataCollection]||[]),Upfront.Views.Editor.notify(l.preset_reset.replace(/%s/,t.get("id"))),e.$el.empty(),e.render(),Upfront.Events.trigger("element:preset:updated")}).error(function(t){Upfront.Views.Editor.notify(t)})},applyExistingPreset:function(t){this.property("usingNewAppearance",!0),this.changePreset(t),this.defaultOverlay()},changePreset:function(t){this.stopListening(),this.model.set_property("theme_style",""),this.model.encode_preset(t),this.render(),this.defaultOverlay(),Upfront.Events.trigger("entity:layout:change"),Upfront.Events.trigger("element:preset:updated"),Upfront.Views.Editor.notify(l.preset_changed.replace(/%s/,t))},previewPreset:function(e){var i,n=this.property("element_id"),o=this.styleElementPrefix.replace(/-preset/,""),r=this.model.get_property_value_by_name("theme_style");""===e&&r?t("#"+n).addClass(r):r&&(t("#"+n).removeClass(r),t("#"+n).find("."+r).removeClass(r)),"accordion"===o?(i=t("#"+n).find(".upfront-accordion-container"),i.removeClass(this.getPresetClasses(o)),""!==e?i.addClass(o+"-preset-"+e):i.addClass(o+"-preset-"+this.model.get_property_value_by_name("preset"))):"tab"===o?(i=t("#"+n).find(".upfront-tabs-container"),i.removeClass(this.getPresetClasses(o)),""!==e?i.addClass(o+"-preset-"+e):i.addClass(o+"-preset-"+this.model.get_property_value_by_name("preset"))):"button"===o?(i=t("#"+n).find(".upfront_cta"),i.removeClass(this.getPresetClasses(o)),""!==e?i.addClass(o+"-preset-"+e):i.addClass(o+"-preset-"+this.model.get_property_value_by_name("preset"))):_.contains(["image","text","gallery","slider","contact"],o)?("undefined"==typeof this.actualModelData&&(this.actualModelData=Upfront.Util.model_to_json(this.model)),""!==e?(this.model.set_property("usingNewAppearance",!0,!0),this.model.set_property("theme_style","",!0),this.model.set_property("preset",e,!0),this.model.trigger("change"),this.previousPresetClass=e):(actualProperties=new Upfront.Collections.Properties(this.actualModelData.properties),actualProperties._events=this.model.get("properties")._events,this.model.set("properties",actualProperties),t(".upfront-active_entity").removeClass(this.previousPresetClass))):(t("#"+n).removeClass(this.getPresetClasses()),""!==e&&t("#"+n).addClass(e))},getPresetClasses:function(t){var e="";return _.map(this.presets.models,function(i){e+="undefined"!=typeof t&&t?t+"-preset-"+i.get("id")+" ":i.get("id")+" "}),e},stateShow:function(t){this.trigger("upfront:presets:state_show",t)},getModifiedProperties:function(){return!0},migrateToDefault:function(){var t=this.getModifiedProperties(),e=this.property("usingNewAppearance");return t||e||(this.property("usingNewAppearance",!0),this.property("preset","default"),this.defaultOverlay()),!1},getBody:function(){this.setupItems();var e=t("<div />"),i=this;return this.migrateToDefault(),this.property("usingNewAppearance")!==!0&&(this.settings=_([this.migratePresetModule])),this.settings.each(function(t){return!(t||{}).render||(t.panel||(t.panel=i),t.render(),void e.append(t.el))}),e},clear_preset_name:function(t){return t=t.replace(" ","-"),t=t.replace(/[^-a-zA-Z0-9]/,"")},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},save_settings:function(){}});return p})}(jQuery),function(t){define("scripts/upfront/settings/root-modules-panel",["scripts/upfront/settings/modules-container","scripts/upfront/element-settings/root-panel-mixin"],function(e,i){var n=e.extend(_.extend({},i,{getBody:function(){var e=t("<div />");e.append('<div class="upfront-settings-item-content"></div>');var i=e.find(".upfront-settings-item-content");return this.modules.each(function(t){t.render(),t.delegateEvents(),i.append(t.el)}),e}}));return n})}(jQuery),define("scripts/upfront/element-settings/advanced-settings",["scripts/upfront/settings/root-modules-panel"],function(t){var e=t.extend({className:"uf-settings-panel upfront-settings_panel advanced-settings",modules:[{moduleType:"Anchor"}],getAdditionalModules:function(t){var e,i=_.contains(["UtabsView","UaccordionView","ButtonView"],this.model.get_property_value_by_name("view_class"));return i?(e=this.model.get_property_value_by_name("theme_style"),e&&"_default"!==e?(t.unshift({moduleType:"ElementStyle"}),t):t):t},title:"Advanced Settings"});return e}),function(t){define("scripts/upfront/element-settings/settings",["scripts/upfront/preset-settings/preset-manager","scripts/upfront/element-settings/advanced-settings","scripts/perfect-scrollbar/perfect-scrollbar"],function(t,e,i){var n=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,o=Backbone.View.extend({id:"settings",events:{"click .upfront-save_settings":"saveSettings","click .upfront-cancel_settings":"cancelSettings"},initialize:function(i){this.options=i;var n,o,r,s=this,a={},l=!Upfront.Application.user_can("SWITCH_PRESET")&&!Upfront.Application.user_can("MODIFY_PRESET")&&!Upfront.Application.user_can("DELETE_PRESET");this.hasBreakpointSettings===!0&&(n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),o=this.model.get_property_value_by_name("breakpoint")||{},r=o[n.id]||{},_.each(this.breakpointSpecificSettings,function(t){_.isUndefined(r[t.name])||this.model.set_property(t.name,r[t.name],!0)},this)),_.each(this.panels,function(e,i){return"Appearance"!==i||l?void(_.isFunction(e)&&(a[i]=new e({model:this.model}))):(this.appearancePanel=new t(_.extend({hasBreakpointSettings:this.hasBreakpointSettings,breakpointSpecificPresetSettings:this.breakpointSpecificPresetSettings,model:this.model},e)),this.listenTo(this.appearancePanel,"upfront:presets:state_show",this.stateShow),void(a.Appearance=this.appearancePanel))},this),Upfront.Application.user_can("MODIFY_PRESET")&&(a.Advanced=new e({model:this.model})),this.panels=a,this.on("open",function(){s.model.trigger("settings:open",s)}),this.listenTo(Upfront.Events,"element:settings:render",this.setScrollMaxHeight)},saveSettings:function(){var t,e;this.hasBreakpointSettings===!0&&this.breakpointSpecificSettings&&(t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),e=this.model.get_property_value_by_name("breakpoint")||{},e[t.id]=e[t.id]||{},_.each(this.breakpointSpecificSettings,function(i){e[t.id][i.name]=this.model.get_property_value_by_name(i.name),e[t.id].width=t.get("width")},this),this.model.set_property("breakpoint",e,!0)),_.each(this.panels,function(t){t.save_settings()}),this.model.get("properties").trigger("change"),Upfront.Events.trigger("element:settings:saved"),Upfront.Events.trigger("element:settings:deactivate"),this.onSaveSettings&&this.onSaveSettings(),this.removePreviewClasses()},cancelSettings:function(){this.removePreviewClasses(),Upfront.Events.trigger("element:settings:canceled")},stateShow:function(t){var e=this.for_view.$el.find(".upfront-object");"static"!==t?(this.removePreviewClasses(),e.addClass("live-preview-"+t)):this.removePreviewClasses()},removePreviewClasses:function(){var t=this.for_view.$el.find(".upfront-object");t.removeClass("live-preview-hover live-preview-focus live-preview-active")},render:function(){var t=this;this.$el.html('<div class="upfront-settings-title">'+this.title+'</div><div id="sidebar-scroll-wrapper" />'),Upfront.Events.trigger("settings:prepare"),_.each(this.panels,function(e){e.render(),e.parent_view=t,t.$el.find("#sidebar-scroll-wrapper").append(e.el),i.withDebounceUpdate(t.$el.find("#sidebar-scroll-wrapper")[0],!1,"menu_element:settings:rendered",!0)}),this.$el.addClass("upfront-ui"),this.$el.append("<div class='upfront-settings-button_panel'><button type='button' class='upfront-cancel_settings'>"+n.cancel+"</button><button type='button' class='upfront-save_settings'><i class='icon-ok'></i> "+n.save_element+"</button></div>")},setScrollMaxHeight:function(){var t=this.$el.height(),e=this.$el.find(">.upfront-settings-title").outerHeight(!0),i=this.$el.find(">.upfront-settings-button_panel").outerHeight(!0);this.$el.find("#sidebar-scroll-wrapper").css("max-height",t-e-i+"px")},cleanUp:function(){this.panels&&_.each(this.panels,function(t){t.cleanUp&&t.cleanUp()}),this.remove()}});return o})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define("bg-settings",["scripts/upfront/bg-settings/color-item","scripts/upfront/bg-settings/image-item","scripts/upfront/bg-settings/map-item","scripts/upfront/bg-settings/slider-item","scripts/upfront/bg-settings/video-item","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/element-settings/advanced-settings","scripts/perfect-scrollbar/perfect-scrollbar"],function(t,i,n,o,r,s,a,l,p){var d=Upfront.Views.Editor.Settings.Item.extend({initialize:function(t){var i=this,n=this.model.get_breakpoint_property_value("background_image",!0),o=[{label:e.solid_color,value:"color",icon:"color"},{label:e.image,value:"image",icon:"image"},{label:e.video,value:"video",icon:"video"},{label:e.image_slider,value:"slider",icon:"slider"},{label:e.map,value:"map",icon:"map"}];_upfront_post_data.post_id&&o.push({label:e.featured_image,value:"featured",icon:"feat"}),_.isArray(t.enable_types)&&(o=_.filter(o,function(e){return _.contains(t.enable_types,e.value)})),t.fields=[new Upfront.Views.Editor.Field.Select({model:this.model,className:"upfront-field-wrap upfront-field-wrap-select background-type-field",label:e.background_type,property:"background_type",use_breakpoint_property:!0,default_value:n?"image":"color",icon_class:"upfront-region-field-icon",values:o,change:function(){var t=this.get_value();i.panel.parent_view.panels[0].toggle_setting(t),this.model.set_breakpoint_property(this.property_name,t)}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"use_padding",className:"upfront-field-wrap upfront-field-wrap-multiple upfront-settings-item-content upfront-field-wrap-checkboxes padding-bg-checkbox-field",use_breakpoint_property:!0,default_value:0,layout:"horizontal-inline",multiple:!1,values:[{label:e.use_theme_padding,value:1}],change:function(){var t=this.get_value();this.model.set_breakpoint_property(this.property_name,t?1:0)}})],this.$el.addClass("uf-bgsettings-item"),this.constructor.__super__.initialize.call(this,t)}}),c=Upfront.Views.Editor.Settings.Settings.extend({initialize:function(e){this.options=e,this.has_tabs=!1;var s=this,a={color:t,image:i,featured:i,slider:o,video:r,
map:n};_.isUndefined(e.enable_types)||(this.enable_types=e.enable_types),this.settings={},_.each(a,function(t,e){_.contains(s.enable_types,e)&&(s.settings[e]=new t({model:s.model}),s.settings[e].once("rendered",function(){this.trigger("hide")}))});var l={model:this.model,enable_types:this.enable_types};this.bg_title?l.title=this.bg_title:l.group=!1;var p=new d(l);this.panels=_([new Upfront.Views.Editor.Settings.Panel({model:this.model,settings:_.union([p],_.map(this.settings,function(t){return t}))})]),this.once("open",function(){var t=s.model.get_breakpoint_property_value("background_type",!0),e=s.model.get_breakpoint_property_value("background_image",!0);t?s.toggle_setting(t):s.toggle_setting(e?"image":"color")})},toggle_setting:function(t){_.each(this.settings,function(e,i){i==t?e.trigger("show"):e.trigger("hide")})}}),u=a.extend({className:"upfront-settings_panel_wrap ugroup-settings",title:e.group_settings,initialize:function(e){this.options=e,this.has_tabs=!1;this.listenTo(Upfront.Events,"element:settings:render",this.settings_opened);var n=new t({model:this.model}),o=new i({model:this.model}),r={model:this.model,enable_types:["color","image"]};this.bg_title?r.title=this.bg_title:r.group=!1;var s=new d(r);this.settings=_({bgitem:s,color:n,image:o})},render:function(t){this.constructor.__super__.render.call(this,t);var e=this.$el.find(".uf-settings-panel__body");this.$el.find(".padding-bg-checkbox-field").appendTo(e),p.initialize(e[0],{suppressScrollX:!0})},settings_opened:function(){var t=this.model.get_breakpoint_property_value("background_type",!0),e=this.model.get_breakpoint_property_value("background_image",!0);t?this.toggle_setting(t):this.toggle_setting(e?"image":"color")},toggle_setting:function(t){_.each(this.settings._wrapped,function(e,i){i==t?e.trigger("show"):e.trigger("hide")})},get_label:function(){return e.group_bg},get_title:function(){return e.group_bg}}),h=s.extend({initialize:function(t){this.has_tabs=!1,this.options=t;var e=new u(t);this.panels=[e,new l({model:this.model})]},title:e.group_settings});Upfront.Views.Editor.BgSettings={Settings:c,GroupSettings:h,BgItem:d,ColorItem:t,ImageItem:i,MapItem:n,SliderItem:o,VideoItem:r}})}(jQuery),define("elements/upfront-accordion/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.uaccordion.defaults),e=Upfront.data.uaccordion.defaults;t.accordion=[],t.accordion[0]={},t.accordion[0].content=_.clone(e.accordion[0].content),t.accordion[0].title=_.clone(e.accordion[0].title),t.accordion[1]={},t.accordion[1].content=_.clone(e.accordion[1].content),t.accordion[1].title=_.clone(e.accordion[1].title),t.element_id=Upfront.Util.get_unique_id("uaccordion-object"),this.init_properties(t)}});return t}),define("elements/upfront-accordion/js/element",["elements/upfront-accordion/js/model"],function(t){var e=Upfront.Settings.l10n.accordion_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:140,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-accordion"),this.$el.html(e.element_name)},add_element:function(){var e=new t,i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c9 upfront-accordion_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(225)}],objects:[e]});this.add_module(i)}});return i}),define("text!elements/upfront-accordion/tpl/preset-style.html",[],function(){return"#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title p {\n\t<?php if(!empty($properties['static-header-bg-color'])) { ?>background: <?php echo $properties['static-header-bg-color'] ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-useborder'])) { ?>\n        <?php if(!empty($properties['static-borderwidth']) && !empty($properties['static-bordertype']) && !empty($properties['static-bordercolor'])) { ?>border: <?php echo $properties['static-borderwidth'] ?>px <?php echo $properties['static-bordertype'] ?> <?php echo $properties['static-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n\t<?php if(!empty($properties['hover-use-animation'])) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration']  ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } else { ?>\n\t\ttransition: none;\n\t<?php } ?>\n}\n\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:hover,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:hover p,\n#page .upfront-accordion.<?php echo $properties['id']  ?>.live-preview-hover .upfront-accordion-container .accordion-panel-title {\n\t<?php if(!empty($properties['hover-use-colors'])) { ?>\n\t\t<?php if(!empty($properties['hover-header-bg-color'])) { ?>background: <?php echo $properties['hover-header-bg-color'] ?>; <?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-header-bg-color'])) { ?>background: <?php echo $properties['static-header-bg-color'] ?>; <?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover-use-typography'])) { ?>\n\t\t<?php if(!empty($properties['hover-font-color'])) { ?>color: <?php echo $properties['hover-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover-font-family'])) { ?>font-family: <?php echo $properties['hover-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover-font-size'])) { ?>font-size: <?php echo $properties['hover-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover-weight'])) { ?>font-weight: <?php echo $properties['hover-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover-style'])) { ?>font-style: <?php echo $properties['hover-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover-line-height'])) { ?>line-height: <?php echo $properties['hover-line-height']  ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover-useborder'])) { ?>\n        <?php if(!empty($properties['hover-borderwidth']) && !empty($properties['hover-bordertype']) && !empty($properties['hover-bordercolor'])) { ?>border: <?php echo $properties['hover-borderwidth'] ?>px <?php echo $properties['hover-bordertype'] ?> <?php echo $properties['hover-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-active .accordion-panel-title,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-active .accordion-panel-title p,\n#page .upfront-accordion.<?php echo $properties['id']  ?>.live-preview-active .upfront-accordion-container .accordion-panel-title {\n\t<?php if(!empty($properties['active-use-color'])) { ?>\n\t\t<?php if(!empty($properties['active-header-bg-color'])) { ?>background: <?php echo $properties['active-header-bg-color'] ?>; <?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-header-bg-color'])) { ?>background: <?php echo $properties['static-header-bg-color'] ?>; <?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['active-use-typography'])) { ?>\n\t\t<?php if(!empty($properties['active-font-color'])) { ?>color: <?php echo $properties['active-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['active-font-family'])) { ?>font-family: <?php echo $properties['active-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['active-font-size'])) { ?>font-size: <?php echo $properties['active-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['active-weight'])) { ?>font-weight: <?php echo $properties['active-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['active-style'])) { ?>font-style: <?php echo $properties['active-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['active-line-height'])) { ?>line-height: <?php echo $properties['active-line-height']  ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['active-useborder'])) { ?>\n        <?php if(!empty($properties['active-borderwidth']) && !empty($properties['active-bordertype']) && !empty($properties['active-bordercolor'])) { ?>border: <?php echo $properties['active-borderwidth'] ?>px <?php echo $properties['active-bordertype'] ?> <?php echo $properties['active-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n\ttransition: none;\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-content,\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-content p {\n\t<?php if (!empty($properties['active-content-bg-color'])) { ?>\n\t\tbackground: <?php echo $properties['active-content-bg-color'] ?>;\n\t<?php } ?>\n\t<?php if(!empty($properties['global-useborder'])) { ?>\n        <?php if(!empty($properties['global-borderwidth']) && !empty($properties['global-bordertype']) && !empty($properties['global-bordercolor'])) { ?>border: <?php echo $properties['global-borderwidth'] ?>px <?php echo $properties['global-bordertype'] ?> <?php echo $properties['global-bordercolor'] ?>;<?php } ?>\n\t<?php } ?>\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:after {\n\tborder-top-color: <?php echo $properties['static-triangle-icon-color'] ?>;\n\tborder-left-color: transparent;\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-title:hover:after {\n\t<?php if(!empty($properties['hover-use-colors'])) { ?>\n\tborder-top-color: <?php echo $properties['hover-triangle-icon-color'] ?>;\n\t<?php } else { ?>\n\tborder-top-color: <?php echo $properties['static-triangle-icon-color'] ?>;\n\t<?php } ?>\n\tborder-left-color: transparent;\n}\n#page .upfront-accordion-container.accordion-preset-<?php echo $properties['id'] ?> .accordion-panel-active .accordion-panel-title:after {\n\tborder-top-color: transparent;\n\t<?php if(!empty($properties['active-use-color'])) { ?>\n\t\tborder-left-color: <?php echo $properties['active-triangle-icon-color'] ?>;\n\t<?php } else { ?>\n\t\tborder-left-color: <?php echo $properties['static-triangle-icon-color'] ?>;\n\t<?php } ?>\n}\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-accordion/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-accordion/tpl/preset-style.html"],function(t,e,i){var n=Upfront.Settings.l10n.accordion_element,o=t.extend({panels:{Appearance:{mainDataCollection:"accordionPresets",styleElementPrefix:"accordion-preset",ajaxActionSlug:"accordion",panelTitle:n.settings,styleTpl:i,presetDefaults:Upfront.mainData.presetDefaults.accordion,stateModules:{Global:[{moduleType:"Colors",options:{title:n.content_area_colors_label,multiple:!1,single:!0,abccolors:[{name:"active-content-bg-color",label:n.content_area_bg_label}]}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"global-useborder",width:"global-borderwidth",type:"global-bordertype",color:"global-bordercolor"}}}],Static:[{moduleType:"Colors",toggle:!1,options:{title:n.colors_label,abccolors:[{name:"static-header-bg-color",label:n.header_bg_label},{name:"static-triangle-icon-color",label:n.triangle_icon_label}]}},{moduleType:"Typography",toggle:!1,options:{state:"static",title:n.typography_tab_label,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"}}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"static-useborder",width:"static-borderwidth",type:"static-bordertype",color:"static-bordercolor"}}}],Hover:[{moduleType:"Colors",options:{title:n.colors_label,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-colors"},abccolors:[{name:"hover-header-bg-color",label:n.header_bg_label},{name:"hover-triangle-icon-color",label:n.triangle_icon_label}]}},{moduleType:"Typography",options:{state:"hover",toggle:!0,prepend:"hover-",prefix:"static",title:n.typography_tab_label,fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"}}},{moduleType:"Border",options:{state:"hover",title:"",prepend:"hover-",prefix:"static",fields:{use:"hover-useborder",width:"hover-borderwidth",type:"hover-bordertype",color:"hover-bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hover-use-animation",duration:"hover-transition-duration",easing:"hover-transition-easing"}}}],Active:[{moduleType:"Colors",options:{title:n.colors_label,toggle:!0,prepend:"active-",prefix:"static",fields:{use:"active-use-color"},abccolors:[{name:"active-header-bg-color",label:n.header_bg_label},{name:"active-triangle-icon-color",label:n.triangle_icon_label}]}},{moduleType:"Typography",options:{state:"active",toggle:!0,prepend:"active-",prefix:"static",title:n.typography_tab_label,fields:{use:"active-use-typography",typeface:"active-font-family",fontstyle:"active-font-style",weight:"active-weight",style:"active-style",size:"active-font-size",line_height:"active-line-height",color:"active-font-color"}}},{moduleType:"Border",options:{state:"active",title:"",prepend:"active-",prefix:"static",fields:{use:"active-useborder",width:"active-borderwidth",type:"active-bordertype",color:"active-bordercolor"}}}]},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-accordion\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,""),t=t.replace(/(div)?\.upfront-accordion-container\s/g,""),t=t.replace(/(div)?\.accordion-panel\s/g,"")},migrateElementStyle:function(t,e){var i=new RegExp(e.replace(".","."),"g");return t=t.replace(i,e+" .upfront-accordion-container ")},migratePresetProperties:function(t){var e=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",i=this.presets.findWhere({id:e}),n={};"undefined"!=typeof i&&_.each(i.attributes,function(t,e){"id"!==e&&"name"!==e&&"preset_style"!==e&&"legacy"!==e&&(n[e]=t)}),t.set(n)}}},title:"Accordion Settings"});return e.generatePresetsToPage("accordion",i),o}),define("text!elements/upfront-accordion/tpl/uaccordion.html",[],function(){return'<div class="upfront-accordion-container accordion-preset-<?php echo $preset ?>">\r\n\t<div class="upfront-accordion-wrap">\r\n        <!-- <b class="upfront-entity_meta upfront-ui">\r\n            <a href="#" class="upfront-icon-button upfront-icon-button-accordion-add-panel accordion-add-panel"></a>\r\n        </b> -->\r\n        <?php for ($i = 0; $i < $accordion_count; $i++) { ?>\r\n        <div class="accordion-panel <?php if($i === 0) { ?>accordion-panel-active<?php } ?>">\r\n            <div class="accordion-panel-title" id="title_<?php echo $element_id ?>-<?php echo $i ?>"><?php echo $accordion[$i][\'title\'] ?></div>\r\n            <div id="<?php echo $element_id ?>-<?php echo $i ?>" class="accordion-panel-content"><?php echo $accordion[$i][\'content\'] ?></div>\r\n            <i>x</i>\r\n        </div>\r\n        <?php } ?>\r\n    </div>\r\n</div>\r\n'}),function(t){define("uaccordion",["elements/upfront-accordion/js/model","elements/upfront-accordion/js/element","elements/upfront-accordion/js/settings","scripts/upfront/preset-settings/util","text!elements/upfront-accordion/tpl/uaccordion.html","text!elements/upfront-accordion/tpl/preset-style.html"],function(e,i,n,o,r,s){var a=Upfront.Settings.l10n.accordion_element,l=Upfront.Views.ObjectView.extend({model:e,currentEditItem:"",currentPanelId:!1,accordionTpl:Upfront.Util.template(r),elementSize:{width:0,height:0},initialize:function(){this.model instanceof e||(this.model=new e({properties:this.model.get("properties")})),this.events=_.extend({},this.events,{"click .accordion-panel-title":"onPanelTitleClick","dblclick .accordion-panel-title":"onPanelTitleDblClick","click i":"deletePanel"}),this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),Upfront.Events.on("entity:deactivated",this.stopEdit,this),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this)},update_colors:function(){var t=this.model.get_property_value_by_name("preset"),e=o.getPresetProperties("accordion",t)||{};return!(_.size(e)<=0)&&void o.updatePresetStyle("accordion",e,s)},stopEdit:function(){var e=this.$el.find(".accordion-panel .accordion-panel-title");e.each(function(){var e=t(this),i=e.data("ueditor");i&&i.stop&&i.stop()}),Upfront.Events.trigger("upfront:element:edit:stop")},addPanel:function(e){e.preventDefault(),this.property("accordion").push({title:a.panel_label+" "+(1+this.property("accordion_count")),content:t.trim(a.content_label.replace("</p>"," "+(1+this.property("accordion_count")+"</p>")))}),this.property("accordion_count",this.property("accordion").length,!1)},deletePanel:function(e){if(!Upfront.Application.user_can_modify_layout())return!1;var i=t(e.currentTarget),n=i.parents(".accordion-panel"),o=n.index();this.property("accordion").splice(o,1),this.property("accordion_count",this.property("accordion_count")-1,!1)},onPanelTitleClick:function(e){var i=t(e.currentTarget),n=i.closest(".accordion-panel");n.hasClass("accordion-panel-active")||(this.$el.find(".accordion-panel-content").each(function(){var e=t(this).data("ueditor");e&&e.stop()}),n.addClass("accordion-panel-active").find(".accordion-panel-content").slideDown(),n.siblings().removeClass("accordion-panel-active").find(".accordion-panel-content").slideUp())},onPanelTitleDblClick:function(t){if(!Upfront.Application.user_can_modify_layout())return!1;var e=this.$el.find(".accordion-panel-active"),i=e.find(".accordion-panel-title"),n=i.data("ueditor");n&&n.start&&!n.active&&n.start()},save_panel_content:function(){var t=this.$el.find(".accordion-panel-active"),e=t.index(),i=t.find(".accordion-panel-content"),n=t.find(".accordion-panel-title"),o=i.data("ueditor"),r=n.data("ueditor"),s="",a="";try{s=o.getValue(!0)}catch(t){s=""}try{a=r.getValue(!0)}catch(t){a=""}this.currentPanelId=n.attr("id"),this.property("accordion")[e].content=s||i.html(),this.property("accordion")[e].title=a||n.html()},get_content_markup:function(){var t=this.extract_properties();return t.preset=t.preset||"default",t.show_add=!0,t.show_remove=this.property("accordion_count")>1,this.accordionTpl(t)},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t},on_render:function(){var e=1,i=this;Upfront.Application.user_can_modify_layout()?(this.$el.find(".accordion-panel-title").each(function(){var n=t(this);return!!n.data("ueditor")||(n.ueditor({linebreaks:!1,disableLineBreak:!0,air:!1,autostart:!1,placeholder:"Panel "+e}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){i.save_panel_content(),i.render(),Upfront.Events.trigger("upfront:element:edit:stop")}).on("syncAfter",function(){i.save_panel_content()}).on("keydown",function(t){if(9===t.which||13===t.which)return t.preventDefault(),t.stopImmediatePropagation(),!1}).addClass("uf-click-to-edit-text"),n.data("ueditor").stop(),void e++)}),i.$el.find(".accordion-panel-content").each(function(){var e=t(this);return!!e.data("ueditor")||void e.ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:!1}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start")}).on("syncAfter",function(){i.save_panel_content()}).on("stop",function(){i.save_panel_content(),i.render(),Upfront.Events.trigger("upfront:element:edit:stop")})})):this.$el.find(".accordion-panel i").remove(),this.$el.find("div#"+this.currentPanelId).parent().addClass("accordion-panel-active").siblings().removeClass("accordion-panel-active"),this.$el.find(".accordion-panel:not(.accordion-panel-active) .accordion-panel-content").hide(),Upfront.Events.trigger("entity:object:refresh",this)},editContent:function(){this.$el.find(".accordion-panel-active .accordion-panel-content").data("ueditor").start(),setTimeout(function(){Upfront.Events.trigger("upfront:element:edit:start")},250)},addTooltips:function(){t(".accordion-panel").each(function(){var e=t(this).find("span")[0];e.offsetWidth<e.scrollWidth&&t(this).attr("title",t(e).text().trim())})},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},getControlItems:function(){return _([this.createControl("add",a.add_panel,"addPanel"),this.createPaddingControl(),this.createControl("settings",a.settings,"on_settings_click")])}});Upfront.Application.LayoutEditor.add_object("Uaccordion",{Model:e,View:l,Element:i,Settings:n,anchor:{is_target:!1},cssSelectors:{".accordion-panel":{label:a.css.containers_label,info:a.css.containers_info},".accordion-panel-title":{label:a.css.header_label,info:a.css.header_info},".accordion-panel-active .accordion-panel-title":{label:a.css.active_header_label,info:a.css.active_header_info},".accordion-panel-content":{label:a.css.body_label,info:a.css.body_info},".accordion-panel:first-of-type":{label:a.css.first_label,info:a.css.first_info},".accordion-panel:last-child":{label:a.css.last_label,info:a.css.last_info},".accordion-panel:nth-child(2n+3)":{label:a.css.odd_label,info:a.css.odd_info},".accordion-panel:nth-child(2n)":{label:a.css.even_label,info:a.css.even_info},".upfront-accordion-wrap":{label:a.css.wrap,info:a.css.wrap_info}},cssSelectorsId:Upfront.data.uaccordion.defaults.type}),Upfront.Models.UaccordionModel=e,Upfront.Views.UaccordionView=l})}(jQuery),function(t){"use strict";function e(t,i){return new e.prototype.init(t,i)}Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t)}});var i=0,n=/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,o=/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/;t.fn.redactor=function(i){var n=[],o=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var e,r=t.data(this,"redactor");if("-1"!=i.search(/\./)?(e=i.split("."),"undefined"!=typeof r[e[0]]&&(e=r[e[0]][e[1]])):e=r[i],"undefined"!=typeof r&&t.isFunction(e)){var s=e.apply(r,o);void 0!==s&&s!==r&&n.push(s)}else t.error('No such method "'+i+'" for Redactor')}):this.each(function(){t.data(this,"redactor",{}),t.data(this,"redactor",e(this,i))}),0===n.length?this:1===n.length?n[0]:n},t.Redactor=e,t.Redactor.VERSION="10.0.9",t.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"],t.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,removeComments:!1,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}}},e.fn=t.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(e,n){if(this.$element=t(e),this.uuid=i++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(n),this.loadModules(),this.formatting={},t.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),this.opts.deniedTags!==!1)for(var o=["html","head","link","body","meta","applet"],r=0;r<o.length;r++)this.opts.deniedTags.push(o[r]);this.lang.load(),t.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(e){this.opts=t.extend({},t.extend(!0,{},t.Redactor.opts),this.$element.data(),e)},getModuleMethods:function(t){return Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]})},loadModules:function(){for(var e=t.Redactor.modules.length,i=0;i<e;i++)this.bindModuleMethods(t.Redactor.modules[i])},bindModuleMethods:function(t){if("undefined"!=typeof this[t]){this[t]=this[t]();for(var e=this.getModuleMethods(this[t]),i=e.length,n=0;n<i;n++)this[t][e[n]]=this[t][e[n]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(t){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=t,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),
this.selection.restore(),this.code.sync()},setText:function(){var e=this.selection.wrap("div");t(e).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){t.each(this.alignment.blocks,t.proxy(function(t,e){var i=this.utils.getAlignmentElement(e);i&&(this.alignment.isNeedReplaceElement(i)?this.alignment.replaceElement(i):this.alignment.alignElement(i))},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(t){return""===this.alignment.type&&"undefined"!=typeof t.data("tagblock")},replaceElement:function(t){t.replaceWith(t.html())},alignElement:function(t){t.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(t,"style")}}},autosave:function(){return{enable:function(){this.opts.autosave&&(this.autosave.html=!1,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"),this.opts.autosaveOnChange||(this.autosaveInterval=setInterval(this.autosave.load,1e3*this.opts.autosaveInterval)))},onChange:function(){this.opts.autosaveOnChange&&this.autosave.load()},load:function(){if(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source&&!this.utils.isEmpty(this.autosave.source)){var e={};e.name=this.autosave.name,e[this.autosave.name]=this.autosave.source,e=this.autosave.getHiddenFields(e);var i=t.ajax({url:this.opts.autosave,type:"post",data:e});i.done(this.autosave.success)}},getHiddenFields:function(e){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?e:(t.each(this.opts.autosaveFields,t.proxy(function(i,n){null!==n&&0===n.toString().indexOf("#")&&(n=t(n).val()),e[i]=n},this)),e)},success:function(e){var i;try{i=t.parseJSON(e)}catch(t){i=e}var n="undefined"==typeof i.error?"autosave":"autosaveError";this.core.setCallback(n,this.autosave.name,i),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(t){this.block.clearStyle=!1;var e,i;"undefined"!=typeof this.formatting[t].data?e="data":"undefined"!=typeof this.formatting[t].attr?e="attr":"undefined"!=typeof this.formatting[t].class&&(e="class"),"undefined"!=typeof this.formatting[t].clear&&(this.block.clearStyle=!0),e&&(i=this.formatting[t][e]),this.block.format(this.formatting[t].tag,e,i)},format:function(e,i,n){"quote"==e&&(e="blockquote");var o=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];t.inArray(e,o)!=-1&&(this.block.isRemoveInline="pre"==e||e.search(/h[1-6]/i)!=-1,this.utils.browser("msie")||this.$editor.focus(),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=i,this.block.value=n,this.buffer.set(),this.selection.save(),this.block.set(e),this.selection.restore(),this.code.sync())},set:function(t){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(t):this.block.setMultiple(t)},setCollapsed:function(e){var i=this.block.blocks[0];if(i!==!1){if("LI"==i.tagName){if("blockquote"!=e)return;return void this.block.formatListToBlockquote()}var n="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(n&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+e+">"),i=this.selection.getBlock(),this.block.toggle(t(i));else if(i.tagName.toLowerCase()!=e)if(this.opts.linebreaks&&"p"==e)t(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i);else{var o=this.utils.replaceToTag(i,e);this.block.toggle(o),"p"!=e&&"blockquote"!=e&&o.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(o),("p"==e||this.block.headTag)&&o.find("p").contents().unwrap(),this.block.formatTableWrapping(o)}else if("blockquote"==e&&i.tagName.toLowerCase()==e)if(this.opts.linebreaks)t(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i);else{var r=this.utils.replaceToTag(i,"p");this.block.toggle(r)}else i.tagName.toLowerCase()==e&&this.block.toggle(t(i));"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&t(i).removeAttr("class").removeAttr("style")}},setMultiple:function(e){var i=this.block.blocks[0],n="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(i!==!1&&1===this.block.blocksSize)if(i.tagName.toLowerCase()==e&&"blockquote"==e)if(this.opts.linebreaks)t(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i);else{var o=this.utils.replaceToTag(i,"p");this.block.toggle(o)}else if("LI"==i.tagName){if("blockquote"!=e)return;this.block.formatListToBlockquote()}else if("BLOCKQUOTE"==this.block.containerTag)this.block.formatBlockquote(e);else if(this.opts.linebreaks&&(n||this.range.commonAncestorContainer!=i))this.block.formatWrap(e);else if(this.opts.linebreaks&&"p"==e)t(i).prepend("<br>").append("<br>"),this.utils.replaceWithContents(i);else if("TD"===i.tagName)this.block.formatWrap(e);else{var r=this.utils.replaceToTag(i,e);this.block.toggle(r),this.block.isRemoveInline&&this.utils.removeInlineTags(r),("p"==e||this.block.headTag)&&r.find("p").contents().unwrap()}else if(this.opts.linebreaks||"p"!=e){if("blockquote"==e){for(var s=0,a=0;a<this.block.blocksSize;a++)"BLOCKQUOTE"==this.block.blocks[a].tagName&&s++;if(s==this.block.blocksSize)return void t.each(this.block.blocks,t.proxy(function(e,i){var n=!1;this.opts.linebreaks?(t(i).prepend("<br>").append("<br>"),n=this.utils.replaceWithContents(i)):n=this.utils.replaceToTag(i,"p"),n&&"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&n.removeAttr("class").removeAttr("style")},this))}this.block.formatWrap(e)}else{var l=0,p=!1;"class"==this.block.type&&(p="toggle",l=t(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==l?p="toggle":this.block.blocksSize>l?p="set":0===l&&(p="set"));var d=["ul","ol","li","td","th","dl","dt","dd"];t.each(this.block.blocks,t.proxy(function(i,n){if(t.inArray(n.tagName.toLowerCase(),d)==-1){var o=this.utils.replaceToTag(n,e);p?"toggle"==p?this.block.toggle(o):"remove"==p?this.block.remove(o):"set"==p&&this.block.setForce(o):this.block.toggle(o),"p"!=e&&"blockquote"!=e&&o.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(o),("p"==e||this.block.headTag)&&o.find("p").contents().unwrap(),"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&o.removeAttr("class").removeAttr("style")}},this))}},setForce:function(t){return this.block.clearStyle&&t.removeAttr("class").removeAttr("style"),"class"==this.block.type?void t.addClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void t.attr(this.block.value.name,this.block.value.value):void 0},toggle:function(t){return this.block.clearStyle&&t.removeAttr("class").removeAttr("style"),"class"==this.block.type?void t.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void(t.attr(this.block.value.name)==this.block.value.value?t.removeAttr(this.block.value.name):t.attr(this.block.value.name,this.block.value.value)):void t.removeAttr("style class")},remove:function(t){t.removeClass(this.block.value)},formatListToBlockquote:function(){var e=t(this.block.blocks[0]).closest("ul, ol");t(e).find("ul, ol").contents().unwrap(),t(e).find("li").append(t("<br>")).contents().unwrap();var i=this.utils.replaceToTag(e,"blockquote");this.block.toggle(i)},formatBlockquote:function(e){document.execCommand("outdent"),document.execCommand("formatblock",!1,e),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var i=this.selection.getBlock();"p"!=e&&t(i).find("img").remove(),this.opts.linebreaks||this.block.toggle(t(i)),this.$editor.find("ul, ol, tr, blockquote, p").each(t.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==e&&this.utils.replaceWithContents(i)},formatWrap:function(e){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=e)return;this.block.formatListToBlockquote()}var i=this.selection.wrap(e);if(i!==!1){var n=t(i);this.block.formatTableWrapping(n);var o=n.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");(this.opts.linebreaks&&"p"==e||"pre"==e||"blockquote"==e)&&o.append("<br />"),o.contents().unwrap(),"p"!=e&&"blockquote"!=e&&n.find("img").remove(),t.each(this.block.blocks,t.proxy(this.utils.removeEmpty,this)),n.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(n),this.$editor.find("ul, ol, tr, blockquote, p").each(t.proxy(this.utils.removeEmpty,this)),n.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(n),this.opts.linebreaks&&"p"==e&&this.utils.replaceWithContents(n)}},formatTableWrapping:function(t){0!==t.closest("table").length&&(0===t.closest("tr").length&&t.wrap("<tr>"),0===t.closest("td").length&&0===t.closest("th").length&&t.wrap("<td>"))},removeData:function(e,i){var n=this.selection.getBlocks();t(n).removeAttr("data-"+e),this.code.sync()},setData:function(e,i){var n=this.selection.getBlocks();t(n).attr("data-"+e,i),this.code.sync()},toggleData:function(e,i){var n=this.selection.getBlocks();t.each(n,function(){t(this).attr("data-"+e)?t(this).removeAttr("data-"+e):t(this).attr("data-"+e,i)})},removeAttr:function(e,i){var n=this.selection.getBlocks();t(n).removeAttr(e),this.code.sync()},setAttr:function(e,i){var n=this.selection.getBlocks();t(n).attr(e,i),this.code.sync()},toggleAttr:function(e,i){var n=this.selection.getBlocks();t.each(n,function(){t(this).attr(name)?t(this).removeAttr(name):t(this).attr(name,i)})},removeClass:function(e){var i=this.selection.getBlocks();t(i).removeClass(e),this.utils.removeEmptyAttr(i,"class"),this.code.sync()},setClass:function(e){var i=this.selection.getBlocks();t(i).addClass(e),this.code.sync()},toggleClass:function(e){var i=this.selection.getBlocks();t(i).toggleClass(e),this.code.sync()}}},buffer:function(){return{set:function(t){"undefined"==typeof t||"undo"==t?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(t.proxy(this.observe.load,this),50))},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(t.proxy(this.observe.load,this),50))}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return"TEXTAREA"===this.$element[0].tagName},createContainerBox:function(){this.$box=t('<div class="redactor-box" />')},createTextarea:function(){this.$textarea=t("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return"undefined"==typeof name?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var e=this.build.isTextarea()?"val":"html";this.content=t.trim(this.$element[e]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var t=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[t]()},fromTextarea:function(){this.$editor=t("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor(),this.opts.visual||setTimeout(t.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(t.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){t(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(t){if(t.preventDefault(),this.opts.dragImageUpload&&this.opts.dragFileUpload){var e=t.dataTransfer.files;this.upload.directUpload(e[0],t)}},setEventDrop:function(t){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",t)},setEvents:function(){this.$editor.on("drop.redactor",t.proxy(function(t){return t=t.originalEvent||t,void 0===window.FormData||!t.dataTransfer||(0===t.dataTransfer.files.length?this.build.setEventDrop(t):(this.build.setEventDropUpload(t),setTimeout(this.clean.clearUnverified,1),void this.core.setCallback("drop",t)))},this)),this.$editor.on("click.redactor",t.proxy(function(t){var e=this.core.getEvent(),i="click"!=e&&"arrow"!=e&&"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.setCallback("click",t)},this)),this.$editor.on("paste.redactor",t.proxy(this.paste.init,this)),this.$editor.on("keydown.redactor",t.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",t.proxy(this.keyup.init,this)),t.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",t.proxy(this.opts.codeKeydownCallback,this)),t.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",t.proxy(this.opts.codeKeyupCallback,this)),t.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",t.proxy(this.opts.focusCallback,this));var e;t(document).on("mousedown",function(t){e=t.target}),this.$editor.on("blur.redactor",t.proxy(function(i){this.rtePaste||this.build.isBlured(e)&&(this.utils.disableSelectAll(),t.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",i))},this))},isBlured:function(e){var i=t(e);return!i.hasClass("redactor-toolbar, redactor-dropdown")&&!i.is("#redactor-modal")&&0===i.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length},setHelpers:function(){this.autosave.enable(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){this.opts.plugins&&RedactorPlugins&&t.each(this.opts.plugins,t.proxy(function(e,i){if("undefined"!=typeof RedactorPlugins[i]){if(t.inArray(i,t.Redactor.modules)!==-1)return void t.error('Plugin name "'+i+"\" matches the name of the Redactor's module.");if(t.isFunction(RedactorPlugins[i])){this[i]=RedactorPlugins[i]();for(var n=this.getModuleMethods(this[i]),o=n.length,r=0;r<o;r++)this[i][n[r]]=this[i][n[r]].bind(this);t.isFunction(this[i].init)&&this[i].init()}}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla"))try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}}}},button:function(){return{build:function(e,i){var n=t('<a href="#" class="re-icon re-'+e+'" rel="'+e+'" />').attr("tabindex","-1");if((i.func||i.command||i.dropdown)&&this.button.setEvent(n,e,i),i.dropdown){var o=t('<div class="redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+e+'" style="display: none;">');n.data("dropdown",o),this.dropdown.build(e,o,i.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(n,e,i.title),n},setEvent:function(e,i,n){e.on("touchstart click",t.proxy(function(t){if(e.hasClass("redactor-button-disabled"))return!1;var o="func",r=n.func;n.command?(o="command",r=n.command):n.dropdown&&(o="dropdown",r=!1),this.button.onClick(t,i,o,r)},this))},createTooltip:function(e,i,n){var o=t("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+i).hide().html(n);o.appendTo("body"),e.on("mouseover",function(){if(!t(this).hasClass("redactor-button-disabled")){var i=e.offset();o.show(),o.css({top:i.top+e.innerHeight()+"px",left:i.left+e.innerWidth()/2-o.innerWidth()/2+"px"})}}),e.on("mouseout",function(){o.hide()})},onClick:function(t,e,i,n){this.button.caretOffset=this.caret.getOffset(),t.preventDefault(),this.utils.browser("msie")&&(t.returnValue=!1),"command"==i?this.inline.format(n):"dropdown"==i?this.dropdown.show(t,e):this.button.onClickCallback(t,n,e)},onClickCallback:function(e,i,n){var o;if(t.isFunction(i))i.call(this,n);else if("-1"!=i.search(/\./)){if(o=i.split("."),"undefined"==typeof this[o[0]])return;this[o[0]][o[1]](n)}else this[i](n);this.observe.buttons(e,n)},get:function(t){return this.$toolbar.find("a.re-"+t)},setActive:function(t){this.button.get(t).addClass("redactor-act")},setInactive:function(t){this.button.get(t).removeClass("redactor-act")},setInactiveAll:function(t){"undefined"==typeof t?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+t).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(t,e){this.button.get(t).addClass("re-"+e)},removeIcon:function(t,e){this.button.get(t).removeClass("re-"+e)},setAwesome:function(t,e){var i=this.button.get(t);i.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),i.html('<i class="fa '+e+'"></i>')},addCallback:function(e,i){var n="dropdown"==i?"dropdown":"func",o=e.attr("rel");e.on("touchstart click",t.proxy(function(t){return!e.hasClass("redactor-button-disabled")&&void this.button.onClick(t,o,n,i)},this))},addDropdown:function(e,i){var n=e.attr("rel");this.button.addCallback(e,"dropdown");var o=t('<div class="redactor-dropdown redactor-dropdown-'+ +this.uuid+" redactor-dropdown-box-"+n+'" style="display: none;">');return e.data("dropdown",o),i&&this.dropdown.build(n,o,i),o},add:function(e,i){if(this.opts.toolbar){var n=this.button.build(e,{title:i});return n.addClass("redactor-btn-image"),this.$toolbar.append(t("<li>").append(n)),n}},addFirst:function(e,i){if(this.opts.toolbar){var n=this.button.build(e,{title:i});return n.addClass("redactor-btn-image"),this.$toolbar.prepend(t("<li>").append(n)),n}},addAfter:function(e,i,n){if(this.opts.toolbar){var o=this.button.build(i,{title:n});o.addClass("redactor-btn-image");var r=this.button.get(e);return 0!==r.length?r.parent().after(t("<li>").append(o)):this.$toolbar.append(t("<li>").append(o)),o}},addBefore:function(e,i,n){if(this.opts.toolbar){var o=this.button.build(i,{title:n});o.addClass("redactor-btn-image");var r=this.button.get(e);return 0!==r.length?r.parent().before(t("<li>").append(o)):this.$toolbar.append(t("<li>").append(o)),o}},remove:function(t){this.button.get(t).remove()}}},caret:function(){return{setStart:function(e){if(this.utils.isBlock(e))this.caret.set(e,0,e,0);else{var i=this.utils.createSpaceElement();t(e).prepend(i),this.caret.setEnd(i)}},setEnd:function(t){this.caret.set(t,1,t,1)},set:function(e,i,n,o){if(e=e[0]||e,n=n[0]||n,this.utils.isBlockTag(e.tagName)&&""===e.innerHTML&&(e.innerHTML=this.opts.invisibleSpace),"BR"==e.tagName&&this.opts.linebreaks===!1){var r=t(this.opts.emptyHtml)[0];t(e).replaceWith(r),e=r,n=e}this.selection.get();try{this.range.setStart(e,i),this.range.setEnd(n,o)}catch(t){}this.selection.addRange()},setAfter:function(e){try{var i=t(e)[0].tagName;if("BR"==i||this.utils.isBlock(e))"BR"!=i&&this.utils.browser("msie")?this.caret.setStart(t(e).next()):this.caret.setAfterOrBefore(e,"after");else{var n=this.utils.createSpaceElement();t(e).after(n),this.caret.setEnd(n)}}catch(i){var n=this.utils.createSpaceElement();t(e).after(n),this.caret.setEnd(n)}},setBefore:function(e){this.utils.isBlock(e)?this.caret.setEnd(t(e).prev()):this.caret.setAfterOrBefore(e,"before")},setAfterOrBefore:function(t,e){if(this.utils.browser("msie")||this.$editor.focus(),t=t[0]||t,this.selection.get(),"after"==e)try{this.range.setStartAfter(t),this.range.setEndAfter(t)}catch(t){}else try{this.range.setStartBefore(t),this.range.setEndBefore(t)}catch(t){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(e){e=e[0]||e,this.selection.get();var i=this.range.cloneRange();return i.selectNodeContents(e),i.setEnd(this.range.endContainer,this.range.endOffset),t.trim(i.toString()).length},getOffset:function(){var t=0,e=window.getSelection();if(e.rangeCount>0){var i=window.getSelection().getRangeAt(0),n=i.cloneRange();n.selectNodeContents(this.$editor[0]),n.setEnd(i.endContainer,i.endOffset),t=n.toString().length}return t},setOffset:function(t,e){"undefined"==typeof e&&(e=t),this.focus.isFocused()||this.focus.setStart();for(var i,n=(this.selection.get(),0),o=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);i=o.nextNode();)if(n+=i.nodeValue.length,n>t&&(this.range.setStart(i,i.nodeValue.length+t-n),t=1/0),n>=e){this.range.setEnd(i,i.nodeValue.length+e-n);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(t,e){this.caret.setOffset(t,e)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(e){e=this.clean.savePreCode(e),e=e.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),e=e.replace(/\$/g,"&#36;"),e=e.replace(/<a href="(.*?[^>]?)(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.clean.saveFormTags(e);var i=t("<div>");i.html(e);var n=i.find("font[style]");return 0!==n.length&&(n.replaceWith(function(){var e=t(this),i=t("<span>").attr("style",e.attr("style"));return i.append(e.contents())}),e=i.html()),i.remove(),e=e.replace(/<font(.*?[^<])>/gi,""),e=e.replace(/<\/font>/gi,""),e=this.tidy.load(e),this.opts.paragraphize&&(e=this.paragraphize.load(e)),e=this.clean.setVerified(e),e=this.clean.convertInline(e)},onSync:function(e){if(e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),e=e.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(e=e.replace(/&nbsp;/gi," ")),e.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!=-1)return"";e=e.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),e=this.clean.restoreFormTags(e);var i={"":"&trade;","":"&copy;","":"&hellip;","":"&mdash;","":"&dash;"};return t.each(i,function(t,i){e=e.replace(new RegExp(t,"g"),i)}),e=e.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),e=e.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),e=e.replace(new RegExp('<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>',"gi"),"<div$1$2>"),e=e.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),e=e.replace(new RegExp('<span(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<span$1$3>"),e=e.replace(new RegExp('<img(.*?[^>])srel="(.*?[^>])"(.*?[^>])>',"gi"),"<img$1$3>"),e=e.replace(new RegExp('<img(.*?[^>])sstyle="" (.*?[^>])>',"gi"),"<img$1 $2>"),e=e.replace(new RegExp("<img(.*?[^>])sstyle (.*?[^>])>","gi"),"<img$1 $2>"),e=e.replace(new RegExp('<span class="redactor-invisible-space">(.*?)</span>',"gi"),"$1"),e=e.replace(/ data-save-url="(.*?[^>])"/gi,""),e=e.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),e=e.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),e=e.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),e=e.replace(/<font(.*?[^<])>/gi,""),e=e.replace(/<\/font>/gi,""),e=this.tidy.load(e),this.opts.linkNofollow&&(e=e.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),e=e.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),e=e.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),e=e.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),e=e.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>")},onPaste:function(e,i){if(e=t.trim(e),e=e.replace(/\$/g,"&#36;"),e=e.replace(/<span class="s1">/gi,"<span>"),e=e.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),e=e.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"\t"),e=e.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(e);if(!this.utils.isSelectAll()&&"undefined"==typeof i){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(e,!1);if(this.utils.isCurrentOrParent("PRE"))return e=e.replace(//g,'"'),e=e.replace(//g,'"'),e=e.replace(//g,"'"),e=e.replace(//g,"'"),this.clean.getPreCode(e);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){if(e=this.clean.getOnlyImages(e),!this.utils.browser("msie")){var n=this.selection.getBlock();n&&"P"==n.tagName&&(e=e.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return e}if(this.utils.isCurrentOrParent(["TD"]))return e=this.clean.onPasteTidy(e,"td"),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.clean.replaceDivsToBr(e);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(e,"li")}return e=this.clean.isSingleLine(e,i),this.clean.singleLine||(this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),e=this.clean.saveFormTags(e)),e=this.clean.onPasteWord(e),e=this.clean.onPasteExtra(e),e=this.clean.onPasteTidy(e,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(e=this.paragraphize.load(e)),e=this.clean.removeDirtyStyles(e),e=this.clean.onPasteRemoveSpans(e),e=this.clean.onPasteRemoveEmpty(e),e=this.clean.convertInline(e)},onPasteWord:function(t){return t=t.replace(/<!--[\s\S]*?-->/gi,""),t=t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(t)&&(t=this.clean.onPasteIeFixLinks(t),t=t.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),t=t.replace(/src="file\:\/\/(.*?)"/,'src=""'),t=t.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>"),t=t.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>"),t=t.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>"),t=t.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>"),t=t.replace(//g,""),t=t.replace(/<p class="Mso(.*?)"/gi,"<p"),t=t.replace(/ class=\"(mso[^\"]*)\"/gi,""),t=t.replace(/ class=(mso\w+)/gi,""),t=t.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),t=t.replace(/\n/g," "),t=t.replace(/<p>\n?<li>/gi,"<li>")),this.opts.cleanSpaces&&(t=t.replace(/(\s|&nbsp;)+/g," ")),t},onPasteExtra:function(t){return t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=t.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),t=t.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),t=t.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),t=t.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),t=t.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),t=t.replace(/<img>/gi,""),t=t.replace(/\n{3,}/gi,"\n"),t=t.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),t=t.replace(/<p><p>/gi,"<p>"),t=t.replace(/<\/p><\/p>/gi,"</p>"),t=t.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),t=t.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),t=t.replace(/<\/p>\s<p/gi,"</p><p"),t=t.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),t=t.replace(/<p>([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(t=t.replace(/<br\s?\/?>$/gi,"")),t},onPasteTidy:function(t,e){var i=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],n=!1,o=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];"all"==e?(n=["p","span","h1","h2","h3","h4","h5","h6"],o=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==e?i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==e&&(i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var r={deniedTags:!1,allowedTags:i,removeComments:!0,removePhp:!0,removeAttr:!1,allowedAttr:o,removeEmpty:n};return this.opts.deniedTags&&(r.deniedTags=this.opts.deniedTags),this.opts.allowedTags&&(r.allowedTags=this.opts.allowedTags),this.tidy.load(t,r)},onPasteRemoveEmpty:function(t){return t=t.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(t=t.replace(/<br>$/i,"")),t},onPasteRemoveSpans:function(t){return t=t.replace(/<span>(.*?)<\/span>/gi,"$1"),t=t.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(e){if(!this.utils.browser("msie"))return e;var i=t.trim(e);return 0===i.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(e=e.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),e},isSingleLine:function(t,e){if(this.clean.singleLine=!1,!this.utils.isSelectAll()&&"undefined"==typeof e){var i=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),n=t.match(new RegExp("</("+i+")>","gi")),o=t.match(/<\/(p|div)>/gi);if(!n&&(null===o||o&&o.length<=1)){var r=t.match(/<br\s?\/?>/gi),s=t.match(/<img(.*?[^>])>/gi);r||s||(this.clean.singleLine=!0,t=t.replace(/<\/?(p|div)(.*?)>/gi,""))}}return t},stripTags:function(t,e){e=(((e||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t.replace(i,function(t,i){return e.indexOf("<"+i.toLowerCase()+">")>-1?t:""})},savePreCode:function(t){return t=this.clean.savePreFormatting(t),t=this.clean.saveCodeFormatting(t)},savePreFormatting:function(e){var i=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==i&&t.each(i,t.proxy(function(t,i){var n=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);n[2]=n[2].replace(/<br\s?\/?>/g,"\n"),n[2]=n[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(n[2]=n[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),n[2]=this.clean.encodeEntities(n[2]),n[2]=n[2].replace(/\$/g,"&#36;"),e=e.replace(i,"<pre"+n[1]+">"+n[2]+"</pre>")},this)),e},saveCodeFormatting:function(e){var i=e.match(/<code(.*?[^>])>(.*?)<\/code>/gi);return null!==i&&t.each(i,t.proxy(function(t,i){var n=i.match(/<code(.*?[^>])>(.*?)<\/code>/i);n[2]=n[2].replace(/&nbsp;/g," "),n[2]=this.clean.encodeEntities(n[2]),n[2]=n[2].replace(/\$/g,"&#36;"),e=e.replace(i,"<code"+n[1]+">"+n[2]+"</code>")},this)),e},getTextFromHtml:function(e){e=e.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var i=document.createElement("div");return i.innerHTML=e,
e=i.textContent||i.innerText,t.trim(e)},getPlainText:function(t,e){return t=this.clean.getTextFromHtml(t),t=t.replace(/\n/g,"<br />"),this.opts.paragraphize&&"undefined"==typeof e&&!this.utils.browser("mozilla")&&(t=this.paragraphize.load(t)),t},getPreCode:function(t){return t=t.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),t=t.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),t=this.clean.getTextFromHtml(t),this.opts.preSpaces&&(t=t.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),t=this.clean.encodeEntities(t)},getOnlyImages:function(t){return t=t.replace(/<img(.*?)>/gi,"[img$1]"),t=t.replace(/<([Ss]*?)>/gi,""),t=t.replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(t){return t=t.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),t=t.replace(/<img(.*?)>/gi,"[img$1]"),t=t.replace(/<(.*?)>/gi,""),t=t.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),t=t.replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(t){return t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(e){if(this.utils.browser("msie"))return e;var i=document.createElement("div");return i.innerHTML=e,this.clean.clearUnverifiedRemove(t(i)),e=i.innerHTML,t(i).remove(),e},clearUnverified:function(){if(!this.utils.browser("msie")){this.clean.clearUnverifiedRemove(this.$editor);var t=this.$editor.find("h1, h2, h3, h4, h5, h6");t.find("span").removeAttr("style"),t.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()}},clearUnverifiedRemove:function(e){e.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),e.find("span").not('[data-verified="redactor"]').removeAttr("style"),e.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(e,i){var n=t(i);n.attr("style",n.attr("rel"))})},setVerified:function(t){if(this.utils.browser("msie"))return t;t=t.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),t=t.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var e=t.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(e)for(var i=e.length,n=0;n<i;n++)try{var o=e[n].replace(/style="(.*?)"/i,'style="$1" rel="$1"');t=t.replace(e[n],o)}catch(t){}return t},convertInline:function(e){var i=t("<div />").html(e),n=this.opts.inlineTags;return n.push("span"),i.find(n.join(",")).each(function(){var e=t(this),i=this.tagName.toLowerCase();e.attr("data-redactor-tag",i),"span"==i&&(e.attr("style")?e.attr("data-redactor-style",e.attr("style")):e.attr("class")&&e.attr("data-redactor-class",e.attr("class")))}),e=i.html(),i.remove(),e},normalizeLists:function(){this.$editor.find("li").each(function(e,i){var n=t(i).next();0===n.length||"UL"!=n[0].tagName&&"OL"!=n[0].tagName||t(i).append(n)})},removeSpaces:function(t){return t=t.replace(/\n/g,""),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g," "),t=t.replace(/[\s\n]*$/g," "),t=t.replace(/>\s{2,}</g,"> <"),t=t.replace(/\n\n/g,"\n"),t=t.replace(/[\u200B-\u200D\uFEFF]/g,"")},replaceDivs:function(t){return this.opts.linebreaks?(t=t.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),t=t.replace(/<div(.*?[^>])>/gi,""),t=t.replace(/<\/div>/gi,"")},replaceDivsToBr:function(t){return t=t.replace(/<div\s(.*?)>/gi,"<p>"),t=t.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),t=t.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(t){return t=t.replace(/<p\s(.*?)>/gi,"<p>"),t=t.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),t=t.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(t){return t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(t){return t.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(e){e=t.trim(e.toString()),e=this.clean.onSet(e),this.$editor.html(e),this.code.sync(),""!==e&&this.placeholder.remove(),setTimeout(t.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var t=this.$textarea.val();return t=this.tabifier.get(t)},sync:function(){setTimeout(t.proxy(this.code.startSync,this),10)},startSync:function(){var t=this.$editor.html();this.code.syncCode&&this.code.syncCode==t||(this.code.syncCode=t,t=this.core.setCallback("syncBefore",t),t=this.clean.onSync(t),this.$textarea.val(t),this.core.setCallback("sync",t),this.start===!1&&this.core.setCallback("change",t),this.start=!1,this.autosave.onChange())},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.code.offset=this.caret.getOffset();var e=t(window).scrollTop(),i=this.$editor.innerHeight();this.$editor.hide();var n=this.$textarea.val();this.modified=this.clean.removeSpaces(n),n=this.tabifier.get(n),this.$textarea.val(n).height(i).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),t(window).scrollTop(e),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(0,0),this.$textarea[0].scrollTop=0,this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",n)},showVisual:function(){if(!this.opts.visual){var t=this.$textarea.hide().val();this.modified!==this.clean.removeSpaces(t)&&this.code.set(t),this.$editor.show(),this.utils.isEmpty(t)||this.placeholder.remove(),this.caret.setOffset(this.code.offset),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",t)}},textareaIndenting:function(t){if(9!==t.keyCode)return!0;var e=this.$textarea,i=e.get(0).selectionStart;return e.val(e.val().substring(0,i)+"\t"+e.val().substring(e.get(0).selectionEnd)),e.get(0).selectionStart=e.get(0).selectionEnd=i+1,!1}}},core:function(){return{getObject:function(){return t.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return!!this.$toolbar&&this.$toolbar},addEvent:function(t){this.core.event=t},getEvent:function(){return this.core.event},setCallback:function(e,i,n){var o=this.opts[e+"Callback"];return t.isFunction(o)?"undefined"==typeof n?o.call(this,i):o.call(this,i,n):"undefined"==typeof n?i:n},destroy:function(){this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),t(document).off("click.redactor-image-delete."+this.uuid),t(document).off("click.redactor-image-resize-hide."+this.uuid),t(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),t("body").off("scroll.redactor."+this.uuid),t(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var e=this.code.get();this.$toolbar.find("a").each(function(){var e=t(this);e.data("dropdown")&&(e.data("dropdown").remove(),e.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(e).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(e).show()),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),t(".redactor-toolbar-tooltip").remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(e,i,n){"formatting"==e&&this.opts.formattingAdd&&t.each(this.opts.formattingAdd,t.proxy(function(t,e){var i=e.tag;"undefined"!=typeof e.class&&(i=i+"-"+e.class),e.type=this.utils.isBlockTag(e.tag)?"block":"inline";var o="inline"==e.type?"inline.formatting":"block.formatting";this.opts.linebreaks&&"block"==e.type&&"p"==e.tag||(this.formatting[i]={tag:e.tag,style:e.style,class:e.class,attr:e.attr,data:e.data,clear:e.clear},n[i]={func:o,title:e.title})},this)),t.each(n,t.proxy(function(n,o){var r=t('<a href="#" class="redactor-dropdown-'+n+'">'+o.title+"</a>");"formatting"==e&&r.addClass("redactor-formatting-"+n),r.on("click",t.proxy(function(t){t.preventDefault();var e="func",i=o.func;o.command?(e="command",i=o.command):o.dropdown&&(e="dropdown",i=o.dropdown),this.button.onClick(t,n,e,i),this.dropdown.hideAll()},this)),i.append(r)},this))},show:function(e,i){if(!this.opts.visual)return e.preventDefault(),!1;var n=this.button.get(i),o=n.data("dropdown").appendTo(document.body);if(this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),n.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.core.setCallback("dropdownShow",{dropdown:o,key:i,button:n}),this.button.setActive(i),n.addClass("dropact");var r=n.offset(),s=o.width();r.left+s>t(document).width()&&(r.left=Math.max(0,r.left-s));var a=r.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var l=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,p="fixed";this.opts.toolbarFixedTarget!==document&&(l=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,p="absolute"),o.css({position:p,left:a,top:l+"px"}).show()}else{var l=n.innerHeight()+r.top+"px";o.css({position:"absolute",left:a,top:l}).show()}this.core.setCallback("dropdownShown",{dropdown:o,key:i,button:n})}t(document).one("click",t.proxy(this.dropdown.hide,this)),this.$editor.one("click",t.proxy(this.dropdown.hide,this));var d=t(document.body),c=d.width();o.on("mouseover",function(){d.addClass("body-redactor-hidden"),d.css("margin-right",d.width()-c+"px")}),o.on("mouseout",function(){d.removeClass("body-redactor-hidden").css("margin-right",0)}),e.stopPropagation()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),t(document.body).removeClass("body-redactor-hidden").css("margin-right",0),t(".redactor-dropdown-"+this.uuid).hide(),this.core.setCallback("dropdownHide")},hide:function(e){var i=t(e.target);i.hasClass("dropact")||(i.removeClass("dropact"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),this.selection.save(),this.selection.get();var e=this.sel.toString();t("#redactor-filename").val(e),this.modal.show()},insert:function(e,i,n){if("undefined"!=typeof e.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("fileUploadError",e);var o;if("string"==typeof e)o=e;else{var r=t("#redactor-filename").val();"undefined"!=typeof r&&""!==r||(r=e.filename),o='<a href="'+e.filelink+'" id="filelink-marker">'+r+"</a>"}if(i){this.selection.removeMarkers();var s=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(n,s)}else this.modal.close();if(this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(o),"string"!=typeof e){var a=t(this.$editor.find("a#filelink-marker"));0!==a.length?a.removeAttr("id").removeAttr("style"):a=!1,this.core.setCallback("fileUpload",a,e)}}}},focus:function(){return{setStart:function(){this.$editor.focus();var t=this.$editor.children().first();if(0!==t.length&&0!==t[0].length&&"BR"!=t[0].tagName&&3!=t[0].nodeType){if("UL"==t[0].tagName||"OL"==t[0].tagName){var e=t.find("li").first();if(!this.utils.isBlock(e)&&""===e.text())return void this.caret.setStart(e)}return this.opts.linebreaks&&!this.utils.isBlockTag(t[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),void this.selection.addRange()):void this.caret.setStart(t)}},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var t=this.$editor.children().last();this.$editor.focus(),this.caret.setEnd(t)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]),this.range.collapse(!1),this.selection.addRange()}catch(t){}}},isFocused:function(){var e=document.getSelection().focusNode;return null!==e&&(!(!this.opts.linebreaks||!t(e.parentNode).hasClass("redactor-linebreaks"))||!!this.utils.isRedactorParent(e.parentNode)&&this.$editor.is(":focus"))}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.selection.save(),this.modal.show()},showEdit:function(e){var i=e.closest("a");if(this.modal.load("imageEdit",this.lang.get("edit"),705),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",t.proxy(function(){this.image.remove(e)},this)),this.image.buttonSave.on("click",t.proxy(function(){this.image.update(e)},this)),t("#redactor-image-title").val(e.attr("alt")),this.opts.imageLink){var n=t("#redactor-image-link");n.attr("href",e.attr("src")),0!==i.length&&(n.val(i.attr("href")),"_blank"==i.attr("target")&&t("#redactor-image-link-blank").prop("checked",!0))}else t(".redactor-image-link-option").hide();if(this.opts.imagePosition){var o="block"==e.css("display")&&"none"==e.css("float")?"center":e.css("float");t("#redactor-image-align").val(o)}else t(".redactor-image-position-option").hide();this.modal.show()},setFloating:function(e){var i=t("#redactor-image-align").val(),n="",o="",r="";switch(i){case"left":n="left",r="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":n="right",r="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":o="block",r="auto"}e.css({float:n,display:o,margin:r}),e.attr("rel",e.attr("style"))},update:function(e){this.image.hideResize(),this.buffer.set();var i=e.closest("a");e.attr("alt",t("#redactor-image-title").val()),this.image.setFloating(e);var n=t.trim(t("#redactor-image-link").val());if(""!==n){var o="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",r=new RegExp("^(http|ftp|https)://"+o,"i"),s=new RegExp("^"+o,"i");n.search(r)==-1&&0===n.search(s)&&this.opts.linkProtocol&&(n=this.opts.linkProtocol+"://"+n);var a=!!t("#redactor-image-link-blank").prop("checked");if(0===i.length){var l=t('<a href="'+n+'">'+this.utils.getOuterHtml(e)+"</a>");a&&l.attr("target","_blank"),e.replaceWith(l)}else i.attr("href",n),a?i.attr("target","_blank"):i.removeAttr("target")}else 0!==i.length&&i.replaceWith(this.utils.getOuterHtml(e));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(e){this.opts.imageEditable&&e.on("dragstart",t.proxy(this.image.onDrag,this)),e.on("mousedown",t.proxy(this.image.hideResize,this)),e.on("click.redactor touchstart",t.proxy(function(i){return this.observe.image=e,0===this.$editor.find("#redactor-image-box").length&&(this.image.resizer=this.image.loadEditableControls(e),t(document).on("click.redactor-image-resize-hide."+this.uuid,t.proxy(this.image.hideResize,this)),this.$editor.on("click.redactor-image-resize-hide."+this.uuid,t.proxy(this.image.hideResize,this)),void(this.opts.imageResizable&&this.image.resizer.on("mousedown.redactor touchstart.redactor",t.proxy(function(t){this.image.setResizable(t,e)},this))))},this))},setResizable:function(t,e){t.preventDefault(),this.image.resizeHandle={x:t.pageX,y:t.pageY,el:e,ratio:e.width()/e.height(),h:e.height()},t=t.originalEvent||t,t.targetTouches&&(this.image.resizeHandle.x=t.targetTouches[0].pageX,this.image.resizeHandle.y=t.targetTouches[0].pageY),this.image.startResize()},startResize:function(){t(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",t.proxy(this.image.moveResize,this)),t(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",t.proxy(this.image.stopResize,this))},moveResize:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.image.resizeHandle.h;e+=t.targetTouches?t.targetTouches[0].pageY-this.image.resizeHandle.y:t.pageY-this.image.resizeHandle.y;var i=Math.round(e*this.image.resizeHandle.ratio);e<50||i<100||(this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio),this.code.sync())},stopResize:function(){this.handle=!1,t(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(e){return 0!==this.$editor.find("#redactor-image-box").length?(e.preventDefault(),!1):void this.$editor.on("drop.redactor-image-inside-drop",t.proxy(function(){setTimeout(t.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var e=t(this);e.attr("src",e.attr("data-save-url")),e.removeAttr("data-save-url")})},hideResize:function(e){if(!e||0===t(e.target).closest("#redactor-image-box").length){if(e&&"IMG"==e.target.tagName){var i=t(e.target);i.attr("data-save-url",i.attr("src"))}var n=this.$editor.find("#redactor-image-box");0!==n.length&&(this.opts.imageEditable&&this.image.editter.remove(),t(this.image.resizer).remove(),n.find("img").css({marginTop:n[0].style.marginTop,marginBottom:n[0].style.marginBottom,marginLeft:n[0].style.marginLeft,marginRight:n[0].style.marginRight}),n.css("margin",""),n.find("img").css("opacity",""),n.replaceWith(function(){return t(this).contents()}),t(document).off("click.redactor-image-resize-hide."+this.uuid),this.$editor.off("click.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync())}},loadResizableControls:function(e,i){if(this.opts.imageResizable&&!this.utils.isMobile()){var n=t('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||n.css({width:"15px",height:"15px"}),n.attr("contenteditable",!1),i.append(n),i.append(e),n}return i.append(e),!1},loadEditableControls:function(e){var i=t('<span id="redactor-image-box" data-redactor="verified">');if(i.css("float",e.css("float")).attr("contenteditable",!1),"auto"!=e[0].style.margin?(i.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin","")):i.css({display:"block",margin:"auto"}),e.css("opacity",".5").after(i),this.opts.imageEditable){this.image.editter=t('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",t.proxy(function(){this.image.showEdit(e)},this)),i.append(this.image.editter);var n=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+n/2+"px")}return this.image.loadResizableControls(e,i)},remove:function(e){var i=t(e),n=i.closest("a"),o=i.closest("figure"),r=i.parent();0!==t("#redactor-image-box").length&&(r=t("#redactor-image-box").parent());var s;0!==o.length?(s=o.next(),o.remove()):0!==n.length?(r=n.parent(),n.remove()):i.remove(),t("#redactor-image-box").remove(),0!==o.length?this.caret.setStart(s):this.caret.setStart(r),this.core.setCallback("imageDelete",i[0].src,i),this.modal.close(),this.code.sync()},insert:function(e,i,n){if("undefined"!=typeof e.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("imageUploadError",e);var o;"string"==typeof e?o=t(e).attr("data-redactor-inserted-image","true"):(o=t("<img>"),o.attr("src",e.filelink).attr("data-redactor-inserted-image","true"));var r=o,s=this.utils.isCurrentOrParent("P");if(s&&(r=t("<blockquote />").append(o)),i){this.selection.removeMarkers();var a=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(n,a)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(r),!1);var l=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");s?l.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&l.before("<br>").after("<br>"),"string"!=typeof e&&this.core.setCallback("imageUpload",l,e)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var t=this.selection.getBlock();t&&"LI"==t.tagName?this.indent.increaseLists():t===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){t.each(this.selection.getBlocks(),t.proxy(function(t,e){if("TD"!==e.tagName&&"TH"!==e.tagName){var i=this.utils.getAlignmentElement(e),n=this.utils.normalize(i.css("margin-left"))+this.opts.indentValue;i.css("margin-left",n+"px")}},this))},increaseText:function(){var e=this.selection.wrap("div");t(e).attr("data-tagblock","redactor"),t(e).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var t=this.selection.getBlock();t&&"LI"==t.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var e=this.selection.getCurrent(),i=t(e).closest("li"),n=i.parent();0!==i.length&&0!==n.length&&"LI"==n[0].tagName&&n.after(i),this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==i.length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(t.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){t.each(this.selection.getBlocks(),t.proxy(function(t,e){var i=this.utils.getAlignmentElement(e),n=this.utils.normalize(i.css("margin-left"))-this.opts.indentValue;n<=0?this.opts.linebreaks&&"undefined"!=typeof i.data("tagblock")?i.replaceWith(i.html()+"<br />"):(i.css("margin-left",""),this.utils.removeEmptyAttr(i,"style")):i.css("margin-left",n+"px")},this))},fixEmptyIndent:function(){var e=this.selection.getBlock();if(this.range.collapsed&&e&&"LI"==e.tagName&&this.utils.isEmpty(t(e).text())){var i=t(e);i.find("span").not(".redactor-selection-marker").contents().unwrap(),i.append("<br>")}}}},inline:function(){return{formatting:function(t){var e,i;"undefined"!=typeof this.formatting[t].style?e="style":"undefined"!=typeof this.formatting[t].class&&(e="class"),e&&(i=this.formatting[t][e]),this.inline.format(this.formatting[t].tag,e,i)},format:function(t,e,i){if(!this.utils.isCurrentOrParent("PRE")&&!this.utils.isCurrentOrParentHeader()){for(var n=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],o=["strong","strong","em","em","u","del","del","sup","sub"],r=0;r<n.length;r++)t==n[r]&&(t=o[r]);this.inline.type=e||!1,this.inline.value=i||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(t):this.inline.formatMultiple(t)}},formatCollapsed:function(e){var i=this.selection.getCurrent(),n=t(i).closest(e+"[data-redactor-tag="+e+"]");if(0!==n.length&&"style"!=this.inline.type&&"SPAN"!=n[0].tagName)return void(this.utils.isEmpty(n.text())?(this.caret.setAfter(n[0]),n.remove(),this.code.sync()):this.utils.isEndOfElement(n)&&this.caret.setAfter(n[0]));var o=t("<"+e+">").attr("data-verified","redactor").attr("data-redactor-tag",e);o.html(this.opts.invisibleSpace),o=this.inline.setFormat(o);var o=this.insert.node(o);this.caret.setEnd(o),this.code.sync()},formatMultiple:function(e){if(this.inline.formatConvert(e),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(t.proxy(function(i,n){var o=t(n);this.inline.formatRemoveSameChildren(o,e);var r;if(this.inline.type?(r=t("<span>").attr("data-redactor-tag",e).attr("data-verified","redactor"),r=this.inline.setFormat(r)):r=t("<"+e+">").attr("data-redactor-tag",e).attr("data-verified","redactor"),o.replaceWith(r.html(o.contents())),"span"==e){var s=r.parent();if(s&&"SPAN"==s[0].tagName&&"style"==this.inline.type)for(var a=this.inline.value.split(";"),l=0;l<a.length;l++){if(""===a[l])return;var p=a[l].split(":");s.css(p[0],""),this.utils.removeEmptyAttr(s,"style")&&s.replaceWith(s.contents())}}},this)),"span"!=e&&this.$editor.find(this.opts.inlineTags.join(", ")).each(t.proxy(function(e,i){var n=t(i),o=n.css("text-decoration");"line-through"==o&&(n.css("text-decoration",""),this.utils.removeEmptyAttr(n,"style"))},this)),"del"!=e){var i=this;this.$editor.find("inline").each(function(t,e){i.utils.replaceToTag(e,"del")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(e,i){var n=this;e.children(i).each(function(){var e=t(this);if(!e.hasClass("redactor-selection-marker"))if("style"==n.inline.type)for(var i=n.inline.value.split(";"),o=0;o<i.length;o++){if(""===i[o])return;var r=i[o].split(":");e.css(r[0],""),n.utils.removeEmptyAttr(e,"style")&&e.replaceWith(e.contents())}else e.contents().unwrap()})},formatConvert:function(e){this.selection.save();var i="";"class"==this.inline.type?i="[data-redactor-class="+this.inline.value+"]":"style"==this.inline.type&&(i='[data-redactor-style="'+this.inline.value+'"]');var n=this;"del"!=e&&this.$editor.find("del").each(function(t,e){n.utils.replaceToTag(e,"inline")}),"span"!=e&&this.$editor.find(e).each(function(){var e=t(this);e.replaceWith(t("<strike />").html(e.contents()))}),this.$editor.find('[data-redactor-tag="'+e+'"]'+i).each(function(){if(""!==i||"span"!=e||this.tagName.toLowerCase()!=e){var n=t(this);n.replaceWith(t("<strike />").html(n.contents()))}}),this.selection.restore()},setFormat:function(t){switch(this.inline.type){case"class":t.hasClass(this.inline.value)?(t.removeClass(this.inline.value),t.removeAttr("data-redactor-class")):(t.addClass(this.inline.value),t.attr("data-redactor-class",this.inline.value));break;case"style":t[0].style.cssText=this.inline.value,t.attr("data-redactor-style",this.inline.value)}return t},removeStyle:function(){this.buffer.set();var e=this.selection.getCurrent(),i=this.selection.getInlines();if(this.selection.save(),e&&"SPAN"===e.tagName){var n=t(e);n.removeAttr("style"),0===n[0].attributes.length&&n.replaceWith(n.contents())}t.each(i,t.proxy(function(e,i){var n=t(i);t.inArray(i.tagName.toLowerCase(),this.opts.inlineTags)==-1||n.hasClass("redactor-selection-marker")||(n.removeAttr("style"),0===n[0].attributes.length&&n.replaceWith(n.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(e){this.buffer.set();var i=this.selection.getParent(),n=this.selection.getInlines();if(this.selection.save(),i&&"SPAN"===i.tagName){var o=t(i);o.css(e,""),this.utils.removeEmptyAttr(o,"style"),0===o[0].attributes.length&&o.replaceWith(o.contents())}t.each(n,t.proxy(function(i,n){var o=t(n);t.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)==-1||o.hasClass("redactor-selection-marker")||(o.css(e,""),this.utils.removeEmptyAttr(o,"style"),0===o[0].attributes.length&&o.replaceWith(o.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var e=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),e&&"SPAN"===e.tagName&&t(e).replaceWith(t(e).contents()),t.each(this.selection.getNodes(),t.proxy(function(e,i){var n=t(i);t.inArray(i.tagName.toLowerCase(),this.opts.inlineTags)==-1||n.hasClass("redactor-selection-marker")||n.replaceWith(n.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(t){this.inline.format("span","class",t)},toggleStyle:function(t){this.inline.format("span","style",t)}}},insert:function(){return{set:function(e,i){this.placeholder.remove(),e=this.clean.setVerified(e),"undefined"==typeof i&&(e=this.clean.onPaste(e,!1)),this.$editor.html(e),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),"undefined"==typeof i&&setTimeout(t.proxy(this.clean.clearUnverified,this),10)},text:function(e){if(this.placeholder.remove(),e=e.toString(),e=t.trim(e),e=this.clean.getPlainText(e,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(e);else{this.selection.get(),this.range.deleteContents();var i=document.createElement("div");i.innerHTML=e;for(var n,o,r=document.createDocumentFragment();n=i.firstChild;)o=r.appendChild(n);if(this.range.insertNode(r),o){var s=this.range.cloneRange();s.setStartAfter(o),s.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(s)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(t){this.insert.html(t,!1)},html:function(e,i){this.placeholder.remove(),"undefined"==typeof i&&(i=!0),this.$editor.focus(),e=this.clean.setVerified(e),i&&(e=this.clean.onPaste(e)),this.utils.browser("msie")?this.insert.htmlIe(e):(this.clean.singleLine?this.insert.execHtml(e):document.execCommand("insertHTML",!1,e),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(t.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),i&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(this.utils.browser("mozilla")){var e=t(this.selection.getBlock()).next();e.length>0&&"P"==e[0].tagName&&""===e.html()&&e.remove()}},htmlIe:function(e){if(this.utils.isIe11()){var i=this.utils.isCurrentOrParent("P"),n=t("<div>").append(e),o=n.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");return void(i&&o?this.insert.ie11FixInserting(i,e):this.insert.ie11PasteFrag(e))}document.selection.createRange().pasteHTML(e)},execHtml:function(t){t=this.clean.setVerified(t),this.selection.get(),this.range.deleteContents();var e=document.createElement("div");e.innerHTML=t;for(var i,n,o=document.createDocumentFragment();i=e.firstChild;)n=o.appendChild(i);this.range.insertNode(o),this.range.collapse(!0),this.caret.setAfter(n)},node:function(e,i){e=e[0]||e;var n=this.utils.getOuterHtml(e);return n=this.clean.setVerified(n),null!==n.match(/</g)&&(e=t(n)[0]),this.selection.get(),i!==!1&&this.range.deleteContents(),this.range.insertNode(e),this.range.collapse(!1),this.selection.addRange(),e},nodeToPoint:function(t,e,i){t=t[0]||t,this.selection.get();var n;if(document.caretPositionFromPoint){var o=document.caretPositionFromPoint(e,i);this.range.setStart(o.offsetNode,o.offset),this.range.collapse(!0),this.range.insertNode(t)}else if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(e,i),n.insertNode(t);else if("undefined"!=typeof document.body.createTextRange){n=document.body.createTextRange(),n.moveToPoint(e,i);var r=n.duplicate();r.moveToPoint(e,i),n.setEndPoint("EndToEnd",r),n.select()}},nodeToCaretPositionFromPoint:function(t,e){e=e[0]||e;var i,n=t.clientX,o=t.clientY;if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(n,o),s=document.getSelection();i=s.getRangeAt(0),i.setStart(r.offsetNode,r.offset),i.collapse(!0),i.insertNode(e)}else if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(n,o),i.insertNode(e);else if("undefined"!=typeof document.body.createTextRange){i=document.body.createTextRange(),i.moveToPoint(n,o);var a=i.duplicate();a.moveToPoint(n,o),i.setEndPoint("EndToEnd",a),i.select()}},ie11FixInserting:function(e,i){var n=document.createElement("span");n.className="redactor-ie-paste",this.insert.node(n);var o=t(e).html();
o="<p>"+o.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+i+"<p>")+"</p>",t(e).replaceWith(o)},ie11PasteFrag:function(t){this.selection.get(),this.range.deleteContents();var e=document.createElement("div");e.innerHTML=t;for(var i,n,o=document.createDocumentFragment();i=e.firstChild;)n=o.appendChild(i);this.range.insertNode(o),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(e){if(!this.rtePaste){var i=e.which,n=i>=37&&i<=40;this.keydown.ctrl=e.ctrlKey||e.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(e,i),this.keydown.checkEvents(n,i),this.keydown.setupBuffer(e,i),this.keydown.addArrowsEvent(n),this.keydown.setupSelectAll(e,i);var o=this.core.setCallback("keydown",e);if(o===!1)return e.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(i===this.keyCode.DOWN||i===this.keyCode.RIGHT)){var r=!1,s=!1;if(this.keydown.block&&"TD"===this.keydown.block.tagName&&(s=t(this.keydown.block).closest("table")),s&&s.find("td").last()[0]===this.keydown.block&&(r=!0),this.utils.isEndOfElement()&&r){var a=t(this.opts.emptyHtml);s.after(a),this.caret.setStart(a)}}if(this.opts.enterKey&&i===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&i===this.keyCode.ENTER)return e.preventDefault(),void(this.range.collapsed||this.range.deleteContents());if(i==this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){var l=this.core.setCallback("enter",e);if(l===!1)return e.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(e)===!0)return!1;var p,d;if(this.keydown.pre)return this.keydown.insertNewLine(e);if(this.keydown.blockquote||this.keydown.figcaption)return p=this.selection.getCurrent(),d=t(p).next(),0!==d.length&&"BR"==d[0].tagName?this.keydown.insertBreakLine(e):this.utils.isEndOfElement()&&p&&"SPAN"!=p?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e);if(this.opts.linebreaks&&!this.keydown.block)return p=this.selection.getCurrent(),d=t(this.keydown.current).next(),0!==d.length&&"BR"==d[0].tagName?this.keydown.insertBreakLine(e):p!==!1&&t(p).hasClass("redactor-invisible-space")?(this.caret.setAfter(p),t(p).contents().unwrap(),this.keydown.insertDblBreakLine(e)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(e):0===d.length&&p===!1&&"undefined"!=typeof d.context?this.keydown.insertBreakLine(e):this.keydown.insertBreakLine(e);if(this.opts.linebreaks&&this.keydown.block)setTimeout(t.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block)if("LI"!==this.keydown.block.tagName)setTimeout(t.proxy(this.keydown.replaceDivToParagraph,this),1);else{p=this.selection.getCurrent();var c=t(p).closest("li"),u=c.closest("ul,ol");if(0!==c.length&&this.utils.isEmpty(c.html())&&0===u.next().length){var a=t(this.opts.emptyHtml);return u.after(a),this.caret.setStart(a),!1}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(e)}if(i===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey))return this.keydown.onShiftEnter(e);if(i===this.keyCode.TAB||e.metaKey&&221===i||e.metaKey&&219===i)return this.keydown.onTab(e,i);if(i===this.keyCode.BACKSPACE||i===this.keyCode.DELETE){if(this.utils.browser("mozilla")&&this.keydown.current&&"TD"===this.keydown.current.tagName)return e.preventDefault(),!1;var h=this.selection.getNodes();if(h)for(var f,_=h.length,g=0;g<_;g++){var m=t(h[g]).children("img");if(0!==m.length){var v=this;t.each(m,function(e,i){var n=t(i);"none"==n.css("float")&&(v.core.setCallback("imageDelete",i.src,n),f=i)})}else"IMG"==h[g].tagName&&f!=h[g]&&(this.core.setCallback("imageDelete",h[g].src,t(h[g])),f=h[g])}}i===this.keyCode.BACKSPACE&&(this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(e)),this.code.sync()}},checkEvents:function(t,e){t||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(e)&&this.buffer.set())},checkKeyEvents:function(e){var i=this.keyCode,n=[i.BACKSPACE,i.DELETE,i.ENTER,i.SPACE,i.ESC,i.TAB,i.CTRL,i.META,i.ALT,i.SHIFT];return t.inArray(e,n)==-1},addArrowsEvent:function(t){if(t)return"click"==this.core.getEvent()||"arrow"==this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow")},setupBuffer:function(t,e){return this.keydown.ctrl&&90===e&&!t.shiftKey&&!t.altKey&&this.opts.buffer.length?(t.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===e&&t.shiftKey&&!t.altKey&&0!==this.opts.rebuffer.length?(t.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||e!=this.keyCode.BACKSPACE&&e!=this.keyCode.DELETE&&(e!=this.keyCode.ENTER||t.ctrlKey||t.shiftKey)&&e!=this.keyCode.SPACE||this.buffer.set())},setupSelectAll:function(t,e){this.keydown.ctrl&&65===e?this.utils.enableSelectAll():e==this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},onArrowDown:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertAfterLastElement(t[e]),!1},onShiftEnter:function(t){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(t):this.keydown.insertBreakLine(t)},onTab:function(t,e){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;t.preventDefault();var i;return this.keydown.pre&&!t.shiftKey?(i=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join("")):document.createTextNode("\t"),this.insert.node(i),this.code.sync()):this.opts.tabAsSpaces!==!1?(i=document.createTextNode(Array(this.opts.tabAsSpaces+1).join("")),this.insert.node(i),this.code.sync()):t.metaKey&&219===e?this.indent.decrease():t.metaKey&&221===e?this.indent.increase():t.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var e=this.selection.getBlock(),i=e.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===e.tagName||"P"===e.tagName)&&""===i&&!t(e).hasClass("redactor-editor")){var n=document.createElement("br");return t(e).replaceWith(n),this.caret.setBefore(n),this.code.sync(),!1}},replaceDivToParagraph:function(){var e=this.selection.getBlock(),i=e.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===e.tagName&&""===i&&!t(e).hasClass("redactor-editor")){var n=document.createElement("p");return n.innerHTML=this.opts.invisibleSpace,t(e).replaceWith(n),this.caret.setStart(n),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&"P"==e.tagName&&t(e).removeAttr("class").removeAttr("style")},insertParagraph:function(t){t.preventDefault(),this.selection.get();var e=document.createElement("p");return e.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(e),this.caret.setStart(e),this.code.sync(),!1},exitFromBlockquote:function(e){if(this.utils.isEndOfElement()){var i=t.trim(t(this.keydown.block).html());if(i.search(/(<br\s?\/?>){2}$/i)!=-1){if(e.preventDefault(),this.opts.linebreaks){var n=document.createElement("br");t(this.keydown.blockquote).after(n),this.caret.setBefore(n),t(this.keydown.block).html(i.replace(/<br\s?\/?>$/i,""))}else{var o=t(this.opts.emptyHtml);t(this.keydown.blockquote).after(o),this.caret.setStart(o)}return!0}}},insertAfterLastElement:function(e){if(this.utils.isEndOfElement())if(this.buffer.set(),this.opts.linebreaks){var i=t("<div>").append(t.trim(this.$editor.html())).contents(),n=i.last()[0];if("SPAN"==n.tagName&&""===n.innerHTML&&(n=i.prev()[0]),this.utils.getOuterHtml(n)!=this.utils.getOuterHtml(e))return;var o=document.createElement("br");t(e).after(o),this.caret.setAfter(o)}else{if(this.$editor.contents().last()[0]!==e)return;var r=t(this.opts.emptyHtml);t(e).after(r),this.caret.setStart(r)}},insertNewLine:function(t){t.preventDefault();var e=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(e),this.caret.setAfter(e),this.code.sync(),!1},insertBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t)},insertDblBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t,!0)},insertBreakLineProcessing:function(e,i){e.stopPropagation(),this.selection.get();var n=document.createElement("br");if(this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(n),i===!0){var o=t(n).next();if(0!==o.length&&"BR"===o[0].tagName&&this.utils.isEndOfEditor())return this.caret.setAfter(n),this.code.sync(),!1;var r=document.createElement("br");this.range.insertNode(r),this.caret.setAfter(r)}else this.keydown.insertBreakLineProcessingAfter(n);return this.code.sync(),!1},insertBreakLineProcessingAfter:function(e){var i=this.utils.createSpaceElement();t(e).after(i),this.selection.selectElement(i),t(i).replaceWith(function(){return t(this).contents()})},removeInvisibleSpace:function(){var e=t(this.keydown.current);0===e.text().search(/^\u200B$/g)&&e.remove()},removeEmptyListInTable:function(e){var i=t(this.keydown.current),n=t(this.keydown.parent),o=i.closest("td");if(0!==o.length&&i.closest("li")&&1===n.children("li").length){if(!this.utils.isEmpty(i.text()))return;e.preventDefault(),i.remove(),n.remove(),this.caret.setStart(o)}}}},keyup:function(){return{init:function(e){if(!this.rtePaste){var i=e.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var n=this.utils.isRedactorParent(t(this.keyup.parent).parent()),o=this.core.setCallback("keyup",e);return o===!1?(e.preventDefault(),!1):(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(this.keyup.parent===!1||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!t(this.keyup.parent).hasClass("redactor-invisible-space")||n!==!1&&"BODY"!=n[0].tagName||(t(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.keyup.isLinkify(i)&&(this.formatLinkify(this.opts.linkProtocol,this.opts.convertLinks,this.opts.convertUrlLinks,this.opts.convertImageLinks,this.opts.convertVideoLinks,this.opts.linkSize),this.observe.load(),this.code.sync()),i===this.keyCode.DELETE||i===this.keyCode.BACKSPACE?(this.clean.clearUnverified(),this.observe.image?(e.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each(t.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(t(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),t(this.keyup.current).remove()),this.keyup.formatEmpty(e))):void 0)}},isLinkify:function(t){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&t===this.keyCode.ENTER&&!this.utils.isCurrentOrParent("PRE")},replaceToParagraph:function(e){var i,n=t(this.keyup.current);i=e===!1?t("<p>").append(n.html()):t("<p>").append(n.clone()),n.replaceWith(i);var o=t(i).next();"undefined"!=typeof o[0]&&"BR"==o[0].tagName&&o.remove(),this.caret.setEnd(i)},formatEmpty:function(e){var i=t.trim(this.$editor.html());if(this.utils.isEmpty(i))return e.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(i="<p><br /></p>",this.$editor.html(i),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(t){return"undefined"!=typeof this.opts.curLang[t]?this.opts.curLang[t]:""}}},line:function(){return{insert:function(){this.buffer.set();var t=this.selection.getBlocks();return t[0]!==!1&&this.line.isExceptLastOrFirst(t)?void(this.utils.browser("msie")||this.$editor.focus()):void(this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers())},isExceptLastOrFirst:function(e){var i=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],n=e[0].tagName.toLowerCase(),o=this.selection.getLastBlock();o="undefined"==typeof o?n:o.tagName.toLowerCase();var r=t.inArray(n,i)!=-1,s=t.inArray(o,i)!=-1;if(r&&s||r)return!0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var t='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(t='<br id="redactor-insert-line">'),document.execCommand("insertHTML",!1,"<hr>"+t),this.line.setFocus(),this.code.sync()},setFocus:function(){var e=this.$editor.find("#redactor-insert-line"),i=t(e).next()[0];i?(this.caret.setAfter(e),e.remove()):e.removeAttr("id")}}},link:function(){return{show:function(e){"undefined"!=typeof e&&e.preventDefault&&e.preventDefault(),this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton(),this.link.buttonInsert=this.modal.createActionButton(this.lang.get("insert")),this.selection.get(),this.link.getData(),this.link.cleanUrl(),"_blank"==this.link.target&&t("#redactor-link-blank").prop("checked",!0),this.link.$inputUrl=t("#redactor-link-url"),this.link.$inputText=t("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",t.proxy(this.link.insert,this)),t(".redactor-link-tooltip").remove(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var t=self.location.href.replace(/\/$/i,"");if(this.link.url=this.link.url.replace(t,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:",""),!this.opts.linkProtocol){var e=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(e,"")}},getData:function(){this.link.$node=!1;var e=t(this.selection.getCurrent()).closest("a");0!==e.length&&"A"===e[0].tagName?(this.link.$node=e,this.link.url=e.attr("href"),this.link.text=e.text(),this.link.target=e.attr("target")):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="")},insert:function(){var e="",i=this.link.$inputUrl.val(),n=this.link.$inputText.val();if(""===t.trim(i))return void this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){t(this).removeClass("redactor-input-error"),t(this).off("keyup")});if(i.search("@")!=-1&&/(http|ftp|https):\/\//i.test(i)===!1)i="mailto:"+i;else if(0!==i.search("#")){t("#redactor-link-blank").prop("checked")&&(e="_blank");var o="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",r=new RegExp("^(http|ftp|https)://"+o,"i"),s=new RegExp("^"+o,"i"),a=new RegExp(".(html|php)$","i");i.search(r)==-1&&i.search(a)==-1&&0===i.search(s)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+"://"+i)}this.link.set(n,i,e),this.modal.close()},set:function(e,i,n){if(e=t.trim(e.replace(/<|>/g,"")),this.selection.restore(),""!==e||""!==i){if(""===e&&""!==i&&(e=i),this.link.$node)this.buffer.set(),this.link.$node.text(e).attr("href",i),""!==n?this.link.$node.attr("target",n):this.link.$node.removeAttr("target"),this.code.sync();else{if(this.utils.browser("mozilla")&&""===this.link.text){var o=t("<a />").attr("href",i).text(e);""!==n&&o.attr("target",n),this.insert.node(o),this.selection.selectElement(o)}else{var o;this.utils.browser("msie")?(o=t('<a href="'+i+'">').text(e),""!==n&&o.attr("target",n),o=t(this.insert.node(o)),this.selection.selectElement(o)):(document.execCommand("createLink",!1,i),o=t(this.selection.getCurrent()).closest("a"),this.utils.browser("mozilla")&&(o=t('a[_moz_dirty=""]')),""!==n&&o.attr("target",n),o.removeAttr("style").removeAttr("_moz_dirty"),""===this.link.text&&this.link.text==e||(o.text(e),this.selection.selectElement(o)))}this.code.sync(),this.core.setCallback("insertedLink",o)}setTimeout(t.proxy(function(){this.observe.links()},this),5)}},unlink:function(e){"undefined"!=typeof e&&e.preventDefault&&e.preventDefault();var i=this.selection.getNodes();if(i){this.buffer.set();for(var n=i.length,o=0;o<n;o++){var r=t(i[o]).closest("a");r.replaceWith(r.contents())}t(".redactor-link-tooltip").remove(),this.code.sync()}},toggleClass:function(t){this.link.setClass(t,"toggleClass")},addClass:function(t){this.link.setClass(t,"addClass")},removeClass:function(t){this.link.setClass(t,"removeClass")},setClass:function(e,i){var n=this.selection.getInlinesTags(["a"]);n!==!1&&t.each(n,function(){t(this)[i](e)})}}},list:function(){return{toggle:function(e){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var i=this.selection.getParent(),n=t(i).closest("ol, ul");this.utils.isRedactorParent(n)||0===n.length||(n=!1);var o,r,s=!1;if(n&&n.length){s=!0;var a=n[0].tagName;o="orderedlist"===e&&"UL"===a,r="unorderedlist"===e&&"OL"===a}o?this.utils.replaceToTag(n,"ol"):r?this.utils.replaceToTag(n,"ul"):s?this.list.remove(e):this.list.insert(e),this.selection.restore(),this.code.sync()},insert:function(e){var i=this.selection.getParent(),n=this.selection.getCurrent(),o=t(n).closest("td, th");this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(e):document.execCommand("insert"+e);var r=t(this.selection.getParent()).closest("ol, ul");if(0!==o.length){var s=o.prev(),a=o.html();o.html(""),!s||1!==s.length||"TD"!==s[0].tagName&&"TH"!==s[0].tagName?t(i).prepend(o):t(s).after(o),o.html(a)}if(this.utils.isEmpty(r.find("li").text())){var l=r.children("li");l.find("br").remove(),l.append(this.selection.getMarkerAsHtml())}if(r.length){var p=r.parent();this.utils.isRedactorParent(p)&&"LI"!=p[0].tagName&&this.utils.isBlock(p[0])&&p.replaceWith(p.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(e){var i=this.selection.wrap("div"),n=t(i).html(),o=t("orderedlist"==e?"<ol>":"<ul>"),r=t("<li>");if(""===t.trim(n))r.append(this.selection.getMarkerAsHtml()),o.append(r),this.$editor.find("#selection-marker-1").replaceWith(o);else{var s=n.split(/<br\s?\/?>/gi);if(s)for(var a=0;a<s.length;a++)""!==t.trim(s[a])&&o.append(t("<li>").html(s[a]));else r.append(n),o.append(r);t(i).replaceWith(o)}},remove:function(e){document.execCommand("insert"+e);var i=t(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==i.closest("li, th, td").length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(t.proxy(this.utils.removeEmpty,this)));var n=t(this.selection.getCurrent()).closest("table"),o=n.prev();this.opts.linebreaks||0===n.length||0===o.length||"BR"!=o[0].tagName||o.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /><label class="redactor-image-link-option">'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" class="redactor-image-link-option" /><label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank"> '+this.lang.get("link_new_tab")+'</label><label class="redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="redactor-image-position-option" id="redactor-image-align"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></section>",image:String()+'<section id="redactor-modal-image-insert"><div id="redactor-modal-image-droparea"></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div id="redactor-modal-file-upload-box"><label>'+this.lang.get("filename")+'</label><input type="text" id="redactor-filename" /><br><br><div id="redactor-modal-file-upload"></div></div></section>',link:String()+'<section id="redactor-modal-link-insert"><label>URL</label><input type="url" id="redactor-link-url" /><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" /><label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label></section>"},t.extend(this.opts,this.opts.modal)},addCallback:function(t,e){this.modal.callbacks[t]=e},createTabber:function(e){this.modal.$tabber=t("<div>").attr("id","redactor-modal-tabber"),e.prepend(this.modal.$tabber)},addTab:function(e,i,n){var o=t('<a href="#" rel="tab'+e+'">').text(i);n&&o.addClass("active");var r=this;o.on("click",function(e){e.preventDefault(),t(".redactor-tab").hide(),t(".redactor-"+t(this).attr("rel")).show(),r.modal.$tabber.find("a").removeClass("active"),t(this).addClass("active")}),this.modal.$tabber.append(o)},addTemplate:function(t,e){this.opts.modal[t]=e},getTemplate:function(t){return this.opts.modal[t]},getModal:function(){return this.$modalBody.find("section")},load:function(t,e,i){this.modal.templateName=t,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(e),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[t]&&this.modal.callbacks[t].call(this)},show:function(){this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),t(document.body).removeClass("body-redactor-hidden"),this.modal.bodyOveflow=t(document.body).css("overflow"),t(document.body).css("overflow","hidden"),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.$modalOverlay.show(),this.$modalBox.show(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(t.proxy(this.modal.showOnDesktop,this),0),t(window).on("resize.redactor-modal",t.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),t(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",t.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var e=this.$modal.outerHeight(),i=t(window).height(),n=t(window).width();return this.modal.width>n?void this.$modal.css({width:"96%",marginTop:i/2-e/2+"px"}):void(e>i?this.$modal.css({width:this.modal.width+"px",marginTop:"20px"}):this.$modal.css({width:this.modal.width+"px",marginTop:i/2-e/2+"px"}))},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(t){this.$modalHeader.html(t)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){"undefined"!=typeof t.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(t){13==t.which&&(t.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click())},createCancelButton:function(){var e=t("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));e.on("click",t.proxy(this.modal.close,this)),this.$modalFooter.append(e)},createDeleteButton:function(t){return this.modal.createButton(t,"delete")},createActionButton:function(t){return this.modal.createButton(t,"action")},createButton:function(e,i){var n=t("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+i+"-btn").html(e);return this.$modalFooter.append(n),n},setButtonsWidth:function(){var t=this.$modalFooter.find("button"),e=t.length;0!==e&&t.css("width",100/e+"%")},build:function(){this.modal.buildOverlay(),this.$modalBox=t('<div id="redactor-modal-box" />').hide(),this.$modal=t('<div id="redactor-modal" />'),this.$modalHeader=t("<header />"),this.$modalClose=t('<span id="redactor-modal-close" />').html("&times;"),this.$modalBody=t('<div id="redactor-modal-body" />'),this.$modalFooter=t("<footer />"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalClose),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=t('<div id="redactor-modal-overlay">').hide(),t("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",t.proxy(this.modal.close,this)),t(document).on("keyup.redactor-modal",t.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",t.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",t.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal"),t(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),t(window).off("resize.redactor-modal")},closeHandler:function(t){t.which==this.keyCode.ESC&&this.modal.close(!1)},close:function(e){if(e){if(!t(e.target).hasClass("redactor-modal-close-btn")&&e.target!=this.$modalClose[0]&&e.target!=this.$modalBox[0])return;e.preventDefault()}this.$modalBox&&(this.modal.disableEvents(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",t.proxy(function(){this.$modalBox.remove(),setTimeout(t.proxy(this.utils.restoreScroll,this),0),void 0!==e&&this.selection.restore(),t(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){this.observe.images(),this.observe.links()},buttons:function(e,i){var n=this.selection.getCurrent(),o=this.selection.getParent();if(e!==!1?this.button.setInactiveAll():this.button.setInactiveAll(i),e===!1&&"html"!==i)return void(t.inArray(i,this.opts.activeButtons)!=-1&&this.button.toggleActive(i));t.each(this.opts.activeButtonsStates,t.proxy(function(e,i){var r=t(o).closest(e),s=t(n).closest(e);(0===r.length||this.utils.isRedactorParent(r))&&this.utils.isRedactorParent(s)&&(0===r.length&&0===s.closest(e).length||this.button.setActive(i))},this));var r=t(o).closest(this.opts.alignmentTags.toString().toLowerCase());if(this.utils.isRedactorParent(o)&&r.length){var s=""===r.css("text-align")?"left":r.css("text-align");this.button.setActive("align"+s)}},addButton:function(t,e){this.opts.activeButtons.push(e),this.opts.activeButtonsStates[t]=e},images:function(){this.$editor.find("img").each(t.proxy(function(e,i){var n=t(i);n.closest("a").on("click",function(t){t.preventDefault()}),this.utils.browser("msie")&&n.attr("unselectable","on"),this.image.setEditable(n)},this)),t(document).on("click.redactor-image-delete."+this.uuid,t.proxy(function(t){this.observe.image=!1,"IMG"==t.target.tagName&&this.utils.isRedactorParent(t.target)&&(this.observe.image=(!this.observe.image||this.observe.image!=t.target)&&t.target)},this))},links:function(){this.opts.linkTooltip&&(this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)),t(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,t.proxy(this.observe.closeTooltip,this)))},getTooltipPosition:function(t){return t.offset()},showTooltip:function(e){var i=t(e.target),n=i.closest("a"),o=0!==i.length&&i[0].tagName;if("A"===n[0].tagName){if("IMG"===o)return;"A"!==o&&(i=n)}if("A"===o){var r=this.observe.getTooltipPosition(i),s=t('<span class="redactor-link-tooltip"></span>'),a=i.attr("href");void 0===a&&(a=""),a.length>24&&(a=a.substring(0,24)+"...");var l=t('<a href="'+i.attr("href")+'" target="_blank" />').html(a).addClass("redactor-link-tooltip-action"),p=t('<a href="#" />').html(this.lang.get("edit")).on("click",t.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),d=t('<a href="#" />').html(this.lang.get("unlink")).on("click",t.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");s.append(l).append(" | ").append(p).append(" | ").append(d),s.css({top:r.top+parseInt(i.css("line-height"),10)+"px",left:r.left+"px"}),t(".redactor-link-tooltip").remove(),t("body").append(s)}},closeTooltip:function(e){e=e.originalEvent||e;var i=e.target,n=t(i).closest("a");0!==n.length&&"A"===n[0].tagName&&"A"!==i.tagName||"A"===i.tagName&&this.utils.isRedactorParent(i)||t(i).hasClass("redactor-link-tooltip-action")||t(".redactor-link-tooltip").remove()}}},paragraphize:function(){return{load:function(e){return this.opts.linebreaks?e:""===e||"<p></p>"===e?this.opts.emptyHtml:(this.paragraphize.blocks=["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],e+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),e=this.paragraphize.getSafes(e),e=this.paragraphize.getSafesComments(e),e=this.paragraphize.replaceBreaksToNewLines(e),e=this.paragraphize.replaceBreaksToParagraphs(e),e=this.paragraphize.clear(e),e=this.paragraphize.restoreSafes(e),e=e.replace(new RegExp("<br\\s?/?>\n?<("+this.paragraphize.blocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),t.trim(e))},getSafes:function(e){var i=t("<div />").append(e);return i.find("blockquote p").replaceWith(function(){return t(this).append("<br />").contents()}),e=i.html(),i.find(this.paragraphize.blocks.join(", ")).each(t.proxy(function(t,i){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,e=e.replace(i.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),e},getSafesComments:function(e){var i=e.match(/<!--([\w\W]*?)-->/gi);return i?(t.each(i,t.proxy(function(t,i){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i,e=e.replace(i,"\n{replace"+this.paragraphize.z+"}")},this)),e):e},restoreSafes:function(e){return t.each(this.paragraphize.safes,function(t,i){i="undefined"!=typeof i?i.replace(/\$/g,"&#36;"):i,e=e.replace("{replace"+t+"}",i)}),e},replaceBreaksToParagraphs:function(t){var e=t.split(new RegExp("\n","g"),-1);if(t="",e)for(var i=e.length,n=0;n<i;n++){if(!e.hasOwnProperty(n))return;e[n].search("{replace")==-1?(e[n]=e[n].replace(/<p>\n\t?<\/p>/gi,""),e[n]=e[n].replace(/<p><\/p>/gi,""),""!==e[n]&&(t+="<p>"+e[n].replace(/^\n+|\n+$/g,"")+"</p>")):t+=e[n]}return t},replaceBreaksToNewLines:function(t){return t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n"),t=t.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),t=t.replace(new RegExp("\r\n","g"),"\n"),t=t.replace(new RegExp("\r","g"),"\n"),t=t.replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(t){return t=t.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),t=t.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),t=t.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),t=t.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),t=t.replace(new RegExp("<p><p ","gi"),"<p "),t=t.replace(new RegExp("<p><p>","gi"),"<p>"),t=t.replace(new RegExp("</p></p>","gi"),"</p>"),t=t.replace(new RegExp("<p>\\s?</p>","gi"),""),t=t.replace(new RegExp("\n</p>","gi"),"</p>"),t=t.replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>"),t=t.replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(e){return this.opts.cleanOnPaste?(this.rtePaste=!0,
this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),t(window).on("scroll.redactor-freeze",t.proxy(function(){t(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout(t.proxy(function(){var e=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(e),t(window).off("scroll.redactor-freeze")},this),1)):void setTimeout(t.proxy(this.code.sync,this),1)},createPasteBox:function(){this.$pasteBox=t("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie")?this.$box.append(this.$pasteBox):t("body").append(this.$pasteBox),this.$pasteBox.focus()},insert:function(e){e=this.core.setCallback("pasteBefore",e),e=this.utils.isSelectAll()?this.clean.onPaste(e,!1):this.clean.onPaste(e),e=this.core.setCallback("paste",e),this.utils.isSelectAll()?this.insert.set(e,!1):this.insert.html(e,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(t.proxy(this.clean.clearUnverified,this),10),setTimeout(t.proxy(function(){var e=this.$editor.find("span");t.each(e,function(e,i){var n=i.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"");""===n&&0===i.attributes.length&&t(i).remove()})},this),10)}}},placeholder:function(){return{enable:function(){this.placeholder.is()&&(this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keyup.redactor-placeholder",t.proxy(this.placeholder.toggle,this)))},toggle:function(){var t="removeClass";this.utils.isEmpty(this.$editor.html(),!1)&&(t="addClass"),this.$editor[t]("redactor-placeholder")},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):!("undefined"==typeof this.$element.attr("placeholder")||""===this.$element.attr("placeholder"))}}},progress:function(){return{show:function(){t(document.body).append(t('<div id="redactor-progress"><span></span></div>')),t("#redactor-progress").fadeIn()},hide:function(){t("#redactor-progress").fadeOut(1500,function(){t(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(t){}this.sel.addRange(this.range)},getCurrent:function(){var t=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(t=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(t)},getParent:function(e){return e=e||this.selection.getCurrent(),!!e&&this.utils.isRedactorParent(t(e).parent()[0])},getBlock:function(e){for(e=e||this.selection.getCurrent();e;){if(this.utils.isBlockTag(e.tagName))return!t(e).hasClass("redactor-editor")&&e;e=e.parentNode}return!1},getInlines:function(e,i){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var n=[];e="undefined"==typeof e||e===!1?this.selection.getNodes():e;var o=this.opts.inlineTags;if(o.push("span"),"undefined"!=typeof i)for(var r=0;r<i.length;r++)o.push(i[r]);return t.each(e,t.proxy(function(e,i){t.inArray(i.tagName.toLowerCase(),o)!=-1&&n.push(i)},this)),0!==n.length&&n},getInlinesTags:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var i=[],n=this.selection.getNodes();return t.each(n,t.proxy(function(n,o){t.inArray(o.tagName.toLowerCase(),e)!=-1&&i.push(o)},this)),0!==i.length&&i},getBlocks:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var i=[];return e="undefined"==typeof e?this.selection.getNodes():e,t.each(e,t.proxy(function(t,e){this.utils.isBlock(e)&&(this.selection.lastBlock=e,i.push(e))},this)),0===i.length?[this.selection.getBlock()]:i},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var e=this.selection.getNodesMarker(1),i=this.selection.getNodesMarker(2),n=this.range.cloneRange();if(this.range.collapsed===!1){var o=n.startContainer,r=n.startOffset;this.selection.setNodesMarker(n,i,!1),n.setStart(o,r),this.selection.setNodesMarker(n,e,!0)}else this.selection.setNodesMarker(n,e,!0),i=e;var s=[],a=0,l=this;this.$editor.find("*").each(function(){if(this==e){var n=t(this).parent();0!==n.length&&"BODY"!=n[0].tagName&&l.utils.isRedactorParent(n[0])&&s.push(n[0]),s.push(this),a=1}else a>0&&(s.push(this),a+=1);if(this==i)return!1});for(var p=[],d=s.length,c=0;c<d;c++)"nodes-marker-1"!=s[c].id&&"nodes-marker-2"!=s[c].id&&p.push(s[c]);return this.selection.removeNodesMarkers(),p},getNodesMarker:function(e){return t('<span id="nodes-marker-'+e+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(t,e,i){try{t.collapse(i),t.insertNode(e)}catch(t){}},removeNodesMarkers:function(){t(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(t,e){this.caret.setOffset(t,e)},wrap:function(t){if(this.selection.get(),this.range.collapsed)return!1;var e=document.createElement(t);return e.appendChild(this.range.extractContents()),this.range.insertNode(e),e},selectElement:function(t){this.caret.set(t,0,t,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var t=this.selection.getMarker(1);if(this.selection.setMarker(this.range,t,!0),this.range.collapsed===!1){var e=this.selection.getMarker(2);this.selection.setMarker(this.range,e,!1)}this.savedSel=this.$editor.html()},getMarker:function(e){return"undefined"==typeof e&&(e=1),t('<span id="selection-marker-'+e+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(t){return this.utils.getOuterHtml(this.selection.getMarker(t))},setMarker:function(t,e,i){t=t.cloneRange();try{t.collapse(i),t.insertNode(e)}catch(t){this.focus.setStart()}},restore:function(){var t=this.$editor.find("span#selection-marker-1"),e=this.$editor.find("span#selection-marker-2");0!==t.length&&0!==e.length?this.caret.set(t,0,e,0):0!==t.length?this.caret.set(t,0,t,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(e,i){var n=t(i).text().replace(/[\u200B-\u200D\uFEFF]/g,"");""===n?t(i).remove():t(i).replaceWith(function(){return t(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var t="";if(this.selection.get(),this.sel.rangeCount){for(var e=document.createElement("div"),i=this.sel.rangeCount,n=0;n<i;++n)e.appendChild(this.sel.getRangeAt(n).cloneContents());t=e.innerHTML}return this.clean.onSync(t)},replaceWithHtml:function(t){if(t=this.selection.getMarkerAsHtml(1)+t+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt){this.range.deleteContents();var e=document.createElement("div");e.innerHTML=t;for(var i,n=document.createDocumentFragment();i=e.firstChild;)n.appendChild(i);this.range.insertNode(n)}else document.selection&&document.selection.createRange&&this.range.pasteHTML(t);this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(e,i){return this.opts.shortcuts?void t.each(this.opts.shortcuts,t.proxy(function(i,n){for(var o=i.split(","),r=o.length,s=0;s<r;s++)"string"==typeof o[s]&&this.shortcuts.handler(e,t.trim(o[s]),t.proxy(function(){var t;"-1"!=n.func.search(/\./)?(t=n.func.split("."),"undefined"!=typeof this[t[0]]&&this[t[0]][t[1]].apply(this,n.params)):this[n.func].apply(this,n.params)},this))},this)):(!e.ctrlKey&&!e.metaKey||66!==i&&73!==i||e.preventDefault(),!1)},handler:function(e,i,n){var o={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},r={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};i=i.toLowerCase().split(" ");var s=o[e.keyCode],a=String.fromCharCode(e.which).toLowerCase(),l="",p={};t.each(["alt","ctrl","meta","shift"],function(t,i){e[i+"Key"]&&s!==i&&(l+=i+"+")}),s&&(p[l+s]=!0),a&&(p[l+a]=!0,p[l+r[a]]=!0,"shift+"===l&&(p[r[a]]=!0));for(var d=0,c=i.length;d<c;d++)if(p[i[d]])return e.preventDefault(),n.apply(this,arguments)}}},tabifier:function(){return{get:function(t){if(!this.opts.tabifier)return t;var e=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],i=["li","dt","dt","h[1-6]","option","script"],n=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+e.join("|/?")+"|"+i.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+e.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+n.join("|")+")[ >]");var o=0,r=t.length,s=0,a=null,l=null,p="",d="",c="";for(this.tabifier.cleanlevel=0;o<r;o++){if(s=o,-1==t.substr(o).indexOf("<"))return d+=t.substr(o),this.tabifier.finish(d);for(;s<r&&"<"!=t.charAt(s);)s++;for(o!=s&&(c=t.substr(o,s-o),c.match(/^\s{2,}$/g)||("\n"==d.charAt(d.length-1)?d+=this.tabifier.getTabs():"\n"==c.charAt(0)&&(d+="\n"+this.tabifier.getTabs(),c=c.replace(/^\s+/,"")),d+=c),c.match(/\n/)&&(d+="\n"+this.tabifier.getTabs())),a=s;s<r&&">"!=t.charAt(s);)s++;p=t.substr(a,s-a),o=s;var u;if("!--"==p.substr(1,3)){if(!p.match(/--$/)){for(;"-->"!=t.substr(s,3);)s++;s+=2,p=t.substr(a,s-a),o=s}"\n"!=d.charAt(d.length-1)&&(d+="\n"),d+=this.tabifier.getTabs(),d+=p+">\n"}else"!"==p[1]?d=this.tabifier.placeTag(p+">",d):"?"==p[1]?d+=p+">\n":(u=p.match(/^<(script|style|pre)/i))?(u[1]=u[1].toLowerCase(),p=this.tabifier.cleanTag(p),d=this.tabifier.placeTag(p,d),l=String(t.substr(o+1)).toLowerCase().indexOf("</"+u[1]),l&&(c=t.substr(o+1,l),o+=l,d+=c)):(p=this.tabifier.cleanTag(p),d=this.tabifier.placeTag(p,d))}return this.tabifier.finish(d)},getTabs:function(){for(var t="",e=0;e<this.tabifier.cleanlevel;e++)t+="\t";return t},finish:function(t){return t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/,""),t=t.replace(/[\s\n]*$/,""),t=t.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,t},cleanTag:function(t){var e="";t=t.replace(/\n/g," "),t=t.replace(/\s{2,}/g," "),t=t.replace(/^\s+|\s+$/g," ");var i="";t.match(/\/$/)&&(i="/",t=t.replace(/\/+$/,""));for(var n;n=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)n[2]?e+=n[1].toLowerCase()+"="+n[2]:n[1]&&(e+=n[1].toLowerCase()),e+=" ",t=t.substr(n[0].length);return e.replace(/\s*$/,"")+i+">"},placeTag:function(t,e){var i=t.match(this.tabifier.newLevel);return(t.match(this.tabifier.lineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"==t.charAt(1)&&this.tabifier.cleanlevel--,"\n"==e.charAt(e.length-1)&&(e+=this.tabifier.getTabs()),i&&"/"!=t.charAt(1)&&this.tabifier.cleanlevel++,e+=t,(t.match(this.tabifier.lineAfter)||t.match(this.tabifier.newLevel))&&(e=e.replace(/ *$/,"")),e}}},tidy:function(){return{setupAllowed:function(){if(this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),!this.opts.linebreaks){var t=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(t),this.opts.deniedTags&&this.tidy.removeFromDenied(t)}},addToAllowed:function(e){for(var i=e.length,n=0;n<i;n++)t.inArray(e[n],this.opts.allowedTags)==-1&&this.opts.allowedTags.push(e[n])},removeFromDenied:function(e){for(var i=e.length,n=0;n<i;n++){var o=t.inArray(e[n],this.opts.deniedTags);o!=-1&&this.opts.deniedTags.splice(o,1)}},load:function(e,i){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},t.extend(this.tidy.settings,i),e=this.tidy.removeComments(e),this.tidy.$div=t("<div />").append(e),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),e=this.tidy.$div.html(),this.tidy.$div.remove(),e},removeComments:function(t){return this.tidy.settings.removeComments?t.replace(/<!--[\s\S]*?-->/gi,""):t},replaceTags:function(e){if(!this.tidy.settings.replaceTags)return e;for(var i=this.tidy.settings.replaceTags.length,n=[],o=[],r=0;r<i;r++)o.push(this.tidy.settings.replaceTags[r][1]),n.push(this.tidy.settings.replaceTags[r][0]);return this.tidy.$div.find(n.join(",")).each(t.proxy(function(e,i){var n=o[e];t(i).replaceWith(function(){for(var e=t("<"+n+" />").append(t(this).contents()),i=0;i<this.attributes.length;i++)e.attr(this.attributes[i].name,this.attributes[i].value);return e})},this)),e},replaceStyles:function(){if(this.tidy.settings.replaceStyles){var e=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(t.proxy(function(i,n){for(var o=t(n),r=o.attr("style"),s=0;s<e;s++)if(r&&r.match(new RegExp("^"+this.tidy.settings.replaceStyles[s][0],"i"))){var a=this.tidy.settings.replaceStyles[s][1];o.replaceWith(function(){var e=document.createElement(a);return t(e).append(t(this).contents())})}},this))}},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(e,i){""===i.innerHTML?t(i).remove():t(i).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(e,i){""===i.innerHTML?t(i).remove():t(i).contents().unwrap()})},removeAttr:function(){var e;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var i=[],n=[];e=this.tidy.settings.allowedAttr.length;for(var o=0;o<e;o++)i.push(this.tidy.settings.allowedAttr[o][0]),n.push(this.tidy.settings.allowedAttr[o][1]);this.tidy.$div.find("*").each(t.proxy(function(e,o){var r=t(o),s=t.inArray(r[0].tagName.toLowerCase(),i),a=this.tidy.removeAttrGetRemoves(s,n,r);a&&t.each(a,function(t,e){r.removeAttr(e)})},this))}if(this.tidy.settings.removeAttr){e=this.tidy.settings.removeAttr.length;for(var o=0;o<e;o++){var r=this.tidy.settings.removeAttr[o][1];t.isArray(r)&&(r=r.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[o][0]).removeAttr(r)}}},removeAttrGetRemoves:function(e,i,n){var o=[];return e==-1?t.each(n[0].attributes,function(t,e){o.push(e.name)}):"*"==i[e]?o=[]:t.each(n[0].attributes,function(n,r){t.isArray(i[e])?t.inArray(r.name,i[e])==-1&&o.push(r.name):i[e]!=r.name&&o.push(r.name)}),o},removeAttrs:function(e,i){return i=new RegExp(i,"g"),e.each(function(){for(var e=t(this),n=this.attributes.length-1,o=n;o>=0;o--){var r=this.attributes[o];r&&r.specified&&r.name.search(i)>=0&&e.removeAttr(r.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var e=t(this),i=e.text();i=i.replace(/[\u200B-\u200D\uFEFF]/g,""),i=i.replace(/&nbsp;/gi,""),i=i.replace(/\s/g,""),""===i&&0===e.children().length&&e.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(this.tidy.settings.removeDataAttr){var e=this.tidy.settings.removeDataAttr;t.isArray(this.tidy.settings.removeDataAttr)&&(e=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(e),"^(data-)")}},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&t(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show"},unlink:{title:this.lang.get("unlink"),func:"link.unlink"}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded(),0!==this.opts.buttons.length&&(this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",t.proxy(this.observe.buttons,this)))},createContainer:function(){return t("<ul>").addClass("redactor-toolbar").attr("id","redactor-toolbar-"+this.uuid)},setFormattingTags:function(){t.each(this.opts.toolbar.formatting.dropdown,t.proxy(function(e,i){t.inArray(e,this.opts.formatting)==-1&&delete this.opts.toolbar.formatting.dropdown[e]},this))},loadButtons:function(){t.each(this.opts.buttons,t.proxy(function(e,i){if(this.opts.toolbar[i]){if("file"===i){if(this.opts.fileUpload===!1)return;if(!this.opts.fileUpload&&this.opts.s3===!1)return}if("image"===i){if(this.opts.imageUpload===!1)return;if(!this.opts.imageUpload&&this.opts.s3===!1)return}var n=this.opts.toolbar[i];this.$toolbar.append(t("<li>").append(this.button.build(i,n)))}},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),t(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){this.utils.isDesktop()&&(this.opts.toolbarExternal||this.opts.toolbarFixed&&(this.toolbar.observeScroll(),t(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,t.proxy(this.toolbar.observeScroll,this))))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(!this.opts.source){var t=this.opts.buttons.indexOf("html");t!==-1&&this.opts.buttons.splice(t,1)}},hideButtons:function(){0!==this.opts.buttonsHide.length&&t.each(this.opts.buttonsHide,t.proxy(function(t,e){var i=this.opts.buttons.indexOf(e);this.opts.buttons.splice(i,1)},this))},hideButtonsOnMobile:function(){this.utils.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&t.each(this.opts.buttonsHideOnMobile,t.proxy(function(t,e){var i=this.opts.buttons.indexOf(e);this.opts.buttons.splice(i,1)},this))},observeScroll:function(){var e=t(this.opts.toolbarFixedTarget).scrollTop(),i=1;this.opts.toolbarFixedTarget===document&&(i=this.$box.offset().top),e>i?this.toolbar.observeScrollEnable(e,i):this.toolbar.observeScrollDisable()},observeScrollEnable:function(t,e){var i=this.opts.toolbarFixedTopOffset+t-e,n=0,o=e+this.$box.height()-32,r=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:r,top:i+"px",left:n}),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",t<o?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var e=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,i="fixed";this.opts.toolbarFixedTarget!==document&&(e=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,i="absolute"),t(".redactor-dropdown-"+this.uuid).each(function(){t(this).css({position:i,top:e+"px"})})},unsetDropdownsFixed:function(){var e=this.$toolbar.innerHeight()+this.$toolbar.offset().top;t(".redactor-dropdown-"+this.uuid).each(function(){t(this).css({position:"absolute",top:e+"px"})})}}},upload:function(){return{init:function(e,i,n){this.upload.direct=!1,this.upload.callback=n,this.upload.url=i,this.upload.$el=t(e),this.upload.$droparea=t('<div id="redactor-droparea" />'),this.upload.$placeholdler=t('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=t('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",t.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",t.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",t.proxy(function(t){t=t.originalEvent||t,this.upload.traverseFile(this.upload.$input[0].files[0],t)},this)),this.upload.$droparea.on("drop.redactor.upload",t.proxy(function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(t)},this))},directUpload:function(t,e){this.upload.direct=!0,this.upload.traverseFile(t,e)},onDrop:function(t){t=t.originalEvent||t;var e=t.dataTransfer.files;this.upload.traverseFile(e[0],t)},traverseFile:function(t,e){if(this.opts.s3)return this.upload.setConfig(t),void this.upload.s3uploadFile(t);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(t);var n="image"==this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(n,t)}this.progress.show(),this.core.setCallback("uploadStart",e,i),this.upload.sendData(i,e)},setConfig:function(t){this.upload.getType(t),this.upload.direct&&(this.upload.url="image"==this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"==this.upload.type?this.image.insert:this.file.insert)},getType:function(t){this.upload.type="image",this.opts.imageTypes.indexOf(t.type)==-1&&(this.upload.type="file")},getHiddenFields:function(e,i){return e===!1||"object"!=typeof e?i:(t.each(e,t.proxy(function(e,n){null!==n&&0===n.toString().indexOf("#")&&(n=t(n).val()),i.append(e,n)},this)),i)},sendData:function(e,i){"image"==this.upload.type?(e=this.upload.getHiddenFields(this.opts.uploadImageFields,e),e=this.upload.getHiddenFields(this.upload.imageFields,e)):(e=this.upload.getHiddenFields(this.opts.uploadFileFields,e),e=this.upload.getHiddenFields(this.upload.fileFields,e));var n=new XMLHttpRequest;n.open("POST",this.upload.url),n.onreadystatechange=t.proxy(function(){if(4==n.readyState){var e=n.responseText;e=e.replace(/^\[/,""),e=e.replace(/\]$/,"");var o;try{o="string"==typeof e?t.parseJSON(e):e}catch(t){o={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(o,this.upload.direct,i)}},this),n.send(e)},onDrag:function(t){t.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(t,e){this.upload.imageFields[t]=e},removeImageFields:function(t){delete this.upload.imageFields[t]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(t,e){this.upload.fileFields[t]=e},removeFileFields:function(t){delete this.upload.fileFields[t]},s3uploadFile:function(e){this.upload.s3executeOnSignedUrl(e,t.proxy(function(t){this.upload.s3uploadToS3(e,t)},this))},s3executeOnSignedUrl:function(t,e){var i=new XMLHttpRequest,n="?";"-1"!=this.opts.s3.search(/\?/)&&(n="&"),i.open("GET",this.opts.s3+n+"name="+t.name+"&type="+t.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var o=this;i.onreadystatechange=function(t){4==this.readyState&&200==this.status?(o.progress.show(),e(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},i.send()},s3createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=null,i},s3uploadToS3:function(e,i){var n=this.upload.s3createCORSRequest("PUT",i);n&&(n.onload=t.proxy(function(){if(200==n.status){this.progress.hide();var t=i.split("?");if(!t[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var e={filelink:t[0]};if("file"==this.upload.type){var o=t[0].split("/");e.filename=o[o.length-1]}this.upload.callback(e,this.upload.direct,!1)}},this),n.onerror=function(){},n.upload.onprogress=function(t){},n.setRequestHeader("Content-Type",e.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(e))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isEmpty:function(e,i){return e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),e=e.replace(/&nbsp;/gi,""),e=e.replace(/<\/?br\s?\/?>/g,""),e=e.replace(/\s/g,""),e=e.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),e=e.replace(/<iframe(.*?[^>])>$/i,"iframe"),e=e.replace(/<source(.*?[^>])>$/i,"source"),i!==!1&&(e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),e=t.trim(e),""===e},normalize:function(t){return"undefined"==typeof t?0:parseInt(t.replace("px",""),10)},hexToRgb:function(t){if("undefined"!=typeof t){if(t.search(/^#/)==-1)return t;var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,function(t,e,i,n){return e+e+i+i+n+n});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return"rgb("+parseInt(i[1],16)+", "+parseInt(i[2],16)+", "+parseInt(i[3],16)+")"}},getOuterHtml:function(e){return t("<div>").append(t(e).eq(0).clone()).html()},getAlignmentElement:function(e){return t.inArray(e.tagName,this.opts.alignmentTags)!==-1?t(e):t(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(e,i){var n=t(e);return"undefined"==typeof n.attr(i)||""===n.attr(i)&&(n.removeAttr(i),!0)},removeEmpty:function(e,i){var n=t(i);if(n.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===n.find("hr, br, img, iframe, source").length){var o=t.trim(n.text());this.utils.isEmpty(o,!1)&&n.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=t(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=t(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){"undefined"==typeof this.saveScroll&&"undefined"==typeof this.saveBodyScroll||(t(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&t(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var t=document.createElement("span");return t.className="redactor-invisible-space",t.innerHTML=this.opts.invisibleSpace,t},removeInlineTags:function(e){var i=this.opts.inlineTags;i.push("span"),"PRE"==e.tagName&&i.push("a"),t(e).find(i.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(e,i){var n=this;return t(e).replaceWith(function(){return i===!0&&n.utils.removeInlineTags(this),t(this).contents()}),t(e)},replaceToTag:function(e,i,n){var o,r=this;return t(e).replaceWith(function(){o=t("<"+i+" />").append(t(this).contents());for(var e=0;e<this.attributes.length;e++)o.attr(this.attributes[e].name,this.attributes[e].value);return n===!0&&r.utils.removeInlineTags(o),o}),o},isStartOfElement:function(){var t=this.selection.getBlock();if(!t)return!1;var e=this.caret.getOffsetOfElement(t);return 0===e},isEndOfElement:function(e){if("undefined"==typeof e){var e=this.selection.getBlock();if(!e)return!1}var i=this.caret.getOffsetOfElement(e),n=t.trim(t(e).text()).replace(/\n\r\n/g,"");return i==n.length},isEndOfEditor:function(){var e=this.$editor[0],i=this.caret.getOffsetOfElement(e),n=t.trim(t(e).html().replace(/(<([^>]+)>)/gi,""));return i==n.length},isBlock:function(t){return t=t[0]||t,t&&this.utils.isBlockTag(t.tagName)},isBlockTag:function(t){return"undefined"!=typeof t&&this.reIsBlock.test(t)},isTag:function(e,i){var n=t(e).closest(i);return 1==n.length&&n[0]},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(e){return!!e&&(0!==t(e).parents(".redactor-editor").length&&!t(e).hasClass("redactor-editor")&&e)},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var i=this.selection.getParent(),n=this.selection.getCurrent();if(t.isArray(e)){var o=0;return t.each(e,t.proxy(function(t,e){this.utils.isCurrentOrParentOne(n,i,e)&&o++},this)),0!==o}return this.utils.isCurrentOrParentOne(n,i,e)},isCurrentOrParentOne:function(t,e,i){return i=i.toUpperCase(),e&&e.tagName===i?e:!(!t||t.tagName!==i)&&t},isOldIe:function(){return!!(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9)},isLessIe10:function(){return!!(this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10)},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(t){var e=navigator.userAgent.toLowerCase(),i=/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"safari"==t?"undefined"!=typeof i[3]&&"safari"==i[3]:"version"==t?i[2]:"webkit"==t?"chrome"==i[1]||"opr"==i[1]||"webkit"==i[1]:"rv"==i[1]?"msie"==t:"opr"==i[1]?"webkit"==t:t==i[1]}}}},t(window).on("load.tools.redactor",function(){t('[data-tools="redactor"]').redactor();
}),e.prototype.init.prototype=e.prototype,t.Redactor.fn.formatLinkify=function(e,i,r,s,a,l){for(var p="((?:http[s]?:\\/\\/(?:www\\.)?|www\\.){1}(?:[0-9A-Za-z\\-%_]+\\.)+[a-zA-Z]{2,}(?::[0-9]+)?(?:(?:/[0-9A-Za-z\\-#\\.%+_]*)+)?(?:\\?(?:[0-9A-Za-z\\-\\.%_]+(?:=[0-9A-Za-z\\-\\.%_\\+]*)?)?(?:&(?:[0-9A-Za-z\\-\\.%_]+(?:=[0-9A-Za-z\\-\\.%_\\+]*)?)?)*)?(?:#[0-9A-Za-z\\-\\.%_\\+=\\?&;]*)?)",d=new RegExp(p,"gi"),c=/(https?|ftp):\/\//i,u=new RegExp("(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*\\.(?:jpg|gif|png))(?:\\?([^#]*))?(?:#(.*))?","gi"),h=(this.$editor?this.$editor[0]:this).childNodes,f=h.length;f--;){var _=h[f];if(3===_.nodeType&&"PRE"!==_.parentNode){var g=_.nodeValue;if(a&&g){var m='<iframe width="500" height="281" src="',v='" frameborder="0" allowfullscreen></iframe>';g.match(n)?(g=g.replace(n,m+"//www.youtube.com/embed/$1"+v),t(_).after(g).remove()):g.match(o)&&(g=g.replace(o,m+"//player.vimeo.com/video/$2"+v),t(_).after(g).remove())}if(s&&g&&g.match(u)){var b=g.match(u);return g=g.replace(u,'<img src="'+b+'" />'),void t(_).after(g).remove()}g.search(/\$/g)!=-1&&(g=g.replace(/\$/g,"&#36;"));var b=g.match(d);if(r&&g&&b){for(var y=b.length,w=0;w<y;w++){null!==b[w].match(/\.$/)&&(b[w]=b[w].replace(/\.$/,""));var k=b[w],$=k,x="";null!==k.match(/\s$/)&&(x=" ");var U=e+"://";null!==k.match(c)&&(U=""),$.length>l&&($=$.substring(0,l)+"..."),$=$.replace(/&#36;/g,"$").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");var E=[],S=g.match("<a(.*?)</a>");if(null!==S){var y=S.length;for(f=0;f<y;f++)E[f]=S[f],g=g.replace(S[f],"{abuffer"+f+"}")}g=g.replace(k,'<a href="'+U+t.trim(k)+'">'+t.trim($)+"</a>"+x),t.each(E,function(t,e){g=g.replace("{abuffer"+t+"}",e)})}t(_).after(g).remove()}}else 1!==_.nodeType||/^(pre|a|button|textarea)$/i.test(_.tagName)||t.Redactor.fn.formatLinkify.call(_,e,i,r,s,a,l)}}}(jQuery),define("redactor",function(){}),define("text!scripts/redactor/ueditor-templates.html",[],function(){return'<div>\n<!--\n\tWrap everything in a div to convert this file\'s content in a jquery element\n\tso it is possible to use $.find.\n-->\n\n<script type="text/template" id="link-tpl">\n\t<input type="hidden" id="ueditor-link" value="{{url}}">\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="ueditor-link" value="external" class="upfront-field-radio"  {{link == \'external\' ? \'checked="checked"\' : \'\'}} id="ueditor-link-external">\n\t\t<label for="ueditor-link-external">External URL</label>\n\t\t<input type="text" value="{{url}}" id="ueditor-link-url" placeholder="Type link URL" style="{{link != \'external\' ? \'display:none\' : \'\'}}" class="upfront-field-text ueditor-link-hidden">\n\t</div>\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="ueditor-link" value="post" class="upfront-field-radio" {{link == \'post\' ? \'checked="checked"\' : \'\'}} id="ueditor-link-post">\n\t\t<label for="ueditor-link-post">Post or page</label>\n\t\t<a title="Change link" href="#" class="ueditor-change-link-post ueditor-link-hidden" style="{{link != \'post\' ? \'display:none\' : \'\'}}">{{url}}</a>\n\t</div>\n\n\t{[if(anchors.length > 1) { ]}\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="ueditor-link" value="anchor" class="upfront-field-radio" {{link == \'anchor\' ? \'checked="checked"\' : \'\'}} id="ueditor-link-anchor">\n\t\t<label for="ueditor-link-anchor">Anchor</label>\n\t\t<div class="ueditor-anchor ueditor-link-hidden" style="{{link != \'anchor\' ? \'display:none\' : \'\'}}">\n\t\t\t<select class="ueditor-anchor-selector">\n\t\t\t{[ _.each(anchors, function(anchor){ ]}\n\t\t\t\t<option value="#{{ anchor }}" {{ url == \'#\' + anchor ? \'selected="selected"\' : \'\' }}>{{anchor}}</option>\n\t\t\t{[ }); ]}\n\t\t\t</select>\n\t\t</div>\n\t</div>\n\t{[ } ]}\n\n\t{[if(url) { ]}\n\t<div class="upfront-field-wrap">\n\t\t<a href="#" class="ueditor-unlink">Unlink</a>\n\t</div>\n\t{[ } ]}\n</script>\n\n<script type="text/template" id="post-image-insert-tpl">\n    <div data-variant="{{variant_id}}" class="ueditor-insert ueditor-insert-variant-group {{style.label_id}} ueditor-insert-float-{{style.group.float}} {{style.group.width_cls}}" style="float:{{style.group.float}}; {[if( style.group.marginRight > 0 ){]}margin-right:{{style.group.marginRight}}px;{[ } ]} {[if( style.group.marginLeft > 0 ) {]}margin-left:{{style.group.marginLeft}}px;{[ } ]} {[if( style.group.maxWidth ) {]}max-width:{{style.group.maxWidth}};{[ } ]}" >\n        {[if( style.caption.order == 0 && show_caption) {]}\n            <div class="upfront-wrapper wp-caption-text {{style.caption.width_cls}}" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n        <div class="upfront-wrapper uinsert-image-wrapper {{style.image.width_cls}} {[ if(!isLocal){ ]}uinsert-image-external{[ } ]}" style="min-height: {{style.image.height}}px;">{[if(linkType != "do_nothing"){ ]}<a href="{{linkUrl}}">{[ } ]}<img class="" data-url="{imageFull.src}"  src="{{image.src}}" {[if(!isLocal){ ]}style="top: {{ externalImage.top }}px; left: {{ externalImage.left }}px; width: {{ externalImage.width }}px; height: {{ externalImage.height }}px"{[ } ]}/>{[if(linkType != "do_nothing"){ ]}</a>{[ } ]}</div>\n            {[if( style.caption.order == 1 && show_caption) {]}\n                <div class="upfront-wrapper wp-caption-text {{style.caption.width_cls}}" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n            {[ } ]}\n        <div style="clear:both;"></div>\n\n    </div>\n    <div class="post-images-shortcode" contenteditable="false"></div>\n</script>\n\n<script type="text/template" id="post-image-insert-shortcode-tpl">\n    [caption id="{{id}}"  uf_variant="{{variant_id}}" uf_show_caption="{{show_caption}}" ]\n        {[if(linkType != "do_nothing"){ ]}<a href="{{linkUrl}}">{[ } ]}\n        <img width="{{image.width}}"   src="{{image.src}}"/>\n        {[if(linkType != "do_nothing"){ ]}</a>{[ } ]}\n\n\t\t{{ caption }}\n    [/caption]\n</script>\n<script type="text/template" id="post-image-insert-wp-tpl">\n    <div id="attachment_{{attachment_id}}" style="width: {{style.wrapper.width}}px" class="wp-caption {{style.wrapper.alignment}}">\n        {[ if(link_url){ ]}<a href="{{link_url}}"> {[ } ]}\n            <img src="{{image.src}}" {[ if( image.width ){  ]} width="{{image.width}}" {[ } ]}  class="{{style.image.size_class}} wp-image-{{attachment_id}}" >\n        {[ if(link_url){ ]} </a> {[ } ]}\n        {[ if(style.caption.show){ ]}\n\t\t\t<div class="upfront-wrapper wp-caption-text {{style.caption.width_cls}}" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n\t\t<div style="clear:both;"></div>\n    </div>\n    <div class="post-images-shortcode-wp" contenteditable="false"></div>\n</script>\n<script type="text/template" id="post-image-insert-shortcode-wp-tpl">\n   [caption id="attachment_{{attachment_id}}" align="{{style.wrapper.alignment}}" width="{{style.wrapper.width}}" show_caption="{{style.caption.show}}" ]\n        {[ if(link_url){ ]}<a href="{{link_url}}"> {[ } ]}\n            <img  src="{{image.src}}"  width="{{image.width}}" height="{{image.height}}"  class="{{style.image.size_class}}  wp-image-{{attachment_id}}">\n       {[ if(link_url){ ]} </a> {[ } ]}\n        {{caption}}\n   [/caption]\n</script>\n<script type="text/template" id="image-insert-tpl">\n    <div data-variant="{{variant_id}}" class="ueditor-insert ueditor-insert-variant-group {{style.label_id}} ueditor-insert-float-{{style.group.float}} {{style.group.width_cls}} {{style.group.left_cls}}" style="min-height: {{style.group.height}}px;float:{{style.group.float}}; {[if( style.group.marginRight > 0 ){]}margin-right:{{style.group.marginRight}}px;{[ } ]} {[if( style.group.marginLeft > 0 ) {]}margin-left:{{style.group.marginLeft}}px;{[ } ]}" >\n        {[if( style.caption.order == 0 && show_caption) {]}\n        <div class="upfront-wrapper wp-caption-text c24" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n        <div class="upfront-wrapper uinsert-image-wrapper {{style.image.width_cls}} {{style.image.left_cls}} {{style.image.top_cls}} {[ if(!isLocal){ ]}uinsert-image-external{[ } ]}" style="min-height: {{style.image.height}}px;">{[if(linkType != "do_nothing"){ ]}<a href="{{linkUrl}}">{[ } ]}<img class="" src="{{image.src}}" {[if(!isLocal){ ]}style="top: {{ externalImage.top }}px; left: {{ externalImage.left }}px; width: {{ externalImage.width }}px; height: {{ externalImage.height }}px"{[ } ]}/>{[if(linkType != "do_nothing"){ ]}</a>{[ } ]}</div>\n      \n        {[if( style.caption.order == 1 && show_caption) {]}\n        <div class="upfront-wrapper wp-caption-text c24" style="min-height:{{style.caption.height}}px">{{ caption }}</div>\n        {[ } ]}\n        <div style="clear:both;"></div>\n\n    </div>\n</script>\n<script type="text/template" id="image-link-tpl">\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="uinsert-image-link" value="do_nothing" class="upfront-field-radio" id="uinsert-image-link-1" {{linkType == \'do_nothing\' ? checked : \'\'}}>\n\t\t<label for="uinsert-image-link-1">No link</label>\n\t</div>\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="uinsert-image-link" value="external" class="upfront-field-radio" id="uinsert-image-link-2" {{linkType == \'external\' ? checked : \'\'}}>\n\t\t<label for="uinsert-image-link-2">External link</label>\n\t\t<input type="text" value="{{linkUrl}}" id="uinsert-image-link-url" placeholder="Type link URL" style="{{linkType != \'external\' ? \'display:none\' : \'\'}}" class="upfront-field-text">\n\t</div>\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="uinsert-image-link" value="post" class="upfront-field-radio" id="uinsert-image-link-3" {{linkType == \'post\' ? checked : \'\'}}>\n\t\t<label for="uinsert-image-link-3">Link to a post or page</label>\n\t\t<a title="Change link" class="uinsert-change-link-post" style="{{linkType != \'post\' ? \'display:none\' : \'\'}}">{{linkUrl}}</a>\n\t</div>\n\t<div class="upfront-field-wrap">\n\t\t<input type="radio" name="uinsert-image-link" value="show_larger_image" class="upfront-field-radio" id="uinsert-image-link-4" {{linkType == \'show_larger_image\' ? checked : \'\'}}>\n\t\t<label for="uinsert-image-link-4">Show larger image</label>\n\t</div>\n</script>\n<script type="text/template" id="embed-insert-tpl">\n    <div class="inserted_code_rendered">{{code}}</div>\n</script>\n<script type="text/template" id="embed-insert-form-tpl">\n    <div class="upfront-field-embed_code-wrap">\n        <h3>Type or paste the embed code</h3>\n        <textarea name="upfront-field-embed_code" class="upfront-field-embed_code" id="upfront-field-embed_code" cols="30" rows="5">{{code}}</textarea>\n    </div>\n</script>\n<script type="text/template" id="font-icons">\n    <div class="icons">\n        {[ _.each(icons, function(icon){  ]}\n        <a href="javascript:void(0);" class="redactor_btn ueditor-font-icon"><span class="uf_font_icon">{{icon}}</span></a>\n        {[ }); ]}\n    </div>\n    <ul class="upfront-font-icons-controlls">\n        <li>\n            <label>\n                Size:\n            </label>   \n            <input class="upfront-field-number font-icons-size"  type="number" value="27" step="1" min="16" max="200">\n        </li>\n        <li class="font-icons-top-li">\n            <label>\n                Top:\n            </label>  \n            <input class="upfront-field-number font-icons-top"  type="number" value="0" step="1" min="-35" max="45">\n        </li>\n    </ul>\n</script>\n\n<script type="text/template" id="insert-manager-tpl">\n    <div class="ueditor-post-insert-manager">\n        <div class="upfront-image-attachment-bits upfront-post-media-trigger"></div>\n    </div>\n</script>\n\n<script type="text/template" id="insert-manager-tooltip-tpl">\n    <div class="upfront-image-attachment-bits upfront-post-media-trigger"></div>\n    <div class="uinsert-selector upfront-ui">\n    {[ _.each(inserts, function(insert, type){  ]}\n        <a href="#" class="uinsert-selector-option uinsert-selector-{{type}}" data-insert="{{type}}"><span class="uinsert-text">{{names[type]}}</span><span  data-insert="{{type}}" class="uinsert-text-overlay"></span></a>\n    {[ }); ]}\n    </div>\n</script>\n\n<script type="text/template" id="image-style-tpl">\n    {[ _.each(data.variants, function(variant, index){  ]}\n    <div class="upfront-field-wrap">\n        <input type="radio" name="uinsert-image-style-variant" value="{{variant.vid}}" {{data.selected == variant.vid ? "checked=\'checked\'" : ""}} class="upfront-field-radio" id="uinsert-image-variant-{{variant.vid}}">\n        <label for="uinsert-image-variant-{{variant.vid}}">{{variant.label}}</label>\n    </div>\n    {[ }); ]}\n</script>\n\n<script type="text/template" id="wp-image-style-tpl">\n    {[ _.each(data.variants, function(variant, index){  ]}\n        <i class="upfront-icon upfront-icon-wp-image-style  {{variant.icon}} {[ if( data.selected == variant.id ) { ]} upfront-icon-wp-image-style-selected {[ } ]}" data-id="{{variant.id}}" title="{{variant.label}}"></i>\n    {[ }); ]}\n</script>\n<script type="text/template" id="upfront-formatting">\n    <ul class="upfront-redactor-tag-list">\n        <li class="tag-list-section-title">\n            {{standard_formatting}}\n        </li>\n        <li>\n            <p  data-tag="p" class="tag-list-tag-p tag-list-tag">{{paragraph}}</p>\n        </li>\n        <li>\n            <h1  data-tag="h1" class="tag-list-tag-h1 tag-list-tag">{{heading_01}}</h1>\n        </li>\n        <li>\n            <h2 data-tag="h2" class="tag-list-tag-h2 tag-list-tag">{{heading_02}}</h2>\n        </li>\n        <li>\n            <h3  data-tag="h3" class="tag-list-tag-h3 tag-list-tag">{{heading_03}}</h3>\n        </li>\n        <li>\n            <h4 data-tag="h4" class="tag-list-tag-h4 tag-list-tag">{{heading_04}}</h4>\n        </li>\n        <li>\n            <h5 data-tag="h5" class="tag-list-tag-h5 tag-list-tag">{{heading_05}}</h5>\n        </li>\n        <li>\n            <h6 data-tag="h6" class="tag-list-tag-h6 tag-list-tag">{{heading_06}}</h6>\n        </li>\n\n        <li>\n            <pre data-tag="pre" class="tag-list-tag-pre tag-list-tag">{{preformatted}}</pre>\n        </li>\n        <li>\n            <blockquote data-tag="blockquote" class="tag-list-tag-blockquote tag-list-tag">{{blockquote}}</blockquote>\n        </li>\n        <!--<li>-->\n            <!--<a href="#" data-tag="blockquote">"</a>-->\n        <!--</li>-->\n    </ul>\n    <!--<select name="ufront-formatting-custom-class" class="upfront-field-select ufront-formatting-custom-class">-->\n        <!--{[ _.each(custom_classes, function(custom_class, index){  ]}-->\n            <!--<option value="{{custom_class}}">{{custom_class}}</option>-->\n        <!--{[ }); ]}-->\n    <!--</select>-->\n</script>\n</div>'}),function(t){define("scripts/redactor/ueditor-insert",["text!scripts/redactor/ueditor-templates.html"],function(e){var i=Backbone.View.extend({shortcodeName:"ueditor-insert",attributes:{contenteditable:"false"},defaultData:{},resizable:!1,initialize:function(t){t=t||{};var e=t.data||{};e.id||(e.id=this.generate_new_id(),Upfront.Events.trigger("content:insertcount:updated")),this.el.id=e.id,this.data=new Backbone.Model(e),this.listenTo(this.data,"change add remove reset",this.render),this.createControls(),"function"==typeof this.init&&this.init(t)},generate_new_id:function(){return"uinsert-"+ ++Upfront.data.ueditor.insertCount},start:function(){var e=t.Deferred();return e.resolve(),e.promise()},getOutput:function(){var t=this.data.toJSON(),e='[ueditor-insert type="'+this.type+'"';return _.each(t,function(t,i){e+=" "+i+'="'+t+'"'}),e+"]"},importInserts:function(e){var i=this,n=new RegExp("(["+this.shortcodeName.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")+"[^]]*?])","ig"),o=e.html(),r=t("<div></div>");o=o.replace(n,'<p class="ueditor-insert">$1</p>');var s=r.html(o).find("p.ueditor-insert");s.each(function(){var t=i.parseShortcode(this.innerHTML);t.type&&insertObjects[t.type]})},parseShortcode:function(e){var i,n=/\[([^\s\]]+)([^\]]*?)\]/i,o=/(\w+)\s*=\s*"([^"]*)"(?:\s|$)|(\w+)\s*=\s*\'([^\']*)\'(?:\s|$)|(\w+)\s*=\s*([^\s\'"]+)(?:\s|$)|"([^"]*)"(?:\s|$)|(\S+)(?:\s|$)/gi,r=e.match(n),s={};if(!r)return!1;if(s.shortcodeName=r[1],i=t.trim(r[2])){var a=i.match(o);a&&_.each(a,function(e){e=t.trim(e);var i=e.split("=");if(1==i.length)s[e]=e;else{var n=t.trim(i[0]),o=t.trim(i.slice(1).join("="));('"'==o[0]&&'"'==o[o.length-1]||"'"==o[0]&&"'"==o[o.length-1])&&(o=o.slice(1,-1)),s[n]=o}})}return s},createControls:function(){var t=this,e=Upfront.Views.Editor.InlinePanels;if(this.controls&&(this.controls.remove(),this.controls=!1),this.controlsData){this.controls=e.ControlPanel.extend({position_v:"top"}),this.controls=new this.controls;var i=[];_.each(this.controlsData,function(n){var o;if("simple"==n.type)o=t.createSimpleControl(n),t.controls.listenTo(o,"click",function(){t.controls.trigger("control:click",o),t.controls.trigger("control:click:"+o.id,o)});else if("multi"==n.type){if(o=new e.TooltipControl,o.selected=n.selected,n.subItems){var r={};_.each(n.subItems,function(e){r[e.id]=t.createSimpleControl(e)}),o.sub_items=r}t.controls.listenTo(o,"select",function(e){t.controls.trigger("control:select:"+o.id,e)})}else"dialog"==n.type&&(o=new e.DialogControl,o.view=n.view,t.controls.listenTo(o,"panel:ok",function(e){t.controls.trigger("control:ok:"+o.id,e,o)}),t.controls.listenTo(o,"panel:open",function(){t.controls.$el.addClass("uinsert-control-visible"),t.$el.addClass("nosortable")}),t.controls.listenTo(o,"panel:close",function(){t.controls.$el.removeClass("uinsert-control-visible"),t.$el.removeClass("nosortable")}));o&&(_.extend(o,n),i.push(o))}),this.controls.items=_(i),this.controls.render(),"function"==typeof this.controlEvents&&this.controlEvents(),this.controls.delegateEvents()}},createSimpleControl:function(t){var e=new Upfront.Views.Editor.InlinePanels.Control;return e.icon=t.icon,e.tooltip=t.tooltip,e.id=t.id,e.label=t.label,e},getAligmnentControlData:function(t){var e={left:{id:"left",icon:"alignleft",tooltip:"Align left"},right:{id:"right",icon:"alignright",tooltip:"Align right"},center:{id:"center",icon:"aligncenter",tooltip:"Align center"},full:{id:"full",icon:"alignfull",tooltip:"Full width"}},i={id:"alignment",type:"multi",icon:"alignment",tooltip:"Alignment",subItems:[]};return _.each(t,function(t){e[t]&&i.subItems.push(e[t])}),i},getRemoveControlData:function(){return{id:"remove",type:"simple",icon:"remove",tooltip:"Delete"}},resizableInsert:function(){if(this.resizable){var t=this.data.get("align"),e=!0,i=!0,n=".upfront-icon-control-resize-se",o={},r=Upfront.Behaviors.GridEditor;this.$el.hasClass("ui-resizable")&&this.$el.resizable("destroy"),"left"==t?e=!1:"right"==t&&(i=!1,n=".upfront-icon-control-resize-sw"),this.$(n).length||(i&&(this.$el.append('<span class="upfront-icon-control upfront-icon-control-resize-se upfront-resize-handle-se ui-resizable-handle ui-resizable-se nosortable" style="display: inline;"></span>'),o.se=".upfront-icon-control-resize-se"),e&&(this.$el.append('<span class="upfront-icon-control upfront-icon-control-resize-sw upfront-resize-handle-sw ui-resizable-handle ui-resizable-sw nosortable" style="display: inline;"></span>'),o.sw=".upfront-icon-control-resize-sw"));var s=this.getResizableOptions?this.getResizableOptions():{};s.handles=o,s.grid=[r.col_size,r.baseline],this.$el.resizable(s)}}});return{UeditorInsert:i}})}(jQuery),define("text!elements/upfront-image/tpl/video_editor.html",[],function(){return'<div>\r\n<!--\r\n\tWrap everything in a div to convert this file\'s content in a jquery element\r\n\tso it is possible to use $.find.\r\n-->\r\n\r\n<script type="text/template" id="selector-tpl">\r\n\t<div id="upront-image-placeholder" class="upfront-image-section">\r\n\t\t<div class="upfront-image-selector-container">\r\n\r\n\t\t\t<h2>{{ l10n.drop_files }}</h2>\r\n\t\t\t<p>{{ l10n.max_file_size }}</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a class="select-files" href="#">{{ l10n.select_files }}</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<!-- {{ l10n.or_browse }} -->\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a class="open-media-gallery" href="#">{{ l10n.media_gallery }}</a>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t\t<!-- <span class="dragimagehand"></span> -->\r\n\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="progress-tpl">\r\n\t<div id="upfront-image-uploading" class="upfront-image-section">\r\n\t\t<h2>{{ l10n.uploading }}</h2>\r\n\t\t<div class="upfront-progress-container">\r\n\t\t\t<div id="upfront-progress"></div>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n<script type="text/template" id="editor-tpl">\r\n\t<div id="uimage-cover" style="position:absolute; top:{{maskOffset.top}}px; left:{{maskOffset.left}}px; height: {{maskSize.height}}px; width: {{maskSize.width}}px"></div>\r\n\t<div id="uimage-canvas" style="position:absolute; overflow:hidden; top:{{offset.top}}px; left:{{offset.left}}px; height: {{size.height}}px; width: {{size.width}}px">\r\n\t\t<img class="uimage-img {{ rotation }}" src="{{src}}" style="width:100%; height:100%; position:absolute">\r\n\t</div>\r\n\r\n\t<div id="uimage-mask" class="image-edit-mask" style="position:absolute; top:{{maskOffset.top}}px; left:{{maskOffset.left}}px; height: {{maskSize.height}}px; width: {{maskSize.width}}px"></div>\r\n\r\n\t<div id="uimage-drag-handle" style="width:{{size.width}}px; height:{{size.height}}px;position:absolute; top:{{offset.top}}px; left:{{offset.left}}px">\r\n\t\t<div class="image-edit-resize image-edit-control"><i class="ui-resizable-handle ui-resizable-handle-se"></i></div>\r\n\t\t<!-- <div class="image-edit-rotate image-edit-control"><i class=""></i></div> -->\r\n\t</div>\r\n\r\n\t<div id="image-edit-buttons" style="position: absolute; top:{{maskOffset.top}}px; left: {{maskOffset.left + maskSize.width + 5}}px;">\r\n\t\t{[ for (var i = 0; i < buttons.length; i++) { ]}\r\n\t\t<a class="image-edit-button" id="{{buttons[i].id}}" title="{{buttons[i].tooltip}}">{{buttons[i].text}}</a>\r\n\t\t{[ } ]}\r\n\t</div>\r\n\t<div id="image-edit-buttons-bottom" style="z-index: 11; position: absolute; top:{{maskSize.width < 200 ? maskOffset.top : maskOffset.top + maskSize.height + 5}}px; left:{{maskSize.width < 200 ? maskOffset.left - 205 : maskOffset.left}}px; width: 200px" class="{{maskSize.width < 200 ? \'image-edit-buttons-toleft\' : \'\' }}">\r\n\t\t<a class="image-edit-button" id="image-edit-button-swap" title="Use a different image">Change IMG</a>\r\n\t\t<a class="image-edit-button" id="image-edit-button-align" title="Align image" ></a>\r\n\t</div>\r\n</script>\r\n\r\n<script type="text/template" id="upload-form-tpl">\r\n<form id="upfront-upload-video" name="upfront-upload-video" enctype="multipart/form-data" method="post" action="{{url}}" data-url="{{url}}?action=upfront-media-upload">\r\n\t<input type="file" name="media" id="upfront-video-file-input" multiple >\r\n\t<input type="hidden" name="action" value="upfront-media-upload">\r\n\t<input type="submit" value="Upload">\r\n</form>\r\n</script>\r\n\r\n<script type="text/template" id="sizehint-tpl">\r\n\t<b>w:</b>{{width}}{[ if(width.toString().indexOf("%") === -1){ ]}px{[ } ]}\r\n\t<b>h:</b>{{height}}{[ if(height.toString().indexOf("%") === -1){ ]}px{[ } ]}\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="fullwidth-alert-tpl">\r\n\t<div class="uimage-fullwidth-alert">\r\n\t\t<p>{{ l10n.move_image_nag }}</p>\r\n\t\t<div class="clearfix">\r\n\t\t\t<div class="uimage-fullwidth-info uimage-fullwidth-info-1"></div>\r\n\t\t\t<div class="uimage-fullwidth-info uimage-fullwidth-info-2"></div>\r\n\t\t\t<div class="uimage-fullwidth-info uimage-fullwidth-info-3"></div>\r\n\t\t</div>\r\n\t\t<div style="margin-top:10px">\r\n\t\t\t<input class="upfront-field-checkbox" type="checkbox" id="uimage-fullwidth-noalert" value="1">\r\n\t\t\t<label for="uimage-fullwidth-noalert">{{ l10n.dont_show_again }}</label>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n</script>\r\n\r\n</div>\r\n'}),function(t){define("elements/upfront-image/js/video-selector",["text!elements/upfront-image/tpl/video_editor.html"],function(e){var i,n=Upfront.Settings.l10n.image_element,o=Backbone.View.extend({selectorTpl:_.template(t(e).find("#selector-tpl").html()),progressTpl:_.template(t(e).find("#progress-tpl").html()),formTpl:_.template(t(e).find("#upload-form-tpl").html()),defaultOptions:{multiple:!1,multiple_sizes:!0,preparingText:n.sel.preparing},options:{},initialize:function(){this.setup_upload_form()},setup_upload_form:function(){var e=this;if(0===t("#upfront-upload-video").length){t("body").append(e.formTpl({url:Upfront.Settings.ajax_url,l10n:n.template})),t("body").bind("keyup",function(t){27===t.keyCode&&e.closeOverlay()});var i=t("#upfront-progress"),o=t("#upfront-video-file-input"),r=t("#upfront-upload-video");r.fileupload&&r.fileupload({sequentialUploads:!0,formData:_.extend({action:"upfront-media-upload"},Upfront.Media.Ref),fileInput:null,paramName:"media[]"}).bind("fileuploadstart",function(){i.css("width","0")}).bind("fileuploadprogressall",function(t,e){var n=parseInt(e.loaded/e.total*100,10);i.css("width",n+"%")}).bind("fileuploaddone",function(o,s){var a=s.result;i.css("width","100%"),t("#upfront-image-uploading h2").html(n.sel.preparing),e.onFileUploadDone(a),r[0].reset()}).bind("fileuploadfail",function(t,i){var n=i.jqXHR.responseJSON.error;Upfront.Views.Editor.notify(n,"error"),e.openSelector(),r[0].reset()}),o.on("change",function(){this.files.length&&(XMLHttpRequest&&(new XMLHttpRequest).upload?e.uploadVideo(this.files):e.openProgress(function(){r.fileupload("add",{fileInput:o})}))})}},onFileUploadDone:function(e){var o=this;Upfront.Util.post({action:"upfront-media-video_info",video_id:e.data[0]}).done(function(n){var o=t("source",n.data.url).attr("src").split("?")[0];t("body").append('<video id="tempVideoForThumb" controls="controls" preload="none"></video>');var r=t("#tempVideoForThumb"),s=r[0],a=!1,l=function(){var t=o.split("/");t=t[t.length-1],t=t.split("."),t=t[0]+"-video-thumbnail.png",a=!0;var l=r.width(),p=r.height(),d=document.createElement("canvas"),c=Math.round(l/p*100)/100;d.width=l,d.height=p;var u=d.getContext("2d");u.drawImage(s,0,0,l,p);var h=d.toDataURL(),f={videoId:e.data[0],embed:n.data.url,width:l,height:p,aspect:c,base64image:h,thumbname:t,action:"upfront-save-video-info"};Upfront.Util.post(f).done(function(t){var o={id:e.data[0],embed:n.data.url,cover:t.data.thumburl,width:l,height:p,aspect:c};i.resolve(o),r.remove()})};s.addEventListener("canplay",function(){this.currentTime=0},!1),s.addEventListener("seeked",function(){a||l()},!1),s.src=o,s.load()}).error(function(){Upfront.Views.Editor.notify(n.sel.upload_error,"error"),o.openSelector()})},open:function(e){return i=t.Deferred(),_.isObject(e)||(e={}),this.options=_.extend({},this.defaultOptions,e),this.openSelector(),Upfront.Events.trigger("upfront:element:edit:start","media-upload"),i.promise()},openSelector:function(){var e=this;this.openOverlaySection(this.selectorTpl,{},function(){var i=t("#upfront-video-file-input");e.options.multiple===!0?(i.attr("multiple","multiple"),i.attr("name","media[]")):(i.attr("multiple",!1),i.removeAttr("multiple"),i.attr("name","media")),t("#upront-image-placeholder").on("dragenter",function(t){t.preventDefault(),t.stopPropagation()}).on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),t(this).css("border-color","#C3DCF1"),t(this).css("background","none")}).on("dragover",function(e){e.preventDefault(),e.stopPropagation(),t(this).css("border-color","#1fcd8f"),t(this).css("background","rgba(255,255,255,.1)"),t(this).find()}).on("drop",function(t){var i;t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer&&(i=t.originalEvent.dataTransfer.files,i.length&&e.uploadVideo(i))}),e.resizeOverlay()})},openProgress:function(t){var e=this;this.openOverlaySection(this.progressTpl,{},function(){e.resizeOverlay(),t()})},resizeOverlay:function(){var e=t("#upfront-image-overlay");if(e.length){var i=t("#upront-image-placeholder"),n=t("#upfront-image-uploading"),o={},r=t("#sidebar-ui").width(),s={left:r,width:t(window).width()-r,height:t(window).height()},a=s.height/2-220;a>0?(e.removeClass("small_placeholder"),a+="px"):(e.addClass("small_placeholder"),a=s.height/2-140+"px"),e.css(s),o={height:s.height-100,"padding-top":a},i.css(o),n.css(o)}},close:function(){this.closeOverlay()},cancelOverlay:function(t){t.target===t.currentTarget&&this.closeOverlay(t)},closeOverlay:function(){t("#upfront-image-overlay").off("click").fadeOut("fast",function(){t(this).remove(),t("#upfront-image-overlay").remove()}),t("html").css({overflow:this.bodyOverflow?this.bodyOverflow:"auto",height:"auto",width:"auto"}),t("body").removeClass("upfront-image-upload-open"),this.reopenSettings&&(t("#settings").fadeIn(),this.reopenSettings=!1),t(window).off("resize",this.resizeOverlay),Upfront.Events.trigger("upfront:element:edit:stop")},openOverlaySection:function(e,i,o){var r=this,s=t("#settings"),a=t("#upfront-image-overlay");return i.l10n=n.template,a.length?void t(".upfront-image-section").fadeOut("fast",function(){var n=t(e(i)).hide();a.append(n),n.fadeIn("fast"),t(this).remove(),o&&o(a)}):(this.bodyOverflow=t("html").css("overflow"),t("html").css({overflow:"hidden",width:t(window).width()+"px",height:t(window).height()+"px"}),a=t('<div id="upfront-image-overlay" class="upfront-ui"></div>').append(e(i)).hide(),t("body").append(a).addClass("upfront-image-upload-open"),this.setOverlayEvents(),a.fadeIn("fast"),this.resizeOverlay(),t(window).on("resize",function(t){t.target===window&&r.resizeOverlay()}),s.is(":visible")&&(s.fadeOut(),this.reopenSettings=!0),void(o&&o(a)))},setOverlayEvents:function(){var e=this;t("#upfront-image-overlay").on("click",function(t){e.cancelOverlay(t)}).on("click","a.select-files",function(t){e.openFileBrowser(t)}).on("click","a.open-media-gallery",function(t){e.openMediaGallery(t)})},openMediaGallery:function(e){var o=this,r={multiple_selection:this.options.multiple,multiple_sizes:this.options.multiple_sizes,media_type:["videos"]};e.preventDefault(),Upfront.Media.Manager.open(r).done(function(e,r){if(console.log("meida manager",r),r&&r.length>0){var s=r.at(0).get("ID");Upfront.Util.post({action:"upfront-get-video-info",video_id:s}).done(function(t){i.resolve(t.data.videoinfo)}).error(function(){Upfront.Views.Editor.notify(n.sel.upload_error,"error"),o.openSelector()}),o.openProgress(function(){t("#upfront-image-uploading h2").html(o.options.preparingText)})}})},openFileBrowser:function(e){e.preventDefault(),t("#upfront-video-file-input").click()},checkFileUpdate:function(){return!0},uploadVideo:function(e){var i=this;i.setup_upload_form(),this.openProgress(function(){t("#upfront-upload-video").fileupload("send",{files:e})})}});return o})}(jQuery),function(t){define("scripts/redactor/ueditor-video-insert",["scripts/redactor/ueditor-insert","elements/upfront-image/js/video-selector"],function(e,i){var n=(Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor,e.UeditorInsert.extend({type:"video",controlsOpen:!1,defaults:{mute:!1,controls:!0,loop:!1,autoplay:!1},events:{"click .video-insert-controls":"toggleVideoControls","click .swap-video-insert-button":"swapVideo","click .video-insert-toggle-mute":"toggleMute","click .video-insert-toggle-controls":"toggleControls","click .video-insert-toggle-loop":"toggleLoop","click .video-insert-toggle-autoplay":"toggleAutoplay"},getSimpleOutput:function(){var e=t(this.data.get("video_embed"));this.data.get("mute")===!0?e.attr("muted",!0):e.removeAttr("muted"),this.data.get("controls")===!0?e.attr("controls","controls"):e.removeAttr("controls"),this.data.get("autoplay")===!0?e.attr("data-autoplay-video",!0):e.removeAttr("data-autoplay-video"),this.data.get("loop")===!0?e.attr("loop",!0):e.removeAttr("loop");
var i=t('<div><div class="uinsert-video-insert">'+t("<div/>").append(e).html()+"</div></div>");return i.html()},getOutput:function(){return this.getSimpleOutput()},start:function(e){var i=new t.Deferred;return this.$editor=e.closest(".redactor-box"),this.data.set(this.defaults,{silent:!0}),this.selectVideo(i),i},swapVideo:function(){this.selectVideo()},selectVideo:function(t){var e=new i,n=this;Upfront.preventRedactorStopOnOutsideClick=!0,e.open({multiple_selection:!1}).done(function(i){e.close(),n.data.set({video_embed:n.getEmbedFromVideoData(i),id:i.id}),t&&t.resolve(n,i.embed),Upfront.preventRedactorStopOnOutsideClick=!1})},getEmbedFromVideoData:function(e){var i=parseInt(this.$editor.width(),10),n=t(e.embed).find("video").attr("preload","none").attr("width",i).attr("height",Math.round(i/e.aspect)).attr("data-cover-url",e.cover).attr("data-aspect",e.aspect).attr("controls","controls");return n},toggleVideoControls:function(e){!1!==t(e.target).hasClass("video-insert-controls")&&(this.controlsOpen=!this.controlsOpen,this.$el.find(".video-insert-controls-panel").toggle(),this.$el.find(".video-insert-controls").hasClass("video-insert-controls-expanded")?this.$el.find(".video-insert-controls").removeClass("video-insert-controls-expanded"):this.$el.find(".video-insert-controls").addClass("video-insert-controls-expanded"))},render:function(){this.$el.addClass("uinsert-video-insert");var e=t(this.data.get("video_embed"));this.data.get("mute")===!0?e.attr("muted",!0):e.removeAttr("muted"),this.data.get("controls")===!0?e.attr("controls","controls"):e.removeAttr("controls"),this.data.get("autoplay")===!0?e.attr("data-autoplay-video",!0):e.removeAttr("data-autoplay-video"),this.data.get("loop")===!0?e.attr("loop",!0):e.removeAttr("loop"),this.$el.html(e),e.css("background-image","url("+e.attr("data-cover-url")+")").css("background-size","cover"),this.$el.css("position","relative");var i=t('<div class="video-insert-controls"><div class="video-insert-controls-panel"><div class="image-crop-edit-button image-edit-col-full" title="Swap Video"><input type="button" class="swap-video-insert-button upfront-field upfront-field-button" value="Swap Video" placeholder="Swap Video"></div><div><span>Mute:</span><div class="upfront_toggle"><input '+(this.data.get("mute")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-mute"> <label class="upfront_toggle_label video-insert-toggle-mute"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div><div><span>Autoplay</span><div class="upfront_toggle"><input '+(this.data.get("autoplay")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-autoplay"> <label class="upfront_toggle_label video-insert-toggle-autoplay"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div><div><span>Loop</span><div class="upfront_toggle"><input '+(this.data.get("loop")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-loop"> <label class="upfront_toggle_label video-insert-toggle-loop"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div><div><span>Controls</span><div class="upfront_toggle"><input '+(this.data.get("controls")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-controls"> <label class="upfront_toggle_label video-insert-toggle-controls"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div></div></div>');this.$el.append(i),this.controlsOpen&&(this.$el.find(".video-insert-controls").addClass("video-insert-controls-expanded"),this.$el.find(".video-insert-controls-panel").toggle()),this.$el.parent().is("p")&&this.$el.unwrap()},toggleMute:function(){this.data.get("mute")===!0?(this.data.set("mute",!1),this.$el.find(".video-insert-toggle-checkbox-mute").removeAttr("checked")):(this.data.set("mute",!0),this.$el.find(".video-insert-toggle-checkbox-mute").attr("checked","checked"))},toggleLoop:function(){this.data.get("loop")===!0?(this.data.set("loop",!1),this.$el.find(".video-insert-toggle-checkbox-loop").removeAttr("checked")):(this.data.set("loop",!0),this.$el.find(".video-insert-toggle-checkbox-loop").attr("checked","checked"))},toggleAutoplay:function(){this.data.get("autoplay")===!0?(this.data.set("autoplay",!1),this.$el.find(".video-insert-toggle-checkbox-autoplay").removeAttr("checked")):(this.data.set("autoplay",!0),this.$el.find(".video-insert-toggle-checkbox-autoplay").attr("checked","checked"))},toggleControls:function(){this.data.get("controls")===!0?(this.data.set("controls",!1),this.$el.find(".video-insert-toggle-checkbox-controls").removeAttr("checked")):(this.data.set("controls",!0),this.$el.find(".video-insert-toggle-checkbox-controls").attr("checked","checked"))},importInserts:function(e,i){var o={};return e.find(".uinsert-video-insert").each(function(){var e,i=t(this),r=i.find("video"),s={};s.video_embed=t("<div/>").append(r).html(),s.controls=!!r.attr("controls"),s.autoplay=!!r.attr("data-autoplay-video"),s.loop=!!r.attr("loop"),s.mute=!!r.attr("muted"),e=new n({data:s}),o[e.data.id]=e,e.render(),i.replaceWith(e.$el)}),o}}));return{VideoInsert:n}})}(jQuery),function(t){define("scripts/redactor/ueditor-insert-utils",["text!scripts/redactor/ueditor-templates.html"],function(e){var i=Upfront.mainData.l10n.global.ueditor,n=_([{vid:"center",label:"Center"},{vid:"left",label:"Left"},{vid:"right",label:"Right"}]),o=Backbone.View.extend({tpl:_.template(t(e).find("#image-style-tpl").html()),initialize:function(t){this.data=new Backbone.Model,this.listenTo(this.data,"change",this.render),this.data.set("variants",n.toArray()),this.data.set("selected",t.get("variant_id")?t.get("variant_id"):"center")},events:{"change input[type=radio]":"update_data","click input[type=radio]":"on_click"},render:function(){return this.$el.html(this.tpl({data:this.data.toJSON()})),this},on_click:function(t){t.stopPropagation()},update_data:function(e){e.stopPropagation(),this.variant_id=t(e.target).val(),this._style=n.findWhere({vid:this.variant_id})}}),r=Backbone.View.extend({tpl:_.template(t(e).find("#image-link-tpl").html()),initialize:function(t){t.data&&(this.model=new Backbone.Model(t.data),this.listenTo(this.model,"change",this.render))},events:{"change input[type=radio]":"updateData"},render:function(){this.$el.width("200px");var t=this.model.toJSON();t.checked='checked="checked"',this.$el.html(this.tpl(t))},updateData:function(t){var e=this,i=this.$("input:checked").val(),n=this.$("#uinsert-image-link-url").val();if("post"==i){var o={postTypes:this.postTypes()};Upfront.Views.Editor.PostSelector.open(o).done(function(t){e.model.set({linkType:"post",linkUrl:t.get("permalink")})})}else this.model.set({linkType:i,linkUrl:n})},postTypes:function(){var t=[];return _.each(Upfront.data.ugallery.postTypes,function(e){"attachment"!=e.name&&t.push({name:e.name,label:e.label})}),t}}),s=Backbone.View.extend({initialize:function(t){this.data=new Backbone.Model,this.data.set("variants",Upfront.Content.ImageVariants.toJSON()),this.data.set("selected",t.get("variant_id"))},events:{},prepare_values:function(){var t=[];return _.each(this.data.get("variants"),function(e,i){t.push({value:e.vid,label:e.label})}),t},get_default_value:function(){return this.data.get("selected")},render:function(){var t=this,e=new Upfront.Views.Editor.Field.Select({className:"upfront-field-wrap upfront-field-wrap-image-style-variant",label:i.choose_image_insert,name:"uf_image_style_variants",default_value:this.get_default_value(),multiple:!1,values:this.prepare_values(),change:function(e){t._style=Upfront.Content.ImageVariants.findWhere({vid:e}),t.data.set("selected",e)}});return e.render(),this.$el.html(e.$el),this},on_click:function(t){t.stopPropagation()}}),a=Backbone.View.extend({className:"upfront-wp-image-style-variants",tpl:_.template(t(e).find("#wp-image-style-tpl").html()),events:{"click .upfront-icon-wp-image-style":"update_data"},get_alignments:function(){return[{id:"alignleft",label:i.align_left,icon:"upfront-icon-wp-image-style-alignleft"},{id:"aligncenter",label:i.align_center,icon:"upfront-icon-wp-image-style-aligncenter"},{id:"alignright",label:i.align_right,icon:"upfront-icon-wp-image-style-alignright"},{id:"alignnone",label:i.align_none,icon:"upfront-icon-wp-image-style-alignnone"}]},initialize:function(t){this.data=new Backbone.Model,this.data.set("variants",this.get_alignments()),this.listenTo(this.data,"change",this.render),this.data.set("selected",this.model.get("variant_id")||this.model.get("style").wrapper.alignment)},get_default_value:function(){return this.data.get("selected")},render:function(){return this.$el.html(this.tpl({data:this.data.toJSON()})),this},on_click:function(t){t.stopPropagation()},update_data:function(e){e.preventDefault();var i=t(e.target),n=i.data("id");this.data.set("selected",n),this.model.set("variant_id",n)}});return{LinkView:r,ImageStylesView:o,PostImageStylesView:s,WP_PostImageStylesView:a,BasicImageVariants:n}})}(jQuery),function(t){define("scripts/redactor/ueditor-image-insert-base",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-inserts","text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-insert-utils"],function(e,i,n,o){var r=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor,s=e.UeditorInsert.extend({$editor:!1,caption_active:!1,className:"ueditor-insert upfront-inserted_image-wrapper",tpl:_.template(t(n).find("#image-insert-tpl").html()),resizable:!1,defaultData:{insert_type:"image_insert",caption:"<p>Default caption</p>",show_caption:1,imageFull:{src:"",width:100,height:100},imageThumb:{src:"",width:100,height:100},selectedImage:{src:"",width:100,height:100},linkType:"do_nothing",linkUrl:"",isLocal:1,alignment:{vid:"center",label:"Center"},externalImage:{top:0,left:0,width:0,height:0},variant_id:"",style:{label_id:"",vid:"",caption:{order:1,height:50,width_cls:"",left_cls:"ml0",top_cls:"mt0",show:1},group:{float:"none",width_cls:"",left_cls:"ml0",height:0,marginRight:0,marginLeft:0},image:{width_cls:"",left_cls:"ml0",top_cls:"mt0",src:"",height:0}}},wp_defaults:{insert_type:"wp_default",attachment_id:"",caption:"<p>Default caption</p>",link_url:"",image:{src:"",url:"",width:0,height:0},style:{wrapper:{alignment:"alignnone",width:"310"},caption:{show:!0},image:{size_class:"size-medium"}}},events:{"click .ueditor-insert-remove":"click_remove","dragstart img":"on_image_dragstart"},is_post_image_insert:function(){return!this.is_image_insert()},is_image_insert:function(){return this.className.indexOf("basic-wrapper")!==-1},get_type:function(){return!(!this.$editor||!this.$editor.data("ueditor"))&&(_.contains(this.$editor.data("ueditor").options.inserts,"image")?i.NAMES.IMAGE:i.NAMES.POSTIMAGE)},get_caption_state:function(){return this.data.get("show_caption")?0:1},click_remove:function(t){t.preventDefault(),this.trigger("remove",this)},get_data_json:function(){return"function"==typeof this.prepare_data?this.prepare_data():this.data.toJSON()},make_caption_editable:function(){var e=this,i=this.data.get("style"),n=this.$(".wp-caption-text"),o=this.data.get("show_caption")||!1;return o===!1&&i.caption&&(o=i.caption.show),!!i&&void(i.caption&&o&&0!==this.$(".wp-caption-text").length&&(n.off("keyup").on("keyup",function(t){e.data.set("caption",this.innerHTML,{silent:!0}),e.data.trigger("update"),e.render_shortcode&&e.render_shortcode(e.get_data_json())}).ueditor({linebreaks:!1,autostart:!0,pastePlainText:!0,buttons:[],placeholder:e.defaultData.caption,inserts:[],focus:!1,paragraphize:!1}).attr("contenteditable",!1),this.caption_ueditor=n.data("ueditor"),this.caption_ueditor.redactor.events.on("ueditor:change",function(t){e.data.set("caption",e.caption_ueditor.$el.html(),{silent:!0}),e.data.trigger("update"),e.render_shortcode&&e.render_shortcode(e.get_data_json())}),this.caption_ueditor.redactor.events.on("ueditor:focus",function(t){if(t==e.caption_ueditor.redactor){var i=e.$el.closest(".redactor-editor"),o=i.data("ueditor"),r=!!o&&o.redactor;r&&(t.$element.is(n)?(i.attr("contenteditable",!1),n.attr("contenteditable",!0),e.caption_active=!0):(i.attr("contenteditable",!0),n.attr("contenteditable",!1),e.caption_active=!1),r.$editor.off("drop.redactor paste.redactor keydown.redactor keyup.redactor focus.redactor blur.redactor"),r.$textarea.on("keydown.redactor-textarea"))}}),this.caption_ueditor.redactor.events.on("ueditor:blur",function(t){if(t==e.caption_ueditor.redactor){var i=e.$el.closest(".redactor-editor"),o=i.data("ueditor"),r=!!o&&o.redactor;r&&(t.$element.is(n)?(i.attr("contenteditable",!0),n.attr("contenteditable",!1),e.caption_active=!1):(i.attr("contenteditable",!1),n.attr("contenteditable",!0),e.caption_active=!0),r.build.setEvents())}}),e.$el.on("hover, click",function(t){t.stopPropagation();var i=e.$editor.is(".redactor-editor")?e.$editor:e.$editor.find(".upfront-object-content");n.attr("contenteditable",!0),i.attr("contenteditable",!1),e.caption_active=!0}),this.$editor.on("mouseenter, click",function(i){var o=t(this).is(".redactor-editor")?t(this):t(this).find(".upfront-object-content");n.attr("contenteditable",!1),o.attr("contenteditable",!0),e.caption_active=!1})))},controlEvents:function(){this.stopListening(this.controls),this.listenTo(this.controls,"control:ok:link",function(t,e){var i=t.$("input[type=text]").val(),n=t.$("input[type=radio]:checked").val()||"do_nothing",o={};"external"!==n||i.match(/https?:\/\//)||i.match(/\/\/:/)||(i=i.match(/^www\./)||i.match(/\./)?"http://"+i:i),o={linkType:n,linkUrl:i},this.data.set(o),t.model.set(o),e.close()}),this.listenTo(this.controls,"control:click:toggle_caption",function(t){var e=1;this.data.get("show_caption")&&(e=0),this.data.set("show_caption",e)}),this.listenTo(this.controls,"control:click:change_image",this.change_image),"function"==typeof this.control_events&&this.control_events()},updateControlsPosition:function(){this.controls.$el.css({left:-1,top:(this.controls.$el.height()+1)*-1})},getSimpleOutput:function(){var e=this.el.cloneNode(!0),i=this.data.toJSON();return i.image=this.get_proper_image(),this.data.set("width",this.$el.width(),{silent:!0}),this.data.trigger("update"),i.isLocal=parseInt(i.isLocal,10),e.innerHTML=this.tpl(i),t(e).width(this.data.get("width")),t("<div>").html(e).html()},get_proper_image:function(){var t=this.data.toJSON(),e=t.imageFull,i=Upfront.Settings.LayoutEditor.Grid;return t.style=t.style||{image_col:0,group:"",image:"",caption:""},t.imageThumb&&t.style&&t.style.image&&t.style.image.col&&t.style.image.col*i.column_width<=t.imageThumb.width&&(e=t.imageThumb),e},getOutput:function(){var e=this.el.cloneNode(),i=this.data.toJSON();return i.image=this.get_proper_image(),!!i.image&&(this.data.set("width",this.$el.width(),{silent:!0}),this.data.trigger("update"),i.isLocal=parseInt(i.isLocal,10),e.innerHTML=this.tpl(i),t("<div>").html(e).html())},getImageData:function(t){if(!t)return!1;var e=t.at(0).toJSON(),i=this.getSelectedImage(e),n=this.is_wp?_.extend({},this.wp_defaults,{attachment_id:e.ID,caption:e.post_excerpt?e.post_excerpt:"",link_url:"",image:i,style:{caption:{show:!0},wrapper:{alignment:"alignnone",width:i.width},image:{size_class:"size-"+i.selected_size}}}):_.extend({},this.defaultData,{attachmentId:e.ID,title:e.post_tite,imageFull:e.image,imageThumb:this.getThumb(e.additional_sizes),selectedImage:_.isUndefined(e.selected_size)?e.image:_.filter(e.additional_sizes,function(t){var i=e.selected_size.toLowerCase().split("x"),n=i[0],o=i[1];return t.width==n&&t.height==o})[0],linkType:"do_nothing",linkUrl:"",align:"center"});return n},getThumb:function(t){var e={width:0};return _.each(t,function(t){t.width<=500&&t.width>e.width&&(e=t)}),e},getSelectedImage:function(t){if(t.image.selected_size="full","full"==t.selected_size)return t.image;var e=t.selected_size?t.selected_size.split("x"):[],i=["thumbnail","medium","large"];if(2!=e.length)return t.image;for(var n=0;n<t.additional_sizes.length;n++){var o=t.additional_sizes[n];if(o.selected_size=i[n],o.width==e[0]&&o.height==e[1])return o}return t.image},importInserts:function(e,i,n){var o=this,r={},s={};return remaining_images=e.find("img"),e.is(".wp-caption-text")||(this.$editor=e),o.importFromShortcode&&this.is_post_image_insert()&&(s=o.importFromShortcode(e,i,n)),this.is_post_image_insert()&&(remaining_images=e.find("img").filter(function(){return!t(this).closest(".ueditor-insert").length})),_.each(remaining_images,function(t){var e=!1;e=o.importFromImage(t),e&&(r[e.data.id]=e)}),_.extend(r,s)},importFromWrapper:function(t,e,i){var n=t.attr("id"),o=!1,r=ImageInsert;return _.contains(i,"postImage")&&(r=PostImageInsert),o=e[n]?new r({data:e[n]}):this.importFromImage(t.find("img")),o.render(),t.replaceWith(o.$el),o},getLinkView:function(){if(this.linkView)return this.linkView;var t=new o.LinkView({data:{linkType:this.data.get("linkType"),linkUrl:this.data.get("linkUrl")}});return this.linkView=t,t},getStyleView:function(){if(this.styleView)return this.styleView;var t=new o.PostImageStylesView(this.data);return this.styleView=t,t},calculateRealSize:function(t){var e=new Image;return e.src=t,{width:e.width,height:e.height}},generateThumbSrc:function(t,e){var i=this.data.get("imageFull").src,n=i.split("."),o=n.pop();return i=n.join(".")+"-"+t+"x"+e+"."+o},calculateImageResize:function(t,e){var i=e.width/e.height>t.width/t.height?"height":"width",n=e[i]/t[i],o={width:Math.round(e.width/n),height:Math.round(e.height/n)},r="width"==i;return o.top=r?-Math.round((o.height-t.height)/2):0,o.left=r?0:-Math.round((o.width-t.width)/2),o},render_shortcode:function(t){if(!this.is_image_insert()){t=t instanceof Backbone.Model?t.toJSON():t;var e=this.shortcode_tpl(t);e=e.replace(/\[caption[\s\S]+?\[\/caption\]/g,function(t){return t.replace(/<br([^>]*)>/g,"<wp-temp-br$1>").replace(/[\r\n\t]+/,"")}),e=e.replace(/\s*<div/g,"\n<div"),e=e.replace(/<\/div>\s*/g,"</div>\n"),e=e.replace(/\s*\[caption([^\[]+)\[\/caption\]\s*/gi,"\n\n[caption$1[/caption]\n\n"),e=e.replace(/caption\]\n\n+\[caption/g,"caption]\n\n[caption"),e=e.replace(/\s+/g," "),this.$shortcode_el.html(e)}},on_image_dragstart:function(t){t.preventDefault()},change_image:function(){var t=this;return Upfront.Media.Manager.open({multiple_selection:!1,insert_options:!1,button_text:r.change_image,hide_sizes:"image_insert"===this.data.get("insert_type")}).done(function(e,i){var n;_.isEmpty(i)||(t.start(i),t.$editor&&t.$editor.data("ueditor")&&(n=t.$editor.data("ueditor"),n.redactor.code.sync()))}),!1}});return{ImageInsertBase:s}})}(jQuery),function(t){define("scripts/redactor/ueditor-image-insert",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-insert-utils","scripts/redactor/ueditor-image-insert-base","text!scripts/redactor/ueditor-templates.html"],function(e,i,n,o){var r=n.ImageInsertBase.extend({className:"ueditor-insert upfront-inserted_image-wrapper upfront-inserted_image-basic-wrapper",create_controlls:function(t){this.controlsData=[{id:"link",type:"dialog",icon:"link",tooltip:"Link image",view:this.getLinkView()},{id:"toggle_caption",type:"simple",icon:"caption",tooltip:"Toggle Caption",active:_.bind(this.get_caption_state,this)}],this.allow_alignment(t)&&this.controlsData.unshift({id:"style",type:"dialog",icon:"style",tooltip:"Alignment",view:this.getStyleView()}),this.createControls()},start:function(t){var e=this,i=Upfront.Media.Manager.open({multiple_selection:!1});return i.done(function(i,n){var o=e.getImageData(n);o.id=e.data.id,e.data.clear({silent:!0}),o.style=e.defaultData.style,o.variant_id="basic-image",e.$editor=t.closest(".redactor-box"),e.data.set(o)}),i},render:function(){var e=_.extend({},this.defaultData,this.data.toJSON()),i=e.style,n=this.data.get("alignment");if(i){e.style.label_id="ueditor-image-style-center",n&&(e.style.label_id="ueditor-image-style-"+n.vid,e.style.group.float=n.vid),e.image=this.get_proper_image(),e.style.group.width_cls=this.get_group_width_cls(e.image),0==e.show_caption&&(e.style.image.width_cls=Upfront.Settings.LayoutEditor.Grid.class+24);var o=(this.$el.find(".ueditor-insert-variant-group"),Upfront.Behaviors.GridEditor),r=t(".upfront-content-marker-contents"),s=parseFloat(t(".upfront-content-marker-contents>*").css("padding-left"))/o.col_size,a=parseFloat(t(".upfront-content-marker-contents>*").css("padding-right"))/o.col_size,l=Upfront.Util.grid.width_to_col(r.width(),!0),p=l-s-a,d=t(".upfront-content-marker-contents>*").width()/p;s=s?parseInt(s):0,a=a?parseInt(a):0,i&&i.group&&i.group.float&&("left"==i.group.float&&s>0?(e.style.group.marginLeft=(s-Math.abs(i.group.margin_left))*d,e.style.group.marginRight=0):"right"==i.group.float&&a>0?(e.style.group.marginRight=(a-Math.abs(i.group.margin_right))*d,e.style.group.marginLeft=0):"none"==i.group.float&&s>0&&(e.style.group.marginLeft=(s-Math.abs(i.group.margin_left)+Math.abs(i.group.left))*d,e.style.group.marginRight=0)),this.$el.html(this.tpl(e)),this.create_controlls(e.style.group.width_cls),this.controls.render(),this.$(".ueditor-insert-variant-group").append(this.controls.$el),this.make_caption_editable(),this.updateControlsPosition(),this.$(".ueditor-insert-variant-group").append('<a href="#" contenteditable="false" class="upfront-icon-button upfront-icon-button-delete ueditor-insert-remove"></a>')}},allow_alignment:function(t){if("undefined"==typeof t)return!1;var e=parseInt(t.replace("c",""),10),i=Upfront.Util.grid.width_to_col(this.$editor.width());return e+2<=i},control_events:function(){this.listenTo(this.controls,"control:ok:style",function(t,e){t._style&&(this.data.set("variant_id",t.variant_id),this.data.set("alignment",t._style),t.data.set("selected",t.variant_id)),e.close()})},get_group_width_cls:function(t){var e=Upfront.Util.grid.width_to_col(t.width),i=Upfront.Util.grid.width_to_col(this.$editor.width());return e+1<=i?Upfront.Settings.LayoutEditor.Grid.class+e:Upfront.Settings.LayoutEditor.Grid.class+i},get_proper_image:function(){var t=this.data.toJSON(),e=t.imageFull;Upfront.Settings.LayoutEditor.Grid,Upfront.Util.grid.width_to_col(this.$editor.width());return _.isEmpty(t.selectedImage.src)?e:t.selectedImage},importFromImage:function(e){e=e instanceof jQuery?e:t(e);var n=_.extend({},this.defaultData),o={src:e.attr("src"),width:e.width(),height:e.height()},s=t("<a>").attr("href",o.src)[0],a=this.calculateRealSize(o.src),l=e.closest(".ueditor-insert-variant-group"),p=l.attr("class"),d=l.find(".wp-caption-text"),c=d.attr("class"),u=l.find(".uinsert-image-wrapper"),h=u.attr("class"),f=1;s.origin!=window.location.origin&&(n.isLocal=0),n.imageThumb=o,n.imageFull={width:a.width,height:a.height,src:o.src};var g=e.parent();g.is("a")&&(n.linkUrl=g.attr("href"),n.linkType="external");var m=e.attr("class");m?(m=m.match(/wp-image-(\d+)/),m?n.attachmentId=m[1]:n.attachmentId=!1):n.attachmentId=!1,n.title=e.attr("title"),_.isEmpty(d.text())||(n.caption=d.html()),f=d.prev(u).length?1:0,n.show_caption=d.length,l.length?(n.style={caption:{order:1,height:d.css("minHeight")?d.css("minHeight").replace("px",""):d.height(),width_cls:Upfront.Util.grid.derive_column_class(c),left_cls:Upfront.Util.grid.derive_marginleft_class(c),top_cls:Upfront.Util.grid.derive_margintop_class(c),show:d.length},group:{float:l.css("float"),width_cls:Upfront.Util.grid.derive_column_class(p),left_cls:Upfront.Util.grid.derive_marginleft_class(p),height:l&&l.css("minHeight")?l.css("minHeight").replace("px",""):o.height+d.height(),marginRight:0,marginLeft:0},image:{width_cls:Upfront.Util.grid.derive_column_class(h),left_cls:Upfront.Util.grid.derive_marginleft_class(h),top_cls:Upfront.Util.grid.derive_margintop_class(h),src:"",height:0}},n.variant_id=l.data("variant"),n.variant_id&&(n.alignment=i.BasicImageVariants.findWhere({vid:l.data("variant")}))):(n.alignment=i.BasicImageVariants.first(),n.variant_id=n.alignment.vid);var v=new r({data:n});v.render();var b=e.hasClass(".upfront-inserted_image-basic-wrapper")?e:e.closest(".upfront-inserted_image-basic-wrapper");return b.replaceWith(v.$el),v},getStyleView:function(){if(this.styleView)return this.styleView;var t=new i.ImageStylesView(this.data);return this.styleView=t,t}});return{ImageInsert:r}})}(jQuery),function(t){define("scripts/redactor/ueditor-image-insert-post",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-image-insert-base","text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-insert-utils"],function(e,i,n,o){var r=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor,s=i.ImageInsertBase.extend({className:"ueditor-insert upfront-inserted_image-wrapper ueditor-insert-variant ueditor-post-image-insert",tpl:_.template(t(n).find("#post-image-insert-tpl").html()),shortcode_tpl:_.template(t(n).find("#post-image-insert-shortcode-tpl").html().replace(/\s+/g," ")),init:function(t){if(this.$editor=t.$editor,this.controlsData=[{id:"style",type:"dialog",icon:"style",tooltip:r.style,view:this.getStyleView()},{id:"change_image",type:"simple",icon:"change_image",tooltip:r.change_image},{id:"link",type:"dialog",icon:"link",tooltip:r.link_image,view:this.getLinkView()},{id:"toggle_caption",type:"simple",icon:"caption",tooltip:r.toggle_caption,active:_.bind(this.get_caption_state,this)}],this.createControls(),t.start)return this.start(t.start)},start:function(t){var e=this.getImageData(t);return e.id=this.data.id,e.style=this.data.get("style")||Upfront.Content.ImageVariants.first().toJSON(),e.variant_id=e.style.vid,this.data.clear({silent:!0}),this.data.set(e,{silent:!0}),this.set_selected_style(),this.render(),this},set_selected_style:function(){_.findWhere(this.controlsData,{id:"style"}).view.data.set("selected",this.data.get("variant_id"))},render:function(){var t=this.prepare_data();this.$el.html(this.tpl(t)),this.$shortcode_el=this.$(".post-images-shortcode"),this.render_shortcode(t),this.createControls(),this.controls.render();var e=this.$(".ueditor-insert-variant-group");e.append(this.controls.$el),this.make_caption_editable(),this.updateControlsPosition(),e.append('<a href="#" contenteditable="false" class="upfront-icon-button upfront-icon-button-delete ueditor-insert-remove"></a>');var i;this.$editor&&this.$editor.data("ueditor")&&(i=this.$editor.data("ueditor"),i.redactor.code.sync())},prepare_data:function(){var e=_.extend({},this.defaultData,this.data.toJSON()),i=e.style;if(i){e.style.label_id=e.style.label&&""!==e.style.label.trim()?"ueditor-image-style-"+e.style.label.toLowerCase().trim().replace(" ","-"):e.style.vid,e.image=this.get_proper_image(),"show_larger_image"==e.linkType&&(e.linkUrl=e.image.src),0==e.show_caption?e.style.image.width_cls=Upfront.Settings.LayoutEditor.Grid.class+24:e.style.image.width_cls=Upfront.Settings.LayoutEditor.Grid.class+e.style.image.col;var n=(this.$el.find(".ueditor-insert-variant-group"),Upfront.Behaviors.GridEditor),o=t(".upfront-content-marker-contents"),r=parseFloat(t(".upfront-content-marker-contents>*").css("padding-left"))/n.col_size,s=parseFloat(t(".upfront-content-marker-contents>*").css("padding-right"))/n.col_size,a=Upfront.Util.grid.width_to_col(o.width(),!0),l=a-r-s,p=t(".upfront-content-marker-contents>*").width()/l,d=this.$editor.closest(".upfront-object"),c=parseInt(d.css("padding-left"),10),u=parseInt(d.css("padding-right"),10),h=0,f=0,g=0,m=l;return this.$editor.hasClass("upfront-indented_content")&&(o=this.$editor,r=parseFloat(o.css("padding-left"))/n.col_size,s=parseFloat(o.css("padding-right"))/n.col_size,a=Upfront.Util.grid.width_to_col(o.outerWidth(),!0),l=a-r-s,p=n.col_size,this.$el.attr("style","margin-left: "+(r*p*-1-c)+"px; margin-right: "+(s*p*-1-u)+"px;")),m=l,r=r?parseInt(r,10):0,s=s?parseInt(s,10):0,i&&i.group&&i.group.float&&(h=parseInt(i.group.left,10),f=parseInt(i.group.margin_left,10),g=parseInt(i.group.margin_right,10),m=l-f-g,"left"==i.group.float?(e.style.group.marginLeft=(r-Math.abs(i.group.margin_left))*p,e.style.group.marginRight=0):"right"==i.group.float?(e.style.group.marginRight=(s-Math.abs(i.group.margin_right))*p,e.style.group.marginLeft=0):"none"==i.group.float&&(e.style.group.marginLeft=(r-Math.abs(i.group.margin_left)+Math.abs(i.group.left))*p,e.style.group.marginRight=0,m-=h),m=m>a?a:m,e.style.group.maxWidth=m/a*100+"%"),e}},control_events:function(){this.listenTo(this.controls,"control:ok:style",function(t,e){if(t._style){var i=t._style.toJSON();this.data.set("variant_id",i.vid),this.data.set("style",i),t.data.set("selected",i.vid)}e.close()})}}),a=i.ImageInsertBase.extend({className:"ueditor-insert upfront-inserted_image-wrapper upfront-wp-inserted_image-wrapper",tpl:_.template(t(n).find("#post-image-insert-wp-tpl").html()),shortcode_tpl:_.template(t(n).find("#post-image-insert-shortcode-wp-tpl").html()),generate_new_id:function(){return"wpinsert-"+ ++Upfront.data.ueditor.insertCount},init:function(t){if(this.$editor=t.$editor,t.start)return this.start(t.start)},prepare_controls:function(){this.controlsData=[{id:"wp_style",type:"dialog",icon:_.bind(this.get_style_icon,this),tooltip:"Style",view:this.getStyleView(),hideOkButton:!0},{id:"change_image",type:"simple",icon:"change_image",tooltip:r.change_image},{id:"link",type:"dialog",icon:"link",tooltip:"Link image",view:this.getLinkView()},{id:"toggle_caption",type:"simple",icon:"caption",tooltip:"Toggle Caption",active:_.bind(this.get_caption_state,this)}]},start:function(t){var e=this,i=e.getImageData(t);return i.id=e.data.id,i.variant_id=e.data.get("variant_id")||"alignnone",e.data.clear({silent:!0}),e.data.set(i,{silent:!0}),this.prepare_controls(),this.createControls(),this.render(),this},getImageData:function(t){if(!t)return!1;var e=t.at(0).toJSON(),i=this.getSelectedImage(e),n=_.extend({},this.wp_defaults,{attachment_id:e.ID,caption:e.post_excerpt?e.post_excerpt:this.wp_defaults.caption,link_url:"",image:i,style:{caption:{show:!0},wrapper:{alignment:"alignnone",width:i.width},image:{size_class:"size-"+i.selected_size}}});return n},render:function(){var e=this.data.toJSON();e.variant_id&&(e.style.wrapper.alignment=e.variant_id),this.$el.html(this.tpl(e)),this.$shortcode_el=this.$(".post-images-shortcode-wp"),this.render_shortcode(e),this.prepare_controls(),this.createControls(),this.controls.render();var i=this.$(".wp-caption");i.append(this.controls.$el),this.make_caption_editable(),this.updateControlsPosition(),i.append('<a href="#" contenteditable="false" class="upfront-icon-button upfront-icon-button-delete ueditor-insert-remove"></a>');var n;this.$editor&&this.$editor.data("ueditor")&&(n=this.$editor.data("ueditor"),n.redactor.code.sync());var o=this.caption_ueditor;void 0!==typeof o&&o&&void 0!==typeof o.redactor&&o.redactor.events.on("ueditor:change",function(e){o.$el.find("p").each(function(){var e=t(this);e.hasClass("wp-caption-text")||e.addClass("wp-caption-text")})})},getStyleView:function(){if(this.styleView)return this.styleView;var t=new o.WP_PostImageStylesView({model:this.data});return this.styleView=t,t},get_caption_state:function(){return this.data.get("style").caption.show?0:1},get_style_icon:function(){var t="wp-style";return this.data&&this.data.get("style")&&(t+=" "+this.data.get("style").wrapper.alignment),t},controlEvents:function(){this.listenTo(this.controls,"control:click:toggle_caption",function(t){var e=1,i=Upfront.Util.clone(this.data.toJSON().style);this.get_caption_state()||(e=0),i.caption.show=e,this.data.set("style",i)}),this.listenTo(this.controls,"control:ok:link",function(t,e){var i=t.$("input[type=radio]:checked").val()||"do_nothing",n="do_nothing"===i?"":t.$("input[type=text]").val();"show_larger_image"==i&&(n=this.data.get("image").src),this.data.set("link_url",n),e.close()}),this.listenTo(this.controls,"control:click:change_image",this.change_image)},get_url_type:function(t,e){var i="",n=document.createElement("a");return n.href=t,
n.origin!=window.location.origin&&(i="external"),n.origin==window.location.origin&&e!=t&&(i="post"),n.origin==window.location.origin&&e==t&&(i="show_larger_image"),i}});return{PostImageInsert:s,WP_PostImageInsert:a}})}(jQuery),function(t){define("scripts/redactor/ueditor-embed-insert",["scripts/redactor/ueditor-insert","text!scripts/redactor/ueditor-templates.html"],function(e,i){var n=e.UeditorInsert.extend({type:"embed",className:"ueditor-insert upfront-inserted_embed-wrapper uinsert-drag-handle",defaultData:{code:""},start:function(){var e=this,i=new o({code:this.data.get("code")}),n=new t.Deferred;return i.on("done",function(t){e.data.set({code:t}),i.remove(),n.resolve(this,t)}),i.on("render",function(t,n,o){e.trigger("manager:rendered",i,t,n,o)}),Upfront.Events.on("upfront:element:edit:stop",function(){i.remove(),n.resolve()}),this.get_manager=function(){return i},n},get_manager:function(){return{}},render:function(){var e=this,i=this.data.get("code"),n=t("<div />").append(i);this.$el.empty(),i&&(n.append('<div class="upfront-edit_insert">edit</div>'),this.$el.append(t("<div />").append(n).html()),this.$el.off("click",".upfront-edit_insert").on("click",".upfront-edit_insert",function(t){t.preventDefault(),t.stopPropagation(),e.start()}))},getOutput:function(){return this._get_output()},getSimpleOutput:function(){return this._get_output()},_get_output:function(){var e=this.data.get("code"),i=t("<div />").append('<div class="upfront-inserted_embed">'+e+"</div>");return e?i.html():""},importInserts:function(e,i){var o={};return e.find(".upfront-inserted_embed").each(function(){var e=t(this),i=new n({data:{code:e.html()}});o[i.data.id]=i,i.render(),e.replaceWith(i.$el)}),o}}),o=Backbone.View.extend({className:"upfront-inserts-markup-editor",initialize:function(t){var e=this,i=t&&t.code?t.code:"";require([Upfront.Settings.ace_url],function(){e.render(i)})},render:function(e){var i=new r.Main({code:e}),n=new r.Bar,o=new r.OK;i.render(),n.render(),o.render(),this.$el.empty().append(n.$el).append(o.$el).append(i.$el),t("body").append(this.$el),i.boot_editor(),this.$el.width(t(window).width()-t("#sidebar-ui").width()-1),n.on("insert",function(t){i.insert(t)}),this._main=i,o.on("done",this.done,this),this.trigger("render",i,n,o)},done:function(){if(!this._main||!this._main.get_value)return!1;var t=this._main.get_value();this.trigger("done",t)}}),r={l10n:Upfront.Settings.l10n.markup_embeds,OK:Backbone.View.extend({className:"upfront-inserts-markup-apply",events:{click:"propagate_apply"},propagate_apply:function(t){t.stopPropagation(),t.preventDefault(),this.trigger("done")},render:function(){this.$el.empty().append('<a href="#">'+r.l10n.done+"</a>")}}),Bar:Backbone.View.extend({className:"upfront-inserts-markup-bar",events:{click:"stop_prop","click .inserts-shortcode":"request_shortcode","click .inserts-image":"request_image"},stop_prop:function(t){t.stopPropagation()},render:function(){this.$el.empty().append('<ul><li><a href="#" class="inserts-shortcode">'+r.l10n.insert_shortcode+'</a></li><li><a href="#" class="inserts-image">'+r.l10n.insert_image+"</a></li></ul>")},request_shortcode:function(e){e.stopPropagation(),e.preventDefault();var i=this;Upfront.Popup.open(function(){var e=new r.ShortcodesList;e.render(),e.on("done",function(t){Upfront.Popup.close(t)}),t(this).empty().append(e.$el)},{},"embed-shortcode").done(function(t,e){e&&i.trigger("insert",e)})},request_image:function(t){t.stopPropagation(),t.preventDefault();var e=this;Upfront.Media.Manager.open({multiple_selection:!1,media_type:["images"],hold_editor:!0}).done(function(t,i){if(i){var n=i.models[0],o=n.get("image").src;o=o.replace(document.location.origin,""),e.trigger("insert",o)}})}}),Main:Backbone.View.extend({className:"upfront-embed_editor",events:{click:"stop_prop"},code:"",initialize:function(t){t&&t.code&&(this.code=t.code)},stop_prop:function(t){t.stopPropagation()},render:function(){this.$el.empty().append('<div class="upfront-inserts-markup active"><div class="upfront-inserts-ace"></div></div>').show()},boot_editor:function(){var t=this.$el,e=t.find(".upfront-inserts-ace"),i=(e.html(),ace.edit(e.get(0)));e.data("type");i.getSession().setUseWorker(!1),i.setTheme("ace/theme/monokai"),i.getSession().setMode("ace/mode/html"),i.setShowPrintMargin(!1),i.getSession().setValue(this.code),i.renderer.scrollBar.width=5,i.renderer.scroller.style.right="5px",e.height(t.height()),i.resize(),i.focus(),this.editor=i},insert:function(t){this.editor.insert(t)},get_value:function(){return this.editor.getValue()}}),ShortcodesList:Backbone.View.extend({events:{click:"stop_prop"},stop_prop:function(t){t.stopPropagation()},render:function(){var t=this;this.$el.empty().append(r.l10n.waiting),Upfront.Util.post({action:"upfront_list_shortcodes"}).done(function(e){t.$el.empty().append('<div class="shortcode-types" />').append('<div class="shortcode-list" />'),t.render_types(e.data),t.render_list()})},render_types:function(t){var e=this,i=[{label:r.l10n.select_area,value:0}],n=this.$el.find(".shortcode-types");_.each(_.keys(t),function(t){i.push({label:t,value:t})});var o=new Upfront.Views.Editor.Field.Select({label:"",name:"shortcode-selection",width:"100%",values:i,multiple:!1,change:function(){var i=this.get_value();return i in t&&void e.render_list(t[i])}});o.render(),n.empty().append(o.$el)},render_list:function(t){var e=this,i=this.$el.find(".shortcode-list");return i.empty(),!empty(t)&&void _.each(t,function(t){var t=new r.Shortcode({code:t});t.render(),t.on("done",function(t){e.trigger("done",t)}),i.append(t.$el)})}}),Shortcode:Backbone.View.extend({tagName:"pre",events:{click:"send_shortcode"},initialize:function(t){this.code=t.code},send_shortcode:function(t){return t.stopPropagation(),t.preventDefault(),!!this.code&&void this.trigger("done","["+this.code+"]")},render:function(){this.$el.empty().append("<code>["+this.code+"]</code>")}})};return{EmbedInsert:n}})}(jQuery),function(t){define("scripts/redactor/ueditor-post-image-insert-manager",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-image-insert-base","text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-image-insert-post"],function(e,i,n,o){var r=o.PostImageInsert,s=o.WP_PostImageInsert,a=i.ImageInsertBase.extend({start:function(e,i){var n=Upfront.Media.Manager.open({multiple_selection:!1,insert_options:!0}),o=t.Deferred();return n.done(function(t,e){var n;if(!_.isEmpty(e)){var a="wp_default"===e.at(0).get("insert_option");a?(n=new s({start:e,$editor:i}),o.resolve(n)):(n=new r({start:e,$editor:i}),o.resolve(n))}}),t.when(n,o.promise())},importFromShortcode:function(e,i){var n,o=this,r={};this.$editor=e;var s=wp.shortcode.replace("caption",e.html(),function(e){return e.parse_content=t.parseHTML(e.content),n=e.get("id").indexOf("uinsert-")!==-1?o.importFromShortcode_UF(e):o.importFromShortcode_WP(e),r[n.data.id]=n,n.el.outerHTML});return e.html(s),r},importFromShortcode_UF:function(e){var i=_.extend({},this.defaultData),n=this.calculateRealSize(i.imageThumb.src);t("<div>");i.imageThumb.src=this.get_shortcode_image_src(e.content),i.caption=this.get_shortcode_caption_text(e.parse_content),i=this.populate_link(e.content,i),i.imageFull={width:n.width,height:n.height,src:i.imageThumb.src},i.style=this._findVariant(e.get("uf_variant")).toJSON(),i.show_caption=parseInt(e.get("uf_show_caption"),10),i.style.caption.show=parseInt(e.get("uf_show_caption"),10),i.variant_id=i.style.vid;var o=new r({data:i,$editor:this.$editor});return o.render(),o},_findVariant:function(t){var e,i,n=Upfront.Content.ImageVariants.findWhere({vid:t});if(n)return n;if(e=Upfront.Content.PrevImageVariants.findWhere({vid:t})){if(e=e.toJSON(),n=Upfront.Content.ImageVariants.findWhere({label:e.label}))return n;if(n=Upfront.Content.ImageVariants.find(function(t){return t.get("group").float==e.group.float}))return n}if(i=Upfront.Content.OtherImageVariants.findWhere({vid:t})){if(i=i.toJSON(),n=Upfront.Content.ImageVariants.findWhere({label:i.label}))return n;if(n=Upfront.Content.ImageVariants.find(function(t){return t.get("group").float==i.group.float}))return n}return e&&(n=Upfront.Content.ImageVariants.find(function(t){return t.get("image").order==e.image.order}))?n:i&&(n=Upfront.Content.ImageVariants.find(function(t){return t.get("image").order==i.image.order}))?n:n=Upfront.Content.ImageVariants.first()},importFromShortcode_WP:function(e){var i=_.extend({},this.wp_defaults,{attachment_id:e.get("id").replace("attachment_",""),caption:this.get_shortcode_caption_text(t.parseHTML(e.content)),link_url:this.get_shortcode_url(e.content),image:{height:this.get_shortcode_content_image_height(e.content),width:e.get("width"),src:this.get_shortcode_image_src(e.content)},style:{caption:{show:parseInt(e.get("show_caption"),10)},wrapper:{alignment:e.get("align"),width:parseInt(e.get("width"),10)},image:{size_class:this.get_shortcode_content_image_size_class(e.content)}}}),n=new s({data:i,$editor:this.$editor});return n.render(),n},get_shortcode_image_src:function(e){return t("<div>").html(e).find("img").attr("src")},get_shortcode_caption_text:function(e){var i="",n=t("<div>");return _.each(e,function(e,o){t(e).is("img")||(i+=n.html(e).html())}),n.html(i).find("img").remove(),n.html()},get_shortcode_content_image_size_class:function(e){var i=/(?:^|\W)size-(\w+)(?!\w)/g,n=t("<div>").html(e).find("img"),o=!!n.length&&n.attr("class").match(i);return o?o[0]:""},get_shortcode_content_image_height:function(e){var i=t("<div>").html(e).find("img");return(i.length?i.attr("height"):"")||"auto"},populate_link:function(t,e){if(e.linkUrl=this.get_shortcode_url(t),!e.linkUrl)return e;var i=document.createElement("a");return i.href=e.linkUrl,i.origin!=window.location.origin&&(e.linkType="external"),i.origin==window.location.origin&&e.imageThumb.src!=e.linkUrl&&(e.linkType="post"),i.origin==window.location.origin&&e.imageThumb.src==e.linkUrl&&(e.linkType="show_larger_image"),e},get_shortcode_url:function(e){return t("<div>").html(e).find("a").attr("href")},get_image_size_class:function(t){var e=/(?:^|\W)size-(\w+)(?!\w)/g,i=!!t.className&&t.className.match(e);return i?i[0]:""},get_image_attachment_id:function(t){var e=/(?:^|\W)wp-image-(\w+)(?!\w)/g,i=!!t.className&&t.className.match(e);return i?i[0]:""},importFromImage:function(e){var i=t(e),n=_.extend({},this.wp_defaults,{attachment_id:this.get_image_attachment_id(e),caption:t.trim(i.attr("alt")),link_url:e.src,image:{height:parseInt(i.height(),10),width:parseInt(i.width(),10),src:e.src},style:{caption:{show:!1},wrapper:{alignment:"alignnone",width:parseInt(i.width(),10)},image:{size_class:this.get_image_size_class(e)}}}),o=new s({data:n,$editor:this.$editor});return o.render(),i.replaceWith(o.$el),o},importFromImage_prev:function(e){var i=_.extend({},this.defaultData),n={src:e.attr("src"),width:e.width(),height:e.height()},o=t("<a>").attr("href",n.src)[0],s=this.calculateRealSize(n.src),a=e.closest(".ueditor-insert-variant-group"),l=a.attr("class"),p=a.find(".wp-caption-text"),d=p.attr("class"),c=a.find(".uinsert-image-wrapper"),u=c.attr("class"),h=1;o.origin!=window.location.origin&&(i.isLocal=0),this.calculateRealSize(n.src),i.imageThumb=n,i.imageFull={width:s.width,height:s.height,src:n.src};var f=e.parent();f.is("a")&&(i.linkUrl=f.attr("href"),i.linkType="external");var g=e.attr("class");g?(g=g.match(/wp-image-(\d+)/),g?i.attachmentId=g[1]:i.attachmentId=!1):i.attachmentId=!1,i.title=e.attr("title"),_.isEmpty(p.text())||(i.caption=p.html()),h=p.prev(c).length?1:0,0===p.length&&(h=1),a.length?(i.style={caption:{order:h,height:p.css("minHeight")?p.css("minHeight").replace("px",""):p.height(),width_cls:Upfront.Util.grid.derive_column_class(d),left_cls:Upfront.Util.grid.derive_marginleft_class(d),top_cls:Upfront.Util.grid.derive_margintop_class(d),show:p.length},group:{float:a.css("float"),width_cls:Upfront.Util.grid.derive_column_class(l),left_cls:Upfront.Util.grid.derive_marginleft_class(l),height:a&&a.css("minHeight")?a.css("minHeight").replace("px",""):n.height+p.height(),marginRight:0,marginLeft:0},image:{width_cls:Upfront.Util.grid.derive_column_class(u),left_cls:Upfront.Util.grid.derive_marginleft_class(u),top_cls:Upfront.Util.grid.derive_margintop_class(u),src:"",height:0}},i.variant_id=a.data("variant")):(i.style=Upfront.Content.ImageVariants.first().toJSON(),i.variant_id=i.style.vid);var m=new r({data:i});return m.render(),e.replaceWith(m.$el),m}});return{PostImageInsert_Manager:a}})}(jQuery),function(t){define("scripts/redactor/ueditor-inserts",["scripts/redactor/ueditor-insert","scripts/redactor/ueditor-video-insert","scripts/redactor/ueditor-image-insert","scripts/redactor/ueditor-image-insert-post","scripts/redactor/ueditor-embed-insert","scripts/redactor/ueditor-post-image-insert-manager"],function(t,e,i,n,o,r){var s={IMAGE:"image",POSTIMAGE:"postImage",EMBED:"embed",VIDEO:"video"},a={},l={};return a[s.POSTIMAGE]=r.PostImageInsert_Manager,a[s.IMAGE]=i.ImageInsert,a[s.EMBED]=o.EmbedInsert,a[s.VIDEO]=e.VideoInsert,l[s.POSTIMAGE]="Image",l[s.IMAGE]="Image",l[s.EMBED]="Embed",l[s.VIDEO]="Video",{UeditorInsert:t.UeditorInsert,inserts:a,TYPES:s,NAMES:l}})}(jQuery),function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor;define("redactor_plugins",["text!scripts/redactor/ueditor-templates.html","scripts/upfront/link-model"],function(i,n){var o=_.extend({},Backbone.Events),r=Backbone.View.extend({initialize:function(t){var e=this;e.redactor=t.redactor,e.button=t.button,e.panel=t.panel,this.on("open",function(t){e.$el.trigger("open",t)}),this.on("closed",function(t){e.$el.trigger("closed",t)}),"function"==typeof this.init&&this.init(),this.render()},openToolbar:function(t){},closeToolbar:function(){this.redactor.$air.fadeOut(100),this.redactor.dropdown.hideAll(),this.$el.trigger("toolbarClosed",this.redactor)},closePanel:function(){this.panel.is(":visible")&&this.button.click()},disableEditorStop:function(){this.redactor.ueditor.disableStop=!0},enableEditorStop:function(){var t=this;setTimeout(function(){t.redactor.ueditor.disableStop=!1},300)},appendOkButton:function(e){var i=this;if(!i.$el.siblings(".ueditor-ok").length){e=e||Upfront.Settings.l10n.global.content.ok;var n=t('<a class="ueditor-ok">'+e+"</a>").on("click",function(t){i.$el.trigger("ok")});n.insertAfter(i.$el)}}});if(!s)var s={};return s.stateButtons=function(){return{init:function(){this.$toolbar&&(this.$air=this.$toolbar.closest(".redactor_air"),this.stateButtons.addStateButtons(),this.stateButtons.startStateObserver())},addStateButtons:function(){var e=this;t.each(this.opts.stateButtons,function(i,n){if(t.inArray(i,e.opts.airButtons)!==-1){var o=new e.stateButtons.StateButton(i,n),r=e.button.add(i,n.title);e.button.addCallback(r,function(){e.stateButtons.stateCallback(i,o)}),e.$air.on("show",function(){o.guessState(e)})}})},stateCallback:function(t,e){e.guessState(this),e.callback(t,this.button.get(t),e)},startStateObserver:function(){var e=t.proxy(this.stateObserver,this);this.$element.on("mouseup.redactor keyup.redactor",e)},stateObserver:function(){var e=this;t.each(this.stateButtons.stateButtons,function(t,i){i.guessState(e)}),e.waitForMouseUp=!1},StateButton:function(e,i){var n=this,o={},r=!1;return firstState=!1,n.id=e,n.currentState=i.defaultState,n.states=i.states,n.iconClasses="",n.defaultState=i.defaultState,t.each(n.states,function(t,e){r?o[r]=t:firstState=t,n.iconClasses+=" "+e.iconClass,r=t}),o[r]=firstState,n.nextStates=o,n.nextState=function(t){this.setState(n.nextStates[this.currentState],t)},n.setState=function(t,e){this.currentState=t,e.removeClass(this.iconClasses).addClass(this.states[this.currentState].iconClass)},n.triggerState=function(e,i,n,o){var r=t.proxy(this.states[this.currentState].callback,e);r(i,n,o)},n.guessState=function(e){var i=!1;t.each(this.states,function(t,n){i=n.isActive(e)?t:i}),i||(i=this.defaultState),this.setState(i,e.button.get(this.id))},n.getElement=function(t){return t.button.get(this.id)},{id:e,title:i.title,callback:function(t,e,i){i.nextState(e),i.triggerState(this,t,e,i)},nextState:t.proxy(n.nextState,n),setState:t.proxy(n.setState,n),triggerState:t.proxy(n.triggerState,n),guessState:t.proxy(n.guessState,n)}}}},s.stateAlignment=function(){return{align:function(e){t(this.selection.getBlock()).css("text-align",e),t(this.selection.getBlocks()).css("text-align",e),this.selection.restore(),this.code.sync()},init:function(){if(this.$toolbar){var i=this;this.opts.stateButtons.stateAlign={title:e.text_align,defaultState:"left",states:{left:{iconClass:"ueditor-left",isActive:function(e){var i=t(e.selection.getBlock());return i.length&&3==i[0].nodeType&&(i=i.parent()),i.length&&"left"==i.css("text-align")},callback:function(t,e,n){i.stateAlignment.align("left")}},center:{iconClass:"ueditor-center",isActive:function(e){var i=t(e.selection.getBlock());return i.length&&3==i[0].nodeType&&(i=i.parent()),i.length&&"center"==i.css("text-align")},callback:function(t,e,n){i.stateAlignment.align("center")}},right:{iconClass:"ueditor-right",isActive:function(e){var i=t(e.selection.getBlock());return i.length&&3==i[0].nodeType&&(i=i.parent()),i.length&&"right"==i.css("text-align")},callback:function(t,e,n){i.stateAlignment.align("right")}},justify:{iconClass:"ueditor-justify",isActive:function(e){var i=t(e.selection.getBlock());return i.length&&3==i[0].nodeType&&(i=i.parent()),i.length&&"justify"==i.css("text-align")},callback:function(t,e,n){i.stateAlignment.align("justify")}}}}}}}},s.stateAlignmentCTA={beforeInit:function(){if(this.$toolbar){var t=this;this.opts.stateButtons.stateAlignCTA={title:e.text_align,defaultState:"left",states:{left:{iconClass:"ueditor-left",isActive:function(e){return t.$element.length&&"left"==t.$element.css("text-align")},callback:function(e,i,n){t.$element.css("text-align","left")}},center:{iconClass:"ueditor-center",isActive:function(e){return t.$element.length&&"center"==t.$element.css("text-align")},callback:function(e,i,n){t.$element.css("text-align","center")}},right:{iconClass:"ueditor-right",isActive:function(e){return t.$element.length&&"right"==t.$element.css("text-align")},callback:function(e,i,n){t.$element.css("text-align","right")}},justify:{iconClass:"ueditor-justify",isActive:function(e){return t.$element.length&&"justify"==t.$element.css("text-align")},callback:function(e,i,n){t.$element.css("text-align","justify")}}}}}}},s.stateLists=function(){return{init:function(){var i=this;this.opts.stateButtons.stateLists={title:e.list_style,defaultState:"none",states:{none:{iconClass:"ueditor-nolist",isActive:function(e){var i=t(e.selection.getParent());return i.length&&"left"==i.css("text-align")},callback:function(t,e,n){i.list.toggle("orderedlist")}},unordered:{iconClass:"ueditor-unorderedlist",isActive:function(e){var i=t(e.selection.getParent());if(i.length){var n=i.closest("ul");if(n.length)return n.closest(".ueditable").length}return!1},callback:function(t,e,n){i.list.toggle("unorderedlist")}},ordered:{iconClass:"ueditor-orderedlist",isActive:function(e){var i=t(e.selection.getParent());if(i.length){var n=i.closest("ol");if(n.length)return n.closest(".ueditable").length}return!1},callback:function(t,e,n){i.list.toggle("orderedlist")}}}}}}},s.upfrontImages={beforeInit:function(){if(this.$toolbar){var e=this;e.events.on("ueditor:stop",function(){ImagesHelper.Image.unbind_events()}),e.events.on("ueditor:insert:media",function(){ImagesHelper.Gallery.to_html(e),ImagesHelper.Slider.to_html(e)}),ImagesHelper.Image.redactor=e,ImagesHelper.Image.create_dialog(),ImagesHelper.Image.bind_events(),Upfront.Media.Transformations.add(ImagesHelper.Image.cleanup),Upfront.Media.Transformations.add(ImagesHelper.Gallery.from_html),Upfront.Media.Transformations.add(ImagesHelper.Slider.from_html),Upfront.Events.on("upfront:editor:image_align",function(e,i){var n=!1;return"left"===i?n="margin-right":"right"===i&&(n="margin-left"),!!n&&void t(e).css(n,"15px")})}}},s.upfrontSink={beforeInit:function(){Upfront.data.ueditor||(Upfront.data.ueditor={sink:!1}),this.opts.buttonsCustom.upfrontSink={title:e.more_tools}},init:function(){if(this.$toolbar){var e=this,i=this.$toolbar.find(".redactor_btn_upfrontSink").parent().addClass("upfront-sink-button"),n=this.$toolbar.find(".upfront-sink-button ~ li"),o=t('<div class="ueditor-sink"></div>');i.on("click",function(){Upfront.data.ueditor.sink?e.closeSink():e.openSink()}),n.detach().appendTo(o),this.$toolbar.append(o),Upfront.data.ueditor.sink&&this.$toolbar.addClass("ueditor-sink-open"),n.each(function(){var i=t(this).find("a").attr("class").match(/redactor_btn_[^\s]*/g),n=!1,o=!1;i.length&&(n=i[0].replace("redactor_btn_","")),o=e.$toolbar.find(".redactor-dropdown-box-"+n),o.length&&o.css({"margin-top":"40px"})}),this.$air.on("show",function(){Upfront.data.ueditor.sink&&e.$air.css({top:e.$air.offset().top-40})})}},openSink:function(){Upfront.data.ueditor.sink=!0,this.$toolbar.addClass("ueditor-sink-open"),this.$air.css({top:this.$air.offset().top-40})},closeSink:function(){Upfront.data.ueditor.sink=!1,this.$toolbar.removeClass("ueditor-sink-open"),this.$air.css({top:this.$air.offset().top+40})}},s.upfrontPlaceholder=function(){return{init:function(){function e(){i.code.sync();var t=i.$editor.text().trim();""==t||"&nbsp;"==t?i.$placeholder.show():i.$placeholder.hide()}var i=this,n=this.placeholderText;if(this.$element.attr("placeholder")&&(n=this.$element.attr("placeholder")),""===n&&(n=!1),n!==!1){this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder"),this.$placeholder=this.$editor.clone(!1),this.$placeholder.attr("contenteditable",!1).removeClass("ueditable redactor_editor").addClass("ueditor-placeholder").html(n),this.$editor.after(this.$placeholder),"static"==this.$editor.css("position")&&this.$editor.css("position","relative"),this.$editor.css("z-index",1);var o=this.$editor.position();this.$placeholder.css({position:"absolute","z-index":"0",top:o.top,left:o.left,right:this.$box.outerWidth()-(o.left+this.$editor.outerWidth())}),this.opts.placeholder=n}var r=t.proxy(e,this);this.$editor.on("keyup",r),this.events.on("cleanUpListeners",function(){i.$editor.off("keyup",r),i.events.off("cleanUpListeners")}),e()}}},s.panelButtons=function(){return{init:function(){if(this.$toolbar){var e=this;t.each(this.opts.buttonsCustom,function(i,n){if(n.panel){var o=t('<div class="redactor-dropdown ueditor_panel redactor-dropdown-box-'+i+" redactor-dropdown-"+e.uuid+' " style="display: none;">'),r=e.button.get(i),s=_.isUndefined(n.first)?"add":"addFirst";if(n.panel=new n.panel({redactor:e,button:r,panel:o}),o.html(n.panel.$el),o.appendTo(e.$toolbar),n.dropdown=!0,r.on("click",function(){r.hasClass("dropact")?(e.selection.removeMarkers(),n.panel.trigger("open",e)):n.panel.trigger("closed",e)}),e.$editor.on("mouseup.redactor keyup.redactor",function(){r.hasClass("dropact")&&(e.dropdownHideAll(),n.panel.trigger("closed",e))}),o.on("click keydown keyup",function(t){t.stopPropagation()}),t.inArray(i,e.opts.airButtons)===-1)return;var a=e.button[s](i,n.title);e.button.addCallback(a,function(){var r=e.button.get(i),s=r.position().left;t(".re-icon").removeClass("redactor_act dropact"),r.addClass("redactor_act dropact"),t(".redactor-dropdown").not(o).hide(),o.css("left",s+"px").toggle(),o.is(":visible")&&"function"==typeof n.panel.open?n.panel.open.apply(n.panel,[jQuery.Event("open"),e]):"function"==typeof n.panel.close&&n.panel.close.apply(jQuery.Event("close"),[t.Event,e]);var a=t(".redactor-dropdown.ueditor_panel").last(),l=s-a.innerWidth()+r.width();a.css("left",l+"px")})}})}}}},s.upfrontIcons=function(){return{$sel:!1,init:function(){this.opts.buttonsCustom.upfrontIcons={title:e.icons,panel:this.upfrontIcons.panel},o.on("ueditor:key:down",function(e,i){(t(e.selection.getParent()).hasClass("uf_font_icon")||t(e.selection.getCurrent()).hasClass("uf_font_icon"))&&(i.keyCode<48||i.keyCode>90||i.preventDefault())})},panel:r.extend(_.extend({},Upfront.Views.Mixins.Upfront_Scroll_Mixin,{$sel:!1,tpl:_.template(t(i).find("#font-icons").html()),events:{"click .ueditor-font-icon":"insert_icon",open:"open",toolbarClosed:"close","change .upfront-font-icons-controlls input":"input_change","keydown .upfront-font-icons-controlls input":"input_key_down"},render:function(t){this.$el.html(this.tpl({icons:Upfront.mainData.font_icons})),this.stop_scroll_propagation(this.$el)},open:function(t,e){this.redactor=e,this.redactor.selection.restore(),this.redactor.buffer.set(),this.redactor.selection.save(),this.set_current_icon(),this.$el.parent().css({left:193})},close:function(){this.redactor&&(this.$sel=!1)},insert_icon:function(e){var i=t(t(e.target).hasClass("ueditor-font-icon")?t(e.target).html():t(e.target).closest(".ueditor-font-icon").html()),n=this.$(".font-icons-size").val(),o=this.$(".font-icons-top").val();i.css({"font-size":n+"px",top:o+"px"});var r=i[0].outerHTML;this.redactor.insert.execHtml(r),this.redactor.code.sync(),this.redactor.selection.restore(),this.closeToolbar()},input_change:function(e){var i=this.$sel;e.stopPropagation(),e.preventDefault();var n=t(e.target),o=n.val()+"px";n.hasClass("font-icons-size")&&i&&i.css("font-size",o),n.hasClass("font-icons-top")&&i&&i.css("top",o),this.redactor.code.sync()},input_key_down:function(t){13===t.which&&(t.preventDefault(),this.closePanel(),this.closeToolbar(),this.redactor.dropdown.hideAll())},set_current_icon:function(){var e=t(this.redactor.selection.getCurrent()).last();e.hasClass("uf_font_icon")||(e=t(this.redactor.selection.getInlines()).filter(".uf_font_icon").last()),e.hasClass("uf_font_icon")&&(this.$sel=e,this.$(".font-icons-size").val(parseFloat(e.css("font-size"))),this.$(".font-icons-top").val(parseFloat(e.css("top"))))}}))}},s.upfrontLink=function(){return{init:function(){this.opts.buttonsCustom.upfrontLink={title:e.link,panel:this.upfrontLink.panel}},openPanel:function(){var e=this.button.get("link").position().left;t(".redactor-dropdown-box-upfrontLink").css("left",e+"px").toggle()},panel:r.extend({tpl:_.template(t(i).find("#link-tpl").html()),events:{open:"open"},initialize:function(){r.prototype.initialize.apply(this,arguments)},open:function(e,i){this.redactor=i,i.selection.save();var o=this,r="",s="external",a="_self";this.selectedLink=i.utils.isCurrentOrParent("A"),this.selectedLink&&(r=t(this.selectedLink).attr("href"),a=t(this.selectedLink).attr("target"),s=_.isUndefined(t(this.selectedLink).attr("data-upfront-link-type"))?this.guessLinkType(r):t(this.selectedLink).attr("data-upfront-link-type")),this.linkModel=new n({type:s,url:r,target:a}),this.listenTo(this.linkModel,"change",function(t){o.redactor.buffer.set(),o.redactor.selection.save(),"unlink"===o.linkModel.get("type")?o.unlink():o.link(t)}),this.render()},render:function(){if("undefined"!=typeof this.linkModel){var e={},i=this;this.redactor.$element.hasClass("mfp-title")&&(e={anchor:!1,lightbox:!1},t(document).off("focusin")),this.linkPanel=new Upfront.Views.Editor.LinkPanel({model:this.linkModel,linkTypes:e,button:!0}),this.listenTo(this.linkPanel,"linkpanel:close",function(){t("a.re-upfrontLink").click().removeClass("dropact redactor_act");var e=i.redactor.caret.getOffset();i.redactor.selection.remove(),i.redactor.caret.setOffset(e)}),this.linkPanel.render(),this.$el.html(this.linkPanel.el),this.linkPanel.delegateEvents()}},close:function(t,e){e.selection.restore()},unlink:function(e){e&&e.preventDefault();var i=this.redactor.selection.getHtml();this.redactor.selection.restore(),""!==i&&t.parseHTML(i).length>1?this.redactor.insert.html(i,!0):this.redactor.link.unlink(),this.redactor.$element.focus(),this.updateMissingLightboxFlag()},link:function(e){var i;if("undefined"!=typeof this.linkModel.get("url")){if(this.selectedLink)t(this.selectedLink).attr("href",this.linkModel.get("url")).attr("target",this.linkModel.get("target"));else{var n=/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,o="\\$&",r=((Upfront.Settings||{}).Editor||{}).OPEN_TAG_RPL_MARK||"{{UPFRONT_OPEN_TAG_MARK}}",s=((Upfront.Settings||{}).Editor||{}).CLOSE_TAG_RPL_MARK||"{{UPFRONT_CLOSE_TAG_MARK}}",a=new RegExp(r.replace(n,o),"g"),l=new RegExp(s.replace(n,o),"g");i=this.redactor.selection.getHtml(),i=i.replace(/</g,r).replace(/>/g,s),this.redactor.selection.replaceWithHtml(i),this.redactor.link.set(i,this.linkModel.get("url"),this.linkModel.get("target")),this.selectedLink=this.redactor.utils.isCurrentOrParent("A"),i=this.redactor.selection.getHtml(),i=i.replace(a,"<").replace(l,">"),this.redactor.selection.replaceWithHtml(i),this.redactor.selection.save()}t(this.selectedLink).attr("data-upfront-link-type",this.linkModel.get("type")),this.redactor.$element.focus(),"undefined"==typeof e&&this.updateMissingLightboxFlag(),this.redactor.code.sync()}},bindEvents:function(){},guessLinkType:function(e){return t.trim(e)&&"#"!=t.trim(e)?e.length&&"#"==e[0]?e.indexOf("#ltb-")>-1?"lightbox":"anchor":e.substring(0,location.origin.length)==location.origin?"entry":e.match(/^mailto/)?"email":"external":"unlink"},updateMissingLightboxFlag:function(){var e=this.redactor.utils.isCurrentOrParent("A");e&&t(e).attr("href").indexOf("#ltb-")>-1&&(Upfront.Util.checkLightbox(t(e).attr("href"))?t(e).removeClass("missing-lightbox-warning"):t(e).addClass("missing-lightbox-warning"))}})}},s.upfrontColor=function(){return{init:function(){this.opts.buttonsCustom.upfrontColor={title:e.color,panel:this.upfrontColor.panel}},panel:r.extend({current_color:!1,current_bg:!1,events:{open:"open"},init:function(){this.listenTo(o,"ueditor:air:show",this.on_air_show);var t=this;this.listenTo(o,"cleanUpListeners",function(){t.stopListening()})},on_air_show:function(t){this.redactor.selection.save(),this.updateIcon()},close:function(t,e){e.selection.restore()},setCurrentColors:function(){var e=this.redactor.selection.getCurrent();if(e=t(e).prop("tagName")?e:t(e).parent(),e&&(["SPAN","DIV","INLINE"].indexOf(t(e).prop("tagName"))!==-1||t(e).hasClass(".upfront_theme_colors"))){var i=tinycolor(t(e).css("background-color"));this.current_color=t(e).css("color"),i.getAlpha()>0&&(this.current_bg=t(e).css("background-color"))}else this.current_color=this.current_bg=!1},open:function(e,i){this.updateIcon(),this.redactor.selection.save();var n=this,o=Upfront.Views.Theme_Colors.colors.pluck("color").length?Upfront.Views.Theme_Colors.colors.pluck("color"):[],r=new Upfront.Views.Editor.Field.Color({spectrum:{flat:!0,showAlpha:!0,appendTo:"parent",showPalette:!0,localStorageKey:"spectrum.recent_colors",palette:o,maxSelectionSize:10,preferredFormat:"hex",chooseText:Upfront.Settings.l10n.global.content.ok,showInput:!0,allowEmpty:!0,change:function(t){n.current_color=t},move:function(t){n.current_color=t}}}),s=new Upfront.Views.Editor.Field.Color({blank_alpha:0,spectrum:{flat:!0,showAlpha:!0,appendTo:"parent",showPalette:!0,palette:o,localStorageKey:"spectrum.recent_bgs",maxSelectionSize:10,preferredFormat:"hex",chooseText:Upfront.Settings.l10n.global.content.ok,showInput:!0,allowEmpty:!0,change:function(t){n.current_bg=t},move:function(t){n.current_bg=t}}});r.render(),this.$("#tabforeground-content").html(r.el),s.render(),this.$("#tabbackground-content").html(s.el);var a=this.$el.closest(".redactor-dropdown");if(a.removeClass("on-right-border"),t(window).width()<=this.$("#tabforeground-content").offset().left+this.$("#tabforeground-content").width()&&a.addClass("on-right-border"),this.current_color){var l=tinycolor(n.current_color);r.$(".upfront-field-color").spectrum("option","color",n.current_color),r.$(".upfront-field-color").spectrum("set",l),r.$(".sp-input").css({"border-left-color":n.current_color}),r.render_sidebar_rgba(l.toRgb()),r.update_input_val(l.toHexString())}else{var l=tinycolor("#000000");r.$(".upfront-field-color").spectrum("option","color","#000000"),r.$(".upfront-field-color").spectrum("set",l),s.$(".sp-input").css({"border-left-color":"#000000"}),r.render_sidebar_rgba(l.toRgb()),r.update_input_val(l.toHexString())}if(this.current_bg){var l=tinycolor(n.current_bg);
s.$(".upfront-field-color").spectrum("option","color",n.current_bg),s.$(".upfront-field-color").spectrum("set",l),s.$(".sp-input").css({"border-left-color":n.current_bg}),s.render_sidebar_rgba(l.toRgb()),s.update_input_val(l.toHexString())}else{var l=tinycolor("rgba(0, 0, 0, 0)");s.$(".upfront-field-color").spectrum("option","color","rgba(0, 0, 0, 0)"),s.$(".upfront-field-color").spectrum("set",l),s.$(".sp-input").css({"border-left-color":"rgba(0, 0, 0, 0)"}),s.render_sidebar_rgba(l.toRgb()),s.update_input_val(l.toHexString())}this.$(".sp-choose").on("click",function(t){t.preventDefault(),n.updateColors(),n.closePanel(),n.closeToolbar(),n.redactor.dropdown.hideAll()})},render:function(){var i=t('<li id="tabforeground" class="active">').html(e.text_color),n=t('<li id="tabbackground">').html(e.text_background),o=t('<ul class="tablist">').append(i).append(n),r=t('<ul class="tabs">').append(t('<li id="tabforeground-content" class="active">').html('<input class="foreground" type="text">')).append(t('<li id="tabbackground-content">').html('<input class="background" type="text">')),s=(this.redactor,this);o.children("li").on("click",function(e){e.preventDefault(),e.stopPropagation();var i=s.$el.find(".tablist li"),n=s.$el.find(".tabs"),o=t(this),r=n.children("li#"+o.attr("id")+"-content");i.removeClass("active"),o.addClass("active"),n.children("li").removeClass("active"),r.addClass("active"),r.find(".sp-container").removeClass("sp-hidden"),s.$("input.foreground").spectrum("option","color",(s.current_color&&"object"==typeof s.current_color?s.current_color.toRgbString():s.current_color)||""),s.$("input.background").spectrum("option","color",(s.current_bg&&"object"==typeof s.current_bg?s.current_bg.toRgbString():s.current_bg)||"")}),this.$el.html(o).append(r)},updateIcon:function(){var t=this;if(t.setCurrentColors(),t.current_bg){var e=tinycolor(t.current_bg);0===e.getAlpha()?this.redactor.$toolbar.find(".re-icon.re-upfrontColor").addClass("transparent").css("border-color",""):this.redactor.$toolbar.find(".re-icon.re-upfrontColor").removeClass("transparent").css("border-color",e.toRgbString())}else this.redactor.$toolbar.find(".re-icon.re-upfrontColor").addClass("transparent").css("border-color","");t.current_color?this.redactor.$toolbar.find(".re-icon.re-upfrontColor").css("color",t.current_color):this.redactor.$toolbar.find(".re-icon.re-upfrontColor").css("color","")},updateColors:function(){this.redactor.buffer.set(),this.redactor.selection.save();var e=Upfront.Views.Theme_Colors.colors.is_theme_color(this.current_color);e!==!1?(this.current_color.is_theme_color=!0,this.current_color.theme_color="#ufc"+e,this.current_color.theme_color_code=Upfront.Util.colors.convert_string_ufc_to_color(this.current_color.theme_color)):this.current_color.is_theme_color=!1,e=Upfront.Views.Theme_Colors.colors.is_theme_color(this.current_bg),e!==!1?(this.current_bg.is_theme_color=!0,this.current_bg.theme_color="#ufc"+e,this.current_bg.theme_color_code=Upfront.Util.colors.convert_string_ufc_to_color(this.current_bg.theme_color)):this.current_bg.is_theme_color=!1;var i=this,n=i.redactor.selection.getText(),o=!1,r=!1,s=function(e,n){var o=!1,r=!1,s=!!e.match(/background/);n.is_theme_color?(r=Upfront.Views.Theme_Colors.colors.get_css_class(n,s),r||(o=n.theme_color)):o=n.toRgbString();var a=document.createElement("span"),l=i.redactor.range.extractContents(),p=i.redactor.range,d=(!!p.commonAncestorContainer&&t(p.commonAncestorContainer),function(t){r?t.addClass(r):o&&t.attr("style",e+":"+o)});if(l.childNodes[0]&&i.redactor.utils.isBlock(l.childNodes[0])){for(;i.redactor.selection.getParent();)t(i.redactor.selection.getBlocks()).remove();var c=[];_.each(l.childNodes,function(t,e){var i=document.createElement("span"),n=t.childNodes[0];_.isUndefined(t)||(n&&n.tagName&&"span"===n.tagName.toLowerCase()&&(n.className.match(/upfront_theme_/)||n.style.cssText.match(/color/))?i.innerHTML=n.innerHTML:i.innerHTML=t.innerHTML,t.innerHTML="",t.appendChild(i),c.push({node:t,wrapper:i}))}),_.each(c.reverse(),function(e,n){var o=e.node,r=e.wrapper;i.redactor.range.insertNode(o);var s=t(r);d(s)})}else a.appendChild(l),i.redactor.range.insertNode(a),d(t(a));i.redactor.selection.restore(),i.redactor.code.sync()},a=function(t){};if(i.current_bg&&"object"==typeof i.current_bg){r=!0;Upfront.Views.Theme_Colors.colors.get_css_class(i.current_bg.toHexString(),!0);i.current_bg.reset===!0?i.reset_bg_color():s("background-color",i.current_bg)}if(i.current_color&&"object"==typeof i.current_color){o=!0;Upfront.Views.Theme_Colors.colors.get_css_class(i.current_color.toHexString());a("color"),i.current_color.reset===!0?this.reset_color():s("color",i.current_color)}if(o&&!r){var l=[];t(this.redactor.selection.getCurrent()).parents("[data-redactor-style^='color']").each(function(){var e=t(this);e.text()===i.redactor.selection.getText()&&l.push(this)});var n=this.redactor.selection.getCurrent(),p=t(_.last(l)),d=p.children("[data-redactor-style^='background-color'], [ style^='background-color']");if(d=0===d.length&&p.is("[data-redactor-style^='background-color'], [ style^='background-color']")?p:d,d.length>0){var c=t(_.first(d)).css("background-color");n=t(n).css({backgroundColor:c})}t(p).replaceWith(n)}if(r&&!o){var l=[];t(this.redactor.selection.getCurrent()).parents("[data-redactor-style^='background-color']").each(function(){var e=t(this);e.text()===i.redactor.selection.getText()&&l.push(this)});var n=this.redactor.selection.getCurrent(),p=t(_.last(l)),u=p.children("[data-redactor-style^='color'], [ style^='color']");if(u=0===u.length&&p.is("[data-redactor-style^='color'], [ style^='color']")?p:u,u.length>0){var h=t(_.first(d)).css("color");n=t(n).css({color:h})}t(p).replaceWith(n)}if(r&&o){var l=[];t(this.redactor.selection.getCurrent()).parents("[data-redactor-style^='color'], [data-redactor-style^='background-color']").each(function(){var e=t(this);e.text()===i.redactor.selection.getText()&&l.push(this)}),t(_.last(l)).replaceWith(t(this.redactor.selection.getCurrent()).css({backgroundColor:i.current_bg.is_theme_color?i.current_bg.theme_color_code:i.current_bg.toHexString()}))}i.updateIcon()},reset_bg_color:function(){this.redactor.inline.removeFormat("backgroundColor")},reset_color:function(){this.redactor.selection.removeMarkers();var e=this.redactor.selection.getCurrent();t(e).html(),this.redactor.selection.getHtml();this.redactor.inline.removeFormat("color"),t(this.redactor.selection.getCurrent()).find("font").each(function(){var e=t(this),i=e.attr("color"),n=e.html(),o=document.createElement("span");o.style.color=i,o.innerHTML=n,e.replaceWith(o)})}})}},s.upfrontFormatting=function(){return{init:function(){this.opts.buttonsCustom.upfrontFormatting={title:e.formatting.title,panel:this.upfrontFormatting.panel,first:!0}},panel:r.extend(_.extend({},Upfront.Views.Mixins.Upfront_Scroll_Mixin,{selected_class:"",tpl:_.template(t(i).find("#upfront-formatting").html()),className:"ufront-air-formatting",init:function(){this.custom_classes=["first-class","second-class","third-class"]},events:{"click li *":"select_tag","change .ufront-formatting-custom-class":"change_custom_class"},render:function(t){return this.$el.html(this.tpl(_.extend({},{custom_classes:this.custom_classes,selected_class:this.selected_class},e.formatting))),this},open:function(t,e){this.redactor=e,this.set_previously_selected_tag(),this.set_previously_selected_class()},close:function(){this.redactor&&(this.redactor.selection.restore(),this.$sel=!1)},set_previously_selected_tag:function(){var e=!!t(this.redactor.selection.getBlock()).length&&t(this.redactor.selection.getBlock())[0].tagName;e&&(e=e.toLowerCase(),this.$("[data-tag]").removeClass("dropact"),this.$("[data-tag='"+e+"']").addClass("dropact")),this.redactor.selection.save()},set_previously_selected_class:function(){var e=this,i=!!t(this.redactor.selection.getBlock()).length&&t(this.redactor.selection.getBlock())[0].className;i&&(this.selected_class=i.split(" ").filter(function(t){return e.custom_classes.indexOf(t)!==-1}),1===this.selected_class.length&&this.$("option").map(function(){var i=t(this);i.val()===e.selected_class[0]?i.attr("selected",!0):i.attr("selected",!1)}))},select_tag:function(e){e.preventDefault(),this.redactor.buffer.set(),this.redactor.$editor.focus();var i=t(e.target).data("tag");this.redactor.utils.browser("msie")||this.redactor.$editor.focus(),this.redactor.block.blocks=this.redactor.selection.getBlocks(),this.redactor.block.blocksSize=this.redactor.block.blocks.length,this.redactor.block.type="",this.redactor.block.value="",this.redactor.buffer.set(),this.redactor.selection.save();var n=this.redactor.block.blocks[0],o=this.redactor.utils.replaceToTag(n,i);("p"==i||this.redactor.block.headTag)&&o.find("p").contents().unwrap(),this.redactor.code.sync(),this.close(),this.redactor.dropdown.hideAll()},change_custom_class:function(e){var i=this,n=t(e.target).val();this.redactor.buffer.set(),this.redactor.$editor.focus(),_(this.custom_classes).each(function(t){i.redactor.block.removeClass(t)}),this.redactor.block.setClass(n),this.redactor.dropdown.hideAll()}}))}},s.blockquote=function(){return{init:function(){var i=this;this.opts.stateButtons.blockquote={title:e.blockquote,defaultState:"noquote",states:{noquote:{iconClass:"ueditor-noquote",isActive:function(t){var e=t.blockquote.getQuote();return!e},callback:function(t,e,n){i.utils.isCurrentOrParent(["BLOCKQUOTE"])&&i.utils.replaceToTag(i.selection.getBlock(),"p")}},quote:{iconClass:"ueditor-quote",isActive:function(e){var i=e.blockquote.getQuote();return i&&!t(i).hasClass("upfront-quote-alternative")},callback:function(t,e,n){i.block.formatBlockquote("blockquote")}},alternative:{iconClass:"ueditor-quote-alternative",isActive:function(e){var i=e.blockquote.getQuote();return i&&t(i).hasClass("upfront-quote-alternative")},callback:function(t,e,n){i.blockquote.getQuote().addClass("upfront-quote-alternative")}}}}},getQuote:function(){var e=t(this.selection.getParent());return"BLOCKQUOTE"==e.prop("tagName")?e:(e=e.closest("blockquote"),!!e.closest(".redactor-box").length&&e)}}},window.RedactorPlugins=s,{UeditorEvents:o}})}(jQuery),function(t){define("ueditor",["text!scripts/redactor/ueditor-templates.html","scripts/redactor/ueditor-inserts","redactor_plugins"],function(e,i,n){var o=!1,r=n.UeditorEvents;t.fn.ueditor=function(e){var i,n=!1;return o||s(),"string"==typeof e&&(n=!0),this.each(function(){var o=t(this),r=o.data("ueditor");r?n?i=r.callMethod(e):t.error("Ueditor is already instantiated"):n?t.error("Can't call the ueditor method "+e+". Ueditor not initialized"):(o.data("ueditor",new a(o,e)),e.autostart&&o.data("ueditor").start(),a.prototype.redactorInitialized=!0)}),1==this.length&&"undefined"!=typeof i?i:this};var s=function(){t.Redactor.prototype.airBindHide=function(){if(this.opts.air&&this.$toolbar){var e=this,i=t.proxy(function(i){t(i).on("mouseup.redactor",t.proxy(function(n){if(0===t(n.target).closest(this.$toolbar).length&&0===t(n.target).parents("#upfront-popup.upfront-postselector-popup").length&&!e.selection.getText()){if(e.$element.closest("li").hasClass("menu-item")){var o=e.$element.closest("li.menu-item").data("backboneview");o.model["being-edited"]=!1}e.$air.fadeOut(100),t(".redactor-dropdown").hide(),e.$toolbar.find(".dropact").removeClass("dropact"),t(i).off(n)}},this)).on("keydown.redactor",t.proxy(function(n){91===n.keyCode&&n.metaKey||(n.which===this.keyCode.ESC,e.$air.fadeOut(100),t(i).off(n))},this))},this);i(document),this.opts.iframe&&i(this.document)}},t.Redactor.prototype.airShow=function(e,i){if(("undefined"==typeof e||!(t(e.target).parents().is(".uimage-control-panel")||t(e.target).is(".upfront-icon")||t(e.target).is(".upfront-icon-button")||!_.isUndefined(e.target.contentEditable)&&"false"===e.target.contentEditable||"false"===t(e.target).closest(".redactor-editor").attr("contentEditable")))&&this.opts.air&&(this.opts.buttons.length||this.opts.airButtons.length)&&this.$toolbar){if(this.$element.closest("li").hasClass("menu-item")){var n=this.$element.closest("li.menu-item").data("backboneview");n.model["being-edited"]=!0}t(".redactor_air").hide(),this.selection.createMarkers();var o=this.$air.width(),s=this.$editor.find("span#selection-marker-1"),a=this.$editor.find("span#selection-marker-2"),l=s.offset(),p=a.offset();if(this.utils.browser("safari")&&(0!==s.length&&0!==a.length?this.caret.set(s,0,a,0):0!==s.length?this.caret.set(s,0,s,0):this.$editor.focus()),!l||!p)return!1;var d,c,u=p.top<l.top?{top:p.top-55,left:p.left,right:l.left,i:2}:{top:l.top-55,left:l.left,right:p.left,i:1},h=t(window),f=h.width()+h.scrollLeft();if(l.top!=p.top&&u.left>u.right&&(u.right=u.left+50),this.airWidth||(this.airWidth=o,this.$air.width(o)),(u.right<u.left||u.right>f)&&(c=this.$editor.find("#selection-marker-"+u.i).parent(),u.right=Math.min(f,c.offset().left+c.width())),d=Math.floor((u.right+u.left+1)/2),d+o/2>f?(this.$air.addClass("at-right"),d>f&&(d=f-5),u.left=d-o):(this.$air.removeClass("at-right"),u.left=d-Math.floor((o+1)/2)),this.$air.css({left:u.left+"px",top:u.top+"px"}).show(),this.$air.offset().top<0){var g=e&&e.clientY?e.clientY:this.$box.height();this.$air.css({top:g+14+this.$box.position().top+"px"}),this.$air.addClass("under")}else this.$air.removeClass("under");this.airBindHide(),this.$air.trigger("show"),this.dropdown.hideAll(),r.trigger("ueditor:air:show",this),this.selection.removeMarkers()}},o=!0;var e={selection:function(){return{getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlocks:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var i=[];return e="undefined"==typeof e?this.selection.getNodes():e,t.each(e,t.proxy(function(t,e){this.utils.isBlock(e)&&i.push(e)},this)),0===i.length?[this.selection.getBlock()]:i},getNodes:function(){this.selection.get();var e=this.selection.getNodesMarker(1),i=this.selection.getNodesMarker(2);if(this.range.collapsed===!1){if(window.getSelection){var n=window.getSelection();if(n.rangeCount>0){var o=n.getRangeAt(0),r=o.startContainer,s=o.startOffset,a=o.cloneRange();a.collapse(!1),a.insertNode(i),a.setStart(r,s),a.collapse(!0),a.insertNode(e),o.setStartAfter(e),o.setEndBefore(i),n.removeAllRanges(),n.addRange(o)}}}else this.selection.setNodesMarker(this.range,e,!0),i=e;var l=[],p=0,d=this;this.$editor.find("*").each(function(){if(this==e){var n=t(this).parent();0!==n.length&&"BODY"!=n[0].tagName&&d.utils.isRedactorParent(n[0])&&l.push(n[0]),l.push(this),p=1}else p>0&&(l.push(this),p+=1);if(this==i)return!1});for(var c=[],u=l.length,h=0;h<u;h++)"nodes-marker-1"!=l[h].id&&"nodes-marker-2"!=l[h].id&&c.push(l[h]);return this.selection.removeNodesMarkers(),c},setNodesMarker:function(t,e,i){t=t.cloneRange();try{t.collapse(i),t.insertNode(e)}catch(t){}},fromPoint:function(t,e){this.caret.setOffset(t,e)},selectElement:function(t){if(this.utils.browser("mozilla")){t=t[0]||t;var e=document.createRange();e.selectNodeContents(t)}else this.caret.set(t,0,t,1)},restore:function(){var t=this.$editor.find("span#selection-marker-1"),e=this.$editor.find("span#selection-marker-2");this.utils.browser("mozilla")&&this.$editor.focus(),0!==t.length&&0!==e.length?this.caret.set(t,0,e,0):0!==t.length?this.caret.set(t,0,t,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(e,i){var n=t(i).text().replace(/\u200B/g,"");""===n?t(i).remove():t(i).replaceWith(function(){return t(this).contents()})})},replaceSelection:function(t){this.selection.get(),this.range.deleteContents();var e=document.createElement("div");e.innerHTML=t;for(var i,n=document.createDocumentFragment();i=e.firstChild;)n.appendChild(i);this.range.insertNode(n)},replaceWithHtml:function(t){t=this.selection.getMarkerAsHtml(1)+t+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt?this.selection.replaceSelection(t):document.selection&&document.selection.createRange&&this.range.pasteHTML(t),this.selection.restore(),this.code.sync()}}},utils:{isEndOfElement:function(e){if("undefined"==typeof e&&(e=this.$element,!e))return!1;var i=this.caret.getOffsetOfElement(e),n=t.trim(t(e).text()).replace(/\n\r\n/g,"");return i==n.length}},inline:{format:function(e,i,n){for(var o=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],r=["strong","strong","em","em","u","del","del","sup","sub"],s=0;s<o.length;s++)e==o[s]&&(e=r[s]);this.inline.type=i||!1,this.inline.value=n||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(e):this.inline.formatMultiple(e),e&&-1!==_.indexOf(["em","italic"],e.toLowerCase())&&this.selection.selectElement(t(this.selection.getInlines()).find("em")),e&&-1!==_.indexOf(["strong","bold"],e.toLowerCase())&&this.selection.selectElement(t(this.selection.getInlines()).find("strong"))}},keydown:{replaceDivToBreakLine:function(){var e=this.selection.getBlock();if(!(e||{}).innerHTML)return!1;var i=e.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===e.tagName||"P"===e.tagName)&&""===i&&!t(e).hasClass("redactor-editor")){var n=document.createElement("br");return t(e).replaceWith(n),this.caret.setBefore(n),this.code.sync(),!1}}},clean:{savePreFormatting:function(t){return t}}};t.Redactor.prototype.events=r,t.Redactor.prototype.shortcutsLoadFormat=function(t,e){Upfront.Util.log("Block styles keyboard shortcuts have been disabled")},t.Redactor.prototype.placeholderStart=function(t){console.log("do nothing")},t.Redactor.prototype.button=function(){return{build:function(e,i){var n=t('<a href="#" class="re-icon re-'+e+'" rel="'+e+'" title="'+i.title+'" />').attr("tabindex","-1");if((i.func||i.command||i.dropdown)&&n.on("touchstart click",t.proxy(function(t){if(n.hasClass("redactor-button-disabled"))return!1;var o="func",r=i.func;i.command?(o="command",r=i.command):i.dropdown&&(o="dropdown",r=!1),this.button.onClick(t,e,o,r)},this)),i.dropdown){var o=t('<div class="redactor-dropdown redactor-dropdown-box-'+e+'" style="display: none;">');n.data("dropdown",o),this.dropdown.build(e,o,i.dropdown)}return n},onClick:function(e,i,n,o){if(this.button.caretOffset=this.caret.getOffset(),e.preventDefault(),this.utils.browser("msie")&&(e.returnValue=!1),"command"==n)this.inline.format(o);else if("dropdown"==n)this.dropdown.show(e,i);else{var r;t.isFunction(o)?(o.call(this,i),this.observe.buttons(e,i)):"-1"!=o.search(/\./)?(r=o.split("."),"undefined"!=typeof this[r[0]]&&(this[r[0]][r[1]](i),this.observe.buttons(e,i))):(this[o](i),this.observe.buttons(e,i))}},get:function(t){return this.$toolbar.find("a.re-"+t)},setActive:function(t){this.button.get(t).addClass("redactor-act")},setInactive:function(t){this.button.get(t).removeClass("redactor-act")},setInactiveAll:function(t){"undefined"==typeof t?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+t).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(t,e){this.button.get(t).addClass("re-"+e)},removeIcon:function(t,e){this.button.get(t).removeClass("re-"+e)},setAwesome:function(t,e){var i=this.button.get(t);i.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),i.html('<i class="fa '+e+'"></i>')},addCallback:function(e,i){var n="dropdown"==i?"dropdown":"func",o=e.attr("rel");e.on("touchstart click",t.proxy(function(t){return!e.hasClass("redactor-button-disabled")&&void this.button.onClick(t,o,n,i)},this))},addDropdown:function(e,i){var n=e.attr("rel");this.button.addCallback(e,"dropdown");var o=t('<div class="redactor-dropdown redactor-dropdown-box-'+n+'" style="display: none;">');return e.data("dropdown",o),i&&this.dropdown.build(n,o,i),o},add:function(e,i){if(this.opts.toolbar){var n=this.button.build(e,{title:i});return n.addClass("redactor-btn-image"),this.$toolbar.append(t("<li>").append(n)),n}},addFirst:function(e,i){if(this.opts.toolbar){var n=this.button.build(e,{title:i});return this.$toolbar.prepend(t("<li>").append(n)),n}},addAfter:function(e,i,n){if(this.opts.toolbar){var o=this.button.build(i,{title:n}),r=this.button.get(e);return 0!==r.size()?r.parent().after(t("<li>").append(o)):this.$toolbar.append(t("<li>").append(o)),o}},addBefore:function(e,i,n){if(this.opts.toolbar){var o=this.button.build(i,{title:n}),r=this.button.get(e);return 0!==r.size()?r.parent().before(t("<li>").append(o)):this.$toolbar.append(t("<li>").append(o)),o}},remove:function(t){this.button.get(t).remove()}}},t.Redactor.prototype.bindModuleMethods=function(t){if("undefined"!=typeof this[t]){this[t]=this[t]();for(var i=this.getModuleMethods(this[t]),n=i.length,o=0;o<n;o++){var r=this[t][i[o]];e[t]&&e[t][i[o]]&&(r=e[t][i[o]]),this[t][i[o]]=r.bind(this)}}};var i=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor;t.Redactor.opts.langs.upfront=t.extend({},t.Redactor.opts.langs.en,{bold:i.bold,italic:i.italic})},a=function(e,i){this.active=!1;var n=this.pluginList(i),o=this,s=Upfront.Util.get_unique_id("redactor");this.$el=e,this.$air=t("<div class='redactor_air upfront-ui'></div>").attr("id",s).hide(),t("body").append(this.$air),_.isEmpty(i.airButtons)||(i.buttons=i.airButtons),this.options=t.extend({autostart:!0,autoexit:!1,stateButtons:{},toolbarExternal:"#"+s,air:!0,linebreaks:!0,disableLineBreak:!1,focus:!0,cleanup:!1,plugins:n,airButtons:["upfrontFormatting","bold","italic","blockquote","upfrontLink","stateLists","stateAlign","upfrontColor","upfrontIcons"],buttons:["upfrontFormatting","bold","italic","blockquote","upfrontLink","stateLists","stateAlign","upfrontColor","upfrontIcons"],buttonsCustom:{},activeButtonsAdd:{},observeLinks:!1,observeImages:!1,formattingTags:["h1","h2","h3","h4","p","pre"],inserts:Upfront.Settings.Application.PERMS.EMBED?["image","embed","video"]:["image","video"],linkTooltip:!1,cleanOnPaste:!0,replaceDivs:!1,pastePlainText:!1,imageEditable:!1,removeEmpty:!1,imageResizable:!1,lang:"upfront",direction:Upfront.Util.isRTL()?"rtl":"ltr"},i),this.options.dropdownShowCallback=function(){r.trigger("ueditor:dropdownShow",this)},this.options.dropdownHideCallback=function(){r.trigger("ueditor:dropdownHide",this)},this.options.initCallback=function(){r.trigger("ueditor:init",this)},this.options.changeCallback=function(t){r.trigger("ueditor:change",this,t)},this.options.focusCallback=function(){r.trigger("ueditor:focus",this)},this.options.blurCallback=function(){r.trigger("ueditor:blur",this)},this.options.keyupCallback=function(t){r.trigger("ueditor:key:up",this)},this.options.keydownCallback=function(t){r.trigger("ueditor:key:down",this,t)},this.options.textareaKeydownCallback=function(){r.trigger("ueditor:key:down:textarea",this)},this.options.syncBeforeCallback=function(t){return r.trigger("ueditor:sync:before",this,t),t},this.options.syncCallback=function(t){r.trigger("ueditor:sync:after",this,t),e.trigger("syncAfter",t)},this.options.autosaveCallback=function(){r.trigger("ueditor:autosave",this)},this.options.execCommandCallback=function(t,e){r.trigger("ueditor:exec:"+t,this,e)},this.options.destroyCallback=function(){r.trigger("ueditor:destroy",this)},this.options.clickCallback=function(t){r.trigger("ueditor:click",this,t)},this.id="ueditor"+1e4*Math.random(),this.options.autostart?this.options.startoninit&&this.start():(this.bindStartEvents(),this.startPlaceholder()),this.options.pasteCallback=function(t){return t=t.replace(/<div>/g,"<p>").replace(/<\/div>/g,"</p>"),t=t.replace(/<p><br><\/p>/g,"<br>"),t=t.replace(/<p ([^>]*)><br><\/p>/g,"<br>"),t=t.replace(/<\/p><p>/g,"<br>"),t=t.replace(/<\/p><p ([^>]*)>/g,"<br>"),t=t.replace(/<\/p><br><p>/g,"</p><p>"),t=t.replace(/<\/p><br><p ([^>]*)>/g,"</p><p $1>"),t=t.replace(/<\/p>([<br>])*<p>/g,"</p><p></p><p>"),t=t.replace(/<\/p>([<br>])*<p ([^>]*)>/g,"</p><p></p><p $1>"),"undefined"!=typeof o.font_icon&&o.font_icon!==!1?o.font_icon:t},this.options.enterCallback=function(e){if("LI"===this.keydown.block.tagName){var i,n=this.selection.getCurrent(),o=t(n).closest("li"),s=o.parent("ul,ol"),a=s.parent("li").parent("ul,ol"),l="<li>&#x200b;</li>";if(0!==o.length&&0!==a.length&&this.utils.isEmpty(o.html())&&0===s.next().length)return i=t(l),a.append(i),this.caret.setStart(i),o.remove(),!1;if(0!==o.length&&this.utils.isEmpty(o.html())&&0===s.next().length)return i=t(this.opts.emptyHtml),s.after(i),this.caret.setStart(i),o.remove(),!1;r.trigger("ueditor:enter",this,e),this.utils.isEmpty(this.keydown.block.innerText)&&(t(this.selection.getBlock()).remove(),s.next().is("p")&&this.utils.isEmpty(s.next().text())?i=s.next("p"):(i=t(this.opts.emptyHtml),s.after(i)),this.caret.setStart(i))}else r.trigger("ueditor:enter",this,e)}};r.on("ueditor:key:up",function(t){_.isEmpty(t.selection.getText())||t.airShow()}),a.prototype={disableStop:!1,mouseupListener:!1,start:function(){var e=this;this.stopPlaceholder(),this.hideLinkFlags(),this.$el.addClass("ueditable").removeClass("ueditable-inactive").attr("title","").redactor(this.options),this.$el.trigger("start",this),this.redactor=this.$el.data("redactor"),this.redactor.$air=this.$air,this.redactor.ueditor=this,this.preventDraggable(),r.trigger("ueditor:start",this.redactor),Upfront.data.Ueditor||(Upfront.data.Ueditor={instances:{}}),Upfront.data.Ueditor.instances[this.id]=this,this.mouseupListener=t.proxy(this.listenForMouseUp,this),this.$el.on("mousedown",this.mouseupListener),this.$el.on("keydown",function(i){if(e.cmdKeyA=!1,e.cmdKey=!1,_.delay(function(){8===i.keyCode&&(e.redactor.clean.clearUnverified(),e.redactor.$editor.find("span").not('[data-verified="redactor"]').removeAttr("style"))},2),setTimeout(function(){65===i.keyCode&&i.metaKey&&(e.cmdKeyA=!0),91===i.keyCode&&i.metaKey&&(e.cmdKey=!0),67===i.keyCode&&i.metaKey&&e.onCopy(i)}),32===i.keyCode&&e.expand_known_text_patterns(),37!=i.keyCode&&39!=i.keyCode&&e.redactor){var n=t(e.redactor.selection.getCurrent());n.hasClass("uf_font_icon")?e.redactor.caret.setAfter(n):n.parent().hasClass("uf_font_icon")&&e.redactor.caret.setAfter(n.parent())}}),this.$el.on("keyup",function(t){(e.redactor&&e.redactor.selection.getText()&&[37,38,39,40].indexOf(t.keyCode)!==-1||65===t.keyCode&&t.ctrlKey||e.cmdKeyA)&&e.redactor.airShow(t)}),this.options.inserts&&this.insertsSetUp(),this.options.autostart&&!this.options.autoexit||this.listenToOuterClick(),t(document).on("keyup",t.proxy(this.stopOnEscape,this)),this.active=!0,this.$el.on("keyup",function(i){13!==i.keyCode||i.shiftKey||!(e||{}).redactor||e.redactor.keydown.pre||e.redactor.$air.is(":visible")||(e.redactor.utils.removeEmpty(),t(e.redactor.selection.getCurrent()).append("&#x200b;"))})},stopOnEscape:function(e){27!==e.keyCode||t(".upfront-content-marker-contents").length&&t(".upfront-content-marker-contents").data("ueditor")||this.stop()},expand_known_text_patterns:function(e){var i=this.redactor,n={"##":{tag:"h2"},"###":{tag:"h3"},"####":{tag:"h4"},"#####":{tag:"h5"},"######":{tag:"h6"},">":{tag:"blockquote"},"-":{tag:"ul",nest:"li"},"*":{tag:"ul",nest:"li"},"1.":{tag:"ol",nest:"li"},"1)":{tag:"ol",nest:"li"}};if(i){i.selection.get();var o,r,s,a=i.selection.getBlock();a&&(o=i.caret.getOffsetOfElement(a),o&&(r=t(a).clone(),s=r.text().substr(0,o),s&&t.each(n,function(e,n){if(e!==s)return!0;var o,r=t(a),l=new RegExp("^"+e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+" ?"),p=r.html().replace(l,"");if(">"===e&&(p=p.replace(/&gt;/,"")),r.is("li,ul,ol,pre"))return!1;if("nest"in n&&n.nest)r.html("<"+n.tag+"><"+n.nest+">"+p+"</"+n.nest+"></"+n.tag+">"),o=r.find(n.nest).last().get();else{var d=document.createElement(n.tag);d.innerHTML=p,r.replaceWith(d),o=d}return i.caret.setEnd(o),i.code.sync(),_.delay(function(){t(i.selection.getBlock()).html(p),i.caret.setEnd(o),i.code.sync()},3),!1})))}},stop:function(){this.redactor&&(r.trigger("ueditor:stop",this.redactor),this.$el.trigger("stop"),this.restoreDraggable(),this.redactor.$toolbar&&this.redactor.core.destroy(),this.$air.remove(),this.$el.removeClass("ueditable"),this.redactor.events.trigger("cleanUpListeners"),this.$el.data("ueditor",!1)),"undefined"!=typeof Upfront.data.Ueditor&&delete Upfront.data.Ueditor.instances[this.id],this.startPlaceholder(),t("html").off("mousedown",this.stopOnOutsideClick),t(document).off("keyup",this.stopOnEscape),this.active=!1},bindStartEvents:function(){var e=this;e.$el.addClass("ueditable-inactive").attr("title","Double click to edit the text").addClass("uf-click-to-edit-text").one("dblclick",function(t){t.preventDefault(),t.stopPropagation(),e.redactor||e.start(t)}),"DIV"==e.$el.prop("tagName")&&(e.$el.on("click","i.visit_link",function(){e.visitLink(t(this).attr("data-href"))}),e.$el.on("mouseover",function(){e.$el.hasClass("ueditable-inactive")&&e.displayLinkFlags()}),e.$el.on("mouseout",function(i){t(i.relatedTarget).hasClass("visit_link")||e.hideLinkFlags()})),this.$el.find("a").each(function(){var e=t(this).attr("href");e&&e.indexOf("#ltb-")>-1&&!Upfront.Util.checkLightbox(e)&&t(this).addClass("missing-lightbox-warning")})},displayLinkFlags:function(){var e=this;this.$el.find("a").each(function(){t(this).find("i.visit_link").length>0||!t(this).attr("href")||""==t(this).text().trim()||(t(this).css("position","relative"),t(this).append('<i class="visit_link visit_link_'+e.guessLinkTypeTag(t(this))+'" data-href="'+t(this).attr("href")+'"></i>'),t(this).removeAttr("href"))})},hideLinkFlags:function(e){this.$el.find("a").each(function(){t(this).css("position",""),t(this).attr("href",t(this).children("i.visit_link").attr("data-href")),t(this).children("i.visit_link").remove()})},visitLink:function(e){var i=this,n=i.guessLinkType(e);if("lightbox"==n){var o=Upfront.Application.layout.get("regions");if(region=!!o&&o.get_by_name(i.getUrlanchor(e)),region){_.each(o.models,function(t){"lightbox"==t.attributes.sub&&Upfront.data.region_views[t.cid].hide()});var r=Upfront.data.region_views[region.cid];r.show()}}else if("anchor"==n){i.get_anchors();t("html,body").animate({scrollTop:t("#"+i.getUrlanchor(e)).offset().top},"slow")}else"entry"==n?window.location.href=e.replace("&editmode=true","").replace("editmode=true","")+(e.indexOf("?")>0?"&editmode=true":"?editmode=true"):window.open(e)},guessLinkTypeTag:function(t){return t.data("upfront-link-type")},guessLinkType:function(e){var i=!1;return t.trim(e)&&"#"!=t.trim(e)?(e.indexOf("#")>-1&&(i=this.getUrlanchor(e)),i?e.indexOf("ltb-")>-1?"lightbox":"anchor":0===e.indexOf("mailto:")?"email":e.substring(0,location.origin.length)==location.origin?"entry":"external"):"unlink"},get_anchors:function(){var t=Upfront.Application.layout.get("regions"),e=[];return t.each(function(t){t.get("modules").each(function(t){t.get("objects")&&t.get("objects").each(function(t){var i=t.get_property_value_by_name("anchor");i&&i.length&&(e[i]=t)})})}),e},getUrlanchor:function(e){if("undefined"==typeof e&&(e=t(location).attr("href")),e.indexOf("#")>=0){var i=e.split("#");return i[1]}return!1},insertsSetUp:function(){var e=this,i=new p({el:this.$el,insertsData:this.options.insertsData,inserts:this.options.inserts,ueditor:this}),n=this.redactor.events;this.insertManager=i;var o=t.proxy(i.bindTriggerEvents,i);n.on("ueditor:init",o),n.on("ueditor:enter",o),n.on("ueditor:insert:media",o),n.on("ueditor:sync:after",function(){e.insertManager.parseMarkup()}),i.on("insert:prechange",function(){e.redactor.selection.get();e.redactor.buffer.set()}),this.manager=i,this.redactorEvents=n,i.on("insert:added insert:removed",function(){e.redactor.events.trigger("ueditor:insert:media"),e.redactor.code&&e.redactor.code.sync&&e.redactor.code.sync()}),r.on("cleanUpListeners",t.proxy(this.cleanUpListeners,this));
},cleanUpListeners:function(){this.redactorEvents.off("ueditor:init"),this.redactorEvents.off("ueditor:enter"),this.redactorEvents.off("ueditor:insert:media"),this.redactorEvents.off("ueditor:sync:after"),this.manager.off("insert:prechange"),this.manager.off("insert:added insert:removed"),t("html").off("mousedown",this.stopOnOutsideClick),this.redactorEvents.off("cleanUpListeners"),t(document).off("click.redactor-image-delete")},listenToOuterClick:function(){var e=this;this.checkInnerClick||(this.checkInnerClick=function(t){!e.options.autostart&&e.redactor&&e.stop()}),t("html").on("mousedown",{ueditor:e},this.stopOnOutsideClick)},stopOnOutsideClick:function(e){Upfront.preventRedactorStopOnOutsideClick!==!0&&(t(e.target).hasClass("redactor_box")||t(e.target).parents().hasClass("redactor-box")||t(e.target).parents().hasClass("redactor_air")||t(e.target).parents().hasClass("redactor-toolbar")||t(e.target).parents().hasClass("use_selection_container")||t(e.target).parents().is("#upfront-popup")||t(e.target).parents().hasClass("upfront-inserts-markup-editor")||t(e.target).parents().hasClass("redactor-dropdown")||0!==t(e.target).parents("#upfront-popup.upfront-postselector-popup").length||(e.data.ueditor.$el.closest("a.menu_item").length>0?e.data.ueditor.$el.trigger("blur"):e.data.ueditor.stop()))},callMethod:function(t){var e=this.$el.redactor(t);return r.trigger("ueditor:method:"+t,this.$el.redactor),e},startPlaceholder:function(){var e=this.options.placeholder;if(this.$el.attr("placeholder")&&(e=this.$el.attr("placeholder")),""===e&&(e=!1),e!==!1&&0===t.trim(this.$el.text()).length){this.$el.parent().children(".ueditor-placeholder").remove(),this.$placeholder=this.$el.clone(!1),this.$placeholder.attr("contenteditable",!1).removeClass("ueditable redactor_editor").addClass("ueditor-placeholder").html(e),this.$el.after(this.$placeholder);var i=this.$el.parent();"static"==i.css("position")&&i.css("position","relative"),"static"==this.$el.css("position")&&this.$el.css("position","relative"),this.$el.css("z-index",1);var n=this.$el.position();this.$placeholder.css({position:"absolute","z-index":"0",top:n.top,left:n.left,right:i.outerWidth()-(n.left+this.$el.outerWidth())}),this.$el.html("&nbsp;"),this.options.placeholder=e}},stopPlaceholder:function(){this.$placeholder&&this.$placeholder.remove(),"&nbsp;"==this.$el.html()&&this.$el.html("")},preventDraggable:function(){var t=this.$el.closest(".ui-draggable"),e=t.draggable("option","cancel");_.isString(e)&&e.indexOf(".ueditable")==-1&&t.draggable("option","cancel",e+",.ueditable")},restoreDraggable:function(){var t=this.$el.closest(".ui-draggable"),e=t.draggable("option","cancel");_.isString(e)&&e.indexOf(".ueditable")!=-1&&t.draggable("option","cancel",e.replace(/,\.ueditable/g,""))},pluginList:function(e){var i=["stateAlignmentCTA","stateAlignment","stateLists","blockquote","stateButtons","upfrontLink","upfrontColor","upfrontFormatting","upfrontIcons","upfrontSink","upfrontPlaceholder","panelButtons"],n=[];return t.each(i,function(t,i){("undefined"==typeof e[i]||e[i])&&n.push(i)}),n},listenForMouseUp:function(){var e=this;e.redactor||(e.redactor=e.$el.data("redactor")),e.redactor&&(e.redactor.waitForMouseUp=!0),t(document).one("mousedown",function(t){e.clickcount||(e.clickcount=0),e.clickcount=e.clickcount+1,e.lastmousedown={x:t.pageX,y:t.pageY},e.clickcount>0&&setTimeout(function(){e.clickcount=0},400)}),t(document).one("mouseup",function(i){if(e.redactor){var n=!!e.redactor.selection.getText();(n||e.clickcount>1)&&e.redactor&&e.redactor.waitForMouseUp&&e.redactor.selection.getText()?(e.redactor.airShow(i),e.redactor.$element.trigger("mouseup.redactor")):t(".redactor_air").hide(),t(i.target).hasClass("uf_font_icon")}})},getValue:function(e){var i=this.redactor.$element.html();return this.insertManager&&(i=this.insertManager.insertExport(i,e),$html=t("<div>").html(i)),$html.find(".redactor-selection-marker").remove(),t.trim($html.find(".plain-text-container").length?$html.find(".plain-text-container").last().html():$html.html())},getInsertsData:function(){var t={};return this.insertManager?(_.each(this.insertManager._inserts,function(e){t[e.data.id]=e.data.toJSON()}),t):{}},onCopy:function(e){var i=window.getSelection(),n=this;if(n.font_icon=!1,!_.isUndefined(i.anchorNode)&&"uf_font_icon"===i.anchorNode.className){var o=document.createElement("span");o.className="uf_font_icon",o.style.cssText=i.anchorNode.style.cssText;var r=t.trim(i.toString());r=r.replace(/\$/g,"&#36;"),r=r.replace(//g,'"'),r=r.replace(//g,'"'),r=r.replace(//g,"'"),r=r.replace(//g,"'"),o.innerHTML=r,setTimeout(function(){n.redactor.$pasteBox===!1&&n.redactor.paste.createPasteBox(),n.redactor.$pasteBox.html(o),n.font_icon=o.outerHTML},1)}}};var l=Backbone.View.extend({tpl:_.template(t(e).find("#insert-manager-tooltip-tpl").html()),className:"ueditor-post-insert-manager",$block:!1,initialize:function(t){t.inserts&&t.inserts.constructor===Array&&!Upfront.Settings.Application.PERMS.EMBED&&(t.inserts=_.without(t.inserts,"embed")),this.insertsData=t.insertsData||{},this.inserts=t.inserts||{},this.redactor=t.redactor,this.onRemoveInsert=t.onRemoveInsert,this.listenTo(r,"ueditor:insert:relocate",this.insert_relocate);var e=this;this.listenTo(r,"cleanUpListeners",function(){e.stopListening()})},events:{"click .uinsert-selector-option":"on_insert_click","click .upfront-post-media-trigger":"toggle_inserts"},render:function(){this.$el.html(this.tpl({inserts:_.pick(i.inserts,this.inserts),names:i.NAMES}))},insert_relocate:function(t){this.$block=t},toggle_inserts:function(t){t.preventDefault(),t.stopPropagation(),this.$el.find(".uinsert-selector").toggle()},on_insert_click:function(e){e.preventDefault(),e.stopPropagation();var n=t(e.target).data("insert"),o=new i.inserts[n],r=this;this.__insert=o,o.start(this.$el,this.redactor.$editor).done(function(e,i){var n,o,s;_.isArray(e)?(n=e[0],o=e[0],s=i):(n=e,o=i,s=s||r.__insert),r.inserts[s.cid]=s,r.is_last_p()?r.$block.before(s.$el):(r.redactor.$element.find(r.$block).length<1&&r.redactor.$element.append(r.$block),r.$block.replaceWith(s.$el)),r.$block.prev("br").remove(),r.insertsData[s.data.id]=s.data.toJSON(),r.listenTo(s.data,"change add remove update",function(){r.insertsData[s.data.id]=s.data.toJSON()}),setTimeout(function(){t(".uinsert-selector").hide(),t(".ueditor-post-insert-manager").hide()},100),r.redactor.code.sync(),r.listenTo(s,"remove",r.onRemoveInsert)})},is_last_p:function(){var t=this.redactor.$element.find("p");return _.indexOf(t,this.$block[0])===t.length-1}}),p=Backbone.View.extend({tpl:_.template(t(e).find("#insert-manager-tpl").html()),initialize:function(t){this.inserts=t.inserts||{},this._inserts={},this.ueditor=t.ueditor,this.onRemoveInsert=_.bind(this.removeInsert,this),this.insertsData=t.insertsData||{},this.deletedInserts={},this.$el.children().addClass("nosortable"),this.insertLookUp(),this.bindTriggerEvents(),this.refreshTimeout=!1,this.sortableInserts(),this.render_tooltips(),t.ueditor.options.inserts&&(this.listenTo(r,"ueditor:click",this.position_tooltips),this.listenTo(r,"ueditor:key:up",this.position_tooltips));var e=this;this.listenTo(r,"cleanUpListeners",function(){e.stopListening()})},render_tooltips:function(){if(this.ueditor.options.inserts&&0!==this.ueditor.options.inserts.length){var t=new l({insertsData:this.insertsData,inserts:this.inserts,redactor:this.ueditor.redactor,onRemoveInsert:this.onRemoveInsert});t.render(),this.ueditor.$el.after(t.$el),this.$tooltips=t.$el}},position_tooltips:function(e){if(this.$tooltips){var i=t(e.selection.getCurrent()),n=t(e.selection.getBlock()).position();if(this.show_tooltip_in_this_location(e)){if("undefined"==typeof i[0])return;var o=_.extend(n,{marginLeft:_.isArray(i)?i.css("padding-left"):0});this.$tooltips.css(o),this.$tooltips.show(),r.trigger("ueditor:insert:relocate",i)}else this.$tooltips.hide()}},bindTriggerEvents:function(e){this.$el.parent(),this.$el.offset(),t.proxy(this.updateMediaTriggerPosition,this),this.$el.data("ueditor");this.ticking=!1,this.leftMarker=t('<span style="float:left">')},updateMediaTriggerPosition:function(){var t,e=this.leftMarker;this.currentBlock&&(this.triggerPosition>.7?(this.currentBlock.append(e),t=e.offset().left-this.currentBlock.offset().left,e.detach(),this.mediaTrigger.addClass("upfront-post-media-trigger-visible upfront-post-media-trigger").data("insert","after").css({top:this.currentBlock.position().top+this.currentBlock.height(),"margin-left":t+"px"})):this.triggerPosition<.3?(this.currentBlock.prepend(e),t=e.offset().left-this.currentBlock.offset().left,e.detach(),this.mediaTrigger.addClass("upfront-post-media-trigger-visible upfront-post-media-trigger").data("insert","before").css({top:this.currentBlock.position().top,display:"block","margin-left":t+"px"})):this.mediaTrigger.removeClass("upfront-post-media-trigger-visible"))},insertLookUp:function(){var t=this,e=_.extend({},t.insertsData,t.deletedInserts);_.each(_.pick(i.inserts,this.inserts),function(i){_.extend(t._inserts,i.prototype.importInserts(t.$el,e,t.inserts))}),_.each(t._inserts,function(e){t.insertsData[e.data.id]=e.data.toJSON(),t.stopListening(e.data),t.listenTo(e.data,"change add remove update",function(){t.insertsData[e.data.id]&&(t.insertsData[e.data.id]=e.data.toJSON())}),t.listenTo(e,"remove",t.onRemoveInsert)}),this.trigger("insert:added")},removeInsert:function(t){this.trigger("insert:prechange"),t.$el.detach(),this.trigger("insert:removed")},insertExport:function(e,i){var n=t("<div>").html(e);return n.find(".nosortable").removeClass("nosortable"),_.each(this._inserts,function(t){var e="#"+t.data.id,o=i?t.getSimpleOutput():t.getOutput();n.find(e).replaceWith(o)}),n.html()},parseMarkup:function(){var t=this;this.refreshTimeout&&clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){_.each(t.deletedInserts,function(e,i){var n=t.$el.find("#"+i);n.length&&(t._inserts[i]=e,delete t.deletedInserts[i])}),_.each(t._inserts,function(e,i){if(!e.$el.parent().length){var n=t.$el.find("#"+i);n.length?(n.replaceWith(e.el),e.delegateEvents(),e.controls&&e.controls.delegateEvents(),e.controlEvents&&e.controlEvents()):(t.deletedInserts[i]=e,delete t._inserts[i])}}),t.$el.children(":not(.ueditor-insert), :not(.ueditor-post-insert-manager)").addClass("nosortable")},600)},sortableInserts:function(){var t=this;t.$el.sortable({cancel:".nosortable",helper:"clone",handle:".uinsert-drag-handle"}).on("sortstart",function(t,e){console.log("Sort start"),e.placeholder.width(e.helper.width()),"none"!=e.item.css("float")&&e.helper.css({marginTop:t.offsetY})})},show_tooltip_in_this_location:function(e){var i=e.selection.getCurrent(),n=t(i),o=n.parent().prev(),r=e.range.startOffset;if(!i||_.isEmpty(n))return!1;var s=t(".upfront-inserted_image-wrapper, .upfront-inserted_embed-wrapper"),a=n.offset().top,l=t.trim(n.html())||"",p=t.trim(o.html())||"",d=!0;return s.each(function(){var e=t(this),i=e.find(".ueditor-insert-variant-group").height(),n=e.offset().top;a<=i+n+20&&a>=n-5&&(d=!1)}),d&&0===n.closest(".ueditor-insert").length&&(l.match(/<br>/g)||r<1&&p.match(/<br>/g)||"undefined"!=typeof n.closest("p.nosortable").html()&&""===t.trim(n.closest("p.nosortable").html()))}})})}(jQuery),define("elements/upfront-text/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){this.init_property("type","PlainTxtModel"),this.init_property("view_class","PlainTxtView"),this.init_property("element_id",Upfront.Util.get_unique_id("text-object")),this.init_property("class","c24 upfront-plain_txt"),this.init_property("has_settings",1),this.init_property("id_slug","plain_text"),this.init_property("preset","default")}});return t}),define("elements/upfront-text/js/element",["elements/upfront-text/js/model"],function(t){var e=Upfront.Settings.l10n.text_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:10,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-text"),this.$el.html(e.element_name)},add_element:function(){var i=new t({name:"",properties:[{name:"content",value:e.default_content}]}),n=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c11"},{name:"row",value:Upfront.Util.height_to_row(75)},{name:"has_settings",value:0}],objects:[i]});this.add_module(n)}});return i}),define("text!elements/upfront-text/tpl/preset-style.html",[],function(){return"#page .upfront-output-plaintxt.<?php echo $properties['id'] ?> .plain-text-container, #page .upfront-output-object.upfront-output-plaintxt.<?php echo $properties['id'] ?> .plain-text-container,\n#page .upfront-plain_txt.<?php echo $properties['id'] ?> .plain-text-container, #page .upfront-output-object.upfront-output-plain_text.<?php echo $properties['id'] ?> .plain-text-container {\n\t<?php if(!empty($properties['bg_color'])) { ?>\n\tbackground: <?php echo $properties['bg_color']  ?>;\n\t<?php } ?>\n\n\t<?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['border_width']) && !empty($properties['border_style']) && !empty($properties['border_color'])) { ?>border: <?php echo $properties['border_width'] ?>px <?php echo $properties['border_style'] ?> <?php echo $properties['border_color'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n<?php if(!empty($properties['usetypography'])) { ?>\n\n#page .upfront-object.<?php echo $properties['id'] ?> h1, #page .upfront-output-object.<?php echo $properties['id'] ?> h1,\n#page .upfront-object.<?php echo $properties['id'] ?> h1 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h1 a {\n\t<?php if(!empty($properties['h1-color'])) { ?>color: <?php echo $properties['h1-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h1-fontface'])) { ?>font-family: <?php echo $properties['h1-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h1-fontsize'])) { ?>font-size: <?php echo $properties['h1-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['h1-weight'])) { ?>font-weight: <?php echo $properties['h1-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h1-style'])) { ?>font-style: <?php echo $properties['h1-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h1-lineheight'])) { ?>line-height: <?php echo $properties['h1-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h2, #page .upfront-output-object.<?php echo $properties['id'] ?> h2,\n#page .upfront-object.<?php echo $properties['id'] ?> h2 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h2 a {\n\t<?php if(!empty($properties['h2-color'])) { ?>color: <?php echo $properties['h2-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h2-fontface'])) { ?>font-family: <?php echo $properties['h2-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h2-fontsize'])) { ?>font-size: <?php echo $properties['h2-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['h2-weight'])) { ?>font-weight: <?php echo $properties['h2-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h2-style'])) { ?>font-style: <?php echo $properties['h2-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h2-lineheight'])) { ?>line-height: <?php echo $properties['h2-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h3, #page .upfront-output-object.<?php echo $properties['id'] ?> h3,\n#page .upfront-object.<?php echo $properties['id'] ?> h3 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h3 a {\n\t<?php if(!empty($properties['h3-color'])) { ?>color: <?php echo $properties['h3-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h3-fontface'])) { ?>font-family: <?php echo $properties['h3-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h3-fontsize'])) { ?>font-size: <?php echo $properties['h3-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['h3-weight'])) { ?>font-weight: <?php echo $properties['h3-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h3-style'])) { ?>font-style: <?php echo $properties['h3-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h3-lineheight'])) { ?>line-height: <?php echo $properties['h3-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h4, #page .upfront-output-object.<?php echo $properties['id'] ?> h4,\n#page .upfront-object.<?php echo $properties['id'] ?> h4 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h4 a {\n\t<?php if(!empty($properties['h4-color'])) { ?>color: <?php echo $properties['h4-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h4-fontface'])) { ?>font-family: <?php echo $properties['h4-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h4-fontsize'])) { ?>font-size: <?php echo $properties['h4-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['h4-weight'])) { ?>font-weight: <?php echo $properties['h4-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h4-style'])) { ?>font-style: <?php echo $properties['h4-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h4-lineheight'])) { ?>line-height: <?php echo $properties['h4-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h5, #page .upfront-output-object.<?php echo $properties['id'] ?> h5,\n#page .upfront-object.<?php echo $properties['id'] ?> h5 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h5 a {\n\t<?php if(!empty($properties['h5-color'])) { ?>color: <?php echo $properties['h5-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h5-fontface'])) { ?>font-family: <?php echo $properties['h5-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h5-fontsize'])) { ?>font-size: <?php echo $properties['h5-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['h5-weight'])) { ?>font-weight: <?php echo $properties['h5-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h5-style'])) { ?>font-style: <?php echo $properties['h5-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h5-lineheight'])) { ?>line-height: <?php echo $properties['h5-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> h6, #page .upfront-output-object.<?php echo $properties['id'] ?> h6,\n#page .upfront-object.<?php echo $properties['id'] ?> h6 a, #page .upfront-output-object.<?php echo $properties['id'] ?> h6 a {\n\t<?php if(!empty($properties['h6-color'])) { ?>color: <?php echo $properties['h6-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h6-fontface'])) { ?>font-family: <?php echo $properties['h6-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['h6-fontsize'])) { ?>font-size: <?php echo $properties['h6-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['h6-weight'])) { ?>font-weight: <?php echo $properties['h6-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h6-style'])) { ?>font-style: <?php echo $properties['h6-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['h6-lineheight'])) { ?>line-height: <?php echo $properties['h6-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> p, #page .upfront-output-object.<?php echo $properties['id'] ?> p,\n#page .upfront-object.<?php echo $properties['id'] ?> p a, #page .upfront-output-object.<?php echo $properties['id'] ?> p a {\n\t<?php if(!empty($properties['p-color'])) { ?>color: <?php echo $properties['p-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['p-fontface'])) { ?>font-family: <?php echo $properties['p-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['p-fontsize'])) { ?>font-size: <?php echo $properties['p-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['p-weight'])) { ?>font-weight: <?php echo $properties['p-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['p-style'])) { ?>font-style: <?php echo $properties['p-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['p-lineheight'])) { ?>line-height: <?php echo $properties['p-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> a, #page .upfront-output-object.<?php echo $properties['id'] ?> a {\n\t<?php if(!empty($properties['a-color'])) { ?>color: <?php echo $properties['a-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['a-fontface'])) { ?>font-family: <?php echo $properties['a-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['a-fontsize'])) { ?>font-size: <?php echo $properties['a-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['a-weight'])) { ?>font-weight: <?php echo $properties['a-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['a-style'])) { ?>font-style: <?php echo $properties['a-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['a-lineheight'])) { ?>line-height: <?php echo $properties['a-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> a:hover, #page .upfront-output-object.<?php echo $properties['id'] ?> a:hover {\n\t<?php if(!empty($properties['a-hover-color'])) { ?>color: <?php echo $properties['a-hover-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['a-hover-fontface'])) { ?>font-family: <?php echo $properties['a-hover-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['a-hover-fontsize'])) { ?>font-size: <?php echo $properties['a-hover-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['a-hover-weight'])) { ?>font-weight: <?php echo $properties['a-hover-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['a-hover-style'])) { ?>font-style: <?php echo $properties['a-hover-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['a-hover-lineheight'])) { ?>line-height: <?php echo $properties['a-hover-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> ul, #page .upfront-output-object.<?php echo $properties['id'] ?> ul {\n\t<?php if(!empty($properties['ul-color'])) { ?>color: <?php echo $properties['ul-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['ul-fontface'])) { ?>font-family: <?php echo $properties['ul-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['ul-fontsize'])) { ?>font-size: <?php echo $properties['ul-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['ul-weight'])) { ?>font-weight: <?php echo $properties['ul-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['ul-style'])) { ?>font-style: <?php echo $properties['ul-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['ul-lineheight'])) { ?>line-height: <?php echo $properties['ul-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> ol, #page .upfront-output-object.<?php echo $properties['id'] ?> ol {\n\t<?php if(!empty($properties['ol-color'])) { ?>color: <?php echo $properties['ol-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['ol-fontface'])) { ?>font-family: <?php echo $properties['ol-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['ol-fontsize'])) { ?>font-size: <?php echo $properties['ol-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['ol-weight'])) { ?>font-weight: <?php echo $properties['ol-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['ol-style'])) { ?>font-style: <?php echo $properties['ol-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['ol-lineheight'])) { ?>line-height: <?php echo $properties['ol-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote, #page .upfront-output-object.<?php echo $properties['id'] ?> blockquote,\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote a, #page .upfront-output-object.<?php echo $properties['id'] ?> blockquote a {\n\t<?php if(!empty($properties['blockquote-color'])) { ?>color: <?php echo $properties['blockquote-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['blockquote-fontface'])) { ?>font-family: <?php echo $properties['blockquote-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['blockquote-fontsize'])) { ?>font-size: <?php echo $properties['blockquote-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['blockquote-weight'])) { ?>font-weight: <?php echo $properties['blockquote-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['blockquote-style'])) { ?>font-style: <?php echo $properties['blockquote-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['blockquote-lineheight'])) { ?>line-height: <?php echo $properties['blockquote-lineheight']  ?>;<?php } ?>\n}\n\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative, #page .upfront-output-object.<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative,\n#page .upfront-object.<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative a, #page .upfront-output-object.<?php echo $properties['id'] ?> blockquote.upfront-quote-alternative a {\n\t<?php if(!empty($properties['blockquote-alternative-color'])) { ?>color: <?php echo $properties['blockquote-alternative-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['blockquote-alternative-fontface'])) { ?>font-family: <?php echo $properties['blockquote-alternative-fontface']  ?>; <?php } ?>\n\t<?php if(!empty($properties['blockquote-alternative-fontsize'])) { ?>font-size: <?php echo $properties['blockquote-alternative-fontsize']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['blockquote-alternative-weight'])) { ?>font-weight: <?php echo $properties['blockquote-alternative-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['blockquote-alternative-style'])) { ?>font-style: <?php echo $properties['blockquote-alternative-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['blockquote-alternative-lineheight'])) { ?>line-height: <?php echo $properties['blockquote-alternative-lineheight']  ?>;<?php } ?>\n}\n\n<?php } ?>\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-text/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-text/tpl/preset-style.html"],function(t,e,i){var n=Upfront.Settings.l10n.text_element,o=t.extend({panels:{Appearance:{mainDataCollection:"textPresets",styleElementPrefix:"text-preset",ajaxActionSlug:"text",panelTitle:n.settings,presetDefaults:Upfront.mainData.presetDefaults.text,styleTpl:i,stateModules:{Global:[{moduleType:"Colors",options:{title:n.settings.colors_label,multiple:!1,single:!0,abccolors:[{name:"bg_color",label:n.settings.content_area_bg}]}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"useborder",width:"border_width",type:"border_style",color:"border_color"}}},{moduleType:"Typography",options:{state:"static",title:n.settings.typography_label,toggle:!0,global_typography:!0,fields:{typeface:"fontface",fontstyle:"fontstyle",weight:"weight",style:"style",size:"fontsize",line_height:"lineheight",color:"color",use:"usetypography"},default_element:"h1",elements:[{label:n.h1,value:"h1"},{label:n.h2,value:"h2"},{label:n.h3,value:"h3"},{label:n.h4,value:"h4"},{label:n.h5,value:"h5"},{label:n.h6,value:"h6"},{label:n.p,value:"p"},{label:n.a,value:"a"},{label:n.ahover,value:"a-hover"},{label:n.ul,value:"ul"},{label:n.ol,value:"ol"},{label:n.bq,value:"blockquote"},{label:n.bqalt,value:"blockquote-alternative"}]}},{moduleType:"Checkbox",options:{state:"static",label:n.settings.padding_label,tooltip:!0,tooltip_label:n.settings.tooltip_label,fields:{checkbox:"additional_padding"}}}]},migrateElementStyle:function(t,e){return t=t.replace(/\.upfront-plain_txt/g," .plain-text-container")},migratePresetProperties:function(t){var e={},i="",n="";this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),i="undefined"!=typeof e.border_style&&"none"!==e.border_style?"yes":"",("undefined"!=typeof e.background_color&&e.background_color||"yes"===i)&&(n="yes"),t.set({useborder:i,bg_color:e.background_color,border_width:e.border_width,border_style:e.border_style,border_color:e.border_color,additional_padding:n})},getModifiedProperties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),"undefined"!=typeof t.theme_style&&"_default"!==t.theme_style&&""!==t.theme_style&&" "!==t.theme_style||("undefined"!=typeof t.border_color&&"rgba(0, 0, 0, 0)"!==t.border_color||"undefined"!=typeof t.border_style&&"none"!==t.border_style||"undefined"!=typeof t.border_width&&1!==t.border_width||"undefined"!=typeof t.bg_color&&"rgba(0, 0, 0, 0)"!==t.bg_color)}}},title:n.appearance});return e.generatePresetsToPage("text",i),o}),function(t,e){define("elements/upfront-text/js/menulist",[],function(){var e=Upfront.Settings.l10n.text_element,i=Upfront.Views.ContextMenuList.extend({initialize:function(){var i=this;this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){return e.edit_text},action:function(){var e=i.for_view.$el.find("div.upfront-object-content").data("ueditor");i.for_view.$el.find("div.upfront-object-content").data("redactor")||(e.start(),t(document).on("click",function(i){if(!e.options.autostart&&e.redactor){var n=t(i.target);e.disableStop||n.closest("li").length||n.closest(".redactor_air").length||n.closest(".ueditable").length||e.stop()}}))}})])}});return i})}(jQuery),define("elements/upfront-text/js/menu",["elements/upfront-text/js/menulist"],function(t){var e=(Upfront.Settings.l10n.text_element,Upfront.Views.ContextMenu.extend({initialize:function(){this.menulists=_([new t])}}));return e}),define("text!elements/upfront-text/tpl/utext.html",[],function(){return"{[ if (usingNewAppearance == false) { ]}\n{[ if(background_color || border) { ]}<div class='plaintxt_padding' style='background-color: {{background_color}}; border: {{border}};'> {[ } ]}\n{[ } else { ]}\n<div class='plain-text-container'>\n{[ if(additional_padding) { ]}<div class='plaintxt_padding'>{[ } ]}\n{[ } ]}\n{{content}}\n{[ if (usingNewAppearance == false) { ]}\n{[ if(background_color || border) { ]}</div>{[ } ]}\n{[ } else { ]}\n{[ if(additional_padding) { ]}</div>{[ } ]}\n</div>\n{[ } ]}\n"}),function(t){define("utext",["elements/upfront-text/js/model","elements/upfront-text/js/element","elements/upfront-text/js/settings","elements/upfront-text/js/menu","text!elements/upfront-text/tpl/utext.html","scripts/upfront/preset-settings/util"],function(e,i,n,o,r,s){var a=Upfront.Settings.l10n.text_element,l=Upfront.Views.ObjectView.extend({initialize:function(){this.constructor.__super__.initialize.apply(this,arguments),this.model instanceof e||(this.model=new e({properties:this.model.get("properties")})),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"upfront:lightbox:show",this.on_lightbox_show),this.listenTo(this.model,"preset:updated",this.preset_updated),this.listenTo(this.model,"change",this.render)},preset_updated:function(){this.render()},on_lightbox_show:function(){ed=this.$el.find(".upfront-object-content").data("ueditor"),!ed.options.autostart&&ed.redactor&&ed.stop()},get_preset_properties:function(){var t=this.model.get_property_value_by_name("preset"),e=s.getPresetProperties("text",t)||{};return e},get_content_markup:function(){var e,i,n=this.model.get_content();try{e=t(n)}catch(i){e=t("<p>"+n+"</p>")}e.hasClass("plaintxt_padding")&&(n=e.html()),i=this.model.get_property_value_by_name("usingNewAppearance")!==!0&&"true"!==this.model.get_property_value_by_name("usingNewAppearance")?{content:n,background_color:Upfront.Util.colors.convert_string_ufc_to_color(this.model.get_property_value_by_name("background_color")),border:Upfront.Util.colors.convert_string_ufc_to_color(this.model.get_property_value_by_name("border")),usingNewAppearance:!1}:{content:n,usingNewAppearance:!0,additional_padding:this.get_preset_property("additional_padding")};var o="";return o=_.template(r,i)},is_edited:function(){var t=this.model.get_property_value_by_name("is_edited");return!!t},after_breakpoint_change:function(){this.parent_module_view&&this.render();
},on_render:function(){var e=this;Upfront.Application.user_can_modify_layout()&&this.$el.find(".upfront-object-content").ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:a.default_content}).on("start",function(){var i=t(this).find(".upfront-quick-swap");i.length&&i.remove(),e.model.set_property("is_edited",!0,!0),Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){var t=e.$el.find(".upfront-object-content").data("ueditor"),i=t.redactor.$element[0].firstChild.tagName,n="";"PRE"===i&&t.redactor.selection.removeMarkers(),n=t.getValue(!0),""===n&&arguments[0]&&arguments[0].currentTarget&&(n=arguments[0].currentTarget.innerHTML),e.model.set_content(n),Upfront.Events.trigger("upfront:element:edit:stop"),t.redactor.events.trigger("cleanUpListeners"),e.render()}).on("syncAfter",function(){var t=e.$el.find(".upfront-object-content").data("ueditor"),i=t.getValue(!0);if(""===i&&"string"==typeof arguments[1]&&""!==arguments[1]&&(i=arguments[1]),!i.match(/[<>]/)){i=t.redactor.paragraphize.load(i),t.redactor.code.set(i),t.redactor.selection.selectAll();var n=t.redactor.selection.getBlocks(),o=n.pop();t.redactor.selection.remove(),o&&t.redactor.caret.setAfter(o)}e.model.set_content(t.getValue(!0)||i,{silent:!0})}),e.update_colors(),this.model.get_property_value_by_name("preset")&&(this.$el.find(".upfront-output-plaintxt").addClass(this.model.get_property_value_by_name("preset")),this.$el.find(".upfront-output-plain_text").addClass(this.model.get_property_value_by_name("preset")))},get_preset_property:function(t){var e=this.model.get_property_value_by_name("preset"),i=s.getPresetProperties("text",e)||{};return i[t]},update_colors:function(){var t=this,e=t.model.get_property_value_by_name("background_color");e&&Upfront.Util.colors.is_theme_color(e)&&(e=Upfront.Util.colors.get_color(e),t.model.set_property("bg_color",e));var i=t.model.get_property_value_by_name("border"),n=!!i&&i.match(/#ufc\d+/);if(i&&n&&n.length){var o=Upfront.Util.colors.get_color(n[0]);i=i.replace(new RegExp(n[0]),o),t.model.set_property("border_color",o)}}});Upfront.Application.LayoutEditor.add_object("PlainTxt",{Model:e,View:l,Element:i,Settings:n,ContextMenu:o,cssSelectors:{".plain-text-container":{label:a.css.container_label,info:a.css.container_info},".plain-text-container p":{label:a.css.p_label,info:a.css.p_info}},cssSelectorsId:"PlainTxtModel"}),Upfront.Models.UtextModel=e,Upfront.Views.PlainTxtView=l})}(jQuery),define("text!elements/upfront-comment/templates/preset-style.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),function(t){define("ucomment",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-comment/templates/preset-style.html"],function(e,i,n){function o(){(_upfront_post_data.post_id||Upfront.Application.get_current()===Upfront.Application.MODE.THEME&&"type"in _upfront_post_data.layout&&"single"===_upfront_post_data.layout.type)&&Upfront.Application.LayoutEditor.add_object("Ucomment",{Model:s,View:a,Element:$,Settings:k}),i.generatePresetsToPage("ucomment",n)}var r=Upfront.Settings.l10n.comments_element,s=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.ucomments.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),a=Upfront.Views.ObjectView.extend({initialize:function(t){this.model instanceof s||(this.model=new s({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[t])},get_content_markup:function(){var e=t(document).data("upfront-comment-"+_upfront_post_data.post_id);return e?e:r.loading},on_render:function(){if(t(document).data("upfront-comment-"+_upfront_post_data.post_id)||this._get_comment_markup(),Upfront.Settings.Application.PERMS.OPTIONS){var e=new d({model:this.model});e.render(),this.$el.append(e.$el)}},_get_comment_markup:function(){var e=this,i=_upfront_post_data.post_id;!i&&"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.THEME&&(i="fake_post"),Upfront.Util.post({action:"ucomment_get_comment_markup",data:JSON.stringify({post_id:i})}).success(function(i){var n=i.data.replace(/<script.*?>.*?<\/script>/gim,"");t(document).data("upfront-comment-"+_upfront_post_data.post_id,n||"&nbsp;"),e.render()}).error(function(t){Upfront.Util.log(r.loading_error)})}}),l=Upfront.Models.ObjectModel.extend({cache:!1,load:function(){if(this.loading=t.Deferred(),this.cache)this._populate();else{var e=this;Upfront.Util.post({action:"upfront-discussion_settings-get"}).done(function(t){e.cache=t.data,e._populate()})}return this.loading},_populate:function(){if(!(_.isObject(this.cache)&&"avatar_defaults"in this.cache))return this.loading.reject(),!1;var e=_(this.cache.avatar_defaults).map(function(e){return e.icon&&(e.icon=e.icon.match(/^https?:\/\//)?e.icon:t(e.icon).attr("src")),e});this.set({properties:new Upfront.Collections.Properties(_(this.cache.properties).values()),avatars:_(e).values()}),this.loading.resolve()}}),p=Backbone.View.extend({className:"upfront-global_settings",events:{"click a.settings":"popup_open"},initialize:function(){Upfront.Events.on("popup:closed",this.onPopupClosed,this)},onPopupClosed:function(){t("#upfront-popup-content").removeClass("discussion-settings-wrapper")},render:function(){this.$el.empty().append('<a href="#" class="settings">'+this.label+"</a>")},popup_open:function(t){t.preventDefault(),t.stopPropagation();var e=this;Upfront.Popup.open(function(t,i,n){e.out=this,e.popup_data=t,e.setup_tabs(i),e.setup_actions(n),e.setup_content()},{},"discussion-popup");this.popup=this},setup_tabs:function(t){},setup_actions:function(t){},setup_content:function(){},save_settings:function(){}}),d=(p.extend({label:r.discussion_settings,setup_content:function(){t(this.out).empty().append('<p class="settings-disabled">'+r.settings_disabled+"</p>")}}),p.extend({label:r.discussion_settings,initialize:function(){p.prototype.initialize.call(this),this.on("settings:tabs:switch_to:settings",this.render_settings_content,this),this.on("settings:tabs:switch_to:avatars",this.render_avatars_content,this),this.on("settings:save",this.save_settings,this)},setup_tabs:function(t){this.tabs=new c,this.tabs.parent_view=this,this.tabs.render(),t.append(this.tabs.$el)},setup_actions:function(t){var e=new u;e.parent_view=this,e.render(),t.empty().append(e.$el)},setup_content:function(){this.render_settings_content(),this.tabs.activate_tab("settings")},render_settings_content:function(){var t=new g({el:this.out,model:new l});t.render(),this.active_view=t},render_avatars_content:function(){var t=new f({el:this.out,model:new l});t.render(),this.active_view=t},save_settings:function(){var t={action:"upfront-discussion_settings-"+this.active_view.type+"-save",data:this.active_view.get_data()};Upfront.Util.post(t).done(function(){Upfront.Popup.close()})}})),c=Backbone.View.extend({tagName:"ul",className:"upfront-tabs upfront-ucomment-tabs",events:{"click li":"switch_to"},render:function(){this.$el.empty().append('<li class="settings">'+r.discussion_settings+"</li>").append('<li class="avatars">'+r.avatars+"</li>")},switch_to:function(e){e.preventDefault(),e.stopPropagation();var i=t(e.target),n=i.is(".settings")?"settings":"avatars";this.activate_tab(n),this.parent_view.trigger("settings:tabs:switch_to:"+n)},activate_tab:function(t){var e=this.$el.find("li."+t);this.$el.find("li").removeClass("active"),e.addClass("active")}}),u=Backbone.View.extend({className:"use_selection_container",events:{"click a":"trigger_settings_save"},render:function(){this.$el.empty().append('<a href="#">'+r.ok+"</a>")},trigger_settings_save:function(t){t.preventDefault(),t.stopPropagation(),this.parent_view.trigger("settings:save")}}),h=Backbone.View.extend({templates:{section_label:"<h3>{{label}}</h3>"},initialize:function(){var t=this;this.model.load().done(function(){t.render_final()})},render_final:function(){var t=this;this.populate_sections(),this.$el.empty(),this.$el.addClass("discussion-settings-wrapper"),this.sections.each(function(e){e.label&&t.$el.append(_.template(t.templates.section_label,{label:e.label})),e.fields.each(function(e){e.render(),t.$el.append(e.$el)})})},get_data:function(){var t={};return this.sections.each(function(e){e.fields.each(function(e){e.get_name?t[e.get_name()]=e.get_value():t=_.extend(t,e.get_value())})}),t},render:function(){this.$el.empty().append(r.please_wait)}}),f=h.extend({type:"avatars",populate_sections:function(){this.sections=_([{label:r.avatar_settings,fields:_([new v({model:this.model,property:"show_avatars",values:[{label:r.show_avatars,value:"1"}]})])},{label:r.max_rating,fields:_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"avatar_rating",layout:"vertical",values:[{label:r.rating.g,value:"G",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"},{label:r.rating.pg,value:"PG",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"},{label:r.rating.r,value:"R",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"},{label:r.rating.x,value:"X",icon:"http://1.gravatar.com/avatar/31cb559695bfc798dbf0981a52c7a748?s=32&d=&r=G&forcedefault=1"}]})])},{label:r.default_avatar,fields:_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"avatar_default",layout:"vertical",values:this.model.get("avatars")})])}])}}),g=h.extend({type:"settings",spawn_checkbox:function(t,e,i){return i=i||"1",new Upfront.Views.Editor.Field.Checkboxes({multiple:!1,model:this.model,property:e,values:[{label:t,value:i}]})},populate_sections:function(){this.sections=_([{label:r.article.label,fields:_([this.spawn_checkbox(r.article.pingback,"default_pingback_flag"),this.spawn_checkbox(r.article.ping_status,"default_ping_status","open"),this.spawn_checkbox(r.article.comment_status,"default_comment_status","open"),this.spawn_checkbox(r.article.attachments,"allow_attachments"),this.spawn_checkbox(r.article.email,"show_email_subscription_field")])},{label:r.other.label,fields:_([this.spawn_checkbox(r.other.require_name_email,"require_name_email"),this.spawn_checkbox(r.other.comment_registration,"comment_registration"),new m({model:this.model,property:"",field:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"close_comments_for_old_posts",values:[{label:r.other.autoclose,value:"1"}]}),subfield:new b({model:this.model,property:"close_comments_days_old"})}),new m({model:this.model,property:"",field:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"thread_comments",values:[{label:r.other.thread_comments,value:"1"}]}),subfield:new b({model:this.model,property:"thread_comments_depth"})}),new w({model:this.model,field:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"page_comments",values:[{label:r.other.page_comments,value:"1"}]}),depth:new b({model:this.model,property:"default_comments_page"}),page:new Upfront.Views.Editor.Field.Select({model:this.model,property:"default_comments_page",values:[{label:r.other.last,value:"newest"},{label:r.other.first,value:"oldest"}]})}),new Upfront.Views.Editor.Field.Select({model:this.model,property:"comment_order",label:r.other.order,values:[{label:r.other.older,value:"asc"},{label:r.other.newer,value:"desc"}]})])},{label:r.other.email_me,fields:_([this.spawn_checkbox(r.other.comments_notify,"comments_notify"),this.spawn_checkbox(r.other.moderation_notify,"moderation_notify")])},{label:r.other.before_comment_appears,fields:_([this.spawn_checkbox(r.other.comment_moderation,"comment_moderation"),this.spawn_checkbox(r.other.comment_whitelist,"comment_whitelist")])},{label:r.other.moderation_label,fields:_([new y({model:this.model,property:"comment_max_links",label:r.other.max_links}),new Upfront.Views.Editor.Field.Textarea({model:this.model,property:"moderation_keys",label:r.other.moderation_keys}),new Upfront.Views.Editor.Field.Textarea({model:this.model,property:"blacklist_keys",label:r.other.blacklist_keys})])}])}}),m=Backbone.View.extend({className:"upfront-field-complex_field",initialize:function(t){this.options=t},render:function(){this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",'[name="'+this.options.subfield.get_name()+'"]',this.stop_prop)},stop_prop:function(t){t.stopPropagation(),t.preventDefault()},get_field_html:function(){return this.options.subfield.render(),this.options.field.render(),_.template(this.options.field.$el.html(),{subfield:this.options.subfield.$el.html()})},get_value:function(){var t={},e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),i=this.$el.find('[name="'+this.options.subfield.get_name()+'"]');return t[this.options.field.get_name()]=e.is(":checkbox")?e.is(":checked")?1:0:e.val(),t[this.options.subfield.get_name()]=i.val(),t}}),v=Upfront.Views.Editor.Field.Checkboxes.extend({multiple:!1}),b=Upfront.Views.Editor.Field.Text.extend({get_label_html:function(){},get_field_html:function(){var t={type:"number",class:"upfront-field upfront-field-counter",min:0,step:1,id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return"<input "+this.get_field_attr_html(t)+" />"}}),y=b.extend({className:"upfront-field-labeled_counter_field",get_field_html:function(){},get_label_html:function(){var t=b.prototype.get_field_html.call(this);return _.template(Upfront.Views.Editor.Field.Text.prototype.get_label_html.call(this),{field:t})}}),w=m.extend({render:function(){this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",'[name="'+this.options.depth.get_name()+'"]',this.stop_prop),this.$el.on("click",'[name="'+this.options.page.get_name()+'"]',this.stop_prop)},stop_prop:function(t){t.stopPropagation(),t.preventDefault()},get_field_html:function(){return this.options.depth.render(),this.options.page.render(),this.options.field.render(),_.template(this.options.field.$el.html(),{depth:this.options.depth.$el.html(),page:this.options.page.$el.html()})},get_value:function(){var t={},e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),i=this.$el.find('[name="'+this.options.depth.get_name()+'"]'),n=this.$el.find('[name="'+this.options.page.get_name()+'"]');return t[this.options.field.get_name()]=e.is(":checkbox")?e.is(":checked")?1:0:e.val(),t[this.options.depth.get_name()]=i.val(),t[this.options.page.get_name()]=n.val(),t}}),k=e.extend({panels:{Appearance:{mainDataCollection:"ucommentPresets",styleElementPrefix:"ucomment-preset",ajaxActionSlug:"ucomment",panelTitle:r.settings,presetDefaults:Upfront.mainData.presetDefaults.ucomment,styleTpl:n}},title:r.settings}),$=Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-comment"),this.$el.html(r.element_name)},add_element:function(){var t=new s,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c11 upfront-comment_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(375)}],objects:[t]});this.add_module(e)}});Upfront.Events.on("application:mode:after_switch",function(){return Upfront.Application.get_current()===Upfront.Application.MODE.THEME&&void o()}),o(),Upfront.Models.UcommentModel=s,Upfront.Views.UcommentView=a})}(jQuery),define("text!elements/upfront-contact-form/templates/preset-style.html",[],function(){return"/* Contact presets Typography Normal state */\n#page .<?php echo $properties['id'] ?> .upfront-field-container label {\n\t<?php if(!empty($properties['field-labels-static-font-family'])) { ?>font-family: <?php echo $properties['field-labels-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-font-size'])) { ?>font-size: <?php echo $properties['field-labels-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-weight'])) { ?>font-weight: <?php echo $properties['field-labels-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-style'])) { ?>font-style: <?php echo $properties['field-labels-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-line-height'])) { ?>line-height: <?php echo $properties['field-labels-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-labels-static-font-color'])) { ?>color: <?php echo $properties['field-labels-static-font-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea {\n\t<?php if(!empty($properties['field-values-static-font-family'])) { ?>font-family: <?php echo $properties['field-values-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-static-font-size'])) { ?>font-size: <?php echo $properties['field-values-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-static-weight'])) { ?>font-weight: <?php echo $properties['field-values-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-style'])) { ?>font-style: <?php echo $properties['field-values-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-line-height'])) { ?>line-height: <?php echo $properties['field-values-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-values-static-font-color'])) { ?>color: <?php echo $properties['field-values-static-font-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button{\n\t<?php if(!empty($properties['button-static-font-family'])) { ?>font-family: <?php echo $properties['button-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-static-font-size'])) { ?>font-size: <?php echo $properties['button-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-static-weight'])) { ?>font-weight: <?php echo $properties['button-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-style'])) { ?>font-style: <?php echo $properties['button-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-line-height'])) { ?>line-height: <?php echo $properties['button-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['button-static-font-color'])) { ?>color: <?php echo $properties['button-static-font-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } ?>\n}\n\n/* Contact presets Typography Hover state */\n\n<?php if(!empty($properties['hover-use-typography']) && $properties['hover-use-typography'] == 'yes') { ?>\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container label:hover {\n\t<?php if(!empty($properties['field-labels-hover-font-family'])) { ?>font-family: <?php echo $properties['field-labels-hover-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-labels-hover-font-size'])) { ?>font-size: <?php echo $properties['field-labels-hover-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-labels-hover-weight'])) { ?>font-weight: <?php echo $properties['field-labels-hover-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-hover-style'])) { ?>font-style: <?php echo $properties['field-labels-hover-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-hover-line-height'])) { ?>line-height: <?php echo $properties['field-labels-hover-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-labels-hover-font-color'])) { ?>color: <?php echo $properties['field-labels-hover-font-color']  ?>; <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n\t<?php if(!empty($properties['field-values-hover-font-family'])) { ?>font-family: <?php echo $properties['field-values-hover-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-hover-font-size'])) { ?>font-size: <?php echo $properties['field-values-hover-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-hover-weight'])) { ?>font-weight: <?php echo $properties['field-values-hover-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-hover-style'])) { ?>font-style: <?php echo $properties['field-values-hover-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-hover-line-height'])) { ?>line-height: <?php echo $properties['field-values-hover-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-values-hover-font-color'])) { ?>color: <?php echo $properties['field-values-hover-font-color']  ?>; <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n\t<?php if(!empty($properties['button-hover-font-family'])) { ?>font-family: <?php echo $properties['button-hover-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-hover-font-size'])) { ?>font-size: <?php echo $properties['button-hover-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-hover-weight'])) { ?>font-weight: <?php echo $properties['button-hover-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-hover-style'])) { ?>font-style: <?php echo $properties['button-hover-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-hover-line-height'])) { ?>line-height: <?php echo $properties['button-hover-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['button-hover-font-color'])) { ?>color: <?php echo $properties['button-hover-font-color']  ?>; <?php } ?>\n}\n\n<?php } else { ?>\n\n/* If typography checkbox is unchecked use normal state settings on hover */\n#page .<?php echo $properties['id'] ?> .upfront-field-container label:hover {\n\t<?php if(!empty($properties['field-labels-static-font-family'])) { ?>font-family: <?php echo $properties['field-labels-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-font-size'])) { ?>font-size: <?php echo $properties['field-labels-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-labels-static-weight'])) { ?>font-weight: <?php echo $properties['field-labels-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-style'])) { ?>font-style: <?php echo $properties['field-labels-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-labels-static-line-height'])) { ?>line-height: <?php echo $properties['field-labels-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-labels-static-font-color'])) { ?>color: <?php echo $properties['field-labels-static-font-color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n\t<?php if(!empty($properties['field-values-static-font-family'])) { ?>font-family: <?php echo $properties['field-values-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-static-font-size'])) { ?>font-size: <?php echo $properties['field-values-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-static-weight'])) { ?>font-weight: <?php echo $properties['field-values-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-style'])) { ?>font-style: <?php echo $properties['field-values-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-line-height'])) { ?>line-height: <?php echo $properties['field-values-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-values-static-font-color'])) { ?>color: <?php echo $properties['field-values-static-font-color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n\t<?php if(!empty($properties['button-static-font-family'])) { ?>font-family: <?php echo $properties['button-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-static-font-size'])) { ?>font-size: <?php echo $properties['button-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-static-weight'])) { ?>font-weight: <?php echo $properties['button-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-style'])) { ?>font-style: <?php echo $properties['button-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-line-height'])) { ?>line-height: <?php echo $properties['button-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['button-static-font-color'])) { ?>color: <?php echo $properties['button-static-font-color']  ?>; <?php } ?>\n}\n\n<?php } ?>\n\n/* Contact presets Typography Focus state */\n\n<?php if(!empty($properties['focus-use-typography']) && $properties['focus-use-typography'] == 'yes') { ?>\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n\t<?php if(!empty($properties['field-values-focus-font-family'])) { ?>font-family: <?php echo $properties['field-values-focus-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-focus-font-size'])) { ?>font-size: <?php echo $properties['field-values-focus-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-focus-weight'])) { ?>font-weight: <?php echo $properties['field-values-focus-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-focus-style'])) { ?>font-style: <?php echo $properties['field-values-focus-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-focus-line-height'])) { ?>line-height: <?php echo $properties['field-values-focus-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-values-focus-font-color'])) { ?>color: <?php echo $properties['field-values-focus-font-color']  ?>; <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n\t<?php if(!empty($properties['button-focus-font-family'])) { ?>font-family: <?php echo $properties['button-focus-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-focus-font-size'])) { ?>font-size: <?php echo $properties['button-focus-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-focus-weight'])) { ?>font-weight: <?php echo $properties['button-focus-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-focus-style'])) { ?>font-style: <?php echo $properties['button-focus-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-focus-line-height'])) { ?>line-height: <?php echo $properties['button-focus-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['button-focus-font-color'])) { ?>color: <?php echo $properties['button-focus-font-color']  ?>; <?php } ?>\n}\n\n<?php } else { ?>\n\n/* If typography checkbox is unchecked use normal state settings on focus */\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n\t<?php if(!empty($properties['field-values-static-font-family'])) { ?>font-family: <?php echo $properties['field-values-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['field-values-static-font-size'])) { ?>font-size: <?php echo $properties['field-values-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['field-values-static-weight'])) { ?>font-weight: <?php echo $properties['field-values-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-style'])) { ?>font-style: <?php echo $properties['field-values-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['field-values-static-line-height'])) { ?>line-height: <?php echo $properties['field-values-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['field-values-static-font-color'])) { ?>color: <?php echo $properties['field-values-static-font-color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n\t<?php if(!empty($properties['button-static-font-family'])) { ?>font-family: <?php echo $properties['button-static-font-family']  ?>; <?php } ?>\n    <?php if(!empty($properties['button-static-font-size'])) { ?>font-size: <?php echo $properties['button-static-font-size']  ?>px; <?php } ?>\n    <?php if(!empty($properties['button-static-weight'])) { ?>font-weight: <?php echo $properties['button-static-weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-style'])) { ?>font-style: <?php echo $properties['button-static-style']  ?>;<?php } ?>\n    <?php if(!empty($properties['button-static-line-height'])) { ?>line-height: <?php echo $properties['button-static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['button-static-font-color'])) { ?>color: <?php echo $properties['button-static-font-color']  ?>; <?php } ?>\n}\n\n<?php } ?>\n\n/* Colors module */\n#page .<?php echo $properties['id'] ?> .upfront-field-container input,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea {\n\t<?php if(!empty($properties['static-field-bg'])) { ?>background: <?php echo $properties['static-field-bg']  ?>;<?php } ?>\n\t<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n\t<?php if(!empty($properties['hover-use-color']) && $properties['hover-use-color'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover-field-bg'])) { ?>background: <?php echo $properties['hover-field-bg']  ?>;<?php } ?>\n\t<?php } else { ?>\n\tbackground: <?php echo $properties['static-field-bg']  ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n\t<?php if(!empty($properties['focus-use-color']) && $properties['focus-use-color'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus-field-bg'])) { ?>background: <?php echo $properties['focus-field-bg']  ?>;<?php } ?>\n\t<?php } else { ?>\n\tbackground: <?php echo $properties['static-field-bg']  ?>;\n\t<?php } ?>\n}\n\n#page .upfront-contact-form.<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button {\n\t<?php if(!empty($properties['static-button-bg'])) { ?> background: <?php echo $properties['static-button-bg']  ?>;<?php } ?>\n\t<?php if(!empty($properties['hover-use-transition']) && !empty($properties['hover-transition-duration']) && !empty($properties['hover-transition-easing'] )) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration'] ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } ?>\n}\n\n#page .upfront-contact-form.<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n\t<?php if(!empty($properties['hover-use-color']) && $properties['hover-use-color'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover-button-bg'])) { ?>background: <?php echo $properties['hover-button-bg']  ?>;<?php } ?>\n\t<?php } else { ?>\n\tbackground: <?php echo $properties['static-button-bg']  ?>;\n\t<?php } ?>\n}\n\n#page .upfront-contact-form.<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n\t<?php if(!empty($properties['focus-use-color']) && $properties['focus-use-color'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus-button-bg'])) { ?>background: <?php echo $properties['focus-button-bg']  ?>;<?php } ?>\n\t<?php } else { ?>\n\tbackground: <?php echo $properties['static-button-bg']  ?>;\n\t<?php } ?>\n}\n\n/* Borders Module */\n\n/* Fields */\n#page .<?php echo $properties['id'] ?> .upfront-field-container input,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea {\n<?php if(!empty($properties['static-fields-useborder']) && $properties['static-fields-useborder'] == 'yes') { ?>\n\t<?php if(!empty($properties['static-fields-borderwidth']) && !empty($properties['static-fields-bordertype']) && !empty($properties['static-fields-bordercolor'])) { ?>\n\t\tborder: <?php echo $properties['static-fields-borderwidth'] ?>px <?php echo $properties['static-fields-bordertype'] ?> <?php echo $properties['static-fields-bordercolor'] ?>;\n\t<?php } ?>\n<?php } else { ?>\n\t\tborder: none;\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:hover,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:hover {\n<?php if(!empty($properties['hover-fields-useborder']) && $properties['hover-fields-useborder'] == 'yes') { ?>\n\t<?php if(!empty($properties['hover-fields-borderwidth']) && !empty($properties['hover-fields-bordertype']) && !empty($properties['hover-fields-bordercolor'])) { ?>\n\t\tborder: <?php echo $properties['hover-fields-borderwidth'] ?>px <?php echo $properties['hover-fields-bordertype'] ?> <?php echo $properties['hover-fields-bordercolor'] ?>;\n\t<?php } ?>\n<?php } else { ?>\n\t<?php if(!empty($properties['static-fields-useborder'])) { ?>\n\t\t<?php if(!empty($properties['static-fields-borderwidth']) && !empty($properties['static-fields-bordertype']) && !empty($properties['static-fields-bordercolor'])) { ?>\n\t\t\tborder: <?php echo $properties['static-fields-borderwidth'] ?>px <?php echo $properties['static-fields-bordertype'] ?> <?php echo $properties['static-fields-bordercolor'] ?>;\n\t\t<?php } ?>\n\t<?php } else { ?>\n\t\tborder: none;\n\t<?php } ?>\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container input:focus,\n#page .<?php echo $properties['id'] ?> .upfront-field-container textarea:focus {\n<?php if(!empty($properties['focus-fields-useborder']) && $properties['focus-fields-useborder'] == 'yes') { ?>\n\t<?php if(!empty($properties['focus-fields-borderwidth']) && !empty($properties['focus-fields-bordertype']) && !empty($properties['focus-fields-bordercolor'])) { ?>\n\t\tborder: <?php echo $properties['focus-fields-borderwidth'] ?>px <?php echo $properties['focus-fields-bordertype'] ?> <?php echo $properties['focus-fields-bordercolor'] ?>;\n\t<?php } ?>\n<?php } else { ?>\n\t<?php if(!empty($properties['static-fields-useborder'])) { ?>\n\t\t<?php if(!empty($properties['static-fields-borderwidth']) && !empty($properties['static-fields-bordertype']) && !empty($properties['static-fields-bordercolor'])) { ?>\n\t\t\tborder: <?php echo $properties['static-fields-borderwidth'] ?>px <?php echo $properties['static-fields-bordertype'] ?> <?php echo $properties['static-fields-bordercolor'] ?>;\n\t\t<?php } ?>\n\t<?php } else { ?>\n\t\tborder: none;\n\t<?php } ?>\n<?php } ?>\n}\n\n/* Button */\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button {\n<?php if(!empty($properties['static-button-useborder']) && $properties['static-button-useborder'] == 'yes') { ?>\n\t<?php if(!empty($properties['static-button-borderwidth']) && !empty($properties['static-button-bordertype']) && !empty($properties['static-button-bordercolor'])) { ?>\n\t\tborder: <?php echo $properties['static-button-borderwidth'] ?>px <?php echo $properties['static-button-bordertype'] ?> <?php echo $properties['static-button-bordercolor'] ?>;\n\t<?php } ?>\n<?php } else { ?>\n\t\tborder: none;\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:hover {\n<?php if(!empty($properties['hover-button-useborder']) && $properties['hover-button-useborder'] == 'yes') { ?>\n\t<?php if(!empty($properties['hover-button-borderwidth']) && !empty($properties['hover-button-bordertype']) && !empty($properties['hover-button-bordercolor'])) { ?>\n\t\tborder: <?php echo $properties['hover-button-borderwidth'] ?>px <?php echo $properties['hover-button-bordertype'] ?> <?php echo $properties['hover-button-bordercolor'] ?>;\n\t<?php } ?>\n<?php } else { ?>\n\t<?php if(!empty($properties['static-button-useborder'])) { ?>\n\t\t<?php if(!empty($properties['static-button-borderwidth']) && !empty($properties['static-button-bordertype']) && !empty($properties['static-button-bordercolor'])) { ?>\n\t\t\tborder: <?php echo $properties['static-button-borderwidth'] ?>px <?php echo $properties['static-button-bordertype'] ?> <?php echo $properties['static-button-bordercolor'] ?>;\n\t\t<?php } ?>\n\t<?php } else { ?>\n\t\tborder: none;\n\t<?php } ?>\n<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-field-container.upfront-submit-container .button:focus {\n<?php if(!empty($properties['focus-button-useborder']) && $properties['focus-button-useborder'] == 'yes') { ?>\n\t<?php if(!empty($properties['focus-button-borderwidth']) && !empty($properties['focus-button-bordertype']) && !empty($properties['focus-button-bordercolor'])) { ?>\n\t\tborder: <?php echo $properties['focus-button-borderwidth'] ?>px <?php echo $properties['focus-button-bordertype'] ?> <?php echo $properties['focus-button-bordercolor'] ?>;\n\t<?php } ?>\n<?php } else { ?>\n\t<?php if(!empty($properties['static-button-useborder'])) { ?>\n\t\t<?php if(!empty($properties['static-button-borderwidth']) && !empty($properties['static-button-bordertype']) && !empty($properties['static-button-bordercolor'])) { ?>\n\t\t\tborder: <?php echo $properties['static-button-borderwidth'] ?>px <?php echo $properties['static-button-bordertype'] ?> <?php echo $properties['static-button-bordercolor'] ?>;\n\t\t<?php } ?>\n\t<?php } else { ?>\n\t\tborder: none;\n\t<?php } ?>\n<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n";
}),define("elements/upfront-contact-form/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-contact-form/templates/preset-style.html"],function(t,e,i,n){var o=Upfront.Settings.l10n.contact_element,r=e.extend({label:"Empty label",title:o.general.label,settings:[{type:"SettingsItem",title:o.contact_details,className:"general_settings_item",fields:[{type:"Email",property:"form_email_to",label:o.general.send_to}]},{type:"SettingsItem",title:o.fields.label,className:"general_settings_item multiple_radio_no_padding",fields:[{type:"Optional",property:"show_subject",relatedField:"form_subject_label",values:[{label:o.fields.show_subject,value:"true"}]},{type:"Optional",property:"show_captcha",relatedField:"form_captcha_label",values:[{label:o.fields.show_captcha,value:"true"}]},{type:"Select",className:"contact_label_position",layout:"vertical",label:o.fields.label_localtion,change:function(t,e){e.model.set_property("form_label_position",t)},property:"form_label_position",values:[{label:o.apr.above,value:"above",icon:"contact-above-field"},{label:o.apr.over,value:"over",icon:"contact-over-field"},{label:o.apr.inline,value:"inline",icon:"contact-inline-field"}]}]},{type:"SettingsItem",title:o.validation.label,className:"general_settings_item",fields:[{type:"Radios",className:"inline-radios plaintext-settings",property:"form_validate_when",values:[{label:o.validation.on_field,value:"field"},{label:o.validation.on_submit,value:"submit"}]}]}]}),s=t.extend({panels:{General:r,Appearance:{mainDataCollection:"contactPresets",styleElementPrefix:"contact-preset",ajaxActionSlug:"contact",panelTitle:o.settings,presetDefaults:Upfront.mainData.presetDefaults.contact,styleTpl:n,stateModules:{Static:[{moduleType:"Colors",options:{title:o.colors_label,multiple:!1,single:!1,abccolors:[{name:"static-field-bg",label:o.field_bg_label},{name:"static-button-bg",label:o.button_bg_label}]}},{moduleType:"Typography",options:{title:o.typography_label,state:"static",toggle:!1,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"},default_element:"field-labels",elements:[{label:o.field_labels_label,value:"field-labels"},{label:o.field_values_label,value:"field-values"},{label:o.button_label,value:"button"}]}},{moduleType:"Border",options:{state:"static-fields",title:"",label:"Fields Border",fields:{use:"static-fields-useborder",width:"static-fields-borderwidth",type:"static-fields-bordertype",color:"static-fields-bordercolor"}}},{moduleType:"Border",options:{state:"static-button",title:"",label:"Button Border",fields:{use:"static-button-useborder",width:"static-button-borderwidth",type:"static-button-bordertype",color:"static-button-bordercolor"}}}],Hover:[{moduleType:"Colors",options:{title:o.colors_label,multiple:!1,single:!1,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-color"},abccolors:[{name:"hover-field-bg",label:o.field_bg_label},{name:"hover-button-bg",label:o.button_bg_label}]}},{moduleType:"Typography",options:{title:o.typography_label,state:"hover",toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"},default_element:"field-labels",elements:[{label:o.field_labels_label,value:"field-labels"},{label:o.field_values_label,value:"field-values"},{label:o.button_label,value:"button"}]}},{moduleType:"Border",options:{state:"hover-fields",title:"",label:"Fields Border",prepend:"hover-",prefix:"static",fields:{use:"hover-fields-useborder",width:"hover-fields-borderwidth",type:"hover-fields-bordertype",color:"hover-fields-bordercolor"}}},{moduleType:"Border",options:{state:"hover-button",title:"",label:"Button Border",prepend:"hover-",prefix:"static",fields:{use:"hover-button-useborder",width:"hover-button-borderwidth",type:"hover-button-bordertype",color:"hover-button-bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hover-use-transition",duration:"hover-transition-duration",easing:"hover-transition-easing"}}}],Focus:[{moduleType:"Colors",options:{title:o.colors_label,multiple:!1,single:!1,toggle:!0,prepend:"focus-",prefix:"static",fields:{use:"focus-use-color"},abccolors:[{name:"focus-field-bg",label:o.field_bg_label},{name:"focus-button-bg",label:o.button_bg_label}]}},{moduleType:"Typography",options:{title:o.typography_label,state:"focus",prepend:"focus-",prefix:"static",toggle:!0,fields:{use:"focus-use-typography",typeface:"focus-font-family",fontstyle:"focus-font-style",weight:"focus-weight",style:"focus-style",size:"focus-font-size",line_height:"focus-line-height",color:"focus-font-color"},default_element:"field-labels",elements:[{label:o.field_values_label,value:"field-values"},{label:o.button_label,value:"button"}]}},{moduleType:"Border",options:{state:"focus-fields",title:"",label:"Fields Border",prepend:"focus-",prefix:"static",fields:{use:"focus-fields-useborder",width:"focus-fields-borderwidth",type:"focus-fields-bordertype",color:"focus-fields-bordercolor"}}},{moduleType:"Border",options:{state:"focus-button",title:"",label:"Button Border",prepend:"focus-",prefix:"static",fields:{use:"focus-button-useborder",width:"focus-button-borderwidth",type:"focus-button-bordertype",color:"focus-button-bordercolor"}}}]},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-contact-form\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")}}},title:"Contact Element"});return i.generatePresetsToPage("contact",n),s}),function(t){define("ucontact",["upfront-data","elements/upfront-contact-form/js/settings","text!elements/upfront-contact-form/templates/preset-style.html","scripts/upfront/preset-settings/util"],function(e,i,n,o){var r=e.data&&e.data.ucontact&&e.data.ucontact.template?e.data.ucontact.template:"elements/upfront-contact-form/templates/ucontact.html";require(["text!"+r],function(e){var r=Upfront.Settings.l10n.contact_element,s=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.ucontact.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),a=Upfront.Views.ObjectView.extend({tpl:Upfront.Util.template(e),initialize:function(t){this.model instanceof s||(this.model=new s({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[t]),Upfront.Events.on("command:layout:save_success",this.checkDeleteElement,this),this.events=_.extend({},this.events,{"click button.submit-field":"handleButtonclick","click .upfront-field-container label":"handleButtonclick","dblclick button.submit-field":"editButtontext","dblclick .upfront-field-container > label":"editLabeltext"}),this.delegateEvents(),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this)},update_colors:function(){var t=this.model.get_property_value_by_name("preset"),e=o.getPresetProperties("contact",t)||{};return!(_.size(e)<=0)&&void o.updatePresetStyle("contact",e,n)},on_render:function(){if(Upfront.Application.user_can_modify_layout()){var e=this;$button=this.$el.find("button.submit-field > span"),$button.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["upfrontLink","stateAlignCTA","upfrontIcons"],autostart:!1}).on("stop",function(){var t=($button.data("ueditor"),"");try{t=$button.text()}catch(e){t=""}t&&e.model.set_property("form_button_text",t,!0)}),$labels=this.$el.find(".upfront-field-container > label"),$labels.each(function(){$label=t(this),$label.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["upfrontIcons"],autostart:!1}).on("start",function(e){t(e.target).closest(".upfront-field-container").children("input, textarea").attr("placeholder",""),t(e.target).css("opacity",1)}).on("stop",function(i){$label=t(this);var n=($label.data("ueditor"),"");if("over"==e.model.get_property_value_by_name("form_label_position"))$label.find("span").remove(),n=$label.text(),t(i.target).closest(".upfront-field-container").children("input, textarea").attr("placeholder",n),t(i.target).css("opacity",0);else try{n=$label.text()}catch(t){n=""}var o=!1;"sendername"==$label.attr("for")?o="form_name_label":"senderemail"==$label.attr("for")?o="form_email_label":"sendermessage"==$label.attr("for")?o="form_message_label":"subject"==$label.attr("for")?o="form_subject_label":"realPerson"==$label.attr("for")&&(o="form_captcha_label"),n&&o&&e.model.set_property(o,n,!0)}),"over"==e.model.get_property_value_by_name("form_label_position")&&($label.css("opacity",0),$label.siblings("input, textarea").attr("placeholder",$label.text()))})}},handleButtonclick:function(t){t.preventDefault()},editButtontext:function(t){if(t.preventDefault(),t.stopPropagation(),Upfront.Application.user_can_modify_layout()){$button=this.$el.find("button.submit-field > span");var e=$button.data("ueditor");"undefined"!=typeof e&&e.start()}},editLabeltext:function(e){if(e.preventDefault(),e.stopPropagation(),Upfront.Application.user_can_modify_layout()){$label=t(e.target),$label.css("opacity",1);var i=$label.data("ueditor");i.start()}},checkDeleteElement:function(){},get_content_markup:function(){var t=_.extend({},this.extract_properties(),{message:!1,field_classes:this.getFieldStyleClass(),validate:"",entity_id:"",placeholders:{},ids:{name:"sendername",email:"senderemail",message:"sendermessage",subject:"subject",captcha:"realPerson"},values:{}});return t.preset=t.preset||"default",t.show_subject=t.show_subject&&t.show_subject.length,t.show_captcha=t.show_captcha&&t.show_captcha.length,t.form_add_title=t.form_add_title&&t.form_add_title.length,t.l10n=r.template,this.tpl(t)},property_value:function(t){return this.model.get_property_value_by_name(t)},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t},getFieldStyleClass:function(){return" ucontact-label-"+this.property_value("form_label_position")},getPlaceholder:function(t){return"over"==this.property_value("form_label_position")?'placeholder="'+this.property_value(t)+'"':""}}),l=Upfront.Views.Editor.Sidebar.Element.extend({priority:110,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-contact"),this.$el.html(r.element_name)},add_element:function(){var t=new s,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c12 upfront-contact_form_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(435)}],objects:[t]});this.add_module(e)}});Upfront.Application.LayoutEditor.add_object("Ucontact",{Model:s,View:a,Element:l,Settings:i,cssSelectors:{label:{label:r.css.labels_label,info:r.css.labels_info},".ucontact-input":{label:r.css.fields_label,info:r.css.fields_info},".textarea-field":{label:r.css.msg_label,info:r.css.msg_info},".ucontact-field-error":{label:r.css.err_label,info:r.css.err_info},".submit-field":{label:r.css.send_label,info:r.css.send_info}},cssSelectorsId:Upfront.data.ucontact.defaults.type}),Upfront.Models.UcontactModel=s,Upfront.Views.UcontactView=a})})}(jQuery),define("text!elements/upfront-gallery/tpl/ugallery.html",[],function(){return"<div\n\tclass=\"ugallery ugallery_publish <?php if(!empty($in_editor)) { ?>ugallery-in-editor<?php } ?>\"\n\tdata-thumb-padding=\"<?php echo $thumbPadding ?>\"\n\tdata-thumb-side-padding=\"<?php echo $sidePadding ?>\"\n\tdata-thumb-bottom-padding=\"<?php echo $bottomPadding ?>\"\n\tdata-thumb-proportions=\"<?php echo $thumbProportions ?>\"\n\tdata-thumb-lock-padding=\"<?php echo $lockPadding ?>\"\n\tdata-lightbox-show-close=\"<?php echo $lightbox_show_close ? 'true' : 'false' ?>\"\n\tdata-lightbox-click-out-close=\"<?php echo $lightbox_click_out_close ? 'true' : 'false' ?>\"\n\tdata-lightbox-show-image-count=\"<?php echo $lightbox_show_image_count ? 'true' : 'false' ?>\"\n\tdata-lightbox-active-area-bg=\"<?php echo $lightbox_active_area_bg ?>\"\n\tdata-lightbox-overlay-bg=\"<?php echo $lightbox_overlay_bg ?>\"\n\tdata-styles=\"<?php echo $styles ?>\"\n>\n<?php if ($labelFilters === 'true' || !empty($in_editor)){ ?>\n<div class=\"ugallery_labels <?php if($in_editor) { ?>ugallery_labels-enabled-<?php echo $labelFilters === 'true' ? '1' : '0' ?><?php } ?>\">\n\t<?php for($i=0; $i<$labels_length; $i++) { ?>\n\t\t<a href=\"#\" class=\"ugallery_label_filter <?php echo $i == 0 ? 'filter_selected' : '' ?>\" rel=\"label_<?php echo $labels[$i]['id'] ?>\"><?php echo $labels[$i]['text'] ?></a>\n\t<?php } ?>\n\t</div>\n<?php } ?>\n<?php if($imagesLength){ ?>\n\t<div class=\"ugallery_items ugallery_grid\" rel=\"<?php echo $element_id ?>\">\n\t<?php for($i=0; $i<$imagesLength; $i++) { ?>\n\t<div class=\"ugallery_item <?php if($in_editor) { ?>upfront-editing<?php } ?> ugallery_item_<?php echo !empty($images[$i]['imageLinkType']) && $images[$i]['imageLinkType'] == 'image' ? 'image' : $images[$i]['imageLinkType'] ?> <?php if($captionType === 'over') { ?>ugallery_caption_on_hover_<?php echo $showCaptionOnHover['length'] ?><?php } ?>\" style=\"position:relative; width:<?php echo $thumbWidth ?>px;\" rel=\"<?php echo $images[$i]['id'] ?>\" data-groups='[<?php echo $image_labels[$images[$i]['id']] ?>]'>\n\t\t<?php $images[$i]['imageLinkType'] = !empty($images[$i]['imageLinkType']) ? $images[$i]['imageLinkType'] : false; ?>\n\t\t  <?php if ($images[$i]['imageLinkType'] !== 'unlink') { ?>\n\t\t\t<a class=\"ugallery_link ugallery_link<?php echo !empty($images[$i]['imageLinkType']) && $images[$i]['imageLinkType'] == 'image' ? ' ugallery_lightbox_link' : $images[$i]['imageLinkType'] ?>\" href=\"<?php echo $images[$i]['imageLinkUrl'] ?>\" target=\"<?php echo $images[$i]['imageLinkTarget'] ?>\" title=\"\">\n\t\t\t<?php } ?>\n\t\t\t\t<span class=\"ugallery_border\">\n\t\t\t\t\t<img src=\"<?php echo $images[$i]['src'] ?>\" alt=\"\" class=\"ugallery-image\" style=\"<?php echo !empty($images[$i]['loading']) && $images[$i]['loading'] ? 'display:none;' : '' ?> margin-left:<?php echo $images[$i]['margin']['left'] ?>px;  margin-top:<?php echo $images[$i]['margin']['top'] ?>px;width:<?php echo $thumbWidth ?>px; height:<?php echo $thumbHeight ?>px\">\n\t\t\t\t</span>\n\n\t\t\t\t<?php if ($usingNewAppearance === false) { ?>\n\t\t\t\t\t<?php if($captionType != 'none' || !empty($in_editor)) { ?>\n\t\t\t\t\t<div class=\"ugallery-thumb-title <?php if($captionType === 'over') { ?>ugallery-caption-on-hover-<?php echo $showCaptionOnHover['length'] ?><?php } ?> ugallery-caption-<?php echo $captionType ?><?php echo $captionUseBackground ? ' ugallery-padded-caption' : '' ?>\"><?php echo $images[$i]['title'] ?></div>\n\t\t\t\t\t<?php } ?>\n\t\t\t\t<?php } else { ?>\n\t\t\t\t\t<?php if(($properties['captionType'] != 'none' || !empty($in_editor)) && !empty($properties['use_captions'])) { ?>\n\t\t\t\t\t<div class=\"ugallery-thumb-title <?php if($properties['captionType'] === 'over') { ?>ugallery-caption-on-hover-<?php echo $properties['showCaptionOnHover'] ?><?php } ?> ugallery-caption-<?php echo $properties['captionType'] ?>\"><?php echo $images[$i]['title'] ?></div>\n\t\t\t\t\t<?php } ?>\n\t\t\t\t<?php } ?>\n\t\t\t<?php if($linkTo == 'image'){ ?>\n\t\t\t<div class=\"ugallery_lb_text\" rel=\"<?php echo $images[$i]['id'] ?>\"><?php if (!$editing && $images[$i]['caption'] != 'Image description') { ?><?php echo $images[$i]['caption'] ?><?php } ?></div>\n\t\t\t<?php } ?>\n\n\t\t\t<?php if ($images[$i]['imageLinkType'] !== 'unlink') { ?>\n\t\t\t</a>\n\t\t\t<?php } ?>\n\n\t\t\t<?php if(!empty($in_editor)) { ?>\n\t\t\t<i class=\"remove-image\"></i>\n\t\t\t<?php } ?>\n\n\t\t</div><?php } ?>\n\t</div>\n<?php } else { ?>\n\t<?php if(! $editing) { ?>\n\t\t<?php echo $l10n['no_images'] ?>\n\t<?php } else { ?>\n\t\t<?php if($cap) { ?>\n\t\t<div class=\"ugallery-starting-wrapper upfront-ui upfront-initial-overlay-wrapper\">\n\t\t\t\t<div class=\"ugallery-starting-container upfront-initial-overlay-wrapper\">\n\t\t\t\t\t<span class=\"upfront-image-resizethiselement\"><?php echo $l10n['add_img'] ?></span>\n\t\t\t\t\t<div class=\"\"><a class=\"upfront-image-select button\" href=\"#\" title=\"<?php echo $l10n['add_images'] ?>\">+</a></div>\n\t\t\t\t</div>\n\t\t</div>\n\t\t<?php } else { ?>\n\t\t\t<?php echo $l10n['no_images'] ?>\n\t\t<?php } ?>\n\t<?php } ?>\n<?php } ?>\n</div>\n<?php if ($usingNewAppearance === false) { ?>\n<style>\n#<?php echo $element_id ?> .ugallery-thumb-title {\n\tbackground: <?php echo  $captionBackground ?>;\n\t<?php if($fitThumbCaptions[0] === 'true') { ?>\n\toverflow: hidden;\n\theight: <?php echo $thumbCaptionsHeight ?>px;\n\t<?php } ?>\n}\n</style>\n<?php } ?>\n"}),define("text!elements/upfront-gallery/tpl/sorting-style.html",[],function(){return'<style id="sorting-style">\n\t#{{ element_id }} .ugallery_item {\n\t\tmargin-right: {{ thumbPadding }}px;\n\t\t{[ if (even_padding.length) { ]}\n\t\tmargin-bottom: {{ thumbPadding }}px;\n\t\t{[ } ]}\n\t}\n\t#{{ element_id }} .ugallery_item:nth-child({{ itemsInRow }}n) {\n\t\tmargin-right: 0;\n\t}\n</style>\n'}),define("text!elements/upfront-gallery/tpl/ugallery_editor.html",[],function(){return'<div>\r\n<!--\r\n\tWrap everything in a div to convert this file\'s content in a jquery element\r\n\tso it is possible to use $.find.\r\n-->\r\n\r\n<script type="text/template" id="selector-tpl">\r\n\t<div id="upront-image-placeholder" class="upfront-image-section">\r\n\t\t<div class="upfront-image-selector-container">\r\n\t\t\t<h2>{{ l10n.drop_images }}</h2>\r\n\t\t\tor<br>\r\n\t\t\t<a class="button select-files" href="#">{{ l10n.select_images }}</a>\r\n\t\t\t<div id="upfront-image-maxsize">{{ l10n.max_upload_size }}</div>\r\n\t\t\t{{ l10n.or_browse }}\r\n\t\t\t<div class="upfront-image-media-container">\r\n\t\t\t<i class="icon-picture"></i> <a class="open-media-gallery" href="#">{{ l10n.media_gallery }}</a>\r\n\t\t\t</div>\r\n\t\t\t<span class="dragimagehand"></span>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="progress-tpl">\r\n\t<div id="upfront-image-uploading" class="upfront-image-section">\r\n\t\t<h2>{{ l10n.uploading }}</h2>\r\n\t\t<div class="upfront-progress-container">\r\n\t\t\t<div id="upfront-progress"></div>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n<script type="text/template" id="editor-tpl">\r\n\t<div id="upfront-image-edit" class="upfront-image-section">\r\n\t\t<div id="uimage-canvas-container" style="position:absolute">\r\n\t\t\t<div id="uimage-canvas" style="position:relative; overflow:hidden;">\r\n\t\t\t\t<img class="uimage-img {{ rotation }}" src="{{src}}" style="width:{{size.width}}px; height:{{size.height}}px;position:absolute">\r\n\t\t\t\t<div id="uimage-mask" class="image-edit-mask" style="position:absolute; top:{{offset.top}}px; left:{{offset.left}}px"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class="image-edit-resize image-edit-control"><i class="icon-resize-full ui-resizable-handle ui-resizable-handle-se"></i></div>\r\n\t\t\t<div class="image-edit-rotate image-edit-control"><i class="icon-repeat"></i></div>\r\n\t\t</div>\r\n\t\t<div class="image-edit-save-container">\r\n\t\t\t<div class="no-shadow">\r\n\t\t\t\t<a class="image-edit-save" href="#"><i class="icon-ok"></i> {{ l10n.like }}</a>\r\n\t\t\t\t<a class="image-edit-change" href="#"><i class="icon-upload-alt "></i> {{ l10n.upload_different }}</a>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n\r\n<script type="text/template" id="upload-form-tpl">\r\n<form id="upfront-upload-image" name="upfront-upload-image" enctype="multipart/form-data" method="post" action="{{url}}">\r\n\t<input type="file" name="media[]" id="upfront-image-file-input" multiple="multiple">\r\n\t<input type="hidden" name="action" value="upfront-media-upload">\r\n\t<input type="submit" value="{{ l10n.upload }}">\r\n</form>\r\n</script>\r\n\r\n<script type="text/template" id="details-tpl">\r\n<div class="upfront-settings-panel">\r\n\t<input type="hidden" id="ugallery-image-id" value="{{id}}">\r\n\t<h3>{{ l10n.edit_details }}</h3>\r\n\t<div class="upfront-field-wrap">\r\n\t\t<label for="ugallery-image-title">{{ l10n.title }}</label>\r\n\t\t<input type="text" name="ugallery-image-title" value="{{title}}" class="upfront-field-text">\r\n\t</div>\r\n\t<div class="upfront-field-wrap">\r\n\t\t<label for="ugallery-image-title">{{ l10n.caption }}</label>\r\n\t\t<input type="text" name="ugallery-image-caption" value="{{caption}}" class="upfront-field-text">\r\n\t</div>\r\n\t<div class="upfront-field-wrap">\r\n\t\t<label for="ugallery-image-title">{{ l10n.alt }}</label>\r\n\t\t<input type="text" name="ugallery-image-alt" value="{{alt}}" class="upfront-field-text">\r\n\t</div>\r\n\t<div class="upfront-settings-button_panel">\r\n\t\t<button type="button" class="upfront-save_settings"><i class="icon-ok"></i> {{ l10n.ok }}</button>\r\n\t</div>\r\n\r\n\t<div class="upfront-field-wrap upfront-additive_multiselection upfront-media-controls ">\r\n\t\t<label for="ugallery-image-labels">{{ l10n.labels }}</label>\r\n\t\t<div class="existing_labels">\r\n\t\t<a href="#remove" class="upfront-icon upfront-icon-media-label-delete" data-idx="2">{{ l10n.wtf }}</a>\r\n\t\t</div>\r\n\t\t<div class="label_selector">\r\n\t\t\t<input type="text" name="ugallery-image-labels" placeholder="{{ l10n.add_new_label }}" class="upfront-field-text">\r\n\t\t\t<div class="labels_list">\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n</div>\r\n</script>\r\n\r\n</div>\r\n'}),define("text!elements/upfront-gallery/tpl/lightbox_settings.html",[],function(){return'<div id="gallery-lb-settings-button" class="upfront-icon-button upfront-icon-button-setting"></div>\n<div class="upfront-inline-modal-wrap" id="gallery-lb-settings">\n\t<div class="upfront-inline-modal-content">\n\t\t<div class="upfront-region-bg-setting-name">\n\t\t\t<div class="upfront-region-bg-setting-name-edit">\n\t\t\t\t<span class="upfront-region-name-edit-value">{{Upfront.Settings.l10n.global.content.gallery_lightbox}}</span>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class="upfront-region-bg-setting-lightbox-region clearfix"></div>\n\n\t\t<div class="upfront-region-bg-setting-footer clearfix">\n\t\t\t<div class="upfront-region-bg-setting-edit-css upfront-icon upfront-icon-edit-css edit-lightbox-css">\n\t\t\t\t<span>{{edit_lightbox_css}}</span>\n\t\t\t</div>\n\t\t</div>\n\t\t<button type="button" class="upfront-inline-modal-save">{{Upfront.Settings.l10n.global.content.ok}}</button>\n\t</div>\n</div>\n'}),define("elements/upfront-gallery/js/settings/thumbnail-fields",["scripts/upfront/element-settings/root-settings-panel"],function(t){var e=Upfront.Settings.l10n.gallery_element,i=function(t,e,i,n){t.set_property(e,i),t.trigger(n)},n=_.debounce(i,1e3),o=t.extend({className:"ugallery-thumbnail-fields upfront-settings_panel",settings:[{type:"SettingsItem",className:"general_settings_item",title:e.thumb.thumb_settings,fields:[{type:"Select",className:"thumb-propostions",property:"thumbProportions",label:e.thumb.ratio,layout:"vertical",default_value:"1",values:[{label:e.thumb.theme,value:"theme",icon:"gallery-crop-theme"},{label:"1:1",value:"1",icon:"gallery-crop-1_1"},{label:"2:3",value:"0.66",icon:"gallery-crop-2_3"},{label:"4:3",value:"1.33",icon:"gallery-crop-4_3"}],change:function(t,e){e.model.set_property("thumbProportions",t),e.model.trigger("change:thumbProportions")}}]},{type:"SettingsItem",className:"general_settings_item",title:e.thumb.size,fields:[{type:"Slider",property:"thumbWidth",className:"thumb-size-slider",min:100,max:250,step:5,label:e.thumb.size,default_value:150,change:function(t,e){var i=e.settings._wrapped[1].fields._wrapped[1];i.get_field().val(t),n(e.model,"thumbWidth",t,"change:thumbWidth")}},{type:"Number",className:"thumb-size-number",property:"thumbWidthNumber",default_value:0,min:100,max:250,change:function(t,e){var i=e.settings._wrapped[1].fields._wrapped[0];i.$el.find("#"+i.get_field_id()).slider("value",t),i.get_field().val(t),i.trigger("changed");var o=e.settings._wrapped[1].fields._wrapped[1];o.get_field().val(t),t>250?e.$el.find(".thumb-size-slider").css("opacity",.6):e.$el.find(".thumb-size-slider").css("opacity",1),n(e.model,"thumbWidth",t,"change:thumbWidth")}}]},{type:"SettingsItem",className:"general_settings_item",title:e.thumb.spacing,fields:[{type:"Checkboxes",className:"gallery-padding-lock",property:"lockPadding",label:"",default_value:"yes",multiple:!1,values:[{label:"",value:"yes"}],change:function(t,e){e.model.set_property("lockPadding",t)},show:function(t,e){"yes"==t?(e.$el.find(".thumb-padding-slider").show(),e.$el.find(".thumb-padding-number").show(),e.$el.find(".thumb-side-padding-slider").hide(),e.$el.find(".thumb-side-padding-number").hide(),e.$el.find(".thumb-bottom-padding-slider").hide(),e.$el.find(".thumb-bottom-padding-number").hide()):(e.$el.find(".thumb-padding-slider").hide(),e.$el.find(".thumb-padding-number").hide(),e.$el.find(".thumb-side-padding-slider").show(),e.$el.find(".thumb-side-padding-number").show(),e.$el.find(".thumb-bottom-padding-slider").show(),e.$el.find(".thumb-bottom-padding-number").show())}},{type:"Slider",property:"thumbPadding",className:"thumb-padding-slider",min:0,max:50,step:1,label:e.thumb.spacing,default_value:15,valueTextFilter:function(t){return t+"px"},change:function(t,e){var i=e.settings._wrapped[2].fields._wrapped[2];i.get_field().val(t),n(e.model,"thumbPadding",t,"change:thumbPadding")}},{type:"Number",className:"thumb-padding-number",property:"thumbPaddingNumber",default_value:15,change:function(t,e){var i=e.settings._wrapped[2].fields._wrapped[1];i.$el.find("#"+i.get_field_id()).slider("value",t),i.get_field().val(t),i.trigger("changed",t);var o=e.settings._wrapped[2].fields._wrapped[2];o.get_field().val(t),t>50?e.$el.find(".thumb-padding-slider").css("opacity",.6):e.$el.find(".thumb-padding-slider").css("opacity",1),n(e.model,"thumbPadding",t,"change:thumbPadding")}},{type:"Slider",property:"sidePadding",className:"thumb-side-padding-slider",min:0,max:50,step:1,label:e.thumb.side_spacing,change:function(t,e){var i=e.settings._wrapped[2].fields._wrapped[4];i.get_field().val(t),n(e.model,"sidePadding",t,"change:thumbPadding")}},{type:"Number",className:"thumb-side-padding-number",property:"thumbSidePaddingNumber",default_value:0,change:function(t,e){var i=e.settings._wrapped[2].fields._wrapped[4];i.get_field().val(t);var o=e.settings._wrapped[2].fields._wrapped[3];o.$el.find("#"+o.get_field_id()).slider("value",t),o.get_field().val(t),o.trigger("changed",t),t>50?e.$el.find(".thumb-side-padding-slider").css("opacity",.6):e.$el.find(".thumb-side-padding-slider").css("opacity",1),n(e.model,"sidePadding",t,"change:thumbPadding")}},{type:"Slider",property:"bottomPadding",className:"thumb-bottom-padding-slider",min:0,max:50,step:1,label:e.thumb.bottom_spacing,change:function(t,e){var i=e.settings._wrapped[2].fields._wrapped[6];i.get_field().val(t),n(e.model,"bottomPadding",t,"change:thumbPadding")}},{type:"Number",className:"thumb-bottom-padding-number",property:"thumbBottomPaddingNumber",default_value:0,change:function(t,e){var i=e.settings._wrapped[2].fields._wrapped[6];i.get_field().val(t);var o=e.settings._wrapped[2].fields._wrapped[5];o.$el.find("#"+o.get_field_id()).slider("value",t),o.get_field().val(t),o.trigger("changed",t),t>50?e.$el.find(".thumb-bottom-padding-slider").css("opacity",.6):e.$el.find(".thumb-bottom-padding-slider").css("opacity",1),n(e.model,"bottomPadding",t,"change:thumbPadding")}}]},{type:"SettingsItem",className:"general_settings_item",title:"Label filters",fields:[{type:"Checkboxes",property:"labelFilters",default_value:0,multiple:!1,values:[{label:"Enable image filtering",value:["true"]}],change:function(t,e){e.model.set_property("labelFilters",t)}}]}],title:"General Settings"});return o}),define("text!elements/upfront-gallery/tpl/preset-style.html",[],function(){return"#page .<?php echo $properties['id'] ?> .ugallery_item .ugallery_border {\n\t<?php if(!empty($properties['useborder'])) { ?>\n\t\t<?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\tborder: none;\n\t<?php } ?>\n\t<?php if(!empty($properties['useradius'])) { ?>\n        border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        border-radius: 0px;\n    <?php } ?>\n}\n\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title p,\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title,\n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title p,\n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title\n{\n\t<?php if(!empty($properties['caption-text'])) { ?>\n\tcolor: <?php echo $properties['caption-text']  ?>;\n\t<?php } ?>\n}\n\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title,\n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title \n{\n\t<?php if(!empty($properties['caption-bg'])) { ?>\n\tbackground: <?php echo $properties['caption-bg'] ?>;\n\t<?php } ?>\n}\n\n#page .upfront-output-ugallery.<?php echo $properties['id'] ?> .ugallery-thumb-title, \n#page .upfront-object.upfront-gallery.<?php echo $properties['id'] ?> .ugallery-thumb-title\n{\n\t<?php if($properties['caption-height'] == 'fixed' && !empty($properties['thumbCaptionsHeight'])) { ?>\n\t\toverflow: hidden;\n\t\theight: <?php echo $properties['thumbCaptionsHeight'] ?>px;\n\t<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-gallery/js/settings",["scripts/upfront/preset-settings/util","elements/upfront-gallery/js/settings/thumbnail-fields","scripts/upfront/element-settings/settings","text!elements/upfront-gallery/tpl/preset-style.html"],function(t,e,i,n){var o=Upfront.Settings.l10n.gallery_element,r=i.extend({panels:{Thumbnail:e,Appearance:{mainDataCollection:"galleryPresets",styleElementPrefix:"gallery-preset",ajaxActionSlug:"gallery",panelTitle:o.settings,presetDefaults:Upfront.mainData.presetDefaults.gallery,styleTpl:n,stateModules:{Global:[{moduleType:"Radius",options:{state:"global",max_value:100,fields:{use:"useradius",lock:"borderradiuslock",radius:"radius",radius_number:"radius_number",radius1:"borderradius1",radius2:"borderradius2",radius3:"borderradius3",radius4:"borderradius4"}}},{moduleType:"Colors",options:{title:o.panel.content_area_label,multiple:!1,single:!1,abccolors:[{name:"caption-text",label:o.panel.caption_text_label},{name:"caption-bg",label:o.panel.caption_bg_label}]}},{moduleType:"GalleryCaptionLocation",options:{state:"global",fields:{caption:"image-caption"}}},{moduleType:"Border",options:{state:"global",title:"",fields:{use:"useborder",width:"borderwidth",type:"bordertype",color:"bordercolor"}}}]},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-gallery\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")},migratePresetProperties:function(t){var e={},i="",n="auto";this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),"undefined"!=typeof e.fitThumbCaptions[0]&&e.fitThumbCaptions[0]&&(n="fixed"),"undefined"!=typeof e.captionType&&"none"!==e.captionType&&(i="yes"),t.set({use_captions:i,
captionType:e.captionType,showCaptionOnHover:e.showCaptionOnHover&&e.showCaptionOnHover[0]&&"true"===e.showCaptionOnHover[0]?"1":"0","caption-height":n,thumbCaptionsHeight:e.thumbCaptionsHeight,"caption-bg":e.captionBackground,"caption-text":e.captionColor})}}},title:o.settings});return t.generatePresetsToPage("gallery",n),r}),define("elements/upfront-gallery/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.ugallery.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}});return t}),define("text!elements/upfront-gallery/js/templates/label-editor-template.html",[],function(){return'<div class="ugallery-magnific-labels upfront-ui">\n\t<div class="ugallery-magnific-panel upfront-media-controls">\n\t\t<div class="ugallery-magnific-wrapper existing_labels">\n\t\t\t{{labels}}\n\t\t</div>\n\t\t<div class="ugallery-magnific-add">\n\t\t\t<span class="ugallery-magnific-addform label_selector">\n\t\t\t\t<input type="text" class="ugallery-addlabels" class="upfront-field-text" name="ugallery-image-labels" placeholder="{{ l10n.add_label }}"><div class="ugallery-magnific-addbutton">{{ l10n.add_label }}</div>\n\t\t\t\t<span class="labels_list"></span>\n\t\t\t</span>\n\t\t</div>\n\t</div>\n</div>\n'}),define("text!elements/upfront-gallery/js/templates/label-selector-template.html",[],function(){return"<ul {{labels.length ? '' : 'class=\"empty\"'}}>\n{[ _.each(labels, function(label){ ]}\n\t<li><label rel=\"{{label.id}}\">{{label.text}}</label></li>\n{[ }) ]}\n</ul>\n"}),define("text!elements/upfront-gallery/js/templates/labels-template.html",[],function(){return'<span class="existing-labels-title">Image Labels</span>\n{[ if (labels.length) { ]}\n\t{[ _.each(labels, function(label){ ]}\n\t\t<a href="#remove" title="Remove" class="upfront-icon upfront-icon-media-label-delete" data-idx="{{label.id}}">{{label.text}}</a>\n\t{[ }) ]}\n{[ } else { ]}\n\t<span class=\'no-labels-notice\'>There are currently no labels added to this image...</span>\n{[ } ]}\n'}),function(t){define("elements/upfront-gallery/js/label-editor",["text!elements/upfront-gallery/js/templates/label-editor-template.html","text!elements/upfront-gallery/js/templates/label-selector-template.html","text!elements/upfront-gallery/js/templates/labels-template.html"],function(e,i,n){var o=Upfront.Settings.l10n.gallery_element,r=Backbone.View.extend({template:_.template(e),labelSelectorTpl:_.template(i),events:{'keyup input[name="ugallery-image-labels"]':"fillLabelSuggestionList",'keydown input[name="ugallery-image-labels"]':"onNameFieldKeydown",'click input[name="ugallery-image-labels"]':"onNameFieldClick","click label":"onLabelClick","click .existing_labels a":"removeLabel","click .ugallery-magnific-addbutton":"focusNameField"},initialize:function(t){this.options=t||{},this.gallery=t.gallery,this.labels=t.labels,this.imageId=t.imageId},onNameFieldClick:function(e){return t(e.target).focus(),e.preventDefault(),e.stopPropagation(),!1},updateLabels:function(){this.$el.find(".ugallery-magnific-wrapper").html(_.template(n,{labels:this.labels,l10n:o.template})),this.labels.length?this.$el.parents(".inline-panel-control-dialog").siblings(".upfront-icon-region-edit-labels-no-labels").removeClass("upfront-icon-region-edit-labels-no-labels").addClass("upfront-icon-region-edit-labels"):this.$el.parents(".inline-panel-control-dialog").siblings(".upfront-icon-region-edit-labels").removeClass(".upfront-icon-region-edit-labels").addClass("upfront-icon-region-edit-labels-no-labels")},render:function(){return this.$el.html(this.template({labels:_.template(n,{labels:this.labels,l10n:o.template}),imageId:this.imageId,l10n:o.template})),this},focusNameField:function(){var t=this.$el.find(".ugallery-addlabels");""===t.val()?t.focus():this.addLabel(t)},fillLabelSuggestionList:function(e){var i=this;if([9,13,38,40,27].indexOf(e.which)===-1){var n=t(e.target).val(),r=_.keys(Upfront.data.ugallery.label_names),s=[];if(n.length<2)return t(".labels_list").html("");_.each(r,function(t){if(t.indexOf(n)!==-1){var e=Upfront.data.ugallery.label_names[t];_.findWhere(i.labels,{id:e.id+""})||_.findWhere(i.labels,{id:parseInt(e.id,10)})||s.push({id:e.id,text:e.text.replace(n,'<span class="selection">'+n+"</span>")})}}),this.$el.find(".labels_list").html(i.labelSelectorTpl({labels:s,l10n:o.template}))}},selectNextSuggestion:function(){var e,i,n=-1,o=0;if(i=this.$el.find(".labels_list li"),i.length){for(e=i.find("label.selected"),e.length&&e.removeClass("selected");o<i.length&&n===-1;)n=i[o]===e.parent()[0]?o:-1,o++;n===-1?t(i[0]).find("label").addClass("selected"):n<i.length-1&&t(i[n+1]).find("label").addClass("selected")}},selectPreviousSuggestion:function(){var e,i,n=-1,o=0;for(i=this.$el.find(".labels_list li"),e=i.find("label.selected"),e.length&&e.removeClass("selected");o<i.length&&n===-1;)n=i[o]===e.parent()[0]?o:-1,o++;n===-1?t(i[i.length-1]).find("label").addClass("selected"):n>0&&t(i[n-1]).find("label").addClass("selected")},onNameFieldKeydown:function(e){switch(_.indexOf([13,9,40,38,27],e.which)!==-1&&e.preventDefault(),e.which){case 13:this.addLabel(t(e.target));break;case 9:case 40:this.selectNextSuggestion();break;case 38:this.selectPreviousSuggestion();break;case 27:this.clearSuggestions()}},clearSuggestions:function(){this.$el.find(".labels_list").html("")},addLabel:function(e){var i,n,o=this.$el.find(".labels_list label.selected"),r=this;return o.length?(n=o.attr("rel"),i=Upfront.data.ugallery.label_ids[n],this.labels.push(i),this.updateLabels(),e.val("").siblings(".labels_list").html(""),void this.gallery.addLabel(i.text,this.imageId)):(i=t.trim(e.val()),void(i.length&&(e.val("").siblings(".labels_list").html(""),t.when(this.gallery.addLabel(i,this.imageId)).done(function(t){r.labels.push(t),r.updateLabels(),e.val("").siblings(".labels_list").html("")}))))},onLabelClick:function(e){var i=this,n=t(e.target).hasClass("selection")?t(e.target).parent():t(e.target);e.preventDefault(),e.stopPropagation();var o=n.attr("rel");if(o){var r=Upfront.data.ugallery.label_ids[o];this.gallery.addLabel(r.text,this.imageId),t.when(this.gallery.addLabel(r.text,this.imageId)).done(function(t){i.labels.push(t),i.updateLabels(),i.$el.find(".labels_list").html(""),i.$el.find(".ugallery-addlabels").val("")})}},removeLabel:function(e){e.preventDefault();var i,n,o=t(e.target),r=this,s=o.data("idx");i={action:"upfront-media-disassociate_label",term:s,post_id:this.imageId},Upfront.Util.post(i),n=_.findWhere(this.labels,{id:s+""})||_.findWhere(this.labels,{id:parseInt(s,10)}),this.labels=_.without(this.labels,n),this.gallery.deleteLabel(s,this.imageId),o.fadeOut("fast",function(){t(this).remove(),0===r.labels.length&&r.updateLabels()})}});return r})}(jQuery),define("elements/upfront-gallery/js/element",["elements/upfront-gallery/js/model"],function(t){var e=Upfront.Settings.l10n.gallery_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:30,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-gallery"),this.$el.html(e.element_name)},add_element:function(){var e=new t,i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-ugallery_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(240)}],objects:[e]});this.add_module(i)}});return i}),function(t){define("ugallery",["text!elements/upfront-gallery/tpl/ugallery.html","text!elements/upfront-gallery/tpl/sorting-style.html","text!elements/upfront-gallery/tpl/ugallery_editor.html","text!elements/upfront-gallery/tpl/lightbox_settings.html","elements/upfront-gallery/js/settings","elements/upfront-gallery/js/model","elements/upfront-gallery/js/label-editor","elements/upfront-gallery/js/element","text!elements/upfront-gallery/tpl/preset-style.html","scripts/upfront/preset-settings/util","scripts/upfront/link-model"],function(e,i,n,o,r,s,a,l,p,d,c){var u=Upfront.Settings.l10n.gallery_element,h=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views,f=Backbone.Model.extend({defaults:Upfront.data.ugallery.imageDefaults,is_theme_image:function(){return this.get("srcFull")&&this.get("srcFull").match(Upfront.mainData.currentThemePath)}}),g=Backbone.Collection.extend({model:f}),m=Upfront.Views.ObjectView.extend({model:s,tpl:Upfront.Util.template(e),selectorTpl:_.template(t(n).find("#selector-tpl").html()),progressTpl:_.template(t(n).find("#progress-tpl").html()),editorTpl:_.template(t(n).find("#editor-tpl").html()),formTpl:_.template(t(n).find("#upload-form-tpl").html()),detailsTpl:_.template(t(n).find("#details-tpl").html()),sortMode:!1,lastThumbnailSize:!1,imageLabels:{},reopenSettings:!1,initialize:function(e){var i,n,o=this,r=this.property("element_id");this.property("thumbPadding")!==this.property("thumbPaddingNumber")&&(this.property("thumbPaddingNumber",this.property("thumbPadding"),!0),this.property("thumbSidePaddingNumber",this.property("thumbPadding"),!0),this.property("sidePadding",this.property("thumbPadding"),!0),this.property("bottomPadding",this.property("thumbPadding"),!0),this.property("thumbSidePadding",this.property("thumbPadding"),!0),this.property("thumbBottomPaddingNumber",this.property("thumbPadding"),!0)),_.isArray(this.property("labelFilters"))&&"true"===this.property("labelFilters")[0]&&this.property("labelFilters","true",!0),this.model instanceof s||(this.model=new s({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[e]),this.events=_.extend({},this.events,{"click a.upfront-image-select":"openImageSelector","click .add-item":"openImageSelector","click .toggle-sorting":"toggleSorting","click .ugallery_op_link":"imageEditLink","click .ugallery_op_mask":"imageEditMask","click .remove-image":"removeImage","click .ugallery_item":"selectItem","click .upfront-quick-swap":"openImageSelector",click:"preventNavigation","dblclick .ugallery-thumb-title":"startCaptionEditor","click .ugallery_item_lightbox":"openLightbox"}),n=this.property("images"),_.each(n,function(t,e){t.imageLink!==!1&&"undefined"!=typeof t.imageLink||(n[e].imageLink={type:t.urlType,url:t.url,target:t.linkTarget})}),this.images=new g(n),this.listenTo(this.images,"add remove reset change",this.imagesChanged),this.property("images",this.images.toJSON()),"undefined"==typeof this.property("thumbPadding")&&this.property("thumbPadding",15),t("body").on("click",this.closeTooltip),this.listenTo(Upfront.Events,"entity:settings:activate",this.closeTooltip),this.listenTo(Upfront.Events,"entity:activated",this.closeTooltip),this.listenTo(Upfront.Events,"entity:deactivated",this.closeTooltip),this.listenTo(Upfront.Events,"entity:region:activated",this.closeTooltip),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.rebindShuffle),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(this.model,"preset:updated",this.preset_updated),this.listenTo(Upfront.Events,"preset:gallery:updated",this.caption_updated,this),this.listenTo(Upfront.Events,"upfront:import_image:populate_theme_images",this.populate_theme_images),this.listenTo(Upfront.Events,"upfront:import_image:imported",this.imported_theme_image),this.lastThumbnailSize={width:this.property("thumbWidth"),height:this.property("thumbHeight")},"undefined"!=typeof ugalleries&&ugalleries[r]?(ugalleries[r].labels&&(this.labels=ugalleries[r].labels),ugalleries[r].image_labels&&(this.imageLabels=ugalleries[r].image_labels)):("undefined"!=typeof ugalleries&&ugalleries||(ugalleries={}),ugalleries[r]={},i=["All"],_.each(this.images.models,function(t){i=_.union(i,t.get("tags"))}),this.labels=[],_.each(i,function(t,e){this.labels[e]={id:e,text:t}},this),this.imageLabels={},_.each(this.images.models,function(t){var e=[];_.each(this.labels,function(i){_.indexOf(t.get("tags"),i.text)>-1&&e.push("label_"+i.id)}),this.imageLabels[t.get("id")]="label_0,"+e.join(",")},this),ugalleries[r].labels=this.labels,ugalleries[r].imageLabels=this.imageLabels),this.on("deactivated",this.sortCancel,this),this.listenTo(this.model,"settings:closed",function(t){o.checkRegenerateThumbs(t),"true"===this.property("labelFilters")&&Upfront.frontFunctions.galleryBindShuffle()}),this.listenTo(this.model,"change:thumbProportions",function(){o.onThumbChangeProportions()}),this.listenTo(this.model,"change:thumbWidth",function(){o.onThumbChangeSize(),o.render()}),this.listenTo(this.model,"change:thumbPadding",function(){o.updateThumbPadding()}),this.listenTo(this.model,"change:even_padding",function(){o.updateEvenPadding()}),this.listenTo(this.model,"change:labelFilters",function(){o.updateShowFilters()}),this.listenTo(this.model,"change:showCaptionOnHover",function(){o.updateShowCaptionOnHover()}),this.listenTo(this.model,"change:captionType",function(){o.updateCaptionType()}),this.listenTo(this.model,"change:fitThumbCaptions",function(){o.updateFitThumbCaptions()}),this.listenTo(this.model,"change:thumbCaptionsHeight",function(){o.updateThumbCaptionsHeight()}),"ok"===this.property("status")&&this.images.length||this.property("has_settings",0),Upfront.Events.on("upfront:layout_size:change_breakpoint",function(){setTimeout(function(){o.render()},100)}),this.debouncedRender=_.debounce(this.render,300),this.debouncedRebindShuffle=_.debounce(this.rebindShuffleForDebouncing,500),this.delegateEvents()},onThumbChangeProportions:function(t){var e=this.property("thumbProportions");this.property("thumbWidth");"theme"===e&&(e=1),this.property("thumbProportions",e),this.onThumbChangeSize(),this.render()},onThumbChangeSize:function(){var t=this.property("thumbProportions"),e=this.property("thumbWidth"),i=Math.round(e/t);"theme"===t&&(t=1),this.property("thumbWidth",e,!1),this.property("thumbHeight",i),this.checkRegenerateThumbs()},get_preset_properties:function(){var t=this.model.get_property_value_by_name("preset")||"default",e=d.getPresetProperties("gallery",t)||{};return e},preset_updated:function(t){this.debouncedRender(),Upfront.Events.trigger("preset:gallery:updated",t)},caption_updated:function(t){var e=this.model.get_property_value_by_name("preset");e===t&&this.debouncedRender()},update_colors:function(){var t=this.get_preset_properties();return!(_.size(t)<=0)&&void d.updatePresetStyle("gallery",t,p)},preventClose:function(t){t.stopPropagation()},populate_theme_images:function(t){this.images.each(function(e){e.is_theme_image()&&t.push(e.get("srcFull"))})},imported_theme_image:function(t){var e=this;this.images.each(function(i){var n=i.get("id"),o=i.get("srcFull");i.is_theme_image()&&t.filepath===o&&(i.set("id",t.id),i.set("srcFull",t.src),e.$el.find(".ugallery_item[rel="+n+"]").attr("rel",t.id))})},on_edit:function(){},updateThumbPadding:function(){this.$el.find(".ugallery").data("thumb-padding",this.property("thumbPadding")),this.$el.find(".ugallery").data("thumb-bottom-padding",this.property("bottomPadding")),this.$el.find(".ugallery").data("thumb-side-padding",this.property("sidePadding")),this.debouncedRender()},updateCaptionType:function(){var t,e;this.$el.find(".ugallery-thumb-title").removeClass("ugallery-caption-over ugallery-caption-below ugallery-caption-none").addClass("ugallery-caption-"+this.property("captionType")),"over"!==this.property("captionType")?(t="ugallery_caption_on_hover_1 ugallery_caption_on_hover_0 ugallery-caption-on-hover-1 ugallery-caption-on-hover-0",this.$el.find(".ugallery_item, .ugallery-thumb-title").removeClass(t)):(e=this.property("showCaptionOnHover").length,this.$el.find(".ugallery_item").addClass("ugallery_caption_on_hover_"+e),this.$el.find(".ugallery-thumb-title").addClass("ugallery-caption-on-hover-"+e))},updateFitThumbCaptions:function(){this.debouncedRender()},updateThumbCaptionsHeight:function(){this.debouncedRender()},updateShowCaptionOnHover:function(){var t="ugallery_caption_on_hover_1 ugallery_caption_on_hover_0 ugallery-caption-on-hover-1 ugallery-caption-on-hover-0",e=this.property("showCaptionOnHover").length;this.$el.find(".ugallery_item, .ugallery-thumb-title").removeClass(t),this.$el.find(".ugallery_item").addClass("ugallery_caption_on_hover_"+e),this.$el.find(".ugallery-thumb-title").addClass("ugallery-caption-on-hover-"+e)},updateEvenPadding:function(){this.render()},updateShowFilters:function(){"true"===this.property("labelFilters")?(this.$el.find(".ugallery_labels").show(),this.$el.find(".ugallery-magnific-labels").parents(".upfront-inline-panel-item").show(),Upfront.frontFunctions.galleryBindShuffle()):(this.$el.find(".ugallery_labels").hide(),this.$el.find(".ugallery-magnific-labels").parents(".upfront-inline-panel-item").hide())},selectItem:function(e){var i=t(e.target).hasClass("gallery_item")?t(e.target):t(e.target).closest(".ugallery_item");i.length&&(i.siblings().removeClass("ugallery_selected"),(t(e.target).closest(".ugallery-controls")||{}).length||i.toggleClass("ugallery_selected"),e.gallerySelected=!0)},createControlsEach:function(t){var e=new Upfront.Views.Editor.InlinePanels.ControlPanel;return Upfront.Application.user_can_modify_layout()?e.items=_([this.createControl("crop",u.ctrl.edit_image,"imageEditMask",30,30),this.createLinkControl(t)]):e.items=_([this.createControl("crop",u.ctrl.edit_image,"imageEditMask")]),Upfront.Application.user_can_modify_layout()&&("true"===this.property("labelFilters")&&e.items.push(this.createLabelControl(t)),"image"!==t.get("imageLink").type&&"lightbox"!==t.get("imageLink").type&&-1===["image","lightbox"].indexOf(this.property("linkTo"))||e.items.push(this.createControl("fullscreen",u.ctrl.show_image,"openImageLightbox",30,30))),e},createControl:function(t,e,i,n,o){var r=this,s=new Upfront.Views.Editor.InlinePanels.Control;return s.icon=t,s.tooltip=e,s.width=n,s.height=o,i&&this.listenTo(s,"click",function(t){r[i](t)}),s},createLabelControl:function(t){var e=new Upfront.Views.Editor.InlinePanels.DialogControl,i=this;return e.hideOkButton=!0,e.hideOnClick=!1,e.view=this.createLabelEditor(t),e.image=t,e.view.options.labels.length?e.icon="edit-labels":e.icon="edit-labels-no-labels",e.tooltip=u.ctrl.edit_labels,e.id="edit_labels",e.width=30,e.height=30,i.listenTo(e,"panel:open",function(){i.lastOpenedControl=e,setTimeout(function(){i.$el.find(".ugallery_item").css("overflow","visible")},10),e.$el.closest(".ugallery-controls").addClass("upfront-control-visible")}),i.listenTo(e,"panel:close",function(){e.$el.closest(".ugallery-controls").removeClass("upfront-control-visible"),e===i.lastOpenedControl&&i.render()}),e},createLinkControl:function(t){var e=this,i=new Upfront.Views.Editor.InlinePanels.DialogControl,n=new c(t.get("imageLink"));return i.view=linkPanel=new Upfront.Views.Editor.LinkPanel({model:n,linkTypes:{image:!0},imageUrl:t.get("srcFull")}),this.listenTo(linkPanel.model,"change",function(n){"entry"===n.get("type")&&setTimeout(function(){var n=i.$el.closest(".ugallery_item");e.add_controls_to_item(t,n)},50)}),this.listenTo(n,"change",function(){t.set({imageLink:n.toJSON()})}),this.listenTo(i,"panel:ok",function(){i.close()}),e.listenTo(i,"panel:open",function(){i.$el.parents(".ugallery_item").addClass("upfront-control-visible").end().closest(".ugallery_link").removeAttr("href"),e.$el.closest(".ui-draggable").draggable("disable")}),e.listenTo(i,"panel:ok",function(){i.$el.parents(".ugallery_item").removeClass("upfront-control-visible"),setTimeout(function(){i.$el.closest(".ugallery-controls").siblings(".ugallery_link").attr("href",n.get("url")).attr("target",n.get("target")).attr("class","ugallery_link ugallery_link"+n.get("type"));var o=i.$el.closest(".ugallery_item");e.add_controls_to_item(t,o)},50),e.$el.closest(".ui-draggable").draggable("enable")}),i.icon="link",i.tooltip=u.ctrl.image_link,i.id="link",i.width=30,i.height=30,i},openLightbox:function(t){var e,i;e=!1,i=ugalleries[galleryId].magnific},openImageLightbox:function(e){var i,n=this,o=t(e.target).closest(".ugallery_item"),r=n.images.get(o.attr("rel")),s=!1,a=function(){var e=this.content.find("figcaption"),i=this.wH-120-e.outerHeight(),o=t(window).width()-200;this.content.find("img").css({"max-width":o,"max-height":i}),n.resizeLightboxContainer()};return"lightbox"===r.get("imageLink").type?(i=r.get("imageLink").url.substring(1),void Upfront.Application.LayoutEditor.openLightboxRegion(i)):void t.magnificPopup.open({closeOnBgClick:_.isTrue(this.model.get_property_value_by_name("lightbox_click_out_close")[0]),items:{src:r.get("srcFull")},type:"image",image:{titleSrc:function(){return r.get("caption")},markup:Upfront.data.ugallery.lightboxTpl},callbacks:{open:function(){n.setupLightbox(),n.createLightboxSettings(),t(".glb-content-container").click(n.preventClose),t(".glb-image-container").click(n.preventClose),t(".glb-caption-container").click(n.preventClose),setTimeout(function(){t(document).off("focusin")},500)},imageLoadComplete:function(){var e=t(this.container).find(".mfp-title");e.length&&e.ueditor({linebreaks:!1,autostart:!1,upfrontMedia:!1,upfrontImages:!1}).on("start",function(){s=!0}).on("syncAfter",function(){r.set("caption",e.html())})},beforeClose:function(){s&&Upfront.Views.Editor.notify(u.desc_update_success)},resize:a,afterChange:a}})},setupLightbox:function(){var e,i="gallery-"+this.property("element_id")+"-lightbox";t(".mfp-bg, .mfp-wrap").addClass(i),e=t("."+i),e.find(".mfp-counter").html("1 of 2"),"true"===this.property("lightbox_show_close")[0]?e.find(".mfp-close").show():e.find(".mfp-close").hide(),"true"===this.property("lightbox_show_image_count")[0]?e.find(".mfp-counter").show():e.find(".mfp-counter").hide(),t(".glb-content-container").css({background:this.property("lightbox_active_area_bg")}),t(".mfp-bg").css("background",this.property("lightbox_overlay_bg")),0===t(".mfp-container").find(".mfp-arrow.mfp-arrow-left.mfp-prevent-close").length&&t(".mfp-container").append('<button title="Previous (Left arrow key)" type="button" class="mfp-arrow mfp-arrow-left mfp-prevent-close"></button>'),0===t(".mfp-container").find(".mfp-arrow.mfp-arrow-right.mfp-prevent-close").length&&t(".mfp-container").append('<button title="Next (Right arrow key)" type="button" class="mfp-arrow mfp-arrow-right mfp-prevent-close"></button>'),0===t("style#"+i).length&&t("body").append('<style id="'+i+'"></style>'),t("style#"+i).html(this.property("styles")),this.resizeLightboxContainer()},resizeLightboxContainer:function(){var e=t(".mfp-bg, .mfp-wrap"),i=t("#sidebar-ui"),n=i.width(),o=e.find(".mfp-container");e.css("left",n),o.css("width",e.width()-n)},createLightboxSettings:function(){t(".mfp-container").append(_.template(o,{edit_lightbox_css:u.lightbox.edit_css,lightbox_title:u.lightbox.title}));var e,i=t(".mfp-container").find(".upfront-region-bg-setting-lightbox-region"),n=this;e={lightbox_click_out_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"lightbox_click_out_close",label:"",values:[{label:h.click_close_ltbox,value:"true",checked:"true"===this.model.get_property_value_by_name("lightbox_click_out_close")[0]&&"checked"}],change:function(t){n.property("lightbox_click_out_close",t),this.model.set("lightbox_click_out_close",t,!0),n.setupLightbox()}}),lightbox_show_close:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"gallery-lb-show_close upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",property:"lightbox_show_close",label:"",values:[{label:h.show_close_icon,value:"true",checked:"true"===this.model.get_property_value_by_name("lightbox_show_close")[0]&&"checked"}],change:function(t){n.property("lightbox_show_close",t),n.setupLightbox()}}),lightbox_show_image_count:new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"gallery-lb-show_image_count upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",property:"lightbox_show_image_count",label:"",values:[{label:u.lightbox.show_image_count,value:"true",checked:"true"===this.model.get_property_value_by_name("lightbox_show_image_count")[0]&&"checked"}],change:function(t){n.property("lightbox_show_image_count",t),n.setupLightbox()}})},e.lightbox_active_area_bg=new Upfront.Views.Editor.Field.Color({model:this.model,property:"lightbox_active_area_bg",className:"upfront-field-wrap upfront-field-wrap-color sp-cf overlay_color",label:u.lightbox.active_area_bg+":",spectrum:{move:function(t){n.property("lightbox_active_area_bg",t.toRgbString()),n.setupLightbox()},change:function(t){n.property("lightbox_active_area_bg",t.toRgbString()),n.setupLightbox()}}}),e.lightbox_overlay_bg=new Upfront.Views.Editor.Field.Color({model:this.model,property:"lightbox_overlay_bg",label:u.lightbox.overlay_bg+":",change:n.updateProperty,spectrum:{move:function(t){n.property("lightbox_overlay_bg",t.toRgbString()),n.setupLightbox()},change:function(t){n.property("lightbox_overlay_bg",t.toRgbString()),n.setupLightbox()}}}),_.each(e,function(t){t.render(),t.delegateEvents(),0===i.find(t.$el).length&&i.append(t.$el)}),t("#gallery-lb-settings-button").toggle(function(){t("#gallery-lb-settings").show()},function(){t("#gallery-lb-settings").hide()}),t("#gallery-lb-settings .upfront-inline-modal-save").click(function(){t("#gallery-lb-settings-button").click(),n.galleryLightboxCssEditor&&n.galleryLightboxCssEditor.close()}),t("#gallery-lb-settings").click(function(t){t.stopPropagation()}),t("#gallery-lb-settings").find(".edit-lightbox-css").click(function(e){n.galleryLightboxCssEditor=new Upfront.Views.Editor.GeneralCSSEditor({model:n.model,page_class:"gallery-"+n.property("element_id")+"-lightbox",type:"GalleryLightbox",sidebar:!0,global:!1,toolbar:!0,cssSelectors:{".mfp-close":{label:u.css.lightbox_close,info:u.css.lightbox_close},".glb-content-container":{label:u.css.lightbox_content_wrapper,info:u.css.lightbox_content_wrapper_info},".glb-image-container":{label:u.css.lightbox_image_wrapper,info:u.css.lightbox_image_wrapper},".glb-caption-container":{label:u.css.lightbox_caption_wrapper,info:u.css.lightbox_caption_wrapper},".mfp-title":{label:u.css.lightbox_caption,info:u.css.lightbox_caption},".mfp-arrow-left:before":{label:u.css.lightbox_arrow_left,info:u.css.lightbox_arrow_left},".mfp-arrow-right:before":{label:u.css.lightbox_arrow_right,info:u.css.lightbox_arrow_right},".mfp-counter":{label:u.css.lightbox_image_count,info:u.css.lightbox_image_count}},change:function(t){n.property("styles",t),n.setupLightbox()},onClose:function(){t(".mfp-content").css({"margin-bottom":0,"margin-top":0})}}),t(".mfp-content").css({"margin-bottom":250,"margin-top":50})})},createLabelEditor:function(t){var e=new a({gallery:this,labels:this.extractImageLabels(t.id),imageId:t.id});return e},openLightboxLabels:function(t){this.openImageLightbox(t,!0)},getPropertiesForTemplate:function(){var t=this.extract_properties();t.properties=this.get_preset_properties(),t.imagesLength=t.images.length,t.editing=!0,t.cap=Upfront.Application.user_can_modify_layout(),t.labels=this.labels,t.labels_length=this.labels.length,t.image_labels=this.imageLabels;var e=this.property("linkTo");return _.each(t.images,function(i,n){t.images[n].imageLinkType=i.imageLink.type||e,t.images[n].imageLinkUrl=i.imageLink.url,t.images[n].imageLinkTarget=i.imageLink.target}),t.usingNewAppearance=t.usingNewAppearance||!1,t.l10n=u.template,t.in_editor=!0,t.even_padding||(t.even_padding=["false"]),_.isArray(t.labelFilters)&&"true"===t.labelFilters[0]&&(t.labelFilters="true"),t},get_content_markup:function(){return this.tpl(this.getPropertiesForTemplate())},on_render:function(){var e,i=this;Upfront.Application.user_can_modify_layout()||this.$el.find(".remove-image").remove(),i.parent_module_view&&!i.parent_module_view.$el.data("resizeHandling")&&(e=t.proxy(i.onElementResizing,i),i.parent_module_view.$el.on("resize",e).on("resizestop",t.proxy(i.onElementResizeStop,i)).data("resizeHandling",!0)),Upfront.Events.on("upfront:lightbox:show",function(e){setTimeout(function(){t(window).trigger("resize")},300)}),this.images.each(function(t){t.get("loading")&&0===i.$('.ugallery_item[rel="'+t.id+'"]').find(".ugallery-image-loading").length&&i.$('.ugallery_item[rel="'+t.id+'"]').append('<p class="ugallery-image-loading">'+u.loading+"</p>")}),_.indexOf(["ok","starting"],i.property("status"))===-1&&0===i.$(".upfront-gallery").find(".upfront-quick-swap").length&&i.$(".upfront-gallery").append('<div class="upfront-quick-swap"><p>'+u.personalize+"</p></div>"),setTimeout(function(){i.rebindShuffle();var e=i.$(".ugallery_item");_.each(e,function(e){var n=t(e),o=i.images.get(n.attr("rel")),r=n.find(".ugallery-thumb-title"),s=i.add_controls_to_item(o,n).setWidth(n.width());i.ensureCaptionEditorExists(r,o),o.controls&&o.controls.remove(),o.controls=s})},300),this.isSortingActive===!0?this.activateSortable():this.cleanupSortable(),this.property("linkTo")===!1&&this.showSelectType()},ensureCaptionEditorExists:function(t,e){var i=this;t.data("ueditor")||t.ueditor({linebreaks:!1,autostart:!1,upfrontMedia:!1,upfrontImages:!1}).on("start",function(){i.$el.addClass("upfront-editing")}).on("stop",function(){setTimeout(function(){t.removeAttr("style")},10),i.$el.removeClass("upfront-editing")}).on("syncAfter",function(){e.set("title",t.html()),e.set("caption",t.html())})},onElementResizing:function(){this.$(".ugallery_items").width(t("html").find(".upfront-resize").width()-30)},onElementResizeStop:function(){},on_module_update:function(t){this.render()},toggleSorting:function(e){e&&e.preventDefault(),this.isSortingActive=!this.isSortingActive,this.itemsInRow=this.$el.find(".ugallery_item").filter(function(){return"0px"===t(this).css("top")}).length,this.render(),this.isSortingActive?this.controls.$el.find(".upfront-icon-region-toggle-sorting").addClass("upfront-icon-region-sorting-active"):this.controls.$el.find(".upfront-icon-region-toggle-sorting").removeClass("upfront-icon-region-sorting-active")},rebindShuffleForDebouncing:function(){this.isSortingActive||Upfront.frontFunctions.galleryBindShuffle(this.$el.find(".ugallery_grid"),!0)},rebindShuffle:function(){this.debouncedRebindShuffle()},preventNavigation:function(e){this.constructor.__super__.constructor.__super__.on_click.call(this,e),"INPUT"!==e.target.tagName.toUpperCase()&&("A"===e.target.tagName.toUpperCase()||t(e.target).closest("a").length)&&e.preventDefault()},getLabelSelector:function(e){var i=t(t.trim(this.labelsTpl({labels:this.extractImageLabels(e),l10n:u.template})));return i},extractImageLabels:function(t){var e=!_.isUndefined(this.imageLabels[t])&&this.imageLabels[t].match(/-?\d+/g),i=[];return e&&_.each(this.labels,function(t){e.indexOf(t.id.toString())!==-1&&"0"!==t.id&&i.push(t)}),i},openImageSelector:function(t,e){var i=this,n={multiple:!0,preparingText:u.preparing,customImageSize:{width:this.property("thumbWidth"),height:this.property("thumbHeight")},element_id:this.model.get_property_value_by_name("element_id")};t&&t.preventDefault(),Upfront.Views.Editor.ImageSelector.open(n).done(function(t,n){i.addImages(t,e),n.given!==n.returned&&Upfront.Views.Editor.notify(u.not_all_added,"warning"),Upfront.Views.Editor.ImageSelector.close()})},addImages:function(t,e){var i=this,n=[],o=this.model.get_property_value_by_name("element_id");if(this.getNewLabels(_.keys(t)),_.each(t,function(t,e){var r=new f({id:e,srcFull:t.full[0],sizes:t,size:t.custom.editdata.resize,cropSize:t.custom.crop,cropOffset:t.custom.editdata.crop,src:t.custom.url,loading:!1,status:"ok",element_id:o,urlType:i.property("linkTo"),url:t.full[0]});r.set("imageLink",{type:i.property("linkTo"),url:r.get("url"),target:r.get("linkTarget")}),n.push(r)}),"ok"!==i.property("status"))i.property("status","ok"),i.property("has_settings",1),i.images.reset(n);else if(e){var r=i.images.get(e),s=i.images.indexOf(r);i.images.remove(e),i.images.add(n,{at:s})}else i.images.add(n);i.render()},showSelectType:function(){if(!Upfront.Application.user_can_modify_layout())return!1;var e=this,i=t('<div class="upfront-ui ugallery-onclick"><div class="ugallery-onclick-dialog"><span>'+u.thumbnail_clicked+'</span><div class="ugallery-onclick-options"><a href="#" class="ugallery-lager_image" rel="image">'+u.show_larger+'</a><a href="#" class="ugallery-linked_page" rel="external">'+u.go_to_linked+"</a></div></div></div>");
i.on("click","a",function(n){n.preventDefault();var o=t(n.target).attr("rel");e.property("linkTo",o,!1),_.each(e.images.models,function(t){t.set({urlType:o},{silent:!0})}),e.property("images",e.images.toJSON()),setTimeout(function(){i.fadeOut("fast",function(){i.remove(),e.render()})},100)}),0===this.$(".ugallery").find(".upfront-ui.ugallery-onclick").length&&this.$(".ugallery").append(i.hide()),i.fadeIn()},getNewLabels:function(t){var e={action:"upfront-media_get_image_labels",post_ids:t},i=this;Upfront.Util.post(e).done(function(t){var e=t.data;_.each(e,function(t,e){var n=[];n.push('"label_0"'),_.each(t,function(t){var e=Upfront.data.ugallery,o={id:t.term_id,text:t.name};e.label_names[t.name]||(e.label_names[t.name]=o),e.label_ids[t.term_id]||(e.label_ids[t.term_id]=o),i.isLabelInGallery(o)||i.labels.push(o),n.push('"label_'+t.term_id+'"')}),i.imageLabels[e]=n.join(", ")})})},isLabelInGallery:function(t){for(var e=this,i=!1,n=0;n<e.labels.length&&!i;)i=e.labels[n].id===t.id,n++;return i},getCropOffset:function(t,e){var i,n,o=e.width/t.width>e.height/t.height?"height":"width",r=e[o]/t[o];return r>0?(i={width:Math.floor(e.width/r),height:Math.floor(e.height/r)},n={left:(i.width-t.width)/2,top:(i.height-t.height)/2}):(i=t,n={left:0,top:0}),{size:i,offset:n}},centeredPosition:function(t){var e={width:this.property("thumbWidth"),height:this.property("thumbHeight")};return{top:(e.height-t.height)/2/e.height*100,left:(e.width-t.width)/2/e.width*100}},checkRegenerateThumbs:function(t,e){var i=this;if(!e&&this.lastThumbnailSize.width===this.property("thumbWidth")&&this.lastThumbnailSize.height===this.property("thumbHeight"))return!1;var n={images:this.getRegenerateData(e),action:"upfront-media-image-create-size"},o=new Upfront.Views.Editor.Loading({loading:u.regenerating,done:u.regenerating_done,fixed:!1});o.render(),this.parent_module_view.$el.find(o.$el).length||this.parent_module_view.$el.append(o.$el),Upfront.Util.post(n).done(function(t){o.done();var e=t.data.images,r=[];_.each(n.images,function(t){var n=i.images.get(t.id),o=e[t.id];o.error||n.set({src:o.url,srcFull:o.urlOriginal,size:t.resize,cropPosition:{top:t.crop.top,left:t.crop.left}},{silent:!0}),r.push(n)}),i.images.set(r,{remove:!1}),i.imagesChanged(),i.render(),i.lastThumbnailSize={width:i.property("thumbWidth"),height:i.property("thumbHeight")}})},getRegenerateData:function(t){var e=this,i=this.property("thumbWidth")/this.lastThumbnailSize.width,n=this.property("thumbHeight")/this.lastThumbnailSize.height,o=i>n?i:n,r=[],s=this.images,a=this.model.get_property_value_by_name("element_id");return t&&(s=[],_.each(t,function(t){s.push(e.images.get(t))}),s=new g(s)),s.each(function(t){var i=t.get("size"),n=t.get("cropOffset"),s=Math.round(e.property("thumbHeight")/e.lastThumbnailSize.height*n.top),l=Math.round(e.property("thumbWidth")/e.lastThumbnailSize.width*n.left),p={id:t.id,rotate:t.get("rotation"),resize:{width:i.width*o,height:i.height*o},crop:{top:Math.round(n.top*o),left:Math.round(n.left*o),width:e.property("thumbWidth"),height:e.property("thumbHeight")},element_id:a};t.set("cropOffset",{left:l,top:s}),r.push(p)}),r},imageEditMask:function(e){var i,n=this,o=t(e.target).closest(".ugallery_item"),r=this.images.get(o.attr("rel"));if("ok"!==r.get("status")){var s={multiple:!1,preparingText:u.preparing,element_id:this.model.get_property_value_by_name("element_id")};return Upfront.Views.Editor.ImageSelector.open(s).done(function(t){n.addImages(t);var e=n.images.indexOf(r);n.images.remove(r,{silent:!0});var i=n.images.at(n.images.length-1);n.images.remove(i,{silent:!0}),n.images.add(i,{at:e}),Upfront.Views.Editor.ImageSelector.close()})}i=this.getEditorOptions(r),e.preventDefault(),Upfront.Views.Editor.ImageEditor.open(i).done(function(t){r.set({src:t.src,srcFull:t.src,cropSize:t.cropSize,size:t.imageSize,cropOffset:t.imageOffset,margin:{left:Math.max(0-t.imageOffset.left,0),top:Math.max(0-t.imageOffset.top,0)},rotation:t.rotation}),n.render()}).fail(function(t){t&&"changeImage"===t.reason?n.openImageSelector(!1,t.id):n.render()})},getEditorOptions:function(t){var e=this.$(".ugallery_item[rel="+t.id+"] img"),i=t.get("sizes").full;return{id:t.id,maskSize:{width:e.width(),height:e.height()},maskOffset:e.offset(),position:t.get("cropOffset"),size:t.get("size"),fullSize:{width:i[1],height:i[2]},src:t.get("src"),srcOriginal:i[0],rotation:t.get("rotation"),element_id:this.model.get_property_value_by_name("element_id"),element_cols:Upfront.Util.grid.width_to_col(e.width(),!0)}},imagesChanged:function(){this.property("images",this.images.toJSON()),this.rebindShuffle()},deleteLabel:function(t,e){var i=this,n=!0,o='"label_'+t+'"';if(this.imageLabels[e]=this.imageLabels[e].replace(new RegExp(o+",*","g"),""),this.images.each(function(o){o.id!==e&&i.imageLabels[o.id].indexOf('"label_'+t+'"')!==-1&&(n=!1)}),n)for(var r in this.labels)this.labels[r]&&this.labels[r].id===t&&this.labels.splice(r,1)},addLabel:function(t,e){var i,n=Upfront.data.ugallery.label_names[t];return"undefined"!=typeof n&&n?(i='"label_'+n.id+'"',this.addToGalleryLabels(n),this.associateLabelWithImage(e,i,n),n):this.createLabel(t,e)},associateLabelWithImage:function(t,e,i){var n,o=!1;this.imageLabels[t]?this.imageLabels[t].indexOf(e)===-1&&(this.imageLabels[t]+=", "+e,o=!0):(this.imageLabels[t]=e,o=!0),o&&(n={action:"upfront-media-associate_label",term:i.id,post_id:t},Upfront.Util.post(n))},addToGalleryLabels:function(t){for(var e=!1,i=0,n=parseInt(t.id,10);i<this.labels.length&&!e;)savedLabelId=parseInt(this.labels[i].id,10),e=savedLabelId===n,i++;e||this.labels.push({id:n.toString(),text:t.text})},createLabel:function(e,i){var n,o,r=this,s=-parseInt(100*Math.random(),10);n={id:s,term_id:s,text:e},o={action:"upfront-media-add_label",term:e,post_id:i},Upfront.data.ugallery.label_names[e]=n,Upfront.data.ugallery.label_ids[s]=n,this.labels.push(n),this.imageLabels[i]=this.imageLabels[i]?this.imageLabels[i]+', "label_'+s+'"':'"label_'+s+'"';var a=t.Deferred();return Upfront.Util.post(o).success(function(t){var n=t.data[i],o=[],l=0,p={};_.each(n,function(t){o.push('"label_'+t+'"'),Upfront.data.ugallery.label_ids[t]||(l=t)}),o=o.join(", "),p={id:l,text:e},a.resolve(p),Upfront.data.ugallery.label_names[e]=p,Upfront.data.ugallery.label_ids[p.id]=p,delete Upfront.data.ugallery.label_ids[s],r.imageLabels[i]=o,_.each(r.labels,function(t){t.text===e&&(t.id=p.id)}),r.render()}),a.promise()},postTypes:function(){var t=[];return _.each(Upfront.data.ugallery.postTypes,function(e){"attachment"!==e.name&&t.push({name:e.name,label:e.label})}),t},getItemElement:function(e){return t(e.target).closest(".ugallery_item")},removeImage:function(e){if(!Upfront.Application.user_can_modify_layout())return!1;var i=this,n=this.getItemElement(e);e.preventDefault(),n.fadeOut("fast",function(){var e=n.attr("rel");i.images.remove(e),i.imagesChanged(),i.images.length||(i.property("has_settings",0),i.property("status","starting"));var o=i.imageLabels[e].split(",");_.each(o,function(n){var o=t.trim(n.replace('"label_',"").replace('"',""));i.deleteLabel(o,e)}),i.imageLabels[e]="",i.render()})},activateSortable:function(){var e=this;this.$(".ugallery").sortable({items:"div.ugallery_item:not(.ugallery_addmore)",start:function(){e.$el.addClass("ugallery_sorting")},stop:function(){e.$el.removeClass("ugallery_sorting")},update:function(){e.sortOk()},change:function(){},delay:500,cancel:".ugallery-thumb-title"}),this.$(".ugallery_item_removing").removeClass("ugallery_item_removing"),this.$el.addClass("image-sorting-active"),this.$el.find(".toggle_sorting").addClass("sorting-active"),t("body").append(_.template(i,{element_id:this.model.get_property_value_by_name("element_id"),thumbPadding:this.model.get_property_value_by_name("thumbPadding"),even_padding:this.model.get_property_value_by_name("even_padding"),itemsInRow:this.itemsInRow}))},cleanupSortable:function(){this.$el.removeClass("image-sorting-active"),this.$el.find(".toggle_sorting").removeClass("sorting-active"),t("#sorting-style").length>0&&t("#sorting-style").remove()},sortOk:function(){var e=this.$(".ugallery_item"),i=[],n=this;_.each(e,function(e){var o=t(e).attr("rel");o&&i.push(n.images.get(o))}),this.images.reset(i)},activateLightbox:function(){var e=[];this.$(".ugallery_item").each(function(i,n){e.push({el:t(n),src:t(n).find("a.ugallery_link").attr("href")}),t(n).find(".upfront-icon-region-fullscreen").attr("href",t(n).find("a.ugallery_link").attr("href"))}),this.$(".ugallery").magnificPopup({gallery:{enabled:!0},type:"image",delegate:".upfront-icon-region-fullscreen",items:e})},startCaptionEditor:function(e){var i,n=t(e.target),o=n.hasClass("ugallery-thumb-title")?n:n.closest(".ugallery-thumb-title");o.length&&(o.data("ueditor")&&!o.data("ueditor").active?o.data("ueditor").start():(i=this.images.get(o.closest(".ugallery_item").attr("rel")),this.ensureCaptionEditorExists(o,i),o.data("ueditor").active||o.data("ueditor").start()))},cleanup:function(){this.images.each(function(t){t.controls&&t.controls.remove()}),t("body").off("click",this.closeTooltip)},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t.preset=t.preset||"default",t},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),void this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},getControlItems:function(){return moreOptions=new Upfront.Views.Editor.InlinePanels.SubControl,moreOptions.icon="more",moreOptions.tooltip=u.ctrl.caption_position,moreOptions.sub_items={},moreOptions.sub_items.add=this.createControl("add",u.template.add_img,"openImageSelector",38,38),moreOptions.sub_items["toggle-sorting"]=this.createControl("toggle-sorting",u.toggle_dnd,"toggleSorting",38,38),_([moreOptions,this.createPaddingControl(),this.createControl("settings",u.settings,"on_settings_click",38,38)])},add_controls_to_item:function(e,i){var n=this.createControlsEach(e);return n.render(),i.find(".ugallery-controls").remove(),i.append(t('<div class="ugallery-controls upfront-ui"></div>').append(n.$el)),n}});Upfront.Application.LayoutEditor.add_object("Ugallery",{Model:s,View:m,Element:l,Settings:r,cssSelectors:{".ugallery":{label:u.css.container_label,info:u.css.container_info},".ugallery .ugallery_item":{label:u.css.elements_label,info:u.css.elements_info},".ugallery img.ugallery-image":{label:u.css.images_label,info:u.css.images_info},".ugallery .ugallery-thumb-title":{label:u.css.captions_label,info:u.css.captions_info},".ugallery .ugallery_labels":{label:u.css.lblcnt_label,info:u.css.lblcnt_info},".ugallery .ugallery_label_filter":{label:u.css.labels_label,info:u.css.labels_info}},cssSelectorsId:Upfront.data.ugallery.defaults.type}),Upfront.Models.UgalleryModel=s,Upfront.Views.UgalleryView=m})}(jQuery),define("text!elements/upfront-image/tpl/image.html",[],function(){return'<div <?php if($usingNewAppearance === true) { ?>class="<?php echo $preset ?>"<?php } ?>>\r\n\t<?php if($usingNewAppearance === false) { ?>\r\n\t<div class="uimage uimage-<?php echo $caption_position ?> uimage-status-<?php echo $image_status ?> uimage-caption-<?php echo $caption_position ?>-<?php echo $caption_alignment ?><?php echo $gifImage ?><?php echo $stretchClass ?> <?php echo $placeholder_class ?>" style="text-align: <?php echo $align ?>;">\r\n\t<?php } else { ?>\r\n\t<div class="upfront-image-wrapper uimage uimage-<?php echo $properties[\'caption-position\'] ?> uimage-status-<?php echo $image_status ?> uimage-caption-<?php echo $properties[\'caption-position\'] ?>-<?php echo $properties[\'caption-alignment\'] ?><?php echo $gifImage ?><?php echo $stretchClass ?> <?php echo $placeholder_class ?>" style="text-align: <?php echo $align ?>;">\r\n\t<?php } ?>\r\n\t\t<div class="upfront-image-caption-container" style="margin-top:<?php echo $marginTop ?>px">\r\n\t\t\t<?php if($url && !$in_editor) { ?>\r\n\t\t\t<a href="<?php echo $url ?>" target="<?php echo $link_target ?>">\r\n\t\t\t\t<?php } ?>\r\n\t\t\t\t<?php if($src){ ?>\r\n\t\t\t\t<div class="upfront-image-container" <?php if ($containerWidth) { ?>style="width:<?php echo $containerWidth ?>px;"<?php } ?>>\r\n\t\t\t\t<img src="<?php echo $src ?>" alt="<?php echo $alternative_text ?>" title="<?php echo $image_title ?>" <?php if($imgWidth) { ?>style="width:<?php echo $imgWidth ?>;"<?php } ?>/>\r\n\t\t</div>\r\n\t\t<?php } else { ?>\r\n\t\t<div class="upfront-image-starting_placeholder"><p>Image placeholder</p></div>\r\n\t\t<?php } ?>\r\n\r\n\t\t<?php if($usingNewAppearance !== true) { ?>\r\n\t\t\t<?php if($include_image_caption) { ?>\r\n\t\t\t\t<div class="wp-caption uimage-<?php echo $caption_alignment ?> uimage-<?php echo $caption_trigger ?> uimage-padded-caption" style="background:<?php echo $captionBackground == \'1\' ? $background : \'rgba(255, 255, 255, 0)\' ?>; ">\r\n\t\t\t\t\t<?php if($cover_caption) { ?>\r\n\t\t\t\t\t<div class="uimage-caption-cover">\r\n\t\t\t\t\t\t<?php } ?>\r\n\t\t\t\t\t\t<?php echo $image_caption ?>\r\n\t\t\t\t\t\t<?php if($cover_caption) { ?>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<?php } ?>\r\n\t\t\t\t</div>\r\n\t\t\t<?php } ?>\r\n\t\t<?php } else { ?>\r\n\t\t<?php if( !empty($properties[\'use_captions\']) && $display_caption === \'showCaption\' )  { ?>\r\n\t\t<div class="wp-caption uimage-<?php echo $properties[\'caption-alignment\'] ?> uimage-<?php echo $properties[\'caption-trigger\'] ?> uimage-padded-caption">\r\n\t\t\t<?php if($cover_caption) { ?>\r\n\t\t\t<div class="uimage-caption-cover">\r\n\t\t\t\t<?php } ?>\r\n\t\t\t\t<?php echo $image_caption ?>\r\n\t\t\t\t<?php if($cover_caption) { ?>\r\n\t\t\t</div>\r\n\t\t\t<?php } ?>\r\n\t\t</div>\r\n\t\t<?php } ?>\r\n\t\t<?php } ?>\r\n\r\n\t\t<?php if($url && !$in_editor) { ?>\r\n\t\t</a>\r\n\t\t<?php } ?>\r\n\t</div>\r\n</div>\r\n</div>\r\n\r\n<?php if($gifImage){ ?>\r\n<style>\r\n\t#<?php echo $element_id ?> .uimage-gif .upfront-image-container {\r\n\t\theight: <?php echo $element_size[\'height\'] ?>px;\r\n\t\twidth: <?php echo $element_size[\'width\'] ?>px;\r\n\t}\r\n\r\n\t#<?php echo $element_id ?> .uimage-gif img {\r\n\t\t   height: <?php echo $size[\'height\'] ?>px;\r\n\t\t   width: <?php echo $size[\'width\'] ?>px !important;\r\n\t\t   margin-top: <?php echo $gifTop ?>;\r\n\t\t   margin-left: <?php echo $gifLeft ?>;\r\n\t   }\r\n</style>\r\n<?php } ?>\r\n'}),define("text!elements/upfront-image/tpl/image_editor.html",[],function(){return'<div>\r\n<!--\r\n\tWrap everything in a div to convert this file\'s content in a jquery element\r\n\tso it is possible to use $.find.\r\n-->\r\n\r\n<script type="text/template" id="selector-tpl">\r\n\t<div id="upront-image-placeholder" class="upfront-image-section">\r\n\t\t<div class="upfront-image-selector-container">\r\n\r\n\t\t\t<h2>{{ l10n.drop_files }}</h2>\r\n\t\t\t<p>{{ l10n.max_file_size }}</p>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a class="select-files" href="#">{{ l10n.select_files }}</a>\r\n\t\t\t\t</li>\r\n\t\t\t\t<!-- {{ l10n.or_browse }} -->\r\n\t\t\t\t<li>\r\n\t\t\t\t\t<a class="open-media-gallery" href="#">{{ l10n.media_gallery }}</a>\r\n\t\t\t\t</li>\r\n\t\t\t</ul>\r\n\t\t\t<!-- <span class="dragimagehand"></span> -->\r\n\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="progress-tpl">\r\n\t<div id="upfront-image-uploading" class="upfront-image-section">\r\n\t\t<h2>{{ l10n.uploading }}</h2>\r\n\t\t<div class="upfront-progress-container">\r\n\t\t\t<div id="upfront-progress"></div>\r\n\t\t</div>\r\n\t</div>\r\n</script>\r\n\r\n<script type="text/template" id="editor-tpl">\r\n\t<div id="uimage-cover" style="position:absolute; top:{{maskOffset.top}}px; left:{{maskOffset.left}}px; height: {{maskSize.height}}px; width: {{maskSize.width}}px"></div>\r\n\t<div id="uimage-canvas" style="position:absolute; overflow:hidden; top:{{offset.top}}px; left:{{offset.left}}px; height: {{size.height}}px; width: {{size.width}}px">\r\n\t\t<img class="uimage-img {{ rotation }}" src="{{src}}" style="width:100%; height:100%; position:absolute">\r\n\t</div>\r\n\r\n\t<div id="uimage-mask" class="image-edit-mask" style="position:absolute; top:{{maskOffset.top}}px; left:{{maskOffset.left}}px; height: {{maskSize.height}}px; width: {{maskSize.width}}px"></div>\r\n\r\n\t<div id="uimage-drag-handle" style="width:{{size.width}}px; height:{{size.height}}px;position:absolute; top:{{offset.top}}px; left:{{offset.left}}px">\r\n\t\t<div class="image-edit-resize image-edit-control"><i class="ui-resizable-handle ui-resizable-handle-se"></i></div>\r\n\t\t<!-- <div class="image-edit-rotate image-edit-control"><i class=""></i></div> -->\r\n\t</div>\r\n\t\r\n\t<div id="image-edit-buttons" style="position: absolute; top:{{maskOffset.top - 28}}px; left: {{maskOffset.left}}px;">\t\t\r\n\t\t&nbsp;\r\n\t</div>\r\n\t<div class="image-align-points" style="position: absolute; top:{{maskOffset.top - 50}}px; left: {{(maskOffset.left - 50) + (maskSize.width / 2)}}px; z-index: 50;">\r\n\t\t<div class="align-points-row">\r\n\t\t\t<a id="align-top-left" class="image-align-point top-left-point" data-alignment="top-left">&nbsp;</a>\r\n\t\t\t<a id="align-top-center" class="image-align-point top-center-point" data-alignment="top-center">&nbsp;</a>\r\n\t\t\t<a id="align-top-right" class="image-align-point top-right-point" data-alignment="top-right">&nbsp;</a>\r\n\t\t</div>\r\n\t\t<div class="align-points-row">\r\n\t\t\t<a id="align-center-left" class="image-align-point center-left-point" data-alignment="center-left">&nbsp;</a>\r\n\t\t\t<a id="align-center-center" class="image-align-point center-center-point" data-alignment="center-center">&nbsp;</a>\r\n\t\t\t<a id="align-center-right" class="image-align-point center-right-point" data-alignment="center-right">&nbsp;</a>\r\n\t\t</div>\r\n\t\t<div class="align-points-row">\r\n\t\t\t<a id="align-bottom-left" class="image-align-point bottom-left-point" data-alignment="bottom-left">&nbsp;</a>\r\n\t\t\t<a id="align-bottom-center" class="image-align-point bottom-center-point" data-alignment="bottom-center">&nbsp;</a>\r\n\t\t\t<a id="align-bottom-right" class="image-align-point bottom-right-point" data-alignment="bottom-right">&nbsp;</a>\r\n\t\t</div>\r\n\t</div>\r\n\t<div class="image-ok-button" style="position: absolute; top:{{maskOffset.top - 40}}px; left: {{maskOffset.left + (maskSize.width - 90)}}px; z-index: 51;">\r\n\t\t{[ for (var i = 0; i < buttons.length; i++) { ]}\r\n\t\t\t<a class="image-edit-button" id="{{buttons[i].id}}" title="{{buttons[i].tooltip}}">{{buttons[i].text}}</a>\r\n\t\t{[ } ]}\r\n\t</div>\r\n</script>\r\n\r\n<script type="text/template" id="upload-form-tpl">\r\n<form id="upfront-upload-image" name="upfront-upload-image" enctype="multipart/form-data" method="post" action="{{url}}" data-url="{{url}}?action=upfront-media-upload">\r\n\t<input type="file" name="media" id="upfront-image-file-input" multiple >\r\n\t<input type="hidden" name="action" value="upfront-media-upload">\r\n\t<input type="submit" value="Upload">\r\n</form>\r\n</script>\r\n\r\n<script type="text/template" id="sizehint-tpl">\r\n\t<b>w:</b>{{width}}{[ if(width.toString().indexOf("%") === -1){ ]}px{[ } ]}\r\n\t<b>h:</b>{{height}}{[ if(height.toString().indexOf("%") === -1){ ]}px{[ } ]}\r\n</div>\r\n</script>\r\n\r\n<script type="text/template" id="fullwidth-alert-tpl">\r\n\t<div class="uimage-fullwidth-alert">\r\n\t\t<p>{{ l10n.move_image_nag }}</p>\r\n\t\t<div class="clearfix">\r\n\t\t\t<div class="uimage-fullwidth-info uimage-fullwidth-info-1"></div>\r\n\t\t\t<div class="uimage-fullwidth-info uimage-fullwidth-info-2"></div>\r\n\t\t\t<div class="uimage-fullwidth-info uimage-fullwidth-info-3"></div>\r\n\t\t</div>\r\n\t\t<div style="margin-top:10px">\r\n\t\t\t<input class="upfront-field-checkbox" type="checkbox" id="uimage-fullwidth-noalert" value="1">\r\n\t\t\t<label for="uimage-fullwidth-noalert">{{ l10n.dont_show_again }}</label>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n</script>\r\n\r\n</div>\r\n'}),define("elements/upfront-image/js/context-menu/list",[],function(){var t=Upfront.Settings.l10n.image_element,e=Upfront.Views.ContextMenuList.extend({initialize:function(e){this.options=e,this.for_view=this.options.for_view;var i=this,n=[new Upfront.Views.ContextMenuItem({get_label:function(){return i.for_view.isThemeImage()?t.ctrl.edit_image:i.for_view.$el.find("div.upfront-image-container > img").length>0?t.ctrl.edit_image:t.ctrl.add_image},action:function(){return i.for_view.isThemeImage()?void i.for_view.replaceImage():void(i.for_view.$el.find("div.upfront-image-container > img").length>0?i.for_view.editRequest():i.for_view.openImageSelector())}})];this.for_view.$el.find("div.upfront-image-container > img").length>0&&n.push(new Upfront.Views.ContextMenuItem({get_label:function(){return i.for_view.$el.find("div.upfront-image-container div.wp-caption").length>0?t.ctrl.edit_caption:t.ctrl.add_caption},action:function(){i.for_view.$el.find("div.upfront-image-container > div.wp-caption").length>0?i.for_view.$el.find("div.upfront-image-container > div.wp-caption").data("ueditor").start():(i.for_view.controls.items.value()[2].selected="topOver",i.for_view.controls.items.value()[2].trigger("select"),i.for_view.property("include_image_caption",[1]),i.for_view.property("caption_position","over_image"),i.for_view.property("caption_alignment","top"),i.for_view.render())}})),this.menuitems=_(n)}});return e}),define("elements/upfront-image/js/image-context-menu",["elements/upfront-image/js/context-menu/list"],function(t){var e=Upfront.Views.ContextMenu.extend({initialize:function(e){this.options=e,this.for_view=this.options.for_view,this.menulists=_([new t({for_view:this.for_view})])}});return e}),define("text!elements/upfront-image/tpl/preset-style.html",[],function(){return"#page .<?php echo $properties['id'] ?> .upfront-image-caption-container .wp-caption p,\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container .wp-caption {\n\t<?php if(!empty($properties['caption-text'])) { ?>\n\tcolor: <?php echo $properties['caption-text']  ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container .wp-caption {\n\t<?php if(!empty($properties['caption-bg'])) { ?>\n\tbackground: <?php echo $properties['caption-bg'] ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container {\n\t <?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> .upfront-image-caption-container {\n\t<?php if(!empty($properties['useradius'])) { ?>\n        border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        border-radius: 0px;\n    <?php } ?>\n\toverflow: hidden;\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-image/js/image-settings",["scripts/upfront/preset-settings/util","scripts/upfront/element-settings/settings","text!elements/upfront-image/tpl/preset-style.html"],function(t,e,i){var n=Upfront.Settings.l10n.image_element,o=e.extend({panels:{Appearance:{mainDataCollection:"imagePresets",styleElementPrefix:"image-preset",ajaxActionSlug:"image",panelTitle:n.settings,presetDefaults:Upfront.mainData.presetDefaults.image,styleTpl:i,stateModules:{Global:[{moduleType:"Selectbox",options:{state:"global",default_value:"default",title:n.settings.image_style_label,custom_class:"image_style",label:n.settings.image_style_info,fields:{name:"imagestyle"},values:[{label:"Default",value:"default"},{label:"Square",value:"square"}]}},{moduleType:"Radius",options:{state:"global",max_value:100,fields:{use:"useradius",lock:"borderradiuslock",radius:"radius",radius_number:"radius_number",radius1:"borderradius1",radius2:"borderradius2",radius3:"borderradius3",radius4:"borderradius4"}}},{moduleType:"CaptionLocation",options:{state:"global",fields:{caption:"image-caption"}}},{moduleType:"Colors",options:{title:n.settings.content_area_colors_label,multiple:!1,single:!1,abccolors:[{name:"caption-text",label:n.settings.caption_text_label},{name:"caption-bg",label:n.settings.caption_bg_label}]}},{moduleType:"Border",options:{state:"global",title:"",fields:{use:"useborder",width:"borderwidth",type:"bordertype",color:"bordercolor"}}}]},migrateElementStyle:function(t,e){return t=t.replace(/\.upfront-image/g,".upfront-image-wrapper"),t=t.replace(/\.upfront-image-wrapper-container/g,".upfront-image-container")},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-image\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")},migratePresetProperties:function(t){var e={},i="",n="";this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e.caption_position&&e.caption_trigger&&(i="yes"),n="over_image"===e.caption_position&&"top"===e.caption_alignment?"topOver":"over_image"===e.caption_position&&"bottom"===e.caption_alignment?"bottomOver":"over_image"===e.caption_position&&"fill"===e.caption_alignment?"topCover":"over_image"===e.caption_position&&"fill_middle"===e.caption_alignment?"middleCover":"below_image"===e.caption_position&&"fill_bottom"===e.caption_alignment?"bottomCover":"below",t.set({use_captions:i,"caption-position-value":n,"caption-position":e.caption_position,"caption-alignment":e.caption_alignment,"caption-trigger":e.caption_trigger,"caption-bg":e.background})},getModifiedProperties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),"undefined"!=typeof t.theme_style&&"_default"!==t.theme_style&&""!==t.theme_style&&" "!==t.theme_style||("undefined"!=typeof t.caption_position&&t.caption_position!==!1||"undefined"!=typeof t.caption_alignment&&t.caption_alignment!==!1||"undefined"!=typeof t.caption_trigger&&"always_show"!==t.caption_trigger||"undefined"!=typeof t.background&&"#000000"!==t.background)}}},title:n.settings.label});return t.generatePresetsToPage("image",i),o}),function(t){define("elements/upfront-image/js/image-selector",["text!elements/upfront-image/tpl/image_editor.html"],function(e){var i=Upfront.Settings.l10n.image_element,n=Backbone.View.extend({selectorTpl:_.template(t(e).find("#selector-tpl").html()),progressTpl:_.template(t(e).find("#progress-tpl").html()),formTpl:_.template(t(e).find("#upload-form-tpl").html()),deferred:t.Deferred(),defaultOptions:{multiple:!1,multiple_sizes:!0,preparingText:i.sel.preparing},options:{},initialize:function(){this.setup_upload_form()},setup_upload_form:function(){var e=this;if(0===t("#upfront-upload-image").length){t("body").append(e.formTpl({url:Upfront.Settings.ajax_url,l10n:i.template})),t("body").bind("keyup",function(t){27===t.keyCode&&e.closeOverlay()});var n=t("#upfront-progress"),o=t("#upfront-image-file-input"),r=t("#upfront-upload-image");r.fileupload&&r.fileupload({sequentialUploads:!0,formData:_.extend({action:"upfront-media-upload"},Upfront.Media.Ref),fileInput:null,paramName:"media[]"}).bind("fileuploadstart",function(){n.css("width","0")}).bind("fileuploadprogressall",function(t,e){var i=parseInt(e.loaded/e.total*100,10);n.css("width",i+"%")}).bind("fileuploaddone",function(o,s){var a=s.result;n.css("width","100%"),t("#upfront-image-uploading h2").html(i.sel.preparing),Upfront.Views.Editor.ImageEditor.getImageData(a.data,e.options.customImageSize).done(function(t){e.deferred.resolve(t.data.images,t)}).error(function(){Upfront.Views.Editor.notify(i.sel.upload_error,"error"),e.openSelector()}),r[0].reset()}).bind("fileuploadfail",function(t,i){var n=i.jqXHR.responseJSON.error;Upfront.Views.Editor.notify(n,"error"),e.openSelector(),r[0].reset()}),o.on("change",function(){this.files.length&&(XMLHttpRequest&&(new XMLHttpRequest).upload?e.uploadImage(this.files):e.openProgress(function(){r.fileupload("add",{fileInput:o})}))})}},open:function(e){return this.deferred=t.Deferred(),_.isObject(e)||(e={}),this.options=_.extend({},this.defaultOptions,e),this.openSelector(),Upfront.Events.trigger("upfront:element:edit:start","media-upload"),this.deferred.promise()},openSelector:function(){var e=this;this.openOverlaySection(this.selectorTpl,{},function(){var i=t("#upfront-image-file-input");e.options.multiple===!0?(i.attr("multiple","multiple"),i.attr("name","media[]")):(i.attr("multiple",!1),i.removeAttr("multiple"),i.attr("name","media")),e.updateSelector(),e.resizeOverlay()})},updateSelector:function(){var e=this,i=t("#upront-image-placeholder"),n=i.find(".upfront-image-selector-container");if(Upfront.Settings.Application.PERMS.UPLOAD)i.on("dragenter",function(t){t.preventDefault(),t.stopPropagation()}).on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),t(this).css("border-color","#C3DCF1"),t(this).css("background","none")}).on("dragover",function(e){e.preventDefault(),e.stopPropagation(),t(this).css("border-color","#1fcd8f"),t(this).css("background","rgba(255,255,255,.1)"),t(this).find()}).on("drop",function(t){var i;t.preventDefault(),t.stopPropagation(),t.originalEvent.dataTransfer&&(i=t.originalEvent.dataTransfer.files,i.length&&e.uploadImage(i))});else{var o=i.find("a.open-media-gallery").parent(),r=t("<ul></ul>").append(o);n.empty(),n.append(r)}},openProgress:function(t){var e=this;this.openOverlaySection(this.progressTpl,{},function(){e.resizeOverlay(),t()})},resizeOverlay:function(){var e=t("#upfront-image-overlay");if(e.length){var i=t("#upront-image-placeholder"),n=t("#upfront-image-uploading"),o={},r=t("#sidebar-ui").width(),s={left:r,width:t(window).width()-r,height:t(window).height()},a=s.height/2-220;Upfront.Util.isRTL()&&(delete s.left,s.right=r),a>0?(e.removeClass("small_placeholder"),a+="px"):(e.addClass("small_placeholder"),a=s.height/2-140+"px"),e.css(s),o={height:s.height-100,"padding-top":a},i.css(o),n.css(o)}},close:function(){this.closeOverlay()},cancelOverlay:function(t){t.target===t.currentTarget&&this.closeOverlay(t)},closeOverlay:function(){t("#upfront-image-overlay").off("click").fadeOut("fast",function(){t(this).remove(),t("#upfront-image-overlay").remove()}),t("html").css({overflow:this.bodyOverflow?this.bodyOverflow:"auto",height:"auto",width:"auto"}),t("body").removeClass("upfront-image-upload-open"),this.reopenSettings&&(t("#settings").fadeIn(),this.reopenSettings=!1),t(window).off("resize",this.resizeOverlay),Upfront.Events.trigger("upfront:element:edit:stop")},openOverlaySection:function(e,n,o){var r=this,s=t("#settings"),a=t("#upfront-image-overlay");return n.l10n=i.template,a.length?void t(".upfront-image-section").fadeOut("fast",function(){var i=t(e(n)).hide();a.append(i),i.fadeIn("fast"),t(this).remove(),o&&o(a)}):(this.bodyOverflow=t("html").css("overflow"),t("html").css({overflow:"hidden",width:t(window).width()+"px",height:t(window).height()+"px"}),a=t('<div id="upfront-image-overlay" class="upfront-ui"></div>').append(e(n)).hide(),t("body").append(a).addClass("upfront-image-upload-open"),this.setOverlayEvents(),a.fadeIn("fast"),this.resizeOverlay(),t(window).on("resize",function(t){t.target===window&&r.resizeOverlay()}),s.is(":visible")&&(s.fadeOut(),this.reopenSettings=!0),void(o&&o(a)))},setOverlayEvents:function(){var e=this;t("#upfront-image-overlay").on("click",function(t){e.cancelOverlay(t)}).on("click","a.select-files",function(t){e.openFileBrowser(t)}).on("click","a.image-edit-change",function(t){e.openImageSelector(t)}).on("click","a.open-media-gallery",function(t){e.openMediaGallery(t)})},openMediaGallery:function(e){
var i=this,n={multiple_selection:this.options.multiple,multiple_sizes:this.options.multiple_sizes,media_type:["images"]};e.preventDefault(),Upfront.Media.Manager.open(n).done(function(e,n){if(n&&n.length>0){var o=[];n.each(function(t){o.push(t.get("ID"))}),Upfront.Views.Editor.ImageEditor.getImageData(o,i.options.customImageSize,i.options.element_id).done(function(t){i.deferred.resolve(t.data.images,t)}),i.openProgress(function(){t("#upfront-image-uploading h2").html(i.options.preparingText)})}})},openFileBrowser:function(e){e.preventDefault(),t("#upfront-image-file-input").click()},checkFileUpdate:function(){return!0},uploadImage:function(e){var i=this;i.setup_upload_form(),this.openProgress(function(){t("#upfront-upload-image").fileupload("send",{files:e})})}});return n})}(jQuery),function(t){define("elements/upfront-image/js/crop-controls",[],function(){var t=Upfront.Settings.l10n.image_element,e=Backbone.View.extend({className:"crop-contols-wrapper",initialize:function(t){this.options=t||{}},render:function(){var e=this;return this.items=_([new Upfront.Views.Editor.Field.Button({model:this.model,label:t.btn.swap_image,id:"image-edit-button-swap",className:"image-crop-edit-button image-edit-col-full",compact:!0,on_click:function(){e.trigger("crop:swap:image")}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:t.btn.natural_size,id:"image-edit-button-reset",className:"image-crop-edit-button image-edit-col-full",compact:!0,on_click:function(){e.trigger("crop:reset:image")}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:t.btn.fit,id:"image-edit-button-fit",className:"image-crop-edit-button image-edit-col-half",compact:!0,on_click:function(){e.trigger("crop:fit:image")}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:t.btn.fill,id:"image-edit-button-fill",className:"image-crop-edit-button image-edit-col-half image-edit-col-half-last",compact:!0,on_click:function(){e.trigger("crop:fill:image")}})]),this.items.each(function(t){t.render(),t.delegateEvents(),this.$el.append(t.el)},this),this}});return e})}(jQuery),function(t){define("elements/upfront-image/js/image-editor",["text!elements/upfront-image/tpl/image_editor.html","elements/upfront-image/js/crop-controls"],function(e,i){var n=Upfront.Settings.l10n.image_element,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().get("column_padding");o=parseInt(o,10),o=_.isNaN(o)?15:o;var r=Backbone.View.extend({id:"upfront-image-edit",rotation:0,mode:"big",invert:!1,tpl:_.template(t(e).find("#editor-tpl").html()),src:"#",bordersWidth:0,response:!1,fullSize:{width:0,height:0},buttons:[],sizes:!1,events:{"click #image-edit-button-ok":"imageOk","click .image-align-point":"pointAlignment","click #image-edit-button-align":"selectAlign","click .image-fit-element-button":"fillImage"},initialize:function(){var e=this;this.$el.on("click",function(t){t.target===t.currentTarget&&(e.saveOnClose?e.imageOk():e.isResizing||e.isDragged||e.cancel()),e.isResizing=!1,e.isDragged=!1}),t("body").bind("keyup",function(t){27===t.keyCode&&"undefined"!=typeof e.element_id&&e.close()})},resetDefaults:function(){this.rotation=0,this.mode="big",this.invert=!1,this.src="#",this.fullSize={width:0,height:0},this.setImageInitialSize=!1,this.buttons=[{id:"image-edit-button-ok",text:n.btn.save_label,tooltip:n.btn.save_info}],this.sizes=!1,this.align="left",this.valign="top",this.isDotAlign=!1,this.saveOnClose=!1,this.elementSize=!1,this.fitImageButton=!0},centerImageOffset:function(t,e){return{top:-(t.height-e.height)/2,left:-(t.width-e.width)/2}},createImageControl:function(t){var e=new Upfront.Views.Editor.InlinePanels.ImageControl,o=this,r=t.element_cols,s=new i({model:this.model});return this.listenTo(s,"crop:swap:image",this.changeImage),this.listenTo(s,"crop:reset:image",this.image100),this.listenTo(s,"crop:fit:image",this.fitImage),this.listenTo(s,"crop:fill:image",this.fillImage),e.view=s,e.tooltip=n.btn.image_tooltip,e.render(),setTimeout(function(){if(r<5&&(o.$el.find(".image-edit-button").css({width:50}),o.$el.find(".image-ok-button").css({left:t.maskOffset.left+(t.maskSize.width-50)})),r<5&&r>2&&(o.$el.find("#image-edit-buttons").css({top:t.maskOffset.top,left:t.maskOffset.left-36}),o.$el.find(".image-align-points").css({left:t.maskOffset.left})),r<3){o.$el.find("#image-edit-buttons").css({top:t.maskOffset.top,left:t.maskOffset.left-36});var e=o.$el.find(".image-align-points");e.css({left:t.maskOffset.left-e.width()/2+t.maskSize.width/2}),o.$el.find(".image-ok-button").css({top:t.maskOffset.top,left:t.maskOffset.left+(t.maskSize.width+35)}),o.$el.find(".image-ok-button").prepend('<div class="image-edit-size-buttons"><span class="image-increase-size">+</span><span class="image-decrease-size">-</span></div>');var i=o.$el.find(".image-edit-size-buttons"),n=o.options.size,s=n.width/n.height;i.length&&(i.find(".image-increase-size").click(function(t){t.preventDefault();var e=1;"undefined"!=typeof t.shiftKey&&t.shiftKey===!0&&(e=5),o.buttonIncreaseSize(e,s)}),i.find(".image-decrease-size").click(function(t){t.preventDefault();var e=1;"undefined"!=typeof t.shiftKey&&t.shiftKey===!0&&(e=5),o.buttonDecreaseSize(e,s)})),o.$el.find(".image-edit-resize").hide()}},100),e},buttonIncreaseSize:function(t,e){var i=this.$("#uimage-canvas"),n=this.$("#uimage-drag-handle"),o=this.options.size,r=this.invert?o.height+t:o.width+t;this.invert?o.width+t:o.height+t;canvasSize={width:r,height:r/e},this.options.size=canvasSize,i.css(canvasSize),n.css(canvasSize),this.selectMode(canvasSize,!0),this.setImageSize(canvasSize)},buttonDecreaseSize:function(t,e){var i=this.$("#uimage-canvas"),n=this.$("#uimage-drag-handle"),o=this.options.size,r=this.invert?o.height-t:o.width-t;this.invert?o.width-t:o.height-t;canvasSize={width:r,height:r/e},this.options.size=canvasSize,i.css(canvasSize),n.css(canvasSize),this.selectMode(canvasSize,!0),this.setImageSize(canvasSize)},pointAlignment:function(e){var i=t(e.target),n=i.data("alignment");this.$el.find(".image-align-point").removeClass("active-alignment-point"),i.addClass("active-alignment-point");var o=n.split("-");this.setAlign(o[1],o[0]),this.isDotAlign=!0},setDotAlignment:function(){this.higlighActiveDot(),!!this.isDotAlign==!0&&this.setAlign(this.align,this.valign)},higlighActiveDot:function(){if(this.$el.find(".image-align-point").removeClass("active-alignment-point"),"undefined"!=typeof this.isDotAlign&&!!this.isDotAlign==!0){var t=this.$el.find("."+this.valign+"-"+this.align+"-point");t.length&&t.addClass("active-alignment-point")}},open:function(e){e.maskSize&&e.editElement&&e.editElement.elementSize&&e.maskSize.height<e.editElement.elementSize.height&&e.editElement.elementSize.height<e.fullSize.height&&(e.maskSize.width=e.editElement.elementSize.width+2,e.maskSize.height=e.editElement.elementSize.height),this.resetDefaults(),this.options=e,this.src=e.src,this.saveOnClose=e.saveOnClose,e.maskOffset.top+=this.fixImageTop(e.maskOffset),this.setOptions(e);var i=this.maybeResizeElement(e);if(i)return e.position={top:0,left:0},e.maskSize=i.maskSize,e.size=i.imageSize,e.setImageSize=!1,e.align="left",e.resizedElement=!0,this.open(e);this.options.editElement||(this.buttons=[{id:"image-edit-button-ok",text:n.btn.save_label,tooltip:n.btn.save_info}]);var o=this.bordersWidth/2,r={top:parseInt(e.maskOffset.top,10)-o,left:parseInt(e.maskOffset.left,10)-o},s={width:parseInt(e.maskSize.width,10)+this.bordersWidth,height:parseInt(e.maskSize.height,10)+this.bordersWidth};e.position||(e.position=this.centerImageOffset(e.size,s));var a={top:parseInt(r.top,10)-e.position.top+o,left:parseInt(r.left,10)-e.position.left+o},l={width:parseInt(e.size.width,10),height:parseInt(e.size.height,10)};if(this.imageId=e.id,this.src=e.srcOriginal,this.fullSize=e.fullSize,e.align&&(this.align=e.align),e.valign&&(this.valign=e.valign),e.isDotAlign&&(this.isDotAlign=e.isDotAlign),this.setImageInitialSize){var p=this.getFullWidthImage();l=p.size,a.left=p.left}else e.imageFit&&(l=this.initialImageSize(0,!1,s));var d={size:l,offset:a,maskOffset:r,rotation:"rotate_"+this.rotation,src:this.src,maskSize:s,buttons:this.buttons,fitMask:e.fitMaskColumns};return this.$el.html(this.tpl(d)).find("div").hide(),this.$el.closest("body").length||(this.response=t.Deferred(),t("body").append(this.$el)),imageControl=this.createImageControl(e),this.$el.find("#image-edit-buttons").prepend(t('<div class="uimage-edit-controls upfront-ui"></div>').append(imageControl.$el)),this.addGridLines(r.top,s.height),this.$el.css({height:t(document).height(),width:t(document).width()}).find("div").fadeIn(200),this.selectMode(l),this.startEditorUI(),this.selectMode(l,!0),this.setImageSize(l),this.setDotAlignment(),this.$("#image-edit-button-align").addClass("align-"+this.align),this.setImageInitialSize&&this.resetImage(!1,!1),e.editElement&&this.check100ButtonActivation(),this.response.promise()},setOptions:function(t){var e=this;"undefined"!=typeof t.rotation?this.setRotation(t.rotation):this.setRotation(0),t.setImageSize&&(this.setImageInitialSize=!0),t.extraButtons&&t.extraButtons.length&&_.each(t.extraButtons,function(t){e.buttons.push({id:t.id,text:t.text}),e.$el.off("click","#"+t.id).on("click","#"+t.id,function(i){t.callback(i,e)})}),this.element_id=t.element_id||!1},check100ButtonActivation:function(){var t=this.getFullWidthImage(this.options.fullSize).size,e=(this.getCurrentImageRowsCols(t.width,t.height),this.options.fullSize),i=this.$("#image-edit-button-reset"),n=this.$("#uimage-canvas");"undefined"!=typeof this.options.fullSize&&this.options.fullSize||(e=t),e.width===n.width()&&e.height===n.height()&&(i.find("input").prop("disabled",!0),i.addClass("image-reset-disabled"))},maybeResizeElement:function(t,e){if(!t.editElement)return!1;var i=t.editElement,n={maxColumns:i.get_element_max_columns(),maxRows:i.get_element_max_rows(),rowHeight:o};if(n.maxRows||(n.maxRows=i.get_element_rows()),n.columnWidth=i.get_element_max_columns_px()/n.maxColumns,n.rows=Math.round(t.maskSize.height/o)+2,n.columns=Math.ceil(t.maskSize.width/n.columnWidth),this.elementSize=n,!t.setImageSize)return!1;var r=this.getFullWidthImage(t.fullSize).size,s=this.getCurrentImageRowsCols(r.width,r.height),a={width:s.columns*this.elementSize.columnWidth-2*o,height:(s.rows-2)*this.elementSize.rowHeight};if(s.columns>n.columns||s.rows>n.rows)return!1;if(e){if(this.elementSize.maxColumns<s.columns){var l=this.elementSize.maxColumns*this.elementSize.columnWidth-2*o;a={width:l,height:r.height}}}else a={width:Math.max(s.columns,n.columns)*n.columnWidth-2*o,height:(Math.min(s.rows,n.rows)-2)*o};return{maskSize:a,imageSize:r}},imageOk:function(){var t=this.getEditorResults(),e=this,i=new Upfront.Views.Editor.Loading({loading:n.saving,done:n.saving_done,fixed:!1}),o=this.$("#uimage-mask");t.imageId&&(i.render(),o.append(i.$el),this.saveImageEdition(t.imageId,t.rotation,t.imageSize,{top:t.imageOffset.top,left:t.imageOffset.left,width:t.maskSize.width,height:t.maskSize.height}).done(function(n){var o=n.data.images[t.imageId];return i.done(),o.error?(Upfront.Views.Editor.notify("Image failed to process. "+o.msg,"error",15e3),void e.close()):(t.src=o.url,t.srcFull=o.urlOriginal,t.cropSize=o.crop,t.gif=o.gif||0,e.options.resizedElement&&(t.elementSize=e.getCurrentMaskRowsCols()),e.response.resolve(t),void e.close())}))},close:function(t){var e=this;this.unfixImageTop(),this.$("div").fadeOut(200,function(){e.$el.detach()}),this.options=!1,e.response.reject({reason:t,id:this.imageId})},cancel:function(t){this.close(t)},changeImage:function(){this.close("changeImage")},getEditorResults:function(){var t=this.$("#uimage-canvas"),e=t.find("img"),i=this.$("#uimage-mask"),n=e.attr("src"),o=this.bordersWidth/2;return{imageSize:{width:Math.round(this.invert?e.height():e.width()),height:Math.round(this.invert?e.width():e.height())},imageOffset:{top:i.offset().top-t.offset().top+o,left:i.offset().left-t.offset().left+o},maskSize:{width:i.width(),height:i.height()},rotation:this.rotation,imageId:this.imageId,fullSize:this.fullSize,srcOriginal:n,align:this.align,valign:this.valign,isDotAlign:this.isDotAlign,stretch:"big"===this.mode||"horizontal"===this.mode,vstretch:"big"===this.mode||"vertical"===this.mode,mode:this.mode}},rotate:function(e){var i=this.rotation,n=this.$(".uimage-img"),o="",r={width:n.width(),height:n.height()},s=this.$("#uimage-canvas"),a=this.$("#uimage-drag-handle");e&&(e.preventDefault(),e.stopPropagation()),i=270===i?0:i+90,i&&(o="rotate_"+i),n.removeClass().addClass("uimage-img "+o),this.setRotation(i),this.invert?(s.css({height:r.width,width:r.height}),a.css({height:r.width,width:r.height}),n.css({height:r.height,width:r.width})):(s.css(r),a.css(r),n.css({height:"100%",width:"100%"})),n.css(this.imgOffset({width:n.width(),height:n.height()})),this.selectMode({width:s.width(),height:s.height()}),t("#uimage-drag-handle").draggable("option","containment",this.getContainment()),this.setResizingLimits()},setRotation:function(t){this.rotation=t,this.invert=[90,270].indexOf(t)!==-1},imgOffset:function(t){return this.invert?{top:Math.floor((t.width-t.height)/2),left:Math.floor((t.height-t.width)/2)}:{top:0,left:0}},startEditorUI:function(){var e=this,i=this.$("#uimage-canvas");t("#uimage-drag-handle").resizable({handles:{se:t(".image-edit-resize i")},autoHide:0,aspectRatio:!0,start:function(){e.$("#image-edit-button-reset").attr("class","image-crop-edit-button image-edit-col-full").attr("title",n.btn.exp_info).find("input").prop("disabled",!1),e.isResizing=!0},resize:function(t,n){i.css(n.size),e.setImageSize(n.size)},stop:function(n,o){var r=e.$("#uimage-drag-handle");n.preventDefault();var s,a={width:e.invert?o.size.height:o.size.width,height:e.invert?o.size.width:o.size.height},l=e.fullSize.width/Math.floor(a.width);a={width:Math.floor(a.width),height:Math.round(e.fullSize.height/l)},s={width:e.invert?a.height:a.width,height:e.invert?a.width:a.height},i.css(s),r.css(s),e.selectMode(s,!0),e.setImageSize(s),"small"!==e.mode&&"vertical"!==e.mode||e.centerImage(!1),t("#uimage-drag-handle").draggable("option","containment",e.getContainment())}}).draggable({opacity:1,start:function(){e.isDragged=!0,e.isDotAlign=!1,e.higlighActiveDot()},drag:function(t,n){i.css({top:n.position.top,left:n.position.left}),e.setAlignDotsOnDrag(n.position.top,n.position.left)},stop:function(t,n){i.css({top:n.position.top,left:n.position.left}),e.setResizingLimits()},containment:e.getContainment()}),e.setResizingLimits()},setAlignDotsOnDrag:function(t,e){limits=this.getContainment(),limitRight=limits[0],limitBottom=limits[1],limitLeft=limits[2],limitTop=limits[3],limitRight===limitLeft&&limitBottom===limitTop||(limitLeft===e&&limitTop===t&&this.setDotAlignPosition("top","left"),limitRight===e&&limitTop===t&&this.setDotAlignPosition("top","right"),limitLeft===e&&limitBottom===t&&this.setDotAlignPosition("bottom","left"),limitRight===e&&limitBottom===t&&this.setDotAlignPosition("bottom","right"))},setDotAlignPosition:function(t,e){this.align===e&&this.valign===t||(this.isDotAlign=!0,this.align=e,this.valign=t,this.higlighActiveDot())},addGridLines:function(t,e){for(var i=o,n=e-this.bordersWidth,r=this.bordersWidth/2;r<=n+i;)this.$el.append('<div class="gridline" style="position: absolute;width: 100%; height: 0; top:'+(t+r)+'px"></div>'),r+=i},selectMode:function(t,e){var i="small",n=this.$("#uimage-mask"),o={width:n.width(),height:n.height()};t.width>=o.width?i=t.height>=o.height?"big":"horizontal":t.height>=o.height&&(i="vertical"),this.setMode(i,e)},setMode:function(e,i){var n=t("#uimage-drag-handle"),o=("small"===e||"vertical"===e)&&e!==this.mode;this.$el.removeClass("uimage-mode-big uimage-mode-small uimage-mode-vertical uimage-mode-horizontal uimage-mode-tiny").addClass("uimage-mode-"+e),(n.width()<40||n.height()<40)&&this.$el.addClass("uimage-mode-tiny"),this.mode=e,i&&("horizontal"===this.mode||"small"===this.mode?n.draggable("option",{snap:".gridline",snapMode:"outer",snapTolerance:6}):n.draggable("option",{snap:!1})),o&&this.centerImage(!1)},setImageSize:function(t){if(this.invert){var e={width:t.height,height:t.width};this.$(".uimage-img").css(e).css(this.imgOffset(e))}},getContainment:function(){var t=this.$("#uimage-canvas"),e=this.$("#uimage-mask"),i=e.offset(),n=this.bordersWidth/2;if("big"===this.mode)return[i.left-t.width()+e.width()+n,i.top-t.height()+e.height()+n,i.left+n,i.top+n];if("horizontal"===this.mode)return[i.left-t.width()+e.width()+n,i.top,i.left+n,i.top-t.height()+e.height()];var o="left"===this.align?i.left:"right"===this.align?i.left+e.width()-t.width():i.left+(e.width()-t.width())/2;return o+=n,"vertical"===this.mode?[o,i.top-t.height()+e.height()+n,o,i.top+n]:[o,i.top,o,i.top-t.height()+e.height()]},setResizingLimits:function(){var e=this.$("#uimage-canvas"),i=this.$("#uimage-mask"),n=i.offset(),r={minWidth:o,minHeight:o};"big"===this.mode&&(r={minWidth:i.width()+n.left-e.offset().left+this.bordersWidth,minHeight:i.height()+n.top-e.offset().top+this.bordersWidth}),t("#uimage-drag-handle").resizable("option",r)},resetImage:function(t,e){t&&(t.preventDefault(),t.stopPropagation()),this.setRotation(270),this.rotate(),this.setImageFullSize(t,e),this.centerImage(!0)},image100:function(t){var e=this.getFullWidthImage(this.options.fullSize).size,i=this.getCurrentImageRowsCols(e.width,e.height),n=this.options.fullSize,o=i,r=e.height;o={columns:this.elementSize.maxColumns,rows:Math.ceil(r/this.elementSize.rowHeight)+2},o.columns=this.elementSize.maxColumns,"undefined"!=typeof this.options.fullSize&&this.options.fullSize||(n=e);var s=this.$("#uimage-mask").offset();e.top=s.top,e.left=s.left,this.$("#uimage-canvas").css(n),this.$("#uimage-drag-handle").css(n),22!==o.columns&&i.columns>o.columns&&this.showExpandAlert(),this.align=this.valign="center",this.higlighActiveDot(),this.setAlign("center","center"),this.check100ButtonActivation()},getCurrentImageRowsCols:function(t,e){var i=this.$("#uimage-canvas"),n=t?t:i.width(),r=e?e:i.height();return{rows:Math.ceil(r/this.elementSize.rowHeight)+2,columns:Math.ceil((n+2*o)/this.elementSize.columnWidth)}},getCurrentMaskRowsCols:function(){var t=this.$("#uimage-mask");return this.getCurrentImageRowsCols(t.width(),t.height())},showExpandAlert:function(){if(!this.ignoreFullwidthAlert){var i=this;Upfront.Popup.open(function(){},{width:320},"warning_img").progress(function(e){"before_close"===e&&(i.ignoreFullwidthAlert=t("#upfront-popup-content").find("input:checked").length)}),t("#upfront-popup-content").append(_.template(t(e).find("#fullwidth-alert-tpl").html(),{l10n:n.template}))}},resizeMask:function(t,e){var i=this.options;i.maskSize={width:this.elementSize.columnWidth*t-2*o,height:this.elementSize.rowHeight*(e-2)},i.size=this.getFullWidthImage().size,i.position={left:0,top:0},i.setImageSize=!1,i.resizedElement=!0,this.open(i)},clearDotAlign:function(t){this.isDotAlign=!1,this.$el.find(".image-align-point").removeClass("active-alignment-point"),t===!0&&this.setAlign("center","center")},fitImage:function(){var e=this.$("#uimage-canvas"),i=this.$("#uimage-mask"),o=this.$("#uimage-drag-handle"),r=this.getResizeImageDimensions(this.fullSize,{width:i.width(),height:i.height()},"inner",0);this.invert&&(r={width:r.height,height:r.width}),e.css(r),o.css(r),this.setImageSize(r),this.centerImage(!0),this.selectMode(r,!0),this.centerImage(!0),this.setResizingLimits(),this.clearDotAlign(!0),t("#uimage-drag-handle").draggable("option","containment",this.getContainment()),t("#image-edit-button-reset").attr("class","image-crop-edit-button image-edit-col-full").attr("title",n.btn.exp_info).find("input").prop("disabled",!1)},fitMask:function(){var e=t("#uimage-canvas"),i=t("#uimage-mask"),n=Math.round((i.width()+2*o)/this.options.fitMaskColumns),r={width:e.width(),height:e.height()},s=o,a=Math.ceil((r.width+2*o)/n),l={height:Math.ceil(r.height/s)*s,width:a*n-2*o},p=this.options;p.position={top:0,left:0},p.size=r,p.maskSize=l,p.align="left",p.setImageSize=!1,p.rotation=this.rotation,p.elementColumns=a,this.open(p)},fillImage:function(){var e=this.$("#uimage-canvas"),i=this.$("#uimage-mask"),o=this.$("#uimage-drag-handle"),r=this.getResizeImageDimensions(this.fullSize,{width:i.width(),height:i.height()},"outer",0);this.invert&&(r={width:r.height,height:r.width}),e.css(r),o.css(r),this.setImageSize(r),this.centerImage(!0),this.selectMode(r,!0),this.centerImage(!0),this.setResizingLimits(),this.clearDotAlign(!0),t("#uimage-drag-handle").draggable("option","containment",this.getContainment()),t("#image-edit-button-reset").attr("class","image-crop-edit-button image-edit-col-full").attr("title",n.btn.exp_info).find("input").prop("disabled",!1)},setImageFullSize:function(e){e&&e.preventDefault();var i=this.$(".uimage-img"),n=this.$("#uimage-mask"),o=this.$("#uimage-canvas"),r=this.$("#uimage-drag-handle"),s=this.initialImageSize(100,!1,{width:n.width(),height:n.height()});o.css(s),r.css(s),i.css({height:"100%",width:"100%"}),this.selectMode(s,!0),this.setResizingLimits(),t("#uimage-drag-handle").draggable("option","containment",this.getContainment())},centerImage:function(t){var e=this.$("#uimage-canvas"),i=this.$("#uimage-mask"),n=this.$("#uimage-drag-handle"),o=this.bordersWidth/2,r={top:e.offset().top};t&&(r.top=i.offset().top-(e.height()-i.height())/2+o),"vertical"!==this.mode&&"small"!==this.mode||"center"===this.align?r.left=i.offset().left-(e.width()-i.width())/2:"left"===this.align?r.left=i.offset().left:r.left=i.offset().left+i.width()-e.width(),r.left+=o,e.css(r),n.css(r)},getFullWidthImage:function(e){var i=t(document.querySelector(".upfront-grid-layout")),n=i.width()-2*o,r=e||this.fullSize;if(this.options&&this.options.editElement){var s=this.options.editElement.$el;i=s.parents(".upfront-grid-layout"),n=i.width()-2*o}return r.width>n&&(r={width:n,height:Math.round(r.height/(r.width/n))}),{size:r,left:i.offset().left+o}},initialImageSize:function(t,e,i){var n,o,r,s=this.$("#uimage-mask"),a={width:0,height:0},l=i?i:{width:s.width(),height:s.height()},p=!!e;return t=t?t:0,n=l.width/l.height<this.fullSize.width/this.fullSize.height?"height":"width",r=this.invert?"width"===n?"height":"width":n,o=this.fullSize[n]/(l[r]+t),a=!p&&o<1?this.fullSize:{width:Math.ceil(this.fullSize.width/o),height:Math.ceil(this.fullSize.height/o)}},getResizeImageDimensions:function(t,e,i,n){var o=t.width/t.height,r=e.width/e.height,s=i&&"outer"===i?"outer":"inner",a="inner"===s?o>r?"width":"height":o>r?"height":"width",l=n||0,p=e[a]+l,d=p/t[a];return{width:Math.round(t.width*d),height:Math.round(t.height*d)}},getImageData:function(t,e,i){var n={action:"upfront-media-image_sizes",item_id:JSON.stringify(t),element_id:i};return e&&(n.customSize=e),Upfront.Util.post(n)},saveImageEdition:function(t,e,i,n){var o={action:"upfront-media-image-create-size",images:[{element_id:this.element_id,id:t,rotate:e,resize:i,crop:n}]};return Upfront.Util.post(o)},selectAlign:function(){"left"===this.align?this.setAlign("center"):"center"===this.align?this.setAlign("right"):"right"===this.align&&this.setAlign("left")},setAlign:function(t,e){var i=this.$("#uimage-mask"),n=this.$("#uimage-canvas"),o=this.$("#uimage-drag-handle"),r=n.position();return this.$("#image-edit-button-align").removeClass("align-left align-right align-center").addClass("align-"+t),("left"===t||"center"===t||"right"===t)&&(("top"===e||"center"===e||"bottom"===e)&&(this.align=t,"center"===this.align?r.left=i.offset().left-(n.width()-i.width())/2:"left"===this.align?r.left=i.offset().left:r.left=i.offset().left+i.width()-n.width(),this.valign=e,"undefined"!=typeof e&&("center"===e?r.top=i.offset().top-(n.height()-i.height())/2:"top"===e?r.top=i.offset().top:r.top=i.offset().top+i.height()-n.height()),r.left+=this.bordersWidth/2,n.css(r),o.css(r),void this.$("#uimage-drag-handle").draggable("option","containment",this.getContainment())))},keyMove:function(t){switch(t.which){case 40:this.maskOffset.top--,this.positionEditorElements();break;case 39:this.maskOffset.left--,this.positionEditorElements();break;case 37:this.maskOffset.left++,this.positionEditorElements();break;case 38:this.maskOffset.top++,this.positionEditorElements()}},fixImageTop:function(e){if(e&&"undefined"!=typeof e.top&&e.top<120){var i=t("body").css("marginTop");if(i=parseInt(i.replace("px",""),10),!isNaN(i))return this.fixTop=120-e.top,t("body").css("marginTop",i+this.fixTop),this.fixTop}return 0},unfixImageTop:function(){if(this.fixTop){var e=t("body").css("marginTop");e=parseInt(e.replace("px",""),10),isNaN(e)||t("body").css("marginTop",e-this.fixTop),this.fixTop=0}}});return r})}(jQuery),define("elements/upfront-image/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.uimage.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug),t.image_caption="<p>$s</p>".replace("$s",t.image_caption),this.init_properties(t)}});return t}),define("elements/upfront-image/js/image-element",["elements/upfront-image/js/model"],function(t){var e=Upfront.Settings.l10n.image_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:20,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-image"),this.$el.html(e.element_name)},add_element:function(){var e=new t,i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-image_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(255)}],objects:[e]});this.add_module(i)}});return i}),function(t){define("uimage",["text!elements/upfront-image/tpl/image.html","text!elements/upfront-image/tpl/image_editor.html","elements/upfront-image/js/image-context-menu","elements/upfront-image/js/image-settings","elements/upfront-image/js/image-selector","elements/upfront-image/js/image-editor","elements/upfront-image/js/image-element","scripts/upfront/link-model","elements/upfront-image/js/model","text!elements/upfront-image/tpl/preset-style.html","scripts/upfront/preset-settings/util"],function(e,i,n,o,r,s,a,l,p,d,c){var u=Upfront.Settings.l10n.image_element,h=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().get("column_padding");h=parseInt(h,10),h=_.isNaN(h)?15:h;var f=Upfront.Views.ObjectView.extend({model:p,imageTpl:Upfront.Util.template(e),sizehintTpl:_.template(t(i).find("#sizehint-tpl").html()),cropTimeAfterResize:1,display_size_hint:!1,resizingData:{},initialize:function(){var e=this;this.setDefaults(),this.model instanceof p||(this.model=new p({properties:this.model.get("properties")})),this.events=_.extend({},this.events,{"click a.upfront-image-select":"openImageSelector","click div.upfront-quick-swap":"openImageSelector","dblclick .wp-caption":"editCaption","click a":"handleLinkClick","click .swap-image-overlay":"openImageSelector"}),this.delegateEvents(),this.bodyEventHandlers={dragover:function(t){t.preventDefault(),e.handleDragEnter(t)},dragenter:function(t){e.handleDragEnter(t)},dragleave:function(t){e.handleDragLeave(t)}},t("body").on("dragover",this.bodyEventHandlers.dragover).on("dragenter",this.bodyEventHandlers.dragenter).on("dragleave",this.bodyEventHandlers.dragleave).on("drop",this.bodyEventHandlers.drop),this.property("image_id")||this.property("srcFull",this.property("src")),this.listenTo(this.model.get("properties"),"change",this.update),this.listenTo(this.model.get("properties"),"add",this.update),this.listenTo(this.model.get("properties"),"remove",this.update),this.listenTo(this.model,"uimage:edit",this.editRequest),"ok"!==this.property("image_status")||this.property("quick_swap")||this.isThemeImage()&&!Upfront.themeExporter?this.property("has_settings",0):this.property("has_settings",1),this.listenTo(Upfront.Events,"upfront:import_image:populate_theme_images",this.populate_theme_images),this.listenTo(Upfront.Events,"upfront:import_image:imported",this.imported_theme_image),this.listenTo(Upfront.Events,"upfront:element:edit:start",this.on_element_edit_start),this.listenTo(Upfront.Events,"upfront:element:edit:stop",this.on_element_edit_stop),this.listenTo(Upfront.Events,"command:layout:save",this.saveResizing),this.listenTo(Upfront.Events,"command:layout:save_as",this.saveResizing),this.listenTo(Upfront.Events,"preset:image:updated",this.caption_updated,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",function(t){"desktop"!==t.id?this.mobileMode=!0:this.unsetMobileMode()}),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.on_change_breakpoint),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint:after",this.on_change_breakpoint_after),this.listenTo(Upfront.Events,"upfront:grid:updated",this.on_grid_update),this.property("link")===!1?(this.link=new l({type:this.property("when_clicked"),url:this.property("image_link"),target:this.property("link_target")}),this.property("link",this.link.toJSON())):this.link=new l(this.property("link")),e.listenTo(this.link,"change",function(){e.property("link",e.link.toJSON())}),this.listenTo(Upfront.Events,"entity:module:update",this.on_uimage_update),this.listenTo(this.model,"preset:updated",this.preset_updated)},get_preset_properties:function(){var t=this.model.get_property_value_by_name("preset"),e=c.getPresetProperties("image",t)||{};return e},get_preset_property:function(t){var e=this.model.get_property_value_by_name("preset"),i=c.getPresetProperties("image",e)||{};return i[t]},preset_updated:function(t){this.render(),Upfront.Events.trigger("preset:image:updated",t)},caption_updated:function(t){var e=this.model.get_property_value_by_name("preset");e===t&&this.render()},update_colors:function(){var t=this.get_preset_properties();return!(_.size(t)<=0)&&void c.updatePresetStyle("gallery",t,d)},populate_theme_images:function(t){this.isThemeImage()&&t.push(this.property("srcFull"))},imported_theme_image:function(t){var e=this.property("srcFull");this.isThemeImage()&&t.fullpath==e&&(this.property("image_id",t.id),this.property("srcFull",t.src),this.property("srcOriginal",t.src))},setDefaults:function(){this.sizes=!1,this.originalDesktopElementSize={width:0,height:0},this.elementSize={width:0,height:0},this.imageId=0,this.imageSize={width:0,height:0},this.imageOffset={top:0,left:0},this.maskOffset={top:0,left:0},this.imageInfo=!1,this.controls=!1,this.editor=!1,this.temporaryProps={size:!1,position:!1},this.cropTimer=!1,this.stoppedTimer=!1},getSelectedAlignment:function(){if(!this.property("include_image_caption")&&this.get_preset_property("caption-position")===!1&&this.property("caption_alignment")===!1)return"nocaption";if("below_image"===this.get_preset_property("caption-position"))return"below";var t=this.property("caption_alignment");switch(t){case"top":return"topOver";case"bottom":return"bottomOver";case"fill":return"topCover";case"fill_middle":return"middleCover";case"fill_bottom":return"bottomCover"}return"nocaption"},isThemeImage:function(){return this.property("srcFull")&&this.property("srcFull").match(Upfront.mainData.currentThemePath)},replaceImage:function(){this.openImageSelector()},createLinkControl:function(){var t,e=this,i=new Upfront.Views.Editor.InlinePanels.DialogControl;return i.view=t=new Upfront.Views.Editor.LinkPanel({model:this.link,linkTypes:{image:!0},imageUrl:this.property("srcFull")}),this.listenTo(i,"panel:ok",function(){"lightbox"==t.model.get("type")&&""!==t.$el.find(".js-ulinkpanel-lightbox-input").val()&&t.createLightBox(),i.close(),this.render()}),this.listenTo(i,"panel:open",function(){e.$el.closest(".ui-draggable").draggable("disable"),_.delay(function(){e.controls.$el.parent().parent().addClass("upfront-control-visible")},1e3)}),e.listenTo(i,"panel:close",function(){e.controls.$el.parent().parent().removeClass("upfront-control-visible"),e.$el.closest(".ui-draggable").draggable("enable")}),e.listenTo(t,"linkpanel:close",function(){i.close()}),i.icon="link",i.tooltip=u.ctrl.image_link,i.id="link",i},postTypes:function(){var t=[];return _.each(Upfront.data.ugallery.postTypes,function(e){"attachment"!==e.name&&t.push({
name:e.name,label:e.label})}),t},editCaption:function(){var e=this,i=t("#"+this.property("element_id")).find(".wp-caption");i.find(".uimage-caption-cover").length&&(i=i.find(".uimage-caption-cover")),!i.data("ueditor")&&i.length&&i.ueditor({autostart:!1,focus:!1,upfrontMedia:!1,upfrontImages:!1,linebreaks:!1,airButtons:["upfrontFormatting","bold","italic","stateAlign","upfrontLink","upfrontColor","upfrontIcons"]}).on("start",function(){e.$el.addClass("upfront-editing")}).on("stop",function(){e.$el.removeClass("upfront-editing"),e.render()}).on("syncAfter",function(){e.property("image_caption",i.html())})},createControl:function(t,e,i){var n=this,o=new Upfront.Views.Editor.InlinePanels.Control;return o.icon=t,o.tooltip=e,i&&this.listenTo(o,"click",function(t){n[i](t)}),o},setImageInfo:function(){var t,e,i=this.$(".upfront-image-starting-select"),n=this.temporaryProps.size,o=this.temporaryProps.position,r="below_image"===this.get_preset_property("caption-position")?this.$(".wp-caption").outerHeight():0;i.length?(t={width:i.outerWidth(),height:i.outerHeight()},e=i.offset(),o=!1):(i=this.$(".uimage"),t={width:i.width(),height:i.height()-r},e={top:i.offset().top,left:i.offset().left}),this.imageInfo={id:this.property("image_id"),src:this.property("src"),srcFull:this.property("srcFull"),srcOriginal:this.property("srcOriginal"),size:n,position:o,rotation:this.property("rotation"),fullSize:this.property("fullSize"),align:this.property("align"),valign:this.property("valign"),isDotAlign:this.property("isDotAlign"),maskSize:t,maskOffset:e}},isSmallImage:function(){var t=this.model.get_breakpoint_property_value("element_size",!0);return this.resizingData.data&&this.resizingData.data.elementSize&&(t=this.resizingData.data.elementSize),t.width<100||t.height<50},disableCaption:function(){this.property("include_image_caption",!1)},enableCaption:function(){this.property("include_image_caption",!0)},hasCaptionPosition:function(){return this.property("usingNewAppearance")===!0?this.get_preset_property("caption-position")!==!1||this.property("caption_alignment")!==!1:this.property("include_image_caption")},setupBySize:function(){this.isSmallImage()?(this.disableCaption(),this.parent_module_view.$el.addClass("uimage-small")):this.hasCaptionPosition()&&this.enableCaption(),this.isSmallImage()||this.parent_module_view.$el.removeClass("uimage-small")},get_content_markup:function(){var e,i,n,o,r,s=this.model.get_breakpoint_property_value("element_size",!0),a=this,l=this.extract_properties();if(this.setupBySize(),this.temporaryProps&&this.temporaryProps.size||(this.temporaryProps={size:l.size,position:l.position}),l=this.extract_properties(),l.properties=this.get_preset_properties(),l.url=!!this.property("when_clicked")&&this.property("image_link"),l.url="unlink"!==this.link.get("type")&&this.link.get("url"),l.link_target=this.link.get("target"),l.element_size=s,l.size=this.temporaryProps.size,l.position=this.temporaryProps.position,l.marginTop=Math.max(0,-l.position.top),l.in_editor=!0,l.cover_caption="below_image"!==this.get_preset_property("caption-position"),l.stretch?(l.imgWidth="100%",l.stretchClass=" uimage-stretch"):(l.imgWidth=l.size.width+"px",l.stretchClass=""),l.containerWidth=Math.min(l.size.width,s.width),l.display_caption=this.property("display_caption")?this.property("display_caption"):"showCaption",l.gifImage="",l.gifLeft=0,l.gifTop=0,l.l10n=u.template,l.usingNewAppearance=l.usingNewAppearance||!1,l.usingNewAppearance&&(l.image_caption=l.image_caption.replace(/^<span style=".+?"/,"<span ")),e=this.imageTpl(l),this.property("quick_swap"))i=l.element_size.width<150||l.element_size.height<90?"uimage-quick-swap-small":"",Upfront.Application.user_can_modify_layout()&&(e+='<div class="upfront-quick-swap '+i+'"><p>Change this image</p></div>');else if("starting"===this.property("image_status"))e=Upfront.Application.user_can_modify_layout()?'<div class="upfront-image-starting-select upfront-ui" style="height:'+l.element_size.height+'px"><div class="uimage-centered"><span class="upfront-image-resizethiselement">'+u.ctrl.add_image+'</span><div class=""><a class="upfront-image-select" href="#" title="'+u.ctrl.add_image+'">+</a></div></div></div>':"";else{n=t("<div></div>").append(e),o=l.size,r=n.find("img"),l=this.temporaryProps;var p=this.update_style();p&&(s=p,o=this.temporaryProps.size),n.find(".upfront-image-container").css({overflow:"hidden",position:"relative",width:Math.min(s.width,o.width),height:Math.min(s.height,o.height)}),r.attr("src",a.property("srcFull")).css({width:o.width,height:o.height,position:"absolute",top:Math.min(0,-l.position.top),left:Math.min(0,-l.position.left),"margin-top":0,"max-height":"none","max-width":"none"}),e=n.html()}return e},toggle_caption_controls:function(){if(!Upfront.Application.user_can_modify_layout())return!1;var t=this,e=new Upfront.Views.Editor.InlinePanels.Panel;e.items=this.getControlItems(),e.render(),_.delay(function(){t.controls.$el.html(e.$el),t.updateControls()},400)},getElementShapeSize:function(t){var e=(this.$el.find(".upfront-image-container"),this.get_preset_properties()),i={};return"square"===e.imagestyle?(i.height=t.width,i.width=t.width,t.width!==t.height?i.defaultHeight=t.height:t.defaultHeight&&(i.defaultHeight=t.defaultHeight),i):!!t.defaultHeight&&(i={width:t.width,height:t.defaultHeight})},update_style:function(){var t=this.model.get_breakpoint_property_value("element_size",!0),e=this.getElementShapeSize(t);return!1!==e&&(t.width==e.width&&t.height==e.height||this.resizeImage(e)||this.model.set_breakpoint_property("element_size",e),e)},on_render:function(){var e=this,i=["bottom","fill_bottom"].indexOf(this.property("caption_alignment"))!==-1||"below_image"===this.get_preset_property("caption-position")?" sizehint-top":"",n=this.model.get_breakpoint_property_value("element_size",!0);this.parent_module_view.$el.data("resizeHandling")||this.parent_module_view.$el.data("resizeHandling",!0),"lightbox"===this.property("when_clicked")&&this.$("a").addClass("js-uimage-open-lightbox");var o=this.update_style();if(o&&(n=o),this.isThemeImage()&&!Upfront.themeExporter)Upfront.Application.user_can_modify_layout()&&(this.$el.addClass("image-from-theme"),this.$el.find("b.upfront-entity_meta").after('<div class="swap-image-overlay"><p class="upfront-icon upfront-icon-swap-image"><span>Click to </span>Swap Image</p></div>'));else{var r=t("<div>").addClass("upfront-ui uimage-resize-hint"+i);this.$el.append(r),setTimeout(function(){e.applyElementSize(!1,!1,!1)},300)}if("ok"!==this.property("image_status")){var s=this.$(".upfront-image-starting-select");return void(this.elementSize.height||(this.setElementSize(),s.height(this.elementSize.height)))}return!this.property("quick_swap")&&(setTimeout(function(){e.updateControls(),e.$el.removeClass("upfront-editing"),e.editCaption()},300),this.mobileMode&&(this.$(".uimage").addClass("uimage-mobile-mode"),this.once("update_position",this.setMobileMode)),this.setStuckToTop(),setTimeout(function(){e.$el.closest(".ui-draggable").on("dragstop",function(){setTimeout(function(){e.setStuckToTop()},10)}),e.$el.closest(".upfront-module-view").addClass("uimage-upfront-module-view")},100),setTimeout(function(){e.toggleResizableHandles()},100),void this.toggle_caption_controls())},toggleResizableHandles:function(){var t=this.$el.parents(".upfront-objects_container");this.isThemeImage()&&!Upfront.themeExporter?t.siblings(".ui-resizable-handle").addClass("ui-resizable-handle-hidden"):t.siblings(".ui-resizable-handle").removeClass("ui-resizable-handle-hidden")},setStuckToTop:function(){this.$el.offset().top+this.parent_module_view.$el.offset().top<25?this.$el.addClass("stuck-to-top"):this.$el.removeClass("stuck-to-top")},updateControls:function(){var t='<div class="upfront-element-controls upfront-ui"></div>';this.paddingControl&&"undefined"!=typeof this.paddingControl.isOpen&&this.paddingControl.isOpen||(this.$control_el&&0!==this.$control_el.length||(this.$control_el=this.$el),this.controls&&(this.controls.remove(),this.controls=!1,this.$control_el.find(">.upfront-element-controls").remove()),this.controls=this.createControls(),this.controls!==!1&&(this.controls.render(),0===this.$control_el.find(">.upfront-element-controls").length&&(this.$control_el.append(t),this.$control_el.find(">.upfront-element-controls").html("").append(this.controls.$el)),this.updateAdvancedPadding(),this.controls.delegateEvents()))},on_edit:function(){return!1},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t.preset=t.preset||"default",t},handleDragEnter:function(){return},handleDragLeave:function(){var t=this;this.dragTimer=setTimeout(function(){t.$(".uimage-drop-hint").remove(),this.dragTimer=!1},200)},setMobileMode:function(){var t=this.extract_properties(),e=this.model.get_breakpoint_property_value("row",!1);this.mobileMode=!0,this.$el.find(".uimage-resize-hint").hide().end().find(".uimage").css("min-height","none").find(".upfront-image-caption-container").css("width","100%").end().find(".upfront-image-container").css("width","100%").css("height","auto").end().find("img").css({position:"static",maxWidth:"100%",width:t.stretch?"100%":t.size.width,height:"auto"}).attr("src",this.property("src")),!1===e&&(this.$el.find("> .upfront-object").css("min-height",""),this.parent_module_view&&this.parent_module_view.$el.find("> .upfront-module").css("min-height",""))},unsetMobileMode:function(){this.mobileMode=!1},updateBreakpointPadding:function(t){var e=this.$el.find(".upfront-image");return""!==e.css("padding")?parseInt(e.css("padding"),10):t},after_breakpoint_change:function(){this.originalDesktopElementSize=this.property("element_size"),this.render()},on_element_resize_start:function(t){if(!this.mobileMode){var e=this.$(".upfront-image-starting-select");"below_image"!==this.get_preset_property("caption-position")&&this.$(".wp-caption").fadeOut("fast"),this.resizingData={starting:e,data:{position:this.property("position"),size:this.property("size"),checkSize:this.checkSize(),stretch:this.property("stretch"),vstretch:this.property("vstretch")},img:this.$("img"),setTextHeight:"below_image"===this.get_preset_property("caption-position")},this.cropTimer&&(clearTimeout(this.cropTimer),this.cropTimer=!1),e.length||("small"!==this.resizingData.data.checkSize&&this.$(".upfront-image-caption-container, .upfront-image-container").css({width:"100%",height:"100%",marginTop:0}),this.$(".uimage").css("min-height","auto"))}},on_element_resizing:function(t){if(!this.mobileMode){var e,i,n=this.resizingData.starting,o=this.resizingData.data,r=this.resizingData.img,s="below_image"===this.get_preset_property("caption-position")?this.$(".wp-caption").outerHeight():0,a=Upfront.Settings.LayoutEditor.Grid.column_padding,l=parseInt(t.width,10),p=parseInt(t.height,10)-s,d=(parseInt(this.model.get_breakpoint_property_value("left_padding_num")||a,10)+parseInt(this.model.get_breakpoint_property_value("right_padding_num")||a,10),parseInt(this.model.get_breakpoint_property_value("top_padding_num")||a,10)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||a,10));if(o.elementSize={width:l<0?10:l,height:p<0?10:p},i=this.getElementShapeSize(o.elementSize),!1!==i&&(o.elementSize=i),this.applyElementSize(o.elementSize.width,o.elementSize.height,!1),n.length)return n.outerHeight(o.elementSize.height);this.$(".uimage").css("height",o.elementSize.height-d);var c=this.property("is_locked");if(c===!1)o.stretch&&!o.vstretch?(this.resizingH(r,o,!0),this.resizingV(r,o)):!o.stretch&&o.vstretch?(this.resizingV(r,o,!0),this.resizingH(r,o)):(e=o.size.width/o.size.height-o.elementSize.width/o.elementSize.height,e>0&&o.stretch||e<0&&!o.stretch?(this.resizingV(r,o,!0),this.resizingH(r,o)):(this.resizingH(r,o,!0),this.resizingV(r,o)));else{var u,h=this.property("valign"),f=this.property("position"),_=this.property("isDotAlign"),g=this.$(".upfront-image-container").height(),m=this.checkSize(),v=r.position(),b=this.getMaskSize(),y=this.getImageViewport();"small"===m&&this.$(".upfront-image-caption-container, .upfront-image-container").css({width:b.width,height:b.height,position:"relative",overflow:"hidden"}),"undefined"!=typeof y.width&&o.elementSize.width>y.width&&r.css({left:v.left+(o.elementSize.width-y.width)}),"undefined"!=typeof y.height&&o.elementSize.height>y.height&&r.css({top:v.top+(o.elementSize.height-y.height)}),"small"===m&&_===!0&&("center"===h&&(u=o.size.height<o.elementSize.height?(o.size.height-o.elementSize.height)/2:-(o.elementSize.height-g)/2),"bottom"===h&&(u=o.size.height<o.elementSize.height?o.size.height-o.elementSize.height:-(o.elementSize.height-g)),this.$(".upfront-image-caption-container").css({marginTop:-u}),this.property("marginTop",-u),this.property("position",{top:u,left:f.left})),"small"===m&&_!==!0&&this.property("marginTop",0)}this.updateControls(),this.setupBySize()}},on_element_resize:function(t){if(!this.mobileMode&&this.resizingData&&this.resizingData.img&&this.resizingData.img.length){var e=this.resizingData.starting,i=this,n=this.resizingData.img,o={width:n.width(),height:n.height()},r=n.position(),s=1==this.property("no_padding")?0:this.updateBreakpointPadding(h),a=this.checkSize(),l=this.property("isDotAlign");if("small"===a&&l===!0&&(r={top:0,left:0}),e.length)return this.elementSize={height:t.height-2*s,width:t.width-2*s},void this.model.set_breakpoint_property("element_size",this.elementSize);if(!this.isThemeImage()){this.on_element_resizing(t),r.top=-r.top,r.left=-r.left,this.temporaryProps={size:o,position:r};var p=this.resizingData.data.elementSize;this.applyElementSize(p.width,"default_height"in p?p.default_height:p.height,!0),this.cropTimer=setTimeout(function(){i.saveTemporaryResizing()},this.cropTimeAfterResize),this.resizingData={},this.showCaption()}}},getMaskSize:function(){var t,e=this.property("size"),i=(this.checkSize(),this.model.get_breakpoint_property_value("element_size",!0)),n=Math.min(e.width,i.width),o=Math.min(e.height,i.height);return t={width:n,height:o}},getImageViewport:function(){var t,e,i,n=this.resizingData.img,o=n.position();return o.left<0&&(e=n.width()-Math.abs(o.left)),o.top<0&&(i=n.height()-Math.abs(o.top)),t={width:e,height:i}},on_uimage_update:function(t){this.parent_module_view&&this.parent_module_view==t&&(!_.isUndefined(this.resizingData)&&"starting"in this.resizingData&&this.resizingData.starting||this.applyElementSize())},showCaption:function(){this.$(".wp-caption").fadeIn("fast")},resizingH:function(t,e,i){var n,o=e.elementSize.width,r=i?e.size.width:t.width(),s=e.position.left,a={};return e.stretch?(o<r-s?(a.left=-s,i&&(a.width=r)):r>o&&o>=r-s?(a.left=o-r,i&&(a.width=r)):(a.left=0,i&&(a.width=o)),i&&(a.height="auto"),void t.css(a)):o>r?(n=this.property("align"),"left"===n?a.left=0:"center"===n?a.left=(o-r)/2:(a.left="auto",a.right=0),i&&(a.width=r,a.height="auto"),void t.css(a)):(a.left=0,i&&(a.width=o,a.height="auto"),void t.css(a))},resizingV:function(t,e,i){var n=e.elementSize.height,o=i?e.size.height:t.height(),r=e.position.top,s={};return e.vstretch?(n<o-r?(s.top=-r,i&&(s.height=o)):o>n&&n>=o-r?(s.top=n-o,i&&(s.height=o)):(s.top=0,i&&(s.height=n)),i&&(s.width="auto"),void t.css(s)):(n>o-r?(s.top=-r,i&&(s.height=o)):o-r>=n&&n>o?(s.top=n-o,i&&(s.height=o)):(s.top=0,i&&(s.height=n)),i&&(s.width="auto"),void t.css(s))},saveTemporaryResizing:function(){var e=this,i=e.model.get_breakpoint_property_value("element_size",!0),n={},o=e.property("image_id"),r=e.temporaryProps.size,s=e.temporaryProps.position,a=t.Deferred(),l=t.Deferred(),p=l.promise();return n.top=s.top,n.left=s.left,n.width=Math.min(i.width,r.width),n.height=Math.min(i.height,r.height),p.done(function(){o=e.property("image_id"),Upfront.Views.Editor.ImageEditor.saveImageEdition(o,e.property("rotation"),r,n).done(function(t){var n=t.data.images[o];return n.error&&!e.isThemeImage()?void Upfront.Views.Editor.notify(u.process_error,"error"):(e.property("size",r),e.property("position",s),e.property("src",n.url),e.property("srcFull",n.urlOriginal,!1),e.property("stretch",r.width>=i.width),e.property("vstretch",r.height>=i.height),e.property("gifImage",n.gif),clearTimeout(e.cropTimer),e.cropTimer=!1,void a.resolve())})}),this.isThemeImage()&&"themeExporter"in Upfront?this.importImage().always(function(){l.resolve()}):l.resolve(),a.promise()},saveResizing:function(){var t=this,e="undefined"!=typeof _upfront_post_data.post_id&&_upfront_post_data.post_id,i="undefined"!=typeof _upfront_post_data.layout?_upfront_post_data.layout:"",n=_upfront_storage_key!=_upfront_save_storage_key?1:0;this.cropTimer&&(clearTimeout(this.cropTimer),this.cropTimer=!1,this.saveTemporaryResizing().done(function(){var o={element:JSON.stringify(Upfront.Util.model_to_json(t.model)),post_id:e,layout_ids:i,load_dev:n,action:"upfront_update_layout_element"};Upfront.Util.post(o)}))},resizeImage:function(t){var e,i,n,o=this.$("img");return o.length>0&&(e={position:this.property("position"),size:this.property("size"),stretch:this.property("stretch"),vstretch:this.property("vstretch"),elementSize:t},e.stretch&&!e.vstretch?(this.resizingH(o,e,!0),this.resizingV(o,e)):!e.stretch&&e.vstretch?(this.resizingV(o,e,!0),this.resizingH(o,e)):(ratio=e.size.width/e.size.height-e.elementSize.width/e.elementSize.height,ratio>0&&e.stretch||ratio<0&&!e.stretch?(this.resizingV(o,e,!0),this.resizingH(o,e)):(this.resizingH(o,e,!0),this.resizingV(o,e))),i={width:o.width(),height:o.height()},n=o.position(),n.top=-n.top,n.left=-n.left,this.temporaryProps={size:i,position:n},this.model.set_breakpoint_property("element_size",t),this.saveTemporaryResizing(),!0)},setElementSize:function(e){var i=this,n=this.parent_module_view.$(".upfront-editable_entity:first"),o=e?t(".upfront-resize"):n,r=1==this.property("no_padding")?0:this.updateBreakpointPadding(h);i.elementSize={width:o.width()-2*r+2,height:o.height()-2*r},"below_image"===this.get_preset_property("caption-position")&&(this.elementSize.height-=n.find(".wp-caption").outerHeight()),"starting"===this.property("image_status")&&this.$(".upfront-object-content").height(i.elementSize.height)},applyElementSize:function(t,e,i){if(this.parent_module_view){var n=this.parent_module_view.$el.find(".upfront-editable_entity:first"),o=n,r="below_image"===this.get_preset_property("caption-position")?this.$(".wp-caption").outerHeight():0,s=parseInt(this.$el.find(".upfront-image-caption-container").css("borderWidth")||0,10),a=Upfront.Settings.LayoutEditor.Grid.column_padding,l=parseInt(this.model.get_breakpoint_property_value("left_padding_num")||a,10)+parseInt(this.model.get_breakpoint_property_value("right_padding_num")||a,10),p=parseInt(this.model.get_breakpoint_property_value("top_padding_num")||a,10)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||a,10),d={width:(t&&!isNaN(t)?t:o.width())-l,height:(e&&!isNaN(e)?e:o.height())-p-r-2*s},c=this.getElementShapeSize(d);!1!==c&&(d=c),(_.isUndefined(i)||i)&&(this.model.set_breakpoint_property("row",Upfront.Util.height_to_row(d.height+p),!0),this.parent_module_view&&this.parent_module_view.model.set_breakpoint_property("row",Upfront.Util.height_to_row(d.height+p),!0),this.model.set_breakpoint_property("element_size",d)),this.$el.find(".uimage-resize-hint").html(this.sizehintTpl({width:d.width,height:d.height,l10n:u.template})),this.$el.find("> .upfront-object").css("min-height",d.height+p+"px"),this.$el.closest(".upfront-module").css("min-height",d.height+p+"px")}},openImageSelector:function(e){var i=this;e&&e.preventDefault&&e.preventDefault(),Upfront.Views.Editor.ImageSelector.open({multiple_sizes:!1}).done(function(e){var n={};_.each(e,function(t,e){n=t,i.imageId=e});var o={src:n.medium?n.medium[0]:n.full[0],srcFull:n.full[0],srcOriginal:n.full[0],fullSize:{width:n.full[1],height:n.full[2]},size:n.medium?{width:n.medium[1],height:n.medium[2]}:{width:n.full[1],height:n.full[2]},position:!1,rotation:0,id:i.imageId};t("<img>").load(function(){Upfront.Views.Editor.ImageSelector.close(),i.openEditor(!0,o)}).on("error",function(){Upfront.Views.Editor.ImageSelector.close(),Upfront.Views.Editor.notify(u.process_error,"error")}).attr("src",o.srcFull)})},handleEditorResult:function(t){this.property("image_status","ok",!0),this.property("has_settings",1),this.property("src",t.src,!0),this.property("srcFull",t.srcFull,!0),this.property("srcOriginal",t.srcOriginal,!0),this.property("size",t.imageSize,!0),this.property("position",t.imageOffset,!0);var e="horizontal"===t.mode||"small"===t.mode?t.imageOffset.top*-1:0;this.property("marginTop",e,!0),this.property("rotation",t.rotation,!0),this.property("fullSize",t.fullSize,!0),this.property("element_size",t.maskSize,!0),this.property("align",t.align,!0),this.property("valign",t.valign,!0),this.property("isDotAlign",t.isDotAlign,!0),this.property("stretch",t.stretch,!0),this.property("vstretch",t.vstretch,!0),this.property("quick_swap",!1,!0),t.imageId&&this.property("image_id",t.imageId,!0),this.property("gifImage",t.gif),this.temporaryProps=!1,this.render(),t.elementSize&&this.set_element_size(t.elementSize.columns,t.elementSize.rows,"all",!0)},editRequest:function(){var t=this;return"ok"===this.property("image_status")&&this.property("image_id")?void(this.isThemeImage()&&"themeExporter"in Upfront?this.importImage().always(function(){t.openEditor()}):this.openEditor()):void Upfront.Views.Editor.notify(u.external_nag,"error")},lockImage:function(){var t=this,e=this.property("is_locked"),i=this.checkSize();"undefined"!=typeof e&&e===!0?(this.controls.$el.find(".upfront-icon-region-lock-locked").addClass("upfront-icon-region-lock-unlocked").removeClass("upfront-icon-region-lock-locked"),this.property("is_locked",!1),"small"===i&&(this.$(".upfront-image-caption-container, .upfront-image-container").css({width:"100%",height:"100%",marginTop:0}),this.fitImage(),this.cropTimer=setTimeout(function(){t.saveTemporaryResizing()},this.cropTimeAfterResize))):(this.controls.$el.find(".upfront-icon-region-lock-unlocked").addClass("upfront-icon-region-lock-locked").removeClass("upfront-icon-region-lock-unlocked"),this.property("is_locked",!0))},fitImage:function(){var t=this.model.get_breakpoint_property_value("element_size",!0),e=this.property("position"),i=this.property("size"),n=Upfront.Views.Editor.ImageEditor.getResizeImageDimensions(i,{width:t.width,height:t.height},"outer",0);this.property("size",{width:n.width,height:n.height}),this.temporaryProps={size:{width:n.width,height:n.height},position:e},this.property("vstretch",!0),this.$(".upfront-image-container img").css({width:n.width,height:n.height,left:"0px",top:"0px"}),this.$(".upfront-image-wrapper").css({height:t.height})},checkSize:function(){var t=this.model.get_breakpoint_property_value("element_size",!0),e=this.property("size");return e.width>=t.width&&e.height>=t.height?"big":"small"},getElementColumns:function(){var t,e=this.$el.closest(".upfront-module"),i=!1;return e.length?(t=e.attr("class").split(" "),_.each(t,function(t){t.match(/^c\d+$/)&&(i=t.replace("c",""))}),i||-1):-1},openEditor:function(t,e){if("desktop"!==Upfront.Application.responsiveMode)return Upfront.Views.Editor.notify(u.desktop_nag,"error");var i=this,n={setImageSize:t,saveOnClose:t,editElement:this};this.setElementSize(),this.setImageInfo(),e?_.extend(n,this.imageInfo,e):_.extend(n,this.imageInfo),this.cropTimer&&(this.stoppedTimer=!0,clearTimeout(this.cropTimer),this.cropTimer=!1),n.element_id=i.model.get_property_value_by_name("element_id"),n.element_cols=i.get_element_columns(),"undefined"!=typeof this.controls&&this.controls.remove(),Upfront.Views.Editor.ImageEditor.open(n).done(function(t){i.handleEditorResult(t),this.stoppedTimer=!1,i.updateControls()}).fail(function(t){t&&"changeImage"===t.reason?i.openImageSelector():i.stoppedTimer&&(i.saveTemporaryResizing(),i.stoppedTimer=!1),i.updateControls()})},handleLinkClick:function(t){var e;"lightbox"===this.link.get("type")&&(t.preventDefault(),e=this.link.get("url").substring(1),Upfront.Application.LayoutEditor.openLightboxRegion(e))},importImage:function(){var e=this,i=(this.property("image_id"),this.property("srcFull")),n={action:"upfront_import_image",images:[i]},o=t.Deferred();return Upfront.Util.post(n).done(function(t){var i=t.data.images;return 0!==parseInt(t.data.error,10)?void o.reject():void _.each(i,function(t){var i=t.status;return"import_success"!==i&&"exists"!==i?void o.reject():(e.property("image_id",t.id),e.property("srcFull",t.src),e.property("srcOriginal",t.src),void o.resolve(e.property("image_id")))})}),o.promise()},cleanup:function(){this.controls&&this.controls.remove()},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},getControlItems:function(){var t,e=(new Upfront.Views.Editor.InlinePanels.ControlPanel,new Upfront.Views.Editor.InlinePanels.SubControl),i=this.property("is_locked"),n=[];return this.mobileMode||(t="undefined"!=typeof i&&i===!0?"lock-locked":"lock-unlocked",e.icon="more",e.tooltip=u.ctrl.caption_position,e.sub_items={},e.sub_items.swap=this.createControl("swap",u.btn.swap_image,"openImageSelector"),e.sub_items.crop=this.createControl("crop",u.ctrl.edit_image,"editRequest"),e.sub_items.link=this.createLinkControl(),e.sub_items.lock=this.createControl(t,u.ctrl.lock_image,"lockImage"),n.push(e)),n.push(this.createPaddingControl()),n.push(this.createControl("settings",Upfront.Settings.l10n.global.views.settings,"on_settings_click")),_(n)}});Upfront.Application.LayoutEditor.add_object("Uimage",{Model:p,View:f,Element:a,Settings:o,ContextMenu:n,cssSelectors:{".upfront-image-wrapper":{label:u.css.image_label,info:u.css.image_info},".wp-caption":{label:u.css.caption_label,info:u.css.caption_info},".upfront-image-container":{label:u.css.wrapper_label,info:u.css.wrapper_info}},cssSelectorsId:Upfront.data.uimage.defaults.type}),Upfront.Views.Editor.ImageEditor=new s,Upfront.Views.Editor.ImageSelector=new r,Upfront.Models.UimageModel=p,Upfront.Views.UimageView=f})}(jQuery),function(t){define("upfront-like-box",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel"],function(e,i){var n=Upfront.Settings.l10n.like_box_element,o=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.ulikebox.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),r=Upfront.Views.ObjectView.extend({model:o,elementSize:{width:0,height:0},initialize:function(t){this.model instanceof o||(this.model=new o({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[t]),this.listenTo(Upfront.Events,"entity:resize_start",this.hideFrame),this.listenTo(Upfront.Events,"entity:resize_stop",this.onElementResize)},on_element_resize_start:function(t){this.hideFrame(this,this.model)},on_element_resize:function(t){this.onElementResize(this,this.model)},setUrl:function(){this.property("facebook_url",Upfront.data.social.panel.model.get_property_value_by_name("global_social_media_services-facebook-url"))},hideFrame:function(t,e){this.parent_module_view==t&&this.$el.find("iframe").css("display","none")},showFrame:function(){var t=this.$el.find("iframe");t.is(":visible")||t.show()},onElementResize:function(t,e){this.setElementSize(),this.showFrame()},setElementSize:function(){var t=this,e=this.parent_module_view.$(".upfront-editable_entity:first");if(e.length&&e.height()){this.elementSize.height=e.height();var i=t.get_element_size_px(!1);0===i.row&&(i.row=e.height()),0!=i.col&&t.property("element_size",{width:i.col,height:i.row})}},property:function(t,e){return"undefined"!=typeof e?this.model.set_property(t,e):this.model.get_property_value_by_name(t)},events:function(){return _.extend({},Upfront.Views.ObjectView.prototype.events,{"click a.back_global_settings":"backToGlobalSettings"})},backToGlobalSettings:function(t){t.preventDefault(),Upfront.data.social.panel.popupFunc()},getGlobalFBUrl:function(){if(!Upfront.data.usocial.globals)return!1;var t=Upfront.data.usocial.globals.services,e=!1;return _(t).each(function(t){"facebook"==t.id&&(e=t.url)}),e},get_content_markup:function(){var t=this.model.get_property_value_by_name("facebook_url");if(t){var e=t.split("/"),i=_.last(e);_.isEmpty(i)&&(e.splice(e.length-1,1),i=_.last(e));var o=this.model.get_property_value_by_name("element_size").width-30;o>500&&(o=500);var r="yes"==this.model.get_property_value_by_name("hide_cover")?"true":"false",s="yes"==this.model.get_property_value_by_name("show_friends")?"true":"false",a="yes"==this.model.get_property_value_by_name("small_header")?"true":"false",l="yes"==this.model.get_property_value_by_name("show_posts")?"true":"false";return'<iframe src="//www.facebook.com/v2.5/plugins/page.php?adapt_container_width=true&amp;container_width='+o+"&amp;width="+o+"&amp;height="+(this.model.get_property_value_by_name("element_size").height-30)+"&amp;hide_cover="+r+"&amp;href=https%3A%2F%2Fwww.facebook.com%2F"+(i?i:"wpmudev")+"&amp;show_facepile="+s+"&amp;show_posts="+l+"&amp;small_header="+a+'" scrolling="no" frameborder="0" style="border:none; display:block; overflow:hidden; margin:auto; width:'+o+"px; height:"+(this.model.get_property_value_by_name("element_size").height-30)+'px;"" allowTransparency="true"></iframe><div class="upfront-like-box_overlay"></div>'+(i?"":'<span class="alert-url">!</span>')}return this.model.set_property("facebook_url","",!0),Upfront.Application.user_can_modify_layout()?'<div class="upfront-likebox-overlay upfront-initial-overlay-wrapper" style="min-height: 200px;"><div class="upfront-like-box_placeholder upfront-initial-overlay-wrapper" style="height: 150px;"><div class="upfront-like-box_placeholder_guide">'+n.placeholder_guide+'</div><div class="upfront-like-box_url_wrapper"><input type="text" class="upfront-like-box_url" placeholder="'+n.placeholder+'" /></div><button type="button" class="upfront-like-box_button">'+n.ok+"</button></div></div>":""},on_render:function(){var e=this.parent_module_view,i=this;this.setElementSize(),e.$el.data("dragHandler")||(e.$el.on("dragstart",this.coverIframe),e.$el.data("dragHandler",!0)),this.$el.find(".upfront-like-box_button").on("click",function(e){i.property("facebook_url",t(this).parent().find("input.upfront-like-box_url").val())}),this.$el.find(".upfront-like-box_url").on("keydown",function(t){13==t.which&&(i.$el.find(".upfront-like-box_button").click(),Upfront.Events.trigger("upfront:element:edit:stop"))})},on_after_layout_render:function(){this.setElementSize()},coverIframe:function(t,e){e.helper.append('<div class="upfront-iframe-draggable" style="width:100%;height:100%;position:absolute;top:0;left:0:z-index:1"></div>')}}),s=Upfront.Views.Editor.Sidebar.Element.extend({priority:100,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-likebox"),this.$el.html(n.element_name)},add_element:function(){var t=new o,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c7 upfront-like-box_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(200)}],objects:[t]});this.add_module(e)}}),a=i.extend({className:"uyoutube-settings",tabbed:!1,title:n.general_settings,initialize:function(t){this.options=t;var e=Upfront.Views.Editor.Settings.Item,i=Upfront.Views.Editor.Field;this.settings=_([new e({className:"upfront-social-services-item general_settings_item",title:n.facebook_account,label:n.opts.page_url,fields:[new i.Text({model:this.model,className:"facebook-url",property:"facebook_url",label:n.opts.url_sample,compact:!0,change:function(t){this.model.set_property("facebook_url",t)}}),new i.Checkboxes({model:this.model,className:"show-friends",property:"show_friends",label:"",values:[{label:n.opts.show_friends,value:"yes"}],change:function(t){this.model.set_property("show_friends",t)}}),new i.Checkboxes({model:this.model,
className:"small-header",property:"small_header",label:"",values:[{label:n.opts.small_header,value:"yes"}],change:function(t){this.model.set_property("small_header",t)}}),new i.Checkboxes({model:this.model,className:"hide-cover",property:"hide_cover",label:"",values:[{label:n.opts.hide_cover,value:"yes"}],change:function(t){this.model.set_property("hide_cover",t)}}),new i.Checkboxes({model:this.model,className:"show-posts",property:"show_posts",label:"",values:[{label:n.opts.show_posts,value:"yes"}],change:function(t){this.model.set_property("show_posts",t)}}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})]})])},get_title:function(){return n.general_settings}}),l=e.extend({panels:{General:a},title:n.settings});Upfront.Application.LayoutEditor.add_object("LikeBox",{Model:o,View:r,Element:s,Settings:l,cssSelectors:{iframe:{label:n.container_label,info:n.container_info}},cssSelectorsId:Upfront.data.ulikebox.defaults.type}),Upfront.Models.LikeBoxModel=o,Upfront.Views.LikeBoxView=r})}(jQuery),define("text!elements/upfront-login/css/edit.css",[],function(){return'.upfront_login-settings-panel .upfront-settings_panel {\n\twidth: 290px;\n}\n\n.upfront_login-fields-complex_boolean {\n\twidth: 48%;\n\tfloat: left;\n}\n.upfront_login-fields-complex_boolean .upfront-field-wrap-radios {\n\tfloat: left;\n}\n.upfront_login-fields-complex_boolean .upfront-field-wrap-text {\n\twidth: 80%;\n\tfloat: left;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon {\n\twidth: 60%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon .upfront-field-text {\n\twidth: 80%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-label {\n\twidth: 40%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon .upfront_login-icon {\n\tfloat: left;\n\twidth: 85%;\n}\n.upfront_login-fields-complex_boolean.upfront_login-appearance-icon .upfront_login-icon input {\n\twidth: 80%;\n}\n\n/*.upfront_login-item-display_behavior .upfront-field-multiple,\n.upfront_login-logout_style .upfront-field-multiple {\n\tmax-width: 48%;\n\tmargin-right: 1%;\n\tfloat: left;\n}*/\n\n.upfront_login-logout_text {\n\tclear:both;\n} \n\n/*div.upfront_login-item-display_behavior div.upfront-settings-item-title > span {\n  display: block;\n  color: #7d99b3;\n  font-size: 11px;\n  font-weight: bold;\n  font-family: verdana, sans-serif;\n  line-height: 1;\n  margin-bottom: 0 !important;\n  text-transform: none;\n}\n\n\ndiv.upfront_login-item-display_behavior div.upfront-settings-item-title:after {\n  display:none;\n}*/\n\ndiv.upfront_login-item-display_trigger div.upfront-field-wrap-text {\n  margin-top:0 !important;\n}\n\ndiv.upfront_login-item-display_trigger div.upfront-settings-item {\n  padding-top: 0;\n}\n\ndiv.upfront-login_element-module,\ndiv.upfront-login_element-module.upfront-module-active {\n  z-index: 80;\n}\n\ndiv.upfront-login_element-module .upfront_login.upfront_login-hover,\ndiv.upfront-login_element-module.upfront-module-active .upfront_login.upfront_login-hover,\ndiv.upfront-login_element-module .upfront_login.upfront_login-click,\ndiv.upfront-login_element-module.upfront-module-active .upfront_login.upfront_login-click {\n  z-index: 15;\n}\n\n.upfront_login form#loginform .login-remember .redactor-box {\n\tdisplay: inline-block;\n}\n\n.upfront_login form#loginform .login-submit {\n\tposition: relative;\n}\n\n.upfront_login form#loginform .login-submit span.login-submit-label-container {\n\tposition: absolute;\n\twidth: 100%;\n\tdisplay: table;\n\ttext-align: center;\n}\n\n.upfront_login form#loginform .login-submit .redactor-box {\n\twidth: 100%;\n\tdisplay: table;\n}\n\n.upfront_login form#loginform .login-submit span.login-submit-label {\n\tdisplay: table-cell;\n\tvertical-align: middle;\n}\n\n.upfront_login p.login-lostpassword {\n\tmargin: 3px;\n}\n\n.upfront_login form#loginform p input.upfront-input-labels[type="text"],\n.upfront_login p.login-lostpassword input.upfront-input-labels[type="text"] {\n\tbackground: transparent;\n\tborder: 0;\n\tborder-radius: 0;\n\theight: auto;\n\twidth: 100%;\n}\n\n.upfront_login form#loginform p.login-remember input.upfront-input-labels[type="text"] {\n\twidth: auto;\n\tpadding: 0;\n}\n\n.upfront_login.upfront_login-click form#loginform p.login-remember input.upfront-input-labels[type="text"],\n.upfront_login.upfront_login-hover form#loginform p.login-remember input.upfront-input-labels[type="text"] {\n\twidth: 80%;\n}\n\n.upfront_login form#loginform p.login-submit input.upfront-input-labels[type="text"],\n.upfront_login p.login-lostpassword input.upfront-input-labels[type="text"] {\n\ttext-align: center;\n}\n\n.upfront_login form#loginform p.login-submit input.upfront-input-labels[type="text"] {\n\tbackground: #1b7bd7;\n\t-webkit-box-shadow: 0 0 0px 1000px rgb(27, 123, 215) inset;\n\tcolor: #fff;\n\t-webkit-text-fill-color: rgb(255, 255, 255);\n\twidth: 100%;\n\ttext-align: center;\n\theight: 40px;\n\tfont:16px/2.2 Arial;\n\tcolor: #fff;\n}\n\n.upfront_login form#loginform p.login-submit input.upfront-input-labels[type="text"]:hover {\n\tbackground-color: #1770c5;\n}\n\n.upfront_login p.login-lostpassword input.upfront-input-labels.lostpassword-link[type="text"] {\n\tcolor: #1b7bd7;\n\t-webkit-text-fill-color: rgb(27, 123, 215);\n}\n\n#element-settings-sidebar .upfront-settings-item.relative {\n\tposition: relative;\n}\n\n#element-settings-sidebar .upfront_login-settings-panel .upfront-field-wrap {\n\tmargin-top: 0;\n}\n\n#element-settings-sidebar .upfront_login-settings-panel .upfront-field-wrap.upfront_login-logout_style {\n\tmargin-bottom: 15px;\n}\n\n#element-settings-sidebar .upfront_login-settings-panel .upfront-field-wrap.float-right {\n\tposition: absolute;\n\ttop: 13px;\n\tright: 30px;\n}\n\n#element-settings-sidebar .upfront-settings-item .login-general-settings-description {\n\tcolor: #30475e;\n\tfont-size: 11px;\n\tfont-weight: normal;\n\tfont-family: verdana, sans-serif;\n\tpadding: 15px 15px 5px 15px;\n\topacity: .8;\n\tline-height: 1.7;\n}\n\n#element-settings-sidebar .upfront-settings-item .clear-after:after {\n\tcontent: \' \';\n\tdisplay: table;\n\tclear: both;\n}\n\n#element-settings-sidebar .upfront-settings-item .login-general-settings-description span {\n\tfloat: left;\n  width: 90%;\n}\n\n#element-settings-sidebar .upfront_toggle {\n\tposition: relative;\n\twidth: 40px;\n\tdisplay: inline-table;\n\tvertical-align: middle;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n\t&.hide {\n\t\t\tdisplay: none;\n\t}\n}\n\n#element-settings-sidebar input.upfront_toggle_checkbox {\n\tdisplay: none;\n}\n\n#element-settings-sidebar .upfront_toggle_switch {\n\tdisplay: block;\n\twidth: 13px;\n\theight: 13px;\n\tbackground-color: #fff;\n\tborder-radius: 15px;\n\tborder: 1px solid rgba(0, 0, 0, 0.2);\n\tposition: absolute;\n\ttop: 1px;\n\tbottom: 0;\n\tright: initial;\n\tleft: 3px;\n\t-moz-box-sizing: border-box;\n\t-webkit-box-sizing: border-box;\n\tbox-sizing: border-box;\n\twill-change: transform;\n\t-webkit-transition: transform 0.2s;\n\ttransition: transform 0.2s;\n}\n\n#element-settings-sidebar .upfront_toggle_label {\n\tposition: relative;\n\tdisplay: block;\n\tcursor: pointer;\n\tborder-radius: 50px;\n\tborder: 0;\n\twidth: 40px;\n\theight: 15px;\n\tbackground: #ddd;\n\tmargin-left: 3px;\n\tmargin-top: 10px;\n}\n\n#element-settings-sidebar .upfront_toggle_checkbox:checked + .upfront_toggle_label {\n\tbackground: #1fcd8f;\n}\n\n#element-settings-sidebar .upfront_toggle_checkbox:checked + .upfront_toggle_label .upfront_toggle_switch {\n\t-webkit-transform: translateX(22px);\n\ttransform: translateX(22px);\n\tborder-color: #1abc9c;\n}\n\n#element-settings-sidebar .upfront-field-wrap.offset {\n\twidth: 50%;\n\tfloat: left;\n\tmargin-top: 10px;\n\tmargin-bottom: 5px;\n}\n\n#element-settings-sidebar .upfront-field-wrap.offset input {\n\tmax-width: 70px;\n}\n\n#element-settings-sidebar .upfront-field-wrap.offset label {\n\tfont-weight: 300;\n}\n'}),define("text!elements/upfront-login/css/public.css",[],function(){return'/* GENERAL FORM STYLE \n\t ================== */\n\t \n.upfront_login-block .upfront_login-form {\n\tpadding: 10px;\n}\t \n\n.upfront_login-form form input {\n\theight:40px;\n\tbackground-color: #fff;\n\tpadding:0 10px;\n}\n.upfront_login-form form input:hover, .upfront_login-form form input:focus { \n\tborder-color: #aec4d8;\n\toutline:none;\n}\n.upfront_login-form form input[type="submit"] {\n\tbackground-color: #1b7bd7;\n\tcolor: #fff;\n\twidth: 100%;\n\ttext-align: center;\n\tfont:16px/2.2 Arial;\n\tcolor: #fff;\n}\n.upfront_login-form form input[type="submit"]:hover {\n\tbackground-color: #1770c5;\n}\n.upfront_login-form form input[type="checkbox"]{\n\theight:20px;\n\tposition: relative;\n\ttop: 3px;\n}\n/*.upfront_login-form form label, .upfront_login-form p { color:#6486a6; }*/\n.upfront_login-form p { margin-bottom: 0; text-align: center; }\n.upfront_login-form p span { display: block; }\n.upfront_login-form p a { color:#1b7bd7; }\n\n\n/* HOVER FORM \n\t ========== */\n\n.upfront_login.upfront_login-hover,\n.upfront_login.upfront_login-click { position: relative; }\n.upfront_login.upfront_login-hover .upfront_login-form-wrapper,\n.upfront_login.upfront_login-click .upfront_login-form-wrapper\n {\n\t display: none; \n}\n.upfront_login.upfront_login-hover .upfront_login-form-wrapper,\n.upfront_login.upfront_login-click .upfront_login-form-wrapper { \n\tposition: absolute;\n\tz-index: 1;\n\twidth:210px;\n\ttop: 0;\n\tleft: 0;\n}\n\n.upfront_login.upfront_login-hover:hover .upfront_login-form-wrapper,\n.upfront_login.upfront_login-click.active .upfront_login-form-wrapper {\n\tdisplay: block;\n}\n\n/* login panel styling */\n.upfront_login.upfront_login-hover .upfront_login-form,\n.upfront_login.upfront_login-click .upfront_login-form {\n\tposition: relative;\n\tdisplay: block;\n\tbackground-color: rgb(232, 232, 232);\n\tborder-radius: 3px;\n\tcursor: default;\n\tborder:none;\n\ttop:35px;\n\tleft:0;\n\tpadding:15px;\n\tpadding-bottom: 5px;\n}\n\n/* triangular tooltip */\n/*.upfront_login.upfront_login-hover:hover .upfront_login-form:before,\n.upfront_login.upfront_login-click.active .upfront_login-form:before {\n\tcontent:\'\';\n\tdisplay:inline-block;\n\twidth:10px;\n\theight:10px;\n\tbackground-color:#fff;\n\ttransform:rotate(45deg);\n\t-webkit-transform:rotate(45deg);\n\tborder-top:2px solid #527caa;\n\tborder-left:2px solid #527caa;\n\tposition:absolute;\n\ttop:-7px;\n\tleft:25%;\n}*/\n.upfront_login.upfront_login-hover .upfront_login-form label,\n.upfront_login.upfront_login-click .upfront_login-form label\n { text-align: left; display: block;}\n\n.upfront_login.upfront_login-hover:hover .upfront_login-trigger,\n.upfront_login.upfront_login-click.active .upfront_login-trigger,\n.upfront-output-upfront-login_element a.logout_link {\n\tdisplay: inline-block;\n}\n\n/* login trigger default styles */\n.upfront_login-trigger {\n\tfont: 15px/1 Arial;\n\tcolor: #000;\n\tpadding:10px;\n\tbackground: #e8e8e8;\n}\n\n/* css animation */\n.upfront_login.upfront_login-hover .upfront_login-form,\n.upfront_login.upfront_login-click .upfront_login-form {-webkit-animation-fill-mode:both;-moz-animation-fill-mode:both;-ms-animation-fill-mode:both;-o-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation-duration:0.5s;-moz-animation-duration:0.5s;-ms-animation-duration:0.5s;-o-animation-duration:0.5s;animation-duration:0.5s;}\n@-webkit-keyframes fadeInDown {\n\t0% {\n\t\topacity: 0;\n\t\t-webkit-transform: translateY(-10px);\n\t}\t100% {\n\t\topacity: 1;\n\t\t-webkit-transform: translateY(0);\n\t}\n}\n\n@-moz-keyframes fadeInDown {\n\t0% {\n\t\topacity: 0;\n\t\t-moz-transform: translateY(-10px);\n\t}\n\t\n\t100% {\n\t\topacity: 1;\n\t\t-moz-transform: translateY(0);\n\t}\n}\n\n@-o-keyframes fadeInDown {\n\t0% {\n\t\topacity: 0;\n\t\t-o-transform: translateY(-10px);\n\t}\n\t\n\t100% {\n\t\topacity: 1;\n\t\t-o-transform: translateY(0);\n\t}\n}\n\n@keyframes fadeInDown {\n\t0% {\n\t\topacity: 0;\n\t\ttransform: translateY(-10px);\n\t}\n\t\n\t100% {\n\t\topacity: 1;\n\t\ttransform: translateY(0);\n\t}\n}\n\n.fadeInDown, .upfront_login.upfront_login-hover:hover .upfront_login-form {\n\t-webkit-animation-name: fadeInDown;\n\t-moz-animation-name: fadeInDown;\n\t-o-animation-name: fadeInDown;\n\tanimation-name: fadeInDown;\n}\n\ndiv.upfront-output-upfront-login_element form#loginform input:not([type=checkbox]) {\n  width: 100%;\n  padding:0 10px;\n  box-sizing: border-box;\n}\n\ndiv.upfront-output-upfront-login_element form#loginform input.upfront-input-labels {\n\tpadding: 0;\n}\n\ndiv.upfront-output-upfront-login_element form#loginform p {\n  text-align:left;\n  line-height: 1.2;\n  margin-bottom: 10px;\n}\n\ndiv.upfront-output-upfront-login_element form#loginform label {\n\tmargin-bottom:0.3em;\n\tdisplay: inline-block;\n\tfont-weight: 100;\n}\ndiv.upfront-output-upfront-login_element form#loginform label:not(.uf-click-to-edit-text) {\n\tcursor: pointer;\n}\ninput#rememberme {\n  width:18px;\n  height:18px;  \n}'}),define("text!elements/upfront-login/tpl/preset-style.html",[],function(){return"/* Form Wrapper */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .upfront_login-form,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .upfront_login-form {\n\t<?php if(!empty($properties['form_wrapper_background'])) { ?>\n\tbackground: <?php echo $properties['form_wrapper_background'] ?>;\n\t<?php } ?>\n\t<?php if(!empty($properties['form_wrapper_use_border'])) { ?>\n\t\t\t<?php if(!empty($properties['form_wrapper_border_width']) && !empty($properties['form_wrapper_border_type']) && !empty($properties['form_wrapper_border_color'])) { ?>border: <?php echo $properties['form_wrapper_border_width'] ?>px <?php echo $properties['form_wrapper_border_type'] ?> <?php echo $properties['form_wrapper_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\tborder: none;\n\t<?php } ?>\n\t<?php if(!empty($properties['form_wrapper_use_radius'])) { ?>\n\t\t\tborder-radius: <?php echo $properties['form_wrapper_border_radius1'] ? $properties['form_wrapper_border_radius1'] : 0 ?>px <?php echo $properties['form_wrapper_border_radius2'] ? $properties['form_wrapper_border_radius2'] : 0 ?>px <?php echo $properties['form_wrapper_border_radius4'] ? $properties['form_wrapper_border_radius4'] : 0 ?>px <?php echo $properties['form_wrapper_border_radius3'] ? $properties['form_wrapper_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\tborder-radius: 0px;\n\t<?php } ?>\n\toverflow: hidden;\n}\n#page .<?php echo $properties['id'] ?> .upfront_login.upfront_login-hover:hover .upfront_login-form:before,\n#page .<?php echo $properties['id'] ?> .upfront_login.upfront_login-click.active .upfront_login-form:before {\n\t<?php if(!empty($properties['form_wrapper_background'])) { ?>\n\tbackground: <?php echo $properties['form_wrapper_background'] ?>;\n\t<?php } ?>\n\t<?php if(!empty($properties['form_wrapper_use_border'])) { ?>\n\t\t\t<?php if(!empty($properties['form_wrapper_border_width']) && !empty($properties['form_wrapper_border_type']) && !empty($properties['form_wrapper_border_color'])) { ?>border-top: <?php echo $properties['form_wrapper_border_width'] ?>px <?php echo $properties['form_wrapper_border_type'] ?> <?php echo $properties['form_wrapper_border_color'] ?>;\n\t\t\tborder-left: <?php echo $properties['form_wrapper_border_width'] ?>px <?php echo $properties['form_wrapper_border_type'] ?> <?php echo $properties['form_wrapper_border_color'] ?>;\n\t\t\t<?php } ?>\n\t<?php } else { ?>\n\t\t\tborder: none;\n\t<?php } ?>\n}\n\n/* Field Labels */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form p:not(.login-submit) input.upfront-input-labels {\n\t<?php if(!empty($properties['field_labels_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['field_labels_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['field_labels_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form label,\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form p:not(.login-submit) input.upfront-input-labels,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form label {\n\t<?php if(!empty($properties['field_labels_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['field_labels_color'])) { ?>color: <?php echo $properties['field_labels_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['field_labels_font_face'])) { ?>font-family: <?php echo $properties['field_labels_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['field_labels_font_size'])) { ?>font-size: <?php echo $properties['field_labels_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['field_labels_weight'])) { ?>font-weight: <?php echo $properties['field_labels_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['field_labels_style'])) { ?>font-style: <?php echo $properties['field_labels_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['field_labels_line_height'])) { ?>line-height: <?php echo $properties['field_labels_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form p:not(.login-submit) input.upfront-input-labels:hover {\n\t<?php if(!empty($properties['hover_field_labels_use_typography']) && $properties['hover_field_labels_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_field_labels_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['hover_field_labels_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form label:hover,\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form p:not(.login-submit) input.upfront-input-labels:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form label:hover {\n\t<?php if(!empty($properties['hover_field_labels_use_typography']) && $properties['hover_field_labels_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_field_labels_color'])) { ?>color: <?php echo $properties['hover_field_labels_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_field_labels_font_face'])) { ?>font-family: <?php echo $properties['hover_field_labels_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_field_labels_font_size'])) { ?>font-size: <?php echo $properties['hover_field_labels_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover_field_labels_weight'])) { ?>font-weight: <?php echo $properties['hover_field_labels_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_field_labels_style'])) { ?>font-style: <?php echo $properties['hover_field_labels_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_field_labels_line_height'])) { ?>line-height: <?php echo $properties['hover_field_labels_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form p:not(.login-submit) input.upfront-input-labels:focus {\n\t<?php if(!empty($properties['focus_field_labels_use_typography']) && $properties['focus_field_labels_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_field_labels_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['focus_field_labels_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form label:focus,\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form p:not(.login-submit) input.upfront-input-labels:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form label:focus {\n\t<?php if(!empty($properties['focus_field_labels_use_typography']) && $properties['focus_field_labels_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_field_labels_color'])) { ?>color: <?php echo $properties['focus_field_labels_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_field_labels_font_face'])) { ?>font-family: <?php echo $properties['focus_field_labels_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_field_labels_font_size'])) { ?>font-size: <?php echo $properties['focus_field_labels_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus_field_labels_weight'])) { ?>font-weight: <?php echo $properties['focus_field_labels_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_field_labels_style'])) { ?>font-style: <?php echo $properties['focus_field_labels_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_field_labels_line_height'])) { ?>line-height: <?php echo $properties['focus_field_labels_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n\n/* Input Fields */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form input[type=\"text\"]:not(.upfront-input-labels),\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form input[type=\"password\"],\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form input[type=\"text\"],\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form input[type=\"password\"] {\n\t<?php if(!empty($properties['input_fields_background'])) { ?>\n\tbackground: <?php echo $properties['input_fields_background'] ?>;\n\t-webkit-box-shadow: 0 0 0px 1000px <?php echo $properties['input_fields_background'] ?> inset;\n\t<?php } ?>\n\t<?php if(!empty($properties['input_fields_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['input_fields_color'])) { ?>color: <?php echo $properties['input_fields_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['input_fields_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['input_fields_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['input_fields_font_face'])) { ?>font-family: <?php echo $properties['input_fields_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['input_fields_font_size'])) { ?>font-size: <?php echo $properties['input_fields_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['input_fields_weight'])) { ?>font-weight: <?php echo $properties['input_fields_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['input_fields_style'])) { ?>font-style: <?php echo $properties['input_fields_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['input_fields_line_height'])) { ?>line-height: <?php echo $properties['input_fields_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['input_fields_use_border'])) { ?>\n\t\t\t<?php if(!empty($properties['input_fields_border_width']) && !empty($properties['input_fields_border_type']) && !empty($properties['input_fields_border_color'])) { ?>border: <?php echo $properties['input_fields_border_width'] ?>px <?php echo $properties['input_fields_border_type'] ?> <?php echo $properties['input_fields_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\tborder: none;\n\t<?php } ?>\n\t<?php if(!empty($properties['input_fields_use_radius'])) { ?>\n\t\t\tborder-radius: <?php echo $properties['input_fields_border_radius1'] ? $properties['input_fields_border_radius1'] : 0 ?>px <?php echo $properties['input_fields_border_radius2'] ? $properties['input_fields_border_radius2'] : 0 ?>px <?php echo $properties['input_fields_border_radius4'] ? $properties['input_fields_border_radius4'] : 0 ?>px <?php echo $properties['input_fields_border_radius3'] ? $properties['input_fields_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\tborder-radius: 0px;\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form input[type=\"text\"]:hover:not(.upfront-input-labels),\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form input[type=\"password\"]:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form input[type=\"text\"]:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form input[type=\"password\"]:hover {\n\t<?php if(!empty($properties['hover_use_input_fields_background']) && $properties['hover_use_input_fields_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_input_fields_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['hover_input_fields_background'] ?>;\n\t\t\t-webkit-box-shadow: 0 0 0px 1000px <?php echo $properties['hover_input_fields_background'] ?> inset;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_input_fields_use_typography']) && $properties['hover_input_fields_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_input_fields_color'])) { ?>color: <?php echo $properties['hover_input_fields_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_input_fields_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['hover_input_fields_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_input_fields_font_face'])) { ?>font-family: <?php echo $properties['hover_input_fields_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_input_fields_font_size'])) { ?>font-size: <?php echo $properties['hover_input_fields_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover_input_fields_weight'])) { ?>font-weight: <?php echo $properties['hover_input_fields_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_input_fields_style'])) { ?>font-style: <?php echo $properties['hover_input_fields_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_input_fields_line_height'])) { ?>line-height: <?php echo $properties['hover_input_fields_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_input_fields_use_border']) && $properties['hover_input_fields_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_input_fields_border_width']) && !empty($properties['hover_input_fields_border_type']) && !empty($properties['hover_input_fields_border_color'])) { ?>border: <?php echo $properties['hover_input_fields_border_width'] ?>px <?php echo $properties['hover_input_fields_border_type'] ?> <?php echo $properties['hover_input_fields_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['input_fields_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['input_fields_border_width']) && !empty($properties['input_fields_border_type']) && !empty($properties['input_fields_border_color'])) { ?>border: <?php echo $properties['input_fields_border_width'] ?>px <?php echo $properties['input_fields_border_type'] ?> <?php echo $properties['input_fields_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_input_fields_use_radius']) && $properties['hover_input_fields_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['hover_input_fields_border_radius1'] ? $properties['hover_input_fields_border_radius1'] : 0 ?>px <?php echo $properties['hover_input_fields_border_radius2'] ? $properties['hover_input_fields_border_radius2'] : 0 ?>px <?php echo $properties['hover_input_fields_border_radius4'] ? $properties['hover_input_fields_border_radius4'] : 0 ?>px <?php echo $properties['hover_input_fields_border_radius3'] ? $properties['hover_input_fields_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['input_fields_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['input_fields_border_radius1'] ? $properties['input_fields_border_radius1'] : 0 ?>px <?php echo $properties['input_fields_border_radius2'] ? $properties['input_fields_border_radius2'] : 0 ?>px <?php echo $properties['input_fields_border_radius4'] ? $properties['input_fields_border_radius4'] : 0 ?>px <?php echo $properties['input_fields_border_radius3'] ? $properties['input_fields_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form input[type=\"text\"]:focus:not(.upfront-input-labels),\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form input[type=\"password\"]:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form input[type=\"text\"]:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form input[type=\"password\"]:focus {\n\t<?php if(!empty($properties['focus_use_input_fields_background']) && $properties['focus_use_input_fields_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_input_fields_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['focus_input_fields_background'] ?>;\n\t\t\t-webkit-box-shadow: 0 0 0px 1000px <?php echo $properties['focus_input_fields_background'] ?> inset;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_input_fields_use_typography']) && $properties['focus_input_fields_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_input_fields_color'])) { ?>color: <?php echo $properties['focus_input_fields_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_input_fields_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['focus_input_fields_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_input_fields_font_face'])) { ?>font-family: <?php echo $properties['focus_input_fields_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_input_fields_font_size'])) { ?>font-size: <?php echo $properties['focus_input_fields_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus_input_fields_weight'])) { ?>font-weight: <?php echo $properties['focus_input_fields_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_input_fields_style'])) { ?>font-style: <?php echo $properties['focus_input_fields_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_input_fields_line_height'])) { ?>line-height: <?php echo $properties['focus_input_fields_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_input_fields_use_border']) && $properties['focus_input_fields_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_input_fields_border_width']) && !empty($properties['focus_input_fields_border_type']) && !empty($properties['focus_input_fields_border_color'])) { ?>border: <?php echo $properties['focus_input_fields_border_width'] ?>px <?php echo $properties['focus_input_fields_border_type'] ?> <?php echo $properties['focus_input_fields_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['input_fields_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['input_fields_border_width']) && !empty($properties['input_fields_border_type']) && !empty($properties['input_fields_border_color'])) { ?>border: <?php echo $properties['input_fields_border_width'] ?>px <?php echo $properties['input_fields_border_type'] ?> <?php echo $properties['input_fields_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_input_fields_use_radius']) && $properties['focus_input_fields_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['focus_input_fields_border_radius1'] ? $properties['focus_input_fields_border_radius1'] : 0 ?>px <?php echo $properties['focus_input_fields_border_radius2'] ? $properties['focus_input_fields_border_radius2'] : 0 ?>px <?php echo $properties['focus_input_fields_border_radius4'] ? $properties['focus_input_fields_border_radius4'] : 0 ?>px <?php echo $properties['focus_input_fields_border_radius3'] ? $properties['focus_input_fields_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['input_fields_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['input_fields_border_radius1'] ? $properties['input_fields_border_radius1'] : 0 ?>px <?php echo $properties['input_fields_border_radius2'] ? $properties['input_fields_border_radius2'] : 0 ?>px <?php echo $properties['input_fields_border_radius4'] ? $properties['input_fields_border_radius4'] : 0 ?>px <?php echo $properties['input_fields_border_radius3'] ? $properties['input_fields_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n\n/* Button */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form#loginform p.login-submit input.upfront-input-labels {\n\t<?php if(!empty($properties['button_background'])) { ?>\n\t-webkit-box-shadow: 0 0 0px 1000px <?php echo $properties['button_background'] ?> inset;\n\t<?php } ?>\n\t<?php if(!empty($properties['button_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['button_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['button_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form#loginform p.login-submit input.upfront-input-labels,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form#loginform input[type=\"submit\"] {\n\t<?php if(!empty($properties['button_background'])) { ?>\n\tbackground: <?php echo $properties['button_background'] ?>;\n\t<?php } ?>\n\t<?php if(!empty($properties['button_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['button_color'])) { ?>color: <?php echo $properties['button_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['button_font_face'])) { ?>font-family: <?php echo $properties['button_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['button_font_size'])) { ?>font-size: <?php echo $properties['button_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['button_weight'])) { ?>font-weight: <?php echo $properties['button_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['button_style'])) { ?>font-style: <?php echo $properties['button_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['button_line_height'])) { ?>line-height: <?php echo $properties['button_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['button_use_border'])) { ?>\n\t\t\t<?php if(!empty($properties['button_border_width']) && !empty($properties['button_border_type']) && !empty($properties['button_border_color'])) { ?>border: <?php echo $properties['button_border_width'] ?>px <?php echo $properties['button_border_type'] ?> <?php echo $properties['button_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\tborder: none;\n\t<?php } ?>\n\t<?php if(!empty($properties['button_use_radius'])) { ?>\n\t\t\tborder-radius: <?php echo $properties['button_border_radius1'] ? $properties['button_border_radius1'] : 0 ?>px <?php echo $properties['button_border_radius2'] ? $properties['button_border_radius2'] : 0 ?>px <?php echo $properties['button_border_radius4'] ? $properties['button_border_radius4'] : 0 ?>px <?php echo $properties['button_border_radius3'] ? $properties['button_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\tborder-radius: 0px;\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form#loginform p.login-submit input.upfront-input-labels:hover {\n\t<?php if(!empty($properties['hover_use_button_background']) && $properties['hover_use_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_button_background'])) { ?>\n\t\t\t-webkit-box-shadow: 0 0 0px 1000px <?php echo $properties['hover_button_background'] ?> inset;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_button_use_typography']) && $properties['hover_button_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_button_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['hover_button_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form#loginform p.login-submit input.upfront-input-labels:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form#loginform input[type=\"submit\"]:hover {\n\t<?php if(!empty($properties['hover_use_button_background']) && $properties['hover_use_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_button_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['hover_button_background'] ?>;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_button_use_typography']) && $properties['hover_button_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_button_color'])) { ?>color: <?php echo $properties['hover_button_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_button_font_face'])) { ?>font-family: <?php echo $properties['hover_button_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_button_font_size'])) { ?>font-size: <?php echo $properties['hover_button_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover_button_weight'])) { ?>font-weight: <?php echo $properties['hover_button_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_button_style'])) { ?>font-style: <?php echo $properties['hover_button_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_button_line_height'])) { ?>line-height: <?php echo $properties['hover_button_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_button_use_border']) && $properties['hover_button_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_button_border_width']) && !empty($properties['hover_button_border_type']) && !empty($properties['hover_button_border_color'])) { ?>border: <?php echo $properties['hover_button_border_width'] ?>px <?php echo $properties['hover_button_border_type'] ?> <?php echo $properties['hover_button_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['button_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['button_border_width']) && !empty($properties['button_border_type']) && !empty($properties['button_border_color'])) { ?>border: <?php echo $properties['button_border_width'] ?>px <?php echo $properties['button_border_type'] ?> <?php echo $properties['button_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_button_use_radius']) && $properties['hover_button_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['hover_button_border_radius1'] ? $properties['hover_button_border_radius1'] : 0 ?>px <?php echo $properties['hover_button_border_radius2'] ? $properties['hover_button_border_radius2'] : 0 ?>px <?php echo $properties['hover_button_border_radius4'] ? $properties['hover_button_border_radius4'] : 0 ?>px <?php echo $properties['hover_button_border_radius3'] ? $properties['hover_button_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['button_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['button_border_radius1'] ? $properties['button_border_radius1'] : 0 ?>px <?php echo $properties['button_border_radius2'] ? $properties['button_border_radius2'] : 0 ?>px <?php echo $properties['button_border_radius4'] ? $properties['button_border_radius4'] : 0 ?>px <?php echo $properties['button_border_radius3'] ? $properties['button_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form#loginform p.login-submit input.upfront-input-labels:focus {\n\t<?php if(!empty($properties['focus_use_button_background']) && $properties['focus_use_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_button_background'])) { ?>\n\t\t\t-webkit-box-shadow: 0 0 0px 1000px <?php echo $properties['focus_button_background'] ?> inset;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_button_use_typography']) && $properties['focus_button_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_button_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['focus_button_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element form#loginform p.login-submit input.upfront-input-labels:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element form#loginform input[type=\"submit\"]:focus {\n\t<?php if(!empty($properties['focus_use_button_background']) && $properties['focus_use_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_button_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['focus_button_background'] ?>;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_button_use_typography']) && $properties['focus_button_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_button_color'])) { ?>color: <?php echo $properties['focus_button_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_button_font_face'])) { ?>font-family: <?php echo $properties['focus_button_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_button_font_size'])) { ?>font-size: <?php echo $properties['focus_button_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus_button_weight'])) { ?>font-weight: <?php echo $properties['focus_button_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_button_style'])) { ?>font-style: <?php echo $properties['focus_button_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_button_line_height'])) { ?>line-height: <?php echo $properties['focus_button_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_button_use_border']) && $properties['focus_button_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_button_border_width']) && !empty($properties['focus_button_border_type']) && !empty($properties['focus_button_border_color'])) { ?>border: <?php echo $properties['focus_button_border_width'] ?>px <?php echo $properties['focus_button_border_type'] ?> <?php echo $properties['focus_button_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['button_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['button_border_width']) && !empty($properties['button_border_type']) && !empty($properties['button_border_color'])) { ?>border: <?php echo $properties['button_border_width'] ?>px <?php echo $properties['button_border_type'] ?> <?php echo $properties['button_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_button_use_radius']) && $properties['focus_button_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['focus_button_border_radius1'] ? $properties['focus_button_border_radius1'] : 0 ?>px <?php echo $properties['focus_button_border_radius2'] ? $properties['focus_button_border_radius2'] : 0 ?>px <?php echo $properties['focus_button_border_radius4'] ? $properties['focus_button_border_radius4'] : 0 ?>px <?php echo $properties['focus_button_border_radius3'] ? $properties['focus_button_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['button_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['button_border_radius1'] ? $properties['button_border_radius1'] : 0 ?>px <?php echo $properties['button_border_radius2'] ? $properties['button_border_radius2'] : 0 ?>px <?php echo $properties['button_border_radius4'] ? $properties['button_border_radius4'] : 0 ?>px <?php echo $properties['button_border_radius3'] ? $properties['button_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n\n/* Lost Password */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels.lostpassword-link {\n\t<?php if(!empty($properties['lost_password_text_link_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['lost_password_text_link_color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .login-lostpassword a {\n\t<?php if(!empty($properties['lost_password_text_link_color'])) { ?>color: <?php echo $properties['lost_password_text_link_color']  ?>; <?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels {\n\t<?php if(!empty($properties['lost_password_text_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['lost_password_text_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['lost_password_text_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .login-lostpassword,\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword {\n\t<?php if(!empty($properties['lost_password_text_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['lost_password_text_color'])) { ?>color: <?php echo $properties['lost_password_text_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['lost_password_text_font_face'])) { ?>font-family: <?php echo $properties['lost_password_text_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['lost_password_text_font_size'])) { ?>font-size: <?php echo $properties['lost_password_text_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['lost_password_text_weight'])) { ?>font-weight: <?php echo $properties['lost_password_text_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['lost_password_text_style'])) { ?>font-style: <?php echo $properties['lost_password_text_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['lost_password_text_line_height'])) { ?>line-height: <?php echo $properties['lost_password_text_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels.lostpassword-link:hover {\n\t<?php if(!empty($properties['hover_use_lost_password_text_link_color']) && $properties['hover_use_lost_password_text_link_color'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_lost_password_text_link_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['hover_lost_password_text_link_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .login-lostpassword a:hover {\n\t<?php if(!empty($properties['hover_use_lost_password_text_link_color']) && $properties['hover_use_lost_password_text_link_color'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_lost_password_text_link_color'])) { ?>color: <?php echo $properties['hover_lost_password_text_link_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels:hover {\n\t<?php if(!empty($properties['hover_lost_password_text_use_typography']) && $properties['hover_lost_password_text_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['hover_lost_password_text_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .login-lostpassword:hover {\n\t<?php if(!empty($properties['hover_lost_password_text_use_typography']) && $properties['hover_lost_password_text_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_color'])) { ?>color: <?php echo $properties['hover_lost_password_text_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_font_face'])) { ?>font-family: <?php echo $properties['hover_lost_password_text_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_font_size'])) { ?>font-size: <?php echo $properties['hover_lost_password_text_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_weight'])) { ?>font-weight: <?php echo $properties['hover_lost_password_text_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_style'])) { ?>font-style: <?php echo $properties['hover_lost_password_text_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_lost_password_text_line_height'])) { ?>line-height: <?php echo $properties['hover_lost_password_text_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels.lostpassword-link:focus {\n\t<?php if(!empty($properties['focus_use_lost_password_text_link_color']) && $properties['focus_use_lost_password_text_link_color'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_lost_password_text_link_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['focus_lost_password_text_link_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .login-lostpassword a:focus {\n\t<?php if(!empty($properties['focus_use_lost_password_text_link_color']) && $properties['focus_use_lost_password_text_link_color'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_lost_password_text_link_color'])) { ?>color: <?php echo $properties['focus_lost_password_text_link_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels:focus {\n\t<?php if(!empty($properties['focus_lost_password_text_use_typography']) && $properties['focus_lost_password_text_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_color'])) { ?>-webkit-text-fill-color: <?php echo $properties['focus_lost_password_text_color']  ?>; <?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .login-lostpassword input.upfront-input-labels:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .login-lostpassword:focus {\n\t<?php if(!empty($properties['focus_lost_password_text_use_typography']) && $properties['focus_lost_password_text_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_color'])) { ?>color: <?php echo $properties['focus_lost_password_text_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_font_face'])) { ?>font-family: <?php echo $properties['focus_lost_password_text_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_font_size'])) { ?>font-size: <?php echo $properties['focus_lost_password_text_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_weight'])) { ?>font-weight: <?php echo $properties['focus_lost_password_text_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_style'])) { ?>font-style: <?php echo $properties['focus_lost_password_text_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_lost_password_text_line_height'])) { ?>line-height: <?php echo $properties['focus_lost_password_text_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n\n/* Login Trigger */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .upfront_login-trigger,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .upfront_login-trigger {\n\t<?php if(!empty($properties['login_trigger_button_background'])) { ?>\n\tbackground: <?php echo $properties['login_trigger_button_background'] ?>;\n\t<?php } ?>\n\t<?php if(!empty($properties['login_trigger_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['login_trigger_color'])) { ?>color: <?php echo $properties['login_trigger_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['login_trigger_font_face'])) { ?>font-family: <?php echo $properties['login_trigger_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['login_trigger_font_size'])) { ?>font-size: <?php echo $properties['login_trigger_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['login_trigger_weight'])) { ?>font-weight: <?php echo $properties['login_trigger_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['login_trigger_style'])) { ?>font-style: <?php echo $properties['login_trigger_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['login_trigger_line_height'])) { ?>line-height: <?php echo $properties['login_trigger_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['login_trigger_use_border'])) { ?>\n\t\t\t<?php if(!empty($properties['login_trigger_border_width']) && !empty($properties['login_trigger_border_type']) && !empty($properties['login_trigger_border_color'])) { ?>border: <?php echo $properties['login_trigger_border_width'] ?>px <?php echo $properties['login_trigger_border_type'] ?> <?php echo $properties['login_trigger_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\tborder: none;\n\t<?php } ?>\n\t<?php if(!empty($properties['login_trigger_use_radius'])) { ?>\n\t\t\tborder-radius: <?php echo $properties['login_trigger_border_radius1'] ? $properties['login_trigger_border_radius1'] : 0 ?>px <?php echo $properties['login_trigger_border_radius2'] ? $properties['login_trigger_border_radius2'] : 0 ?>px <?php echo $properties['login_trigger_border_radius4'] ? $properties['login_trigger_border_radius4'] : 0 ?>px <?php echo $properties['login_trigger_border_radius3'] ? $properties['login_trigger_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\tborder-radius: 0px;\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .upfront_login-trigger:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .upfront_login-trigger:hover {\n\t<?php if(!empty($properties['hover_use_login_trigger_button_background']) && $properties['hover_use_login_trigger_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_login_trigger_button_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['hover_login_trigger_button_background'] ?>;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_login_trigger_use_typography']) && $properties['hover_login_trigger_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_login_trigger_color'])) { ?>color: <?php echo $properties['hover_login_trigger_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_login_trigger_font_face'])) { ?>font-family: <?php echo $properties['hover_login_trigger_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_login_trigger_font_size'])) { ?>font-size: <?php echo $properties['hover_login_trigger_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover_login_trigger_weight'])) { ?>font-weight: <?php echo $properties['hover_login_trigger_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_login_trigger_style'])) { ?>font-style: <?php echo $properties['hover_login_trigger_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_login_trigger_line_height'])) { ?>line-height: <?php echo $properties['hover_login_trigger_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_login_trigger_use_border']) && $properties['hover_login_trigger_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_login_trigger_border_width']) && !empty($properties['hover_login_trigger_border_type']) && !empty($properties['hover_login_trigger_border_color'])) { ?>border: <?php echo $properties['hover_login_trigger_border_width'] ?>px <?php echo $properties['hover_login_trigger_border_type'] ?> <?php echo $properties['hover_login_trigger_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['login_trigger_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['login_trigger_border_width']) && !empty($properties['login_trigger_border_type']) && !empty($properties['login_trigger_border_color'])) { ?>border: <?php echo $properties['login_trigger_border_width'] ?>px <?php echo $properties['login_trigger_border_type'] ?> <?php echo $properties['login_trigger_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_login_trigger_use_radius']) && $properties['hover_login_trigger_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['hover_login_trigger_border_radius1'] ? $properties['hover_login_trigger_border_radius1'] : 0 ?>px <?php echo $properties['hover_login_trigger_border_radius2'] ? $properties['hover_login_trigger_border_radius2'] : 0 ?>px <?php echo $properties['hover_login_trigger_border_radius4'] ? $properties['hover_login_trigger_border_radius4'] : 0 ?>px <?php echo $properties['hover_login_trigger_border_radius3'] ? $properties['hover_login_trigger_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['login_trigger_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['login_trigger_border_radius1'] ? $properties['login_trigger_border_radius1'] : 0 ?>px <?php echo $properties['login_trigger_border_radius2'] ? $properties['login_trigger_border_radius2'] : 0 ?>px <?php echo $properties['login_trigger_border_radius4'] ? $properties['login_trigger_border_radius4'] : 0 ?>px <?php echo $properties['login_trigger_border_radius3'] ? $properties['login_trigger_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element .upfront_login-trigger:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element .upfront_login-trigger:focus {\n\t<?php if(!empty($properties['focus_use_login_trigger_button_background']) && $properties['focus_use_login_trigger_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_login_trigger_button_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['focus_login_trigger_button_background'] ?>;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_login_trigger_use_typography']) && $properties['focus_login_trigger_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_login_trigger_color'])) { ?>color: <?php echo $properties['focus_login_trigger_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_login_trigger_font_face'])) { ?>font-family: <?php echo $properties['focus_login_trigger_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_login_trigger_font_size'])) { ?>font-size: <?php echo $properties['focus_login_trigger_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus_login_trigger_weight'])) { ?>font-weight: <?php echo $properties['focus_login_trigger_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_login_trigger_style'])) { ?>font-style: <?php echo $properties['focus_login_trigger_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_login_trigger_line_height'])) { ?>line-height: <?php echo $properties['focus_login_trigger_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_login_trigger_use_border']) && $properties['focus_login_trigger_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_login_trigger_border_width']) && !empty($properties['focus_login_trigger_border_type']) && !empty($properties['focus_login_trigger_border_color'])) { ?>border: <?php echo $properties['focus_login_trigger_border_width'] ?>px <?php echo $properties['focus_login_trigger_border_type'] ?> <?php echo $properties['focus_login_trigger_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['login_trigger_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['login_trigger_border_width']) && !empty($properties['login_trigger_border_type']) && !empty($properties['login_trigger_border_color'])) { ?>border: <?php echo $properties['login_trigger_border_width'] ?>px <?php echo $properties['login_trigger_border_type'] ?> <?php echo $properties['login_trigger_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_login_trigger_use_radius']) && $properties['focus_login_trigger_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['focus_login_trigger_border_radius1'] ? $properties['focus_login_trigger_border_radius1'] : 0 ?>px <?php echo $properties['focus_login_trigger_border_radius2'] ? $properties['focus_login_trigger_border_radius2'] : 0 ?>px <?php echo $properties['focus_login_trigger_border_radius4'] ? $properties['focus_login_trigger_border_radius4'] : 0 ?>px <?php echo $properties['focus_login_trigger_border_radius3'] ? $properties['focus_login_trigger_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['login_trigger_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['login_trigger_border_radius1'] ? $properties['login_trigger_border_radius1'] : 0 ?>px <?php echo $properties['login_trigger_border_radius2'] ? $properties['login_trigger_border_radius2'] : 0 ?>px <?php echo $properties['login_trigger_border_radius4'] ? $properties['login_trigger_border_radius4'] : 0 ?>px <?php echo $properties['login_trigger_border_radius3'] ? $properties['login_trigger_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n\n/* Logout Link */\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element a.logout_link,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element a.logout_link {\n\t<?php if(!empty($properties['logout_link_button_background'])) { ?>\n\tbackground: <?php echo $properties['logout_link_button_background'] ?>;\n\t<?php } ?>\n\t<?php if(!empty($properties['logout_link_use_typography'])) { ?>\n\t\t<?php if(!empty($properties['logout_link_color'])) { ?>color: <?php echo $properties['logout_link_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['logout_link_font_face'])) { ?>font-family: <?php echo $properties['logout_link_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['logout_link_font_size'])) { ?>font-size: <?php echo $properties['logout_link_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['logout_link_weight'])) { ?>font-weight: <?php echo $properties['logout_link_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['logout_link_style'])) { ?>font-style: <?php echo $properties['logout_link_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['logout_link_line_height'])) { ?>line-height: <?php echo $properties['logout_link_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['logout_link_use_border'])) { ?>\n\t\t\t<?php if(!empty($properties['logout_link_border_width']) && !empty($properties['logout_link_border_type']) && !empty($properties['logout_link_border_color'])) { ?>border: <?php echo $properties['logout_link_border_width'] ?>px <?php echo $properties['logout_link_border_type'] ?> <?php echo $properties['logout_link_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\tborder: none;\n\t<?php } ?>\n\t<?php if(!empty($properties['logout_link_use_radius'])) { ?>\n\t\t\tborder-radius: <?php echo $properties['logout_link_border_radius1'] ? $properties['logout_link_border_radius1'] : 0 ?>px <?php echo $properties['logout_link_border_radius2'] ? $properties['logout_link_border_radius2'] : 0 ?>px <?php echo $properties['logout_link_border_radius4'] ? $properties['logout_link_border_radius4'] : 0 ?>px <?php echo $properties['logout_link_border_radius3'] ? $properties['logout_link_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\tborder-radius: 0px;\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element a.logout_link:hover,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element a.logout_link:hover {\n\t<?php if(!empty($properties['hover_use_logout_link_button_background']) && $properties['hover_use_logout_link_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_logout_link_button_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['hover_logout_link_button_background'] ?>;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_logout_link_use_typography']) && $properties['hover_logout_link_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['hover_logout_link_color'])) { ?>color: <?php echo $properties['hover_logout_link_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_logout_link_font_face'])) { ?>font-family: <?php echo $properties['hover_logout_link_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover_logout_link_font_size'])) { ?>font-size: <?php echo $properties['hover_logout_link_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover_logout_link_weight'])) { ?>font-weight: <?php echo $properties['hover_logout_link_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_logout_link_style'])) { ?>font-style: <?php echo $properties['hover_logout_link_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover_logout_link_line_height'])) { ?>line-height: <?php echo $properties['hover_logout_link_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_logout_link_use_border']) && $properties['hover_logout_link_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['hover_logout_link_border_width']) && !empty($properties['hover_logout_link_border_type']) && !empty($properties['hover_logout_link_border_color'])) { ?>border: <?php echo $properties['hover_logout_link_border_width'] ?>px <?php echo $properties['hover_logout_link_border_type'] ?> <?php echo $properties['hover_logout_link_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['logout_link_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['logout_link_border_width']) && !empty($properties['logout_link_border_type']) && !empty($properties['logout_link_border_color'])) { ?>border: <?php echo $properties['logout_link_border_width'] ?>px <?php echo $properties['logout_link_border_type'] ?> <?php echo $properties['logout_link_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover_logout_link_use_radius']) && $properties['hover_logout_link_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['hover_logout_link_border_radius1'] ? $properties['hover_logout_link_border_radius1'] : 0 ?>px <?php echo $properties['hover_logout_link_border_radius2'] ? $properties['hover_logout_link_border_radius2'] : 0 ?>px <?php echo $properties['hover_logout_link_border_radius4'] ? $properties['hover_logout_link_border_radius4'] : 0 ?>px <?php echo $properties['hover_logout_link_border_radius3'] ? $properties['hover_logout_link_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['logout_link_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['logout_link_border_radius1'] ? $properties['logout_link_border_radius1'] : 0 ?>px <?php echo $properties['logout_link_border_radius2'] ? $properties['logout_link_border_radius2'] : 0 ?>px <?php echo $properties['logout_link_border_radius4'] ? $properties['logout_link_border_radius4'] : 0 ?>px <?php echo $properties['logout_link_border_radius3'] ? $properties['logout_link_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n#page .<?php echo $properties['id'] ?> .upfront-output-upfront-login_element a.logout_link:focus,\n#page .<?php echo $properties['id'] ?>.upfront-output-upfront-login_element a.logout_link:focus {\n\t<?php if(!empty($properties['focus_use_logout_link_button_background']) && $properties['focus_use_logout_link_button_background'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_logout_link_button_background'])) { ?>\n\t\t\tbackground: <?php echo $properties['focus_logout_link_button_background'] ?>;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_logout_link_use_typography']) && $properties['focus_logout_link_use_typography'] == 'yes') { ?>\n\t\t<?php if(!empty($properties['focus_logout_link_color'])) { ?>color: <?php echo $properties['focus_logout_link_color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_logout_link_font_face'])) { ?>font-family: <?php echo $properties['focus_logout_link_font_face']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus_logout_link_font_size'])) { ?>font-size: <?php echo $properties['focus_logout_link_font_size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus_logout_link_weight'])) { ?>font-weight: <?php echo $properties['focus_logout_link_weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_logout_link_style'])) { ?>font-style: <?php echo $properties['focus_logout_link_style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus_logout_link_line_height'])) { ?>line-height: <?php echo $properties['focus_logout_link_line_height']  ?>;<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_logout_link_use_border']) && $properties['focus_logout_link_use_border'] == 'yes') { ?>\n\t\t\t<?php if(!empty($properties['focus_logout_link_border_width']) && !empty($properties['focus_logout_link_border_type']) && !empty($properties['focus_logout_link_border_color'])) { ?>border: <?php echo $properties['focus_logout_link_border_width'] ?>px <?php echo $properties['focus_logout_link_border_type'] ?> <?php echo $properties['focus_logout_link_border_color'] ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['logout_link_use_border'])) { ?>\n\t\t\t\t\t<?php if(!empty($properties['logout_link_border_width']) && !empty($properties['logout_link_border_type']) && !empty($properties['logout_link_border_color'])) { ?>border: <?php echo $properties['logout_link_border_width'] ?>px <?php echo $properties['logout_link_border_type'] ?> <?php echo $properties['logout_link_border_color'] ?>;<?php } ?>\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder: none;\n\t\t\t<?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['focus_logout_link_use_radius']) && $properties['focus_logout_link_use_radius'] == 'yes') { ?>\n\t\t\tborder-radius: <?php echo $properties['focus_logout_link_border_radius1'] ? $properties['focus_logout_link_border_radius1'] : 0 ?>px <?php echo $properties['focus_logout_link_border_radius2'] ? $properties['focus_logout_link_border_radius2'] : 0 ?>px <?php echo $properties['focus_logout_link_border_radius4'] ? $properties['focus_logout_link_border_radius4'] : 0 ?>px <?php echo $properties['focus_logout_link_border_radius3'] ? $properties['focus_logout_link_border_radius3'] : 0 ?>px;\n\t<?php } else { ?>\n\t\t\t<?php if(!empty($properties['logout_link_use_radius'])) { ?>\n\t\t\t\t\tborder-radius: <?php echo $properties['logout_link_border_radius1'] ? $properties['logout_link_border_radius1'] : 0 ?>px <?php echo $properties['logout_link_border_radius2'] ? $properties['logout_link_border_radius2'] : 0 ?>px <?php echo $properties['logout_link_border_radius4'] ? $properties['logout_link_border_radius4'] : 0 ?>px <?php echo $properties['logout_link_border_radius3'] ? $properties['logout_link_border_radius3'] : 0 ?>px;\n\t\t\t<?php } else { ?>\n\t\t\t\t\tborder-radius: 0px;\n\t\t\t<?php } ?>\n\t<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n";
}),define("elements/upfront-login/js/preset-settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-login/tpl/preset-style.html"],function(t,e,i){var n=Upfront.Settings.l10n.login_element,o={mainDataCollection:"loginPresets",styleElementPrefix:"login-preset",ajaxActionSlug:"login",panelTitle:n.settings,presetDefaults:Upfront.mainData.presetDefaults.login,styleTpl:i,stateModules:{Global:[{moduleType:"Selectbox",options:{state:"global",default_value:"form_wrapper",title:"",custom_class:"image_style",label:n.preset.part_to_style,fields:{name:"part_style"},values:[{label:n.preset.form_wrapper,value:"form_wrapper"},{label:n.preset.field_labels,value:"field_labels"},{label:n.preset.input_fields,value:"input_fields"},{label:n.preset.button,value:"button"},{label:n.preset.lost_password,value:"lost_password_text"},{label:n.preset.login_trigger,value:"login_trigger"},{label:n.preset.logout_link,value:"logout_link"}]}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"form_wrapper_settings",abccolors:[{name:"form_wrapper_background",label:n.preset.wrapper_background}]}},{moduleType:"Border",options:{state:"form_wrapper_settings",title:"",fields:{use:"form_wrapper_use_border",width:"form_wrapper_border_width",type:"form_wrapper_border_type",color:"form_wrapper_border_color"}}},{moduleType:"Radius",options:{state:"form_wrapper_settings",max_value:100,fields:{use:"form_wrapper_use_radius",lock:"form_wrapper_border_radius_lock",radius:"form_wrapper_radius",radius_number:"form_wrapper_radius_number",radius1:"form_wrapper_border_radius1",radius2:"form_wrapper_border_radius2",radius3:"form_wrapper_border_radius3",radius4:"form_wrapper_border_radius4"}}}],Static:[{moduleType:"Typography",options:{state:"field_labels_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,fields:{typeface:"field_labels_font_face",fontstyle:"field_labels_font_style",weight:"field_labels_weight",style:"field_labels_style",size:"field_labels_font_size",line_height:"field_labels_line_height",color:"field_labels_color",use:"field_labels_use_typography"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"input_fields_settings",abccolors:[{name:"input_fields_background",label:n.preset.field_background}]}},{moduleType:"Typography",options:{state:"input_fields_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,fields:{typeface:"input_fields_font_face",fontstyle:"input_fields_font_style",weight:"input_fields_weight",style:"input_fields_style",size:"input_fields_font_size",line_height:"input_fields_line_height",color:"input_fields_color",use:"input_fields_use_typography"}}},{moduleType:"Border",options:{state:"input_fields_settings",title:"",fields:{use:"input_fields_use_border",width:"input_fields_border_width",type:"input_fields_border_type",color:"input_fields_border_color"}}},{moduleType:"Radius",options:{state:"input_fields_settings",max_value:100,fields:{use:"input_fields_use_radius",lock:"input_fields_border_radius_lock",radius:"input_fields_radius",radius_number:"input_fields_radius_number",radius1:"input_fields_border_radius1",radius2:"input_fields_border_radius2",radius3:"input_fields_border_radius3",radius4:"input_fields_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"button_settings",abccolors:[{name:"button_background",label:n.preset.button_background}]}},{moduleType:"Typography",options:{state:"button_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,fields:{typeface:"button_font_face",fontstyle:"button_font_style",weight:"button_weight",style:"button_style",size:"button_font_size",line_height:"button_line_height",color:"button_color",use:"button_use_typography"}}},{moduleType:"Border",options:{state:"button_settings",title:"",fields:{use:"button_use_border",width:"button_border_width",type:"button_border_type",color:"button_border_color"}}},{moduleType:"Radius",options:{state:"button_settings",max_value:100,fields:{use:"button_use_radius",lock:"button_border_radius_lock",radius:"button_radius",radius_number:"button_radius_number",radius1:"button_border_radius1",radius2:"button_border_radius2",radius3:"button_border_radius3",radius4:"button_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"lost_password_text_settings",abccolors:[{name:"lost_password_text_link_color",label:n.preset.link_color}]}},{moduleType:"Typography",options:{state:"lost_password_text_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,fields:{typeface:"lost_password_text_font_face",fontstyle:"lost_password_text_font_style",weight:"lost_password_text_weight",style:"lost_password_text_style",size:"lost_password_text_font_size",line_height:"lost_password_text_line_height",color:"lost_password_text_color",use:"lost_password_text_use_typography"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"login_trigger_settings",abccolors:[{name:"login_trigger_button_background",label:n.preset.button_background}]}},{moduleType:"Typography",options:{state:"login_trigger_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,fields:{typeface:"login_trigger_font_face",fontstyle:"login_trigger_font_style",weight:"login_trigger_weight",style:"login_trigger_style",size:"login_trigger_font_size",line_height:"login_trigger_line_height",color:"login_trigger_color",use:"login_trigger_use_typography"}}},{moduleType:"Border",options:{state:"login_trigger_settings",title:"",fields:{use:"login_trigger_use_border",width:"login_trigger_border_width",type:"login_trigger_border_type",color:"login_trigger_border_color"}}},{moduleType:"Radius",options:{state:"login_trigger_settings",max_value:100,fields:{use:"login_trigger_use_radius",lock:"login_trigger_border_radius_lock",radius:"login_trigger_radius",radius_number:"login_trigger_radius_number",radius1:"login_trigger_border_radius1",radius2:"login_trigger_border_radius2",radius3:"login_trigger_border_radius3",radius4:"login_trigger_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"logout_link_settings",abccolors:[{name:"logout_link_button_background",label:n.preset.button_background}]}},{moduleType:"Typography",options:{state:"logout_link_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,fields:{typeface:"logout_link_font_face",fontstyle:"logout_link_font_style",weight:"logout_link_weight",style:"logout_link_style",size:"logout_link_font_size",line_height:"logout_link_line_height",color:"logout_link_color",use:"logout_link_use_typography"}}},{moduleType:"Border",options:{state:"logout_link_settings",title:"",fields:{use:"logout_link_use_border",width:"logout_link_border_width",type:"logout_link_border_type",color:"logout_link_border_color"}}},{moduleType:"Radius",options:{state:"logout_link_settings",max_value:100,fields:{use:"logout_link_use_radius",lock:"logout_link_border_radius_lock",radius:"logout_link_radius",radius_number:"logout_link_radius_number",radius1:"logout_link_border_radius1",radius2:"logout_link_border_radius2",radius3:"logout_link_border_radius3",radius4:"logout_link_border_radius4"}}}],Hover:[{moduleType:"Typography",options:{state:"field_labels_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"hover_",fields:{typeface:"hover_field_labels_font_face",fontstyle:"hover_field_labels_font_style",weight:"hover_field_labels_weight",style:"hover_field_labels_style",size:"hover_field_labels_font_size",line_height:"hover_field_labels_line_height",color:"hover_field_labels_color",use:"hover_field_labels_use_typography"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"input_fields_settings",prepend:"hover_",toggle:!0,abccolors:[{name:"hover_input_fields_background",label:n.preset.field_background}],fields:{use:"hover_use_input_fields_background"}}},{moduleType:"Typography",options:{state:"input_fields_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"hover_",fields:{typeface:"hover_input_fields_font_face",fontstyle:"hover_input_fields_font_style",weight:"hover_input_fields_weight",style:"hover_input_fields_style",size:"hover_input_fields_font_size",line_height:"hover_input_fields_line_height",color:"hover_input_fields_color",use:"hover_input_fields_use_typography"}}},{moduleType:"Border",options:{state:"input_fields_settings",title:"",prepend:"hover_",fields:{use:"hover_input_fields_use_border",width:"hover_input_fields_border_width",type:"hover_input_fields_border_type",color:"hover_input_fields_border_color"}}},{moduleType:"Radius",options:{state:"input_fields_settings",max_value:100,prepend:"hover_",fields:{use:"hover_input_fields_use_radius",lock:"hover_input_fields_border_radius_lock",radius:"hover_input_fields_radius",radius_number:"hover_input_fields_radius_number",radius1:"hover_input_fields_border_radius1",radius2:"hover_input_fields_border_radius2",radius3:"hover_input_fields_border_radius3",radius4:"hover_input_fields_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"button_settings",prepend:"hover_",toggle:!0,abccolors:[{name:"hover_button_background",label:n.preset.button_background}],fields:{use:"hover_use_button_background"}}},{moduleType:"Typography",options:{state:"button_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"hover_",fields:{typeface:"hover_button_font_face",fontstyle:"hover_button_font_style",weight:"hover_button_weight",style:"hover_button_style",size:"hover_button_font_size",line_height:"hover_button_line_height",color:"hover_button_color",use:"hover_button_use_typography"}}},{moduleType:"Border",options:{state:"button_settings",title:"",prepend:"hover_",fields:{use:"hover_button_use_border",width:"hover_button_border_width",type:"hover_button_border_type",color:"hover_button_border_color"}}},{moduleType:"Radius",options:{state:"button_settings",max_value:100,prepend:"hover_",fields:{use:"hover_button_use_radius",lock:"hover_button_border_radius_lock",radius:"hover_button_radius",radius_number:"hover_button_radius_number",radius1:"hover_button_border_radius1",radius2:"hover_button_border_radius2",radius3:"hover_button_border_radius3",radius4:"hover_button_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"lost_password_text_settings",prepend:"hover_",toggle:!0,abccolors:[{name:"hover_lost_password_text_link_color",label:n.preset.link_color}],fields:{use:"hover_use_lost_password_text_link_color"}}},{moduleType:"Typography",options:{state:"lost_password_text_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"hover_",fields:{typeface:"hover_lost_password_text_font_face",fontstyle:"hover_lost_password_text_font_style",weight:"hover_lost_password_text_weight",style:"hover_lost_password_text_style",size:"hover_lost_password_text_font_size",line_height:"hover_lost_password_text_line_height",color:"hover_lost_password_text_color",use:"hover_lost_password_text_use_typography"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"login_trigger_settings",prepend:"hover_",toggle:!0,abccolors:[{name:"hover_login_trigger_button_background",label:n.preset.button_background}],fields:{use:"hover_use_login_trigger_button_background"}}},{moduleType:"Typography",options:{state:"login_trigger_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"hover_",fields:{typeface:"hover_login_trigger_font_face",fontstyle:"hover_login_trigger_font_style",weight:"hover_login_trigger_weight",style:"hover_login_trigger_style",size:"hover_login_trigger_font_size",line_height:"hover_login_trigger_line_height",color:"hover_login_trigger_color",use:"hover_login_trigger_use_typography"}}},{moduleType:"Border",options:{state:"login_trigger_settings",title:"",prepend:"hover_",fields:{use:"hover_login_trigger_use_border",width:"hover_login_trigger_border_width",type:"hover_login_trigger_border_type",color:"hover_login_trigger_border_color"}}},{moduleType:"Radius",options:{state:"login_trigger_settings",max_value:100,prepend:"hover_",fields:{use:"hover_login_trigger_use_radius",lock:"hover_login_trigger_border_radius_lock",radius:"hover_login_trigger_radius",radius_number:"hover_login_trigger_radius_number",radius1:"hover_login_trigger_border_radius1",radius2:"hover_login_trigger_border_radius2",radius3:"hover_login_trigger_border_radius3",radius4:"hover_login_trigger_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"logout_link_settings",prepend:"hover_",toggle:!0,abccolors:[{name:"hover_logout_link_button_background",label:n.preset.button_background}],fields:{use:"hover_use_logout_link_button_background"}}},{moduleType:"Typography",options:{state:"logout_link_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"hover_",fields:{typeface:"hover_logout_link_font_face",fontstyle:"hover_logout_link_font_style",weight:"hover_logout_link_weight",style:"hover_logout_link_style",size:"hover_logout_link_font_size",line_height:"hover_logout_link_line_height",color:"hover_logout_link_color",use:"hover_logout_link_use_typography"}}},{moduleType:"Border",options:{state:"logout_link_settings",title:"",prepend:"hover_",fields:{use:"hover_logout_link_use_border",width:"hover_logout_link_border_width",type:"hover_logout_link_border_type",color:"hover_logout_link_border_color"}}},{moduleType:"Radius",options:{state:"logout_link_settings",max_value:100,prepend:"hover_",fields:{use:"hover_logout_link_use_radius",lock:"hover_logout_link_border_radius_lock",radius:"hover_logout_link_radius",radius_number:"hover_logout_link_radius_number",radius1:"hover_logout_link_border_radius1",radius2:"hover_logout_link_border_radius2",radius3:"hover_logout_link_border_radius3",radius4:"hover_logout_link_border_radius4"}}}],Focus:[{moduleType:"Typography",options:{state:"field_labels_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"focus_",fields:{typeface:"focus_field_labels_font_face",fontstyle:"focus_field_labels_font_style",weight:"focus_field_labels_weight",style:"focus_field_labels_style",size:"focus_field_labels_font_size",line_height:"focus_field_labels_line_height",color:"focus_field_labels_color",use:"focus_field_labels_use_typography"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"input_fields_settings",prepend:"focus_",toggle:!0,abccolors:[{name:"focus_input_fields_background",label:n.preset.field_background}],fields:{use:"focus_use_input_fields_background"}}},{moduleType:"Typography",options:{state:"input_fields_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"focus_",fields:{typeface:"focus_input_fields_font_face",fontstyle:"focus_input_fields_font_style",weight:"focus_input_fields_weight",style:"focus_input_fields_style",size:"focus_input_fields_font_size",line_height:"focus_input_fields_line_height",color:"focus_input_fields_color",use:"focus_input_fields_use_typography"}}},{moduleType:"Border",options:{state:"input_fields_settings",title:"",prepend:"focus_",fields:{use:"focus_input_fields_use_border",width:"focus_input_fields_border_width",type:"focus_input_fields_border_type",color:"focus_input_fields_border_color"}}},{moduleType:"Radius",options:{state:"input_fields_settings",max_value:100,prepend:"focus_",fields:{use:"focus_input_fields_use_radius",lock:"focus_input_fields_border_radius_lock",radius:"focus_input_fields_radius",radius_number:"focus_input_fields_radius_number",radius1:"focus_input_fields_border_radius1",radius2:"focus_input_fields_border_radius2",radius3:"focus_input_fields_border_radius3",radius4:"focus_input_fields_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"button_settings",prepend:"focus_",toggle:!0,abccolors:[{name:"focus_button_background",label:n.preset.button_background}],fields:{use:"focus_use_button_background"}}},{moduleType:"Typography",options:{state:"button_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"focus_",fields:{typeface:"focus_button_font_face",fontstyle:"focus_button_font_style",weight:"focus_button_weight",style:"focus_button_style",size:"focus_button_font_size",line_height:"focus_button_line_height",color:"focus_button_color",use:"focus_button_use_typography"}}},{moduleType:"Border",options:{state:"button_settings",title:"",prepend:"focus_",fields:{use:"focus_button_use_border",width:"focus_button_border_width",type:"focus_button_border_type",color:"focus_button_border_color"}}},{moduleType:"Radius",options:{state:"button_settings",max_value:100,prepend:"focus_",fields:{use:"focus_button_use_radius",lock:"focus_button_border_radius_lock",radius:"focus_button_radius",radius_number:"focus_button_radius_number",radius1:"focus_button_border_radius1",radius2:"focus_button_border_radius2",radius3:"focus_button_border_radius3",radius4:"focus_button_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"lost_password_text_settings",prepend:"focus_",toggle:!0,abccolors:[{name:"focus_lost_password_text_link_color",label:n.preset.link_color}],fields:{use:"focus_use_lost_password_text_link_color"}}},{moduleType:"Typography",options:{state:"lost_password_text_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"focus_",fields:{typeface:"focus_lost_password_text_font_face",fontstyle:"focus_lost_password_text_font_style",weight:"focus_lost_password_text_weight",style:"focus_lost_password_text_style",size:"focus_lost_password_text_font_size",line_height:"focus_lost_password_text_line_height",color:"focus_lost_password_text_color",use:"focus_lost_password_text_use_typography"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"login_trigger_settings",prepend:"focus_",toggle:!0,abccolors:[{name:"focus_login_trigger_button_background",label:n.preset.button_background}],fields:{use:"focus_use_login_trigger_button_background"}}},{moduleType:"Typography",options:{state:"login_trigger_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"focus_",fields:{typeface:"focus_login_trigger_font_face",fontstyle:"focus_login_trigger_font_style",weight:"focus_login_trigger_weight",style:"focus_login_trigger_style",size:"focus_login_trigger_font_size",line_height:"focus_login_trigger_line_height",color:"focus_login_trigger_color",use:"focus_login_trigger_use_typography"}}},{moduleType:"Border",options:{state:"login_trigger_settings",title:"",prepend:"focus_",fields:{use:"focus_login_trigger_use_border",width:"focus_login_trigger_border_width",type:"focus_login_trigger_border_type",color:"focus_login_trigger_border_color"}}},{moduleType:"Radius",options:{state:"login_trigger_settings",max_value:100,prepend:"focus_",fields:{use:"focus_login_trigger_use_radius",lock:"focus_login_trigger_border_radius_lock",radius:"focus_login_trigger_radius",radius_number:"focus_login_trigger_radius_number",radius1:"focus_login_trigger_border_radius1",radius2:"focus_login_trigger_border_radius2",radius3:"focus_login_trigger_border_radius3",radius4:"focus_login_trigger_border_radius4"}}},{moduleType:"Colors",options:{title:"",multiple:!1,single:!0,state:"logout_link_settings",prepend:"focus_",toggle:!0,abccolors:[{name:"focus_logout_link_button_background",label:n.preset.button_background}],fields:{use:"focus_use_logout_link_button_background"}}},{moduleType:"Typography",options:{state:"logout_link_settings",title:Upfront.Settings.l10n.global.views.typography,toggle:!0,global_typography:!1,prepend:"focus_",fields:{typeface:"focus_logout_link_font_face",fontstyle:"focus_logout_link_font_style",weight:"focus_logout_link_weight",style:"focus_logout_link_style",size:"focus_logout_link_font_size",line_height:"focus_logout_link_line_height",color:"focus_logout_link_color",use:"focus_logout_link_use_typography"}}},{moduleType:"Border",options:{state:"logout_link_settings",title:"",prepend:"focus_",fields:{use:"focus_logout_link_use_border",width:"focus_logout_link_border_width",type:"focus_logout_link_border_type",color:"focus_logout_link_border_color"}}},{moduleType:"Radius",options:{state:"logout_link_settings",max_value:100,prepend:"focus_",fields:{use:"focus_logout_link_use_radius",lock:"focus_logout_link_border_radius_lock",radius:"focus_logout_link_radius",radius_number:"focus_logout_link_radius_number",radius1:"focus_logout_link_border_radius1",radius2:"focus_logout_link_border_radius2",radius3:"focus_logout_link_border_radius3",radius4:"focus_logout_link_border_radius4"}}}]}};return o}),function(t){define("upfront_login",["text!elements/upfront-login/css/edit.css","text!elements/upfront-login/css/public.css","elements/upfront-login/js/preset-settings","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/element-settings/advanced-settings","scripts/upfront/preset-settings/util","text!elements/upfront-login/tpl/preset-style.html"],function(e,i,n,o,r,s,a,l){t("head").append("<style>"+e+"</style>"),t("head").append("<style>"+i+"</style>");var p=Upfront.Settings.l10n.login_element,d=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.upfront_login.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),c=Upfront.Views.ObjectView.extend({markup:!1,initialize:function(){this.model instanceof d||(this.model=new d({properties:this.model.get("properties")})),Upfront.Views.ObjectView.prototype.initialize.call(this);var t=this;this.model.get("properties").on("change",function(e){return!e||!e.get||void("row"!=e.get("name")&&(t.markup=!1,t.render()))}),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this)},render:function(){this.markup||this.fetch_content_markup(),Upfront.Views.ObjectView.prototype.render.call(this)},on_render:function(){if(Upfront.Application.user_can_modify_layout()){var e=this;$username=this.$el.find('label[for="user_login"]'),$username_input_label=t('<input type="text" class="upfront-input-labels" value="'+$username.text()+'"/>'),$username_input_label.on("change",function(){var i=t(this).val();i&&e.model.set_property("username_label",i,!0)}),$username.replaceWith($username_input_label),$password=this.$el.find('label[for="user_pass"]'),$password_input_label=t('<input type="text" class="upfront-input-labels" value="'+$password.text()+'"/>'),$password_input_label.on("change",function(){var i=t(this).val();i&&e.model.set_property("password_label",i,!0)}),$password.replaceWith($password_input_label),$remember=this.$el.find(".login-remember > label"),$remember_checkbox=$remember.find("input"),$remember_input_label=t('<input type="text" class="upfront-input-labels" value="'+$remember.text()+'"/>'),$remember.html($remember_checkbox),$remember_input_label.on("change",function(){var i=t(this).val();i&&e.model.set_property("remember_label",i,!0)}),$remember.append($remember_input_label),$login_button=this.$el.find(".login-submit input.button-primary"),$login_button_label=t('<input type="text" class="upfront-input-labels" value="'+$login_button.val()+'"/>'),$login_button_label.on("change",function(){var i=t(this).val();i&&e.model.set_property("login_button_label",i,!0)}),$login_button.replaceWith($login_button_label),$lost_password_text=this.$el.find("span.login-lostpassword-label"),$lost_password_text_input_label=t('<input type="text" class="upfront-input-labels" value="'+$lost_password_text.text()+'"/>'),$lost_password_text_input_label.on("change",function(){var i=t(this).val();i&&e.model.set_property("lost_password_text",i,!0)}),$lost_password_text.replaceWith($lost_password_text_input_label),$lost_password_link=this.$el.find("a.login-lostpassword-link"),$lost_password_link_input_label=t('<input type="text" class="upfront-input-labels lostpassword-link" value="'+$lost_password_link.text()+'"/>'),$lost_password_link_input_label.on("change",function(){var i=t(this).val();i&&e.model.set_property("lost_password_link",i,!0)}),$lost_password_link.replaceWith($lost_password_link_input_label),$login_link=this.$el.find("span.upfront_login-label"),$login_link.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["upfrontIcons"],autostart:!1}).on("stop",function(){var t=e.$el.find("span.upfront_login-label").data("ueditor"),i=t.getValue(!0);i&&e.model.set_property("trigger_text",i,!0),e.redraw_layout()}),$logout_link=this.$el.find("a.logout_link"),$logout_link.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["upfrontIcons"],autostart:!1}).on("stop",function(){var t=e.$el.find("a.logout_link").data("ueditor"),i=t.getValue(!0);i&&e.model.set_property("logout_link",i,!0),e.redraw_layout()});var i=e.model.get_property_value_by_name("style");i&&"form"!==i&&e.$el.closest(".upfront-objects_container").css("z-index",3e3)}this.events=_.extend({},this.events,{"click label":"disable_default","click a":"disable_default","click .upfront_login.upfront_login-click .upfront_login-trigger":"trigger_login_click"}),this.delegateEvents()},trigger_login_click:function(e){if(Upfront.Application.user_can_modify_layout()){var i=t(e.target).closest(".upfront_login-click");return i.addClass("active").one("click",function(){return i.removeClass("active"),!1}).find(".upfront_login-form").on("click",function(t){t.preventDefault(),t.stopPropagation()}),!1}},get_content_markup:function(){return this.markup?this.markup:p.hold_on},fetch_content_markup:function(){var t=this,e=Upfront.Util.model_to_json(this.model);Upfront.Util.post({action:"upfront-login_element-get_markup",properties:e.properties}).done(function(e){t.markup=e.data,Upfront.Views.ObjectView.prototype.render.call(t),Upfront.Events.trigger("entity:object:refresh",t)})},redraw_layout:function(){this.markup=!1,Upfront.Views.ObjectView.prototype.render.call(this),this.fetch_content_markup()},disable_default:function(t){Upfront.Application.user_can_modify_layout()&&(t.preventDefault(),t.stopPropagation())}}),u=(Upfront.Views.Editor.Field.Text.extend({className:"upfront-field-wrap upfront-field-wrap-appearance-icon-image",get_field_html:function(){return'<div class="upfront_login-icon"><img src="'+Upfront.data.upfront_login.root_url+'img/icon.png" />'+Upfront.Views.Editor.Field.Text.prototype.get_field_html.call(this)+"</div>"},get_saved_value:function(){var t=this.property?this.property.get("value"):this.model?this.model.get(this.name):"";return"icon"===t?"":t},get_value:function(){return this.$el.find("input").val()||"icon"}}),Upfront.Views.Editor.Settings.Item.extend({save_fields:function(){var t=this.model;this.fields.each(function(e){var i=e.get_value();_.isObject(i)&&_(i).each(function(e,i){return"appearance"==i&&!e||void t.set_property(i,e)})})}})),h=(Backbone.View.extend({className:"upfront_login-fields-complex_boolean clearfix",initialize:function(t){this.options=t;var e=t.model,i=t.boolean_field.values||[];i.length||i.push({label:"",value:"1"}),this.options.field=new Upfront.Views.Editor.Field.Radios(_.extend(t.boolean_field,{model:e,mutiple:!1,values:i}))},render:function(){this.$el.empty(),this.options.subfield.render(),this.options.field.render(),this.$el.append(this.options.field.$el),this.$el.append(this.options.subfield.$el),this.options.additional_class&&this.$el.addClass(this.options.additional_class)},get_value:function(){var t={};return t[this.options.field.get_name()]=this.options.field.get_value(),t[this.options.subfield.get_name()]=this.options.subfield.get_value(),t}}),r.extend({title:p.general_settings,initialize:function(t){this.options=t;var e=new m({model:this.model}),i=new g({model:this.model}),n=this,o=this.preview_field();this.preview_check_field=new o({model:this.model,className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes float-right",property:"logged_in_preview",label:"",multiple:!1,values:[{label:p.preview,value:"yes"}],change:function(){this.property.set({value:this.get_value()},{silent:!1})}}),this.settings=_([e,i,new Upfront.Views.Editor.Settings.Item({model:this.model,title:p.logged_in_preview,className:"upfront-settings-item relative",fields:[this.preview_check_field,new Upfront.Views.Editor.Field.Radios({className:"upfront_login-logout_style upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios clear-after",model:this.model,property:"logout_style",layout:"horizontal-inline",values:[{label:p.nothing,value:"nothing"},{label:p.log_out_link,value:"link"}],change:function(){this.property.set({value:this.get_value()},{silent:!1})}})]})]),e.on("login:appearance:changed",i.update,i),e.on("login:appearance:changed",function(){n.trigger("upfront:settings:panel:refresh",n)})},render:function(){r.prototype.render.call(this),this.$el.addClass("upfront_login-settings-panel"),this.settings.each(function(t){t.update&&t.update()})},get_label:function(){return p.display},get_title:function(){return p.display},preview_field:function(){var t=Upfront.Views.Editor.Field.Checkboxes.extend({get_value_html:function(t,e){var i=this.get_field_id()+"-"+e,n="upfront-field-multiple",o={type:this.type,id:i,name:this.get_field_name(),value:t.value,class:"upfront_toggle_checkbox upfront-field-"+this.type},r=this.get_saved_value();this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(n+=" upfront-field-multiple-"+this.options.layout),t.disabled&&(o.disabled="disabled",n+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(r,t.value)?o.checked="checked":this.multiple||r!=t.value||(o.checked="checked"),t.checked&&(o.checked="checked"),o.checked&&(n+=" upfront-field-multiple-selected"),'<div class="'+n+' upfront_toggle"><span class="upfront-field-label-text">'+t.label+"</span><input "+this.get_field_attr_html(o)+' /><label for="'+i+'" class="upfront_toggle_label"><span class="upfront_toggle_switch"></span></label></div>'}});return t}})),f=o.extend({className:"login-element-settings",events:_.extend({},o.prototype.events,this.events,{'change input[name="part_style"]':"toggle_part_style"}),panels:{General:h,Appearance:n},title:p.settings,get_title:function(){return p.settings},initialize:function(){o.prototype.initialize.call(this),this.stopListening(Upfront.Events,"element:preset:updated"),this.listenTo(Upfront.Events,"element:preset:updated",this.preset_changed)},render:function(){o.prototype.render.call(this);var t=this;setTimeout(function(){var e=t.get_preset_property("part_style");t.change_view(e)},100)},toggle_part_style:function(e){var i=t(e.target).val();this.change_view(i)},default_view:function(){this.$el.find(".state_settings_button_wrapper").hide(),this.$el.find(".state_modules.state_settings").hide(),this.$el.find('[class^="form_wrapper_settings"]').closest(".settings_module").show()},toggle_view:function(t){var e=this;this.$el.find(".settings_module").not(":first").hide(),this.$el.find(".state_settings_button_wrapper").show(),this.$el.find('[class^="'+t+'_settings"]').closest(".settings_module").show(),setTimeout(function(){e.$el.find(".state_settings_button.state_settings_button_static").click()},100)},change_view:function(t){t&&"form_wrapper"!==t?this.toggle_view(t):this.default_view()},preset_changed:function(){var t=this;setTimeout(function(){var e=t.get_preset_property("part_style");t.change_view(e)},500)},get_preset_property:function(t){var e=this.model.get_property_value_by_name("preset"),i=a.getPresetProperties("login",e)||{};return"undefined"!=typeof i[t]&&i[t]}}),g=Upfront.Views.Editor.Settings.Item.extend({
className:"display_behavior",events:function(){return _.extend({},Upfront.Views.Editor.Settings.Item.prototype.events,{click:"register_change"})},initialize:function(){var t=this.model.get_property_value_by_name("style"),e=!t||"popup"==t,i=[{label:p.show_on_hover,value:"hover",disabled:e},{label:p.show_on_click,value:"click"}];this.fields=_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"behavior",values:i,layout:"horizontal-inline"}),new Upfront.Views.Editor.Field.Number({model:this.model,property:"top_offset",className:"upfront-field-wrap upfront-field-wrap-number offset",label:p.top_offset,default_value:0}),new Upfront.Views.Editor.Field.Number({model:this.model,property:"left_offset",className:"upfront-field-wrap upfront-field-wrap-number offset",label:p.left_offset,default_value:0})])},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),this.$el.addClass("upfront_login-item-display_behavior").find(".upfront-settings-item-content").addClass("clearfix").end().hide(),this.$el.find(".upfront-field-wrap.offset").each(function(){t(this).append("<span>"+p.px+"</span>")})},get_title:function(){return p.show_form_label},register_change:function(){this.fields.each(function(t){t.property.set({value:t.get_value()},{silent:!1})}),this.trigger("login:behavior:changed")},update:function(){var t=this.model.get_property_value_by_name("style");this.initialize(),this.$el.empty(),this.render(),"form"!=t&&this.$el.show()}}),m=u.extend({initialize:function(){var t=this,e=[{label:p.on_page,value:"form"},{label:p.dropdown,value:"dropdown"}];this.fields=_([new Upfront.Views.Editor.Field.Radios({model:this.model,property:"style",layout:"horizontal-inline",values:e,change:function(){t.register_change(t)}})])},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),this.$el.find(".upfront-settings-item-content").addClass("clearfix"),this.$el.find(".upfront-settings-item").prepend('<div class="login-general-settings-description clear-after">'+p.general_settings_description+"</div>")},get_title:function(){return p.appearance},register_change:function(){this.fields.each(function(t){t.property.set({value:t.get_value()},{silent:!1})}),this.trigger("login:appearance:changed")}}),v=(u.extend({className:"upfront_login-item-display_trigger",initialize:function(){var t=this;this.fields=_([new Upfront.Views.Editor.Field.Text({model:this.model,property:"trigger_text",label:p.log_in_trigger,change:function(){t.register_change(t)}})])},register_change:function(){this.fields.each(function(t){t.property.set({value:t.get_value()},{silent:!1})})},update:function(){var t=this.model.get_property_value_by_name("style");this.initialize(),this.$el.empty(),this.render(),"form"!=t&&this.$el.show()},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),this.$el.find(".upfront-settings-item-content").addClass("clearfix").end().hide(),this.$el.find(".upfront-settings-item-title").remove()},get_title:function(){return""}}),Upfront.Views.Editor.Sidebar.Element.extend({priority:160,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-login"),this.$el.html(p.element_name)},add_element:function(){var t=new d,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-login_element-module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(210)}],objects:[t]});this.add_module(e)}}));a.generatePresetsToPage("login",l),Upfront.Application.LayoutEditor.add_object("Login",{Model:d,View:c,Element:v,Settings:f,cssSelectors:{".upfront_login-form:not(.triggered)":{label:p.css.form_wrapper,info:p.css.form_wrapper_info},".upfront_login-form.triggered":{label:p.css.form_wrapper_triggered,info:p.css.form_wrapper_triggered_info},".upfront_login-form p:not(.login-lostpassword)":{label:p.css.containers,info:p.css.containers_info},".upfront_login-form form#loginform label, .upfront_login-form form#loginform p:not(.login-submit):not(.login-remember) input.upfront-input-labels":{label:p.css.labels,info:p.css.labels_info},".upfront_login-form form#loginform input:not([type=submit]):not([type=checkbox]):not(.upfront-input-labels)":{label:p.css.inputs,info:p.css.inputs_info},".upfront_login-form form#loginform input[type=submit], .upfront_login-form form#loginform p.login-submit input.upfront-input-labels":{label:p.css.button,info:p.css.button_info},".upfront_login-form form#loginform input[type=checkbox]":{label:p.css.remember,info:p.css.remember_info},".upfront_login-form p.login-lostpassword":{label:p.css.pwd_wrap,info:p.css.pwd_wrap_info},".upfront_login-form p .login-lostpassword-link, .upfront_login-form p .upfront-input-labels.lostpassword-link":{label:p.css.pwd_link,info:p.css.pwd_link_info},".upfront_login-trigger":{label:p.css.login_trigger,info:p.css.login_trigger_info}},cssSelectorsId:Upfront.data.upfront_login.defaults.type}),Upfront.Models.LoginModel=d,Upfront.Views.LoginView=c})}(jQuery),define("text!elements/upfront-maps/css/edit.css",[],function(){return'.upfront-editable_entity .ufm-gmap-container img {\r\n  max-width: none !important;\r\n  max-height: none !important;\r\n}\r\n.upfront_map-fields-simple_location .upfront-field-wrap-text {\r\n\tfloat: left;\r\n\twidth: 80%;\r\n}\r\n.upfront_map-fields-simple_location .upfront-field-wrap-refresh button {\r\n\twidth: 24px;\r\n\theight: 30px;\r\n\tborder: none;\r\n\tbackground: none;\r\n\tpadding: 0;\r\n}\r\n#settings .upfront-settings-item-maps_element-location .upfront-settings-item {\r\n\tborder: none;\r\n\tpadding-right: 0;\r\n}\r\n#settings .ufpront-maps_element-settings_panel .upfront-settings_panel {\r\n\twidth: 240px;\r\n}\r\n#settings .ufpront-maps_element-settings_panel .upfront-settings_panel .upfront-settings_panel_scroll {\r\n\tmin-width: 240px;\r\n}\r\n.ufpront-maps_element-settings_panel .upfront-settings-css .upfront-field-select-single {\r\n  width: 180px;\r\n}\r\n\r\n.ufpront-maps_element-settings_panel .upfront-field-select {\r\n\twidth: 100%;\r\n}\r\n\r\n.ufm-context-menu{\r\nbackground:white;\r\n-webkit-border-radius: 3px;\r\n-moz-border-radius: 3px;\r\nborder-radius: 3px;\r\n}\r\n.ufm-context-menu-item{\r\npadding:0px 10px;\r\n}\r\n\r\n.ufm-context-menu-item:hover{\r\nbackground:#f0f0f0;\r\n}\r\n\r\n.ufm-context-menu .ufm-context-menu-item:first-child{\r\n-webkit-border-top-left-radius: 3px;\r\n-webkit-border-top-right-radius: 3px;\r\n-moz-border-radius-topleft: 3px;\r\n-moz-border-radius-topright: 3px;\r\nborder-top-left-radius: 3px;\r\nborder-top-right-radius: 3px;\r\n}\r\n.ufm-context-menu .ufm-context-menu-item:last-child{\r\n-webkit-border-bottom-right-radius: 3px;\r\n-webkit-border-bottom-left-radius: 3px;\r\n-moz-border-radius-bottomright: 3px;\r\n-moz-border-radius-bottomleft: 3px;\r\nborder-bottom-right-radius: 3px;\r\nborder-bottom-left-radius: 3px;\r\n}\r\n\r\n.ufm-map-marker-select{\r\nposition:absolute;\r\nbackground:white;\r\nborder:1px solid #cccccc;\r\npadding:10px;\r\n}\r\n\r\n.ufm-map-marker-select .marker-url label{\r\ndisplay: block;\r\nline-height: 20px;\r\n}\r\n\r\n.ufm-map-marker-select .marker-url [name="marker-url"]{\r\nwidth:100%;\r\nheight:44px;\r\n}\r\n\r\n.ufm-map-marker-select .marker-url{\r\nmargin-top: 10px;\r\n}\r\n\r\n.ufm-marker-demo{\r\nwidth:38px;\r\nheight:38px;\r\nline-height: 35px;\r\nborder:1px solid transparent;\r\n\r\ntext-align:center;\r\ndisplay:inline-block;\r\n}\r\n.ufm-marker-demo img{\r\ndisplay:inline-block;\r\nvertical-align: middle;\r\n}\r\n.ufm-marker-demo:hover{\r\nborder: 1px solid #cccccc;\r\ncursor: pointer;\r\n}\r\n.ufm-marker-demo.ufm-current{\r\nborder: 1px dashed #cccccc;\r\n}\r\n.ufm-marker-demo.ufm-current:hover{\r\nborder: 1px solid red;\r\n}\r\n\r\n\r\n\r\n.ufm-rounded{\r\n-webkit-border-radius: 3px;\r\n-moz-border-radius: 3px;\r\nborder-radius: 3px;\r\n}\r\n\r\n\r\n/* override upfront styles that cause visual google maps bugs */\r\n.upfront-map_module .upfront-editable_entity img {\r\nmax-width: none;\r\n}\r\n\r\n.marker-imgs{\r\nmax-height:120px;\r\noverflow-x: auto;\r\n}\r\n\r\n/* triagnle pointer */\r\n.ufm-map-marker-select{\r\nposition: relative;\r\n}\r\n.ufm-map-marker-select:after{\r\ncontent: \'\';\r\ndisplay: block;\r\nposition: absolute;\r\ntop: -20px;\r\nleft: 159px;\r\nwidth: 0;\r\nheight: 0;\r\nborder-color: transparent transparent #ffffff transparent;\r\nborder-style: solid;\r\nborder-width: 10px;\r\n}\r\n\r\n.ufm-map-marker-select:before{\r\ncontent: \'\';\r\ndisplay: block;\r\nposition: absolute;\r\ntop: -23px;\r\nleft: 158px;\r\nwidth: 0;\r\nheight: 0;\r\nborder-color: transparent transparent #cccccc transparent;\r\nborder-style: solid;\r\nborder-width: 11px;\r\n}\r\n\r\n.ufm-map-main img {\r\n\theight: auto;\r\n\twidth: auto;\r\n}\r\n\r\n/* initial experience layout */\r\n#upfront_map-location_overlay-wrapper, .upfront_map-api_key_element {\r\n    box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.50);\r\n}\r\n\r\n#upfront_map-location_overlay-wrapper,\r\n.uf_el_map_initial-overlay {\r\n\tfont-weight: 200;\r\n\tfont-size:20px;\r\n}\r\n\r\n.uf_el_map_initial-overlay {\r\n\theight: 125px;\r\n\tpadding: 15px;\r\n\tmargin: auto;\r\n}\r\n\r\n/* api key warning */\r\n\r\n.upfront_map-api_key_region {\r\n    margin: auto;\r\n\tbox-shadow: none;\r\n\tbackground-color: #fff;\r\n}\r\n\r\n.upfront_map-api_key_region #upfront_map-api_key_overlay {\r\n    height: 145px;\r\n}\r\n\r\n#upfront_map-api_key_overlay {\r\n    max-width: 530px;\r\n\tline-height: 1.5;\r\n\tbackground: transparent;\r\n\theight: 115px;\r\n\tfont-family: "Open Sans", "Helvetica Neueu", Helvetica, Arial, sans-serif;\r\n}\r\n.upfront-icon-map-warning:before {\r\n\tcontent: \' \';\r\n\tbackground-position: -480px -202px;\r\n}\r\n.upfront-ui .upfront-icon-map-warning {\r\n    position: relative;\r\n    top: -10px;\r\n    margin: auto;\r\n}\r\n#upfront_map-api_key_overlay-instruction {\r\n    margin-bottom: 0px;\r\n    margin-top: 0px;\r\n}\r\n#upfront_map-location_overlay-instruction {\r\n    margin-top: 5px;\r\n}\r\n\r\n/* address input */\r\n.uf_el_map_initial-overlay input[type="text"] {\r\n\tbackground:rgb(201,201,195);\r\n\tfont-size: 1em;\r\n\twidth:100%;\r\n}\r\n.uf_el_map_initial-overlay input[type="text"]:focus {\r\n\tbackground:rgb(255,255,255);\r\n\tcolor:rgb(100,100,100);\r\n\tfont: 1px solid #d0d0d0;\r\n}\r\n\r\n/* refresh button */\r\n.uf_el_map_initial-overlay button {\r\n\tposition: absolute;\r\n\ttop: 4px;\r\n\tright: 0;\r\n\tbackground-color: transparent;\r\n\tpadding: 10px;\r\n\tcolor: rgba(218,224,230,1);\r\n}\r\n\r\n.uf_el_map_initial-overlay button ,\r\n.uf_el_map_initial-overlay .uf-current-location {\r\n\tmargin:0;\r\n}\r\n\r\n.uf_el_map_initial-overlay .uf-address  {\r\n\tmargin: 1rem auto;\r\n\tmax-width: 520px;\r\n\tposition: relative;\r\n}\r\n\r\n.upfront-ui.uf-address input {\r\n    height: 50px;\r\n\tbackground: rgba(237,240,242,1);\r\n}\r\n\r\n.uf-current-location {\r\n\tfont-size: 0.8em;\r\n\tmargin-top:10px;\r\n}\r\n/* Use My Location */\r\n#upfront_map-api_key_overlay a,\r\n.uf-current-location a {\r\n\tbackground:transparent;\r\n\tcolor: rgba(31,205,143,1);\r\n\ttext-decoration: underline;\r\n\tpadding:0;\r\n\tmargin:0;\r\n\tfont-weight: 400;\r\n}\r\n.uf-current-location a:hover { cursor: pointer; }\r\n\r\n.uf_el_map_initial-overlay button,\r\n.uf_el_map_initial-overlay input { outline:none; }\r\n\r\n/* Missing default styles */\r\n.uf_el_map_initial-overlay input {\r\n\tpadding: 10px;\r\n\tborder: 1px solid #d0d0d0;\r\n}\r\n.uf_el_map_initial-overlay button {\r\n\tborder: 0;\r\n\tborder-radius: 2px;\r\n\tcursor: pointer;\r\n}\r\n\r\n/* Check your internet connection message */\r\n\r\n.ufm-gmap-container {\r\n\tbackground-color: rgb(227, 227, 220);\r\n\tdisplay:table;\r\n}\r\n\r\n.ufm-gmap-container p {\r\n\tdisplay: table-cell;\r\n\tvertical-align: middle;\r\n\ttext-align: center;\r\n}\r\n\r\n.ufm-gmap-container .upfront-util-icon:before {\r\n\tcontent: " ";\r\n\twidth:40px;\r\n\theight:40px;\r\n\tbackground-position: -472px -193px;\r\n\tbackground-color: rgb(255, 255, 255);\r\n\tposition: absolute;\r\n\ttop:15px;\r\n\tleft:15px;\r\n}\r\n\r\n.map_location {\r\n\tmargin-top: 10px;\r\n}\r\n\r\n.map-style, .map-zoom-level {\r\n\twidth: 225px;\r\n}\r\n\r\n.open-map-code-panel-button {\r\n\tmargin-top: -5px;\r\n\tpadding: 5px 0px 5px 10px;\r\n\tposition: relative;\r\n\ttop: 0px;\r\n\tborder-left: 2px solid #dae6f2;\r\n}\r\n\r\n/* this is required for the code panel button when map is used for a region\'s background */\r\n.uf-bgsettings-mapitem .open-map-code-panel-button {\r\n\tfloat:left;\r\n}\r\n\r\n.upfront_map-fields-simple_location .upfront-field-wrap-refresh button {\r\n\tbackground-image: linear-gradient(-179deg, #fafdff 0%, #f3faff 100%) !important;\r\n    border: 1px solid #a2bfda;\r\n\tborder-left: none;\r\n\theight: 26px;\r\n\twidth: 30px;\r\n}\r\n\r\n.draggable-checkbox {\r\n\tmargin-top: 15px;\r\n}\r\n\r\n.upfront_map-fields-simple_location .upfront-field-wrap-refresh button img {\r\n\topacity: 0.7;\r\n\twidth: 15px;\r\n\tmargin-top: 3px;\r\n}\r\n\r\n.upfront_map-fields-simple_location .upfront-field-wrap-text {\r\n\twidth: 84% !important;\r\n}\r\n\r\n.open-map-code-panel-button {\r\n\tmargin-top: -5px;\r\n\tpadding: 5px 0px 5px 10px;\r\n\tposition: relative;\r\n\ttop: 0px;\r\n\tborder-left: 2px solid #dae6f2;\r\n}\r\n\r\n.open-map-code-panel-button input {\r\n\tdisplay: inline-block;\r\n\theight: 26px;\r\n\tmax-height: 26px;\r\n\tborder-radius: 3px;\r\n\tfont-size: 11px;\r\n\tfont-weight: normal;\r\n\tfont-family: verdana, sans-serif;\r\n\tbackground-image: linear-gradient(-179deg, #fafdff 0%, #f3faff 100%);\r\n    border: 1px solid #a2bfda;\r\n    border-radius: 5px;\r\n    color: #6486a6;\r\n    padding: 4px 8px;\r\n    position: relative;\r\n}\r\n\r\n.open-map-code-panel-button input:hover {\r\n\tborder: 1px solid #a2bfda;\r\n}\r\n'}),define("text!upfront/templates/api_key_overlay_element.html",[],function(){return'<div id="upfront_map-api_key_overlay-wrapper" class="upfront-initial-overlay-wrapper upfront_map-api_key_element">\n\t<div id="upfront_map-api_key_overlay" class="uf_el_map_initial-overlay upfront-initial-overlay-wrapper">\n\t\t<div class="upfront-ui">\n\t\t\t<button type="button" class="upfront-field-icon upfront-icon-map-warning"></button>\n\t\t</div>\n\t\t<p id="upfront_map-api_key_overlay-instruction">\n\t\t\t{{Upfront.Settings.l10n.maps_element.api_key_empty}}\n\t\t\t<a href="{{Upfront.Settings.l10n.maps_element.api_key_url}}" target="_blank" data-bypass="true">\n \t\t\t \t{{Upfront.Settings.l10n.maps_element.here}}\n\t\t\t</a>\n\t\t</p>\n\t</div>\n</div>\n'}),function(t){define("upfront_maps",["maps_context_menu","text!elements/upfront-maps/css/edit.css","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/inline-panels/map-editor","text!upfront/templates/api_key_overlay_element.html"],function(e,i,n,o,r,s){var a={OPTIMUM_MAP_HEIGHT:300,center:[-37.818,144.976],zoom:10,style:"ROADMAP",use_custom_map_code:!1,controls:{pan:!1,zoom:!1,map_type:!1,scale:!1,street_view:!1,overview_map:!1}},l=Upfront.Settings.l10n.maps_element;t("head").append("<style>"+i+"</style>");var p=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.umaps.defaults);a.center=t.map_center,navigator&&navigator.geolocation&&delete t.map_center,t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),d=(Upfront.Views.Editor.Field.Checkboxes.extend({multiple:!1}),Upfront.Views.Editor.Field.Text.extend({className:"upfront-field-wrap upfront-field-wrap-refresh",events:function(){return _.extend({},Upfront.Views.Editor.Field.Text.prototype.events,{click:"propagate_activation_request"})},get_field_html:function(){return'<button type="button"><img src="'+Upfront.data.upfront_maps.root_url+'img/refresh.png" /></button>'},propagate_activation_request:function(t){t.preventDefault(),t.stopPropagation(),this.trigger("refresh")}})),c=Backbone.View.extend({className:"upfront_map-fields-simple_location map_location clearfix",events:{keypress:"wait_for_enter"},initialize:function(t){this.options=t,this.model instanceof p||(this.model=new p({properties:this.model.get("properties")}));var e=_.extend({},t);this.options.field=new Upfront.Views.Editor.Field.Text(e),this.options.locate=new d(e),this.property=this.options.field.property,this.options.locate.on("refresh",this.geocode,this),this.model.on("options:location:geocode",this.geocode,this)},wait_for_enter:function(t){13==t.which&&(t.stopPropagation(),t.preventDefault(),this.geocode())},render:function(){this.$el.empty(),this.options.locate.render(),this.options.field.render();var t=this.model.get_property_value_by_name("address")||"";this.options.field.set_value(t),this.$el.append(this.options.field.$el),this.$el.append(this.options.locate.$el)},get_value:function(){return this.options.field.get_value()},get_saved_value:function(){return this.options.field.get_saved_value()},geocode:function(){if("undefined"==typeof window.google)return!1;var e=this.options.field.get_value(),i=this.model.get_property_value_by_name("element_id"),n=t(document).data(i+"-location"),o=this.model.get_property_value_by_name("address"),r=new google.maps.Geocoder,s=this;return!(!e||e===n)&&(!!(window._upfront_api_keys||{}).gmaps&&(e!==o&&(!this._geocoding_in_progress&&(this._geocoding_in_progress=!0,void r.geocode({address:e},function(n,o){if(o!=google.maps.GeocoderStatus.OK)return s._geocoding_in_progress=!1,!1;var r=n[0].geometry.location,a=s.model.get_property_value_by_name("markers")||[];a.push({lat:r.lat(),lng:r.lng()}),s.model.set_property("markers",a,!0),s.model.set_property("address",e,!0),s.model.set_property("map_center",[r.lat(),r.lng()],!1),t(document).data(i+"-location",e),s._geocoding_in_progress=!1})))))}}),u=Upfront.Views.ObjectView.extend({map:!1,init:function(){this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.refresh_map)},on_element_resize:function(t){this.refresh_map()},on_render:function(){this.update_properties();var t=this,e=this.$el.find(".ufm-gmap-container:first"),i=this.model.get_breakpoint_property_value("row",!0)?this.model.get_breakpoint_property_value("row",!0):this.parent_module_view.model.get_breakpoint_property_value("row",!0),n=this.model.get_property_value_by_name("controls")||[],o={center:this.model.get_property_value_by_name("map_center")||a.center,zoom:parseInt(this.model.get_property_value_by_name("zoom"),10)||a.zoom,type:this.model.get_property_value_by_name("style")||a.style,panControl:n.indexOf("pan")>=0||a.controls.pan,zoomControl:n.indexOf("zoom")>=0||a.controls.zoom,mapTypeControl:n.indexOf("map_type")>=0||a.controls.map_type,scaleControl:n.indexOf("scale")>=0||a.controls.scale,streetViewControl:n.indexOf("street_view")>=0||a.controls.street_view,overviewMapControl:n.indexOf("overview_map")>=0||a.controls.overview_map,style_overlay:!!this.model.get_property_value_by_name("use_custom_map_code")&&(JSON.parse(this.model.get_property_value_by_name("map_styles"))||!1),draggable:!!this.model.get_property_value_by_name("draggable"),scrollwheel:!!this.model.get_property_value_by_name("scrollwheel")};i=i?parseInt(i,10)*Upfront.Settings.LayoutEditor.Grid.baseline:a.OPTIMUM_MAP_HEIGHT,e.css({width:"100%",height:i+"px"}),e.on("click mousedown mouseup",function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}),"undefined"!=typeof window.google?(this.map=new google.maps.Map(e.get(0),{center:new google.maps.LatLng(o.center[0],o.center[1]),zoom:o.zoom,mapTypeId:google.maps.MapTypeId[o.type],panControl:o.panControl,zoomControl:o.zoomControl,mapTypeControl:o.mapTypeControl,scaleControl:o.scaleControl,streetViewControl:o.streetViewControl,overviewMapControl:o.overviewMapControl,draggable:o.draggable,scrollwheel:o.scrollwheel}),o.style_overlay&&this.map.setOptions({styles:o.style_overlay}),!this.model.get_property_value_by_name("map_center")&&(window._upfront_api_keys||{}).gmaps&&this.add_location_overlay(),(!(window._upfront_api_keys||{}).gmaps&&Upfront.Application.user_can_modify_layout()||"undefined"!=typeof google_maps_auth_error)&&this.add_api_key_overlay(),setTimeout(function(){var e=t.map.getCenter();google.maps.event.trigger(t.map,"resize"),t.map.setCenter(e)},300),this.add_stored_markers(),this.init_rightclick_context_menu()):e.html("<p class='upfront-util-icon'>"+l.connectivity_warning+"</p>")},refresh_map:function(){var t=this.$el.find(".ufm-gmap-container:first"),e=this.model.get_breakpoint_property_value("row",!0)?this.model.get_breakpoint_property_value("row",!0):this.parent_module_view.model.get_breakpoint_property_value("row",!0);e=e?parseInt(e,10)*Upfront.Settings.LayoutEditor.Grid.baseline:a.OPTIMUM_MAP_HEIGHT,t.css({height:e+"px"}),google.maps.event.trigger(this.map,"resize")},add_api_key_overlay:function(){this.el.querySelector(".upfront-map_element-object").style.opacity=0,this.$el.append(_.template(s))},add_location_overlay:function(){var e=this,i=this.$el.find("#upfront_map-location_overlay-wrapper");!i.length&&Upfront.Application.user_can_modify_layout()?(this.el.querySelector(".upfront-map_element-object").style.opacity=0,this.$el.append('<div id="upfront_map-location_overlay-wrapper" class="upfront-initial-overlay-wrapper"><div id="upfront_map-location_overlay" class="uf_el_map_initial-overlay upfront-initial-overlay-wrapper"><p id="upfront_map-location_overlay-instruction">'+l.instructions+'</p><div id="upfront_map-location_overlay-address" class="upfront-ui uf-address"><input type="text" id="upfront_map-location_overlay-location"/><button type="button" id="upfront_map-location_overlay-use_location" class="upfront-field-icon upfront-icon-map-refresh"></button></div><span class="uf-current-location">'+l.or+' <a id="upfront_map-location_overlay-use_current">'+l.use_current_location+"</a></span></div></div>"),i=this.$el.find("#upfront_map-location_overlay-wrapper")):Upfront.Application.user_can_modify_layout()||this.$el.empty(),i.find("#upfront_map-location_overlay-use_location").off("click").on("click",function(){var i=e.$el.find("#upfront_map-location_overlay-wrapper #upfront_map-location_overlay-location"),n=new google.maps.Geocoder,o=e.model.get_property_value_by_name("element_id"),r=i.length?i.val():"";return!(!r||!(window._upfront_api_keys||{}).gmaps)&&void n.geocode({address:r},function(i,n){if(n!=google.maps.GeocoderStatus.OK)return!1;var s=i[0].geometry.location,a=e.model.get_property_value_by_name("markers")||[];a.push({lat:s.lat(),lng:s.lng()}),e.model.set_property("markers",a,!0),e.model.set_property("address",r,!0),e.model.set_property("map_center",[s.lat(),s.lng()],!1),t(document).data(o+"-location",location)})}).end().find("#upfront_map-location_overlay-location").off("keydown").on("keydown",function(t){13===t.which&&(i.find("#upfront_map-location_overlay-use_location").click(),Upfront.Events.trigger("upfront:element:edit:stop"))}).off("click").on("click",function(e){t(this).focus()}).end().off("dblclick").on("dblclick",function(t){t.preventDefault(),t.stopPropagation()});var n=i.find("#upfront_map-location_overlay-use_current");navigator&&navigator.geolocation?n.off("click").on("click",function(){if(!navigator||!navigator.geolocation)return!1;var t=e.model.get_property_value_by_name("markers")||[];navigator.geolocation.getCurrentPosition(function(i){t.push({lat:i.coords.latitude,lng:i.coords.longitude}),e.model.set_property("markers",t,!0),e.model.set_property("map_center",[i.coords.latitude,i.coords.longitude],!1)},function(){n.closest(".uf-current-location").text(l.unable_to_geolocate)})}):(n||{}).remove&&n.remove(),this.$el.find(".upfront-entity_meta").hide()},get_content_markup:function(){return'<div class="ufm-gmap-container"><p>'+l.hold_on+"</p></div>"},update_properties:function(){this.model.trigger("options:location:geocode")},center_map:function(t,e){var i=new google.maps.LatLng(t,e);this.map.setCenter(i),this.model.set_property("map_center",[t,e])},init_rightclick_context_menu:function(){var t={};t.classNames={menu:"ufm-context-menu",menuSeparator:"context_menu_separator"};var e=[];e.push({className:"ufm-context-menu-item",eventName:"center_map",label:l.menu.center_map}),e.push({className:"ufm-context-menu-item",eventName:"add_marker",label:l.menu.add_marker}),t.menuItems=e;var i=new ContextMenu(this.map,t);google.maps.event.addListener(this.map,"rightclick",function(t){i.show(t.latLng)});var n=this;google.maps.event.addListener(i,"menu_item_selected",function(t,e){switch(e){case"add_marker":n.add_marker(t.lat(),t.lng());break;case"center_map":n.center_map(t.lat(),t.lng())}})},init_marker_context_menu:function(t){var e={};e.classNames={menu:"ufm-context-menu",menuSeparator:"context_menu_separator"};var i=[];i.push({className:"ufm-context-menu-item",eventName:"remove_marker",label:l.menu.remove_marker}),i.push({className:"ufm-context-menu-item",eventName:"change_icon",label:l.menu.change_icon}),e.menuItems=i;var n=new ContextMenu(this.map,e);google.maps.event.addListener(t,"rightclick",function(t){n.show(t.latLng)});var o=this;google.maps.event.addListener(n,"menu_item_selected",function(e,i){switch(i){case"remove_marker":o.remove_map_marker(t);break;case"change_icon":o.show_icon_select(t)}})},add_marker:function(t,e){var i=this.model.get_property_value_by_name("markers")||[];i.push({lat:t,lng:e}),this.model.set_property("markers",i),this.add_map_marker({lat:t,lng:e})},update_marker:function(t){var e=this.model.get_property_value_by_name("markers")||[];_(e).each(function(i,n){i.lat===t.lat&&i.lng===t.lng&&(e[n]=t)}),this.model.set_property("markers",e)},add_map_marker:function(e){if(this.model.get_property_value_by_name("hide_markers"))return!1;var i=this,n=new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lng),draggable:!1,icon:e.icon?e.icon:"",map:this.map}),o=t('<div contenteditable="true">'+(e.content?e.content:l.edit_this)+"</div>"),r=new google.maps.InfoWindow({content:o.get(0)});n._raw=e,o.on("input",function(){e.content=o.text(),i.update_marker(e)}),e.is_open&&r.open(i.map,n),google.maps.event.addListener(n,"click",function(){e.is_open?(e.is_open=!1,r.close()):(r.open(i.map,n),e.is_open=!0),i.update_marker(e)}),this.init_marker_context_menu(n)},remove_map_marker:function(t){var e=t._raw,i=this.model.get_property_value_by_name("markers")||[],n=[];_(i).each(function(t,i){t.lat===e.lat&&t.lng===e.lng||n.push(t)}),this.model.set_property("markers",n),t.setMap(null)},add_stored_markers:function(){var t=this,e=this.model.get_property_value_by_name("markers")||[];_(e).each(function(e){t.add_map_marker(e)})},show_icon_select:function(t){var e=this.get_icon_select_overlay();this.icon_select_overlay=new e(this.map,t)},get_icon_select_overlay:function(e){function i(t,e){this.map=t,this.marker=e,this.div=null,this.setMap(t)}var n=(this.map,this);return i.prototype=new google.maps.OverlayView,i.prototype.onAdd=function(){var e=this,i=t('<div class="ufm-map-marker-select ufm-rounded"><div class="marker-imgs"></div><div class="marker-url"><label for="marker-url">'+l.image_url+'</label><textarea id="marker-url" name="marker-url" value="" rows="4"/></textarea></div></div>');this.div=i.get(0);var o=["POI.png","arts.png","bar.png","blue-dot.png","blue-pushpin.png","blue.png","bus.png","cabs.png","camera.png","campfire.png","campground.png","casetta_base.png","casetta_brown.png","casetta_green.png","casetta_red.png","casetta_yellow.png","caution.png","coffeehouse.png","convienancestore.png","cycling.png","dollar.png","drinking_water.png","earthquake.png","electronics.png","euro.png","fallingrocks.png","ferry.png","firedept.png","fishing.png","flag.png","gas.png","golfer.png","grocerystore.png","hiker.png","homegardenbusiness.png","hospitals.png","info_circle.png","man.png","marina.png","marker.png","plane.png","snack_bar.png","sportvenue.png","toilets.png","trail.png","tree.png","wheel_chair_accessible.png","woman.png"],r=Upfront.data.upfront_maps.markers,s="";_.each(o,function(t){s=s+'<div class="ufm-marker-demo ufm-rounded"> <img src="'+r+t+'" /> </div>'}),t(".marker-imgs",i).html(s),t(".marker-imgs img",i).on("click dblclick",function(){var e=t(this).parent(),i=e.hasClass("ufm-current")?"":t(this).attr("src");t("div",e.parent()).removeClass("ufm-current"),""!==i&&e.addClass("ufm-current"),a.val(i).trigger("change")}),t(".marker-imgs img",i).on("dblclick",function(){e.setMap(null)}),t(".marker-url button",i).click(function(){e.setMap(null)});var a=t('.marker-url [name="marker-url"]',i),p=this.marker.getIcon(),d="string"==typeof p?p:"";t('img[src="'+d+'"]',i).parent().addClass("ufm-current"),a.val(d),a.click(function(){this.focus()}),a.on("input propertychange change",function(){var i=t(this).val();i=""===i?null:i,(/png$/.test(i)||null===i)&&(e.marker._raw.icon=i,n.update_marker(e.marker._raw),e.marker.setIcon(i))});var c=function(t){t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()};google.maps.event.addDomListener(this.div,"click",c),google.maps.event.addDomListener(this.div,"dblclick",c),t(this.div).on("click mousedown mouseup",c);var u=function(t){e.setMap(null)};google.maps.event.addListener(this.map,"click",u),google.maps.event.addListener(this.map,"rightclick",u);var h=this.getPanes();h.floatPane.appendChild(this.div)},i.prototype.draw=function(){var t=this.getProjection(),e=this.marker.getPosition(),i=t.fromLatLngToDivPixel(e),n=this.div;n.style.left=i.x-170+"px",n.style.top=i.y+15+"px",n.style.width="320px"},i.prototype.onRemove=function(){this.div.parentNode.removeChild(this.div),this.div=null},i}}),h=Upfront.Views.Editor.Sidebar.Element.extend({priority:50,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-maps"),this.$el.html(l.element_name)},add_element:function(){var t=new p,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c12 upfront-map_element-module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(330)}],objects:[t]});this.add_module(e)}}),f=o.extend({title:l.general_settings,initialize:function(t){this.options=t,this.settings=_([new m({model:this.model}),new v({model:this.model}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})])},get_label:function(){return l.label},get_title:function(){return l.label}}),g=n.extend({panels:{Settings:f},title:l.settings}),m=Upfront.Views.Editor.Settings.Item.extend({className:"upfront-settings-item-maps_element-location general_settings_item",initialize:function(){this.fields=_([new c({model:this.model,hide_label:!0,property:"location"})])},get_title:function(){return l.location_label}}),v=Upfront.Views.Editor.Settings.Item.extend({events:{"click .open-map-code-panel-button":"init_code_panel"},className:"general_settings_item",initialize:function(){var e=[],i=this.model.get_property_value_by_name("zoom");i||this.model.set_property("zoom",a.zoom,!0),_(_.range(1,19)).each(function(t){e.push({label:t,value:t})});var n=this.model.get_property_value_by_name("style"),o=[{label:l.style.roadmap,value:"ROADMAP"},{label:l.style.satellite,value:"SATELLITE"},{label:l.style.hybrid,value:"HYBRID"},{label:l.style.terrain,value:"TERRAIN"}];n||this.model.set_property("style",a.style,!0);var r=[{label:l.ctrl.pan,value:"pan"},{label:l.ctrl.zoom,value:"zoom"},{label:l.ctrl.type,value:"map_type"},{label:l.ctrl.scale,value:"scale"},{label:l.ctrl.street_view,value:"street_view"},{label:l.ctrl.overview,value:"overview_map"}];this.fields=_([new Upfront.Views.Editor.Field.Slider({className:"upfront-field-wrap upfront-field-wrap-slider map-zoom-level",model:this.model,label:l.zoom_level,property:"zoom",min:1,max:19,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Select({model:this.model,label:l.map_style,className:"map-style",property:"style",values:o,change:function(){this.property.set({value:this.get_value()
})}}),new Upfront.Views.Editor.Field.Multiple_Chosen_Select({model:this.model,label:l.map_controls,placeholder:"Choose map controls",property:"controls",select_width:"225px",multiple:!0,values:r,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:l.draggable_map,property:"draggable",className:"draggable-checkbox",hide_label:!0,values:[{label:l.draggable_map,value:1}],multiple:!1,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:l.hide_markers,className:"markers-checkbox",property:"hide_markers",hide_label:!0,values:[{label:l.hide_markers,value:1}],multiple:!1,change:function(){this.property.set({value:this.get_value()})}}),new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:l.use_custom_map_code,property:"use_custom_map_code",className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes custom-map-code",hide_label:!0,values:[{label:l.use_custom_map_code+'<span class="checkbox-info" title="'+l.use_custom_map_code_info+'"></span>',value:1}],multiple:!1,change:function(){var t=this.get_value();this.property.set({value:t})},show:function(e,i){1==e?t(".open-map-code-panel-button",i.parent()).show():t(".open-map-code-panel-button",i.parent()).hide()}}),new Upfront.Views.Editor.Field.Button({model:this.model,label:l.open_map_code_panel,className:"open-map-code-panel-button",compact:!0})])},get_title:function(){return l.settings},init_code_panel:function(){var t=new r({model:this.model});t.render()}});Upfront.Application.LayoutEditor.add_object("Map",{Model:p,View:u,Element:h,Settings:g,cssSelectors:{".ufm-gmap-container":{label:l.css.label,info:l.css.info}},cssSelectorsId:Upfront.data.umaps.defaults.type}),Upfront.Models.MapModel=p,Upfront.Views.UmapView=u})}(jQuery),define("elements/upfront-newnavigation/js/menuitem",["scripts/upfront/link-model"],function(t){return function(e){var i=Upfront.Settings.l10n.newnavigation_element,n=Backbone.View.extend({tagName:"li",contextmenuContext:[],removeContexts:!0,events:{"click i.delete_menu_item":"deleteMenuItem","click i.navigation-add-item":"addMenuItem","contextmenu a.menu_item":"on_context_menu","click a.menu_item":"on_click","touchstart a.menu_item":"on_click","click a.redactor_act":"onOpenPanelClick","click .sub-menu":"onOpenPanelSubMenu","click .upfront-save_settings":"onOpenPanelSubMenu","click .upfront-save_settings":"processPanelsOnSave","click > .open-item-controls":"onOpenItemControlsClick",mouseover:"onItemOver",mouseout:"onItemOut"},initialize:function(e){var n=this;"undefined"==typeof e.model.link&&(e.model.link={type:Upfront.Util.guessLinkType(this.model["menu-item-url"]),url:this.model["menu-item-url"],target:this.model["menu-item-target"]}),this.link=new t(this.model.link),this.parent_view=e.parent_view,this.newitem=e.newitem,this.level=e.level,_.bindAll(this,"render");var o=Upfront.Views.ContextMenuList.extend({initialize:function(t){this.options=t,this.for_view=this.options.for_view,this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){var t=n.model.link.type;return"lightbox"==t?"Open Lightbox":"anchor"==t?"Scroll to Anchor":"entry"==t?"Visit Post/Page":"Visit Link"},action:function(){Upfront.Util.visitLink(n.model.link.url)}}),new Upfront.Views.ContextMenuItem({get_label:function(){return i.edit_url},action:function(){n.removeContexts=!1,n.editMenuItem()}}),new Upfront.Views.ContextMenuItem({get_label:function(){return i.create_dropdown},action:function(){n.removeContexts=!1,n.createDropDown(n.event)}})])}});this.ContextMenu=Upfront.Views.ContextMenu.extend({initialize:function(t){this.options=t,this.for_view=this.options.for_view,this.menulists=_([new o({for_view:this.for_view})])}}),Upfront.Events.on("entity:contextmenu:deactivate",this.remove_context_menu,this)},loadContexts:function(t){if(!(this.contextmenuContext.length>10)){var e=t.parent().parent("ul");e.length>0&&e.hasClass("sub-menu")&&(e.addClass("time_being_display"),this.contextmenuContext.push(e),this.loadContexts(e))}},on_click:function(t){var i=e(t.target).parent("li.menu-item");if(i.hasClass("parent")&&"burger"==i.closest(".upfront-output-unewnavigation").data("style")){t.stopPropagation(),i.hasClass("burger_sub_display")?i.removeClass("burger_sub_display"):i.addClass("burger_sub_display");var n=i.closest("ul.menu"),o=i.closest("div.upfront-output-unewnavigation");if("pushes"==o.data("burger_over")&&("top"==o.data("burger_alignment")||"whole"==o.data("burger_alignment"))){e("section.upfront-layout").css("margin-top",n.height());var r=e("div#upfront-ui-topbar").outerHeight(),s=e(".upfront-ruler-container").outerHeight();n.offset({top:r+s,left:e("section.upfront-layout").offset().left})}}},on_context_menu:function(t){Upfront.Settings.Application.no_context_menu||(t.stopPropagation(),this.parent_view.$el.find("ul.menu").hasClass("edit_mode")||(this.closeTooltip(),t.preventDefault(),e(t.target).closest("ul").hasClass("sub-menu")&&(this.contextmenuContext.push(e(t.target).closest("ul").addClass("time_being_display")),this.loadContexts(e(t.target).closest("ul"))),this.event=t,context_menu_view=new this.ContextMenu({model:this.model,for_view:this,el:e(Upfront.Settings.LayoutEditor.Selectors.contextmenu)}),this.context_menu_view=context_menu_view,context_menu_view.render()))},remove_context_menu:function(t){if(!this.context_menu_view)return!1;if(this.contextmenuContext.length>0){if(this.removeContexts)for(var i=0;i<this.contextmenuContext.length;i++)this.contextmenuContext[i].removeClass("time_being_display");this.contextmenuContext=[],this.removeContexts=!0}e(Upfront.Settings.LayoutEditor.Selectors.contextmenu).html("").hide(),this.context_menu_view=!1},onOpenPanelClick:function(t){t.preventDefault(),this.toggleLinkPanel()},onOpenPanelSubMenuClick:function(t){this.onOpenPanelSubMenu()},onOpenPanelSubMenu:function(){this.$el.hasClass("ui-sortable-handle")&&this.$el.children("ul").children("li").hasClass("controls-visible")?this.$el.children("ul").sortable("disable"):this.$el.addClass("ui-sortable-handle")},processPanelsOnSave:function(){this.parent_view.$el.find("ul.time_being_display").removeClass("time_being_display"),this.toggleLinkPanel(),this.$el.removeClass("controls-visible"),this.setItemControlsState()},toggleLinkPanel:function(){this.$el.hasClass("ui-sortable-handle")?(this.$el.removeClass("ui-sortable-handle"),this.$el.addClass("stayOpen controls-visible"),this.$el.parents(".menu").sortable("disable"),this.$el.find(".linkingPanelGoesHere").show()):(this.$el.addClass("ui-sortable-handle"),this.$el.removeClass("stayOpen"),this.$el.parents(".menu").sortable("enable"),this.$el.find(".linkingPanelGoesHere").hide())},render:function(t){var i=this,n='<a class="menu_item uf-click-to-edit-text',o=void 0!==typeof this.model.link.url?this.model.link.url.replace(Upfront.Settings.site_url,"").replace("/",""):"",r=Backbone.history.fragment;return i.newitem&&(n+=" new_menu_item menu_item_placeholder"),n=Upfront.Application.user_can_modify_layout()?n+'" ><span class="menu_item-ueditor">'+this.model["menu-item-title"]+'</span></a><i class="delete_menu_item">x</i><span class="open-item-controls"></span>':n+'" ><span class="menu_item-ueditor">'+this.model["menu-item-title"]+"</span></a>",this.model.link.url.indexOf("#ltb-")>-1&&!Upfront.Util.checkLightbox(this.model.link.url)&&(n+='<span class="missing-lightbox-warning"></span>'),e(this.el).html(n).addClass("menu-item-depth-"+i.level),o===r&&e(this.el).addClass("current-menu-item"),e(this.el).data("depth",i.level),this.createInlineControlPanel(),e(this.el).data("backboneview",i).addClass("menu-item"),i.newitem&&e(this.el).addClass("new_menu_item"),this},onOpenItemControlsClick:function(){var t=this.$el.parent("ul");"undefined"!=typeof t&&t.hasClass("time_being_display")&&t.removeClass("time_being_display"),this.$el.toggleClass("controls-visible"),this.setItemControlsState()},setItemControlsState:function(){if(this.$el.hasClass("controls-visible")){this.controlsVisible=!0,this.$el.siblings().removeClass("controls-visible"),this.$el.data("linkpanel").render(),this.$el.parents(".menu").sortable("disable");for(var t=this.$el.closest("ul");t.length>0&&t.hasClass("sub-menu");)t.addClass("time_being_display"),t=t.parent().parent("ul");var i=this.$el.closest(".upfront-region-container"),n=e(".upfront-region-container").not(".upfront-region-container-shadow").last();n.get(0)==i.get(0)&&i.addClass("upfront-last-region-padding")}else this.controlsVisible=!1,0===this.$el.parents(".menu").find(".controls-visible").length&&this.$el.parents(".menu").sortable("enable"),this.$el.closest(".upfront-region-container").removeClass("upfront-last-region-padding")},createInlineControlPanel:function(){var t=new Upfront.Views.Editor.InlinePanels.ControlPanel,e=new Upfront.Views.Editor.InlinePanels.Controls.VisitLink({url:this.model.link.url}),i=new Upfront.Views.Editor.InlinePanels.Controls.LinkPanel({model:this.link,button:!1,icon:"link",tooltip:"link",id:"link"}),n=this;t.items=_([i,e]),this.listenTo(this.link,"change",function(){n.model.link=n.link.toJSON(),n.model["menu-item-url"]=n.model.link.url,n.model["menu-item-target"]=n.model.link.target,e.setLink(n.model.link.url,n.model.link.type),n.saveLink()}),this.$el.data("linkpanel",i);var o='<div class="uimage-controls image-element-controls upfront-ui"></div>';this.$el.append(o),t.render(),this.$el.find(".uimage-controls").append(t.el),t.delegateEvents()},createDropDown:function(t){var i=e("<ul>").addClass("sub-menu").addClass("time_being_display");e(t.target).closest("li").append(i),this.parent_view.addMenuItem(i),this.parent_view.makeSortable()},addMenuItem:function(t){t.preventDefault(),t.stopPropagation(),this.parent_view.addMenuItem(t)},deleteMenuItem:function(t){var e=this,i=e.$el.parent("ul"),n=e.$el.parent("ul").find("i.navigation-add-item"),o=!1,r=this.parent_view;e.$el.siblings().length<1&&(o=!0);var s=r.new_menu_order(e.model["menu-item-db-id"]);this.closeTooltip(),e.$el.remove(),o&&i.remove(),i.children("li:last").append(n),"undefined"!=typeof e.model["menu-item-db-id"]&&Upfront.Util.post({action:"upfront_new_delete_menu_item",menu_item_id:e.model["menu-item-db-id"],new_menu_order:s}).success(function(t){e.$el.find("ul.sub-menu").length>0&&r.render()}).error(function(t){Upfront.Util.log("Error Deleting Menu Item")}),setTimeout(function(){Upfront.Events.trigger("menu_element:edit")},100)},editMenuItem:function(){console.log("toggleLinkPanel"),this.toggleLinkPanel()},getCleanurl:function(t){var e;return t||(t=location.href),t.indexOf("?dev=true")!=-1&&(t=t.replace("?dev=true","")),t.indexOf("#")==-1?t:(e=t.split("#"),""!==e[0].trim()?e[0]:location.href.replace("?dev=true",""))},saveLink:function(t,i){var n=this;if("undefined"!=typeof t&&t)return void n.deleteMenuItem();n.$el.find("a.new_menu_item").removeClass("new_menu_item"),n.$el.removeClass("new_menu_item");var o=e(this.el).children("a.menu_item").length>0?e(this.el).children("a.menu_item"):e(this.el).children("div").children("a.menu_item");if(!o.hasClass("menu_item_placeholder")&&o.next("a.ueditor-placeholder").length<1?this.model["menu-item-title"]=o.text():this.model["menu-item-title"]="",e(this.el).children("div.redactor_box").length>0&&o.blur(),""===n.model["menu-item-title"].trim()){if("undefined"==typeof i||!i)return void n.deleteMenuItem();var r=o.next("a.ueditor-placeholder").text()||(o.is("a.menu_item_placeholder")?o.text():"");n.model["menu-item-title"]=r}var s={action:"upfront_new_update_menu_item",menu:n.parent_view.model.get_property_value_by_name("menu_id"),"menu-item":this.model};"undefined"!=typeof this.model["menu-item-db-id"]&&(s["menu-item-id"]=n.model["menu-item-db-id"]),Upfront.Util.post(s).success(function(t){n.model["menu-item-db-id"]=t.data}).error(function(t){Upfront.Util.log("Error updating menu item")})},openTooltip:function(t,i){var n=e("#unewnavigation-tooltip"),o=i.offset(),r={top:o.top+i.outerHeight()+11,left:o.left-98+Math.floor(i.outerWidth()/2)},s="unewnavigation-tooltip-bottom",a=this;n.length||(n=e('<div id="unewnavigation-tooltip" class="upfront-ui"></div>'),e("body").append(n)),n.hide().html(t),o.right=o.left+i.width(),o.left-280<0&&(r.left=o.left+i.width()+20,s="unewnavigation-tooltip-bottom"),n.css(r).addClass(s).show().on("click",function(t){t.stopPropagation()}).on("closed",function(t){a.$el.removeClass("tooltip-open")}),this.$el.addClass("tooltip-open"),val=e("#unewnavigation-tooltip").find("input[name=unavigation-link-type]:checked").val(),"anchor"==val&&this.addAnchorsselect(),"lightbox"==val&&this.addLightboxselect(),Upfront.Events.trigger("entity:settings:deactivate")},closeTooltip:function(){var t=e("#unewnavigation-tooltip");t.hide().trigger("closed"),setTimeout(function(){t.remove()},100)},onItemOver:function(){this.$el.parents(".upfront-module").find(".upfront-resize-handle-s").addClass("active-menu-item")},onItemOut:function(){this.$el.parents(".upfront-module").find(".upfront-resize-handle-s").removeClass("active-menu-item")}});return n}(jQuery)}),define("elements/upfront-newnavigation/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.unewnavigation.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}});return t}),define("elements/upfront-newnavigation/js/element",["elements/upfront-newnavigation/js/model"],function(t){var e=Upfront.Settings.l10n.newnavigation_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:60,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-nav"),this.$el.html(e.element_name)},add_element:function(){var e=new t,i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-newnavigation_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(75)}],objects:[e]});this.add_module(i)}});return i}),define("text!elements/upfront-newnavigation/tpl/preset-style.html",[],function(){return"#page div.<?php echo $properties['id'] ?> ul.menu {\n\t<?php if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['desktop']) && !empty($properties['breakpoint']['desktop']['menu_alignment'])) { ?>\n\t\ttext-align: <?php echo $properties['breakpoint']['desktop']['menu_alignment'] ?>;\n\t<?php } else if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['tablet']) && !empty($properties['breakpoint']['tablet']['menu_alignment'])) { ?>\n\t\ttext-align: <?php echo $properties['breakpoint']['tablet']['menu_alignment'] ?>;\n\t<?php } else if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['mobile']) && !empty($properties['breakpoint']['mobile']['menu_alignment'])) { ?>\n\t\ttext-align: <?php echo $properties['breakpoint']['mobile']['menu_alignment'] ?>;\n\t<?php } else { ?>\n\t\ttext-align: <?php echo $properties['menu_alignment'] ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item a {\n\t<?php if(!empty($properties['static-nav-bg'])) { ?>\n\tbackground: <?php echo $properties['static-nav-bg'] ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item a:hover,\n#page .<?php echo $properties['id'] ?>.live-preview-hover ul.menu > li.menu-item a {\n\t<?php if(!empty($properties['hover-use-color']) && $properties['hover-use-color'] == 'yes' && !empty($properties['hover-nav-bg'])) { ?>\n\tbackground: <?php echo $properties['hover-nav-bg'] ?>;\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item a:focus,\n#page .<?php echo $properties['id'] ?>.live-preview-focus ul.menu > li.menu-item a {\n\t<?php if(!empty($properties['focus-use-color']) && $properties['focus-use-color'] == 'yes' && !empty($properties['focus-nav-bg'])) { ?>\n\tbackground: <?php echo $properties['focus-nav-bg'] ?>;\n\t<?php } ?>\n}\n\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item a,\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item > .redactor-box a {\n\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item a:hover,\n#page .<?php echo $properties['id']  ?>.upfront-navigation.live-preview-hover ul.menu > li.menu-item a {\n\t<?php if(!empty($properties['hover-use-typography'])) { ?>\n\t\t<?php if(!empty($properties['hover-font-color'])) { ?>color: <?php echo $properties['hover-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover-font-family'])) { ?>font-family: <?php echo $properties['hover-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover-font-size'])) { ?>font-size: <?php echo $properties['hover-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover-weight'])) { ?>font-weight: <?php echo $properties['hover-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover-style'])) { ?>font-style: <?php echo $properties['hover-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover-line-height'])) { ?>line-height: <?php echo $properties['hover-line-height']  ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n\n#page .<?php echo $properties['id'] ?> ul.menu > li.menu-item a:focus,\n#page .<?php echo $properties['id']  ?>.upfront-navigation.live-preview-focus ul.menu > li.menu-item a {\n\t<?php if(!empty($properties['focus-use-typography'])) { ?>\n\t\t<?php if(!empty($properties['focus-font-color'])) { ?>color: <?php echo $properties['focus-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus-font-family'])) { ?>font-family: <?php echo $properties['focus-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['focus-font-size'])) { ?>font-size: <?php echo $properties['focus-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['focus-weight'])) { ?>font-weight: <?php echo $properties['focus-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus-style'])) { ?>font-style: <?php echo $properties['focus-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['focus-line-height'])) { ?>line-height: <?php echo $properties['focus-line-height']  ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n\n<?php if(!empty($properties['tablet'])) { ?>\n#page.tablet-breakpoint div.<?php echo $properties['id'] ?> ul.menu {\n\t<?php if(!empty($properties['tablet']['menu_alignment'])) { ?>text-align: <?php echo $properties['tablet']['menu_alignment'] ?>;<?php } ?>\n}\n<?php if(!empty($properties['tablet']['preset_style'])) { ?><?php echo $properties['tablet']['preset_style'] ?><?php } ?>\n<?php } ?>\n\n<?php if(!empty($properties['mobile'])) { ?>\n#page.mobile-breakpoint div.<?php echo $properties['id'] ?> ul.menu {\n\t<?php if(!empty($properties['mobile']['menu_alignment'])) { ?>text-align: <?php echo $properties['mobile']['menu_alignment'] ?>;<?php } ?>\n}\n<?php if(!empty($properties['mobile']['preset_style'])) { ?><?php echo $properties['mobile']['preset_style'] ?><?php } ?>\n<?php } ?>\n\n<?php if(!empty($properties['breakpoint']) && !empty($properties['breakpoint']['desktop']) && !empty($properties['breakpoint']['desktop']['preset_style'])) { ?>\n\t<?php if(!empty($properties['breakpoint']['desktop']['preset_style'])) { ?><?php echo $properties['breakpoint']['desktop']['preset_style'] ?><?php } ?>\n<?php } else { ?>\n\t<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n<?php } ?>"}),define("elements/upfront-newnavigation/js/settings/appearance-panel",["scripts/upfront/preset-settings/util","text!elements/upfront-newnavigation/tpl/preset-style.html"],function(t,e){var i=Upfront.Settings.l10n.newnavigation_element,n={mainDataCollection:"navPresets",styleElementPrefix:"nav-preset",ajaxActionSlug:"nav",panelTitle:i.settings,presetDefaults:Upfront.mainData.presetDefaults.nav,styleTpl:e,stateModules:{Global:[{moduleType:"MenuStyle",options:{title:i.panel.menu_kind_label,state:"global"}}],Static:[{moduleType:"Typography",options:{title:i.panel.typography_label,state:"static",toggle:!1,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"}}},{moduleType:"Colors",options:{title:i.panel.colors_label,multiple:!1,single:!0,abccolors:[{name:"static-nav-bg",label:i.panel.item_background_label}]}}],Hover:[{moduleType:"Typography",options:{title:i.panel.typography_label,state:"hover",toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"}}},{moduleType:"Colors",options:{title:i.panel.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-color"},abccolors:[{name:"hover-nav-bg",label:i.panel.item_background_label}]}}],Focus:[{moduleType:"Typography",options:{title:i.panel.typography_label,state:"focus",toggle:!0,prepend:"focus-",prefix:"static",fields:{use:"focus-use-typography",typeface:"focus-font-family",fontstyle:"focus-font-style",weight:"focus-weight",style:"focus-style",size:"focus-font-size",line_height:"focus-line-height",color:"focus-font-color"}}},{moduleType:"Colors",options:{title:i.panel.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"focus-",prefix:"static",fields:{use:"focus-use-color"},abccolors:[{name:"focus-nav-bg",label:i.panel.item_background_label}]}}]},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-navigation\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")},migratePresetProperties:function(t){var e={};this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),e.breakpoint?(e.breakpoint.desktop&&("yes"===e.breakpoint.desktop.burger_menu&&(e.breakpoint.desktop.menu_style="burger"),delete e.breakpoint.desktop.burger_menu),e.breakpoint.tablet&&("yes"===e.breakpoint.tablet.burger_menu&&(e.breakpoint.tablet.menu_style="burger"),delete e.breakpoint.tablet.burger_menu),e.breakpoint.mobile&&("yes"===e.breakpoint.mobile.burger_menu&&(e.breakpoint.mobile.menu_style="burger"),delete e.breakpoint.mobile.burger_menu)):e.breakpoint={desktop:{},tablet:{},mobile:{}},t.set({breakpoint:e.breakpoint})}};return t.generatePresetsToPage("nav",e),n}),define("elements/upfront-newnavigation/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","elements/upfront-newnavigation/js/settings/appearance-panel","elements/upfront-newnavigation/js/menu-util"],function(t,e,i,n){var o=Upfront.Settings.l10n.newnavigation_element,r=function(){return _.union([{label:o.create_new,value:-1}],n.getSelectMenuOptions())},s=e.extend({className:"upfront-settings_panel_wrap menu-settings",title:o.mnu.title,initialize:function(t){var e=this;this.constructor.__super__.initialize.call(this,t),Upfront.Events.on("menu_element:menu_created",function(t){var i=e.getSelectMenuField();i.options.values=r(),i.render(),i.set_value(t.term_id)}),this.listenTo(this.model.get("properties"),"change",function(t){if(t&&("menu_slug"===t.get("name")||"menu_id"===t.get("name"))){var i=e.getSelectMenuField();i.set_value(e.model.get("properties").findWhere({name:"menu_id"}).get("value"))}})},getSelectMenuField:function(){var t=this.settings.findWhere({identifier:"selectMenuModule"});return t.fields.findWhere({identifier:"selectMenuField"})},settings:[{type:"SettingsItem",identifier:"selectMenuModule",className:"select-menu-box select-presets",fields:[{type:"Select",property:"menu_id",label:o.mnu.load,className:"select-menu-field",identifier:"selectMenuField",values:r,change:function(t,e){if(t==-1)return e.model.set_property("menu_slug",!1,!0),e.model.set_property("menu_id",!1),void e.$el.find(".select-menu-box").addClass("create-new");e.$el.find(".select-menu-box").removeClass("create-new");var i=n.getMenuSlugById(t);e.model.set_property("menu_id",t,!0),e.model.set_property("menu_slug",i)}},{type:"Button",label:o.mnu.delete_menu,className:"delete-menu-button delete_preset",on_click:function(){if(confirm(o.are_you_sure_nag)){var t=this.model.get_property_value_by_name("menu_id");Upfront.Events.trigger("menu_element:delete",t);var e=this.panel.getSelectMenuField();e.options.values=r(),e.render(),e.set_value("-1")}}}]},{type:"MenuStructure",identifier:"menuStructureModule"}],save_settings:function(){this.setSelectedBreakpointMenu(),Upfront.Events.trigger("menu_element:settings:saving"),s.__super__.save_settings.apply(this,arguments),this.model.set_property("menu_items",!1,!0)},setSelectedBreakpointMenu:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),e=this.model.get_property_value_by_name("menu_id"),i=this.model.get_property_value_by_name("menu_slug"),n=this.model.get_property_value_by_name("breakpoint_menu_id");"undefined"!=typeof t.id&&(n=n?n:{},n[t.id]={menu_id:e,menu_slug:i},this.model.set_property("breakpoint_menu_id",n,!0),n.desktop&&n.desktop.menu_slug&&this.model.set_property("menu_slug",n.desktop.menu_slug,!0))}}),a=t.extend({initialize:function(t){this.constructor.__super__.initialize.call(this,t);var e=this;this.listenTo(this.appearancePanel,"upfront:presets:setup-items",function(){var t=e.appearancePanel,i=t.property("preset")?t.clear_preset_name(t.property("preset")):"default",n=t.presets.findWhere({id:i});"undefined"==typeof n&&(i="default",n=t.presets.findWhere({id:i}));var o=Upfront.Views.breakpoints_storage.get_breakpoints(),r=o.get_active(),s=n.get("breakpoint")||{},a=!1;if(!s[r.id]||!s[r.id].menu_style){var l=_.filter(o.models,function(t){return t.get("width")>r.get("width")});l=_.sortBy(l,function(t){return t.get("width")});for(var p=0;p<l.length;p++)if(s[r.id]=_.clone(s[l[p].id]),s[r.id]){console.log("from "+l[p].id+" to "+r.id);break}s[r.id]&&(a=!0)}s[r.id]&&"burger"===s[r.id].menu_style&&!s[r.id].burger_alignment&&(s[r.id].burger_alignment="left",a=!0),a&&n.set("breakpoint",s)})},hasBreakpointSettings:!0,breakpointSpecificPresetSettings:[{name:"menu_alignment"},{name:"burger_alignment"},{name:"is_floating"},{name:"burger_over"},{name:"menu_style"},{name:"width"}],panels:{General:s,Appearance:i},onSaveSettings:function(){var t=this.model.get_property_value_by_name("menu_id"),e=_.findWhere(this.for_view.existingMenus,{term_id:t});e&&this.model.set_property("menu_slug",e.slug,!0)},render:function(){this.constructor.__super__.render.call(this);var t=this;this.currentState="",this.listenTo(this.appearancePanel,"upfront:presets:state_show",function(e){t.currentState=e}),this.listenTo(this.for_view,"rendered",function(){t.currentState&&t.stateShow(t.currentState)})},title:o.settings});return a}),function(t){define("elements/upfront-newnavigation/js/floating",[],function(){var e=t(window),i=function(i){var n=0,o={top:0,left:0},r={width:0,height:0},s=i,a=function(){$current_offset=s.offset(),s.attr("data-already_floating","yes"),s.closest(".upfront-wrapper").css("z-index",999),s.hasClass("responsive_nav_toggler")?s.offset($current_offset):s.css(r),n>0&&s.css("margin-top",n)},l=function(){s.attr("style","").attr("data-already_floating","no"),s.closest(".upfront-wrapper").css("z-index",""),n>0&&s.css("margin-top","")},p=function(){var i=e.scrollTop(),r=t("section.upfront-layout").css("margin-top")?parseInt(t("section.upfront-layout").css("margin-top"),10):0;i>o.top+r-n&&!s.is('[data-already_floating="yes"]')?a():i<=o.top+r-n&&s.is('[data-already_floating="yes"]')&&l()},d=function(){o={top:0,left:0},r={width:0,height:0},s=!1,e.off("scroll",p)},c=function(){o=s.offset(),r={width:s.width(),height:s.height()},e.off("scroll",p).on("scroll",p);var i=t("#upfront-ui-topbar").length>0?t("#upfront-ui-topbar").outerHeight():0,a=t(".upfront-ruler-container").length>0?t(".upfront-ruler-container").outerHeight():0;n=i+a};return c(),{destroy:d}};return i})}(jQuery),function(t){define("unewnavigation",["elements/upfront-newnavigation/js/menuitem","elements/upfront-newnavigation/js/model","elements/upfront-newnavigation/js/element","elements/upfront-newnavigation/js/settings","text!elements/upfront-newnavigation/tpl/preset-style.html","scripts/upfront/preset-settings/util","elements/upfront-newnavigation/js/floating","elements/upfront-newnavigation/js/menu-util"],function(e,i,n,o,r,s,a,l){var p=Upfront.Settings.l10n.newnavigation_element,d=Upfront.Views.ObjectView.extend({elementSize:{width:0,height:0},initialize:function(t){var e=this;this.elementClasses=this.$el.attr("class"),this.model instanceof i||(this.model=new i({properties:this.model.get("properties")})),Upfront.Views.ObjectView.prototype.initialize.call(this),this.events=_.extend({},this.events,{"click a.menu_item":"exitEditMode","dblclick a.menu_item":"editMenuItem"}),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"menu_element:delete",this.delete_menu,this),this.listenTo(this.model,"preset:updated",this.preset_updated);this.model.get_property_value_by_name("menu_id");this.model.get_property_by_name("allow_new_pages")&&this.model.get_property_by_name("allow_new_pages").on("change",this.update_auto_add_pages,this),this.property("menu_items",!1,!0),this.on("deactivated",this.onDeactivate,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",function(t,i){e.render(),setTimeout(function(){e.activate_responsive_nav(e.$el.find(".upfront-output-unewnavigation"),t.width)},100)}),this.listenTo(Upfront.Events,"application:mode:before_switch",function(){if(Upfront.Application.layout_ready){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active();
e.render(),setTimeout(function(){e.activate_responsive_nav(e.$el.find(".upfront-output-unewnavigation"),t.get("width"))},100)}}),this.listenTo(Upfront.Events,"entity:drag_stop",this.onElementReposition),this.delegateEvents()},on_element_resize:function(t){this.processFloatStatus()},on_after_layout_render:function(){var t=this;setTimeout(function(){t.processFloatStatus()},2e3)},get_preset_properties:function(){var t=this.model.get_property_value_by_name("preset"),e=s.getPresetProperties("nav",t)||{};return e},preset_updated:function(){this.render()},update_colors:function(){var t=this.get_preset_properties();return!(_.size(t)<=0)&&void s.updatePresetStyle("nav",t,r)},onElementReposition:function(){this.processFloatStatus()},processFloatStatus:function(){this.floating_cache&&this.floating_cache.destroy(),$upfrontObjectContent=this.$el.find(".upfront-object-content");var t=$upfrontObjectContent.attr("data-isfloating"),e=this.property("usingNewAppearance");t&&"yes"==t&&(e?"burger"===this.get_preset_properties().breakpoint[Upfront.Views.breakpoints_storage.get_breakpoints().get_active().id].menu_style?this.floating_cache=new a($upfrontObjectContent.children(".responsive_nav_toggler")):this.floating_cache=new a($upfrontObjectContent):"yes"==this.property("burger_menu")?this.floating_cache=new a($upfrontObjectContent.children(".responsive_nav_toggler")):this.floating_cache=new a($upfrontObjectContent))},exitEditMode:function(e){t(e.target).closest("li").data("backboneview");if(!t(e.target).hasClass("ueditable")){var i=!1;if(this.$el.find("li.edit_mode").each(function(){try{t(this).children("a.menu_item").find(".menu_item-ueditor").data("ueditor").stop(),t(this).removeClass("edit_mode"),t(this).data("backboneview").model["being-edited"]=!1}catch(t){}i=!0}),i)return}t(e.target).closest(".redactor_box").length>0},editMenuItem:function(e){if(!Upfront.Application.user_can_modify_layout())return!1;this.editModeOn(e);var i,n,o=this;if(i=t("undefined"==typeof e.target||""===e.target.trim?e:e.target),i.hasClass("menu_item")||(i=i.closest("a.menu_item")),!(i.length<1||i.closest("li").hasClass("edit_mode"))){"undefined"!=typeof e.target&&(e.preventDefault(),e.stopPropagation()),i.hasClass("ueditor-placeholder")&&(i=i.siblings("a.menu_item")),i.closest("li").addClass("edit_mode"),n=i.children(".menu_item-ueditor");var r=n.data("ueditor");r=null,n.data("ueditor",""),n.data("ueditor")?(n.data("ueditor").start(),n.focus()):(n.ueditor({linebreaks:!0,disableLineBreak:!0,focus:!0,tabFocus:!1,air:!1,allowedTags:["h5"],placeholder:"Link Name",autoexit:!0}).on("start",function(t){n.attr("tabIndex",1),n.focus()}).on("keydown",function(t){8==t.which?setTimeout(function(){if(""===n.text()&&!i.hasClass("menu_item_placeholder")){var t=jQuery.Event("keydown");t.which=8,n.trigger(t)}},100):27==t.which?i.hasClass("new_menu_item")&&i.closest("li").data("backboneview").saveLink(!0):9==t.which?(t.preventDefault(),i.hasClass("new_menu_item")||(n.blur(),i.closest("ul").children("li:last").children("i.navigation-add-item").trigger("click"))):13==t.which&&(i.closest("li").data("backboneview").model["being-edited"]=!1,setTimeout(function(){n.blur()},100)),""!==n.text().trim()?i.removeClass("menu_item_placeholder"):i.addClass("menu_item_placeholder")}).on("blur",function(e){var o=!1;i.closest("li").data("backboneview").model["being-edited"]&&(o=i.closest("li").data("backboneview").model["being-edited"]),t(e.relatedTarget).closest(".redactor_toolbar").length>0||o||t("#upfront-popup").hasClass("upfront-postselector-popup")&&"block"==t("#upfront-popup").css("display")||(n.data("ueditor").stop(),i.closest("li").removeClass("edit_mode"),i.hasClass("new_menu_item")||i.closest("li").data("backboneview").saveLink())}).on("stop",function(){o.editModeOff()}),n.data("ueditor").start(),n.focus());for(var s=i.closest("ul");s.length>0&&s.hasClass("sub-menu");)s.addClass("time_being_display"),s=s.parent().parent("ul")}},editModeOn:function(e){this.$el.find(".upfront-object-content ul").each(function(){t(this).hasClass("ui-sortable")&&t(this).sortable("disable")})},editModeOff:function(){var e=this;this.$el.find(".upfront-object-content ul").each(function(){t(this).hasClass("redactor-toolbar")||t(this).hasClass("upfront-field-select-options")||e.$el.find("li.menu-item.controls-visible").length<1&&t(this).hasClass("ui-sortable")&&t(this).sortable("enable")})},onDeactivate:function(e){this.$el.find("li.edit_mode").data("backboneview")&&(this.$el.find("li.edit_mode").data("backboneview").model["being-edited"]=!1),this.$el.find("li.edit_mode a.menu_item .menu_item-ueditor").blur(),this.editModeOff(),t("#upfront-popup").hasClass("upfront-postselector-popup")&&"block"===t("#upfront-popup").css("display")||this.$el.find(".time_being_display").removeClass("time_being_display");var i=this.$el.find("li.controls-visible");i.length>0&&(i.removeClass("controls-visible"),i.data("backboneview").setItemControlsState())},property:function(t,e,i){return"undefined"!=typeof e?this.model.set_property(t,e,i):this.model.get_property_value_by_name(t)},update_auto_add_pages:function(){var t,e=this.model.get_property_value_by_name("menu_id"),i=this.property("allow_new_pages"),n=Upfront.data.navigation.auto_add.auto_add;return!!e&&(e=parseInt(this.model.get_property_value_by_name("menu_id"),10),n||(n=[]),i[0]==["yes"]?n.indexOf(e)==-1&&n.push(e):-1!==(t=n.indexOf(e))&&n.splice(t,1),Upfront.data.navigation.auto_add?Upfront.data.navigation.auto_add.auto_add=n:Upfront.data.navigation.auto_add={0:!1,auto_add:[]},void Upfront.Util.post({action:"upfront_new_update_auto_add_pages",nav_menu_option:JSON.stringify(Upfront.data.navigation.auto_add)}).error(function(t){Upfront.Util.log("Cannot update auto add pages!")}))},auto_add_pages:function(){var t=parseInt(this.model.get_property_value_by_name("menu_id"),10);Upfront.data.navigation.auto_add.auto_add&&-1!==Upfront.data.navigation.auto_add.auto_add.indexOf(t)?this.model.set_property("allow_new_pages",["yes"],!0):this.model.set_property("allow_new_pages",["no"],!0)},display_menu_list:function(){var t=this,e=[{label:p.choose_existing_menu,value:0}],i=l.getSelectMenuOptions(),n=this.$el.closest(".upfront-editable_entity.upfront-module"),o=[];if("undefined"!=typeof i&&(o=e.concat(i)),t.$el.find("div.upfront-object-content").html("").addClass("upfront_choose_menu"),!Upfront.Application.user_can_modify_layout())return!1;var r=new Upfront.Views.Editor.Field.Select({model:t.model,label:"",className:"existing_menu_list",values:o});r.render(),r.$el.on("mouseover",function(){n.draggable("disable")}).on("mouseout",function(){n.draggable("enable")}),r.$el.find("> div").on("click",function(){t.parent_module_view.$el.parent().trigger("mouseup")}),r.$el.find("input").on("change",function(){n.draggable("enable");var e=t.$el.find(".existing_menu_list input:checked").val();0!=e&&(t.property("menu_id",e,!0),t.property("menu_slug",l.getMenuSlugById(e)),t.save_breakpoint_menu(e))}),t.$el.find("div.upfront-object-content").append(r.$el).append("<span> or </span>");var s=new Upfront.Views.Editor.Field.Text({model:t.model,label:p.new_menu_name,className:"new_menu_name",compact:!0});s.render(),t.$el.find("div.upfront-object-content").append('<div class="upfront_new_menu_name_and_button"></div>'),s.$el.on("mouseover",function(){n.draggable("disable")}).on("mouseout",function(){n.draggable("enable")}).on("keydown",function(e){var i=t.$el.find(".new_menu_button > input.upfront-field-button");if(""!==e.target.value&&" "!==e.target.value?i[0].disabled=!1:i[0].disabled=!0,13==e.which&&!i[0].disabled)return t.create_new_menu(e.target.value)}),t.$el.find("div.upfront-object-content .upfront_new_menu_name_and_button").append(s.$el);var a=new Upfront.Views.Editor.Field.Button({model:t.model,label:p.create_new,className:"new_menu_button",compact:!0});a.render(),a.el.querySelector("input.upfront-field-button").disabled=!0,a.$el.find("input.upfront-field-button").on("click",function(e){e.stopPropagation();var i=t.$el.find(".new_menu_name > input");""!==i.val()&&t.create_new_menu(i.val())}),t.$el.find("div.upfront-object-content .upfront_new_menu_name_and_button").append(a.$el)},save_breakpoint_menu:function(t){var e=this.model.get_property_value_by_name("breakpoint_menu_id");e=e?e:{},e.desktop={menu_id:t.toString()},this.property("breakpoint_menu_id",e,!0)},create_new_menu:function(t){var e=this;Upfront.Util.post({action:"upfront_new_create_menu",menu_name:t}).success(function(t){e.property("menu_slug",t.data.slug,!0),e.property("menu_id",t.data.term_id),e.save_breakpoint_menu(t.data.term_id),Upfront.Events.trigger("menu_element:menu_created",t.data)}).error(function(t){Upfront.Util.log("Error creating menu")})},delete_menu:function(t){Upfront.Util.post({action:"upfront_new_delete_menu",menu_id:t}).success(function(t){Upfront.Events.trigger("menu_element:menu_deleted",t.data)}).error(function(t){Upfront.Util.log("Error deleting menu")})},get_content_markup:function(){var e=this.model.get_property_value_by_name("menu_id"),i=e,n=this,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),r=this.model.get_property_value_by_name("breakpoint_menu_id"),s=this.model.get_property_value_by_name("menu_slug");if(0==t('#element-settings-sidebar input[name="menu_id"]').length&&e&&"undefined"!=typeof o.id){var a=[];for(key in r)a[key]=r[key].menu_id;var l=a[o.id];if(e="mobile"==o.id?l||a.tablet||a.desktop||e:"tablet"==o.id?l||a.desktop||e:l||e,i!==e)return n.property("menu_id",e),""}return properties=this.get_preset_properties(),e?(Upfront.Util.post({action:"upfront_new_load_menu_array",data:e}).success(function(t){return t.data?void(t.data.length?(n.property("menu_items",t.data,!0),n.generate_menu()):(""!==s&&n.set_menu_id_from_slug(s,!0),n.fallback_content_markup(s))):void n.$el.find(".upfront-object-content").html("Please add menu items")}).error(function(t){Upfront.Util.log("Error loading menu")}),"Loading"):(""!==s&&this.set_menu_id_from_slug(s),"")},fallback_content_markup:function(t){var e=this;Upfront.Util.post({action:"upfront_new_load_menu_array",data:t}).success(function(t){return t.data?(e.property("menu_items",t.data,!0),void e.generate_menu()):void e.$el.find(".upfront-object-content").html("Please add menu items")}).error(function(t){Upfront.Util.log("Error loading menu")})},set_menu_id_from_slug:function(t,e){var i=this,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active(),o=this.model.get_property_value_by_name("breakpoint_menu_id");e||(e=!1),Upfront.Util.post({action:"upfront_new_menu_from_slug",data:t}).success(function(r){"undefined"!=typeof o&&"undefined"!=typeof n.id&&"undefined"!=typeof o[n.id]&&(o[n.id]={menu_id:r.data,menu_slug:t},i.model.set_property("breakpoint_menu_id",o,!0)),i.property("menu_id",r.data,e)}).error(function(t){Upfront.Util.log("Error loading menu from slug")})},on_render:function(){var t=this,e=this.get_preset_properties();this.property("menu_id")||this.display_menu_list();var i,n,o=this.property("allow_sub_nav"),r=this.property("is_floating");_.isUndefined(e.breakpoint)&&(e.breakpoint={desktop:{},tablet:{},mobile:{}}),_.isUndefined(e.breakpoint.desktop)&&(e.breakpoint.desktop={}),i=e.breakpoint.desktop.menu_style,i=i?i:this.property("menu_style"),e.breakpoint.desktop.menu_alignment||(e.breakpoint.desktop.menu_alignment=this.property("menu_alignment")),n=this.$el.find(".upfront-object-content"),setTimeout(function(){var i=t.model.get_property_value_by_name("breakpoint"),o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active();i?(n.attr("data-breakpoints",JSON.stringify(i)),t.property("preset")&&"default"!==t.property("preset")&&n.attr("data-breakpoints",JSON.stringify(e.breakpoint)),setTimeout(function(){t.activate_responsive_nav(n,o.get("width"))},100)):t.property("preset")&&(n.attr("data-breakpoints",JSON.stringify(e.breakpoint)),setTimeout(function(){t.activate_responsive_nav(n,o.get("width"))},100)),t.$el.closest(".upfront-module").addClass("upfront-module-has-nav")},300),n.attr("data-stylebk",i?i:"horizontal"),n.attr("data-style",i?i:"horizontal"),n.attr("data-alignment",e.breakpoint.desktop.menu_alignment),n.attr("data-isfloating",r?r:"no"),n.attr("data-allow-sub-nav",0!==o.length&&"yes"==o[0]?o[0]:"no"),setTimeout(function(){t.$el.height()<80?t.$el.closest("div.upfront-module").addClass("newnavigation_squished"):t.$el.closest("div.upfront-module").removeClass("newnavigation_squished")},200),this.$el.off("click",".responsive_nav_toggler, .burger_overlay"),this.$el.on("click",".responsive_nav_toggler, .burger_overlay",function(e){t.toggle_responsive_nav(e),e.stopPropagation()}),this.$el.find(".upfront-output-unewnavigation").addClass("upfront-navigation"),this.trigger("rendered")},renderResponsiveNavigation:function(e){var i=this,n=t("div.upfront-regions").offset(),o=t("div.upfront-regions").outerWidth(),r=t(window).width(),s=t("div#sidebar-ui").outerWidth(),a=t("div#upfront-ui-topbar").length>0?t("div#upfront-ui-topbar").outerHeight():0,l=t(".upfront-ruler-container").length>0?t(".upfront-ruler-container").outerHeight():0,p=this.property("usingNewAppearance"),d=Upfront.Views.breakpoints_storage.get_breakpoints(),c=d.get_active(),u=p?this.get_preset_properties().breakpoint:this.fallbackBreakpointData(),h=(u||{})[c.id]||{},f=c.get_property_value_by_name("width"),g="undefined"==typeof f||c.get("default")?t(window).width():parseInt(f,10);if(!h||!h.menu_style){var m=_.filter(d.models,function(t){return t.get("width")>c.get("width")});m=_.sortBy(m,function(t){return t.get("width")});for(var v=0;v<m.length&&("undefined"!=typeof u&&(h=u[m[v].id]),!h);v++);}if(h&&"burger"===h.menu_style&&!h.burger_alignment&&(h.burger_alignment="left"),"burger"===h.menu_style){if(e.addClass("triggered-menu"),e.attr("data-style","burger"),e.attr("data-burger_alignment",h.burger_alignment),e.attr("data-burger_over",h.burger_over),e.attr("data-alignment",h.menu_alignment),e.find("div.responsive_nav_toggler").length||e.prepend(t('<div class="responsive_nav_toggler"><div></div><div></div><div></div></div>').data("view",i)),e.find("li.menu-item-has-children").each(function(){if(e.children("a").length&&e.children("a").attr("href")){var t=e.clone().removeClass("menu-item-has-children").addClass("active-clone").removeAttr("id");t.children("ul").remove(),e.children("ul").prepend(t),e.children("a").removeAttr("href")}}),e.hasClass("upfront-output-unewnavigation")){t("head").find("style#responsive_nav_sidebar_offset").remove();var b='div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"] ul.menu, div.upfront-navigation div[data-style="burger"][data-burger_alignment="whole"] ul.menu {left:'+parseInt(n.left,10)+"px;} ";b=b+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"] ul.menu, div.upfront-navigation div[data-style="burger"][ data-burger_alignment="whole"] ul.menu {right: inherit; width:'+(parseInt(g,10)<parseInt(r-s,10)?parseInt(g,10):parseInt(r-s,10))+"px !important; } ",b=b+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="left"] ul.menu {left:'+parseInt(n.left,10)+"px !important; right:inherit !important; width:"+(parseInt(.3*o,10)+40)+"px !important;} ",b=b+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="right"] ul.menu {left:inherit !important; right:'+(parseInt((r-g-s)/2,10)>0?parseInt((r-g-s)/2-(t(document).width()>r+6?30:0)):0)+"px !important; width:"+(parseInt(.3*o,10)+40)+"px !important; } ",b=b+'div.upfront-navigation div[data-style="burger"]:not([data-burger_over="pushes"]) ul.menu {top:'+(parseInt(a,10)+parseInt(l,10))+"px !important; } ",t("head").append(t('<style id="responsive_nav_sidebar_offset">'+b+"</style>"))}i.hideMenu(e.find("ul.menu"))}else e.removeClass("triggered-menu"),e.attr("data-style",h.menu_style),e.attr("data-alignment",h.menu_alignment),e.removeAttr("data-burger_alignment"),e.removeAttr("data-burger_over"),e.find("div.responsive_nav_toggler").remove(),i.showMenu(e.find("ul.menu")),e.find("li.active-clone").each(function(){e.parent().parent().children("a").attr("href",e.children("a").attr("href")),e.remove()}),e.find("ul.menu, ul.sub-menu").each(function(){e.css("display","")}),t("div#wpadminbar").length&&e.find("ul.menu").css("margin-top","");e.attr("data-isfloating",h.is_floating),Upfront.Events.trigger("entity:object:refresh",this)},fallbackBreakpointData:function(){var t=this.property("breakpoint");if(t!==!1&&_.isObject(t)&&"desktop"in t){for(var e in t)_.isObject(t[e])&&"burger_menu"in t[e]&&"yes"===t[e].burger_menu&&(t[e].menu_style="burger",delete t[e].burger_menu);return t}return{desktop:{},tablet:{},mobile:{}}},activate_responsive_nav:function(t,e){return this.property("preset")?void this.renderResponsiveNavigation(t):void this.fallbackToOldResponsiveNav(t,e)},fallbackToOldResponsiveNav:function(e,i){var n=this,o=e.data("breakpoints"),r=[],s="undefined"!=typeof i?parseInt(i,10):t(window).width();for(var a in o)r.push(o[a]);r.sort(function(t,e){return t.width-e.width});var l=t("div.upfront-regions").offset(),p=t("div.upfront-regions").outerWidth(),d=t(window).width(),c=t("div#sidebar-ui").outerWidth(),u=t("div#upfront-ui-topbar").outerHeight();ruler_height=t(".upfront-ruler-container").outerHeight();for(var h in r)if(parseInt(s,10)>=parseInt(r[h].width,10)){if("yes"==r[h].burger_menu){if(e.addClass("triggered-menu"),e.attr("data-style","burger"),e.attr("data-burger_alignment",r[h].burger_alignment),e.attr("data-burger_over",r[h].burger_over),e.attr("data-alignment",r[h].menu_alignment?r[h].menu_alignment:e.data("alignmentbk")),e.find("div.responsive_nav_toggler").length||e.prepend(t('<div class="responsive_nav_toggler"><div></div><div></div><div></div></div>').data("view",n)),e.find("li.menu-item-has-children").each(function(){if(e.children("a").length&&e.children("a").attr("href")){var t=e.clone().removeClass("menu-item-has-children").addClass("active-clone").removeAttr("id");t.children("ul").remove(),e.children("ul").prepend(t),e.children("a").removeAttr("href")}}),e.hasClass("upfront-output-unewnavigation")){t("head").find("style#responsive_nav_sidebar_offset").remove();var f='div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"][data-burger_over="over"] ul.menu, div.upfront-navigation div[data-style="burger"][data-burger_over="over"][data-burger_alignment="whole"] ul.menu {left:'+parseInt(l.left,10)+"px !important;} ";f=f+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="top"] ul.menu, div.upfront-navigation div[data-style="burger"][ data-burger_alignment="whole"] ul.menu {right: inherit; width:'+(parseInt(s,10)<parseInt(d-c,10)?parseInt(s,10):parseInt(d-c,10))+"px !important; } ",f=f+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="left"] ul.menu {left:'+parseInt(l.left,10)+"px !important; right:inherit !important; width:"+(parseInt(.3*p,10)+40)+"px !important;} ",f=f+'div.upfront-navigation div[data-style="burger"][ data-burger_alignment="right"] ul.menu {left:inherit !important; right:'+(parseInt((d-s-c)/2-30,10)>0?parseInt((d-s-c)/2-30,10):0)+"px !important; width:"+(parseInt(.3*p,10)+40)+"px !important; } ",f=f+'div.upfront-navigation div[data-style="burger"][data-burger_over="over"] ul.menu {top:'+(parseInt(u,10)+parseInt(ruler_height,10))+"px !important; } ",t("head").append(t('<style id="responsive_nav_sidebar_offset">'+f+"</style>"))}e.closest("div.upfront-newnavigation_module").css("z-index",3),n.hideMenu(e.find("ul.menu"))}else e.removeClass("triggered-menu"),e.attr("data-style",r[h].menu_style),e.attr("data-alignment",r[h].menu_alignment),e.removeAttr("data-burger_alignment",""),e.removeAttr("data-burger_over",""),e.find("div.responsive_nav_toggler").remove(),n.showMenu(e.find("ul.menu")),e.find("li.active-clone").each(function(){e.parent().parent().children("a").attr("href",e.children("a").attr("href")),e.remove()}),e.find("ul.menu, ul.sub-menu").each(function(){e.css("display","")}),t("div#wpadminbar").length&&e.find("ul.menu").css("margin-top",""),e.closest("div.upfront-newnavigation_module").css("z-index","");e.attr("data-isfloating",r[h].is_floating)}Upfront.Events.trigger("entity:object:refresh",this)},hideMenu:function(e){var i=this.$el.find(".upfront-output-unewnavigation");if(e.hide(),e.siblings(".burger_overlay").length>0){var n=e.siblings(".burger_overlay");n.hide()}"top"!==i.attr("data-burger_alignment")&&"whole"!==i.attr("data-burger_alignment")||t("section.upfront-layout").css("margin-top",0)},showMenu:function(t){if(t.siblings(".burger_overlay").length>0){var e=t.siblings(".burger_overlay");e.show()}t.show()},toggle_responsive_nav:function(e){var i=this.$el.closest(".upfront-region-container"),n=this.$el.closest(".upfront-module-group"),o=this.$el.closest(".upfront-module"),r=this.$el.find("ul.menu"),s=this.$el.find(".upfront-output-unewnavigation");if("none"==r.css("display")&&"undefined"!=typeof e){this.showMenu(r);var a=(r.position(),t('<i class="burger_nav_close"></i>'));if(r.prepend(t("<li>").addClass("wrap_burger_nav_close").append(a)),a.bind("touchstart click",function(){t(e.target).closest(".responsive_nav_toggler").trigger("click"),"top"!==s.attr("data-burger_alignment")&&"whole"!==s.attr("data-burger_alignment")||t("section.upfront-layout").css("margin-top",0)}),s.attr("data-burger_open","1"),i.addClass("upfront-region-container-has-nav"),i.addClass("upfront-region-container-nav-open"),n.length>0&&n.addClass("upfront-module-group-nav-open"),o.addClass("upfront-module-nav-open"),"pushes"===s.attr("data-burger_over")&&"top"===s.attr("data-burger_alignment")||"whole"===s.attr("data-burger_alignment")){"top"===s.attr("data-burger_alignment")&&t("section.upfront-layout").css("margin-top",r.outerHeight());var l=t("div#upfront-ui-topbar").outerHeight(),p=t(".upfront-ruler-container").outerHeight();r.offset({top:l+p,left:t("section.upfront-layout").offset().left})}Upfront.Events.trigger("entity:navigation:responsive_open",s)}else this.hideMenu(r),this.$el.find("i.burger_nav_close").parent("li.wrap_burger_nav_close").remove(),s.removeAttr("data-burger_open"),this.$el.find("ul.sub-menu").css("display",""),this.$el.find("ul.sub-menu").length<1&&i.removeClass("upfront-region-container-has-nav"),i.removeClass("upfront-region-container-nav-open"),n.length>0&&n.removeClass("upfront-module-group-nav-open"),o.removeClass("upfront-module-nav-open"),"pushes"===s.attr("data-burger_over")&&t("section.upfront-layout").css("margin-top",""),Upfront.Events.trigger("entity:navigation:responsive_close",s)},generate_menu:function(){var e=this,i=this.model.get_property_value_by_name("menu_id");if(i){var n=this.$el.find(".upfront-object-content");if(this.$el.find(".upfront-object-content").html(""),this.property("menu_items").length>0){var o=this.renderMenu(this.property("menu_items"),"menu");n.append(o)}else n.append(this.renderMenu(this.property("menu_items"),"menu")),setTimeout(function(){e.$el.closest(".upfront-module").find("i.upfront-icon-region-add").trigger("click")},200);var r=this.model.get_property_value_by_name("preset"),s=this.get_preset_properties();setTimeout(function(){e.clearPresetClass(e.$el),e.$el.addClass(e.property("theme_style")),e.property("usingNewAppearance")&&e.$el.addClass(r)},50);var a=this.$el.closest(".upfront-region-container, .upfront-region-sub-container");this.$el.find("ul.sub-menu").length>0?a.addClass("upfront-region-container-has-nav"):a.removeClass("upfront-region-container-has-nav");var l=Upfront.Settings.LayoutEditor.CurrentBreakpoint,p=this.property("usingNewAppearance");if(s.breakpoint=p?this.get_preset_properties().breakpoint:this.fallbackBreakpointData(),!l||l.default)"burger"===((s.breakpoint||{}).desktop||{}).menu_style&&"pushes"!==((s.breakpoint||{}).desktop||{}).burger_over&&"whole"!==((s.breakpoint||{}).desktop||{}).burger_alignment&&this.$el.find(".upfront-object-content").append(t('<div class="burger_overlay"></div>')),"burger"===((s.breakpoint||{}).desktop||{}).menu_style&&(n.prepend(t("<div>").addClass("responsive_nav_toggler").data("view",e).append("<div></div><div></div><div></div>")),e.hideMenu(this.$el.find("ul.menu")));else{breakpoint_data=(s.breakpoint||{})[l.id]||{};var d="undefined"==typeof breakpoint_data.menu_style?"yes"===this.model.get_breakpoint_property_value("burger_menu")?"burger":"":breakpoint_data.menu_style,c="undefined"==typeof breakpoint_data.burger_over?this.model.get_breakpoint_property_value("burger_over"):breakpoint_data.burger_over,u="undefined"==typeof breakpoint_data.burger_alignment?this.model.get_breakpoint_property_value("burger_alignment"):breakpoint_data.burger_alignment;"burger"===d&&"pushes"!==c&&"whole"!==u&&this.$el.find(".upfront-object-content").append(t('<div class="burger_overlay"></div>')),"burger"===d&&(n.prepend(t("<div>").addClass("responsive_nav_toggler").data("view",e).append("<div></div><div></div><div></div>")),e.hideMenu(this.$el.find("ul.menu")))}t("section.upfront-layout").css("margin-top",""),this.makeSortable(),this.processFloatStatus()}},clearPresetClass:function(t){t.removeClass(),t.addClass(this.elementClasses)},makeSortable:function(){if(!Upfront.Application.user_can_modify_layout())return!1;var e=this;this.$el.find(".upfront-object-content ul").each(function(){t(this).hasClass("redactor-toolbar")||t(this).hasClass("upfront-field-select-options")||t(this).hasClass("ui-sortable")||t(this).sortable({start:function(t,e){e.item.find("i.navigation-add-item").css("display","none")},stop:function(t,i){i.item.find("i.navigation-add-item").css("display","block"),i.item.parent("ul").children("li:last").append(i.item.parent("ul").children("li").children("i.navigation-add-item")),e.saveMenuOrder()}})})},saveMenuOrder:function(){var t=this;Upfront.Util.post({action:"upfront_new_update_menu_order",menu_items:t.new_menu_order()}).success(function(t){Upfront.Events.trigger("menu_element:edit")}).error(function(t){Upfront.Util.log("Error updating menu")})},new_menu_order:function(e){var i=0,n=[];return this.$el.find(".upfront-object-content ul li").each(function(){var o=t(this).data("backboneview");return!o||!o.model||(t(this).parent().parent("li").length>0?t(this).data("backboneview").model["menu-item-parent-id"]=t(this).parent().parent("li").data("backboneview").model["menu-item-db-id"]:t(this).data("backboneview").model["menu-item-parent-id"]=0,n[i]={},"undefined"!=typeof e&&t(this).data("backboneview").model["menu-item-parent-id"]==parseInt(e,10)&&(t(this).data("backboneview").model["menu-item-parent-id"]=0),void("undefined"!=typeof e&&t(this).data("backboneview").model["menu-item-db-id"]==e||(n[i]["menu-item-db-id"]=t(this).data("backboneview").model["menu-item-db-id"],n[i]["menu-item-parent-id"]=t(this).data("backboneview").model["menu-item-parent-id"],t(this).data("backboneview").model["menu-item-position"]=i,i++)))}),n},renderMenu:function(e,i,n){"undefined"==typeof n&&(n=0);var o=this,r=t("<ul>").addClass(i);return"menu"==i&&r.addClass("drag_mode"),_(e).each(function(t){var e=o.renderMenuItem(t,!1,n);e&&e.length&&"undefined"!=typeof t.sub&&t.sub&&t.sub.length&&e.addClass("parent").append(o.renderMenu(t.sub,"sub-menu",n+1)),r.append(e)}),r.children("li:last").append('<i class="navigation-add-item"></i>'),r},renderMenuItem:function(t,i,n){"undefined"==typeof n&&(n=0);var o=this;"undefined"==typeof i&&(i=!1);var r=new e({model:t,parent_view:o,newitem:i,level:n});return r.render().$el},menuItemTemplate:function(){return{"menu-item-parent-id":"0","menu-item-target":"","menu-item-title":"","menu-item-type":"custom","menu-item-url":"#"}},addPrimaryMenuItem:function(t){t.preventDefault(),this.$el.find("ul.menu > li > i.navigation-add-item").length>0?this.$el.find("ul.menu > li > i.navigation-add-item").trigger("click"):this.addMenuItem(t)},addMenuItem:function(e){var i=this;this.model.get_property_value_by_name("menu_id");i.$el.find("a.new_menu_item").removeClass("new_menu_item");var n=0,o=this.menuItemTemplate();"undefined"==typeof e.target&&e.parent("li").length>0?(n=e.parent("li").data("depth"),o["menu-item-parent-id"]=e.parent("li").data("backboneview").model["menu-item-db-id"],e.append(this.renderMenuItem(o,!0,n+1)),e.children("li:last").append('<i class="navigation-add-item"></i>')):(t(e.target).parent("li").parent("ul").parent("li").length>0&&(o["menu-item-parent-id"]=t(e.target).parent("li").parent("ul").parent("li").data("backboneview").model["menu-item-db-id"],t(e.target).parent("li").parent("ul").addClass("time_being_display")),0===t(e.target).parent("li").length?t(e.target).closest("div.upfront-module").find("ul.menu").append(this.renderMenuItem(o,!0)):(t(e.target).parent("li").parent("ul").append(this.renderMenuItem(o,!0,0)),t(e.target).parent("li").next("li").append(e.target))),i.editMenuItem(i.$el.find("a.new_menu_item").removeClass("new_menu_item"))},getControlItems:function(){return _([this.createControl("add",p.add_item,"addPrimaryMenuItem"),this.createPaddingControl(),this.createControl("settings",p.settings,"on_settings_click")])}});Upfront.Application.LayoutEditor.add_object("Unewnavigation",{Model:i,View:d,Element:n,Settings:o,cssSelectors:{"[data-style='horizontal'] ul.menu, div[data-style='vertical'] ul.menu":{label:p.css.bar_label,info:p.css.bar_info},"[data-style='horizontal'] ul.menu > li.menu-item a, div[data-style='vertical'] ul.menu > li.menu-item a":{label:p.css.item_label,info:p.css.item_info},"[data-style='horizontal'] ul.menu > li.menu-item:hover a, div[data-style='vertical'] ul.menu > li.menu-item:hover a":{label:p.css.hover_label,info:p.css.hover_info},"[data-style='horizontal'] ul.sub-menu > li.menu-item > a, div[data-style='vertical'] ul.sub-menu > li.menu-item > a":{label:p.css.subitem_label,info:p.css.subitem_info},"[data-style='horizontal'] ul.sub-menu > li.menu-item:hover > a, div[data-style='vertical'] ul.sub-menu > li.menu-item:hover > a":{label:p.css.subitem_hover_label,info:p.css.subitem_hover_info},"[data-style='burger'] ul.menu":{label:p.css.responsive_bar_label,info:p.css.bar_info},"[data-style='burger'] .responsive_nav_toggler":{label:p.css.responsive_trigger,info:p.css.hover_info},"[data-style='burger'] div.responsive_nav_toggler > div":{label:p.css.responsive_trigger_bars,info:p.css.hover_info},"[data-style='burger'] i.burger_nav_close":{label:p.css.responsive_nav_close,info:p.css.close_info},"[data-style='burger'] ul.menu > li.menu-item a":{label:p.css.responsive_item_label,info:p.css.item_info},"[data-style='burger'] ul.menu > li.menu-item:hover a":{label:p.css.responsive_hover_label,info:p.css.hover_info},"[data-style='burger'] ul.sub-menu > li.menu-item > a":{label:p.css.responsive_subitem_label,info:p.css.subitem_info},"[data-style='burger'] ul.sub-menu > li.menu-item:hover > a":{label:p.css.responsive_subitem_hover_label,info:p.css.subitem_hover_info}},cssSelectorsId:Upfront.data.unewnavigation.defaults.type}),Upfront.Models.UnewnavigationModel=i,Upfront.Views.UnewnavigationView=d})}(jQuery),define("elements/upfront-button/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.ubutton.defaults),e=Upfront.data.ubutton.defaults;t.content=_.clone(e.content),t.element_id=Upfront.Util.get_unique_id("button-object"),this.init_properties(t)}});return t}),define("elements/upfront-button/js/element",["elements/upfront-button/js/model"],function(t){var e=Upfront.Settings.l10n.button_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:150,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-button"),this.$el.html(e.element_name)},add_element:function(){var i=new t,n=new Upfront.Models.Module({name:"",properties:[{name:"content",value:e.dbl_click},{name:"href",value:""},{name:"align",value:"center"},{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c4 button-style"},{name:"row",value:Upfront.Util.height_to_row(55)},{name:"has_settings",value:0}],objects:[i]});this.add_module(n)}});return i}),define("text!elements/upfront-button/tpl/preset-style.html",[],function(){
return"#page .upfront-button .button-preset-<?php echo $properties['id'] ?>.upfront_cta {\n    <?php if(!empty($properties['color'])) { ?>color: <?php echo $properties['color']  ?>; <?php } ?>\n    <?php if(!empty($properties['fontface'])) { ?>font-family: <?php echo $properties['fontface']  ?>; <?php } ?>\n    <?php if(!empty($properties['fontsize'])) { ?>font-size: <?php echo $properties['fontsize']  ?>px; <?php } ?>\n    <?php if(!empty($properties['fontstyle_weight'])) { ?>font-weight: <?php echo $properties['fontstyle_weight']  ?>;<?php } ?>\n    <?php if(!empty($properties['fontstyle_style'])) { ?>font-style: <?php echo $properties['fontstyle_style']  ?>;<?php } ?>\n    <?php if(!empty($properties['lineheight'])) { ?>line-height: <?php echo $properties['lineheight']  ?>;<?php } ?>\n\n    <?php if(!empty($properties['useborder'])) { ?>\n        <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n\n    <?php if(!empty($properties['useradius'])) { ?>\n        border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        border-radius: 0px;\n    <?php } ?>\n\n    <?php if(!empty($properties['bgcolor'])) { ?>background-color: <?php echo $properties['bgcolor'] ?>; <?php } ?>\n\n\t<?php if(!empty($properties['hov_use_animation'])) { ?>\n\t\ttransition: all <?php echo $properties['hov_duration']  ?>s <?php echo $properties['hov_transition']  ?>;\n\t<?php } else { ?>\n\t\ttransition: none;\n\t<?php } ?>\n}\n\n#page .upfront-button .button-preset-<?php echo $properties['id']  ?>.upfront_cta:hover, #page .upfront-button.<?php echo $properties['id']  ?>.live-preview-hover .upfront_cta {\n    <?php if(!empty($properties['hov_usetypography']) && $properties['hov_usetypography'] == 'yes') { ?>\n        <?php if(!empty($properties['hov_color'])) { ?>color: <?php echo $properties['hov_color']  ?>; <?php } ?>\n        <?php if(!empty($properties['hov_fontface'])) { ?>font-family: <?php echo $properties['hov_fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['hov_fontsize'])) { ?>font-size: <?php echo $properties['hov_fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['hov_lineheight'])) { ?>line-height: <?php echo $properties['hov_lineheight']  ?>;<?php } ?>\n        <?php if(!empty($properties['hov_fontstyle_weight'])) { ?>font-weight: <?php echo $properties['hov_fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['hov_fontstyle_style'])) { ?>font-style: <?php echo $properties['hov_fontstyle_style']  ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['color'])) { ?>color: <?php echo $properties['color']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontface'])) { ?>font-family: <?php echo $properties['fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontsize'])) { ?>font-size: <?php echo $properties['fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['fontstyle_weight'])) { ?>font-weight: <?php echo $properties['fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['fontstyle_style'])) { ?>font-style: <?php echo $properties['fontstyle_style']  ?>;<?php } ?>\n        <?php if(!empty($properties['lineheight'])) { ?>line-height: <?php echo $properties['lineheight']  ?>;<?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['hov_useborder']) && $properties['hov_useborder'] == 'yes') { ?>\n        <?php if(!empty($properties['hov_borderwidth']) && !empty($properties['hov_bordertype']) && !empty($properties['hov_bordercolor'])) { ?>border: <?php echo $properties['hov_borderwidth'] ?>px <?php echo $properties['hov_bordertype'] ?> <?php echo $properties['hov_bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['useborder'])) { ?>\n            <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n        <?php } else { ?>\n            border: none;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['hov_useradius']) && $properties['hov_useradius'] == 'yes') { ?>\n        border-radius: <?php echo !empty($properties['hov_borderradius1']) ? $properties['hov_borderradius1'] : 0 ?>px <?php echo !empty($properties['hov_borderradius2']) ? $properties['hov_borderradius2'] : 0 ?>px <?php echo !empty($properties['hov_borderradius4']) ? $properties['hov_borderradius4'] : 0 ?>px <?php echo !empty($properties['hov_borderradius3']) ? $properties['hov_borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        <?php if(!empty($properties['useradius'])) { ?>\n            border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n        <?php } else { ?>\n            border-radius: 0px;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['hov_usebgcolor']) && $properties['hov_usebgcolor'] == 'yes') { ?>\n        <?php if(!empty($properties['hov_bgcolor'])) { ?>background-color: <?php echo $properties['hov_bgcolor'] ?>; <?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['bgcolor'])) { ?>background-color: <?php echo $properties['bgcolor'] ?>; <?php } ?>\n    <?php } ?>\n}\n\n#page .upfront-button .button-preset-<?php echo $properties['id']  ?>.upfront_cta:focus, #page .upfront-button.<?php echo $properties['id']  ?>.live-preview-focus .upfront_cta {\n    <?php if(!empty($properties['focus_usetypography']) && $properties['focus_usetypography'] == 'yes') { ?>\n        <?php if(!empty($properties['focus_color'])) { ?>color: <?php echo $properties['focus_color']  ?>; <?php } ?>\n        <?php if(!empty($properties['focus_fontface'])) { ?>font-family: <?php echo $properties['focus_fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['focus_fontsize'])) { ?>font-size: <?php echo $properties['focus_fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['focus_lineheight'])) { ?>line-height: <?php echo $properties['focus_lineheight']  ?>;<?php } ?>\n        <?php if(!empty($properties['focus_fontstyle_weight'])) { ?>font-weight: <?php echo $properties['focus_fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['focus_fontstyle_style'])) { ?>font-style: <?php echo $properties['focus_fontstyle_style']  ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['color'])) { ?>color: <?php echo $properties['color']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontface'])) { ?>font-family: <?php echo $properties['fontface']  ?>; <?php } ?>\n        <?php if(!empty($properties['fontsize'])) { ?>font-size: <?php echo $properties['fontsize']  ?>px; <?php } ?>\n        <?php if(!empty($properties['fontstyle_weight'])) { ?>font-weight: <?php echo $properties['fontstyle_weight']  ?>;<?php } ?>\n        <?php if(!empty($properties['fontstyle_style'])) { ?>font-style: <?php echo $properties['fontstyle_style']  ?>;<?php } ?>\n        <?php if(!empty($properties['lineheight'])) { ?>line-height: <?php echo $properties['lineheight']  ?>;<?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['focus_useborder']) && $properties['focus_useborder'] == 'yes') { ?>\n        <?php if(!empty($properties['focus_borderwidth']) && !empty($properties['focus_bordertype']) && !empty($properties['focus_bordercolor'])) { ?>border: <?php echo $properties['focus_borderwidth'] ?>px <?php echo $properties['focus_bordertype'] ?> <?php echo $properties['focus_bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['useborder'])) { ?>\n            <?php if(!empty($properties['borderwidth']) && !empty($properties['bordertype']) && !empty($properties['bordercolor'])) { ?>border: <?php echo $properties['borderwidth'] ?>px <?php echo $properties['bordertype'] ?> <?php echo $properties['bordercolor'] ?>;<?php } ?>\n        <?php } else { ?>\n            border: none;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['focus_useradius']) && $properties['focus_useradius'] == 'yes') { ?>\n        border-radius: <?php echo !empty($properties['focus_borderradius1']) ? $properties['focus_borderradius1'] : 0 ?>px <?php echo !empty($properties['focus_borderradius2']) ? $properties['focus_borderradius2'] : 0 ?>px <?php echo !empty($properties['focus_borderradius4']) ? $properties['focus_borderradius4'] : 0 ?>px <?php echo !empty($properties['focus_borderradius3']) ? $properties['focus_borderradius3'] : 0 ?>px;\n    <?php } else { ?>\n        <?php if(!empty($properties['useradius'])) { ?>\n            border-radius: <?php echo $properties['borderradius1'] ? $properties['borderradius1'] : 0 ?>px <?php echo $properties['borderradius2'] ? $properties['borderradius2'] : 0 ?>px <?php echo $properties['borderradius4'] ? $properties['borderradius4'] : 0 ?>px <?php echo $properties['borderradius3'] ? $properties['borderradius3'] : 0 ?>px;\n        <?php } else { ?>\n            border-radius: 0px;\n        <?php } ?>\n    <?php } ?>\n\n    <?php if(!empty($properties['focus_usebgcolor']) && $properties['focus_usebgcolor'] == 'yes') { ?>\n        <?php if(!empty($properties['focus_bgcolor'])) { ?>background-color: <?php echo $properties['focus_bgcolor'] ?>; <?php } ?>\n    <?php } else { ?>\n        <?php if(!empty($properties['bgcolor'])) { ?>background-color: <?php echo $properties['bgcolor'] ?>; <?php } ?>\n    <?php } ?>\n}\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-button/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-button/tpl/preset-style.html"],function(t,e,i){var n=Upfront.Settings.l10n.button_element,o=t.extend({panels:{Appearance:{mainDataCollection:"buttonPresets",styleElementPrefix:"button-preset",ajaxActionSlug:"button",panelTitle:n.settings,styleTpl:i,presetDefaults:Upfront.mainData.presetDefaults.button,stateModules:{Static:[{moduleType:"Colors",options:{title:n.settings.colors_label,multiple:!1,single:!0,abccolors:[{name:"bgcolor",label:n.settings.button_bg_label}],fields:{use:"usebgcolor"}}},{moduleType:"Typography",options:{state:"static",title:n.settings.typography_label,fields:{typeface:"fontface",fontstyle:"fontstyle",weight:"fontstyle_weight",style:"fontstyle_style",size:"fontsize",line_height:"lineheight",color:"color"}}},{moduleType:"Radius",options:{state:"static",max_value:100,fields:{use:"useradius",lock:"borderradiuslock",radius:"radius",radius_number:"radius_number",radius1:"borderradius1",radius2:"borderradius2",radius3:"borderradius3",radius4:"borderradius4"}}},{moduleType:"Border",options:{state:"static",fields:{use:"useborder",width:"borderwidth",type:"bordertype",color:"bordercolor"}}}],Hover:[{moduleType:"Colors",options:{state:"hover",title:n.settings.colors_label,multiple:!1,toggle:!0,single:!0,prepend:"hov_",abccolors:[{name:"hov_bgcolor",label:n.settings.button_bg_label}],fields:{use:"hov_usebgcolor"}}},{moduleType:"Typography",options:{state:"hover",title:n.settings.typography_label,toggle:!0,prepend:"hov_",fields:{typeface:"hov_fontface",fontstyle:"hov_fontstyle",weight:"hov_fontstyle_weight",style:"hov_fontstyle_style",size:"hov_fontsize",line_height:"hov_lineheight",color:"hov_color",use:"hov_usetypography"}}},{moduleType:"Radius",options:{state:"hover",max_value:100,prepend:"hov_",fields:{use:"hov_useradius",lock:"hov_borderradiuslock",radius:"hov_radius",radius_number:"hov_radius_number",radius1:"hov_borderradius1",radius2:"hov_borderradius2",radius3:"hov_borderradius3",radius4:"hov_borderradius4"}}},{moduleType:"Border",options:{state:"hover",prepend:"hov_",fields:{use:"hov_useborder",width:"hov_borderwidth",type:"hov_bordertype",color:"hov_bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hov_use_animation",duration:"hov_duration",easing:"hov_transition"}}}],Focus:[{moduleType:"Colors",options:{state:"focus",title:n.settings.colors_label,multiple:!1,toggle:!0,single:!0,prepend:"focus_",abccolors:[{name:"focus_bgcolor",label:n.settings.button_bg_label}],fields:{use:"focus_usebgcolor"}}},{moduleType:"Typography",options:{state:"focus",title:n.settings.typography_label,toggle:!0,prepend:"focus_",fields:{typeface:"focus_fontface",fontstyle:"focus_fontstyle",weight:"focus_fontstyle_weight",style:"focus_fontstyle_style",size:"focus_fontsize",line_height:"focus_lineheight",color:"focus_color",use:"focus_usetypography"}}},{moduleType:"Radius",options:{state:"focus",max_value:100,prepend:"focus_",fields:{use:"focus_useradius",lock:"focus_borderradiuslock",radius:"focus_radius",radius_number:"focus_radius_number",radius1:"focus_borderradius1",radius2:"focus_borderradius2",radius3:"focus_borderradius3",radius4:"focus_borderradius4"}}},{moduleType:"Border",options:{state:"focus",prepend:"focus_",fields:{use:"focus_useborder",width:"focus_borderwidth",type:"focus_bordertype",color:"focus_bordercolor"}}}]},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-button\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,""),t=t.replace(/\a.upfront_cta/,".upfront_cta")},migratePresetProperties:function(t){var e=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",i=this.presets.findWhere({id:e}),n={};"undefined"!=typeof i&&_.each(i.attributes,function(t,e){"id"!==e&&"name"!==e&&"preset_style"!==e&&"legacy"!==e&&(n[e]=t)}),t.set(n)}}},title:n.settings.label});return e.generatePresetsToPage("button",i),o}),define("text!elements/upfront-button/tpl/ubutton.html",[],function(){return'<a href="<?php echo $href ?>" target="<?php echo $linkTarget ?>" style="text-align: <?php echo $align ?>;" class="button-style upfront_cta button-preset-<?php echo $preset ?>"><?php echo $content ?></a>'}),function(t){define("ubutton",["elements/upfront-button/js/model","elements/upfront-button/js/element","elements/upfront-button/js/settings","scripts/upfront/link-model","scripts/upfront/preset-settings/util","text!elements/upfront-button/tpl/ubutton.html","text!elements/upfront-button/tpl/preset-style.html"],function(e,i,n,o,r,s,a){var l=Upfront.Settings.l10n.button_element,p=Upfront.Views.ObjectView.extend({model:e,className:"upfront-object-view upfront-button",buttonTpl:Upfront.Util.template(s),initialize:function(){var t=this;this.elementClasses=this.$el.attr("class"),this.model.set_property("id_slug","ubutton"),this.model instanceof e||(this.model=new e({properties:this.model.get("properties")})),this.events=_.extend({},this.events,{"click a.uf-click-to-edit-text":"placeholderClick","click a.redactor_act":"onOpenPanelClick","click .upfront-save_settings":"onOpenPanelClick","click .open-item-controls":"onOpenItemControlsClick"}),this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(this.model,"change:preset",this.updatePresetClass),Upfront.Events.on("entity:deactivated",this.stopEdit,this),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"theme_colors:update",this.render,this),this.property("link")===!1?(this.link=new o({type:Upfront.Util.guessLinkType(this.property("href")),url:this.property("href"),target:this.property("linkTarget")}),this.property("link",this.link.toJSON())):this.link=new o(this.property("link")),t.listenTo(this.link,"change",function(){t.property("link",t.link.toJSON())})},placeholderClick:function(t){t.preventDefault()},updatePresetClass:function(){this.clearPresetClass(this.$el),this.$el.addClass(this.property("preset"))},clearPresetClass:function(t){t.removeClass(),t.addClass(this.elementClasses)},getCleanurl:function(t){var e;return t||(t=location.href),t.indexOf("?dev=true")!=-1&&(t=t.replace("?dev=true","")),t.indexOf("#")==-1?t:(e=t.split("#"),""!==e[0].trim()?e[0]:location.href.replace("?dev=true",""))},getUrlanchor:function(e){if("undefined"==typeof e&&(e=t(location).attr("href")),e.indexOf("#")>=0){var i=e.split("#");return i[1]}return!1},get_anchors:function(){var t=Upfront.Application.layout.get("regions"),e=[];return t.each(function(t){t.get("modules").each(function(t){t.get("objects").each(function(t){var i=t.get_property_value_by_name("anchor");i&&i.length&&(e[i]=t)})})}),e},update_colors:function(){var t=this.model.get_property_value_by_name("preset"),e=r.getPresetProperties("button",t)||{};return!(_.size(e)<=0)&&void r.updatePresetStyle("button",e,a)},clear_preset_name:function(t){return t=t.replace(" ","-"),t=t.replace(/[^-a-zA-Z0-9]/,"")},get_content_markup:function(){var t=this.extract_properties();""===t.preset&&""!==t.currentpreset&&(t.preset=t.currentpreset,this.model.set_property("preset",t.currentpreset)),t.href=this.link.get("url"),t.linkTarget=this.link.get("target"),t.preset=t.preset||"default",t.preset=this.clear_preset_name(t.preset);Upfront.Views.Editor.Button.Presets.get(t.preset);return this.buttonTpl(t)},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t},saveTitle:function(t){this.property("content",t.html())},is_edited:function(){var t=this.model.get_property_value_by_name("is_edited");return!!t},onOpenPanelClick:function(t){t.preventDefault(),this.toggleLinkPanel()},onOpenItemControlsClick:function(){this.$el.toggleClass("controls-visible"),this.$el.hasClass("controls-visible")?(this.$el.addClass("controls-visible"),this.controlsVisible=!0):this.controlsVisible=!1},toggleLinkPanel:function(){var t=this;this.$el.hasClass("stayOpen")?(this.$el.removeClass("stayOpen"),t.render()):this.$el.addClass("stayOpen")},on_render:function(){var e=this;this.delegateEvents();var i=this.$el.find(".upfront-object-content a.upfront_cta");Upfront.Application.user_can_modify_layout()&&i.ueditor({linebreaks:!0,disableLineBreak:!0,airButtons:["stateAlignCTA","upfrontIcons"],placeholder:"Click here",autostart:!1}).on("start",function(){var t=i.closest(".upfront-object-content");t.addClass("editing").css("minHeight",t.parent().height()),Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){i.closest(".upfront-object-content").removeClass("editing").css("minHeight",""),e.property("align",i.css("text-align"),!0),Upfront.Events.trigger("upfront:element:edit:stop"),e.render()}).on("syncAfter",function(){e.saveTitle(t(this))}),this.clearPresetClass(this.$el),this.$el.find(".upfront-button").addClass(this.property("preset")),Upfront.Events.trigger("entity:object:refresh",this)},stopEdit:function(){var t=this.$el.find(".upfront-object-content a.upfront_cta");t.trigger("blur"),Upfront.Events.trigger("upfront:element:edit:stop")},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},createLinkControl:function(){var t=this,e=new Upfront.Views.Editor.InlinePanels.Controls.LinkPanel({model:this.link,button:!1,icon:"link",tooltip:l.edit_link,id:"link"});return this.listenTo(this.link,"change",function(){this.$el.find("a").attr("href",t.link.get("url"))}),e},getControlItems:function(){return _([this.createLinkControl(),this.createPaddingControl(),this.createControl("settings",l.settings.label,"on_settings_click")])}});Upfront.Views.ContextMenuList.extend({initialize:function(){var t=this;this.menuitems=_([new Upfront.Views.ContextMenuItem({get_label:function(){var e=Upfront.Util.guessLinkType(t.for_view.property("href"));return"lightbox"==e?"Open Lightbox":"anchor"==e?"Scroll to Anchor":"entry"==e?"Visit Post/Page":"Visit Link"},action:function(){Upfront.Util.visitLink(t.for_view.property("href"))}})])}});Upfront.Application.LayoutEditor.add_object("Button",{Model:e,View:p,Element:i,Settings:n,cssSelectors:{".upfront_cta":{label:l.css.container_label,info:l.css.container_info}},cssSelectorsId:Upfront.data.ubutton.defaults.type}),Upfront.Models.ButtonModel=e,Upfront.Views.ButtonView=p})}(jQuery),define("text!elements/upfront-posts/tpl/views.html",[],function(){return'<div id="initial">\r\n\t<div class="upfront_posts-initial-wrapper upfront-initial-overlay-wrapper">\r\n\t\t<div class="upfront_posts-initial-content">\r\n\t\t\t<div class="options"></div>\r\n\t\t\t<a class="continue" href="#continue">{{l10n.continue}}&nbsp;&raquo;</a>\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n\r\n\r\n<div id="loading">\r\n\t<p class="loading">{{l10n.loading}}</p>\r\n</div>\r\n\r\n\r\n<div id="error">\r\n\t<p class="error">{{l10n.error}}</p>\r\n</div>\r\n\r\n\r\n<div id="list">\r\n\t<ul>\r\n\t\t{{posts}}\r\n\t</ul>\r\n\t{{pagination}}\r\n</div>\r\n\r\n\r\n<div id="single">\r\n\t<ul>\r\n\t\t{{posts}}\r\n\t</ul>\r\n</div>\r\n\r\n\r\n<div id="part-options-part_visible">\r\n\t<div class="name_action_wrapper"></div>\r\n</div>\r\n<div id="part-options-part_name">\r\n\t<span class="part_name">{{part.name}}</span>\r\n</div>\r\n<div id="part-options-part_action">\r\n\t<span class="part_action"><a href="#edit-options">{{l10n.edit}}</a></span>\r\n</div>\r\n<div id="part-options-part_wrapper">\r\n\t<div class="options {{part.part}}-options">\r\n\t\t<div class="option"></div>\r\n\t\t<span class="edit_part"><a href="#edit-html">{{l10n.edit_html}}</a></span>\r\n\t</div>\r\n</div>'}),function(t){define("elements/upfront-posts/js/post-list-views",["text!elements/upfront-posts/tpl/views.html"],function(e){var i=Upfront.Settings.l10n.posts_element,n=t(e),o={DEFAULT:"initial",initial:Backbone.View.extend({className:"upfront_posts-initial upfront-initial-overlay-wrapper",tpl:_.template(n.filter("#initial").html()),events:{'click [href="#continue"]':"dispatch"},render:function(){var t=new Upfront.Views.Editor.Field.Radios({model:this.model,property:"display_type",label:i.display_type_label_initial,layout:"horizontal-inline",icon_class:"upfront-posts-display_type",values:[{label:i.single_post,value:"single",icon:"upfront-posts-single"},{label:i.post_list,value:"list",icon:"upfront-posts-list"}]}),e=this.element.parent_module_view.model.get_property_value_by_name("row"),n=e?e*Upfront.Settings.LayoutEditor.Grid.baseline:0;t.on("changed",function(t){this.model.set_property(this.options.property,t,!0)},t),t.render(),Upfront.Application.user_can_modify_layout()?(this.$el.empty().append(this.tpl({l10n:i})),this.$el.css("min-height",n>150?n:150),this.$el.find(".options").empty().append(t.$el)):(this.$el.empty(),this.$el.removeClass("upfront-initial-overlay-wrapper"))},dispatch:function(t){t.preventDefault(),t.stopPropagation();var e=!!this.model.get_property_value_by_name("display_type");return!!e&&void this.model.trigger("change",this.model,{})}}),_view:Backbone.View.extend({render:function(){var e=this,n=Upfront.Util.model_to_json(this.model),o=n.properties||{},r={};window._upfront_get_current_query&&(r=window._upfront_get_current_query()),this._posts_load=Upfront.Util.post({action:"upfront_posts-load",data:{props:o,query:r}}).success(function(n){if(n.data&&n.data.posts){var o="";_.each(n.data.posts,function(t){o+=t}),e.$el.empty().append(e.tpl.main({posts:o,pagination:n.data.pagination,l10n:i})),e.$el.find(".uf-pagination a").off("click").on("click",function(t){return t.preventDefault(),t.stopPropagation(),!1}),e.$el.find(".uposts-part.title a").off("click").on("click",function(e){var i=t(this),n=i.attr("href");if(n.match(/^https?\:/))return e.preventDefault(),e.stopPropagation(),window.location=n,!1})}else e.$el.empty().append(e.tpl.error({l10n:i}))}).error(function(){e.$el.empty().append(e.tpl.error({l10n:i}))}),this.$el.empty().append(this.tpl.load({l10n:i}))}})};return o.list=o._view.extend({className:"upfront_posts-list",tpl:{main:_.template(n.filter("#list").html()),error:_.template(n.filter("#error").html()),load:_.template(n.filter("#loading").html())}}),o.single=o._view.extend({className:"upfront_posts-single",tpl:{main:_.template(n.filter("#single").html()),error:_.template(n.filter("#error").html()),load:_.template(n.filter("#loading").html())}}),o})}(jQuery),function(t){define("elements/upfront-posts/js/post-list-meta-views",["text!elements/upfront-posts/tpl/views.html","scripts/redactor/ueditor-inserts"],function(e,i){var n=Upfront.Settings.l10n.posts_element,o=(t(e),{Embed:i.inserts.embed.extend({meta_fields:[],start:function(){var t=i.inserts.embed.prototype.start.apply(this),e=this;return this.on("manager:rendered",function(t,i,o){return!!o&&void o.$el.find("ul").append('<li><a href="#" class="insert_field">'+n.meta_insert+"</a></li>").find(".insert_field").on("click",function(t){return t.preventDefault(),t.stopPropagation(),e.prepare_fields_box(o),!1})}),t},prepare_fields_box:function(t){var e=this,i=Upfront.Util.model_to_json(this.model),n=i.properties||{},o={};window._upfront_get_current_query&&(o=window._upfront_get_current_query()),this.meta_fields&&this.meta_fields.length?this.pop_fields_box(t):Upfront.Util.post({action:"upfront_posts-list_meta",data:{props:n,query:o}}).success(function(i){i&&i.data&&i.data.fields&&(e.meta_fields=i.data.fields),e.pop_fields_box(t)})},pop_fields_box:function(e){var i=this.meta_fields;Upfront.Popup.open(function(){var e=new o.List({fields:i});e.render(),e.on("done",function(t){Upfront.Popup.close(t)}),t(this).empty().append(e.$el)},{},"embed-shortcode").done(function(t,i){e.trigger("insert",i)})}}),List:Backbone.View.extend({initialize:function(t){this.options=t},render:function(){var t=this,e=this.options.fields,i=new Upfront.Views.Editor.Field.Checkboxes({default_value:0,values:[{label:n.meta_toggle,value:1}],change:function(e){e=!!parseInt(e,10),t.toggle_hidden(e)}});i.render(),this.$el.empty().append("<h1>"+n.meta_fields+"</h1>").append(i.$el),_(e).each(function(e){var i=new o.List_Field({code:e});i.render(),t.$el.append(i.$el),i.on("done",function(e){t.trigger("done",e)})})},toggle_hidden:function(t){var e=this.$el.find(".wp_internal");t?e.hide():e.show()}}),List_Field:Backbone.View.extend({tagName:"pre",events:{click:"send_code"},initialize:function(t){this.code=t.code},send_code:function(t){return t.stopPropagation(),t.preventDefault(),!!this.code&&void this.trigger("done","{{"+this.code+"}}")},render:function(){this.$el.empty().append("<code>"+this.code+"</code>"),"_"===this.code.substr(0,1)&&this.$el.addClass("wp_internal")}})});return o})}(jQuery),function(t){define("elements/upfront-posts/js/post-list-settings-parts",["text!elements/upfront-posts/tpl/views.html","scripts/redactor/ueditor-inserts","elements/upfront-posts/js/post-list-meta-views"],function(e,i,n){var o=Upfront.Settings.l10n.posts_element,r=t(e),s={Part:Backbone.View.extend({tagName:"li",tpl:{top:_.template(r.filter("#part-options-part_visible").html()),name:_.template(r.filter("#part-options-part_name").html()),action:_.template(r.filter("#part-options-part_action").html()),wrapper:_.template(r.filter("#part-options-part_wrapper").html())},initialize:function(t){this.options=t,this.set_options()},set_options:function(){},render:function(){this.$el.empty().attr("data-part",this.options.part).append(this.tpl.top({l10n:o}));var t=this.$el.find(".name_action_wrapper");t.append(this.tpl.name({part:{name:o["part_"+this.options.part]},l10n:o})).append(this.tpl.action({l10n:o})),this.get_options()},get_options:function(){this.$el.append(this.tpl.wrapper({part:{part:this.options.part},l10n:o}));var t=this.$el.find("div."+this.options.part+"-options"),e=t.find(".option"),i=this.$el.find(".part_action a"),n=this;this.field&&(this.field.render(),this.field.on("changed",function(t){n.model.set_property(n.field.options.property,t)},this),e.append(this.field.$el)),i.off("click").on("click",function(e){return e.preventDefault(),e.stopPropagation(),t.is(":visible")?(t.hide(),n.$el.removeClass("active")):(t.show(),n.$el.addClass("active")),!1}),t.find(".edit_part a").on("click",function(t){return t.preventDefault(),t.stopPropagation(),n.spawn_editor(),!1}),t.hide()},spawn_editor:function(){var t=this,e="post-part-"+this.options.part,o=this.model.get_property_value_by_name(e),r="meta"===this.options.part?n.Embed:i.inserts.embed,s=new r({data:{code:o},model:this.model});s.start().done(function(i,n){t.model.set_property(e,n)}),setTimeout(function(){var e=s.get_manager?s.get_manager():{};return!!e.done&&t.listenTo(Upfront.Events,"element:settings:saved",function(){return e.done()})})}})};return s.Part_Author=s.Part.extend({}),s.Part_Title=s.Part.extend({}),s.Part_Read_more=s.Part.extend({}),s.Part_Meta=s.Part.extend({}),s.Part_Date_posted=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Text({model:this.model,label:o.format,label_style:"inline",property:"date_posted_format"})}}),s.Part_Categories=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:o.max_categories,label_style:"inline",property:"categories_limit"})}}),s.Part_Tags=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:o.max_tags,label_style:"inline",property:"tags_limit"})}}),s.Part_Comment_count=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"comment_count_hide",values:[{label:o.hide_comments,value:"1"}]})}}),s.Part_Content=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:o.limit_words,label_style:"inline",property:"content_length"})}}),s.Part_Featured_image=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"resize_featured",values:[{label:o.resize_to_fit,value:"1"}]})}}),s.Part_Gravatar=s.Part.extend({set_options:function(){this.field=new Upfront.Views.Editor.Field.Number({model:this.model,label:o.size_px,label_style:"inline",property:"gravatar_size"})}}),{get_part:function(t,e){t=t||"Part";var i=!1,n="Part_"+t.substr(0,1).toUpperCase()+t.substr(1),o=s[n]?s[n]:s.Part;return i=new o({model:e,part:t})}}})}(jQuery),function(t){define("elements/upfront-posts/js/post-list-settings-panels",["text!elements/upfront-posts/tpl/views.html","elements/upfront-posts/js/post-list-settings-parts","scripts/upfront/element-settings/root-settings-panel"],function(e,i,n){var o=Upfront.Settings.l10n.posts_element;t(e);Upfront.Util.post({action:"upfront_posts-data"}).success(function(t){r._initial=t.data});var r={_initial:{}};n=n.extend({is_active:function(){return this.$el.find(".uf-settings-panel__body").is(":visible")}}),r.General=n.extend({initialize:function(t){this.options=t;var e=this,i=new a({className:"upfront-post-settings",model:this.model}),n=new l({model:this.model,title:o.thumbnail_size}),r=function(t){this.model.set_property(this.options.property,t),"list_type"===this.options.property&&i.dispatch_settings(),e.trigger("settings:dispatched")},s=new Upfront.Views.Editor.Field.Radios({model:this.model,className:"upfront-posts-display-type",property:"display_type",
label:"",layout:"horizontal-inline",icon_class:"upfront-posts-display_type",values:[{label:o.single_post,value:"single"},{label:o.post_list,value:"list"}]}),p=new Upfront.Views.Editor.Field.Select({model:this.model,property:"list_type",label:"",default_value:"custom",layout:"horizontal",values:[{label:o.post_list_custom,value:"custom"},{label:o.post_list_tax,value:"taxonomy"},{label:o.post_list_generic,value:"generic"}]}),d=new Upfront.Views.Editor.Settings.Item({model:this.model,className:"upfront-display-type-section",title:o.query_settings,fields:[s]}),c=new Upfront.Views.Editor.Settings.Item({model:this.model,className:"upfront-list-type-section",title:o.list_type_label,fields:[p]});s.on("changed",r),p.on("changed",r),i.on("setting:changed",r),n.on("setting:changed",r),i.on("post:added",function(){this.trigger("post:added")},this),i.on("post:removed",function(){this.trigger("post:removed")},this),this.settings=_([d,c,i,n])},title:o.general_settings});var s=Upfront.Views.Editor.Field.Hidden.extend({events:function(){return _.extend({},Upfront.Views.Editor.Field.Hidden.prototype.events,{'click a[href="#add"]':"select_posts"},{'click ul li a[href="#rmv"]':"remove_post"})},get_field_html:function(){var t=Upfront.Views.Editor.Field.Hidden.prototype.get_field_html.apply(this),e=this.get_decoded_values(this.options.property),i="single"===this.model.get_property_value_by_name("display_type"),n=e.length?o.add_custom_post:o.select_custom_post,r=1;return i&&(n=o.select_custom_post,e&&(e=[_(e).first()])),_.isArray(e)&&e.length>0&&(t+='<ul class="upfront-posts-list">',_.each(e,function(e){if(!e)return!1;var n=e.permalink;"undefined"!=typeof e.post_title&&(n=e.post_title),t+=i?'<li><span class="permalink">'+n+'</span><a href="#rmv" data-id="'+e.id+'"><i>&times;</i></a></li>':'<li><span class="post-count">'+r+'</span><span class="permalink">'+n+'</span><a href="#rmv" data-id="'+e.id+'"><i>&times;</i></a></li>',r++}),t+="</ul>"),t+='<i class="upfront-posts-custom-add_post"></i> <a href="#add" class="upfront-add-posts">'+n+"</a>",'<div class="custom_posts">'+t+"</div>"},select_posts:function(t){t.preventDefault(),t.stopPropagation();var e=this;Upfront.Views.Editor.PostSelector.open().done(function(i){if(!i)return!1;var n=i.get("ID"),o=i.get("permalink"),r=i.get("post_title"),s="single"===e.model.get_property_value_by_name("display_type"),a=e.get_decoded_values(e.options.property);s?a=[{id:n,permalink:o,post_title:r}]:(a.push({id:n,permalink:o,post_title:r}),e.select_posts(t)),e.model.set_property(e.options.property,e.encode_values(a)),e.trigger("post:added")})},remove_post:function(e){e.preventDefault(),e.stopPropagation();var i=t(e.target).closest("a").attr("data-id"),n=this.get_decoded_values(this.options.property);n=_(n).reject(function(t){return t.id==i}),this.model.set_property(this.options.property,this.encode_values(n)),this.trigger("post:removed")},get_decoded_values:function(t){if(!t)return[];var e=this.model.get_property_value_by_name(t);return this.decode_values(e)},decode_values:function(t){if(!t)return[];var e=t&&t.length?JSON.parse(decodeURIComponent(t)):[];return e},encode_values:function(t){return encodeURIComponent(JSON.stringify(t))}}),a=Upfront.Views.Editor.Settings.Item.extend({group:!1,_terms_cache:{},events:function(){return _.extend({},Upfront.Views.Editor.Settings.Item.prototype.events,{"click [id*=taxonomy] .upfront-field-select-option":"update_terms"})},initialize:function(t){this.options=t,this.dispatch_settings()},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),t(".upfront-chosen-select",this.$el).chosen({width:"230px"});var e=this.model.get_property_value_by_name("display_type");this.$el.addClass("upfront-display-type-"+e)},dispatch_settings:function(){var t=this.model.get_property_value_by_name("list_type");this.fields=_([]),"custom"===t?this.populate_custom_items():"taxonomy"===t?this.populate_tax_items():this.populate_generic_items()},populate_custom_items:function(){var t=new s({model:this.model,property:"posts_list"});t.on("post:added",function(){this.trigger("post:added")},this),t.on("post:removed",function(){this.trigger("post:removed")},this),this.fields=_([t])},populate_generic_items:function(){this.populate_shared_tax_generic_items(),this.populate_pagination_items()},populate_tax_items:function(){var t=[],e=[],i=this,n=this.model.get_property_value_by_name("display_type");_(r._initial.taxonomies).each(function(e,i){t.push({label:e,value:i})}),_(r._initial.post_types).each(function(t,i){e.push({label:t,value:i})}),this.fields=_([]),this.populate_limit_items(),this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,className:"upfront-post-type",label:o.post_type,property:"post_type",values:e,change:function(t){i.model.set_property("post_type",t),i.trigger("setting:changed")}})),"list"===n&&this.fields.push(new Upfront.Views.Editor.Field.Number({model:this.model,className:"upfront-offset-number",label:o.offset,property:"offset",min:1,max:20,change:function(t){i.model.set_property("offset",t),i.trigger("setting:changed")}})),this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,className:"upfront-post-taxonomy",label:o.taxonomy,property:"taxonomy",values:t,change:function(t){i.model.set_property("taxonomy",t),i.trigger("setting:changed")}})),this.fields.push(new Upfront.Views.Editor.Field.Chosen_Select({model:this.model,className:"upfront-post-term",label:o.term,compact:!0,property:"term",values:[{label:o.select_tax,value:"",disabled:!0}],change:function(t){i.model.set_property("term",t),i.trigger("setting:changed")}})),this.populate_shared_tax_generic_items(),"list"===n&&this.populate_pagination_items(),this.once("rendered",this.update_terms,this),this.once("rendered",function(){this.toggle_offset_based_on_pagination_value(this.model.get_property_value_by_name("pagination"))},this)},populate_limit_items:function(){var t=this;this.model.get_property_value_by_name("display_type");this.fields.push(new Upfront.Views.Editor.Field.Number({className:"upfront-post-limit",model:this.model,label:o.limit,property:"limit",min:1,max:20,change:function(e){t.model.set_property("limit",e),t.trigger("setting:changed")}}))},populate_pagination_items:function(){var t=this.model.get_property_value_by_name("display_type"),e=this;"list"===t&&this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,label:o.pagination,property:"pagination",layout:"horizontal-inline",values:[{label:o.none,value:""},{label:o.numeric,value:"numeric"},{label:o.prev_next,value:"arrows"}],change:function(t){e.toggle_offset_based_on_pagination_value(t),e.model.set_property("pagination",t),e.trigger("setting:changed")}}))},toggle_offset_based_on_pagination_value:function(t){return"taxonomy"===this.model.get_property_value_by_name("list_type")&&void("numeric"===t||"arrows"===t?(this.model.set_property("offset",1,!0),this.hide_offset_field()):this.show_offset_field())},show_offset_field:function(){var t=this.$el.find('input[name="offset"]').closest(".upfront-field-wrap-number");t.show()},hide_offset_field:function(){var t=this.$el.find('input[name="offset"]').closest(".upfront-field-wrap-number");t.hide()},populate_shared_tax_generic_items:function(){var t=this.model.get_property_value_by_name("display_type"),e=this;"list"===t&&this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,property:"sticky",label:o.sticky_posts,values:[{label:o.sticky_ignore,value:""},{label:o.sticky_prepend,value:"prepend"},{label:o.sticky_exclude,value:"exclude"}],change:function(t){e.model.set_property("sticky",t),e.trigger("setting:changed")}})),this.fields.push(new Upfront.Views.Editor.Field.Radios({model:this.model,label:o.result_length,property:"content",layout:"horizontal-inline",values:[{label:o.excerpt,value:"excerpt"},{label:o.full_post,value:"content"}],change:function(t){e.model.set_property("content",t),e.trigger("setting:changed")}}))},update_terms:function(){var t,e=this;if(this.fields.each(function(t){return"term"===t.property_name||void t.property.set({value:t.get_value()},{silent:!1})}),t=this.model.get_property_value_by_name("taxonomy"),!t)return!1;if(this._terms_cache[t]){var i=this._terms_cache[t];return this._spawn_terms_element(i)}Upfront.Util.post({action:"upfront_posts-terms",taxonomy:t}).success(function(i){var n=[];_(i.data).each(function(t,e){n.push({label:t,value:e})}),e._terms_cache[t]=n,e._spawn_terms_element(n)})},_spawn_terms_element:function(t){var e=new Upfront.Views.Editor.Field.Chosen_Select({model:this.model,label:o.term,compact:!0,property:"term",values:t,default_value:this.model.get_property_value_by_name("term")});this.fields._wrapped[4]=e,this.$el.empty(),this.render()}}),l=Upfront.Views.Editor.Settings.Item.extend({className:"upfront-settings-item upfront-thumbnail-size",events:function(){return _.extend({},Upfront.Views.Editor.Settings.Item.prototype.events)},initialize:function(t){this.options=t,this.was_changed=!1,this.populate_thumbnail_size_options(),Upfront.Events.once("element:settings:saved",this.save_custom_thumbnail_sizes,this)},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this)},populate_thumbnail_size_options:function(){var t=this.model.get_property_value_by_name("thumbnail_size"),e=this;this.fields=_([]),this.fields.push(new Upfront.Views.Editor.Field.Select({model:this.model,className:"upfront-field-wrap upfront-field-wrap-radios upfront-thumbnail-size-choices",property:"thumbnail_size",label:"",layout:"horizontal",values:[{label:o.thumbnail_size_thumbnail,value:"thumbnail"},{label:o.thumbnail_size_medium,value:"medium"},{label:o.thumbnail_size_large,value:"large"},{label:o.thumbnail_size_post_feature,value:"uf_post_featured_image"},{label:o.thumbnail_size_custom,value:"uf_custom_thumbnail_size"}],change:function(t){e.was_changed=!0,e.model.set_property("thumbnail_size",t),e.trigger("setting:changed"),e.populate_thumbnail_size_options()}})),"uf_custom_thumbnail_size"===t&&this.populate_thumbnail_custom_sizes(),e.was_changed&&(this.$el.empty(),this.render())},populate_thumbnail_custom_sizes:function(){var t=this;this.fields.push(new Upfront.Views.Editor.Field.Number({model:this.model,className:"upfront-field-wrap upfront-field-wrap-number upfront-thumbnail-custom-width",property:"custom_thumbnail_width",label:o.thumbnail_size_custom_width,min:1,change:function(e){t.model.set_property("custom_thumbnail_width",e),t.trigger("setting:changed")}})),this.fields.push(new Upfront.Views.Editor.Field.Number({model:this.model,className:"upfront-field-wrap upfront-field-wrap-number upfront-thumbnail-custom-height",property:"custom_thumbnail_height",label:o.thumbnail_size_custom_height,min:1,change:function(e){t.model.set_property("custom_thumbnail_height",e),t.trigger("setting:changed")}}))},save_custom_thumbnail_sizes:function(){var t=this.model.get_property_value_by_name("thumbnail_size"),e=this.model.get_property_value_by_name("custom_thumbnail_width"),i=this.model.get_property_value_by_name("custom_thumbnail_height");if("uf_custom_thumbnail_size"===t){var n={action:"upfront_add_custom_thumbnail_size",thumbnail_size:JSON.stringify({name:t,thumbnail_width:e,thumbnail_height:i})};Upfront.Util.post(n)}}});r.PostParts=n.extend({title:o.post_part_settings,initialize:function(t){this.options=t;var e=this,i=_.map(Upfront.data.upfront_posts.default_parts,function(t){return{label:o["part_"+t],value:t}}),n=new d({model:this.model}),r=function(t){this.model.set_property(this.options.property,this.get_value()),this.model.set_property("post_parts",this.get_value(),!1),e.trigger("settings:dispatched")},s=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:"enabled_post_parts",layout:"horizontal-inline",values:i});s.on("changed",r,s),this.settings=_([new p({model:this.model,title:o.post_parts_picker,fields:[s]}),n])}});var p=Upfront.Views.Editor.Settings.Item.extend({className:"uposts-parts-picker-setting"}),d=Upfront.Views.Editor.Settings.Item.extend({group:!1,initialize:function(t){this.options=t,this.fields=_([new c({model:this.model,property:"post_parts",label:o.post_parts_sorter})])}}),c=Upfront.Views.Editor.Field.Hidden.extend({render:function(){Upfront.Views.Editor.Field.Hidden.prototype.render.apply(this),this.$el.append('<ul class="post_parts"></ul>');var t=this,e=this.model.get_property_value_by_name("enabled_post_parts"),n=this.model.get_property_value_by_name(this.options.property),o=[],r=this.$el.find("ul");o=n&&n.length?n:e,_.each(o,function(n,o){if(e.indexOf(n)<0)return!0;var s=i.get_part(n,t.model);s.render(),r.append(s.$el)}),r.sortable({start:function(t,e){r.disableSelection()},stop:function(e,i){var n=r.sortable("toArray",{attribute:"data-part"});t.model.set_property(t.options.property,n,!1),r.enableSelection()}})},get_value:function(){return this.model.get_property_value_by_name(this.options.property)}});return r})}(jQuery),define("text!elements/upfront-widget/tpl/preset-style.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),function(t){define("elements/upfront-posts/js/post-list-settings",["elements/upfront-posts/js/post-list-settings-panels","scripts/upfront/element-settings/settings","scripts/upfront/element-settings/advanced-settings","scripts/upfront/preset-settings/util","text!elements/upfront-widget/tpl/preset-style.html"],function(t,e,i,n,o){var r=Upfront.Settings.l10n.posts_element,s=e.extend({panels:{Appearance:{mainDataCollection:"postsPresets",styleElementPrefix:"posts-preset",ajaxActionSlug:"posts",panelTitle:r.settings,presetDefaults:Upfront.mainData.presetDefaults.posts,styleTpl:o,migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.uposts-object\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")},migrateElementStyle:function(t,e){return t=t.replace(/\.uposts-object/g,"")}}},initialize:function(e){this.constructor.__super__.initialize.call(this,e),this.options=e;var i,n;Upfront.Application.is_single()===!1&&"undefined"!=typeof Upfront.Application.is_plugin_layout()||(i=new t.General({model:this.model}),n=new t.PostParts({model:this.model}),i.on("settings:dispatched",this.rerender,this),i.on("post:removed",this.rerender,this),i.on("post:added",this.rerender,this),n.on("settings:dispatched",this.rerender,this),this.panels=_.extend({General:i,PostParts:n},this.panels))},rerender:function(){var t=-1,e=_(this.panels);e.each(function(e,i){e&&e.is_active&&e.is_active()&&(t=i)}),this.$el.empty(),this.initialize(this.options),this.render(),t.length>=0&&this.toggle_panel&&this.toggle_panel(t)},toggle_panel:function(t){return!(t<0)&&void _.each(this.panels,function(e,i){t===i&&(e||{}).showBody?e.showBody():(e||{}).hideBody&&e.hideBody()})},title:r.posts_settings,get_title:function(){return r.settings}});return n.generatePresetsToPage("posts",o),s})}(jQuery),function(t){define("uposts",["text!elements/upfront-posts/tpl/views.html","elements/upfront-posts/js/post-list-views","elements/upfront-posts/js/post-list-settings"],function(e,i,n){var o=Upfront.Settings.l10n.posts_element,r=(t(e),Upfront.Models.ObjectModel.extend({init:function(){var t=Upfront.data.upfront_posts?_.clone(Upfront.data.upfront_posts):{};t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}})),s=Upfront.Views.ObjectView.extend({init:function(){this.listenTo(Upfront.Events,"csseditor:open",this.on_csseditor_open),this.listenTo(Upfront.Events,"csseditor:closed",this.on_csseditor_closed)},on_render:function(){if(Upfront.Application.is_single()===!1){var t=Upfront.Application.is_plugin_layout();if(t)return void this.$el.find(".upfront-object-content").empty().append("<div>Below is sample content for "+t.pluginName+". Use it as a reference for styling.</div>"+t.content)}var e=this.model.get_property_value_by_name("display_type");this.render_type_view(e),e&&i.DEFAULT!=e&&(this.$el.find("> .upfront-object").css("min-height",""),this.parent_module_view.$el.find("> .upfront-module").css("min-height",""),this.add_region_class("upfront-region-container-has-posts",!0))},render_type_view:function(t){t=t||i.DEFAULT;var e=this,n=i[t]?new i[t]({model:this.model}):new i[i.DEFAULT]({model:this.model});n.element=this,n.render(),this.$el.find(".upfront-object-content").empty().append(n.$el),n._posts_load&&n._posts_load.success(function(){e.adjust_featured_images(),Upfront.Events.trigger("entity:object:refresh",e)})},on_csseditor_open:function(t){t==this.model.get_element_id()&&this.listenTo(Upfront.Application.cssEditor,"updateStyles",this.adjust_featured_images)},on_csseditor_closed:function(t){t==this.model.get_element_id()&&this.stopListening(Upfront.Application.cssEditor,"updateStyles")},adjust_featured_images:function(){this.$el.find(".thumbnail").each(function(){var e,i,n=t(this).height(),o=t(this).width(),r=t(this).find("img");"1"==t(this).attr("data-resize")?(r.css({height:"",width:""}),e=r.height(),i=r.width(),n/o>e/i?r.css({height:"100%",width:"auto",marginLeft:(o-Math.round(n/e*i))/2,marginTop:""}):r.css({height:"auto",width:"100%",marginLeft:"",marginTop:(n-Math.round(o/i*e))/2})):(e=r.height(),n!=e&&r.css("margin-top",(n-e)/2))})},cleanup:function(){this.remove_region_class("upfront-region-container-has-posts",!0)}}),a=Upfront.Views.Editor.Sidebar.Element.extend({render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-posts"),this.$el.html(o.element_name)},add_element:function(){var t=new r,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-posts_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(210)}],objects:[t]});this.add_module(e)}});Upfront.Application.LayoutEditor.add_object("Uposts",{Model:r,View:s,Element:a,Settings:n,cssSelectors:{".uposts-object ul":{label:o.css.container_label,info:o.css.container_info},".uposts-object li":{label:o.css.post_label,info:o.css.post_info},".uposts-object li .date_posted":{label:o.css.date_label,info:o.css.date_info},".uposts-object li .author":{label:o.css.author_label,info:o.css.author_info},".uposts-object li .post_categories":{label:o.css.categories_label,info:o.css.categories_info},".uposts-object li .comment_count":{label:o.css.comment_count_label,info:o.css.comment_count_info},".uposts-object li .content":{label:o.css.content_label,info:o.css.content_info},".uposts-object li .gravatar":{label:o.css.gravatar_label,info:o.css.gravatar_info},".uposts-object li .read_more":{label:o.css.read_more_label,info:o.css.read_more_info},".uposts-object li .post_tags":{label:o.css.post_tags_label,info:o.css.post_tags_info},".uposts-object li .thumbnail":{label:o.css.thumbnail_label,info:o.css.thumbnail_info},".uposts-object li .title":{label:o.css.title_label,info:o.css.title_info}},cssSelectorsId:Upfront.data.upfront_posts.type}),Upfront.Models.PostsModel=r,Upfront.Views.PostsView=s})}(jQuery),define("text!elements/upfront-search/tpl/usearch.html",[],function(){return'<div class="upfront-search">\n\t<form action="<?php echo $action ?>" method="GET">\n\t\t<input type="search" class="search-field search-<?php echo $iconClass ?>" name="s" value="" placeholder="<?php echo $placeholder ?>"/>\n\t\t<?php if($label == \'__image__\') { ?>\n\t\t\t<i class="icon-search"></i>\n\t\t<?php } ?>\n\t\t<?php if($label && $label != \'__image__\') { ?>\n\t\t\t<button class="search-button search-<?php echo $iconClass ?>"><?php echo $label ?></button>\n\t\t<?php } ?>\n    </form>\n\n</div>'}),function(t){define("usearch",["text!elements/upfront-search/tpl/usearch.html"],function(e){var i=Upfront.Settings.l10n.search_element,n=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.usearch.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),o=Upfront.Views.ObjectView.extend({tpl:Upfront.Util.template(e),initialize:function(t){this.model instanceof n||(this.model=new n({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[t])},get_content_markup:function(){var t=this.model.get_property_value_by_name("label"),e={placeholder:this.model.get_property_value_by_name("placeholder"),label:t,action:"/",iconClass:"__image__"==t?"icon":"text",element_id:this.model.get_property_value_by_name("element_id")};return this.tpl(e)},on_render:function(){var t=this.model.get_property_value_by_name("is_rounded"),e=this.model.get_property_value_by_name("color"),i=this.$el.find(".upfront-editable_entity:first");1==t?i.addClass("rounded"):i.removeClass("rounded"),e?i.css("background-color",e):i.css("background-color","")}}),r=Upfront.Views.Editor.Sidebar.Element.extend({priority:200,draggable:!1,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-search"),this.$el.html(i.element_name)},add_element:function(){var t=new n,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-search_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(75)}],objects:[t]});this.add_module(e)}}),s=Upfront.Views.Editor.Settings.Panel.extend({initialize:function(t){this.options=t,this.settings=_([new Upfront.Views.Editor.Settings.Item({model:this.model,title:i.settings,fields:[new Upfront.Views.Editor.Field.Text({model:this.model,property:"placeholder",label:i.placeholder_label})]}),new a({model:this.model})])},get_label:function(){return i.field},get_title:function(){return i.field_settings}}),a=Upfront.Views.Editor.Settings.Item.extend({render:function(){var e=this,n=this.model.get_property_value_by_name("label"),o="__image__"!=n&&""!==n&&n?n:"Custom text",r='<label for="search_type-image"><i class="icon-search"></i></label>',s='<span class="search-search_text'+(""!==n&&"__image__"!==n?" active":"")+'" contenteditable="true">'+o+"</span>";this.wrap({title:i.btn_content,markup:'<input type="radio" id="search_type-image" name="search_type" value="__image__" '+("__image__"==n?'checked="checked"':"")+" /> "+r+'<input type="radio" id="search_type-text" name="search_type" value="'+o+'" '+(""!==n&&"__image__"!==n?'checked="checked"':"")+" /> "+s}),this.$el.find(".search-search_placeholder").on("click",function(){t(this).trigger("input")}),this.$el.find(".search-search_text").on("input",function(){t("#search_type-text").val(t(this).text()).attr("checked",!0),t(this).addClass("active")}),this.$el.on("change","#search_type-image, #search_type-text, #search_type-none",function(){"search_type-text"==t(this).attr("id")&&t(this).prop("checked")?e.$el.find(".search-search_text").addClass("active"):e.$el.find(".search-search_text").removeClass("active")})},get_name:function(){return"label"},get_value:function(){var t=this.$el.find(':radio[name="search_type"]:checked');return t.length?t.val():"__image__"}}),l=Upfront.Views.Editor.Settings.Settings.extend({initialize:function(t){this.has_tabs=!1,this.options=t,this.panels=_([new s({model:this.model})])},get_title:function(){return i.settings}});Upfront.Application.LayoutEditor.add_object("Usearch",{Model:n,View:o,Element:r,Settings:l,cssSelectors:{".upfront-search":{label:i.css.container_label,info:i.css.container_info},"input.search-field":{label:i.css.field_label,info:i.css.field_info},"button.search-button":{label:i.css.button_label,info:i.css.button_info}},cssSelectorsId:Upfront.data.usearch.defaults.type}),Upfront.Models.UsearchModel=n,Upfront.Views.UsearchView=o})}(jQuery),define("text!elements/upfront-slider/tpl/uslider.html",[],function(){return'<div class="uslider slider-preset-<?php echo $preset ?> uslider-<?php echo $controlsWhen ?> uslider-<?php echo $style ?> uslider-<?php echo $transition ?> <?php echo !empty($captionBackground) ? \'uslider-caption-background\' : \'\' ?>"\n  id="uslider-<?php echo $element_id ?>"\n  data-item=".uslide"\n  data-auto="<?php echo $rotate ?>"\n  data-auto_height="<?php echo $production ?>"\n  data-adjust_slide_size="<?php echo $production ?>"\n  data-effect="<?php echo $transition ?>"\n  data-interval="<?php echo $rotateTime * 1000 ?>"\n  data-show_control="<?php echo $controlsWhen ?>"\n  data-control_num="<?php echo $dots /* && $production */ ? 1 : 0 ?>"\n  data-control_next_prev="<?php echo $arrows /* && $production */ ? 1 : 0 ?>"\n  data-starting_slide="<?php echo $startingSlide ?>"\n  data-caption_height="<?php echo $primaryStyle == \'below\' ? 1 : 0 ?>"\n>\n\t<?php if($slidesLength){ ?>\n\t<div class="uslides">\n\t\t<?php for($i=0; $i<$slidesLength; $i++) { ?>\n\t\t<div class="uslide uslide-<?php echo $slides[$i][\'style\'] ?>"\n\t\t\t<?php if($primaryStyle != \'notext\'){ ?>\n\t\t\t\tdata-caption-selector="#uslider-<?php echo $element_id ?> .caption-<?php echo $slides[$i][\'id\'] ?>"\n\t\t\t<?php } ?>\n\t\t\tdata-style="<?php echo $slides[$i][\'style\'] ?>"\n\t\t\tdata-breakpoint=\'<?php echo $slides[$i][\'breakpoint_map\'] ?>\'\n\t\t\trel="<?php echo $slides[$i][\'id\'] ?>">\n\n\t\t\t<?php if($slides[$i][\'url\']){ ?>\n\t\t\t<a href="<?php echo $slides[$i][\'url\'] ?>" target="<?php echo $slides[$i][\'linkTarget\'] ?>" class="uslider-link uslide-image <?php echo $slides[$i][\'urlType\'] == \'image\' ? \' uslider_lightbox_link\' : \'\' ?>">\n\t\t\t<?php } else { ?>\n\t\t\t<div class="uslide-image">\n\t\t\t<?php } ?>\n\t\t\t\t<img src="<?php echo $slides[$i][\'src\'] ?>" style="min-width:100%; min-height:100%;">\n\t\t\t<?php if($slides[$i][\'url\']){ ?>\n\t\t\t</a>\n\t\t\t<?php } else { ?>\n\t\t\t</div>\n\t\t\t<?php } ?>\n\n\t\t</div>\n\t\t<?php } ?>\n\t</div>\n\t<?php if($primaryStyle != \'notext\'){ ?>\n\t<div class="uslider-texts">\n\t\t<?php for($i=0; $i<$slidesLength; $i++) { ?>\n\t\t<div class="uslide-text caption-<?php echo $slides[$i][\'id\'] ?>" rel="<?php echo $slides[$i][\'id\'] ?>" style="background-color:<?php echo !empty($slides[$i][\'captionBackground\']) ? $slides[$i][\'captionBackground\'] : \'transparent\' ?>;color:<?php echo $slides[$i][\'captionColor\'] ?>">\n\t\t\t<div class="uslide-editable-text" placeholder="Slider description">\n\t\t\t\t<?php echo $slides[$i][\'text\'] ?>\n\t\t\t</div>\n\t\t</div>\n\t\t<?php } ?>\n\t</div>\n\t<?php } ?>\n\t<?php } else { ?>\n\t<!-- No images in this slider -->\n\t<?php } ?>\n</div>\n\n<style type="text/css">\n\t/*<?php if($captionUseBackground) { ?>\n\t.uslide .uslide-caption {\n\t\tpadding: 5px 15px;\n\t}\n\t<?php } ?>*/\n\t#uslider-<?php echo $element_id ?> {\n\t\twidth: 100%;\n\t}\n\t#uslider-<?php echo $element_id ?> .uslide-left .uslide-caption,\n\t#uslider-<?php echo $element_id ?> .uslide-right .uslide-caption {\n\t\twidth: <?php echo $textWidth ?>;\n\t}\n\t#uslider-<?php echo $element_id ?> .uslide-right .uslide-caption {\n\t\tmargin-left: <?php echo $imageWidth ?>;\n\t}\n\n\t#uslider-<?php echo $element_id ?> .uslide-right .uslide-image {\n\t\tfloat: left;\n\t}\n\n\t#uslider-<?php echo $element_id ?> .uslide-left .uslide-caption {\n\t\tfloat: left;\n\t}\n\n\t#uslider-<?php echo $element_id ?> .uslide-left .uslide-image {\n\t\tmargin-left: <?php echo $textWidth ?>\n\t}\n\t#uslider-<?php echo $element_id ?> .uslide-left .uslide-caption,\n\t#uslider-<?php echo $element_id ?> .uslide-right .uslide-caption {\n\t\theight: <?php echo $imageHeight ?>px;\n\t}\n\n\t#uslider-<?php echo $element_id ?> .uslide-left .uslide-image,\n\t#uslider-<?php echo $element_id ?> .uslide-right .uslide-image {\n\t\twidth: <?php echo $imageWidth ?>;\n\t}\n\n\t#uslider-<?php echo $element_id ?> .uslide-image {\n\t\theight: <?php echo $imageHeight ?>px;\n\t\tposition: relative;\n\t\toverflow: hidden;\n\t}\n\n\t<?php if ($usingNewAppearance === false) { ?>\n\t#uslider-<?php echo $element_id ?> .uslide-caption {\n\t\tbackground-color:<?php echo !empty($captionBackground) ? $captionBackground : \'transparent\' ?>;\n\t}\n\t<?php } ?>\n</style>\n'}),define("text!elements/upfront-slider/tpl/preset-style.html",[],function(){return"#page .slider-preset-<?php echo $properties['id'] ?> .uslide-caption {\n\t<?php if(!empty($properties['captionBackground'])) { ?>\n\tbackground: <?php echo $properties['captionBackground'] ?>;\n\t<?php } ?>\n}\n\n/* Custom CSS */\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-slider/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-slider/tpl/preset-style.html"],function(t,e,i,n){var o=Upfront.Settings.l10n.slider_element,r={mainDataCollection:"sliderPresets",styleElementPrefix:"slider-preset",ajaxActionSlug:"slider",panelTitle:o.settings,presetDefaults:Upfront.mainData.presetDefaults.slider,styleTpl:n,stateModules:{Global:[{moduleType:"Selectbox",options:{state:"global",default_value:"notext",title:o.slider_styles,custom_class:"slide_style",label:o.image_caption_position,fields:{name:"primaryStyle"},values:[{label:o.notxt,value:"notext",icon:"nocaption"},{label:o.txtb,value:"below",icon:"below"},{label:o.txto,value:"over",icon:"bottomOver"},{label:o.txts,value:"side",icon:"right"}]}},{moduleType:"Colors",options:{title:"Colors",multiple:!1,single:!0,abccolors:[{name:"captionBackground",label:o.caption_bg}]}}]},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-uslider\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,""),t=t.replace(/\.uslides\s\./g,"")},migratePresetProperties:function(t){var e={};this.model.get("properties").each(function(t){e[t.get("name")]=t.get("value")}),t.set({captionBackground:e.captionBackground,primaryStyle:e.primaryStyle})}},s=e.extend({className:"uf-settings-panel upfront-settings_panel upfront-settings_panel_wrap uslider-settings",settings:[{type:"SettingsItem",triggerChange:!0,title:o.slider_behaviour,group:!0,className:"general_settings_item uslider-rotate-settings",fields:[{type:"Checkboxes",property:"rotate",layout:"horizontal-inline",className:"rotate",multiple:!0,default_value:0,values:[{label:o.rotate_every,value:"true"}],change:function(t,e){"true"===t[0]?e.$el.find(".rotate-time").css("opacity","1"):e.$el.find(".rotate-time").css("opacity","0.5")}},{type:"Number",className:"rotate-time",property:"rotateTime",min:1,max:60,step:1,suffix:"sec."},{type:"Select",property:"transition",label:o.slider_transition,layout:"horizontal-inline",icon_class:"upfront-region-field-icon",className:"uslider-transition-setting rotate-effect",default_value:"crossfade",values:[{label:o.slide_down,value:"slide-down",icon:"bg-slider-slide-down"},{label:o.slide_up,value:"slide-up",icon:"bg-slider-slide-up"},{label:o.slide_right,value:"slide-right",icon:"bg-slider-slide-right"},{label:o.slide_left,value:"slide-left",icon:"bg-slider-slide-left"},{label:o.crossfade,value:"crossfade",icon:"bg-slider-crossfade"}]}]},{type:"SettingsItem",triggerChange:!0,title:o.slider_controls,className:"general_settings_item",fields:[{type:"Select",label:o.slider_controls_style,className:"slider-contrls-style",property:"controls",default_value:"arrows",values:[{label:o.dots,value:"dots"},{label:o.arrows,value:"arrows"},{label:o.both,value:"both"}]},{type:"Radios",property:"controlsWhen",layout:"horizontal-inline",default_value:"hover",className:"uslider-controlswhen-setting upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",values:[{label:o.on_hover,value:"hover"},{label:o.always,value:"always"}]}]}],initialize:function(t){this.constructor.__super__.initialize.call(this,t),this.on("rendered",function(){me.toggleColorSetting();var t=!1,e=me.model.get_property_value_by_name("captionBackground"),i=$("<span></span>");setting=me.$(".ugallery-colorpicker-setting"),setting.find(".upfront-field-wrap").append(i),setting.find('input[name="captionUseBackground"]').on("change",function(){me.toggleColorPicker()});var n=new Upfront.Views.Editor.Field.Color({blank_alpha:0,model:me.model,property:"captionBackground",default_value:"#ffffff",
spectrum:{maxSelectionSize:9,localStorageKey:"spectrum.recent_bgs",preferredFormat:"hex",chooseText:o.ok,showInput:!0,allowEmpty:!0,show:function(){t=$(".sp-container:visible")},change:function(t){var i=t.toRgbString();me.model.set_property("captionBackground",i,!0),e=i,me.model.trigger("background",i)},move:function(e){var i=e.toRgbString();t.find(".sp-dragger").css("border-top-color",i),t.parent().find(".sp-dragger").css("border-right-color",i),me.parent_view.for_view.$el.find(".uslide-caption").css("background-color",i)},hide:function(){me.parent_view.for_view.$el.find(".uslide-caption").css("background-color",e)}}});n.render(),i.html(n.el),setting.find(".sp-replacer").css("display","inline-block"),me.toggleColorPicker()}),this.$el.on("change",'input[name="primaryStyle"]',function(t){me.toggleColorSetting()})},toggleColorSetting:function(){var t=this.$(".uslider-style-setting").find("input:checked").val();"notext"==t?this.$(".ugallery-colorpicker-setting").hide():this.$(".ugallery-colorpicker-setting").show()},toggleColorPicker:function(){var t=this.$(".ugallery-colorpicker-setting"),e=t.find("input:checked").val(),i=t.find(".sp-replacer");"1"==e?i.show():i.hide()},title:o.general}),a=e.extend({className:"uf-settings-panel upfront-settings_panel upfront-settings_panel_wrap uslider-slides",settings:[{type:"SettingsItem",group:!1,fields:[{type:"SlidesField"}]}],title:o.slides_order}),l=t.extend({panels:{Layout:s,Slides:a,Appearance:r},title:o.settings});return i.generatePresetsToPage("slider",n),l}),function(t){define("upfront_slider",["text!elements/upfront-slider/tpl/uslider.html","text!elements/upfront-slider/tpl/backend.html","elements/upfront-slider/js/settings","scripts/upfront/preset-settings/util","scripts/upfront/link-model","text!elements/upfront-slider/tpl/preset-style.html"],function(e,i,n,o,r,s){var a=Upfront.Settings.l10n.slider_element,l=Backbone.Model.extend({defaults:Upfront.data.uslider.slideDefaults,get_breakpoint_attr:function(t,e){var i=this.get("breakpoint")||{},n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();return e||(e=n.id),e in i&&t in i[e]&&i[e][t]},set_breakpoint_attr:function(t,e,i){var n=Upfront.Util.clone(this.get("breakpoint")||{}),o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();return i||(i=o.id),_.isObject(n)&&!_.isArray(n)||(n={}),i in n||(n[i]={}),n[i][t]=e,this.set("breakpoint",n)},is_theme_image:function(){return this.get("srcFull")&&this.get("srcFull").match(Upfront.mainData.currentThemePath)}}),p=Backbone.Collection.extend({model:l}),d=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.uslider.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),c=Upfront.Views.ObjectView.extend({self:{},module_settings:{},tpl:Upfront.Util.template(e),startingTpl:_.template(t(i).find("#startingTpl").html()),initialize:function(t){var e=this;this.model instanceof d||(this.model=new d({properties:this.model.get("properties")})),this.first_time_opening_slider=!1,this.presets=new Backbone.Collection(Upfront.mainData.sliderPresets||[]),this.model.view=this,this.constructor.__super__.initialize.call(this,[t]),this.events=_.extend({},this.events,{"click .upfront-image-select":"firstImageSelection","click .upfront-icon-next":"nextSlide","click .upfront-icon-prev":"prevSlide",'change .uslider-starting-options input[type="radio"]':"setSliderType"}),this.updateSlideDefaults(),this.model.slideCollection=new p(this.property("slides")),this.listenTo(this.model.slideCollection,"add remove reset change",this.onSlidesCollectionChange),this.listenTo(this.model,"change",this.onModelChange),this.listenTo(this.model,"addRequest",this.openImageSelector),this.lastStyle=this.get_preset_properties().primaryStyle,this.listenTo(this.model,"background",function(t){e.model.slideCollection.each(function(e){e.set("captionBackground",t)})}),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this),this.listenTo(Upfront.Events,"preset:slider:updated",this.caption_updated,this),this.listenTo(this.model,"preset:updated",this.preset_updated),this.listenTo(Upfront.Events,"upfront:import_image:populate_theme_images",this.populate_theme_images),this.listenTo(Upfront.Events,"upfront:import_image:imported",this.imported_theme_image),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.updateSliderHeight),this.listenTo(Upfront.Events,"command:layout:save",this.saveResizing),this.listenTo(Upfront.Events,"command:layout:save_as",this.saveResizing),this.imageProps={},this.cropHeight=!1,this.cropTimer=!1,this.cropTimeAfterResize=500,this.setCurrentSlide(0);var i=function(t){return Upfront.Application.user_can("MODIFY_PRESET")?void Upfront.Util.post({action:"upfront_save_slider_preset",data:t}).done(function(){e.preset_updated(t.id)}):(e.preset_updated(t.id),!1)};this.debouncedSavePreset=_.debounce(i,1e3),this.delegateEvents()},updateSlideDefaults:function(){var t=this.get_preset_properties().primaryStyle,e={below:"below",over:"bottomOver",side:"right",notext:"nocaption"};Upfront.data.uslider.slideDefaults.style=e[t]},get_preset_properties:function(){var t=this.model.get_property_value_by_name("preset"),e=o.getPresetProperties("slider",t)||{};return e},get_preset_property:function(t){var e=this.get_preset_properties();return!!e[t]&&e[t]},preset_updated:function(t){this.updateSlideDefaults(),Upfront.Events.trigger("preset:slider:updated",t)},caption_updated:function(t){var e=this.model.get_property_value_by_name("preset");e===t&&this.lastStyle!=this.get_preset_property("primaryStyle")&&this.render()},update_colors:function(){var t=this.get_preset_properties();return!(_.size(t)<=0)&&void o.updatePresetStyle("slider",t,s)},on_edit:function(){return!1},populate_theme_images:function(t){this.model.slideCollection.each(function(e){e.is_theme_image()&&t.push(e.get("srcFull"))})},imported_theme_image:function(t){this.model.slideCollection.each(function(e){var i=e.get("srcFull");e.is_theme_image()&&t.filepath===i&&(e.set("id",t.id),e.set("srcFull",t.src))})},get_content_markup:function(){var e,i=this,n={},o=(Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON());if(this.checkStyles(),e=this.extract_properties(),!Upfront.Application.user_can_modify_layout())return"";if(!this.model.slideCollection.length)return this.startingHeight=this.startingHeight||225,this.startingTpl({startingHeight:this.startingHeight,l10n:a});if(e.properties=this.get_preset_properties(),this.property("usingNewAppearance")&&(e.properties.primaryStyle&&(e.primaryStyle=e.properties.primaryStyle),e.properties.captionBackground&&(e.captionBackground=e.properties.captionBackground)),e.rotate=!1,e.dots=_.indexOf(["dots","both"],e.controls)!=-1,e.arrows=_.indexOf(["arrows","both"],e.controls)!=-1,e.slides=this.model.slideCollection.toJSON(),_.each(e.slides,function(t){t.breakpoint_map=JSON.stringify(t.breakpoint),t.breakpoint&&t.breakpoint[o.id]&&t.breakpoint[o.id].style&&(t.style=t.breakpoint[o.id].style)}),e.slidesLength=e.slides.length,e.imageWidth="100%",e.textWidth="100%","side"==e.primaryStyle){var r=Math.round(e.rightImageWidth/e.rightWidth*100);textPercent=Math.round((e.rightWidth-e.rightImageWidth)/e.rightWidth*100),e.imageWidth=r+"%",e.textWidth=textPercent+"%",r+textPercent>100&&(e.textWidth=textPercent-1+"%")}if(e.imageHeight="100%",e.slides.length){var s=i.imageProps[e.slides[0].id];s?e.imageHeight=s.cropSize.height:e.imageHeight=e.slides[0].cropSize.height}e.production=!1,e.startingSlide=this.getCurrentSlide(),e.l10=a,e.usingNewAppearance=e.usingNewAppearance||!1,n=this.tpl(e);var l=t("<div></div>").append(n);return this.model.slideCollection.each(function(t){i.imageProps[t.id]||(i.imageProps[t.id]={size:t.get("size"),cropOffset:t.get("cropOffset"),cropSize:t.get("cropSize")});var e=i.imageProps[t.id],n=l.find(".uslide[rel="+t.id+"]").height(e.size.height).find("img");n.attr("src",t.get("srcFull")).css({position:"absolute",width:e.size.width,height:e.size.height,top:0-e.cropOffset.top,left:0-e.cropOffset.left,"max-width":"none","max-height":"none"}).parent().css({position:"relative",height:i.cropHeight||t.get("cropSize").height,overflow:"hidden"})}),l.html()},on_render:function(){var e=this;setTimeout(function(){var i=e.$el.find(".upfront-output-uslider"),n=i.find(".uslider").data();i.find(".uslides").on("rendered",function(){e.trigger("rendered"),Upfront.Events.trigger("entity:object:refresh",e)}),i.find(".uslides").upfront_default_slider(n),i.find(".uslide-above").each(function(){var e=t(this);e.find(".uslide-caption").remove().prependTo(e)}),i.find(".uslide-left").each(function(){var e=t(this);e.find(".uslide-caption").remove().prependTo(e)}),i.find(".uslide-bottomOver, .uslide-middleCover, .uslide-bottomCover, .uslide-topCover").each(function(){var e=t(this);e.find(".uslide-caption").remove().prependTo(e.find(".uslide-image"))}),e.prepareSlider()},100),e.parent_module_view&&this.model.slideCollection.length&&(this.$el.parent().length||setTimeout(function(){e.on_render()},100),this.update_caption_controls())},update_caption_controls:function(){if(!Upfront.Application.user_can_modify_layout())return!1;var t=this,e=new Upfront.Views.Editor.InlinePanels.Panel;e.items=this.getControlItems(),e.render(),_.delay(function(){t.controls.$el.html(e.$el),t.controls.$el.css("width","auto"),t.updateSlideControls()},400)},hideSliderNavigation:function(){this.$(".upfront-default-slider-nav").hide(),this.$(".upfront-default-slider-nav-prev").hide(),this.$(".upfront-default-slider-nav-next").hide(),this.listenTo(Upfront.Events,"csseditor:open",function(t){t==this.property("element_id")&&(this.$(".upfront-default-slider-nav").show(),this.$(".upfront-default-slider-nav-prev").show(),this.$(".upfront-default-slider-nav-next").show())}).listenTo(Upfront.Events,"csseditor:closed",function(t){t==this.property("element_id")&&(this.$(".upfront-default-slider-nav").hide(),this.$(".upfront-default-slider-nav-prev").hide(),this.$(".upfront-default-slider-nav-next").hide())})},prepareSlider:function(){var e=this,i=(e.$(".uslide-image"),e.$(".uslide-editable-text"));this.model.slideCollection.at(this.getCurrentSlide());e.onSlideShow(),e.$(".uslide").css({height:"auto"}),i.each(function(){var i=t(this);return!!i.data("ueditor")||void i.ueditor({autostart:!1,upfrontMedia:!1,upfrontImages:!1,placeholder:a.slide_desc,linebreaks:!1,inserts:[]}).on("start",function(){var i=t(this).closest(".uslide").attr("rel"),n=e.model.slideCollection.get(i);e.$el.addClass("upfront-editing"),Upfront.Events.trigger("upfront:element:edit:start","text"),t(this).on("syncAfter",function(){n.set("text",t(this).html(),{silent:!0})}).on("stop",function(){n.set("text",t(this).html()),e.property("slides",e.model.slideCollection.toJSON()),e.$el.removeClass("upfront-editing"),Upfront.Events.trigger("upfront:element:edit:stop");var i=t(this).data("ueditor");i.redactor&&i.redactor.events.trigger("cleanUpListeners"),e.render()})})}),"side"==e.get_preset_properties().primaryStyle&&e.setImageResizable(),e.updateSliderHeight()},updateSliderHeight:function(){var t=this.$(".uslide-image"),e=this.model.slideCollection.at(this.getCurrentSlide());if("undefined"!=typeof e){var i="below"==this.get_preset_properties().primaryStyle?this.$(".uslide[rel="+e.id+"]").find(".uslide-caption").outerHeight(!0):0;this.$(".uslides").css({"padding-top":t.outerHeight(!0)+i})}},updateSlideControls:function(){"undefined"!=typeof this.$control_el&&this.$control_el.find(".upfront-element-controls").remove(),"undefined"!=typeof this.controls&&(this.controls=void 0),this.updateControls()},nextSlide:function(t){t.preventDefault(),this.$(".uslides").upfront_default_slider("next")},prevSlide:function(t){t.preventDefault(),this.$(".uslides").upfront_default_slider("prev")},checkStyles:function(){var t=this,e=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),i=this.get_preset_properties().primaryStyle,n={below:"below",over:"bottomOver",side:"right",notxt:"nocaption"};i!=this.lastStyle&&(this.model.slideCollection.each(function(o){var r=e.default?o.get("style"):o.get_breakpoint_attr("style",e.id);("below"==i&&_.indexOf(["below","above"],r)==-1||"over"==i&&_.indexOf(["topOver","bottomOver","topCover","middleCover","bottomCover"],r)==-1||"side"==i&&_.indexOf(["right","left"],r)==-1)&&(e.default?o.set("style",n[i]):o.set_breakpoint_attr("style",n[i],e.id)),"side"!=i&&t.once("rendered",function(){var e=t.$(".uslide[rel="+o.id+"]").find(".uslide-image");t.imageProps[o.id]=t.calculateImageResize({width:e.width(),height:e.height()},o)})}),this.setTimer(),this.lastStyle=i,this.onSlidesCollectionChange())},setSliderType:function(e){var i=t(e.currentTarget).val(),n="default";"over"==i?n="bottomOver":"below"==i?n="below":"side"==i?n="right":"notxt"==i&&(n="nocaption"),this.model.set_property("primaryStyle",i,!0),this.property("style",n)},firstImageSelection:function(t){return t.preventDefault(),this.first_time_opening_slider=!0,this.openImageSelector()},setImageResizable:function(){if(this.model.slideCollection.length){var t,e,i=this,n=this.$(".upfront-default-slider-item-current"),o=n.find(".uslide-image"),r=i.$(".upfront-object").outerWidth(),s=n.find(".uslide-caption"),a=n.attr("rel"),l=this.model.slideCollection.get(a)||this.model.slideCollection.at(this.getCurrentSlide()),p=!1,d=l.get("style");this.$(".ui-resizable").resizable("destroy"),"nocaption"!=d&&o.resizable({handles:"right"==d?"e":"w",helper:"uslider-resize-handler",start:function(n,s){s.element.hasClass("uslide-image")&&(r=i.$(".upfront-object").outerWidth(),t=i.get_element_columns(),e=i.get_element_max_columns_px()/i.get_element_max_columns(),p=o.height(),s.element.parent().closest(".ui-resizable").resizable("disable"),o.resizable("option",{minWidth:3*e,maxWidth:(t-3)*e,grid:[e,100],handles:"right"==d?"e":"w",helper:"uslider-resize-handler",minHeigth:p,maxHeight:p}))},resize:function(t,e){if(e.element.hasClass("uslide-image")){var n=parseInt(i.model.get_breakpoint_property_value("left_padding_use",!0)?i.model.get_breakpoint_property_value("left_padding_num",!0):0,10),a=parseInt(i.model.get_breakpoint_property_value("right_padding_use",!0)?i.model.get_breakpoint_property_value("right_padding_num",!0):0,10),p=parseInt(r-(n+a)),c=e.helper.width(),u=p-c-20,h={width:u},f={width:c};i.calculateImageResize({width:c,height:e.element.height()},l),"right"==d?h["margin-left"]=c:f["margin-left"]=u,s.css(h),o.css(f)}},stop:function(n,r){if(r.element.hasClass("uslide-image")){var s=r.helper.width(),a=s>(t-3)*e?(t-3)*e:s<3*e?3*e:s,l=Math.round((a-(e-15))/e)+1,p=Math.floor(l/t*100);o.css({width:p+"%"}),i.model.slideCollection.each(function(t){"nocaption"!=t.get("style")&&(i.imageProps[t.id]=i.calculateImageResize({width:o.width(),height:r.element.height()},t))}),i.cropHeight=r.element.height(),i.property("rightWidth",t,!0),i.property("rightImageWidth",l,!1),i.setTimer(),i.parent_module_view.$el.children(".upfront-module").resizable("enable")}}})}},setTimer:function(){var t=this;t.cropTimer&&(clearTimeout(t.cropTimer),t.cropTimer=!1),t.cropTimer=setTimeout(function(){var e=t.model.slideCollection.at(t.getCurrentSlide()),i=t.$(".uslide[rel="+e.id+"]").find(".uslide-editable-text");i.length&&i.data("redactor")?i.on("stop",function(){t.saveTemporaryResizing()}):t.saveTemporaryResizing()},t.cropTimeAfterResize)},onSlideShow:function(){var t=this;this.$(".uslides").on("slidein",function(e,i,n){i&&(t.setCurrentSlide(n),t.updateSlideControls(),t.$(".uimage-controls").attr("rel",i.attr("rel")),"side"==t.get_preset_properties().primaryStyle&&t.setImageResizable(),"below"==t.get_preset_properties().primaryStyle&&t.$(".uslides").css({"padding-top":i.find(".uslide-image").outerHeight()+i.find(".uslide-caption").outerHeight()}))})},createControl:function(t,e,i){var n=this,o=new Upfront.Views.Editor.InlinePanels.Control;return o.icon=t,o.tooltip=e,i&&o.on("click",function(t){n[i](t)}),o},createLinkControl:function(){var t,e=this,i=this.model.slideCollection.at(this.getCurrentSlide()),n=new Upfront.Views.Editor.InlinePanels.DialogControl;return this.currentSlideLink&&this.stopListening(this.currentSlideLink),t=new r("undefined"!=typeof i&&"undefined"!=typeof i.get("link")?i.get("link"):{type:i?i.get("urlType"):"",url:i?i.get("url"):"",target:i?i.get("linkTarget"):""}),n.view=linkPanel=new Upfront.Views.Editor.LinkPanel({model:t,linkTypes:{image:!0},imageUrl:i?i.get("srcFull"):""}),this.listenTo(n,"panel:ok",function(){n.close()}),e.listenTo(n,"panel:open",function(){n.$el.closest(".uimage-controls").addClass("upfront-control-visible").end().closest(".uslider-link").removeAttr("href"),e.$el.closest(".ui-draggable").draggable("disable"),e.$(".uimage").sortable("disable")}),e.listenTo(n,"panel:close",function(){n.$el.closest(".uimage-controls").removeClass("upfront-control-visible").end().closest(".uslider-link").attr("href","undefined"!=typeof i?i.get("url"):""),e.$el.closest(".ui-draggable").draggable("enable")}),e.listenTo(t,"change",function(t){i.set({link:t.toJSON()},{silent:!0}),i.set({urlType:t.get("type"),url:t.get("url"),linkTarget:t.get("target")},{silent:!0}),e.property("slides",e.model.slideCollection.toJSON(),!0)}),e.listenTo(t,"change:target",function(t){i.set({link:t.toJSON()},{silent:!0}),i.set({urlType:t.get("type"),url:t.get("url"),linkTarget:t.get("target")},{silent:!0}),e.property("slides",e.model.slideCollection.toJSON(),!0),e.$el.find(".upfront-default-slider-item-current a").attr("target",t.get("target"))}),this.currentSlideLink=t,n.icon="link",n.tooltip=a.img_link,n.id="link",n},getElementColumns:function(){var t,e=this.$el.closest(".upfront-module"),i=!1;return e.length?(t=e.attr("class").split(" "),_.each(t,function(t){t.match(/^c\d+$/)&&(i=t.replace("c",""))}),i||-1):-1},onSlidesCollectionChange:function(){this.property("slides",this.model.slideCollection.toJSON(),!1)},onModelChange:function(){this.stopListeningTo&&(this.stopListeningTo(this.model.slideCollection),this.model.slideCollection=new p(this.property("slides")),this.listenTo(this.model.slideCollection,"add remove reset change",this.onSlidesCollectionChange)),this.render()},openImageSelector:function(t,e){this.updateSlideDefaults();var i=this,n=this.model.slideCollection.length?this.$(".upfront-default-slider-item-current").find(".uslide-image"):this.$(".upfront-object-content"),o=Upfront.Settings.LayoutEditor.Grid.baseline,r=this.model.get_breakpoint_property_value("row",!0),s=r*o,l=parseInt(this.model.get_breakpoint_property_value("top_padding_use",!0)?this.model.get_breakpoint_property_value("top_padding_num",!0):0,10),p=parseInt(this.model.get_breakpoint_property_value("bottom_padding_use",!0)?this.model.get_breakpoint_property_value("bottom_padding_num",!0):0,10),d={multiple:!0,preparingText:a.preparing_img,element_id:this.model.get_property_value_by_name("element_id"),customImageSize:{width:n.width(),height:s-l-p}};t&&t.preventDefault(),Upfront.Views.Editor.ImageSelector.open(d).done(function(t,n){i.addSlides(t,e),i.first_time_opening_slider?(i.addSliderPreset(),i.first_time_opening_slider=!1,setTimeout(function(){Upfront.Views.Editor.ImageSelector.close()},1500)):Upfront.Views.Editor.ImageSelector.close()})},addSliderPreset:function(){var t=this.model.get_property_value_by_name("primaryStyle"),e=this.model.get_property_value_by_name("element_id");if("default"===t)return!1;var i=o.getPresetProperties("slider","default")||{},n=_.isEmpty(i)?Upfront.mainData.presetDefaults.slider:i,r=n.preset_style||"",s=e+" preset",a=s.toLowerCase().replace(/ /g,"-"),l=_.extend(n,{id:a,name:s,primaryStyle:t,preset_style:r.replace(/ .default/g," ."+a+" "),theme_preset:!1});this.presets.add(l),this.model.set_property("preset",l.id,!0),this.updateSliderPreset(l),this.model.encode_preset(l.id)},updateSliderPreset:function(t){o.updatePresetStyle("slider",t,s),this.debouncedSavePreset(t),Upfront.mainData.sliderPresets=[],_.each(this.presets.models,function(t,e){Upfront.mainData.sliderPresets.push(t.attributes)})},addSlides:function(t,e){var i=[];_.each(t,function(t,e){var n={sizes:t,id:e,srcFull:t.full[0],status:"ok"};t.custom&&!t.custom.error?(n.src=t.custom.url,n.size=t.custom.editdata.resize,n.cropSize=t.custom.crop,n.cropOffset=t.custom.editdata.crop):(n.src=t.full[0],n.size={width:t.full[1],height:t.full[2]}),i.push(n)}),e?(this.model.slideCollection.get(e).set(i[0]),this.onSlidesCollectionChange()):this.model.slideCollection.add(i)},calculateColumnWidth:function(){return this.colWidth=Upfront.Behaviors.GridEditor.col_size},on_element_resize_start:function(t){var e=this.get_preset_properties(),i=this.property("style");"undefined"!=typeof e&&"side"===e.primaryStyle||(_.indexOf(["nocaption","below","above","right","left"],i)==-1?this.$(".uslider-caption").fadeOut("fast"):"right"!=i&&"left"!=i||this.$(".uslide").css({height:"100%"}))},on_element_resizing:function(t){if(this.model.slideCollection.length){var e=this.get_preset_properties();if("undefined"==typeof e||"side"!==e.primaryStyle){var i=this,n=this.$(".upfront-default-slider-item-current"),o="below"==this.get_preset_properties().primaryStyle?n.find(".uslide-caption"):[],r=o.length?o.height():0,s=Upfront.Settings.LayoutEditor.Grid.column_padding,a=parseInt(this.model.get_breakpoint_property_value("top_padding_num")||s,10)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||s,10),l={width:parseInt(t.width,10),height:parseInt(t.height,10)-2*a-r},p=n.find(".uslide-image"),d=this.get_preset_properties().primaryStyle,c={width:"side"==d?p.width():l.width,height:l.height},u={height:c.height};"side"==d?n.find(".uslide-caption").height(l.height):u.width=c.width,p.css(u).closest(".uslide").height(l.height).closest(".uslides").css({"padding-top":l.height}),this.model.slideCollection.each(function(t){i.calculateImageResize(c,t)})}}},on_element_resize:function(t){if(this.model.slideCollection.length){var e=this.get_preset_properties();if("undefined"==typeof e||"side"!==e.primaryStyle){var i=this,n=this.$(".upfront-default-slider-item-current").find(".uslide-image"),o="below"==this.get_preset_properties().primaryStyle?n.find(".uslide-caption"):[],r=o.length?o.height():0,s=Upfront.Settings.LayoutEditor.Grid.column_padding,a=parseInt(this.model.get_breakpoint_property_value("top_padding_num")||s,10)+parseInt(this.model.get_breakpoint_property_value("bottom_padding_num")||s,10),l={width:parseInt(t.width,10),height:parseInt(t.height,10)-2*a-r},p=t.col,d=Math.max(3,Math.round(this.property("rightImageWidth")*p/this.property("rightWidth"))),c=d*this.calculateColumnWidth();this.model.slideCollection.each(function(t){var e={height:l.height};e.width="side"==i.get_preset_properties().primaryStyle&&"nocaption"!=t.get("style")?c:l.width,i.imageProps[t.id]=i.calculateImageResize(e,t)}),i.cropHeight=l.height,i.setTimer()}}},calculateImageResize:function(t,e){var i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n={size:e.get("size"),cropOffset:e.get("cropOffset"),cropSize:e.get("cropSize")};if(!i.default)return n;var o,r,s=this.$(".uslide[rel="+e.id+"]").find("img"),a=(s.position(),e.get("size")),l=e.get("cropOffset"),p={top:-l.top,left:-l.left},d=(a.width/a.height,t.width/t.height,a.width/a.height>t.width/t.height?"height":"width");return"height"==d&&t.height>a.height?(o=t.height/a.height*a.width,s.css({width:o,height:t.height,top:0,left:Math.min(0,Math.max(p.left,t.width-a.width))})):"width"==d&&t.width>a.width?(r=t.width/a.width*a.height,s.css({width:t.width,height:r,left:0,top:Math.min(0,Math.max(p.top,t.height-a.height))})):"height"==d?(o=t.height/a.height*a.width,s.css({width:o,height:t.height,top:0,left:Math.min(0,Math.max(p.left,t.width-a.width))})):(r=t.width/a.width*a.height,s.css({width:t.width,height:r,left:0,top:Math.min(0,Math.max(p.top,t.height-a.height))})),s.closest(".uslide-image").width(Math.min(s.width(),t.width)).height(Math.min(s.height(),t.height)),{size:{width:s.width(),height:s.height()},cropOffset:{left:0-s.position().left,top:0-s.position().top},cropSize:t}},saveTemporaryResizing:function(){var t=this,e=[],i={action:"upfront-media-image-create-size"},n={},o=this.model.get_property_value_by_name("element_id");return this.model.slideCollection.each(function(i){var r,s=t.imageProps[i.id],a=s.cropOffset;a.width=s.cropSize.width,a.height=s.cropSize.height,r={id:i.id,element_id:o,rotate:i.get("rotation"),resize:s.size,crop:a},e.push(r),n[i.id]=r}),i.images=e,Upfront.Util.post(i).done(function(e){var i=e.data.images;_.each(i,function(e,i){if(!0!==e.error){var o=t.model.slideCollection.get(i),r=n[i];o.set({src:e.url,srcFull:e.urlOriginal,size:r.resize,cropSize:{width:r.crop.width,height:r.crop.height},cropOffset:{left:r.crop.left,top:r.crop.top}},{silent:!0})}}),clearTimeout(t.cropTimer),t.cropTimer=!1,t.imageProps={},t.onSlidesCollectionChange()})},saveResizing:function(){var t=this,e="undefined"!=typeof _upfront_post_data.post_id&&_upfront_post_data.post_id,i="undefined"!=typeof _upfront_post_data.layout?_upfront_post_data.layout:"",n=_upfront_storage_key!=_upfront_save_storage_key?1:0;this.cropTimer&&this.saveTemporaryResizing().done(function(){var o={element:JSON.stringify(Upfront.Util.model_to_json(t.model)),post_id:e,layout_ids:i,load_dev:n,action:"upfront_update_layout_element"};Upfront.Util.post(o).done()})},onRemoveSlide:function(t){this.removeSlide()},removeSlide:function(){if(this.startingHeight=this.$(".upfront-slider").height(),confirm(a.delete_slide_confirm)){var t=this.getCurrentSlide();this.setCurrentSlide(t>0?t-1:0),this.model.slideCollection.remove(this.model.slideCollection.at(t).id)}},getCurrentSlide:function(){return this.currentSlide},setCurrentSlide:function(t){this.currentSlide=t},imageEditMask:function(e){var i=this,n=(t(e.target).closest(".uimage-controls"),this.model.slideCollection.at(this.getCurrentSlide())),o=this.model.slideCollection.get(n.id),r=this.getEditorOptions(o);if("ok"!=o.get("status")){var s={multiple:!1,preparingText:a.preparing_slides,element_id:i.model.get_property_value_by_name("element_id")};return Upfront.Views.Editor.ImageSelector.open(s).done(function(t,e){i.addSlides(t);var n=i.model.slideCollection.indexOf(o);i.model.slideCollection.remove(o,{silent:!0});var r=i.model.slideCollection.at(i.model.slideCollection.length-1);i.model.slideCollection.remove(r,{silent:!0}),i.model.slideCollection.add(r,{at:n}),Upfront.Views.Editor.ImageSelector.close()})}e.preventDefault(),Upfront.Views.Editor.ImageEditor.open(r).done(function(t){o.set({src:t.src,srcFull:t.srcFull,cropSize:t.cropSize,size:t.imageSize,cropOffset:t.imageOffset,margin:{left:Math.max(0-t.imageOffset.left,0),top:Math.max(0-t.imageOffset.top,0)},rotation:t.rotation,id:t.imageId}),i.imageProps[o.id]={cropOffset:t.imageOffset,size:t.imageSize,cropSize:t.cropSize},i.render()}).fail(function(t){t&&"changeImage"==t.reason&&i.openImageSelector(null,t.id)})},getEditorOptions:function(t){var e=this.$(".uslide[rel="+t.id+"]").find(".uslide-image"),i=e.find("img"),n=t.get("sizes").full,o={width:i.width(),height:i.height()},r={left:0-i.position().left,top:0-i.position().top},s=this.model.get_property_value_by_name("element_id");return{id:t.id,element_id:s,element_cols:Upfront.Util.grid.width_to_col(e.width(),!0),maskSize:{width:e.width(),height:e.height()},maskOffset:e.offset(),position:r,size:o,fullSize:{width:n[1],height:n[2]},src:t.get("src"),srcOriginal:n[0],rotation:t.get("rotation")}},postTypes:function(){var t=[];return _.each(Upfront.data.ugallery.postTypes,function(e){"attachment"!=e.name&&t.push({name:e.name,label:e.label})}),t},cleanup:function(){this.controls&&(this.controls.remove(),this.controls=!1)},extract_properties:function(){var t=this.model.get("properties").toJSON(),e={};return _.each(t,function(t){e[t.name]=t.value}),e.preset=e.preset||"default",e},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},getControlItems:function(){if(!this.model.slideCollection.length)return _([]);var t=this,e=new Upfront.Views.Editor.InlinePanels.SubControl,i=this.model.slideCollection,n={above:["above",a.above_img],below:["below",a.below_img],nocaption:["nocaption",a.no_text]},o={topOver:["topOver",a.over_top],bottomOver:["bottomOver",a.over_bottom],topCover:["topCover",a.cover_top],middleCover:["middleCover",a.cover_mid],bottomCover:["bottomCover",a.cover_bottom],nocaption:["nocaption",a.no_text]},r={right:["right",a.at_right],left:["left",a.at_left],nocaption:["nocaption",a.no_text]},s=this.get_preset_property("primaryStyle"),l={},p=new Upfront.Views.Editor.InlinePanels.TooltipControl,d=i.at(this.getCurrentSlide());p.sub_items={},p.wrapperClass="slider-caption-second-level",l="below"==s?n:"over"==s?o:"side"==s&&r,l&&(_.each(l,function(e,i){p.sub_items[i]=t.createControl(e[0],e[1])}),p.icon="caption",p.tooltip=a.cap_position,p.selected=l[d.get("style")]?d.get("style"):"nocaption",this.listenTo(p,"select",function(e){var i=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();i.default?d.get("style"):d.get_breakpoint_attr("style",i.id);i.default?d.set("style",e):d.set_breakpoint_attr("style",e,i.id),t.onSlidesCollectionChange()})),e.icon="more",e.tooltip=a.cap_position,e.sub_items={},e.sub_items.add=this.createControl("add",a.add_slide,"openImageSelector"),e.sub_items.crop=this.createControl("crop",a.edit_img,"imageEditMask"),e.sub_items.remove=this.createControl("remove",a.remove_slide,"onRemoveSlide"),l&&(e.sub_items.caption=p),e.sub_items.link=this.createLinkControl();var c=_([e,this.createPaddingControl(),this.createControl("settings",a.settings,"on_settings_click")]);return l||(c=_(c.without(p))),c}}),u=Upfront.Views.Editor.Sidebar.Element.extend({priority:40,draggable:!0,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-slider"),this.$el.html(a.element_name)},add_element:function(){var t=new d,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c10 upfront-slider_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(255)}],objects:[t]});t.init_property("row",Upfront.Util.height_to_row(255)),this.add_module(e)}});Upfront.Application.LayoutEditor.add_object("USlider",{Model:d,View:c,Element:u,Settings:n,cssSelectors:{".uslide-image img":{label:a.css.images_label,info:a.css.images_info},".uslide-image":{label:a.css.img_containers_label,info:a.css.img_containers_info},".uslide-caption":{label:a.css.captions_label,info:a.css.captions_info},".wp-caption":{label:a.css.caption_label,info:a.css.caption_info},".upfront-default-slider-nav":{label:a.css.dots_wrapper_label,info:a.css.dots_wrapper_info},".upfront-default-slider-nav-item":{label:a.css.dots_label,info:a.css.dots_info},".uslider-dotnav-current":{label:a.css.dot_current_label,info:a.css.dot_current_info},".upfront-default-slider-nav-prev":{label:a.css.prev_label,info:a.css.prev_info},".upfront-default-slider-nav-next":{label:a.css.next_label,info:a.css.next_info}},cssSelectorsId:Upfront.data.uslider.defaults.type}),Upfront.Models.USliderModel=d,Upfront.Views.USliderView=c})}(jQuery),define("text!elements/upfront-social-media/tpl/social-back.html",[],function(){return'<div>\n\n<script type="text/template" id="service-tpl">\n\t<li class="upfront-field-multiple">\n\t\t{[ if(expandable){ ]}\n\t\t\t<i class="usocial-global-triangle"></i>\n\t\t{[ } ]}\n\t\t<i class="upfront-field-icon upfront-field-icon-social-sort"></i>\n\t\t<input type="checkbox" id="service-{{service.id}}" name="" value="{{service.id}}" class="upfront-field-checkbox"{{service.active ? \' checked="checked"\' : \'\' }}>\n\t\t<label for="service-{{service.id}}">\n\t\t\t<span class="upfront-field-label-text">{{service.name}}</span>\n\t\t</label>\n\t\t{[ if(expandable){ ]}\n\t\t<div class="upfront-field-wrap upfront-field-wrap-text" title="link address" style="display:none">\n\t\t\t<input type="text" class="upfront-field upfront-field-text usocial_text usocial_url" id="service-url-{{service.id}}" name="{{service.id}}_url" value="{{service.url}}" placeholder="{{service.name}} url" data-field="url" data-service="{{service.id}}">\n\t\t\t{[if(service.meta){_.each(service.meta, function(meta){ ]}\n\t\t\t<input type="text" class="upfront-field upfront-field-text usocial_text usocial_{{meta.id}} usocial_service_meta" id="service-{{meta.id}}-{{service.id}}" name="{{meta.id}}" value="{{meta.value}}" placeholder="{{service.name}} {{meta.name}}" data-field="{{meta.id}}" data-service="{{service.id}}">\n\t\t\t{[ });} ]}\n\t\t</div>\n\t\t{[ } ]}\n\t</li>\n</script>\n\n<script type="text/template" id="add-service-tpl">\n\t{[ if(services.length){ ]}\n\t<div class="upfront-field-wrap upfront-field-wrap-select">\n\t\t<label class="usocial-select-label">{{ l10n.add_new }}</label>\n\t\t<div class="usocial-select upfront-field-select upfront-field-select-single usocial-select-closed" id="">\n\t\t\t<ul class="usocial-select-list">\n\t\t\t\t{[ _.each(services, function(service){  ]}\n\t\t\t\t<li class="upfront-field-select-option">\n\t\t\t\t\t<label for="service-{{service.id}}">\n\t\t\t\t\t\t<span class="upfront-field-label-text">{{service.name}}</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<input type="radio" id="service-{{service.id}}" name="select" class="upfront-field-radio" value="{{service.id}}"{{services[0].name == service.name ? \' checked="checked"\' : \'\'}} >\n\t\t\t\t</li>\n\t\t\t\t{[ }) ]}\n\t\t\t</ul>\n\t\t</div>\n\t\t<i class="upfront-field-icon upfront-field-icon-social-add usocial-add"></i>\n\t</div>\n\t{[ } ]}\n</script>\n\n<script type="text/template" id="global-tpl">\n\t<div class="upfront-global-social-settings">\n\t\t<div class="upfront-settings-item">\n      <div class="upfront-settings-item-title"><span>{{ l10n.set_accounts }}</span></div>\n\t\t\t<div class="upfront-settings-item-content">\n\t\t\t\t<ul class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes social_media_services_list ui-sortable">\n\t\t\t\t\t{[ _.each(services, function(service){ ]}\n\t\t\t\t\t<li class="upfront-field-multiple upfront-field-multiple-selected">\n\t\t\t\t\t\t<i class="usocial-global-triangle"></i>\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-social-sort"></i>\n\t\t\t\t\t\t<input type="checkbox" id="social_global_{{service.id}}" name="services" value="{{service.id}}" class="upfront-field-checkbox" {{service.active ? \'checked="checked"\' : \'\'}}>\n\t\t\t\t\t\t<label for="social_global_{{service.id}}">\n\t\t\t\t\t\t\t<span class="upfront-field-label-text">{{service.name}}</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<div class="upfront-field-wrap upfront-field-wrap-text" title="link address" style="display:none">\n\t\t\t\t\t\t\t<input type="text" class="upfront-field upfront-field-text" id="{{service.id}}-url" name="{{service.id}}-url" value="{{service.url}}" placeholder="{{service.name}} url">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t{[ }) ]}\n\t\t\t\t</ul>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="upfront-settings-item">\n      <div class="upfront-settings-item-title"><span>{{ l10n.in_post }}</span></div>\n\t\t\t<div class="upfront-settings-item-content">\n\t\t\t\t<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes">\n\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-selected">\n\t\t\t\t\t\t<input type="checkbox" id="usocial-global-add_to_post" name="inpost" value="yes" class="upfront-field-checkbox" {{inpost.length ? \'checked="checked"\' : \'\'}}>\n\t\t\t\t\t\t<label for="usocial-global-add_to_post">\n\t\t\t\t\t\t\t<span class="upfront-field-label-text">{{ l10n.counter_to_all }}</span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="">\n\t\t\t\t<label for="usocial-global_after_title" class="upfront-field-label upfront-field-label-block">{{ l10n.location }}</label>\n\t\t\t\t<div class="usocial-global-add-post">\n\t\t\t\t\t<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes">\n\n\t\t\t\t\t\t<span class="upfront-field-multiple {{after_title.length ? \'upfront-field-multiple-selected\' : \'\' }}">\n\t\t\t\t\t\t\t<input type="checkbox" id="usocial-global-after_title" name="after_title" value="yes" class="upfront-field-checkbox usocial_post_location" {{after_title.length ? \'checked="checked"\' : \'\'}}>\n\t\t\t\t\t\t\t<label for="usocial-global-after_title">\n\t\t\t\t\t\t\t\t<span class="upfront-field-label-text">{{ l10n.after_title }}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios">\n\t\t\t\t\t\t<i class="usocial-align-icon upfront-field-icon upfront-field-icon-social-title-align"></i>\n\t\t\t\t\t\t<div class="usocial-global-align {{after_title.length ? \'align-active\' : \'\'}}">\n\t\t\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t\t\t\t<input type="radio" id="usocial-global-align-0" name="after_title_align" value="left" class="upfront-field-radio" {{after_title_align == \'left\' ? \'checked="checked"\' : \'\'}} {{after_title.length ? \'\' : \'disabled="disabled"\'}}>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t\t\t\t<input type="radio" id="usocial-global-align-1" name="after_title_align" value="center" class="upfront-field-radio" {{after_title_align == \'center\' ? \'checked="checked"\' : \'\'}} {{after_title.length ? \'\' : \'disabled="disabled"\'}}>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t\t\t\t<input type="radio" id="usocial-global-align-2" name="after_title_align" value="right" class="upfront-field-radio" {{after_title_align == \'right\' ? \'checked="checked"\' : \'\'}} {{after_title.length ? \'\' : \'disabled="disabled"\'}}>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<label class="usocial-global-align-label" for="after_content_align">{{ l10n.aligned }} {{after_title_align}}</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="usocial-global-add-post">\n\t\t\t\t\t<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes">\n\t\t\t\t\t\t<span class="upfront-field-multiple {{after_content.length ? \'upfront-field-multiple-selected\' : \'\' }}">\n\t\t\t\t\t\t\t<input type="checkbox" id="usocial-global-after_content" name="after_content" value="yes" class="upfront-field-checkbox usocial_post_location" {{after_content.length ? \'checked="checked"\' : \'\'}}>\n\t\t\t\t\t\t\t<label for="usocial-global-after_content">\n\t\t\t\t\t\t\t\t<span class="upfront-field-label-text">{{ l10n.after_content }}</span>\n\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios">\n\t\t\t\t\t\t<i class="usocial-align-icon upfront-field-icon upfront-field-icon-social-content-align"></i>\n\t\t\t\t\t\t<div class="usocial-global-align {{after_content.length ? \'align-active\' : \'\'}}">\n\t\t\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t\t\t\t<input type="radio" id="usocial-global-align-0" name="after_content_align" value="left" class="upfront-field-radio" {{after_content_align == \'left\' ? \'checked="checked"\' : \'\'}} {{after_content.length ? \'\' : \'disabled="disabled"\'}}>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t\t\t\t<input type="radio" id="usocial-global-align-1" name="after_content_align" value="center" class="upfront-field-radio" {{after_content_align == \'center\' ? \'checked="checked"\' : \'\'}} {{after_content.length ? \'\' : \'disabled="disabled"\'}}>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t\t\t\t<input type="radio" id="usocial-global-align-2" name="after_content_align" value="right" class="upfront-field-radio" {{after_content_align == \'right\' ? \'checked="checked"\' : \'\'}} {{after_content.length ? \'\' : \'disabled="disabled"\'}}>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<label class="usocial-global-align-label" for="after_content_align">{{ l10n.aligned }} {{after_content_align}}</label>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios">\n\t\t\t\t<label for="usocial-global-counter_style" class="upfront-field-label upfront-field-label-block">{{ l10n.counter_style }}</label>\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline">\n\t\t\t\t\t<input type="radio" id="usocial-global-counter_style-0" name="counter_style" value="horizontal" class="upfront-field-radio" {{counter_style == \'horizontal\' ? \'checked="checked"\' : \'\'}}>\n\t\t\t\t\t<label for="usocial-global-counter_style-0">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-social-count-horizontal"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text"></span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t\t<span class="upfront-field-multiple upfront-field-multiple-horizontal-inline upfront-field-multiple-selected">\n\t\t\t\t\t<input type="radio" id="usocial-global-counter_style-1" name="counter_style" value="vertical" class="upfront-field-radio" {{counter_style == \'vertical\' ? \'checked="checked"\' : \'\'}}>\n\t\t\t\t\t<label for="usocial-global-counter_style-1">\n\t\t\t\t\t\t<i class="upfront-field-icon upfront-field-icon-social-count-vertical"></i>\n\t\t\t\t\t\t<span class="upfront-field-label-text"></span>\n\t\t\t\t\t</label>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</script>\n\n<script type="text/template" id="fb_like-tpl">\n<div data-id="upfront-icon-facebook" class="upfront-social-icon upfront-social-icon-facebook">\n\t<iframe class="social-frame usocial-fb {{style}} like" src="//www.facebook.com/plugins/like.php?href={{url}}&amp;send=false&amp;layout={{layout}}&amp;width={{width}}px&amp;show_faces=true&amp;font&amp;colorscheme=light&amp;action=like&amp;height={{height}}px" scrolling="no" frameborder="0" style="border:none; overflow:hidden;" allowTransparency="true"></iframe>\n</div>\n</script>\n<script type="text/template" id="tweet-tpl">\n<div data-id="upfront-icon-twitter" class="upfront-social-icon upfront-social-icon-twitter">\n\t<iframe class="social-frame usocial-twitter {{style}} like" allowtransparency="true" frameborder="0" scrolling="no" src="//platform.twitter.com/widgets/tweet_button.html?text={{text}}&amp;url={{url}}&amp;original_referer={{url}}&amp;count={{style}}&amp;size=medium" style=""></iframe>\n</div>\n</script>\n<script type="text/template" id="plusone-tpl">\n<div data-id="upfront-icon-google" class="upfront-social-icon social-frame usocial-google {{style}} like upfront-social-icon-google">\n\t<script type="text/javascript" src="//apis.google.com/js/plusone.js"></{{\'s\'}}cript>\n\t<div class="g-plusone" data-size="{{size}}"></div>\n</div>\n</script>\n\n\n</div>\n';
}),function(t){define("upfront-social_media",["text!elements/upfront-social-media/tpl/social-back.html"],function(e){var i=Upfront.Settings.l10n.social_element,n=Backbone.View.extend({popup:!1,deferred:!1,model:!1,tpl:_.template(t(e).find("#global-tpl").html()),events:{"click .use":"store","click li":"revealUrl","change input[name=services]":"toggleService","change .usocial_post_location":"changePostLocation","change input[name=after_title_align]":"changeAlign","change input[name=after_content_align]":"changeAlign"},popupFunc:function(){return this.open()},isOpen:function(){return t(".upfront-global-social-settings").length},open:function(){return console.log("Global social settings"),this.popup=Upfront.Popup.open(function(){}),this.deferred=t.Deferred(),this.setElement(t("#upfront-popup")),settings=_.clone(Upfront.data.usocial.globals?Upfront.data.usocial.globals:Upfront.data.usocial.global_defaults),settings.l10n=i.template,this.$("#upfront-popup-top").html('<ul class="upfront-tabs"><li class="active upfront-social-popup-hd">'+i.global_settings+"</li></ul>"),this.$("#upfront-popup-bottom").html('<div class="use_selection_container"><a href="#use" class="use">'+i.ok+"</a></div>"),this.$("#upfront-popup-content").html(this.tpl(settings)),this.setDraggableUp(),this.deferred.promise()},setDraggableUp:function(){this.$("ul").sortable({handle:".upfront-field-icon-social-sort"})},store:function(e){e.preventDefault();var n=this,o={inpost:this.$('input[name="inpost"]:checked').length?["yes"]:[],after_title:this.$('input[name="after_title"]:checked').length?["yes"]:[],after_title_align:this.$('input[name="after_title_align"]:checked').val(),after_content:this.$('input[name="after_content"]:checked').length?["yes"]:[],after_content_align:this.$('input[name="after_content_align"]:checked').val(),counter_style:this.$('input[name="counter_style"]:checked').val()},r=[],s=!1;this.$(".social_media_services_list").find("input[type=checkbox]").each(function(e,i){var o=t(i),s={id:o.val(),active:o.is(":checked"),meta:Upfront.data.usocial.global_defaults.services[o.val()].meta};s.name=Upfront.data.usocial.global_defaults.services[s.id].name,s.url=n.$('input[name="'+s.id+'-url"]').val(),r.push(s)}),o.services=r,s=this.arrayToProperties(o);var a=new Upfront.Views.Editor.Loading({loading:i.saving,fixed:!1});a.render(),this.$("#upfront-popup-content").css("position","relative").append(a.$el),Upfront.Util.post({action:"usocial_save_globals",data:JSON.stringify(s)}).success(function(t){a.cancel(),Upfront.Popup.close(),Upfront.Views.Editor.notify(i.updated),Upfront.data.usocial.globals=o,n.deferred.resolve(o)}).error(function(t){Upfront.Util.log("Error Saving settings")})},revealUrl:function(e){var i=t(e.target).hasClass("usocial-global-triangle")?t(e.target).closest("li"):t(e.target),n=i.parent().find(".open");n.removeClass("open").find(".upfront-field-wrap-text").slideUp("fast"),n[0]!=i[0]&&i.addClass("open").find(".upfront-field-wrap-text").slideDown("fast")},toggleService:function(e){e.preventDefault();var i=t(e.target),n=t(e.target).closest("li");input=n.find("input[type=text]"),!i.is(":checked")||input.val()||input.is(":visible")||(e.target=n[0],this.revealUrl(e),input.focus())},changePostLocation:function(e){var i=t(e.target),n=i.is(":checked"),o=i.closest(".usocial-global-add-post");n?(i.parent().addClass("upfront-field-multiple-selected"),o.find(".usocial-global-align").addClass("align-active").find("input[type=radio]").attr("disabled",!1)):(i.parent().removeClass("upfront-field-multiple-selected"),o.find(".usocial-global-align").removeClass("align-active").find("input[type=radio]").attr("disabled",!0))},changeAlign:function(e){var n=t(e.target),o=n.is(":checked");o&&n.closest(".upfront-field-wrap").find(".usocial-global-align-label").text(i.aligned+" "+n.val())},arrayToProperties:function(t){var e=[];return _.each(t,function(t,i){e.push({name:i,value:t})}),e}});Upfront.data.social.panel=new n;var o=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(this.getDefaults());t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)},getDefaults:function(){var t=Upfront.data.usocial.globals,e=Upfront.data.usocial.defaults,i=[],n=[],o={};if(!t)return e;_.each(t.services,function(t){i.push(t.id),t.active&&n.push(t.id),o[t.id]=t.url});var r=_.clone(t.services);return r.push({id:"linked-in",name:"Linked in",active:!1,url:"",meta:{}}),r.push({id:"pinterest",name:"Pinterest",active:!1,url:"",meta:{}}),r.push({id:"youtube",name:"Youtube",active:!1,url:"",meta:{}}),_.extend({},e,{services:t.services,button_services:r,counter_options:t.counter_style})}}),r=Upfront.Views.ObjectView.extend({settings:!1,counts:!1,initialize:function(){this.model instanceof o||(this.model=new o({properties:this.model.get("properties")})),Upfront.Views.ObjectView.prototype.initialize.call(this),Upfront.Events.on("entity:drag_stop",this.dragStop,this)},dragStop:function(t,e){var i=this;this.parent_module_view!=t||Upfront.data.usocial.globals||Upfront.data.social.panel.isOpen()||(Upfront.data.social.panel.open().done(function(t){var e=i.model.getDefaults();_.each(e,function(t,e){i.model.set_property(e,t,!0)}),i.model.trigger("change")}),console.log("No globals"))},property:function(t,e){return"undefined"!=typeof e?this.model.set_property(t,e):this.model.get_property_value_by_name(t)},buttons:function(){var t=this.property("button_services"),e=this.property("button_style"),n=this.property("button_size"),o="";return t.length?(_.each(t,function(t){var i=t.url?"":'<span class="alert-url">!</span>';t.active&&(o+='<div class="upfront-'+t.id+"-link-box upfront-social-icon upfront-"+e+" usocial-button-"+n+'"><a class="usocial-button '+t.id+'-link" href="'+t.url+'"></a>'+i+"</div>")}),o):'<span class="upfront-general-notice">'+i.add_some_services+"</span>"},fans:function(){var t=this,e=this.property("services"),n="",o=(this.property("button_style"),this.property("button_size"),{facebook:i.fans,twitter:i.followers,google:i.subscribers});return _(e).each(function(e){if(e.active){var i=e.url?"":'<span class="alert-url">!</span>',r=t.getCount(e);n+='<div data-id="upfront-icon-'+e.id+'" class="ufront-'+e.id+'-count-box upfront-social-icon usocial_count_wrapper"><a class="upfront-fan-counts '+e.id+'-count" href="'+e.url+'">'+i+' <span class="upfront-fan-count"><strong class="usocial_count">'+r+"</strong> "+o[e.id]+"</span></a></div>"}}),n?(this.refreshCount(),n):'<span class="upfront-general-notice">'+i.add_some_services+"</span>"},getCount:function(t){var e=this,i=t.id,n=!1,o=this.property("element_id");return"undefined"!=typeof usocial&&usocial.counts&&usocial.counts[o]&&usocial.counts[o][t.id]||(n=!0),n?(this.counts?this.counts.done(function(t){var n=t.data[i];e.$el.find('div[data-id="upfront-icon-'+i+'"]').find("strong.usocial_count").html(n)}):this.refreshCount(),"Loading"):usocial.counts[o][t.id]},refreshCount:function(){var t=this;this.counts=Upfront.Util.post({action:"usocial_get_counts",element_id:this.property("element_id"),services:t.property("services")}).done(function(e){_.each(e.data,function(e,i){t.$el.find('div[data-id="upfront-icon-'+i+'"]').find("strong.usocial_count").html(e)})})},rawUrlEncode:function(t){return t=(t+"").toString(),encodeURIComponent(t).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},likes:function(){var n=this.property("counter_options"),o=this.property("services"),r="";if(o.length){var s="horizontal"==n,a={url:this.rawUrlEncode(location.href),style:n,width:s?90:70,height:s?20:60,size:s?"medium":"tall",layout:s?"button_count":"box_count",text:document.title?document.title:i.awesome_stuff,l10n:i.template},l={facebook:"fb_like-tpl",twitter:"tweet-tpl",google:"plusone-tpl"};_.each(o,function(i){if(i.active){var n=_.template(t(e).find("#"+l[i.id]).html());r+=n(a)}})}return r?r:'<span class="upfront-general-notice">'+i.select_some+"</span>"},get_content_markup:function(){if(!Upfront.data.usocial.globals)return'<span class="upfront-general-notice">'+i.no_global_settings_nag+"</span>";var t=this,e=this.property("social_type"),n="";switch(e){case"likes":n=t.likes();break;case"fans":n=t.fans();break;case"buttons":n=t.buttons()}return this.$el.html(n),n}}),s=(Upfront.Views.Editor.Sidebar.Element.extend({priority:60,draggable:!1,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-social"),this.$el.html(i.element_name)},add_element:function(){var t=new o,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c8 upfront-social-media_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(60)}],objects:[t]});this.add_module(e)}}),Upfront.Views.Editor.Settings.Item.extend({events:function(){return _.extend({},s.prototype.events,{"click .social-toggle":"social_toggle"})},social_toggle:function(){this.fields._wrapped[0].$el.toggle()},render:function(){this.$el.empty(),this.group?this.$el.append('<div class="upfront-settings-item"><div class="upfront-settings-item-title"><span>'+this.get_title()+'</span></div><div class="upfront-settings-item-content"><span class="social-toggle">'+i.drag_reorder+'</span><span class="social-sort"></span></div></div>'):this.$el.append('<div class="upfront-settings-item-content"></div>');var t=this.$el.find(".upfront-settings-item-content");this.fields.each(function(e){e.render(),t.append(e.el)}),this.trigger("rendered")}})),a=Upfront.Views.Editor.Field.Field.extend({events:{"click a":"buttonClicked"},render:function(){this.$el.html(this.get_field_html())},get_field_html:function(){return'<i class="upfront-field-icon upfront-field-icon-social-back"></i><span class="upfront-back-global-settings-info">'+this.options.info+' <a href="#">'+this.options.label+"</a></span>"},buttonClicked:function(t){this.options.on_click&&this.options.on_click(t)},isProperty:!1}),l=Upfront.Views.Editor.Field.Field.extend({className:"",tpl:_.template(t(e).find("#service-tpl").html()),variableTpl:_.template(t(e).find("#add-service-tpl").html()),events:{"click .usocial-global-triangle":"toggleService","click .usocial-select":"showServiceList","blur .usocial-select":"hideServiceList","click .upfront-field-select-option":"selectService","click .usocial-add":"addService","change input[type=checkbox]":"changeService","blur input.usocial_text":"updateServiceMeta"},initialize:function(t){var e=this;e.options=t,l.__super__.initialize.apply(this,arguments),this.$el.on("click",function(t){e.hideServiceList(t)})},render:function(){var t=this,e=[],n=this.prop(this.options.prop);this.$el.html('<ul class="upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes social_media_services_list"></ul>'),_.each(n,function(n){t.options.variable&&!n.active||t.$("ul").append(t.tpl({service:n,expandable:t.options.expandable,meta:t.options.meta,l10n:i.template})),n.active||e.push(n)}),this.initSortable(),this.options.variable&&this.$el.append(this.variableTpl({services:e,l10n:i.template})),this.trigger("rendered")},toggleService:function(e){var i=t(e.target).siblings(".upfront-field-wrap-text");i.is(":visible")?i.slideUp("fast"):i.slideDown("fast")},showServiceList:function(e){console.log("Show"),e.preventDefault(),e.stopPropagation(),t(e.currentTarget).removeClass("usocial-select-closed").focus()},hideServiceList:function(t){this.$(".usocial-select").addClass("usocial-select-closed")},selectService:function(e){if(!this.$(".usocial-select").hasClass("usocial-select-closed")){e.preventDefault(),e.stopPropagation();var i=t(e.currentTarget).detach();this.$(".usocial-select-list").prepend(i),this.$(".usocial-select").addClass("usocial-select-closed")}},addService:function(e){e.preventDefault();var n=this.$(".usocial-select-list").find("input").first().val(),o=this.prop(this.options.prop),r={};_.each(o,function(t){t.id==n&&(t.active=!0,r=t)}),this.prop(this.options.prop,o,!0);var s=t(this.tpl({service:r,expandable:this.options.expandable,l10n:i.template})).hide().find(".upfront-field-wrap-text").show().end();this.$(".social_media_services_list").append(s),s.slideDown("fast").find("input[type=text]").focus(),this.$(".usocial-select-list").find("li").first().remove()},changeService:function(e){var i=t(e.target),n=i.val(),o=this.prop(this.options.prop);if(_.each(o,function(t){t.id==n&&(t.active=i.is(":checked"))}),this.prop(this.options.prop,o,!1),i.is(":checked")&&this.options.expandable){var r=i.parent().find("input[type=text]");r.val()||(i.siblings(".upfront-field-wrap-text").slideDown(),r.focus())}this.model.trigger("change")},initSortable:function(){var t=this;this.$("ul").sortable({start:function(t,e){},stop:function(t,e){},update:function(e,i){t.updateOrder()}})},updateOrder:function(){this.save(!0)},updateServiceMeta:function(e){var i=t(e.target),n=i.data("field"),o=i.val(),r=this.serv(i.data("service"));if(o||i.closest("li").find("input[type=checkbox]").attr("checked",!1),!r)return console.log("Unknown service couldn't be saved");if("url"==n)r.url=o;else{var s=r.meta;for(var a in s)s[a].id==n&&(s[a].value=o);r.meta=s}this.serv(i.data("service"),r,!1)},save:function(e){var i=this,n=this.prop(this.options.prop),o={},r=this.$(".ui-sortable").find("input[type=checkbox]"),s=[],a=[];_.each(n,function(t){o[t.id]=t}),"undefined"==typeof e&&(e=!1),r.each(function(n,r){var l=t(r),p=o[l.val()];if(p){if(!e&&(p.active=l.is(":checked"),i.options.expandable)){var d=l.closest("li");p.url=d.find("input[name="+p.id+"_url]").val(),p.meta.length&&_.each(p.meta,function(t){t.value=d.find("input[name="+t.id+"]").val()})}a.push(p),s.push(p.id)}}),_.each(n,function(t){s.indexOf(t.id)==-1&&a.push(t)}),this.prop(this.options.prop,a,!1)},serv:function(t,e,i){var n=this.prop(this.options.prop);if("undefined"==typeof e){for(var o in n)if(n[o].id==t)return n[o];return!1}var r=!1;for(var s in n)n[s].id==t&&(n[s]=e,r=!0);r||n.push(e),"undefined"==typeof i&&(i=!0),this.prop(this.options.prop,n,i)},prop:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)}});Upfront.Views.Editor.Settings.Settings.extend({panel:!1,servicesItems:[],events:{"change input[type=radio]":"changeRadio"},initialize:function(t){this.options=t,this.panel=new Upfront.Views.Editor.Settings.Panel({model:this.model,label:i.opts.layout_label,title:i.opts.layout_title,tabbed:!0,settings:[new Upfront.Views.Editor.Settings.ItemTabbed({model:this.model,title:i.opts.action,radio:!0,icon:"social-like",property:"social_type",value:"likes",is_default:!0,settings:this.getLikesSettings()}),new Upfront.Views.Editor.Settings.ItemTabbed({model:this.model,title:i.opts.counts,radio:!0,icon:"social-count",property:"social_type",value:"fans",settings:this.getFansSettings()}),new Upfront.Views.Editor.Settings.ItemTabbed({model:this.model,title:i.opts.cta,radio:!0,icon:"social-button",property:"social_type",value:"buttons",settings:this.getButtonsSettings()})]}),this.panels=_([new Upfront.Views.Editor.Settings.Panel({model:this.model,label:i.opts.general_label,title:i.opts.general_title,settings:[]}),this.panel]),this.panel.on("upfront:settings:panel:saved",this.saveServices,this)},getLikesSettings:function(){var t=new l({model:this.model,prop:"services",expandable:!1});return this.servicesItems.push(t),[new Upfront.Views.Editor.Settings.Item({model:this.model,title:i.opts.counter,fields:[new Upfront.Views.Editor.Field.Radios({model:this.model,property:"counter_options",layout:"horizontal-inline",label:"",values:[{label:"",value:"horizontal",icon:"social-count-horizontal"},{label:"",value:"vertical",icon:"social-count-vertical"}]})]}),new s({className:"upfront-social-services-item",model:this.model,title:i.opts.services,fields:[t]}),this.getGlobalsButton()]},getFansSettings:function(){var t=new l({model:this.model,prop:"services",meta:!0,expandable:!0});return this.servicesItems.push(t),[new s({className:"upfront-social-services-item",model:this.model,title:i.opts.services,fields:[t]}),this.getGlobalsButton()]},getButtonsSettings:function(){var t=new l({model:this.model,prop:"button_services",expandable:!0,variable:!0});return this.servicesItems.push(t),[new Upfront.Views.Editor.Settings.Item({model:this.model,title:i.opts.button_size,fields:[new Upfront.Views.Editor.Field.Radios({model:this.model,property:"button_size",layout:"vertical",label:"",values:[{label:i.opts.small,value:"small"},{label:i.opts.medium,value:"medium"},{label:i.opts.large,value:"large"}]})]}),new Upfront.Views.Editor.Settings.Item({model:this.model,title:i.opts.button_style,fields:[new Upfront.Views.Editor.Field.Radios({model:this.model,property:"button_style",layout:"horizontal-inline",label:"",values:[{label:"",value:"button-style-1",icon:"social-button-style-1"},{label:"",value:"button-style-2",icon:"social-button-style-2"},{label:"",value:"button-style-3",icon:"social-button-style-3"}]})]}),new s({className:"upfront-social-services-item",model:this.model,title:i.opts.services,fields:[t]}),this.getGlobalsButton()]},getGlobalsButton:function(){return new Upfront.Views.Editor.Settings.Item({className:"upfront-social-back",group:!1,fields:[new a({model:this.model,info:i.opts.back_to,label:i.global_settings,on_click:function(t){t.preventDefault(),Upfront.Events.trigger("entity:settings:deactivate"),Upfront.data.social.panel.popupFunc()}})]})},changeRadio:function(e){var i=t(e.target),n=i.attr("name"),o=this.$el.find("input[name="+n+"]:checked").val();this.model.set_property(n,o)},get_title:function(){return i.opts.social_settings},render:function(){var t=this;Upfront.data.usocial.globals?this.constructor.__super__.render.call(this):Upfront.data.social.panel.open().done(function(e){_.each(e,function(e,i){t.model.set_property(i,e,!0)}),t.model.trigger("change")})},saveServices:function(){console.log("Saving services"),_.each(this.servicesItems,function(t){t.$el.is(":visible")&&t.save()}),this.model.trigger("change")}});Upfront.Models.SocialMediaModel=o,Upfront.Views.SocialMediaView=r})}(jQuery),define("elements/upfront-tabs/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.utabs.defaults),e=Upfront.data.utabs.defaults;t.tabs=[],t.tabs[0]={},t.tabs[0].content=_.clone(e.tabs[0].content),t.tabs[0].title=_.clone(e.tabs[0].title),t.tabs[1]={},t.tabs[1].content=_.clone(e.tabs[1].content),t.tabs[1].title=_.clone(e.tabs[1].title),t.element_id=Upfront.Util.get_unique_id("utabs-object"),this.init_properties(t)}});return t}),define("elements/upfront-tabs/js/element",["elements/upfront-tabs/js/model"],function(t){var e=Upfront.Settings.l10n.utabs_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:130,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-tabs"),this.$el.html(e.element_name)},add_element:function(){var e=new t,i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c9 upfront-tabs_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(225)}],objects:[e]});this.add_module(i)}});return i}),define("text!elements/upfront-tabs/tpl/preset-style.html",[],function(){return"#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover, \n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover .inner-box,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab .inner-box\n{\n\t<?php if(!empty($properties['hover-use-color'])) { ?>\n\t\t<?php if(!empty($properties['hover-tab-bg'])) { ?>background: <?php echo $properties['hover-tab-bg'] ?>; <?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['hover-use-typography'])) { ?>\n\t\t<?php if(!empty($properties['hover-font-color'])) { ?>color: <?php echo $properties['hover-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover-font-family'])) { ?>font-family: <?php echo $properties['hover-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['hover-font-size'])) { ?>font-size: <?php echo $properties['hover-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['hover-weight'])) { ?>font-weight: <?php echo $properties['hover-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover-style'])) { ?>font-style: <?php echo $properties['hover-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['hover-line-height'])) { ?>line-height: <?php echo $properties['hover-line-height']  ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab:hover,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-hover .tabs-tab {\n\t<?php if(!empty($properties['hover-useborder'])) { ?>\n        <?php if(!empty($properties['hover-borderwidth']) && !empty($properties['hover-bordertype']) && !empty($properties['hover-bordercolor'])) { ?>border: <?php echo $properties['hover-borderwidth'] ?>px <?php echo $properties['hover-bordertype'] ?> <?php echo $properties['hover-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active, \n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active .inner-box,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab .inner-box {\n\t<?php if(!empty($properties['active-use-color'])) { ?>\n\t\t<?php if(!empty($properties['active-tab-bg'])) { ?>background: <?php echo $properties['active-tab-bg'] ?>; <?php } ?>\n\t<?php } ?>\n\t<?php if(!empty($properties['active-use-typography'])) { ?>\n\t\t<?php if(!empty($properties['active-font-color'])) { ?>color: <?php echo $properties['active-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['active-font-family'])) { ?>font-family: <?php echo $properties['active-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['active-font-size'])) { ?>font-size: <?php echo $properties['active-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['active-weight'])) { ?>font-weight: <?php echo $properties['active-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['active-style'])) { ?>font-style: <?php echo $properties['active-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['active-line-height'])) { ?>line-height: <?php echo $properties['active-line-height']  ?>;<?php } ?>\n\t<?php } else { ?>\n\t\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php } ?>\n\ttransition: none;\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab.tabs-tab-active,\n#page .upfront-tabs.<?php echo $properties['id']  ?>.live-preview-active .tabs-tab {\n\t<?php if(!empty($properties['active-useborder'])) { ?>\n        <?php if(!empty($properties['active-borderwidth']) && !empty($properties['active-bordertype']) && !empty($properties['active-bordercolor'])) { ?>border: <?php echo $properties['active-borderwidth'] ?>px <?php echo $properties['active-bordertype'] ?> <?php echo $properties['active-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab, #page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab .inner-box {\n\t<?php if(!empty($properties['static-tab-bg'])) { ?>background: <?php echo $properties['static-tab-bg'] ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-color'])) { ?>color: <?php echo $properties['static-font-color']  ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-family'])) { ?>font-family: <?php echo $properties['static-font-family']  ?>; <?php } ?>\n\t<?php if(!empty($properties['static-font-size'])) { ?>font-size: <?php echo $properties['static-font-size']  ?>px; <?php } ?>\n\t<?php if(!empty($properties['static-weight'])) { ?>font-weight: <?php echo $properties['static-weight']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-style'])) { ?>font-style: <?php echo $properties['static-style']  ?>;<?php } ?>\n\t<?php if(!empty($properties['static-line-height'])) { ?>line-height: <?php echo $properties['static-line-height']  ?>;<?php } ?>\n\t<?php if(!empty($properties['hover-use-transition'])) { ?>\n\t\ttransition: all <?php echo $properties['hover-transition-duration']  ?>s <?php echo $properties['hover-transition-easing']  ?>;\n\t<?php } else { ?>\n\t\ttransition: none;\n\t<?php } ?>\n}\n#page .upfront-tabs-container.tab-preset-<?php echo $properties['id']  ?> .tabs-tab{\n\t<?php if(!empty($properties['static-useborder'])) { ?>\n        <?php if(!empty($properties['static-borderwidth']) && !empty($properties['static-bordertype']) && !empty($properties['static-bordercolor'])) { ?>border: <?php echo $properties['static-borderwidth'] ?>px <?php echo $properties['static-bordertype'] ?> <?php echo $properties['static-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n.tab-preset-<?php echo $properties['id']  ?> .utabs-content {\n\t<?php if(!empty($properties['global-content-bg'])) { ?>background: <?php echo $properties['global-content-bg'] ?>; <?php } ?>\n\t<?php if(!empty($properties['global-useborder'])) { ?>\n        <?php if(!empty($properties['global-borderwidth']) && !empty($properties['global-bordertype']) && !empty($properties['global-bordercolor'])) { ?>border: <?php echo $properties['global-borderwidth'] ?>px <?php echo $properties['global-bordertype'] ?> <?php echo $properties['global-bordercolor'] ?>;<?php } ?>\n    <?php } else { ?>\n        border: none;\n    <?php } ?>\n}\n\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),define("elements/upfront-tabs/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/preset-settings/util","text!elements/upfront-tabs/tpl/preset-style.html"],function(t,e,i){var n=Upfront.Settings.l10n.utabs_element,o=t.extend({panels:{Appearance:{mainDataCollection:"tabPresets",styleElementPrefix:"tab-preset",ajaxActionSlug:"tab",panelTitle:n.settings,presetDefaults:Upfront.mainData.presetDefaults.tab,styleTpl:i,stateModules:{Global:[{moduleType:"Colors",options:{title:n.content_area_colors_label,multiple:!1,single:!0,abccolors:[{name:"global-content-bg",label:n.content_area_bg_label}]}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"global-useborder",width:"global-borderwidth",type:"global-bordertype",color:"global-bordercolor"}}}],Static:[{moduleType:"Colors",options:{title:n.colors_label,multiple:!1,single:!0,abccolors:[{name:"static-tab-bg",label:n.tab_bg_label}]}},{moduleType:"Typography",options:{title:n.tab_typography_label,state:"static",toggle:!1,fields:{typeface:"static-font-family",fontstyle:"static-font-style",weight:"static-weight",style:"static-style",size:"static-font-size",line_height:"static-line-height",color:"static-font-color"}}},{moduleType:"Border",options:{state:"static",title:"",fields:{use:"static-useborder",width:"static-borderwidth",type:"static-bordertype",color:"static-bordercolor"}}}],Hover:[{moduleType:"Colors",options:{title:n.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-color"},abccolors:[{name:"hover-tab-bg",label:n.tab_bg_label}]}},{moduleType:"Typography",options:{title:n.tab_typography_label,state:"hover",toggle:!0,prepend:"hover-",prefix:"static",fields:{use:"hover-use-typography",typeface:"hover-font-family",fontstyle:"hover-font-style",weight:"hover-weight",style:"hover-style",size:"hover-font-size",line_height:"hover-line-height",color:"hover-font-color"}}},{moduleType:"Border",options:{state:"hover",title:"",prepend:"hover-",prefix:"static",fields:{use:"hover-useborder",width:"hover-borderwidth",type:"hover-bordertype",color:"hover-bordercolor"}}},{moduleType:"HovAnimation",options:{state:"hover",title:"",toggle:!0,fields:{use:"hover-use-transition",duration:"hover-transition-duration",easing:"hover-transition-easing"}}}],Active:[{moduleType:"Colors",options:{title:n.colors_label,multiple:!1,single:!0,toggle:!0,prepend:"active-",prefix:"static",fields:{use:"active-use-color"},abccolors:[{name:"active-tab-bg",label:n.tab_bg_label}]}},{moduleType:"Typography",options:{title:n.tab_typography_label,state:"active",toggle:!0,prepend:"active-",prefix:"static",fields:{use:"active-use-typography",typeface:"active-font-family",fontstyle:"active-font-style",weight:"active-weight",style:"active-style",size:"active-font-size",line_height:"active-line-height",color:"active-font-color"}}},{moduleType:"Border",options:{state:"active",title:"",prepend:"active-",prefix:"static",fields:{use:"active-useborder",width:"active-borderwidth",type:"active-bordertype",color:"active-bordercolor"}}}]},migrateElementStyle:function(t,e){return t=t.replace(/\.upfront-tabs-container/g,".tabs-wrapper")},migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-tabs\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")},migratePresetProperties:function(t){var e=this.property("preset")?this.clear_preset_name(this.property("preset")):"default",i=this.presets.findWhere({id:e}),n={};"undefined"!=typeof i&&_.each(i.attributes,function(t,e){"id"!==e&&"name"!==e&&"preset_style"!==e&&"legacy"!==e&&(n[e]=t)}),t.set(n),t.set({"active-tab-bg":"rgba(255,255,255, 0)","static-tab-bg":"rgba(255,255,255, 0)","hover-tab-bg":"rgba(255,255,255, 0)","static-useborder":"","hover-useborder":"","active-useborder":"","global-content-bg":"rgba(255,255,255, 0)","global-useborder":""})}}},title:n.settings});return e.generatePresetsToPage("tab",i),o}),define("text!elements/upfront-tabs/tpl/utabs.html",[],function(){return'<div class="upfront-tabs-container tab-preset-<?php echo $preset ?>">\r\n  <div class="tabs-wrapper">\r\n    <div class="tabs-menu-wrapper">\r\n      <div class="tabs-menu">\r\n        <?php for ($i = 0; $i < $tabs_count; $i++) { ?>\r\n        <div class="tabs-tab  <?php if($i === 0) { ?>tabs-tab-active<?php } ?>" data-content-id="<?php echo $element_id ?>-<?php echo $i ?>">\r\n          <div class="inner-box">\r\n            <?php echo $tabs[$i][\'title\'] ?>\r\n          </div>\r\n          <?php if (!empty($show_remove)) { ?>\r\n          <i></i>\r\n          <?php } ?>\r\n        </div>\r\n        <?php } ?>\r\n      </div>\r\n    </div>\r\n    <div class="utabs-content" >\r\n      <?php for ($i = 0; $i < $tabs_count; $i++) { ?>\r\n      <div id="<?php echo $element_id ?>-<?php echo $i ?>" class="utab-content <?php if($i === 0) { ?>utab-content-active<?php } ?>"><?php echo $tabs[$i][\'content\'] ?></div>\r\n      <?php } ?>\r\n    </div>\r\n  </div>\r\n</div>\r\n';
}),function(t){define("utabs",["elements/upfront-tabs/js/model","elements/upfront-tabs/js/element","elements/upfront-tabs/js/settings","scripts/upfront/preset-settings/util","text!elements/upfront-tabs/tpl/utabs.html","text!elements/upfront-tabs/tpl/preset-style.html"],function(e,i,n,o,r,s){var a=Upfront.Settings.l10n.utabs_element;t("body").off("touchstart click",".tabs-tab");var l=Upfront.Views.ObjectView.extend({model:e,currentTabId:!1,tabsTpl:Upfront.Util.template(r),elementSize:{width:0,height:0},initialize:function(){this.model instanceof e||(this.model=new e({properties:this.model.get("properties")}));var t=this.property("tabs");_.each(t,function(e,i){""===e.title.trim()&&(t[i].title=a.tab_label+" "+(i+1))}),this.property("tabs",t),this.events=_.extend({},this.events,{"click .tabs-tab":"onTabClick","keydown .tabs-tab[contenteditable=true]":"onTabKeydown","click .utab-content-active":"onContentClick","click i":"deleteTab","dblclick .utab-content:not(.redactor-editor)":"startContentEditor"}),this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(Upfront.Events,"theme_colors:update",this.update_colors,this)},update_colors:function(){var t=this.model.get_property_value_by_name("preset"),e=o.getPresetProperties("tab",t)||{};return!(_.size(e)<=0)&&void o.updatePresetStyle("tab",e,s)},onContentClick:function(){this.$el.find(".tabs-tab-active .inner-box").trigger("blur")},addTab:function(t){t.preventDefault(),this.property("tabs").push({title:a.tab_label+" "+(1+this.property("tabs_count")),content:a.content_label+" "+(1+this.property("tabs_count"))}),this.property("tabs_count",this.property("tabs").length,!1),this.render()},deleteTab:function(e){if(!Upfront.Application.user_can_modify_layout())return!1;var i=t(e.currentTarget),n=i.parents(".tabs-tab"),o=t(n).data("content-id").split("-").pop();this.property("tabs").splice(o,1),this.property("tabs_count",this.property("tabs_count")-1,!1)},onTabClick:function(e){var i=t(e.currentTarget);i.siblings().removeClass("tabs-tab-active").end().addClass("tabs-tab-active"),t("#"+i.data("content-id")).siblings().removeClass("utab-content-active").end().addClass("utab-content-active"),Upfront.Application.user_can_modify_layout()&&(this.$el.find(".utab-content").each(function(){var e=t(this).data("ueditor");e&&e.active&&e.stop()}),this.$el.find(".tabs-tab:not(.tabs-tab-active) .inner-box").each(function(){var e=t(this).data("ueditor");e&&e.active&&t(this).trigger("blur")}))},saveTabContent:function(t){if(!Upfront.Application.user_can_modify_layout())return!1;var e=t.attr("id").split("-").pop(),i=t.data("ueditor"),n="";try{n=i.getValue(!0)}catch(e){n=t.html()}this.currentTabId=t.attr("id"),this.property("tabs")[e].content=n,this.render()},stopEdit:function(e){var i=this.$el.find(".utab-content-active"),n=i.data("ueditor");if(n&&n.active&&n.stop(),"undefined"==typeof e||!t(e.target).hasClass("inner-box")){var o=this.$el.find(".tabs-tab-active .inner-box:not(.ueditor-placeholder)");o.trigger("blur")}},onTabKeydown:function(e){var i;13===e.keyCode&&(e.preventDefault(),t(e.currentTarget).removeAttr("contenteditable"),i=t(e.currentTarget).data("content-id").split("-").pop(),this.property("tabs")[i].title=t(e.currentTarget).text(),this.addTooltips(),t(e.currentTarget).find("i").size()<1&&t(e.currentTarget).append("<i></i>"))},get_content_markup:function(){var t=this.extract_properties();return t.show_add=!0,t.show_remove=this.property("tabs_count")>1,t.preset=t.preset||"default",this.tabsTpl(t)},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t},on_render:function(){_.delay(function(t){t.addTooltips()},10,this);var e,i=this,n=this.$el.find(".tabs-tab .inner-box");Upfront.Application.user_can_modify_layout()?i.initializeTabTitleEditor(n):this.$el.find(".tabs-tab i").remove(),Upfront.Application.user_can_modify_layout()&&(e=this.$el.find(".utab-content"),e.each(function(){i.initializeContentEditor(t(this))}));this.$el.find(".upfront-object-content");this.$el.find("div#"+this.currentTabId).addClass("utab-content-active").siblings().removeClass("utab-content-active"),this.$el.find(".tabs-tab").removeClass("tabs-tab-active"),this.$el.find('div.tabs-tab[data-content-id="'+this.$el.find("div.utab-content-active").attr("id")+'"]').addClass("tabs-tab-active"),Upfront.Events.trigger("entity:object:refresh",this)},initializeTabTitleEditor:function(e){var i=this;e.each(function(){var e=t(this);count++,e.ueditor({linebreaks:!1,disableLineBreak:!0,placeholder:!1,air:!1,autostart:!1,focus:!1}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start","text"),t(this).focus()}).on("stop",function(){var t=e.parent().parent().data("content-id").split("-").pop(),n=e.data("ueditor");""===n.getValue(!0).trim()?(i.property("tabs")[t].title=a.tab_label+" "+count,setTimeout(function(){e.text(a.tab_label+" "+count)},50)):i.property("tabs")[t].title=n.getValue(!0).trim(),Upfront.Events.trigger("upfront:element:edit:stop"),i.currentTabId=e.closest(".tabs-tab-active").data("content-id"),i.render()}).on("keydown",function(t){if(9===t.which||13===t.which)return t.preventDefault(),t.stopImmediatePropagation(),!1})})},startContentEditor:function(e){if(!Upfront.Application.user_can_modify_layout())return!1;var i=t(e.currentTarget).data("ueditor");i&&!i.active&&i.start()},initializeContentEditor:function(t){if(!Upfront.Application.user_can_modify_layout())return!1;var e=this;t.ueditor({linebreaks:!1,autostart:!1,paragraphize:!1,focus:!1,placeholder:!1}).on("start",function(){Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){e.stopContentEdit(t)})},stopContentEdit:function(t){return!!Upfront.Application.user_can_modify_layout()&&(""===t.text().trim()&&t.html(a.tab_placeholder),this.saveTabContent(t),void Upfront.Events.trigger("upfront:element:edit:stop"))},addTooltips:function(){t(".tabs-tab").each(function(){var e=t(this).find("span")[0];!_.isUndefined(e)&&e.offsetWidth<e.scrollWidth&&t(this).attr("title",t(e).text().trim())})},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},getControlItems:function(){return _([this.createControl("add",a.add_tab,"addTab"),this.createPaddingControl(),this.createControl("settings",a.settings,"on_settings_click")])}});Upfront.Application.LayoutEditor.add_object("Utabs",{Model:e,View:l,Element:i,Settings:n,anchor:{is_target:!1},cssSelectors:{".upfront-tabs-container":{label:a.css.container_label,info:a.css.container_info},".upfront-tabs-container .tabs-menu-wrapper":{label:a.css.menu_label,info:a.css.menu_info},".upfront-tabs-container .tabs-tab .inner-box":{label:a.css.tabs_label,info:a.css.tabs_info},".upfront-tabs-container .tabs-tab-active .inner-box":{label:a.css.active_tab_label,info:a.css.active_tab_info},".upfront-tabs-container .utabs-content":{label:a.css.tab_content_label,info:a.css.tab_content_info},".upfront-tabs-container .utabs-content p":{label:a.css.tab_p_label,info:a.css.tab_p_info},".upfront-tabs-container .utab-content-active":{label:a.css.active_content_label,info:a.css.active_content_info},".upfront-tabs-container .utab-content-active p":{label:a.css.active_p_label,info:a.css.active_p_info}},cssSelectorsId:Upfront.data.utabs.defaults.type}),Upfront.Models.UtabsModel=e,Upfront.Views.UtabsView=l})}(jQuery),define("text!elements/upfront-this-post/tpl/preset-style.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\n"}),function(t){define("this_post",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-this-post/tpl/preset-style.html"],function(e,i,n,o){var r=Upfront.Settings.l10n.this_post_element,s=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.thisPost.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),a=Upfront.Views.ObjectView.extend({changed:!1,markup:!1,loading:!1,postId:!1,editor:!1,initialize:function(t){var e=this;this.model instanceof s||(this.model=new s({properties:this.model.get("properties")})),this.listenTo(this.model.get("properties"),"change",this.reset_markup),this.constructor.__super__.initialize.call(this,[t]),Upfront.Application.mode.current===Upfront.Application.MODE.THEME&&_.extend(this.events,{"click .upfront-post-layout-trigger":"editPostLayout"}),this.delegateEvents(),this.postId=_upfront_post_data.post_id?_upfront_post_data.post_id:!!Upfront.Settings.LayoutEditor.newpostType&&0,this.postId?(this.refreshMarkup().then(function(){e.postId&&e.prepareEditor()}),e.prepareEditor()):"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.THEME?(this.postId="fake_post",this.refreshMarkup(),e.prepareEditor()):"themeExporter"in Upfront&&Upfront.Application.mode.current===Upfront.Application.MODE.CONTENT_STYLE&&(this.postId="fake_styled_post",this.refreshMarkup(),e.prepareEditor()),this.listenToOnce(this,"rendered",function(){window.location.pathname.indexOf("/edit/")!==-1&&e.editor.loadingLayout.done(function(){setTimeout(function(){e.editor.editContents()},200)})}),Upfront.Events.trigger("post:initialized",this)},get_content_markup:function(){return this.markup?this.markup:(this.refreshMarkup(),"loading")},reset_markup:function(){var t=this,e=["hide_featured_image","full_featured_image"];this.markup&&(_.find(e,function(e){var i=t.property(e),n=t._properties[e];return!(!i&&!n)&&(n!=i&&(t.markup=!1,!0))}),this.markup===!1&&this.editor&&this.editor.fetchPostLayout())},prepareEditor:function(){var e=this.$(".upfront-object-content").children();e.length||(e=[t("<div>")]),this.editor?this.editor.setElement(e[0]):(this.editor=new Upfront.Content.PostEditorLegacy({editor_id:"this_post_"+this.postId,post_id:this.postId,preload:!0,node:e[0],content_mode:"post_content",view:this,layout:this.property("layout")}),this.editor.render())},on_render:function(){if(this.editor){var t=this.$(".upfront-object-content").children();this.parent_module_view.model.get_property_value_by_name("sticky")&&(this.parent_module_view.model.set_property("sticky",!1),this.parent_module_view.$el.find("> .upfront-module > .upfront-entity_meta").prepend('<a href="#" class="upfront-icon-button upfront-icon-button-delete upfront-entity-delete_trigger"></a>')),t[0]&&t[0]!=this.editor.el&&(this.editor.setElement(t[0]),this.editor.render()),this.$el.find("> .upfront-object").css("min-height",""),this.parent_module_view.$el.find("> .upfront-module").css("min-height",""),this.add_region_class("upfront-region-container-has-this_post",!0),this.trigger("rendered")}},get_extra_buttons:function(){return Upfront.Application.mode.current===Upfront.Application.MODE.THEME?'<a href="#" title="Edit post layout" class="upfront-icon-button upfront-icon-button-nav upfront-post-layout-trigger"></a>':""},on_edit:function(t){this.editor||this.prepareEditor()},editPostLayout:function(){this.markup=!1,Upfront.Events.trigger("post:layout:edit",this,"single")},editPostContent:function(){this.editor.editContents()},refreshMarkup:function(){var e=this;if(this.loadingMarkup)return this.loadingMarkup;if(this.postId===!1)return(new t.Deferred).resolve({data:{filtered:"Error"}});var i=t("#"+e.property("element_id")).find(".upfront-object-content"),n=!!i.length&&new Upfront.Views.Editor.Loading({loading:r.refreshing,done:r.here_we_are,fixed:!1});return n&&(n.render(),i.append(n.$el)),this._properties={post_data:this.property("post_data"),element_id:this.property("element_id"),hide_featured_image:this.property("hide_featured_image"),full_featured_image:this.property("full_featured_image")},this.loadingMarkup=Upfront.Util.post({action:"this_post-get_markup",data:JSON.stringify({post_id:this.postId,post_type:Upfront.Settings.LayoutEditor.newpostType,properties:this._properties})}).success(function(i){n&&(n.done(),n=!1);var o=o||t("#"+e.property("element_id")).find(".upfront-object-content");e.markup=i.data.filtered,o.html(e.get_content_markup()),e.on_render(),e.loadingMarkup=!1}),this.loadingMarkup},redirectPostEdit:function(t){var e="/edit/"+t.get("post_type")+"/"+t.id;_upfront_post_data&&(_upfront_post_data.post_id=t.id),Upfront.Application.navigate(e,{trigger:!0}),Upfront.Application.user_can("EDIT")&&Upfront.Application.set_current(Upfront.Settings.Application.MODE.LAYOUT)},createEditor:function(t){var e=this;this.editor||(this.editor=new Upfront.Content.editor({editor_id:"this_post_"+this.postId,post_id:this.postId,preload:!0,node:t,content_mode:"post_content",view:e,autostart:this.autostart,onUpdated:function(t){e.autostart=!1,e.editor.autostart=!1,e.refreshMarkup(t),e.trigger("post:updated",t)}}),this.listenTo(this.editor,"editor:cancel",function(){e.editor.autostart=!1,e.editor.initEditAreas()}))},on_element_edit_start:function(t,e){"write"==t&&this.parent_module_view&&(e.id!=this.postId?this.parent_module_view.disable_interaction(!1):this.parent_module_view.$el.find(".upfront-module").addClass("upfront-module-editing"))},on_element_edit_stop:function(t,e,i){this.parent_module_view&&i!==!0&&(this.parent_module_view.$el.find(".upfront-module").removeClass("upfront-module-editing"),this.parent_module_view.enable_interaction(!1))},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},cleanup:function(){this.editor&&(this.editor.remove(),this.editor=!1),this.remove_region_class("upfront-region-container-has-this_post",!0)}}),l=Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.html(r.element_name)},add_element:function(){var t=new s,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-this_post_module"},{name:"has_settings",value:0},{name:"row",value:20}],objects:[t]});this.add_module(e)}}),p=(Upfront.Views.Editor.Settings.Item.extend({initialize:function(t){this.options=t;var e=[{label:r.post_author,value:"author"},{label:r.post_date,value:"date"},{label:r.categories,value:"categories"},{label:r.tags,value:"tags"},{label:r.comments_count,value:"comments_count"},{label:r.featured_image,value:"featured_image"}];this.fields=_([new Upfront.Views.Editor.Field.Checkboxes({model:this.model,label:r.show_post_data,property:"post_data",values:e})])},get_title:function(){return r.post_data}}),i.extend({label:r.element_name,settings:[{type:"SettingsItem",title:r.featured_image_option,fields:[{type:"Checkboxes",property:"hide_featured_image",multiple:!1,values:[{label:r.hide_featured_image,value:"1"}],change:function(t,e){"1"===t?e.model.set_property("hide_featured_image",1):e.model.set_property("hide_featured_image",!1)}},{type:"Checkboxes",property:"full_featured_image",multiple:!1,values:[{label:r.full_featured_image,value:"1"}],change:function(t,e){"1"===t?e.model.set_property("full_featured_image",1):e.model.set_property("full_featured_image",!1)}}]}],title:r.post_settings})),d=e.extend({panels:{General:p,Appearance:{mainDataCollection:"thispostPresets",styleElementPrefix:"thispost-preset",ajaxActionSlug:"thispost",panelTitle:r.settings,presetDefaults:Upfront.mainData.presetDefaults.thispost,styleTpl:o}},initialize:function(t){location.pathname.indexOf("create_new")===-1&&(this.panels={General:p}),this.constructor.__super__.initialize.call(this,t)},title:r.post_settings});n.generatePresetsToPage("thispost",o),Upfront.Application.LayoutEditor.add_object("ThisPost",{Model:s,View:a,Element:l,Settings:d}),Upfront.Models.ThisPostModel=s,Upfront.Views.ThisPostView=a,Upfront.data.thisPost.PostDataPanel=p})}(jQuery),define("text!elements/upfront-post-data/tpl/views.html",[],function(){return'<div id="post-data">\r\n\t<div class="post-data-wrapper">{{post_data}}</div>\r\n</div>\r\n\r\n<div id="loading">\r\n\t<p class="loading">{{l10n.loading}}</p>\r\n</div>\r\n\r\n\r\n<div id="error">\r\n\t<p class="error">{{l10n.error}}</p>\r\n</div>\r\n\r\n\r\n<div id="part-options-part_visible">\r\n\t<div class="name_action_wrapper"></div>\r\n</div>\r\n<div id="part-options-part_label">\r\n\t<span class="part_label"></span>\r\n</div>\r\n<div id="part-options-part_action">\r\n\t<span class="part_action"><a href="#edit-options">{{l10n.edit}}</a></span>\r\n</div>\r\n<div id="part-options-part_wrapper">\r\n\t<div class="options {{part.part}}-options">\r\n\t\t<div class="option"></div>\r\n\t\t<span class="edit_part"><a href="#edit-html">{{l10n.edit_html}}</a></span>\r\n\t</div>\r\n</div>'}),function(t){define("elements/upfront-post-data/js/post-data-views",["text!elements/upfront-post-data/tpl/views.html"],function(e){var i=Upfront.Settings.l10n.post_data_element,n=t(e),o={get_preset_data:function(t,e){var i={};if(!t||!e)return i;var n=t+"_elementPresets",o=(Upfront.mainData||{})[n]||[];return _.findWhere(o,{id:e})||i}},r={DEFAULT:"post_data",_view:Backbone.View.extend({_do_cache:!0,render:function(t){var e=this,n=Upfront.Util.model_to_json(this.model),r=n.properties||{},s=n.objects||{},a=this.model.get_property_value_by_name("data_type"),l=this.model.get_property_value_by_name("preset"),p=o.get_preset_data(a,l),d={props:r,objects:s,preset_data:p,post_id:this.element.postId},c=Upfront.Application.is_plugin_layout(d.post_id);if(c){var u;if(this.model.get("objects").each(function(t){"content"===t.get_property_value_by_name("part_type")&&(u=!0)}),u){var h="<div>Below is sample content for "+c.pluginName+". Use it as a reference for styling.</div>"+c.content;setTimeout(function(){e.element.$el.find(".upfront-object-content").first().empty().append(h)},100)}}else!1===d.post_id&&Upfront.Application.is_builder&&(d.post_id="fake_post"),this.element.authorId&&(d.author_id=this.element.authorId),this.element.postDate&&(d.post_date=this.element.postDate),"featured_image"==a&&this.element.full_featured_image&&(d.selected_featured_image=this.element.full_featured_image),"post_data"==a&&this.element.set_post_title&&(d.set_post_title=this.element.set_post_title),"post_data"==a&&this.element.set_post_content&&(d.set_post_content=this.element.set_post_content),this.element.toggle_child_objects_loading(!0),this._post_data_load=Upfront.Util.post({action:"upfront_post-data-load",data:d}).success(function(n){n.data&&n.data.post_data?(e.render_object_view(n.data.post_data,t),e._do_cache&&(e._cached_data=n.data.post_data),e.$el.empty().removeClass("upfront_post-data-loading")):e.$el.empty().append(e.tpl.error({l10n:i})).removeClass("upfront_post-data-loading"),e.element.toggle_child_objects_loading(!1)}).error(function(){e.$el.empty().append(e.tpl.error({l10n:i})).removeClass("upfront_post-data-loading"),e.element.toggle_child_objects_loading(!1)}),this.$el.empty().append(this.tpl.load({l10n:i})).addClass("upfront_post-data-loading")},rerender:function(t){this._cached_data?this.render_object_view(this._cached_data,t):this.render()},render_object_view:function(t,e){_.isArray(e)||(e=[]);this.model.get("objects").each(function(i){var n=Upfront.data.object_views[i.cid],o=i.get_property_value_by_name("part_type");e.length>0&&!_.contains(e,o)||n&&o&&t[o]&&(n.render_view(t[o]),Upfront.Events.trigger("entity:object:refresh",n))})},tpl:{main:_.template(n.filter("#post-data").html()),error:_.template(n.filter("#error").html()),load:_.template(n.filter("#loading").html())}})};return r.post_data=r._view.extend({className:"upfront_post-data-view upfront_post-data-post_data"}),r.author=r._view.extend({className:"upfront_post-data-view upfront_post-data-author"}),r.taxonomy=r._view.extend({className:"upfront_post-data-view upfront_post-data-taxonomy"}),r.featured_image=r._view.extend({className:"upfront_post-data-view upfront_post-data-featured_image"}),r.comments=r._view.extend({className:"upfront_post-data-view upfront_post-data-comments"}),r.meta=r._view.extend({className:"upfront_post-data-view upfront_post-data-meta"}),r})}(jQuery),define("elements/upfront-post-data/js/panel-abstractions",["scripts/upfront/settings/modules/base-module","scripts/upfront/settings/field-factory","scripts/upfront/preset-settings/state-settings","scripts/redactor/ueditor-inserts","elements/upfront-posts/js/post-list-meta-views"],function(t,e,i,n,o){var r=Upfront.Settings.l10n.post_data_element,s=t.extend({className:function(){var e=(typeof this.initialize==typeof t.prototype.className?t.prototype.className():t.prototype.className||"").split(" ");return e.push("upfront-post_data-part"),e.push("part-module-panel"),e.join(" ")},map_panel_fields:function(){var t=this,i=this.get_fields(),n=new Upfront.Models.ObjectModel;return i.push({type:"Button",label:r.custom_markup,className:"edit_preset_label",compact:!0}),i.push({type:"Button",label:r.edit_template,className:"edit_post_markup edit_preset_css",compact:!0,on_click:function(){t.spawn_editor()}}),_(this.model.attributes).each(function(t,e){return"id"===e||"name"===e||void n.set_property(e,t)}),_.map(i,function(i){_.extend(i,{change:function(e){t.update_object(e,i.property)}});return e.createField(i.type,_.extend({model:n},_.omit(i,["type"])))})},get_fields:function(){return[]},get_object_model:function(){return this.model},update_object:function(t,e){_.isUndefined(t)&&(t=""),this.model.set(e,t),this.trigger("part:property:change",e,t)},render:function(){this.fields=_(this.map_panel_fields()),this.options.title=this.title,t.prototype.render.apply(this,arguments);var e=this.get_modules();this.state=new i({model:this.model,state:"static",modules:e}),this.state.render(),this.$el.append(this.state.$el),this.$el.find(".state_modules").append(this.$el.find(".edit_preset_css")),this.$el.addClass("preset_specific")},get_modules:function(){var t=this,e=function(e){return"static-"+t.data_part+"-"+e};return[{moduleType:"Typography",options:{toggle:!0,state:"static",fields:{use:e("use-typography"),typeface:e("font-family"),weight:e("weight"),fontstyle:e("fontstyle"),style:e("style"),size:e("font-size"),line_height:e("line-height"),color:e("font-color")}}}]},spawn_editor:function(){var t=this,e="post-part-"+this.data_part,i=this.model.get(e),r="meta"===this.data_part?o.Embed:n.inserts.embed,s=new r({data:{code:i},model:this.model}),a=!1,l=function(){if(a){var t=jQuery("#sidebar-ui").width()-1;a.$el.width(jQuery(window).width()-t).css("left",t)}};jQuery(window).on("resize",l),s.start().done(function(i,n){jQuery(window).off("resize",l),t.model.set(e,n)}),this.listenTo(s,"manager:rendered",function(t,e){a=t,l()})},get_name:function(){return!1},get_value:function(){return!1}}),a=s.extend({events:function(){return _.extend({},s.prototype.events,{"click .upfront-settings-item-title .toggle":"toggle_box"})},render:function(){var t=this,e={label:this.title,value:"1"},i=this.model.get("hidden_parts")||[],n=!0,o=!1;i.indexOf(t.data_part)<0&&(e.checked="checked",n=!1),o=new Upfront.Views.Editor.Field.Checkboxes({default_value:1,values:[e],change:function(e){var i=t.model.get("hidden_parts")||[],n=i.indexOf(t.data_part);e&&e.length&&n>=0?i.splice(n,1):n<0&&i.push(t.data_part),t.model.set("hidden_parts",i),e&&e.length?(t.$el.find(".upfront-settings-item-title").removeClass("inactive"),t.show_content()):(t.$el.find(".upfront-settings-item-title").addClass("inactive"),t.hide_content()),t.trigger("part:hide:toggle",t.data_part,e&&e.length&&n>=0)}}),o.render(),o.delegateEvents(),s.prototype.render.apply(this,arguments),this.$el.find(".upfront-settings-item-title").empty().append(o.$el).append('<a href="#toggle" class="toggle">&times;</a>'),n&&this.hide_content(),this.$el.find(".upfront-settings-item-title .toggle").css("background-image","url("+Upfront.Settings.root_url.replace(/\/$/,"")+"/img/uf-ui-sprite.svg)")},toggle_box:function(t){t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation();var e=this.$el.find(".upfront-settings-item-content:first, .state_modules");return e.is(":visible")?this.hide_content():this.show_content(),!1},hide_content:function(){var t=this.$el.find(".upfront-settings-item-content:first, .state_modules");return t.hide()},show_content:function(){var t=this.$el.find(".upfront-settings-item-content:first, .state_modules");return t.show()}});return{Options:s,Toggleable:a}}),define("text!elements/upfront-post-data/tpl/preset-styles/post_data.html",[],function(){return"<?php if (!empty($properties['static-date_posted-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .date_posted {\r\n\r\n\t<?php if (!empty($properties['static-date_posted-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-date_posted-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-date_posted-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-date_posted-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-date_posted-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-date_posted-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-date_posted-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-date_posted-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-date_posted-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-date_posted-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-date_posted-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-date_posted-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n<?php if (!empty($properties['static-title-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .title * {\r\n\r\n\t<?php if (!empty($properties['static-title-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-title-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-title-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-title-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-title-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-title-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-title-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-title-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-title-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-title-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-title-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-title-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n.upost-data-object-post_data.<?php echo $properties['id'] ?> .upfront-indented_content {\r\n\tpadding-left: <?php echo !empty($properties['calculated_left_indent']) ? $properties['calculated_left_indent'] : 0 ?>px;\r\n\tpadding-right: <?php echo !empty($properties['calculated_right_indent']) ? $properties['calculated_right_indent'] : 0 ?>px;\r\n}\r\n.upost-data-object-post_data.<?php echo $properties['id'] ?> .upfront-indented_content .ueditor-insert-variant.upfront-inserted_image-wrapper {\r\n\tmargin-left: <?php echo !empty($properties['calculated_left_indent']) ? $properties['calculated_left_indent']*-1 : 0 ?>px !important;\r\n\tmargin-right: <?php echo !empty($properties['calculated_right_indent']) ? $properties['calculated_right_indent']*-1 : 0 ?>px !important;\r\n}\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-post_data",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/post_data.html","scripts/upfront/preset-settings/util"],function(t,e,i){var n=Upfront.Settings.l10n.post_data_element,o={};return o.template=e,o.part_date_posted=t.Toggleable.extend({title:n.post.date_part_title,data_part:"date_posted",get_fields:function(){return[{type:"Select",label:n.post.date_format,multiple:!1,property:"predefined_date_format",values:[{label:n.post.wp_date,value:"wp_date"},{label:n.post.dMY,value:"d M Y"},{label:n.post.MdY,value:"M d Y"},{label:n.post.dmY,value:"d m Y"},{label:n.post.mdY,value:"m d Y"},{label:n.post.custom_format,value:"0"}],default_value:"wp_date"},{type:"Text",label:n.post.php_format,className:"php_date_format",label_style:"inline",property:"date_posted_format"},{type:"Button",label:n.post.reference,className:"php_date_reference",compact:!0,on_click:function(t){t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation();var e=window.open("https://codex.wordpress.org/Formatting_Date_and_Time","_blank");return e.focus(),!1}}]},render:function(){if(t.Toggleable.prototype.render.apply(this),!this._field_fmt_select||!this._field_fmt||!this._field_fmt_ref){var e=this.fields.toArray();this._field_fmt_select=e[0],this._field_fmt=e[1],this._field_fmt_ref=e[2],this._field_fmt_select&&this.listenTo(this._field_fmt_select,"changed",this.update_fields)}this.update_fields()},update_fields:function(){if(!this._field_fmt_select)return!1;var t=this._field_fmt_select.get_value();"0"!==t?(this._field_fmt.$el.hide(),this._field_fmt_ref.$el.hide()):(this._field_fmt.$el.show(),this._field_fmt_ref.$el.show())}}),o.part_title=t.Toggleable.extend({title:n.post.title_part_title,data_part:"title"}),o.part_content=t.Toggleable.extend({title:n.post.content_part_title,data_part:"content",get_fields:function(){var t=Upfront.Settings.LayoutEditor.Grid.size||24,e=parseInt((t-1)/2,10);return[{type:"Number",label:n.post.left_indent,label_style:"inline",min:0,max:e,default_value:0,className:"content-indent indent-left",property:"left_indent"},{type:"Number",label:n.post.right_indent,label_style:"inline",min:0,max:e,default_value:0,className:"content-indent indent-right",property:"right_indent"},{type:"Checkboxes",property:"trigger_splitters",default_value:0,values:[{label:n.post.returns_into_dividers,value:"1"}]},{type:"Checkboxes",property:"allow_splitting",default_value:0,values:[{label:n.post.allow_splitting,value:"1"}]},{type:"Number",label:n.post.content_part,default_value:0,min:0,label_style:"inline",property:"content_part"}]},render:function(){t.Toggleable.prototype.render.apply(this);var e;if(this._allow_splitting_field&&this._content_part_field||(e=this.fields.toArray(),this._allow_splitting_field=e[3],this._content_part_field=e[4],this._allow_splitting_field&&this.listenTo(this._allow_splitting_field,"changed",this.update_fields)),this.update_fields(),!(this._padding_fields||{}).left||(this._padding_fields||{}).right){e=this.fields.toArray();var i={};i.left=e[0],i.right=e[1],this._padding_fields=i,(this._padding_fields||{}).left&&this.listenTo(this._padding_fields.left,"changed",this.normalize_left_padding),(this._padding_fields||{}).right&&this.listenTo(this._padding_fields.right,"changed",this.normalize_right_padding)}},update_fields:function(){if(!this._allow_splitting_field)return!1;var t=this._allow_splitting_field.get_value();t&&t.length?(Upfront.data.upfront_post_data.split_allowed=!0,this._content_part_field.$el.show()):this._content_part_field.$el.hide()},_recalculate_indents:function(){var t=parseInt(this.model.get("left_indent"),10),n=parseInt(this.model.get("right_indent"),10),o=parseInt(Upfront.Settings.LayoutEditor.Grid.column_width,10);this.model.set("calculated_left_indent",t*o),this.model.set("calculated_right_indent",n*o),i.generatePresetsToPage("post_data_element",e)},_normalize_padding:function(t,e){if(!(this._padding_fields||{})[t])return!1;e=parseInt(e,10)||-1;var i=this._padding_fields[t]||{},n=Upfront.Settings.LayoutEditor.Grid.size||24,o=parseInt((n-1)/2,10),r=i.options||{},s=parseInt(r.min,10)||0,a=parseInt(r.max,10)||o;
return e<s&&(i.set_value(s),this.update_object(s,r.property)),e>a&&(i.set_value(a),this.update_object(a,r.property)),this._recalculate_indents(),!0},normalize_left_padding:function(t){return this._normalize_padding("left",t)},normalize_right_padding:function(t){return this._normalize_padding("right",t)},get_modules:function(){return[]}}),o}),define("text!elements/upfront-post-data/tpl/preset-styles/author.html",[],function(){return"<?php if (!empty($properties['static-author-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author, .<?php echo $properties['id'] ?> .upfront-post-data-part .author a {\r\n\r\n\t<?php if (!empty($properties['static-author-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-author-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-author-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-author-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-author-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-author-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-author-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .gravatar img.avatar {\r\n\r\n\t<?php if (!empty($properties['static-gravatar-use-border'])) { ?>\r\n\r\n\t\t<?php if (!empty($properties['static-gravatar-border-width'])) { ?>\r\n\t\t\tborder-width: <?php echo $properties['static-gravatar-border-width'] ?>px;\r\n\t\t<?php } ?>\r\n\r\n\t\t<?php if (!empty($properties['static-gravatar-border-type'])) { ?>\r\n\t\t\tborder-style: <?php echo $properties['static-gravatar-border-type'] ?>;\r\n\t\t<?php } ?>\r\n\r\n\t\t<?php if (!empty($properties['static-gravatar-border-color'])) { ?>\r\n\t\t\tborder-color: <?php echo $properties['static-gravatar-border-color'] ?>;\r\n\t\t<?php } ?>\r\n\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-gravatar-use-radius'])) { ?>\r\n\r\n\t\tborder-radius: <?php echo $properties['static-gravatar-radius1'] ? $properties['static-gravatar-radius1'] : 0 ?>px\r\n\t\t\t<?php echo $properties['static-gravatar-radius2'] ? $properties['static-gravatar-radius2'] : 0 ?>px\r\n\t\t\t<?php echo $properties['static-gravatar-radius4'] ? $properties['static-gravatar-radius4'] : 0 ?>px\r\n\t\t\t<?php echo $properties['static-gravatar-radius3'] ? $properties['static-gravatar-radius3'] : 0 ?>px\r\n\t\t;\r\n\r\n\t<?php } ?>\r\n}\r\n\r\n\r\n<?php if (!empty($properties['static-author_email-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author-email, .<?php echo $properties['id'] ?> .upfront-post-data-part .author-email a {\r\n\r\n\t<?php if (!empty($properties['static-author_email-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-author_email-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_email-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-author_email-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_email-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-author_email-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_email-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-author_email-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_email-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-author_email-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_email-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-author_email-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if (!empty($properties['static-author_url-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author-url, .<?php echo $properties['id'] ?> .upfront-post-data-part .author-url a {\r\n\r\n\t<?php if (!empty($properties['static-author_url-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-author_url-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_url-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-author_url-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_url-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-author_url-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_url-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-author_url-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_url-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-author_url-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_url-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-author_url-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if (!empty($properties['static-author_bio-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .author-bio, .<?php echo $properties['id'] ?> .upfront-post-data-part .author-bio a {\r\n\r\n\t<?php if (!empty($properties['static-author_bio-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-author_bio-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_bio-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-author_bio-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_bio-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-author_bio-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_bio-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-author_bio-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_bio-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-author_bio-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-author_bio-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-author_bio-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-author",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/author.html"],function(t,e){var i=Upfront.Settings.l10n.post_data_element,n={};return n.template=e,n.part_author=t.Toggleable.extend({title:i.author.author_part_title,data_part:"author",get_fields:function(){return[{type:"Select",label:i.author.display,label_style:"inline",property:"display_name",values:[{label:i.author.display_name,value:"display_name"},{label:i.author.first_last,value:"first_last"},{label:i.author.last_first,value:"last_first"},{label:i.author.nickname,value:"nickname"},{label:i.author.username,value:"username"}]},{type:"Select",label:i.author.link_to,label_style:"inline",property:"link",values:[{label:i.author.website,value:"website"},{label:i.author.author_page,value:"author"}]},{type:"Checkboxes",property:"target",values:[{label:i.new_tab,value:"_blank"}]}]}}),n.part_author_email=t.Toggleable.extend({title:i.author.email_part_title,data_part:"author_email",get_fields:function(){return[{type:"Text",label:i.author.email_text_label,label_style:"inline",default_value:"Email",property:"email_link_text"}]}}),n.part_author_url=t.Toggleable.extend({title:i.author.url_part_title,data_part:"author_url",get_fields:function(){return[{type:"Text",label:i.author.link_text,label_style:"inline",default_value:i.author.website,property:"link_text"},{type:"Checkboxes",property:"target",values:[{label:i.new_tab,value:"_blank"}]}]}}),n.part_author_bio=t.Toggleable.extend({title:i.author.bio_part_title,data_part:"author_bio"}),n.part_gravatar=t.Toggleable.extend({title:i.author.gravatar_part_title,data_part:"gravatar",get_fields:function(){return[{type:"Number",label:i.author.gravatar_size,label_style:"inline",property:"gravatar_size"}]},get_modules:function(){var t=[],e=this,i=function(t){return"static-"+e.data_part+"-"+t};return t.push({moduleType:"Border",options:{toggle:!0,state:"static",fields:{use:i("use-border"),width:i("border-width"),type:i("border-type"),color:i("border-color")}}}),t.push({moduleType:"Radius",options:{toggle:!0,state:"static",fields:{use:i("use-radius"),lock:i("lock"),radius:i("radius"),radius_number:i("radius_number"),radius1:i("radius1"),radius2:i("radius2"),radius3:i("radius3"),radius4:i("radius4")}}}),t}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/featured_image.html",[],function(){return".<?php echo $properties['id'] ?> .upfront-post-data-part .thumbnail {\r\n\r\n\t<?php if (!empty($properties['static-featured_image-use-border'])) { ?>\r\n\r\n\t\t<?php if (!empty($properties['static-featured_image-border-width'])) { ?>\r\n\t\t\tborder-width: <?php echo $properties['static-featured_image-border-width'] ?>px;\r\n\t\t<?php } ?>\r\n\r\n\t\t<?php if (!empty($properties['static-featured_image-border-type'])) { ?>\r\n\t\t\tborder-style: <?php echo $properties['static-featured_image-border-type'] ?>;\r\n\t\t<?php } ?>\r\n\r\n\t\t<?php if (!empty($properties['static-featured_image-border-color'])) { ?>\r\n\t\t\tborder-color: <?php echo $properties['static-featured_image-border-color'] ?>;\r\n\t\t<?php } ?>\r\n\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-featured_image-use-radius'])) { ?>\r\n\r\n\t\tborder-radius: <?php echo $properties['static-featured_image-radius1'] ? $properties['static-featured_image-radius1'] : 0 ?>px\r\n\t\t\t<?php echo $properties['static-featured_image-radius2'] ? $properties['static-featured_image-radius2'] : 0 ?>px\r\n\t\t\t<?php echo $properties['static-featured_image-radius4'] ? $properties['static-featured_image-radius4'] : 0 ?>px\r\n\t\t\t<?php echo $properties['static-featured_image-radius3'] ? $properties['static-featured_image-radius3'] : 0 ?>px\r\n\t\t;\r\n\r\n\t<?php } ?>\r\n}\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-featured_image",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/featured_image.html"],function(t,e){var i=Upfront.Settings.l10n.post_data_element,n={};return n.template=e,n.part_featured_image=t.Toggleable.extend({title:i.thumb.fimg_part_title,data_part:"featured_image",get_fields:function(){var t=this;return[{type:"Checkboxes",property:"resize_featured",multiple:!1,default_value:0,values:[{label:i.thumb.resize_to_fit,value:"1"}]},{type:"Select",label:i.thumb.fallback,property:"fallback_option",default_value:"",values:[{label:i.thumb.hide,value:"hide"},{label:i.thumb.use_color,value:"color"},{label:i.thumb.use_default_img,value:"image"}]},{type:"Color",property:"fallback_color",label:i.thumb.fallback_color},{type:"Button",compact:!0,property:"fallback_image",label:i.thumb.fallback_image,on_click:function(){console.log(this.model.get("fallback_image")),Upfront.Media.Manager.open({multiple_selection:!1,media_type:["images"]}).done(function(e,i){if(!i||!i.length)return!1;var n=i.models[0],o=n.get("image")?n.get("image"):i.models[0],r="src"in o?o.src:"get"in o&&o.get("original_url");return!!r&&void t.model.set("fallback_image",r)})}}]},render:function(){if(t.Toggleable.prototype.render.apply(this,arguments),!this._fallback_selection_field||!this._fallback_color_field||!this._fallback_image_field){var e=this.fields.toArray();this._fallback_selection_field=e[1],this._fallback_color_field=e[2],this._fallback_image_field=e[3],this._fallback_selection_field&&this.listenTo(this._fallback_selection_field,"changed",this.update_fields)}this.update_fields()},update_fields:function(){if(!this._fallback_selection_field)return!1;var t=this._fallback_selection_field.get_value();"color"===t?(this._fallback_color_field.$el.show(),this._fallback_image_field.$el.hide()):"image"===t?(this._fallback_color_field.$el.hide(),this._fallback_image_field.$el.show()):(this._fallback_color_field.$el.hide(),this._fallback_image_field.$el.hide())},get_modules:function(){var t=[],e=this,i=function(t){return"static-"+e.data_part+"-"+t};return t.push({moduleType:"Border",options:{toggle:!0,state:"static",fields:{use:i("use-border"),width:i("border-width"),type:i("border-type"),color:i("border-color")}}}),t.push({moduleType:"Radius",options:{toggle:!0,state:"static",fields:{use:i("use-radius"),lock:i("lock"),radius:i("radius"),radius_number:i("radius_number"),radius1:i("radius1"),radius2:i("radius2"),radius3:i("radius3"),radius4:i("radius4")}}}),t}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/taxonomy.html",[],function(){return"<?php if (!empty($properties['static-categories-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_categories, .<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_categories a {\r\n\r\n\t<?php if (!empty($properties['static-categories-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-categories-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-categories-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-categories-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-categories-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-categories-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-categories-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-categories-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-categories-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-categories-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-categories-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-categories-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-tags-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_tags, .<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.post_tags a {\r\n\r\n\t<?php if (!empty($properties['static-tags-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-tags-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-tags-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-tags-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-tags-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-tags-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-tags-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-tags-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-tags-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-tags-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-tags-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-tags-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-taxonomies",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/taxonomy.html"],function(t,e){var i=Upfront.Settings.l10n.post_data_element,n={};return n.template=e,n.part_categories=t.Toggleable.extend({title:i.tax.cats_part_title,data_part:"categories",get_fields:function(){return[{type:"Number",property:"categories_limit",label:i.tax.max_limit,label_style:"inline",default_value:3},{type:"Text",property:"categories_separator",label:i.tax.separator,default_value:" | "}]}}),n.part_tags=t.Toggleable.extend({title:i.tax.tags_part_title,data_part:"tags",get_fields:function(){return[{type:"Number",property:"tags_limit",label:i.tax.max_limit,label_style:"inline",default_value:3},{type:"Text",property:"tags_separator",label:i.tax.separator,default_value:", "}]}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/comments.html",[],function(){return"<?php if (!empty($properties['static-comment_count-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_count, .<?php echo $properties['id'] ?> .upfront-post-data-part .comment_count a {\r\n\r\n\t<?php if (!empty($properties['static-comment_count-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-comment_count-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_count-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-comment_count-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_count-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-comment_count-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_count-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-comment_count-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_count-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-comment_count-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_count-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-comment_count-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-comments-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.comments a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments p\r\n{\r\n\r\n\t<?php if (!empty($properties['static-comments-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-comments-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-comments-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-comments-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-comments-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-comments-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-comments-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-comments_pagination-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments_pagination,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comments_pagination a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .upostdata-part.comments_pagination a\r\n{\r\n\r\n\t<?php if (!empty($properties['static-comments_pagination-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-comments_pagination-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments_pagination-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-comments_pagination-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments_pagination-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-comments_pagination-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments_pagination-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-comments_pagination-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments_pagination-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-comments_pagination-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comments_pagination-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-comments_pagination-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n<?php if (!empty($properties['static-comment_form-use-typography'])) { ?>\r\n\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form a,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form p,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h1,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h2,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h3,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h4,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h5,\r\n.<?php echo $properties['id'] ?> .upfront-post-data-part .comment_form h6\r\n{\r\n\r\n\t<?php if (!empty($properties['static-comment_form-font-family'])) { ?>\r\n\t\tfont-family: <?php echo $properties['static-comment_form-font-family'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_form-style'])) { ?>\r\n\t\tfont-style: <?php echo $properties['static-comment_form-style'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_form-weight'])) { ?>\r\n\t\tfont-weight: <?php echo $properties['static-comment_form-weight'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_form-font-size'])) { ?>\r\n\t\tfont-size: <?php echo $properties['static-comment_form-font-size'] ?>px;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_form-font-color'])) { ?>\r\n\t\tcolor: <?php echo $properties['static-comment_form-font-color'] ?>;\r\n\t<?php } ?>\r\n\r\n\t<?php if (!empty($properties['static-comment_form-line-height'])) { ?>\r\n\t\tline-height: <?php echo $properties['static-comment_form-line-height'] ?>;\r\n\t<?php } ?>\r\n\r\n}\r\n\r\n<?php } ?>\r\n\r\n\r\n\r\n\r\n<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>\r\n"}),define("elements/upfront-post-data/js/modules-comments",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/comments.html"],function(t,e){var i=Upfront.Settings.l10n.post_data_element,n={};return n.template=e,n.part_comment_count=t.Toggleable.extend({title:i.comments.cc_part_title,data_part:"comment_count"}),n.part_comment_form=t.Toggleable.extend({title:i.comments.form_part_title,data_part:"comment_form"}),n.part_comments_pagination=t.Toggleable.extend({title:i.comments.pagination_part_title,data_part:"comments_pagination",get_fields:function(){var t=[],e=(Upfront.data.upfront_post_data.post_data,parseInt((Upfront.data||{upfront_post_data_comments:{paginated:0}}).upfront_post_data_comments.paginated,10));return e||t.push({type:"Button",className:"comments-pagination_warning",label:i.comments.warning_pagination}),t}}),n.part_comments=t.Toggleable.extend({title:i.comments.comments_part_title,data_part:"comments",get_fields:function(){var t=[],e=Upfront.data.upfront_post_data.post_data,n=(e||{comments:{}}).comments,o=((n||{disable:[]}).disable,parseInt((Upfront.data||{upfront_post_data_comments:{paginated:0}}).upfront_post_data_comments.paginated,10));return t=[{type:"Checkboxes",property:"disable",label:i.comments.disable_for_post,values:[{label:i.comments.disable_comments,value:"comments"},{label:i.comments.disable_trackbacks,value:"trackbacks"}]},{type:"Checkboxes",property:"disable_showing",label:i.comments.disable_showing,values:[{label:i.comments.comments,value:"comments"},{label:i.comments.trackbacks,value:"trackbacks"}]}],o&&t.push({type:"Number",property:"limit",label:i.comments.limit}),t.push({type:"Radios",property:"order",label:i.comments.order,values:[{label:i.comments.date,value:"comment_date_gmt"},{label:i.comments.karma,value:"comment_karma"},{label:i.comments.parent,value:"comment_parent"}]}),t.push({type:"Radios",property:"direction",label:i.comments.direction,values:[{label:i.comments.asc,value:"ASC"},{label:i.comments.desc,value:"DESC"}]}),t},render:function(){var e=parseInt((Upfront.data||{upfront_post_data_comments:{paginated:0}}).upfront_post_data_comments.paginated,10),i=this.model.get("hidden_parts")||[];if(!e&&i.indexOf("comments_pagination")<0&&(i.push("comments_pagination"),this.model.set("hidden_parts",i)),t.Toggleable.prototype.render.apply(this,arguments),!this._disable_field||!this._pagination_field){var n=this.fields.toArray();this._disable_field=n[0],this._pagination_field=n[2],this._disable_field&&this.listenTo(this._disable_field,"changed",this.send_update_request)}},send_update_request:_.debounce(function(){var t=this._disable_field.get_value();Upfront.Util.post({action:"upfront-post_data-comments-disable",post_id:_upfront_post_data.post_id,disable:t})},3e3)}),Upfront.data.upfront_post_data.post_data={},Upfront.Util.post({action:"upfront-post_data-post-specific",post_id:_upfront_post_data.post_id}).done(function(t){Upfront.data.upfront_post_data.post_data="data"in t?t.data:{}}),n}),define("text!elements/upfront-post-data/tpl/preset-styles/meta.html",[],function(){return"<?php if(!empty($properties['preset_style'])) { ?><?php echo $properties['preset_style'] ?><?php } ?>"}),define("elements/upfront-post-data/js/modules-meta",["elements/upfront-post-data/js/panel-abstractions","text!elements/upfront-post-data/tpl/preset-styles/meta.html"],function(t,e){var i=Upfront.Settings.l10n.post_data_element,n={};return n.template=e,n.part_meta=t.Toggleable.extend({title:i.meta.meta_part_title,data_part:"meta",get_modules:function(){return[]}}),n}),define("elements/upfront-post-data/js/post-data-settings-panels",["scripts/upfront/preset-settings/preset-manager","scripts/upfront/preset-settings/util","elements/upfront-post-data/js/modules-post_data","elements/upfront-post-data/js/modules-author","elements/upfront-post-data/js/modules-featured_image","elements/upfront-post-data/js/modules-taxonomies","elements/upfront-post-data/js/modules-comments","elements/upfront-post-data/js/modules-meta"],function(t,e,i,n,o,r,s,a){var l={post_data:i.template,author:n.template,featured_image:o.template,taxonomy:r.template,comments:s.template,meta:a.template},p=_.extend({},_.omit(i,"template"),_.omit(n,"template"),_.omit(o,"template"),_.omit(r,"template"),_.omit(s,"template"),_.omit(a,"template")),d=t.extend({initialize:function(){var e,i="upfront_post_data_"+this.data_type,n={};_(_.omit(Upfront.data[i],["class","data_type","has_settings","id_slug","type","type_parts","view_class"])).each(function(t,e){n[e]=t}),e="undefined"!=typeof Upfront.mainData.presetDefaults[this.data_type+"_element"]?_.extend(n,Upfront.mainData.presetDefaults[this.data_type+"_element"]):n,_.extend(this,{mainDataCollection:this.data_type+"_elementPresets",styleElementPrefix:this.data_type+"_element",ajaxActionSlug:this.data_type+"_element",styleTpl:l[this.data_type],presetDefaults:_.extend(e,{id:"default",name:"Default"})}),t.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"preset:updated",function(){this.model.get("objects").trigger("change")},this),Upfront.Application.cssEditor.elementTypes.PostDataModel=Upfront.Application.cssEditor.elementTypes.PostDataModel||{id:this.data_type,label:this.data_type}},setupItems:function(){var e=this.clear_preset_name(this.model.decode_preset()||"default"),i=this.presets.findWhere({id:e});i||(e="default",this.property("preset",e),i=this.presets.findWhere({id:e})),t.prototype.setupItems.apply(this,arguments),this.selectPresetModule&&this.listenTo(this.selectPresetModule,"upfront:presets:change",function(){this.model.get("objects").trigger("change");var t=this;setTimeout(function(){t.update_parts()})},this),this.listenTo(this.model,"change",function(t){if("changed"in t&&"properties"in t.changed){var e=this;setTimeout(function(){e.update_parts()})}},this),_.each(this.part_panels,function(t,e){var n=new t({model:i});this.listenTo(n,"part:hide:toggle",function(t,e){this.update_parts(),this.updatePreset(i.toJSON())},this),this.settings.push(n)},this)},getTitle:function(){return"Presets"},update_parts:function(){var t=this,e=this.property("preset"),i=this.presets.findWhere({id:e}),n=i.get("hidden_parts")||[],o=this.model.get_property_value_by_name("type_parts")||[],r=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled(),s=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();_.each(o,function(e){t.update_object(e,n.indexOf(e)<0)}),s.default&&_.each(r,function(e){e=e.toJSON();var i=t.property("breakpoint_presets");if(!e.default&&i&&e.id in i&&"preset"in i[e.id]){var n=i[e.id].preset,r=t.presets.findWhere({id:n}),s=r.get("hidden_parts")||[];_.each(o,function(i){t.update_object(i,s.indexOf(i)<0,e)})}}),this.model.get("objects").trigger("change")},has_object:function(t){return!!this.find_object(t)},find_object:function(t){var e=this.model.get("objects");return!!e&&e.find(function(e){var i=e.get_property_value_by_name("part_type");return t==i})},find_wrapper:function(t){var e=this.model.get("wrappers"),i=t.get_wrapper_id();return e.get_by_wrapper_id(i)},update_object:function(t,e,i){e=!!e,i=i?i:Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();var n=this.model.get("objects"),o=this.model.get("wrappers"),r=this.find_object(t);if(i.default){if(!r&&e){var s=Upfront.Util.get_unique_id("wrapper"),a=new Upfront.Models.Wrapper({properties:[{name:"wrapper_id",value:s},{name:"class",value:"c24 clr"}]});r=new Upfront.Models.PostDataPartModel({properties:[{name:"view_class",value:"PostDataPartView"},{name:"part_type",value:t},{name:"has_settings",value:0},{name:"class",value:"c24 upfront-post-data-part"},{name:"wrapper_id",value:s}]}),o.add(a,{silent:!0}),n.add(r)}else if(r&&!e){var l=Upfront.data.object_views[r.cid];l.parent_view.on_entity_remove(null,l)}}else r&&r.set_breakpoint_property("hide",e?0:1,!1,i)}});return _.each(l,function(t,i){var n=i+"_element";e.generatePresetsToPage(n,t)}),{get_panel:function(t){var e={};Upfront.Application.user_can("MODIFY_PRESET")&&_.each(Upfront.data["upfront_post_data_"+t].type_parts,function(t){var i="part_"+t,n=!!p[i]&&p[i];n&&(e[t]=n)}),Upfront.Application.is_plugin_layout()&&(e={});var i=d.extend({part_panels:e,data_type:t});return{stuff:i}}}}),define("elements/upfront-post-data/js/post-data-settings",["scripts/upfront/element-settings/settings","elements/upfront-post-data/js/post-data-settings-panels"],function(t,e){var i=t.extend({initialize:function(){var i=this.model.get_property_value_by_name("data_type"),n=Upfront.Settings.l10n.post_data_element.elements[i]||i;this.panels=e.get_panel(i),this.title=n,t.prototype.initialize.apply(this,arguments)}});return i}),function(t){define("upostdata",["text!elements/upfront-post-data/tpl/views.html","elements/upfront-post-data/js/post-data-views","elements/upfront-post-data/js/post-data-settings","scripts/upfront/preset-settings/util","scripts/redactor/ueditor-inserts"],function(e,i,n,o,r){
function s(){var t=Upfront.Application.is_plugin_layout();Upfront.Application.is_single()&&!Upfront.Application.is_single("404_page")?(Upfront.Application.LayoutEditor.add_object("Upostdata-post_data",{Model:p,View:c,DataElement:h,Settings:n,cssSelectors:{".date_posted":{label:a.css.post_data_date_label,info:a.css.post_data_date_info},".title":{label:a.css.post_data_title_label,info:a.css.post_data_title_info},".title h1":{label:a.css.post_data_title_h1_label,info:a.css.post_data_title_h1_info},".content":{label:a.css.post_data_content_label,info:a.css.post_data_content_info},".content p":{label:a.css.post_data_content_p_label,info:a.css.post_data_content_p_info}},cssSelectorsId:"post_post_data"}),_.isUndefined(t)?(Upfront.Application.LayoutEditor.add_object("Upostdata-author",{Model:p,View:c,DataElement:f,Settings:n,cssSelectors:{".author":{label:a.css.author_author_label,info:a.css.author_author_info},".author a":{label:a.css.author_author_link_label,info:a.css.author_author_link_info},".gravatar":{label:a.css.author_gravatar_label,info:a.css.author_gravatar_info},".author-email":{label:a.css.author_email_label,info:a.css.author_email_info},".author-email a":{label:a.css.author_email_link_label,info:a.css.author_email_link_info},".author-url":{label:a.css.author_url_label,info:a.css.author_url_info},".author-url a":{label:a.css.author_url_link_label,info:a.css.author_url_link_info},".author-bio":{label:a.css.author_bio_label,info:a.css.author_bio_info}},cssSelectorsId:"post_author"}),Upfront.Application.is_single("page")||Upfront.Application.LayoutEditor.add_object("Upostdata-taxonomy",{Model:p,View:c,DataElement:g,Settings:n,cssSelectors:{".post_tags":{label:a.css.taxonomy_tags_label,info:a.css.taxonomy_tags_info},".post_tags a":{label:a.css.taxonomy_tags_link_label,info:a.css.taxonomy_tags_link_info},".post_categories":{label:a.css.taxonomy_category_label,info:a.css.taxonomy_category_info},".post_categories a":{label:a.css.taxonomy_category_link_label,info:a.css.taxonomy_category_link_info}},cssSelectorsId:"post_taxonomy"}),Upfront.Application.LayoutEditor.add_object("Upostdata-featured_image",{Model:p,View:c,DataElement:m,Settings:n,cssSelectors:{".thumbnail":{label:a.css.featured_thumbnail_label,info:a.css.featured_thumbnail_info},".thumbnail img":{label:a.css.featured_thumbnail_img_label,info:a.css.featured_thumbnail_img_info}},cssSelectorsId:"post_featured_image"}),Upfront.Application.LayoutEditor.add_object("Upostdata-comments",{Model:p,View:c,DataElement:v,Settings:n,cssSelectors:{".comment_count":{label:a.css.comment_count_label,info:a.css.comment_count_info},".comments":{label:a.css.comments_label,info:a.css.comments_info},".comments_pagination":{label:a.css.comments_pagination_label,info:a.css.comments_pagination_info},".upfront-post_data-comments":{label:a.css.comments_label,info:a.css.comments_info},".upfront-post_data-comments .comment":{label:a.css.comment_label,info:a.css.comment_info},".upfront-post_data-comments .comment-wrapper":{label:a.css.comment_wrapper_label,info:a.css.comment_wrapper_info},".upfront-post_data-comments .avatar":{label:a.css.comment_avatar_image_label,info:a.css.comment_avatar_image_info},".upfront-post_data-comments .comment-meta":{label:a.css.comment_meta_label,info:a.css.comment_meta_info},".upfront-post_data-comments .comment-meta .fn a":{label:a.css.comment_athor_label,info:a.css.comment_author_info},".upfront-post_data-comments .comment-meta .comment-time":{label:a.css.comment_time_label,info:a.css.comment_time_info},".upfront-post_data-comments .comment-content":{label:a.css.comment_content_label,info:a.css.comment_content_info},".upfront-post_data-comments .comment-content p":{label:a.css.comment_content_p_label,info:a.css.comment_content_p_info},".upfront-post_data-comments .edit-link a":{label:a.css.edit_link_label,info:a.css.edint_link_info},".upfront-post_data-comments .comment-reply a":{label:a.css.comment_reply_label,info:a.css.comment_reply_info},".comment-respond":{label:a.css.comment_form_label,info:a.css.comment_form_info},".comment-respond .comment-reply-title":{label:a.css.reply_title_label,info:a.css.reply_title_info},".comment-respond .logged-in-as":{label:a.css.logged_in_label,info:a.css.logged_in_info},".comment-respond .logged-in-as a":{label:a.css.logged_in_link_label,info:a.css.logged_in_link_info},".comment-respond .comment-form-comment":{label:a.css.respond_label,info:a.css.respond_info},'.comment-respond .comment-form-comment input[type="text"]':{label:a.css.comment_input_label,info:a.css.comment_input_info},".comment-respond .comment-form-comment textarea":{label:a.css.comment_textarea_label,info:a.css.comment_textarea_info},".comment-respond .form-submit .submit":{label:a.css.submit_button,info:a.css.submit_button}},cssSelectorsId:"post_comments"}),Upfront.Application.LayoutEditor.add_object("Upostdata-meta",{Model:p,View:c,DataElement:b,Settings:n,cssSelectors:{".meta":{label:a.css.post_meta_label,info:a.css.post_meta_info}},cssSelectorsId:"post_meta"})):(Upfront.Application.LayoutEditor.remove_object("Upostdata-author"),Upfront.Application.LayoutEditor.remove_object("Upostdata-taxonomy"),Upfront.Application.LayoutEditor.remove_object("Upostdata-featured_image"),Upfront.Application.LayoutEditor.remove_object("Upostdata-comments"),Upfront.Application.LayoutEditor.remove_object("Upostdata-meta"))):(Upfront.Application.LayoutEditor.remove_object("Upostdata-post_data"),Upfront.Application.LayoutEditor.remove_object("Upostdata-author"),Upfront.Application.LayoutEditor.remove_object("Upostdata-taxonomy"),Upfront.Application.LayoutEditor.remove_object("Upostdata-featured_image"),Upfront.Application.LayoutEditor.remove_object("Upostdata-comments"),Upfront.Application.LayoutEditor.remove_object("Upostdata-meta"))}var a=Upfront.Settings.l10n.post_data_element,l=(t(e),Upfront.Models.ObjectModel.extend({init:function(){var t=Upfront.data.upfront_post_data_part?_.clone(Upfront.data.upfront_post_data_part):{};t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}})),p=Upfront.Models.ObjectGroup.extend({init:function(){var t=this.get_property_value_by_name("data_type"),e=t?"upfront_post_data_"+t:"upfront_post_data",i=Upfront.data[e]?_.clone(Upfront.data[e]):{};i.element_id=Upfront.Util.get_unique_id(i.id_slug+"-object"),this.init_properties(i)}}),d=Upfront.Views.ObjectView.extend({init:function(){},on_render:function(){this.postId=_upfront_post_data.post_id?_upfront_post_data.post_id:!!Upfront.Settings.LayoutEditor.newpostType&&0,Upfront.data.posts[this.postId]&&(this.post=Upfront.data.posts[this.postId],this.post.meta.length||this.post.meta.fetch()),this.object_group_view&&(this.stopListening(this.object_group_view,"set:mobile_mode"),this.listenTo(this.object_group_view,"set:mobile_mode",this.setMobileMode),this.stopListening(this.object_group_view,"unset:mobile_mode"),this.listenTo(this.object_group_view,"unset:mobile_mode",this.unsetMobileMode)),this.parent_module_view&&(this.stopListening(this.parent_module_view,"update_postion"),this.listenTo(this.parent_module_view,"update_position",this.update_position)),this.listenTo(Upfront.Events,"entity:drop:before_render",this.set_prev_region_container),this.update_height()},update:function(t,e){t&&"preset"==t.id||(this.constructor.__super__.update.call(this,t,e),this.adjust_featured_image(),this.adjust_inserted_image())},update_position:function(){this.constructor.__super__.update_position.call(this),this.update_height(),this.adjust_featured_image(),this.adjust_inserted_image()},on_element_drop:function(){this.update_height()},render_view:function(t){var e=this,i=this.model.get_property_value_by_name("part_type");this.$el.find(".upfront-object-content").empty().append(t),this.adjust_featured_image(),this.adjust_inserted_image(),Upfront.Application.is_editor()&&this.prepare_editor(),"featured_image"===i&&this.object_group_view.mobileMode&&setTimeout(function(){e.setMobileMode()},100),Upfront.Events.trigger("post-data:part:rendered",this,t)},prepare_editor:function(){var t=this,e=this.model.get_property_value_by_name("part_type"),i=this.$el.find(".upfront-object-content");this._editor_prepared&&this.editor_view?(this.editor_view.setElement(i),this.trigger_edit()):!this._editor_prepared&&Upfront.Views.PostDataEditor&&(Upfront.Views.PostDataEditor.addPartView(e,i.get(0),this.model,this.object_group_view.model).done(function(e){t.editor_view=e,t.trigger_edit()}),this._editor_prepared=!0)},getControlItems:function(){var t=[];return t.push(this.createPaddingControl()),_(t)},trigger_edit:function(){(Upfront.Application.user_can("EDIT")!==!1||parseInt(Upfront.Views.PostDataEditor.post.get("post_author"),10)===Upfront.data.currentUser.id&&Upfront.Application.user_can("EDIT_OWN")===!0)&&Upfront.Views.PostDataEditor.contentEditor&&Upfront.Views.PostDataEditor.contentEditor._editing&&this.editor_view&&this.editor_view.editContent()},setMobileMode:function(){var t=this.model.get_property_value_by_name("part_type");if("featured_image"===t){var e=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data"),i=this.object_group_view.is_featured_image_set(),n=this.$el.find(".thumbnail img"),o=n.parent();this.$el.find(".upfront-entity-size-hint").hide(),this.$el.find(".upost_thumbnail_changer").hide(),i&&"small"===e.mode&&e.isDotAlign?(o.css("text-align",e.align),n.addClass("uimage-mobile-mode").css({position:"static",maxWidth:"100%",width:e.imageSize.width,height:"auto",minHeight:"none",display:"inline-block"}),"center"===e.valign&&n.css({marginTop:e.maskSize.height/2-e.imageSize.height/2}),"bottom"===e.valign&&n.css({marginTop:e.maskSize.height-e.imageSize.height})):n.addClass("uimage-mobile-mode").css({position:"static",maxWidth:"100%",width:i&&e&&!e.stretch?e.imageSize.width:"100%",height:"auto",minHeight:"none"}),o.parent().css({width:"100%",height:"auto"}),o.css({width:"100%",height:"auto"}),i&&e&&n.attr("src",e.src),this.$el.find(".upfront-object-content").css({minHeight:"",maxHeight:""}),this.update_height()}},unsetMobileMode:function(){var t=this.model.get_property_value_by_name("part_type");if("featured_image"===t){var e=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data"),i=this.object_group_view.is_featured_image_set(),n=this.$el.find(".thumbnail img"),o=n.parent();this.$el.find(".upfront-entity-size-hint").hide(),this.$el.find(".upost_thumbnail_changer").show(),o.css("width",e?e.maskSize.width:"").css("height",e?e.maskSize.height:""),n.removeClass("uimage-mobile-mode").css({position:"relative",maxWidth:"",minHeight:"none",width:e?e.imageSize.width:"",height:e?e.imageSize.height:"",top:e?-e.imageOffset.top:"",left:e?-e.imageOffset.left:"",display:"block",marginTop:0}),i&&e&&n.attr("src",e.srcFull),this.update_position(),this.adjust_featured_image()}},update_height:function(){var t=this.model.get_property_value_by_name("part_type");("content"==t||"comments"==t||"featured_image"==t&&this.object_group_view.mobileMode)&&(this.$el.find("> .upfront-object").css("min-height",""),this.object_group_view.$el.find("> .upfront-object-group").css("min-height",""),this.object_group_view.parent_module_view.$el.find("> .upfront-module").css("min-height",""),this.add_region_class("upfront-region-container-has-"+t,!0)),"featured_image"!=t||this.object_group_view.mobileMode||this.remove_region_class("upfront-region-container-has-"+t,!0),this.prev_region_container&&this.prev_region_container.removeClass("upfront-region-container-has-"+t)},adjust_featured_image:function(){var e=(this.$el.find(".thumbnail img").attr("src"),this.$el.find("> .upfront-editable_entity")),i=this.model.get_property_value_by_name("part_type"),n=Upfront.Settings.LayoutEditor.Grid.baseline,o=this.model.get_breakpoint_property_value("row",!0),r=o*n,s=parseInt(e.css("padding-top"),10),a=parseInt(e.css("padding-bottom"),10);if("featured_image"==i&&!this.object_group_view.mobileMode){this._editor_prepared&&this.editor_view&&this.editor_view.updateImageSize();var l=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data");r-=s+a,this.$el.find(".thumbnail").each(function(){var e,i,n=t(this).width(),o=t(this).attr("data-resize"),s=t(this).find("img"),a=new Image;t(this).css("height",r),t("<img>").attr("src",s.attr("src")).on("load",function(){_.isObject(l)&&l.imageSize?s.css({width:l.imageSize.width,height:l.imageSize.height,top:-l.imageOffset.top,left:-l.imageOffset.left}):"1"==o?(a.src=s.attr("src"),e=a.height,i=a.width,r/n>e/i?s.css({height:"100%",width:"auto",marginLeft:(n-Math.round(r/e*i))/2,marginTop:""}):s.css({height:"auto",width:"100%",marginLeft:"",marginTop:(r-Math.round(n/i*e))/2})):(e=s.height(),r!=e&&s.css("margin-top",(r-e)/2))})})}},adjust_inserted_image:function(){var e=this.model.get_property_value_by_name("part_type");if("content"==e){var i=Upfront.Behaviors.GridEditor,n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=i.get_position(this.$el.find("> .upfront-object")),s=parseInt(this.object_group_view.get_preset_property("left_indent"),10),a=parseInt(this.object_group_view.get_preset_property("right_indent"),10),l=o.col-s-a;this.$el.find(".ueditor-insert-variant-group").each(function(){var e=t(this).attr("data-variant"),p=new r.inserts[r.TYPES.POSTIMAGE],d=p._findVariant(e).toJSON(),c=d?parseInt(d.group.left,10):0,u=d?parseInt(d.group.margin_left,10):0,h=d?parseInt(d.group.margin_right,10):0,f=l-u-h,_=0,g=0;d.group.float&&("left"==d.group.float?_=(s-Math.abs(u))*i.col_size:"right"==d.group.float?g=(a-Math.abs(h))*i.col_size:"none"!=d.group.float||n&&!n.default||(_=(s-Math.abs(u)+Math.abs(c))*i.col_size,f-=c)),f=f>o.col?o.col:f,t(this).css({marginLeft:_>0?_:"",marginRight:g>0?g:"",maxWidth:f/o.col*100+"%"})})}},cleanup:function(){var t=this.model.get_property_value_by_name("part_type");this.remove_region_class("upfront-region-container-has-"+t,!0),Upfront.Views.PostDataEditor&&Upfront.Views.PostDataEditor.contentEditor&&this.editor_view&&(Upfront.Views.PostDataEditor.contentEditor._viewInstances=_.without(Upfront.Views.PostDataEditor.contentEditor._viewInstances,this.editor_view))},set_prev_region_container:function(t,e){this.prev_region_container=e}}),c=Upfront.Views.ObjectGroup.extend({init:function(){this.listenTo(this.model.get("objects"),"change",this.on_render),this.listenTo(this.model.get("objects"),"add",this.on_render),this.listenTo(this.model.get("objects"),"remove",this.on_render),this.listenTo(Upfront.Events,"editor:post:tax:updated",this.update_categories),this.prepare_editor(),this._multiple=!1,this.mobileMode=!1,this.delegateEvents()},get_extra_buttons:function(){return""},getControlItems:function(){var t=this.get_child_objects(!1),e=this.model.get_property_value_by_name("data_type"),i=this.model.get_property_value_by_name("is_locked"),n=[],o="";if("undefined"!=typeof e&&"featured_image"===e&&!this.mobileMode){o="undefined"!=typeof i&&i===!0?"lock-locked":"lock-unlocked";var r=new Upfront.Views.Editor.InlinePanels.SubControl;r.icon="more",r.tooltip=a.image_options,r.sub_items={},r.sub_items.swap=this.createControl("swap",a.swap_image,"openImageSelector"),r.sub_items.crop=this.createControl("crop",a.edit_image,"editImage"),r.sub_items.lock=this.createControl(o,a.lock_image,"lockImage"),n.push(r)}return t.length>1?(n.push(this.createControl("reorder",a.settings,"on_edit_click")),this._multiple=!0):this._multiple=!1,n.push(this.createPaddingControl()),n.push(this.createControl("settings",a.settings,"on_settings_click")),_(n)},lockImage:function(){var t=this.property("is_locked");"undefined"!=typeof t&&t===!0?(this.controls.$el.find(".upfront-icon-region-lock-locked").addClass("upfront-icon-region-lock-unlocked").removeClass("upfront-icon-region-lock-locked"),this.property("is_locked",!1)):(this.controls.$el.find(".upfront-icon-region-lock-unlocked").addClass("upfront-icon-region-lock-locked").removeClass("upfront-icon-region-lock-unlocked"),this.property("is_locked",!0))},openImageSelector:function(){this.editor.contentEditor.trigger("swap:image",this.postId)},editImage:function(){this.editor.contentEditor.trigger("edit:image")},get_preset_properties:function(){var t=this.model.get_property_value_by_name("preset"),e=this.model.get_property_value_by_name("data_type"),i=o.getPresetProperties(e+"_element",t)||{};return i},get_preset_property:function(t){var e=this.get_preset_properties();return e[t]},get_child_objects:function(t){return this.model.get("objects").filter(function(e){var i=e.get_property_value_by_name("view_class");return"PostDataPartView"==i||t===!0})},on_edit_click:function(t){"undefined"!=typeof t&&t.preventDefault(),this.enable_object_edit()},update_categories:function(){var t=this,e=this.model.get_property_value_by_name("data_type");"taxonomy"===e&&setTimeout(function(){t.render_view(e)},200)},render_view_type:function(){var t=this.model.get_property_value_by_name("data_type");this.render_view(t)},on_render:function(){this.model.get_property_value_by_name("data_type");this.postId=_upfront_post_data.post_id?_upfront_post_data.post_id:!!Upfront.Settings.LayoutEditor.newpostType&&0,Upfront.data.posts[this.postId]&&(this.post=Upfront.data.posts[this.postId],this.post.meta.length||this.post.meta.fetch()),this.render_view_type(),this.render_controls()},render_view:function(t){this.model.get_property_value_by_name("preset");if(this.child_view)return void this.child_view.render();t=t||i.DEFAULT;var e=i[t]?new i[t]({model:this.model}):new i[i.DEFAULT]({model:this.model});e.element=this,e.element.postId=this.editor.postId,e.render(),this.child_view=e,this.$el.find(".upfront-object-group-default").append(e.$el)},render_controls:function(){var t=this,e=this.model.get_property_value_by_name("data_type"),i=this.get_child_objects(!1),n=i.length>1&&!this._multiple||1==i.length&&this._multiple;"featured_image"===e&&(n=!0),this.parent_module_view&&(this.$control_el=this.$el,this.controls&&n&&(this.controls.remove(),this.controls=!1,this.$control_el.find(">.upfront-element-controls").remove()),this.updateControls(),setTimeout(function(){t.paddingControl&&"undefined"!=typeof t.paddingControl.isOpen&&!t.paddingControl.isOpen&&t.paddingControl.refresh()},300))},toggle_child_objects_loading:function(t){t=!_.isUndefined(t)&&t;var e=this.get_child_objects(!1);_.each(e,function(e){var i=Upfront.data.object_views[e.cid];i&&i._editor_prepared&&i.editor_view&&(i.editor_view.loading=t)})},prepare_editor:function(){this.listenTo(Upfront.Views.PostDataEditor,"post:cancel",this.on_cancel),this.listenTo(Upfront.Views.PostDataEditor,"editor:edit:start",this.on_edit_start),this.listenTo(Upfront.Views.PostDataEditor,"editor:edit:stop",this.on_edit_stop),this.listenTo(Upfront.Views.PostDataEditor,"editor:change:author",this.on_author_change),this.listenTo(Upfront.Views.PostDataEditor,"editor:change:date",this.on_date_change),this.stopListening(Upfront.Views.PostDataEditor,"editor:change:title"),this.listenTo(Upfront.Views.PostDataEditor,"editor:change:title",this.on_title_change),this.stopListening(Upfront.Views.PostDataEditor,"editor:change:content"),this.listenTo(Upfront.Views.PostDataEditor,"editor:change:content",this.on_content_change),this.stopListening(Upfront.Events,"editor:change:content"),this.listenTo(Upfront.Events,"editor:change:content",this.on_content_change),this.stopListening(Upfront.Events,"featured_image:updated"),this.listenTo(Upfront.Events,"featured_image:updated",this.update_featured),this.editor=Upfront.Views.PostDataEditor},on_cancel:function(){this.child_view&&this.child_view.rerender()},on_edit_start:function(){this.child_view&&(this.child_view._do_cache=!1,Upfront.Events.trigger("upfront:element:edit:start","text"))},on_edit_stop:function(){this.child_view&&(this.child_view._do_cache=!0,Upfront.Events.trigger("upfront:element:edit:stop","text"))},on_title_change:function(t){this.set_post_title=t},on_content_change:function(t,e){this.set_post_content=t},on_author_change:function(t){if(this.child_view){var e=this.model.get_property_value_by_name("data_type");this.authorId=t,"author"==e&&this.child_view.render()}},on_date_change:function(t){if(this.child_view){var e=this.model.get_property_value_by_name("data_type");this.postDate=Upfront.Util.format_date(t,!0,!0).replace(/\//g,"-"),"post_data"==e&&this.child_view.render(["date_posted"])}},on_element_edit_start:function(t,e){"write"==t&&this.parent_module_view?(this.parent_module_view.$el.find(">.upfront-module").addClass("upfront-module-editing"),this.parent_module_view.disable_interaction(!1,!0,!1,!1,!0)):this.constructor.__super__.on_element_edit_start.call(this,t,e)},on_element_edit_stop:function(t,e,i){"write"==t&&this.parent_module_view&&this.parent_module_view.enable_interaction&&i!==!0?(this.parent_module_view.$el.find(">.upfront-module").removeClass("upfront-module-editing"),this.parent_module_view.enable_interaction(!0)):this.constructor.__super__.on_element_edit_stop.call(this,t,e,i),Upfront.Events.trigger("entity:object:refresh",this)},checkSize:function(){var t=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data"),e=this.model.get_breakpoint_property_value("element_size",!0),i=t.imageSize;return"undefined"!=typeof i&&"undefined"!=typeof e&&i.width>=e.width&&i.height>=e.height?"big":"small"},is_featured_image_set:function(){var t=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_id");return!!t},get_thumb_data:function(){if(this.is_featured_image_set()){var t=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data");"undefined"!=typeof t&&(this.resizingData={data:{imageId:t.imageId,position:t.imageOffset,size:t.imageSize,rotation:t.rotation,checkSize:this.checkSize(),stretch:t.stretch,vstretch:t.stretch},img:this.$(".thumbnail").find("img")})}},setMobileMode:function(){this.mobileMode||(this.mobileMode=!0,this.render_controls(),this.trigger("set:mobile_mode"))},unsetMobileMode:function(){this.mobileMode&&(this.mobileMode=!1,this.render_controls(),this.trigger("unset:mobile_mode"))},on_element_resize_start:function(t){if(!this.mobileMode){var e=this.model.get_property_value_by_name("data_type"),i=this.property("is_locked");"featured_image"===e&&this.is_featured_image_set()&&(this.get_thumb_data(),this.$(".thumbnail").find("img").css("min-height","auto"),"small"===this.resizingData.data.checkSize&&i===!1&&(this.resizingData.data.position={left:0,top:0},this.$el.find(".thumbnail img").css({left:"0px",top:"0px",marginTop:0})))}},on_element_resizing:function(t){if(!this.mobileMode){var e=this.model.get_property_value_by_name("data_type");if("featured_image"===e&&this.is_featured_image_set()){"undefined"==typeof this.resizingData&&this.get_thumb_data();var i,n,o=this.resizingData.data,r=this.$el.find(".thumbnail img"),s=parseInt(t.width,10),a=parseInt(t.height,10),l=parseInt(this.model.get_breakpoint_property_value("left_padding_use",!0)?this.model.get_breakpoint_property_value("left_padding_num",!0):0,10),p=parseInt(this.model.get_breakpoint_property_value("right_padding_use",!0)?this.model.get_breakpoint_property_value("right_padding_num",!0):0,10),d=parseInt(this.model.get_breakpoint_property_value("top_padding_use",!0)?this.model.get_breakpoint_property_value("top_padding_num",!0):0,10),c=parseInt(this.model.get_breakpoint_property_value("bottom_padding_use",!0)?this.model.get_breakpoint_property_value("bottom_padding_num",!0):0,10),u=l+p,h=d+c,f=this.get_child_padding(),g=f.left+f.right,m=f.top+f.bottom,v=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data");o.elementSize={width:s<0?10:s,height:a<0?10:a},o.elementSize.width-=u+g,o.elementSize.height-=h+m,"e"!==t.axis&&"w"!==t.axis||(o.elementSize.height=o.elementSize.height),n=this.getElementShapeSize(o.elementSize),!1!==n&&(o.elementSize=n),this.$(".thumbnail").css("height",o.elementSize.height),this.$(".thumbnail").parent().css({height:o.elementSize.height,"max-height":o.elementSize.height,"min-height":o.elementSize.height});var b=this.property("is_locked");if(b===!1)o.stretch&&!o.vstretch?(this.resizingH(r,o,!0),this.resizingV(r,o)):!o.stretch&&o.vstretch?(this.resizingV(r,o,!0),this.resizingH(r,o)):(i=o.size.width/o.size.height-o.elementSize.width/o.elementSize.height,i>0&&o.stretch||i<0&&!o.stretch?(this.resizingV(r,o,!0),this.resizingH(r,o)):(this.resizingH(r,o,!0),this.resizingV(r,o)));else{var y,w=v.valign,k=v.align,$=v.imageOffset,x=v.isDotAlign,U=this.$(".upostdata-part.thumbnail").height(),E=this.$(".upostdata-part.thumbnail").width(),S=parseInt(this.$el.find(".upfront-post-data-part").css("padding-left"),10),C=parseInt(this.$el.find(".upfront-post-data-part").css("padding-right"),10),T=S+C,z=this.checkSize(),I=r.position(),P=(this.getMaskSize(t),this.getImageViewport()),M=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data"),j=$.left;if("undefined"!=typeof P.width&&o.elementSize.width>P.width&&r.css({left:I.left+(o.elementSize.width-P.width)}),"undefined"!=typeof P.height&&o.elementSize.height>P.height&&r.css({top:I.top+(o.elementSize.height-P.height)}),"small"===z&&x){"center"===k&&(j=o.size.width<t.width?(o.size.width-t.width)/2:-(t.width-E)/2),"right"===k&&(j=o.size.width<t.width?o.size.width-t.width:-(t.width-E)),"center"===w&&(y=o.size.height<o.elementSize.height?(o.size.height-o.elementSize.height)/2:-(o.elementSize.height-U)/2),"bottom"===w&&(y=o.size.height<o.elementSize.height?o.size.height-o.elementSize.height:-(o.elementSize.height-U));var O={top:y,left:j+T},r=this.$el.find(".thumbnail img");this.property("position",{top:y,left:j+T}),newImageData=_.extend(M,{imageOffset:{top:y,left:j+T},position:{top:y,left:j+T}}),Upfront.Events.trigger("featured:image:resized",newImageData),r.css("top",-O.top),r.css("left",-O.left)}}}}},on_element_resize:function(t){"undefined"==typeof this.resizingData&&this.get_thumb_data();var e=this.model.get_property_value_by_name("data_type"),i=this.get_child_objects(!1),n=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),o=Upfront.Settings.LayoutEditor.Grid,r=parseInt(this.model.get_breakpoint_property_value("left_padding_use",!0)?this.model.get_breakpoint_property_value("left_padding_num",!0):0,10),s=parseInt(this.model.get_breakpoint_property_value("right_padding_use",!0)?this.model.get_breakpoint_property_value("right_padding_num",!0):0,10),a=parseInt(this.model.get_breakpoint_property_value("top_padding_use",!0)?this.model.get_breakpoint_property_value("top_padding_num",!0):0,10),l=parseInt(this.model.get_breakpoint_property_value("bottom_padding_use",!0)?this.model.get_breakpoint_property_value("bottom_padding_num",!0):0,10),p=t.row-parseInt(a/o.baseline,10)-parseInt(l/o.baseline,10);if("featured_image"===e&&this.is_featured_image_set()&&!this.mobileMode){var d=this.$el.find("img"),c={width:d.width(),height:d.height()},u=d.position(),h=r+s,f=a+l,g=this.get_child_padding(),m=g.left+g.right,v=g.top+g.bottom,b=parseInt(t.width,10),y=parseInt(t.height,10),w={width:b<0?10:b,height:y<0?10:y};maskSize={width:t.width,height:t.height},u.top=-u.top,u.left=-u.left,w.width-=h+m,w.height-=f+v,this.temporaryProps={size:c,maskSize:maskSize,position:u},this.saveTemporaryResizing(w)}1==i.length&&(n.default?_.each(i,function(t){t.set_property("row",p)}):_.each(i,function(t){var e=Upfront.Util.clone(t.get_property_value_by_name("breakpoint")||{});_.isObject(e[n.id])||(e[n.id]={}),e[n.id].row=p,t.set_property("breakpoint",e)}),Upfront.Events.trigger("entity:object:refresh",this))},after_breakpoint_change:function(){var t=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON();this.model.get_property_value_by_name("data_type");t&&!t.default?this.setMobileMode():this.unsetMobileMode(),this.render_controls()},get_child_padding:function(){var t=Upfront.Settings.LayoutEditor.Grid.column_padding,e=this.get_child_objects(!1),i=1==e.length&&e[0],n=i?parseInt(i.get_breakpoint_property_value("left_padding_use",!0)?i.get_breakpoint_property_value("left_padding_num",!0):t,10):t,o=i?parseInt(i.get_breakpoint_property_value("right_padding_use",!0)?i.get_breakpoint_property_value("right_padding_num",!0):t,10):t,r=i?parseInt(i.get_breakpoint_property_value("top_padding_use",!0)?i.get_breakpoint_property_value("top_padding_num",!0):t,10):t,s=i?parseInt(i.get_breakpoint_property_value("bottom_padding_use",!0)?i.get_breakpoint_property_value("bottom_padding_num",!0):t,10):t;return{left:n,right:o,top:r,bottom:s}},getImageViewport:function(){"undefined"==typeof this.resizingData&&this.get_thumb_data();var t,e,i,n=this.$el.find(".thumbnail img"),o=n.position();return o.left<0&&(e=n.width()-Math.abs(o.left)),o.top<0&&(i=n.height()-Math.abs(o.top)),t={width:e,height:i}},getThumbnailData:function(){},getMaskSize:function(t){var e=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data"),i=e.imageSize,n=(this.checkSize(),Math.min(i.width,t.width)),o=Math.min(i.height,t.height),r={width:n,height:o};return r},resizingH:function(t,e,i){var n,o=e.elementSize.width,r=i?e.size.width:t.width(),s=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data"),a=e.position.left,l={};return e.stretch?(o<r-a?(l.left=-a,i&&(l.width=r)):r>o&&o>=r-a?(l.left=o-r,i&&(l.width=r)):(l.left=0,i&&(l.width=o)),i&&(l.height="auto"),void t.css(l)):o>r?(n=s.align,"left"===n?l.left=0:"center"===n?l.left=(o-r)/2:(l.left="auto",l.right=0),i&&(l.width=r,l.height="auto"),void t.css(l)):(l.left=0,i&&(l.width=o,l.height="auto"),void t.css(l))},resizingV:function(t,e,i){var n=e.elementSize.height,o=i?e.size.height:t.height(),r=e.position.top,s={};return e.vstretch?(n<o-r?(s.top=-r,i&&(s.height=o)):o>n&&n>=o-r?(s.top=n-o,i&&(s.height=o)):(s.top=0,i&&(s.height=n)),i&&(s.width="auto"),void t.css(s)):(n>o-r?(s.top=-r,i&&(s.height=o)):o-r>=n&&n>o?(s.top=n-o,i&&(s.height=o)):(s.top=0,i&&(s.height=n)),i&&(s.width="auto"),void t.css(s))},getElementShapeSize:function(t){return!1},saveTemporaryResizing:function(e){"undefined"==typeof this.resizingData&&this.get_thumb_data();var i=this,n={},o=this.resizingData.data.imageId,r=this.temporaryProps.size,s=this.temporaryProps.position,l=t.Deferred(),p=t.Deferred(),d=p.promise(),c=Upfront.Views.PostDataEditor.post.meta.getValue("_thumbnail_data");return n.top=s.top,n.left=s.left,n.width=Math.min(e.width,r.width),n.height=Math.min(e.height,r.height),newImageData=_.extend(c,{imageSize:r,imageOffset:s,position:s,maskSize:this.temporaryProps.maskSize}),Upfront.Events.trigger("featured:image:resized",newImageData),d.done(function(){o=i.resizingData.data.imageId,Upfront.Views.Editor.ImageEditor.saveImageEdition(o,i.resizingData.data.rotation,r,n).done(function(t){var n=t.data.images[o];return n.error&&!i.isThemeImage?void Upfront.Views.Editor.notify(a.process_error,"error"):(newImageData=_.extend(c,{imageSize:r,imageOffset:s,position:s,src:n.url,srcFull:n.urlOriginal,stretch:r.width>=e.width,vstretch:r.height>=e.height,gifImage:n.gif,maskSize:i.temporaryProps.maskSize,cropBig:i.resizingData.data.cropBig}),Upfront.Events.trigger("featured:image:resized",newImageData),clearTimeout(i.cropTimer),i.cropTimer=!1,void l.resolve())})}),this.isThemeImage&&"themeExporter"in Upfront?this.importImage().always(function(){p.resolve()}):p.resolve(),l.promise()},update_featured:function(t){t&&t.attr("src").length>0&&(this.full_featured_image=t.attr("src"))},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)}}),u=Upfront.Views.Editor.Sidebar.Element.extend({_default_data:{type:"",columns:24,rows:Upfront.Util.height_to_row(200),name:"",parts:{}},_post_parts:[],render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-"+this._default_data.type),this.$el.html(this._default_data.name)},create_part_objects:function(t){var e=this,i=[],n=[],o=this._default_data.type,r=(Upfront.mainData||{})[o+"_elementPresets"]||[],s=(_.findWhere(r,{id:"default"})||{}).hidden_parts||[];return _.each(t,function(t){if(!(s.indexOf(t)>=0)){var o=e.create_part_object(t);i.push(o.object),n.push(o.wrapper)}}),{objects:i,
wrappers:n}},create_part_object:function(t){var e=_.isObject(this._default_data.parts)&&_.isObject(this._default_data.parts[t])?this._default_data.parts[t]:{},i=Upfront.Util.get_unique_id("wrapper"),n=new Upfront.Models.Wrapper({properties:[{name:"wrapper_id",value:i},{name:"class",value:"c24"}]}),o=new l({properties:[{name:"view_class",value:"PostDataPartView"},{name:"part_type",value:t},{name:"has_settings",value:0},{name:"class",value:"c24 upfront-post-data-part part-"+t},{name:"wrapper_id",value:i}]});return _.isUndefined(e.rows)||o.set_property("row",e.rows,!0),{object:o,wrapper:n}},add_element:function(){var t=this.create_part_objects(this._post_parts),e=new p({properties:[{name:"data_type",value:this._default_data.type},{name:"row",value:this._default_data.rows}],objects:t.objects,wrappers:t.wrappers}),i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c"+this._default_data.columns+" upfront-post_data_module"},{name:"has_settings",value:0},{name:"row",value:this._default_data.rows}],objects:[e]});this.add_module(i)}}),h=u.extend({_default_data:{type:"post_data",columns:18,rows:Upfront.Util.height_to_row(200),name:a.part_post_data},_post_parts:["date_posted","title","content"]}),f=u.extend({_default_data:{type:"author",columns:4,rows:Upfront.Util.height_to_row(100),name:a.part_author},_post_parts:["author","gravatar","author_email","author_url","author_bio"]}),g=u.extend({_default_data:{type:"taxonomy",columns:18,rows:Upfront.Util.height_to_row(50),name:a.part_cats_and_tags},_post_parts:["tags","categories"]}),m=u.extend({_default_data:{type:"featured_image",columns:18,rows:Upfront.Util.height_to_row(200),name:a.part_featured_image,parts:{featured_image:{rows:Upfront.Util.height_to_row(200)}}},_post_parts:["featured_image"]}),v=u.extend({_default_data:{type:"comments",columns:18,rows:Upfront.Util.height_to_row(200),name:a.part_comments},_post_parts:["comment_count","comments","comments_pagination","comment_form"]}),b=u.extend({_default_data:{type:"meta",columns:4,rows:Upfront.Util.height_to_row(50),name:a.part_meta},_post_parts:["meta"]});Upfront.Events.on("application:setup:editor_interface",function(){s()}),s(),Upfront.Models.PostDataModel=p,Upfront.Models.PostDataPartModel=l,Upfront.Views.PostDataView=c,Upfront.Views.PostDataPartView=d})}(jQuery),function(t){define("this_page",[],function(){var e=Upfront.Settings.l10n.this_page_element,i=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.thisPage.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),n=function(){var n=!1,o=!1,r=!1,s=!1,a=[],l={},p={};return Upfront.Views.ObjectView.extend({markup:!1,loading:!1,display:"title",deferred:!1,is_new:!1,is_started:!1,initialize:function(t){this.model instanceof i||(this.model=new i({properties:this.model.get("properties")})),this.constructor.__super__.initialize.call(this,[t]),this.display=this.model.get_property_value_by_name("display"),a.push(this),n=_upfront_post_data.post_id?_upfront_post_data.post_id:!!Upfront.Settings.LayoutEditor.newpostType&&0,this.listenTo(Upfront.Events,"command:layout:save_start",this.on_save)},get_content_markup:function(){return o||!this.markup?(this.get_markup().done(t.proxy(this.refresh_markup,this)),"Loading"):this.markup},on_render:function(){this.update_editor(this.$el.find(".upfront-object-content"))},on_edit:function(){this.update_editor(this.$el.find(".upfront-object-content"),!0,!0)},get_markup:function(){var i=this;if(i.deferred=new t.Deferred,n===!1)return i.deferred.resolve("error");if(r)return i.deferred.promise();if(!o&&l.length>0&&l[i.display])return i.deferred.resolve(l[i.display]);var s=i.$el.find(".upfront-object-content"),p=!!s.length&&new Upfront.Views.Editor.Loading({loading:e.refreshing,done:e.here_we_are,fixed:!1});return p&&(p.render(),s.append(p.$el)),r=!0,Upfront.Util.post({action:"this_page-get_markup",data:JSON.stringify({post_id:n,post_type:Upfront.Settings.LayoutEditor.newpostType})}).success(function(t){p&&(p.done(),p=!1);var e=e||i.$el.find(".upfront-object-content"),o=Upfront.data.posts[n];l=t.data.filtered,_.each(a,function(t){t.is_new=o&&o.is_new,t.deferred.resolve(l[t.display])}),o&&(o.is_new=!1)}).done(function(){r=!1}),i.deferred.promise()},get_page:function(){var e,i=new t.Deferred;return Upfront.data.posts[n]?(e=Upfront.data.posts[n],i.resolve(e)):(e=new Upfront.Models.Post({ID:n}),e.fetch({withMeta:!0,filterContent:!0}).done(function(t){Upfront.data.posts||(Upfront.data.posts={}),Upfront.data.posts[n]=e,i.resolve(e)}),i.promise())},refresh_markup:function(t){var e=this,i=this.$el.find(".upfront-object-content"),n=_.findWhere(Upfront.data.ueditor.selectors,{type:this.display}).selector,o="";this.get_page().done(function(r){i.html(t),"title"==e.display?o=r.get("post_title"):"content"==e.display&&(o=r.get("post_content")),i.find(n).html(o),e.markup=i.html(),e.update_editor(i)})},update_editor:function(i,n,o){o="undefined"==typeof o||o;var r=this,s=_.findWhere(Upfront.data.ueditor.selectors,{type:this.display}).selector,l=i.find(s),d=l.data("ueditor"),c={},u=!1;return d?void(n!==!0||r.is_started||l.trigger("dblclick")):("title"==r.display?c={airButtons:{},observeLinks:!1,tabFocus:!1,disableLineBreak:!0,pastePlainText:!0,autostart:n===!0,placeholder:e.title_placeholder,focus:o}:"content"==r.display&&(c={linebreaks:!1,autostart:n===!0,placeholder:e.content_placeholder,focus:o,upfrontMedia:!0,upfrontImages:!0}),void l.on("start",function(){u=!0,r.is_started=!0,_.each(a,function(t){t!=r&&t.update_editor(t.$el.find(".upfront-object-content"),!0,!1)}),setTimeout(function(){l.ueditor("focus")},100),Upfront.Events.trigger("upfront:element:edit:start","text")}).on("stop",function(){u=!1,r.is_started=!1,Upfront.Events.trigger("upfront:element:edit:stop")}).on("syncAfter",function(){u&&(p[r.display]=l.ueditor("get"),r.markup=t(r.markup).html(p[r.display]).get(0).outerHTML)}).ueditor(c))},on_save:function(){if(!s){s=!0;var t=this;this.get_page().done(function(e){e.set("post_status","publish"),e.set("post_title",p.title),e.set("post_content",p.content),e.save().done(function(){if(t.is_new){var e="/edit/page/"+n;Upfront.Application.navigate(e),s=!1}})})}},cleanup:function(){var t=this;_.each(a,function(e,i){e==t&&a.splice(i)})}})}();Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.html(e.page_title)},add_element:function(){var t=new i({view:"ThisPageTitle"}),e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-this_page_title_module"},{name:"has_settings",value:0}],objects:[t]});this.add_module(e)}}),Upfront.Views.Editor.Sidebar.Element.extend({draggable:!1,render:function(){this.$el.html(e.page_content)},add_element:function(){var t=new i({view:"ThisPageContent"}),e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-this_page_content_module"},{name:"has_settings",value:0}],objects:[t]});this.add_module(e)}});Upfront.Models.ThisPageModel=i,Upfront.Views.ThisPageView=n})}(jQuery),function(t){define("elements/upfront-widget/js/settings",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","scripts/upfront/preset-settings/util","text!elements/upfront-widget/tpl/preset-style.html"],function(t,e,i,n){var o=Upfront.Settings.l10n.widget_element,r=!1,s=!1,a=Upfront.Views.Editor.Settings.Item.extend({get_title:function(){for(var t in Upfront.data.uwidget.widgets)if(Upfront.data.uwidget.widgets[t].key===s||Upfront.data.uwidget.widgets[t].key===this.model.get_property_value_by_name("current_widget"))return Upfront.data.uwidget.widgets[t].name;return r?r:""},update_settings:function(t,e){var i=this,n={action:"uwidget_get_widget_admin_form",data:JSON.stringify({widget:t})};Upfront.Util.post(n).success(function(n){i.model.set_property("current_widget_specific_fields",n.data),i.$el.html(""),s=t,r=t,i.udpate_fields(),i.render(),e.model.set_property("current_widget",t)}).error(function(t){console.log("error receiving widget specific settings")})},initialize:function(){s=r,this.udpate_fields()},udpate_fields:function(){this.fields=_([]);var t=this.model.get_property_value_by_name("current_widget_specific_fields")||this.model.get_property_value_by_name("widget_specific_fields");for(var e in t)"select"==t[e].type?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Select({model:this.model,property:t[e].name,label:t[e].label,values:_.map(t[e].options,function(t,e){return{label:t,value:e}}),change:this.clear_cache,default_value:t[e].value}):"text"==t[e].type?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Text({model:this.model,property:t[e].name,label:t[e].label,value:t[e].value,change:this.clear_cache}):"textarea"==t[e].type?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Textarea({model:this.model,property:t[e].name,label:t[e].label,value:t[e].value,change:this.clear_cache}):"checkbox"==t[e].type?this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Checkboxes({model:this.model,property:t[e].name,label:"",values:[{label:t[e].label,value:t[e].value}],change:this.clear_cache}):"radio"==t[e].type&&(this.fields._wrapped[this.fields._wrapped.length]=new Upfront.Views.Editor.Field.Radios({model:this.model,property:t[e].name,label:"",values:[{label:t[e].label,value:t[e].value}],change:this.clear_cache}))},clear_cache:function(t){Upfront.data.uwidget.widgets_cache={};var e=(this.options||{}).property,i=this.model.get_property_value_by_name("current_widget_specific_fields");_.each(i,function(i,n){e===(i||{}).name&&this.model.set_property(e,t)},this)}}),l=t.extend({panels:{Appearance:{mainDataCollection:"widgetPresets",styleElementPrefix:"widget-preset",ajaxActionSlug:"widget",panelTitle:o.settings,presetDefaults:{id:"default",name:o.default_preset},styleTpl:n,migrateDefaultStyle:function(t){return t=t.replace(/(div)?\.upfront-widget\s/g,""),t=t.replace(/(div)?\.upfront-object\s/g,"")}}},initialize:function(t){s=r=!1,this.constructor.__super__.initialize.call(this,t);var i=_(_.filter(Upfront.data.uwidget.widgets,function(t){return t.admin})).map(function(t){return{label:t.name,value:t.key}});i.unshift({label:o.widget_select,value:""});var n=new e({model:this.model,className:"upfront-settings_panel_wrap widget-settings",title:o.settings}),l=new a({model:this.model}),p=new Upfront.Views.Editor.Settings.Item({model:this.model,title:o.widget_select,fields:[new Upfront.Views.Editor.Field.Select({model:this.model,property:"widget",values:i,change:function(t){r=t,s!==t&&l.update_settings(t,this)}})]});n.settings=_([p,l]),this.panels=_.extend({General:n},this.panels);var d=function(){this.model.set_property("widget_specific_fields",this.model.get_property_value_by_name("current_widget_specific_fields"))};Upfront.Events.off("element:settings:saved",d),Upfront.Events.once("element:settings:saved",d,this);var c=function(){r=s=this.model.get_property_value_by_name("widget"),this.model.set_property("current_widget_specific_fields",this.model.get_property_value_by_name("widget_specific_fields"),!0),this.model.set_property("current_widget",this.model.get_property_value_by_name("widget"))};Upfront.Events.off("element:settings:canceled",c),Upfront.Events.once("element:settings:canceled",c,this)},title:o.settings});return i.generatePresetsToPage("widget",n),l})}(jQuery),function(t){define("uwidget",["elements/upfront-widget/js/settings"],function(t){var e=Upfront.Settings.l10n.widget_element,i=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.uwidget.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}}),n=Upfront.Views.ObjectView.extend({loading:null,content_loaded:!1,initialize:function(t){this.model instanceof i||(this.model=new i({properties:this.model.get("properties")})),this.model.set_property("current_widget",this.model.get_property_value_by_name("widget"),!0),this.model.set_property("current_widget_specific_settings",this.model.get_property_value_by_name("widget_specific_fields"),!0),this.constructor.__super__.initialize.call(this,[t])},init:function(){Upfront.data.uwidget.widgets_cache||(Upfront.data.uwidget.widgets_cache={}),Upfront.Events.on("entity:settings:activate",this.clear_cache,this)},clear_cache:function(){Upfront.data.uwidget.widgets_cache[this.model.get_property_value_by_name("current_widget")+this.cid]=null},get_content_markup:function(){var t=this.model.get_property_value_by_name("current_widget");if(me=this,!t||""===t)return'<span class="no-widget-notice">'+e.select_widget+"</span>";var i=Upfront.data.uwidget.widgets_cache[t+this.cid]||"";return i&&(this.content_loaded=!0),i},on_render:function(){var t=this.model.get_property_value_by_name("current_widget");t&&("undefined"!=typeof Upfront.data.uwidget.widgets_cache[t+this.cid]&&null!=Upfront.data.uwidget.widgets_cache[t+this.cid]||(this.content_loaded&&(this.loading=new Upfront.Views.Editor.Loading({loading:e.loading,done:e.done}),this.loading.render(),this.$el.append(this.loading.el)),this._get_widget_markup(t)))},_get_widget_markup:function(t){var e=this,i=this.model.get_property_value_by_name("current_widget_specific_fields")||this.model.get_property_value_by_name("widget_specific_fields"),n={};for(var o in i)n[i[o].name]=this.model.get_property_value_by_name(i[o].name);Upfront.Events.trigger("entity:object:refresh:start",e),Upfront.Util.post({action:"uwidget_get_widget_markup",data:JSON.stringify({widget:t,instance:n})}).success(function(i){Upfront.data.uwidget.widgets_cache[t+e.cid]=i.data,e.loading?e.loading.done(function(){e.render()}):e.render(),Upfront.Events.trigger("entity:object:refresh",e)}).error(function(t){Upfront.Util.log("Error loading widget")})}}),o=Upfront.Views.Editor.Sidebar.Element.extend({priority:80,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-widget"),this.$el.html(e.element_name)},add_element:function(){var t=new i,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c6 upfront-widget_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(150)}],objects:[t]});this.add_module(e)}});Upfront.Application.LayoutEditor.add_object("Uwidget",{Model:i,View:n,Element:o,Settings:t,cssSelectors:{".widget":{label:e.css.container_label,info:e.css.container_info},".widget a":{label:e.css.links_label,info:e.css.links_info}},cssSelectorsId:Upfront.data.uwidget.defaults.type}),Upfront.Models.UwidgetModel=i,Upfront.Views.UwidgetView=n})}(jQuery),define("text!elements/upfront-youtube/tpl/youtube.html",[],function(){return'<div class="upfront-youtube-container <?php if ($multiple_videos && count($multiple_videos) < 2) { ?>uyoutube-single<?php } else { ?>uyoutube-multiple-<?php echo $display_style ?><?php } ?>">\r\n    <?php if ($multiple_videos && count($multiple_videos) == 1) { ?>\r\n\t\t<?php if(!empty($multiple_videos[0][\'id\'])) { ?>\r\n\t\t<iframe src="https://www.youtube.com/embed/<?php echo $multiple_videos[0][\'id\'] ?>?modestbranding=1<?php echo $loop_string ?><?php echo $autoplay_string ?>" height="<?php echo $player_height ?>" width="<?php echo $player_width ?>"></iframe>\r\n\t\t\t<?php if(!empty($multiple_show_title[0])){ ?>\r\n\t\t\t\t<h3><?php echo $multiple_videos[0][\'title\'] ?></h3>\r\n\t\t\t<?php } ?>\r\n\t\t<?php } else { ?>\r\n\t\t\t<div class="uyoutube-player" style="width: <?php echo $player_width ?>px; height: <?php echo $player_height ?>px;"></div>\r\n\t\t<?php } ?>\r\n\t<?php } ?>\r\n\t\r\n\t<?php if (count($multiple_videos) > 1) { ?>\r\n    <div class="uyoutube-main-video">\r\n      <?php if ( !empty($multiple_videos[0] ) ) { ?>\r\n      <iframe src="https://www.youtube.com/embed/<?php echo $multiple_videos[0][\'id\'] ?>?modestbranding=1<?php echo $loop_string ?><?php echo $autoplay_string ?>" height="<?php echo $player_height ?>" width="<?php echo $player_width ?>"></iframe>\r\n\t\t<h3><?php echo $multiple_videos[0][\'title\'] ?></h3>\r\n\t  <?php } else { ?>\r\n        <div class="uyoutube-player" style="height:<?php echo $player_height ?>px; width:<?php echo $player_width ?>px;"></div>\r\n      <?php } ?>\r\n    </div>\r\n\t<div class="uyoutube-thumbnails">\r\n    <?php if ($display_style == \'gallery\') { ?>\r\n      <?php if ($multiple_videos && count( $multiple_videos )  ) {  ?>\r\n        <?php for ($i = 0; $i < count( $multiple_videos ); $i++) {  ?>\r\n\t\t<?php if(empty($first_to_thumbnails[0]) && $i == 0) { continue; } ?>\r\n          <div class="uyoutube-thumbnail uyoutube-gallery-item <?php if(empty($first_to_thumbnails[0])) { ?>firstHidden<?php } ?>" data-video-id="<?php echo $multiple_videos[$i][\'id\'] ?>" style="width:<?php echo $thumbWidth ?>px;">\r\n            <div class="uyoutube-thumb-mask" style="width:<?php echo $thumbWidth ?>px;height:<?php echo $thumbHeight ?>px"><!-- add width height dynamicly -->\r\n\t\t\t\t<img class="uyoutube-thumb" src="https://img.youtube.com/vi/<?php echo $multiple_videos[$i][\'id\'] ?>/hqdefault.jpg" style="width:<?php echo $thumbWidth ?>px; margin-top: -<?php echo $thumbOffset ?>px;">\r\n            </div>\r\n            <?php if(!empty($multiple_show_title[0])){ ?>\r\n            <h4 class="uyoutube-title"><?php echo $multiple_videos[$i][\'title\'] ?></h4>\r\n            <?php } ?>\r\n          </div>\r\n        <?php } ?>\r\n      <?php } ?>\r\n    <?php } ?>\r\n    <?php if ($display_style == \'list\') { ?>\r\n      <?php if ($multiple_videos) { ?>\r\n        <?php for ($i = 0; $i < count( $multiple_videos ); $i++) { ?>\r\n\t\t<?php if(empty($first_to_thumbnails[0]) && $i == 0) { continue; } ?>\r\n        <div class="uyoutube-thumbnail uyoutube-list-item <?php if(empty($first_to_thumbnails[0])) { ?>firstHidden<?php } ?>" data-video-id="<?php echo $multiple_videos[$i][\'id\'] ?>">\r\n            <div class="uyoutube-thumb-holder" style="width:<?php echo $thumbWidth ?>px;">\r\n              <div class="uyoutube-thumb-mask" style="width:<?php echo $thumbWidth ?>px;height:<?php echo $thumbHeight ?>px">\r\n                <img class="uyoutube-thumb" style="width:<?php echo $thumbWidth ?>px; margin-top: -<?php echo $thumbOffset ?>px" src="http://img.youtube.com/vi/<?php echo $multiple_videos[$i][\'id\'] ?>/hqdefault.jpg" width="80">\r\n              </div>\r\n            </div>\r\n            <div class="uyoutube-content-holder">\r\n              <?php if ($multiple_show_title[0]) { ?>\r\n                <h4 class="uyoutube-title"><?php echo $multiple_videos[$i][\'title\'] ?></h4>\r\n              <?php } ?>\r\n            </div>\r\n          </div>\r\n        <?php } ?>\r\n      <?php }  ?>\r\n    <?php } ?>\r\n\t</div>\r\n  <?php } ?>\r\n</div>\r\n'}),define("text!elements/upfront-youtube/tpl/clonevideo.html",[],function(){return'<div class="upfront-settings-item">\n\t<div class="upfront-settings-item-content">\n\t\t<div class="multiple_sources">\n\t\t\t<label class="upfront-field-label upfront-field-label-block" for="view3296-multiple_source_{{cloneId}}">{{l10n.video_label}} {{cloneId}} {{l10n.url_label}}</label>\n\t\t\t<input id="view3296-multiple_source_{{cloneId}}" class="upfront-field upfront-field-text" type="text" placeholder="{{l10n.url_placeholder}}" value="{{videoUrl}}" name="multiple_source_{{cloneId}}">\n\t\t</div>\n\t</div>\n</div>'}),function(t){define("uyoutube",["scripts/upfront/element-settings/settings","scripts/upfront/element-settings/root-settings-panel","text!elements/upfront-youtube/tpl/youtube.html","text!elements/upfront-youtube/tpl/clonevideo.html"],function(e,i,n,o){var r=Upfront.Settings.l10n.youtube_element,s=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.uyoutube.defaults);t.element_id=Upfront.Util.get_unique_id("youtube-object"),this.init_properties(t)}}),a=Upfront.Views.ObjectView.extend({model:s,youtubeTpl:Upfront.Util.template(n),elementSize:{width:0,height:0},initialize:function(){this.model instanceof s||(this.model=new s({properties:this.model.get("properties")}));this.parent_module_view;this.delegateEvents(),this.model.get("properties").bind("change",this.render,this),this.model.get("properties").bind("change",this.handle_visual_padding_hint,this),this.model.get("properties").bind("add",this.render,this),this.model.get("properties").bind("remove",this.render,this),this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",this.onResizeStop)},on_element_resize_start:function(t){this.$el.find(".upfront-object-content").append('<div class="object-view-overlay" />')},on_element_resize:function(t){this.$el.find(".object-view-overlay").remove(),this.onResizeStop(this)},get_content_markup:function(){var t,e=this.extract_properties();this.trimListTitle();var i=this.model.get_property_value_by_name("multiple_videos"),n=i.length>0?i[0].id:"",o=this.model.get_property_value_by_name("loop").length>0,s=this.model.get_property_value_by_name("autoplay").length>0;return e.loop_string=o?"&loop=1&playlist="+n:"",e.autoplay_string=s?"&autoplay=1":"",t=this.youtubeTpl(e),"starting"===this.property("youtube_status")&&!e.multiple_videos&&Upfront.Application.user_can_modify_layout()&&(t+='<div class="upfront-youtube-starting-select upfront-initial-overlay-wrapper"><div class="upfront-youtube-starting-wrapper upfront-initial-overlay-wrapper" style="height: 110px;"><div class="upfront-youtube-starting-text">'+r.enter_url+'</div><div class="upfront-youtube-box-wrapper"><input type="text" class="upfront-youtube-url" placeholder="'+r.url_placeholder+'" /></div><div class="upfront-youtube-button-wrapper"><button type="button" class="upfront-youtube-button">'+r.submit_button+"</button></div></div></div>"),t},trimListTitle:function(){var e=this,i=this.extract_properties();null!==i.multiple_videos&&"object"==typeof i.multiple_videos&&t.each(i.multiple_videos,function(t,i){i.title&&!i.original_title&&(i.original_title=i.title),i.title&&i.original_title&&(i.title=i.original_title.substring(0,e.property("multiple_title_length")))})},extract_properties:function(){var t={};return this.model.get("properties").each(function(e){t[e.get("name")]=e.get("value")}),t},onResizeStop:function(t,e,i){var n;"starting"!==this.property("youtube_status")&&(n=this.$el.find(".upfront-object-content").width(),this.property("player_height",parseInt(n/1.641,10)),this.property("player_width",n,!1))},addVideo:function(t){me.property("youtube_status","ok"),me.property("multiple_source_1",t),Upfront.Events.trigger("entity:settings:activate",me),me.onResizeStop(),this.listenTo(Upfront.Events,"upfront:youtube:added:done",function(){me.on_settings_click(),me.stopListening(Upfront.Events,"upfront:youtube:added:done")}),Upfront.Events.trigger("upfront:youtube:added")},on_render:function(){me=this,this.$el.find(".upfront-youtube-button").on("click",function(e){var i=t(this).parents().find("input.upfront-youtube-url").val();i&&(i.match(/youtu\.be/)?(videoMatch=i.match(/^(https?:\/\/)?youtu.be\/([0-9a-zA-Z\-_]{11})/),null!==videoMatch&&videoMatch.length>0?me.addVideo(i):Upfront.Views.Editor.notify(r.validMessage,"error")):(videoMatch=i.match(/^(https?:\/\/(www\.)?)?youtube\.com\/watch\?v=([0-9a-zA-Z\-_]{11}).*/),null!==videoMatch&&videoMatch.length>0?me.addVideo(i):Upfront.Views.Editor.notify(r.validMessage,"error")))}),this.$el.find(".upfront-youtube-url").on("keydown",function(t){13==t.which&&(me.$el.find(".upfront-youtube-button").click(),Upfront.Events.trigger("upfront:element:edit:stop"))}),Upfront.Events.trigger("entity:object:refresh",this)},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)}}),l=Upfront.Views.Editor.Sidebar.Element.extend({priority:90,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-youtube"),this.$el.html("YouTube")},add_element:function(){var t=new s,e=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c11 upfront-youtube_module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(225)}],objects:[t]});this.add_module(e)}}),p=(Upfront.Views.Editor.Field.Text.extend({on_render:function(){var t="upfront-field-wrap upfront-field-wrap-number";this.options.disabled||(t+=" upfront-field-wrap-disabled"),this.el.className=t},get_field_html:function(){var t={type:"number",class:"upfront-field upfront-field-number",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value(),min:this.options.min,max:this.options.max,step:this.options.step};return this.options.disabled&&(t.disabled="disabled")," <input "+this.get_field_attr_html(t)+" /> "+(this.options.suffix?this.options.suffix:"")}}),i.extend({className:"uyoutube-settings",tabbed:!1,title:r.general_settings,initialize:function(t){this.options=t;var e=function(){this.settings.invoke("render")},i=this,n=Upfront.Views.Editor.Settings.Item,o=Upfront.Views.Editor.Field;this.model.on("doit",e,this),this.settings=_([new n({className:"optional-field align-center general_settings_item",title:r.apperance_title,fields:[new o.Radios({model:this.model,property:"display_style",layout:"horizontal",label:r.display_style,className:"field-display_style upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",values:[{label:r.gallery_label,value:"gallery"},{label:r.list_label,value:"list"}]}),new o.Checkboxes({model:this.model,property:"first_to_thumbnails",className:"first-video-to-thumbnails",default_value:["1"],values:[{label:r.first_to_thumbnails,value:"1"}],change:function(t){this.model.set_property("first_to_thumbnails",t)}}),new o.Checkboxes({model:this.model,property:"multiple_show_title",label:"",values:[{label:"",value:"multiple_show_title"}],change:function(t){this.model.set_property("multiple_show_title",t)}}),new o.Number({model:this.model,property:"multiple_title_length",label:r.title_limit,label_style:"inline",suffix:r.characters_label,min:50,max:100,step:1,default_value:100,change:function(t){this.model.set_property("multiple_title_length",t)}}),new o.Slider({model:this.model,property:"thumbWidth",className:"thumbnails-width",min:100,max:250,step:5,label:r.thumbnail_size,valueTextFilter:function(t){return"("+t+"px x "+i.model.get_property_value_by_name("thumbHeight")+"px)"}}),new o.Hidden({model:this.model,property:"thumbHeight"})]}),new n({model:this.model,title:r.playback,className:"loop-video general_settings_item",fields:[new o.Checkboxes({model:this.model,property:"autoplay",className:"autoplay upfront-field-wrap",values:[{label:r.autoplay,value:"autoplay"}],change:function(t){this.model.set_property("autoplay",t)}}),new o.Checkboxes({model:this.model,property:"loop",className:"loop upfront-field-wrap",values:[{label:r.loop,value:"loop"}],change:function(t){this.model.set_property("loop",t)}})]}),new n({model:this.model,title:r.videos_title,className:"multiple_video_section general_settings_item",fields:[new o.Text({model:this.model,label:r.default_video,className:"multiple_sources yt_first_video",property:"multiple_source_1",placeholder:r.video_placeholder})]}),new n({model:this.model,className:"upfront-add-another-wrapper",fields:[new o.Button({className:"upfront-add-another",label:r.add_video,compact:!0,on_click:function(){i.cloneMultipleVideo()}})]}),new Upfront.Views.Editor.Settings.Settings_CSS({model:this.model})]),this.$el.on("change","input[name=display_style]",function(t){i.changeDisplayStyle(t)}).on("change","input[name=thumbWidth]",function(t){i.onThumbChangeSize(t)}),this.on("concealed",this.setFieldEvents,this)},get_label:function(){return r.settings},get_title:function(){return r.settings},render:function(){var t=this;i.prototype.render.call(this),this.listMultipleVideos(),setTimeout(function(){t.toggleMultipleSettings()},50),this.$el.find("[name^=multiple_show_title], [name^=show_title], [name^=show_description]").parent().css({float:"left","margin-top":"22px"})},toggleMultipleSettings:function(){var t=this.$el.find('[name^="multiple_source_"]').length;t>1?this.$el.find(".field-display_style, .first-video-to-thumbnails, .thumbnails-width").show():this.$el.find(".field-display_style, .first-video-to-thumbnails, .thumbnails-width").hide()},onThumbChangeSize:function(e){var i=1.8,n=10.4,o=t(e.target).val(),r=Math.round(t(e.target).val()/i),s=Math.round(t(e.target).val()/n);return this.$("input[name=thumbHeight]").val(r),this.property("thumbWidth",o),this.property("thumbOffset",s),this.property("thumbHeight",r,!1),r},changeDisplayStyle:function(e){this.property("display_style",t(e.currentTarget).val(),!1),this.toggleDescriptionEnabled()},toggleDescriptionEnabled:function(){return"gallery"===this.property("display_style")?void this.$el.find("[name=multiple_description_length]").attr("disabled","disabled").parent().addClass("upfront-field-wrap-disabled"):(this.$el.find("[name=multiple_description_length]").removeAttr("disabled").parent().removeClass("upfront-field-wrap-disabled"),void this.$el.find("[name=multiple_show_description]").removeAttr("disabled").parent().removeClass("upfront-field-multiple-disabled"))},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},listMultipleVideos:function(){var e=this.model.get_property_value_by_name("multiple_videos"),i=this;e.length>0&&(i.$el.find(".multiple_video_section").html('<div class="upfront-settings-item-title"><span>'+r.videos_title+"</span></div>"),t(e).each(function(t,e){i.$el.find(".multiple_video_section").append(_.template(o,{cloneId:t+1,videoUrl:e.video_url,l10n:r.template}))}))},cloneMultipleVideo:function(){var t=this.$el.find(".multiple_video_section .upfront-settings-item").length;this.$el.find(".multiple_video_section").append(_.template(o,{cloneId:t+1,videoUrl:"",l10n:r.template})),this.toggleMultipleSettings()}})),d=e.extend({panels:{Behavior:p},events:{"click .upfront-save_settings":"saveSettings","click .upfront-cancel_settings":"cancelSettings","change .multiple_sources":"multipleVideos"},initialize:function(t){this.constructor.__super__.initialize.call(this,t),this.listenTo(Upfront.Events,"upfront:youtube:added",this.multipleVideos)},actions:{single:"upfront_youtube_single"},multipleVideos:function(e){var i=this,n=[],o=0,s=this.$el.find('[name^="multiple_source_"]');s.each(function(e,a){var l,p,d=t(a).val(),c=e+1;if(d){d.match(/youtu\.be/)?(p=d.match(/^(https?:\/\/)?youtu.be\/([0-9a-zA-Z\-_]{11})/),null!==p&&p.length>0?l=p[2]:Upfront.Views.Editor.notify(r.validMessage,"error")):(p=d.match(/^(https?:\/\/(www\.)?)?youtube\.com\/watch\?v=([0-9a-zA-Z\-_]{11}).*/),null!==p&&p.length>0?l=p[3]:Upfront.Views.Editor.notify(r.validMessage,"error"));var u={video_id:d};Upfront.Util.post({action:i.actions.single,data:u}).success(function(t){n.push({order:c,title:t.data.video.title,id:l,video_url:d,thumbnail:t.data.video.thumbnail_url}),o++}).error(function(){Upfront.Util.log("error single video")}).done(function(){o==s.length&&(n.sort(function(t,e){return t.order-e.order}),i.for_view.model.set_property("multiple_videos",n,!1),Upfront.Events.trigger("upfront:youtube:added:done"))})}else o++})},title:r.element_settings,get_title:function(){return r.element_settings}});Upfront.Application.LayoutEditor.add_object("Uyoutube",{Model:s,View:a,Element:l,Settings:d,anchor:{is_target:!1},cssSelectors:{".upfront-youtube-container":{label:r.css.global_wrapper_label,info:r.css.global_wrapper_info},".uyoutube-thumbnails":{label:r.css.thumbnails_wrapper_label,info:r.css.thumbnails_wrapper_info},".uyoutube-thumbnail":{label:r.css.thumbnail_label,info:r.css.thumbnail_info}},cssSelectorsId:"UyoutubeModel"
}),Upfront.Models.UyoutubeModel=s,Upfront.Views.UyoutubeView=a})}(jQuery),define("text!elements/upfront-code/css/editor.css",[],function(){return"/* Common */\n\n.upfront_code-editor {\n\tposition: fixed;\n\twidth: 100%;\n\tcursor: auto;\n\tright: 0;\n\tbottom: 0;\n\tz-index: 99;\n\tmin-height: 200px;\n\tdisplay: none\n}\n\n.upfront_code-editor button {\n\tbackground: #2ecc90;\n\tcolor: #fff;\n\tposition: absolute;\n\tbottom: 10px;\n\tright: 25px;\n\tpadding: 5px 10px;\n\tborder: 0;\n\tborder-radius: 0;\n\tfont-size: 14px;\n\tz-index: 2;\n}\n.upfront_code-editor button:hover {\n\tbackground: #3ea;\n}\n\n.upfront-icon-button.re-edit:before {\n\t/*\n\tbackground-position: -701px -710px;\n\t*/\n\tdisplay: none;\n}\n.upfront-icon-button.re-edit {\n\tbackground: #515b65; /* Old browsers */\n\tbackground: -moz-linear-gradient(-45deg,  #515b65 47%, #454e56 49%); /* FF3.6+ */\n\tbackground: -webkit-gradient(linear, left top, right bottom, color-stop(47%,#515b65), color-stop(49%,#454e56)); /* Chrome,Safari4+ */\n\tbackground: -webkit-linear-gradient(-45deg,  #515b65 47%,#454e56 49%); /* Chrome10+,Safari5.1+ */\n\tbackground: -o-linear-gradient(-45deg,  #515b65 47%,#454e56 49%); /* Opera 11.10+ */\n\tbackground: -ms-linear-gradient(-45deg,  #515b65 47%,#454e56 49%); /* IE10+ */\n\tbackground: linear-gradient(135deg,  #515b65 47%,#454e56 49%); /* W3C */\n\n\tcolor: #97b8da;\n\tfont-size: 14px;\n\tline-height: 20px;\n\ttext-align: center;\n}\n\n/* Simple */\n.upfront_code-editor.upfront_code-editor-simple {\n\tpadding: 10px;\n}\n.upfront_code-editor.upfront_code-editor-simple h3 {\n\tmargin: 0;\n\ttext-transform: none;\n}\n\n.upfront_code-editor-simple textarea {\n\tmin-height: 80px;\n}\n\n/* Complex */\n.upfront_code-editor.upfront_code-editor-complex textarea {\n\tcolor: white;\n\tbackground: #454e58;\n\tborder: none;\n\toutline: none;\n}\n.upfront_code-editor .upfront_code-editor-complex-wrapper {\n\tposition: absolute;\n\twidth: 100%;\n\tbottom: 0;\n\tleft: 0;\n\tbackground: #3d5266;\n\tmin-height: 200px;\n}\n\n.upfront_code-switches {\n\tmargin: 2px 15px 0 20px;\n\tfloat: left;\n}\n\n\n.upfront_code-switch {\n\tcolor: #cbe5ff;\n\tfloat: left;\n\tpadding: 2px 10px;\n\tmargin: 2px 5px 0 0;\n\tcursor: pointer;\n}\n\n.upfront_code-switch:hover {\n\tcolor: #dae6f2;\n\tbackground: #2E3D4C;\n}\n\n.upfront_code-switch.active {\n\tbackground: #26333F ;\n}\n\n.upfront_code-jsalert {\n\tdisplay: inline-block;\n\tmargin: 0 5px 0;\n\tpadding: 0 5px;\n\tcolor: #444d56;\n\tdisplay: none;\n\tfloat: left;\n}\n\n.upfront_code-jsalert .upfront-icon-button:before {\n\tbackground-position: -480px -205px;\n\tmargin-top: 7px;\n}\n\n.upfront_code-editor-section {\n\theight: 100%;\n}\n\n.upfront_code-editor.upfront_code-editor-complex .upfront_code-editor-complex-wrapper .upfront_code-editor-section {\n\tdisplay: none;\n}\n.upfront_code-editor.upfront_code-editor-complex .upfront_code-editor-complex-wrapper .upfront_code-editor-section.active {\n\tdisplay: block;\n}\n.upfront_code-editor.upfront_code-editor-complex .handle.ui-resizable-handle.ui-resizable-s {\n\ttext-align: center;\n\tfont-size: 18px;\n\tline-height: 7px;\n\tbottom: 5px;\n}\n\n.ace_editor.upfront_code-ace {\n\theight: 100%;\n\twidth: 100%;\n}\n\n\n/* Missing defaults */\n.upfront-code_element-module button.embed,\n.upfront-code_element-module button.create,\n.upfront_code-editor-simple button\n{\n\tborder: 0;\n\tborder-radius: 2px;\n\tpadding: 10px 30px;\n\tcursor: pointer;\n}\n.upfront_code-editor-simple textarea {\n\twidth: 98%;\n}\n\n/* Image editable */\n.upfront-code-editable-image {\n\tposition: absolute;\n\tdisplay: none;\n\tbackground: white;\n\tz-index: 999999999999999;\n\topacity: 0.75;\n\ttext-align: center;\n}\n\n/* Color picker */\n.upfront_code-editor .upfront-css-color {\n\tdisplay: inline-block;\n}\n.upfront_code-editor .upfront-css-color .upfront-field-wrap, \n.upfront_code-editor .upfront-css-color .upfront-field-wrap label\n{\n\tmargin: 0;\n}\n.upfront_code-editor .upfront-css-color .upfront-field-wrap .sp-button-container.sp-cf {\n\tposition: absolute;\n\tbottom: -48px;\n\tright: -15px;\n}"}),define("text!elements/upfront-code/tpl/editor.html",[],function(){return'<div>\n<!-- Div to select elements inside -->\n\n<div id="editorTpl">\n\t\t<div class="upfront_code-editor-complex-wrapper">\n\t\t\t<div class="upfront-css-top">\n\t\t\t\t<div class="upfront_code-switches">\n\t\t\t\t\t<div class="upfront_code-switch active" data-for="markup">{{ l10n.html }}</div>\n\t\t\t\t\t<div class="upfront_code-switch" data-for="style">{{ l10n.css }}</div>\n\t\t\t\t\t<div class="upfront_code-switch" data-for="script">{{ l10n.js }}</div>\n\t\t\t\t</div>\n\t\t\t\t<a class="upfront-css-theme_image upfront-css-image" href="#">{{ l10n.link_theme_image }}</a>\n\t\t\t\t<a class="upfront-css-media_image upfront-css-image" href="#">{{ l10n.link_image }}</a>\n\t\t\t\t<div class="upfront-css-color"></div>\n\t\t\t\t<div class="upfront_code-jsalert error javascript"><i class="upfront-icon-button" title="{{ l10n.code_error }}"></i></div>\n\t\t\t\t<a class="upfront-css-close" href="#">{{ l10n.close }}</a>\n\t\t\t</div>\n\t\t\t<div class="upfront-css-body">\n\t\t\t\t<div class="upfront_code-editor-section upfront_code-markup active">\n\t\t\t\t\t<div class="upfront_code-ace" data-type="markup" >{{markup}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="upfront_code-editor-section upfront_code-style">\n\t\t\t\t\t<div class="upfront_code-ace" data-type="style" >{{style}}</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="upfront_code-editor-section upfront_code-script">\n\t\t\t\t\t<div class="upfront_code-ace" data-type="script" >{{script}}</div>\n\t\t\t\t</div>\n\t\t\t\t<button>{{ l10n.save }}</button>\n\t\t\t</div>\n\t\t</div>\n</div>\n\n<div id="embedTpl">\n\t<section class="upfront_code-editor-simple">\n\t\t<h3>{{ l10n.paste_your_code }}</h3>\n\t\t<textarea class="upfront_code-markup" data-type="markup">{{ markup }}</textarea>\n\t\t<button>{{ l10n.save }}</button>\n\t</section>\n</div>\n\n</div>'}),function(t,e){define("elements/upfront-code/js/syntax",[],function(){var e=Upfront.Settings.l10n.code_element,i={_promise:!1,_value:!1,_message:!1,set:function(e){return this._promise=new t.Deferred,this._value=e,this._message=!1,this._promise.promise()},reset:function(){this.set(!1)},test:function(){this._message=!1,this._promise.notify(),this.validate()?this._promise.resolve():this._promise.reject(this._message)},check:function(t){this.set(t);var e=this.validate();return this.reset(),e},validate:function(){return!0},wrap:function(t){return t}},n=_.extend({},i,{validate:function(){var t=!0;try{var e=new Function(this.wrap(this._value));e.apply()}catch(e){this._message=e.message,t=!1}return t},wrap:function(t){return";(function ($) { {"+t+";}\n })(jQuery);"}}),o=_.extend({},i,{validate:function(){var i=!0,n=this._value.replace(/\r|\n/g,"\n"),o=t("<div />");return n=n.replace(/&[^; ]+?;/g,"HTMLENTITY"),o.html(n),o.html().length!=n.length&&(this._message=e.errors.error_markup,i=!1),i}}),r=function(){var t={markup:"html",style:"css",script:"javascript"},e={markup:_.extend(o,{}),script:_.extend(n,{})},r=function(t){var n=t in e?e[t]:_.extend(i,{});return n.reset(),n};return{TYPES:t,checker:r}};return new r})}(jQuery),function(t){define("elements/upfront-code/js/views",["text!elements/upfront-code/tpl/editor.html","elements/upfront-code/js/syntax"],function(e,i){var n=t(e),o=Upfront.Settings.l10n.code_element,r={Start:Backbone.View.extend({events:{"click .embed":"embed_code","click .create":"create_code"},render:function(){this.$el.empty(),this.$el.append('<p class="code-element-choose"></p>'),Upfront.Application.user_can_modify_layout()&&(Upfront.Settings.Application.PERMS.EMBED&&this.$el.find("p.code-element-choose").append('<button type="button" class="embed">'+o.intro.embed+"</button>&nbsp;or&nbsp;"),this.$el.find("p.code-element-choose").append('<button type="button" class="create">'+o.intro.code+"</button>"))},embed_code:function(){this.model.set_property("code_selection_type","Embed",!0),this.trigger("code:selection:selected")},create_code:function(){this.model.set_property("code_selection_type","Create",!0),this.trigger("code:selection:selected")}}),Create:Upfront.Views.ObjectView.extend({is_editing:!1,MIN_HEIGHT:200,editorTpl:_.template(n.find("#editorTpl").html()),content_editable_selector:".editable",initialize:function(){},get_content_markup:function(){var t=this.fallback("markup"),e=this.fallback("style"),n=this.fallback("script"),o=i.checker("script").wrap(n),r=this.property("element_id"),s="";return e&&_(e.split("}")).each(function(t,e){return!t.length||void(s+="#"+r+" .upfront_code-element "+t+"}")}),s=Upfront.Util.colors.convert_string_ufc_to_color(s),i.checker("script").check(n)||(o=""),'<div class="upfront_code-element clearfix">'+t+"<style>"+s+"</style><script>"+o+"</script></div>"},on_render:function(){var e=this;if(this.property("markup")||this.property("style")||this.property("script")){var i=this.$el.find(".upfront_code-element "+this.content_editable_selector);i.length&&i.each(function(i){var n=t(this);n.is("img")&&e.bootImageEditable(n,i)}),this.$el.off("dblclick").on("dblclick",function(){e.on_edit_content()})}else setTimeout(function(){e.start_markup_editor()},10)},start_markup_editor:function(){if(this.is_editing)return!1;this.is_editing=!0;var e=t("#upfront_code-editor");e.length||(e=t('<section id="upfront_code-editor" class="upfront-ui upfront_code-editor upfront_code-editor-complex"></section>'),t("body").append(e)),this.createEditor(e)},on_edit:function(){return this.on_edit_settings()},on_edit_content:function(){if(this.is_editing)return!1;if(!Upfront.Application.user_can_modify_layout())return!1;var t=this.$el.find(".upfront_code-element "+this.content_editable_selector);return t.length?this.bootContentEditors(t):void 0},on_edit_settings:function(){if(this.is_editing)return!1;this.is_editing=!0;var e=t("#upfront_code-editor");e.length||(e=t('<section id="upfront_code-editor" class="upfront-ui upfront_code-editor upfront_code-editor-complex"></section>'),t("body").append(e)),this.createEditor(e)},bootContentEditors:function(e){if(!e||!e.length)return!1;var i=t(this.fallback("markup")),n=this;e.each(function(e){var o=t(this),r=e<=0;return!!o.is("img")||(!!o.data("ueditor")||void o.ueditor({autostart:r,placeholder:"",disableLineBreak:!0}).on("start",function(){n.is_editing=!0}).on("stop",function(){n.is_editing=!1}).on("syncAfter",function(){var r=t(i.find(n.content_editable_selector)[e]);return!!r.length&&(r.html(o.html()),void n.property("markup",t("<div />").append(i).html()))}))})},bootImageEditable:function(e,i){var n,r=(e.attr("src"),this),s=t(this.fallback("markup")),a=this.model.get_property_value_by_name("element_id"),l="upfront-editable-"+a+"-"+i,p=t("#"+l);p.length&&p.remove(),t("body").append("<div class='upfront-code-editable-image' id='"+l+"'>"+o.create.change+"</div>"),p=t("#"+l),n=e.add(p),n.on("mouseenter",function(){var t=e.offset(),i=e.width(),n=e.height();p.width(i).height(n).css({top:t.top,left:t.left,"line-height":n+"px"}).show()}).on("mouseleave",function(e){t(this).is("img")||p.hide()}).on("click",function(){p.hide(),Upfront.Media.Manager.open({multiple_selection:!1}).done(function(n,o){if(o&&o.at){var a=o.at(0).get("image").src,l=t(s.find(r.content_editable_selector)[i]);e.attr("src",a),l.attr("src",a),r.property("markup",t("<div />").append(s).html()),Upfront.Events.trigger("upfront:element:edit:stop")}})})},createEditor:function(e){var n=this;e.html(this.editorTpl({markup:this.fallback("markup"),style:this.fallback("style"),script:this.fallback("script"),l10n:o.template})),t("#page").css("padding-bottom","200px"),e.show(),this.resizeHandler=this.resizeHandler||function(){e.width(t(window).width()-t("#sidebar-ui").width()-1)},t(window).on("resize",this.resizeHandler),this.resizeHandler(),this.editors={},this.timers={},e.find(".upfront_code-ace").each(function(){var r=t(this),s=r.html(),a=ace.edit(this),l=r.data("type"),p=i.checker(l);a.getSession().setUseWorker(!1),a.setTheme("ace/theme/monokai"),a.getSession().setMode("ace/mode/"+i.TYPES[l]),a.setShowPrintMargin(!1),"markup"===l&&s&&a.getSession().setValue(s),a.on("change",function(){n.timers[l]&&clearTimeout(n.timers[l]),n.timers[l]=setTimeout(function(){var t=a.getValue();p.set(t).done(function(){e.find(".upfront_code-jsalert").hide(),n.property(l,t,!1)}).fail(function(t){e.find(".upfront_code-jsalert").show().find("i").attr("title",o.errors[l]+" "+t)}),p.test()},1e3)}),a.renderer.scrollBar.width=5,a.renderer.scroller.style.right="5px",n.editors[l]=a}),this.currentEditor=this.editors.markup;var r=e.find(".upfront-css-top"),s=e.find(".upfront-css-body");r.removeClass("ui-resizable-handle").addClass("ui-resizable-handle").removeClass("ui-resizable-n").addClass("ui-resizable-n"),s.height(this.MIN_HEIGHT-r.outerHeight()),e.find(".upfront_code-editor-complex-wrapper").resizable({handles:{n:".upfront-css-top"},resize:function(t,e){s.height(e.size.height-r.outerHeight()),_.each(n.editors,function(t){t.resize()})},minHeight:n.MIN_HEIGHT,delay:100}),e.find(".upfront_code-switch").on("click",function(i){var o=t(i.target),r=o.data("for");e.find(".active").removeClass("active"),o.addClass("active"),e.find(".upfront_code-"+r).addClass("active"),n.editors[r].resize(),n.currentEditor=n.editors[r],"script"==r?e.find("upfront-css-image").hide():e.find("upfront-css-image").show()}),e.find("button").on("click",function(t){_.each(n.editors,function(t,e){var o=t.getValue();i.checker(e).check(o)?n.property(e,o):n.property(e,n.fallback(e))}),n.$("section.upfront_code-element").replaceWith(n.get_content_markup()).end(),n.is_editing=!1,n.destroyEditor()}),e.on("click",".upfront-css-type",function(t){n.hiliteElement(t)}).on("click",".upfront-css-close",function(e){e.preventDefault(),n.destroyEditor(),t("#page").css("padding-bottom",0)}),this.prepareSpectrum(e),e.on("click",".upfront-css-theme_image",_.bind(this.open_theme_image_picker,this)).on("click",".upfront-css-media_image",_.bind(this.open_media_image_picker,this))},prepareSpectrum:function(t){var e=this,i=new Upfront.Views.Editor.Field.Color({blank_alpha:0,default_value:"#ffffff",flat:!0,showAlpha:!0,appendTo:"parent",showPalette:!0,maxSelectionSize:10,preferredFormat:"hex",chooseText:o.create.ok,showInput:!0,allowEmpty:!0,spectrum:{choose:function(t){var i=t.get_is_theme_color()!==!1?t.theme_color:t.alpha<1?t.toRgbString():t.toHexString();e.currentEditor.insert(i),e.currentEditor.focus()}}});i.render(),t.find(".upfront-css-color").empty().append(i.$el)},open_theme_image_picker:function(){return this._open_image_picker({themeImages:!0})},open_media_image_picker:function(){return this._open_image_picker()},_open_image_picker:function(e){e=_.isObject(e)?e:{};var i=this,n=_.extend({multiple_selection:!1,media_type:["images"]},e),o=t("#upfront_code-editor").find(".upfront_code-switch.active").data("for");Upfront.Media.Manager.open(n).done(function(t,e){if(Upfront.Events.trigger("upfront:element:edit:stop"),!e)return!1;var n=e.models[0],r=n.get("image")?n.get("image"):e.models[0],s="src"in r?r.src:"get"in r&&r.get("original_url");if(!s)return!1;if("style"===o)i.currentEditor.insert('url("'+s+'")');else if("markup"===o){var a=s.split("."),l=a[a.length-1],p=n.get("selected_size");p&&"full"!=p&&(s=s.replace(new RegExp("."+l+"$"),"-"+p+"."+l)),i.currentEditor.insert('<img src="'+s+'">')}i.currentEditor.focus()})},destroyEditor:function(){var e=this;this.editors&&this.editors.length&&(_.each(this.editors,function(t){t.destroy()}),e.editors=!1),this.currentEditor=!1,t("#upfront_code-editor").html("").hide(),t(window).off("resize",this.resizeHandler),this.is_editing=!1},hiliteElement:function(e){e.preventDefault();var i=this.$el.find(".upfront-object-content"),n=i.offset().top-50;t(document).scrollTop(n>0?n:0),this.blink(i,4)},blink:function(t,e){var i=this;t.css("outline","3px solid #3ea"),setTimeout(function(){t.css("outline","none"),e--,e>0&&setTimeout(function(){i.blink(t,e-1)},100)},100)},fallback:function(t){return this.model.get_property_value_by_name(t)||Upfront.data.upfront_code.defaults.fallbacks[t]},property:function(t,e,i){return"undefined"!=typeof e?("undefined"==typeof i&&(i=!0),this.model.set_property(t,e,i)):this.model.get_property_value_by_name(t)},getControlItems:function(){return _([this.createPaddingControl(),this.createControl("edit",o.edit,"start_markup_editor")])}}),Embed:Upfront.Views.ObjectView.extend({is_editing:!1,tpl:_.template(n.find("#embedTpl").html()),get_content_markup:function(){var t=this.fallback("markup");this.model.get_property_value_by_name("element_id");return'<section class="upfront_code-element clearfix">'+t+"</section>"},update_property:function(e){var i=t(this),n=i.attr("data-type"),o=i.val();e.set_property(n,o,!0)},on_render:function(){var t=this;this.model.get_property_value_by_name("markup")||setTimeout(function(){t.on_edit()},10)},on_edit:function(){if(this.is_editing)return!1;if(!Upfront.Application.user_can_modify_layout())return!1;this.is_editing=!0;var t=this,e=this.$el.parents(".upfront-module");this.$el.find("section.upfront_code-element").hide().end().append(this.tpl({markup:this.fallback("markup"),l10n:o.template})),this.$el.find("textarea").on("keyup change",function(){t.update_property.apply(this,[t.model])}).on("focus click",function(){e.draggable("disable")}).focus().end().find("button").on("click",function(){t.$el.find("pre code").each(function(){t.update_property.apply(this,[t.model])}),t.$el.find("section.upfront_code-element").replaceWith(t.get_content_markup()).end().find("section.upfront_code-editor-simple").remove(),t.is_editing=!1,t.trigger("code:model:updated")})},fallback:function(t){return this.model.get_property_value_by_name(t)||Upfront.data.upfront_code.defaults.fallbacks[t]},getControlItems:function(){return _([this.createPaddingControl(),this.createControl("edit",o.edit,"on_edit_settings")])}})};return r})}(jQuery),define("elements/upfront-code/js/model",[],function(){var t=Upfront.Models.ObjectModel.extend({init:function(){var t=_.clone(Upfront.data.upfront_code.defaults);t.element_id=Upfront.Util.get_unique_id(t.id_slug+"-object"),this.init_properties(t)}});return t}),define("elements/upfront-code/js/element",["elements/upfront-code/js/model"],function(t){var e=Upfront.Settings.l10n.code_element,i=Upfront.Views.Editor.Sidebar.Element.extend({priority:120,draggable:!!Upfront.Settings.Application.PERMS.EMBED,render:function(){this.$el.addClass("upfront-icon-element upfront-icon-element-code"),this.$el.html(e.element_name)},add_element:function(){var e=new t,i=new Upfront.Models.Module({name:"",properties:[{name:"element_id",value:Upfront.Util.get_unique_id("module")},{name:"class",value:"c24 upfront-code_element-module"},{name:"has_settings",value:0},{name:"row",value:Upfront.Util.height_to_row(210)}],objects:[e]});this.add_module(i)}});return i}),function(t,e){define("upfront_code",["text!elements/upfront-code/css/editor.css","elements/upfront-code/js/views","elements/upfront-code/js/model","elements/upfront-code/js/element"],function(e,i,n,o){t("head").append("<style>"+e+"</style>");var r=Upfront.Settings.l10n.code_element,s=Upfront.Views.ObjectView.extend({on_render:function(){var t=this.model.get_property_value_by_name("code_selection_type"),e=this,i=!1;this.$el.empty().append("Loading..."),require([Upfront.Settings.ace_url],function(){i=t?e.render_code_view():e.render_initial_view()}),this.parent_module_view.$el.data("dragHandler")||(this.parent_module_view.$el.on("dragstart",this.cover_iframes),this.parent_module_view.$el.data("dragHandler",!0))},cover_iframes:function(t,e){e.helper.append('<div class="upfront-iframe-draggable" style="width:100%;height:100%;position:absolute;top:0;left:0:z-index:1"></div>')},render_initial_view:function(){var t=new i.Start({model:this.model});return t.render(),t.parent_view=this.parent_view,t.parent_module_view=this.parent_module_view,t.on("code:selection:selected",this.render_code_view,this),this.$el.empty().append(t.$el),t},render_code_view:function(){var t=this,e=this.model.get_property_value_by_name("code_selection_type");if(this.create_size_hint(this.$el.closest(".upfront-editable_entities_container")),!e)return Upfront.Util.log("Missing type"),this.render_initial_view();var n=new i[e]({model:this.model});return n.parent_view=this.parent_view,n.parent_module_view=this.parent_module_view,n.render(),n.on("code:model:updated",this.propagate_model_update,this),this.$el.empty().append(n.$el.removeClass("upfront-view-object")),this.updateControls(),n.on_edit&&(this.on_settings_click=function(){return n.on_edit()}),setTimeout(function(){t.update_size_hint(t.$el.closest(".upfront-editable_entity").width(),t.$el.closest(".upfront-editable_entity").height())},510),n},on_settings_click:function(){},getControlItems:function(){return Upfront.Settings.Application.PERMS.EMBED?_([this.createPaddingControl(),this.createControl("settings",r.settings,"on_settings_click")]):_([this.createPaddingControl()])},propagate_model_update:function(){Upfront.Events.trigger("upfront:element:edit:stop")}});Upfront.Application.LayoutEditor.add_object("Code",{Model:n,View:s,Element:o}),Upfront.Models.CodeModel=n,Upfront.Views.CodeView=s})}(jQuery),function(t){define("uspacer",["text!upfront/templates/object.html"],function(e){var i=(Upfront.Settings.l10n.spacer_element,Upfront.Models.ObjectModel.extend({init:function(){this.init_property("type","UspacerModel"),this.init_property("view_class","UspacerView"),this.init_property("element_id",Upfront.Util.get_unique_id("spacer-object")),this.init_property("class","c24 upfront-object-spacer"),this.init_property("has_settings",0),this.init_property("id_slug","uspacer")}})),n=Upfront.Views.ObjectView.extend({className:"upfront-object-view upfront-spacer",display_size_hint:!1,get_content_markup:function(){return""},init:function(){var t=this,e=_.debounce(this.apply_height_from_wrapper,1e3);this.listenTo(Upfront.Events,"upfront:wrappers:before_fix_height",this.before_apply_height_from_wrapper),this.listenTo(Upfront.Events,"upfront:wrappers:after_fix_height",e),this.dontRunVisible=!0,Upfront.Events.on("upfront:renderingqueue:start",function(){t.dontRunVisible=!0}),Upfront.Events.on("upfront:renderingqueue:done",function(){t.dontRunVisible=!1})},render:function(){var t,i,n,o,r,s,a=Upfront.Settings.LayoutEditor.CurrentBreakpoint,l=Upfront.Settings.LayoutEditor.Grid,p={};l.column_padding;this.$el.addClass("upfront-object-view"),this.model.get("properties").each(function(t){p[t.get("name")]=t.get("value")}),s="default_hide"in p?p.default_hide:0,r="hide"in p?p.hide:s,p.preset=p.preset||"",t=_.extend(this.model.toJSON(),{properties:p,buttons:"",content:"",height:0,hide:r,extra_buttons:""}),i=_.template(e,t),Upfront.Events.trigger("entity:object:before_render",this,this.model),this.parent_module_view&&!this.object_group_view&&(this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_start"),this.listenTo(this.parent_module_view,"entity:resize_start",this.on_element_resize_start),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resizing"),this.listenTo(this.parent_module_view,"entity:resizing",this.on_element_resizing),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:resize_stop"),this.listenTo(this.parent_module_view,"entity:resize_stop",this.on_element_resize),this.stopListening(this._previous_parent_module_view||this.parent_module_view,"entity:drop"),this.listenTo(this.parent_module_view,"entity:drop",this.on_element_drop),n=Upfront.Behaviors.GridEditor.get_class_num(this.parent_module_view.model.get_property_value_by_name("class"),l.class),this.parent_module_view.$el.find("> .upfront-module").addClass("upfront-module-spacer"),this.parent_module_view.model.add_class("upfront-module-spacer")),this.wrapper_view&&(this.stopListening(this.wrapper_view,"update_position"),this.listenTo(this.wrapper_view,"update_position",this.on_wrapper_update)),this.$el.html(i),o=Upfront.Behaviors.GridEditor.get_class_num(p.class,l.class),o=o>n?n:o,$object=this.$el.find(".upfront-editable_entity:first"),$object.data("default_col",o),$object.data("current_col",o),Upfront.Events.trigger("entity:object:after_render",this,this.model),a&&!a.default&&this.update_position()},getControlItems:function(){return _([])},createControls:function(){return!1},apply_paddings:function(){return!1},retain_current_preset:function(){return!1},_is_applying:function(t){if(this.parent_view&&this.parent_view==t)return!0;if(this.parent_module_view&&this.parent_module_view.parent_view&&this.parent_module_view.parent_view==t)return!0;if(this.dontRunVisible!==!0)return!!this.$el.is(":visible")},before_apply_height_from_wrapper:function(t){if(this._is_applying(t)){var e=this.$el.closest(".upfront-wrapper");e.addClass("upfront-wrapper-spacer"),this.$el.find(">.upfront-object").css("min-height","")}},apply_height_from_wrapper:function(t){if(this._is_applying(t)){var e=this.$el.closest(".upfront-wrapper");this.$el.find(">.upfront-object").css("min-height",e.height())}},activate:function(){"undefined"!=typeof Upfront.data.prevEntity&&Upfront.data.prevEntity!==!1&&Upfront.data.prevEntity.deactivate(),t(".upfront-region-module-activated").removeClass(".upfront-region-module-activated")},deactivate:function(){return!1},on_element_edit_start:function(t,e){},on_element_edit_stop:function(t,e,i){},on_content_style_edit_start:function(){},on_content_style_edit_stop:function(){}});Upfront.Models.UspacerModel=i,Upfront.Views.UspacerView=n})}(jQuery),function(t){define("application",["models","views","editor_views","behaviors","upfront-data","jquery-df","jquery-simulate","scripts/backbone-query-parameters/backbone-query-parameters","responsive","findandreplace"],function(e,i,n,o,r,s){_.extend(Upfront,r),Upfront.Events.trigger("data:ready"),_.extend(Upfront,e),_.extend(Upfront,i),_.extend(Upfront.Views,n),_.extend(Upfront,o);var a=Backbone.Router.extend({start:function(){Upfront.Util.log("Implement runner method")},go:function(t){return Upfront.Events.trigger("subapplication:navigate:"+t),this.navigate(t)},get_layout_data:function(){var t=Upfront.Util.model_to_json(this.layout);return t.layout=_upfront_post_data.layout,t}}),l=a.extend({save_layout_changes:function(t){Upfront.Behaviors.LayoutEditor.save_dialog(this._save_layout,this,t,!1)},save_layout_as:function(){"archive"==_upfront_post_data.layout.type&&Upfront.Behaviors.LayoutEditor.save_dialog(this._save_layout,this,!0,!0)},save_layout:function(){this._save_layout(this.layout.get("current_layout"))},save_post_layout:function(t){this._save_layout(t)},save_layout_meta:function(){this._save_layout_meta(this.layout.get("current_layout"))},publish_layout:function(){this._save_layout(this.layout.get("current_layout"),!0)},delete_layout:function(){this._delete_layout()},reset_changes:function(){this._reset_changes()},_save_layout_meta:function(t,e){var i="undefined"!=typeof _upfront_post_data.post_id?_upfront_post_data.post_id:"",n="undefined"!=typeof _upfront_post_data.template_type?_upfront_post_data.template_type:"layout",o="undefined"!=typeof _upfront_post_data.template_slug?_upfront_post_data.template_slug:"",r=_upfront_storage_key!=_upfront_save_storage_key?1:0;return Upfront.Events.trigger("command:layout:save_start"),Upfront.Settings.Application.NO_SAVE?(Upfront.Events.trigger("command:layout:save_success"),!1):void Upfront.Util.post({action:Upfront.Application.actions.save_meta,post_id:i,save_dev:r,template_type:n,template_slug:o}).success(function(){Upfront.Util.log("layout applied");var t="/"+Backbone.history.getFragment();Upfront.Application.urlCache[t]=!1,setTimeout(function(){Upfront.Application.load_layout(_upfront_post_data.layout),Upfront.Events.trigger("command:layout:save_success")},100)}).error(function(){Upfront.Util.log("error saving layout"),Upfront.Events.trigger("command:layout:save_error")})},_save_layout:function(t,e){var i,n=Upfront.Util.model_to_json(this.layout),o=e===!0?_upfront_storage_key:_upfront_save_storage_key,r="undefined"!=typeof _upfront_post_data.post_id?_upfront_post_data.post_id:"",s="undefined"!=typeof _upfront_post_data.template_type?_upfront_post_data.template_type:"layout",a="undefined"!=typeof _upfront_post_data.template_slug?_upfront_post_data.template_slug:"",l="undefined"!=typeof _upfront_post_data.layout_action?_upfront_post_data.layout_action:"",p="undefined"!=typeof _upfront_post_data.layout_change?_upfront_post_data.layout_change:0,d=_upfront_storage_key!=_upfront_save_storage_key?1:0,c=Upfront.Settings.LayoutEditor.CurrentBreakpoint,u=(c&&!c.default,this);return n.layout=_upfront_post_data.layout,n.preferred_layout=t,Upfront.mainData.save_compression?(i=Upfront.Util.compress(n),n=i.result):n=JSON.stringify(n),Upfront.Events.trigger("command:layout:save_start"),Upfront.Settings.Application.NO_SAVE?(Upfront.Events.trigger("command:layout:save_success"),!1):(n=Upfront.Util.colors.update_colors_to_match_ufc(n),void Upfront.Util.post({action:Upfront.Application.actions.save,data:n,original_length:i?i.original_length:0,compressed_length:i?i.compressed_length:0,compression:Upfront.mainData.save_compression?1:0,storage_key:o,post_id:r,layout_action:l,layout_change:p,save_dev:d,template_type:s,template_slug:a}).success(function(t){Upfront.Util.log("layout saved"),Upfront.Events.trigger("command:layout:save_success"),"save_as"==l?(_upfront_post_data.layout_action="",_upfront_post_data.template_slug=t.data.template_slug,_upfront_post_data.added_template_name=t.data.template_name,Upfront.Events.trigger("update:page:layout:list")):"update"==l&&(_upfront_post_data.layout_action="",Upfront.Events.trigger("page:layout:updated"));var e="/"+Backbone.history.getFragment();Upfront.Application.urlCache[e]=!1,u.save_presets()}).error(function(){Upfront.Util.log("error saving layout"),Upfront.Events.trigger("command:layout:save_error")}))},save_presets:function(){var t=Upfront.Application.presetSaver.save();t.done(function(){Upfront.Application.current_subapplication.save_colors()}).fail(function(){Upfront.Util.log("error saving presets"),Upfront.Events.trigger("command:layout:save_error")})},save_colors:function(){var t=Upfront.Application.colorSaver.save();t.done(function(){Upfront.Events.trigger("command:layout:save_success")}).fail(function(){Upfront.Util.log("error saving color"),Upfront.Events.trigger("command:layout:save_error")})},_delete_layout:function(){var t="undefined"!=typeof _upfront_post_data.template_slug?_upfront_post_data.template_slug:"",e=_upfront_storage_key!=_upfront_save_storage_key?1:0;Upfront.Events.trigger("command:layout:save_start"),Upfront.Util.post({action:Upfront.Application.actions.delete_layout,template_slug:t,is_dev:e}).done(function(){Upfront.Events.trigger("command:layout:save_success"),Upfront.Application.load_layout(_upfront_post_data.layout)})},_reset_changes:function(){var t="undefined"!=typeof _upfront_post_data.post_id?_upfront_post_data.post_id:"",e=_upfront_storage_key!=_upfront_save_storage_key?1:0;Upfront.Events.trigger("command:layout:save_start"),Upfront.Util.post({action:Upfront.Application.actions.reset_changes,post_id:t,is_dev:e}).done(function(){Upfront.Events.trigger("command:layout:save_success"),Upfront.Application.load_layout(_upfront_post_data.layout)})},preview_layout:function(){var t=!1,e=!1;return(e=Upfront.PreviewUpdate.preview_url())?void(t=window.open(e,"_blank")):(Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.application.preview_not_ready),!1)},list_revisions:function(){var e={action:"upfront_list_revisions",cascade:_upfront_post_data.layout,current_url:window.location.href};Upfront.Util.post(e).done(function(e){Upfront.Popup.open(function(){var i=_.template("<h3>"+Upfront.Settings.l10n.global.application.revisions+'</h3><ul>{[ _.each(data, function (item) { ]}<li><a target="_blank" href="{{item.preview_url}}">{{item.date_created}}</a><br /><small>'+Upfront.Settings.l10n.global.application.created_by+" {{item.created_by.display_name}}</small></li>{[ }); ]}</ul>");
t(this).html(i(e))})}).error(function(t){console.log(t)})},destroy_editor:function(){return this.navigate(""),window.location.reload(),!1},set_up_editor_interface:function(){if(!this.layout)return!1;var t=this,e=function(){var e={},i=Upfront.Application.sidebar.get_panel("elements"),n=function(t){return t.priority};_(t.Objects).each(function(i,n){_.each(["Element","DataElement","PluginElement"],function(o){if(_.isObject(i[o])){var r=new i[o]({model:t.layout});r.element_type=n,_.isArray(e[o])||(e[o]=[]),e[o].push(r)}}),i.Command&&t.sidebar.get_commands("control").commands.push(new i.Command({model:t.layout}))}),i.get_section("layout").elements=_(_.sortBy(e.Element,n)),i.get_section("data").elements=_(_.sortBy(e.DataElement,n)),i.get_section("plugins").elements=_(_.sortBy(e.PluginElement,n)),Upfront.Application.sidebar.render()};Upfront.Events.trigger("application:setup:editor_interface"),e()},add_object:function(t,e){this.Objects[t]=_.extend({},Upfront.Mixins.Anchorable,e)},remove_object:function(t){delete this.Objects[t]},set_up_event_plumbing_before_render:function(){this.listenTo(Upfront.Events,"entity:module:after_render",Upfront.Behaviors.GridEditor.create_resizable),this.listenTo(Upfront.Events,"entity:module:after_render",Upfront.Behaviors.GridEditor.create_draggable),this.listenTo(Upfront.Events,"entity:module_group:after_render",Upfront.Behaviors.GridEditor.create_resizable),this.listenTo(Upfront.Events,"entity:module_group:after_render",Upfront.Behaviors.GridEditor.create_draggable),this.listenTo(Upfront.Events,"entity:wrapper:after_render",Upfront.Behaviors.GridEditor.create_wrapper_resizable),this.listenTo(Upfront.Events,"entity:object:after_render",Upfront.Behaviors.GridEditor.create_resizable),this.listenTo(Upfront.Events,"entity:object:after_render",Upfront.Behaviors.GridEditor.create_draggable),this.listenTo(Upfront.Events,"entity:region:after_render",Upfront.Behaviors.GridEditor.create_region_resizable),this.listenTo(Upfront.Events,"entity:region:after_render",Upfront.Behaviors.GridEditor.create_region_draggable),this.listenTo(Upfront.Events,"entity:region_container:after_render",Upfront.Behaviors.LayoutEditor.create_mergeable),this.listenTo(Upfront.Events,"entity:region_container:after_render",Upfront.Behaviors.GridEditor.create_region_container_resizable),this.listenTo(Upfront.Events,"entity:region_sub_container:after_render",Upfront.Behaviors.GridEditor.create_region_container_resizable),Upfront.Behaviors.GridEditor.grid||Upfront.Behaviors.GridEditor.init(),this.listenTo(Upfront.Events,"layout:after_render",Upfront.Behaviors.GridEditor.init),!1===Upfront.plugins.isForbiddenByPlugin("show import image dialog")&&this.listenTo(Upfront.Events,"layout:after_render",Upfront.Behaviors.LayoutEditor.import_image_dialog)},set_up_event_plumbing_after_render:function(){this.listenTo(Upfront.Events,"command:exit",this.destroy_editor),this.listenTo(Upfront.Events,"command:layout:save",this.save_layout),this.listenTo(Upfront.Events,"command:layout:save_post_layout",this.save_post_layout),this.listenTo(Upfront.Events,"command:layout:save_meta",this.save_layout_meta),this.listenTo(Upfront.Events,"command:layout:delete_layout",this.delete_layout),this.listenTo(Upfront.Events,"command:layout:reset_changes",this.reset_changes),this.listenTo(Upfront.Events,"command:layout:layout_changes",this.save_layout_changes),this.listenTo(Upfront.Events,"command:layout:save_as",this.save_layout_as),this.listenTo(Upfront.Events,"command:layout:preview",this.preview_layout),this.listenTo(Upfront.Events,"command:layout:publish",this.publish_layout),this.listenTo(Upfront.Events,"command:region:edit_toggle",Upfront.Behaviors.GridEditor.toggle_region_resizable),this.listenTo(Upfront.Events,"command:region:fixed_edit_toggle",Upfront.Behaviors.GridEditor.toggle_region_resizable),this.listenTo(Upfront.Events,"command:region:fixed_edit_toggle",Upfront.Behaviors.GridEditor.toggle_region_draggable),this.listenTo(Upfront.Events,"command:selection:remove",Upfront.Behaviors.LayoutEditor.remove_selections),this.listenTo(Upfront.Events,"entity:activated",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:resize_start",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:drag_start",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:removed:before",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"entity:region:activated",Upfront.Behaviors.LayoutEditor.create_undo),this.listenTo(Upfront.Events,"command:undo",Upfront.Behaviors.LayoutEditor.apply_history_change),this.listenTo(Upfront.Events,"command:redo",Upfront.Behaviors.LayoutEditor.apply_history_change),this.listenTo(Upfront.Events,"entity:settings:activate",this.create_settings),this.listenTo(Upfront.Events,"entity:settings:deactivate",this.destroy_settings),this.listenTo(Upfront.Events,"entity:removed:after",this.destroy_settings),this.listenTo(Upfront.Events,"entity:contextmenu:activate",this.create_menu),this.listenTo(Upfront.Events,"entity:contextmenu:deactivate",this.destroy_menu);var e=!1,i=function(){e=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.application.saving,done:Upfront.Settings.l10n.global.application.saving_success,fixed:!0}),e.render(),t(".upfront-loading").length&&t(".upfront-loading").remove(),t("body").append(e.$el)},n=function(t){t||e.update_loading_text(Upfront.Settings.l10n.global.application.saving_error),e.on_finish(function(){Upfront.Events.trigger("command:layout:save_done",t)}),t?e.done():e.done(!1,Upfront.Settings.l10n.global.application.saving_error)};this.listenTo(Upfront.Events,"command:layout:save_start",i),this.listenTo(Upfront.Events,"command:layout:save_success",function(){n(!0)}),this.listenTo(Upfront.Events,"command:layout:save_error",function(){n(!1)}),this.listenTo(Upfront.Events,"command:themefontsmanager:open",Upfront.Behaviors.LayoutEditor.open_theme_fonts_manager),this.listenTo(Upfront.Events,"command:layout:edit_global_regions",Upfront.Behaviors.LayoutEditor.open_global_region_manager),this.listenTo(Upfront.Events,"command:layout:save_success",Upfront.Behaviors.LayoutEditor.clean_region_css),this.listenTo(Upfront.Events,"command:layout:save_success",Upfront.Behaviors.LayoutEditor.clean_global_regions)},create_properties:function(e,i){this.property_view=new Upfront.Views.Editor.Properties({model:i,el:t(Upfront.Settings.LayoutEditor.Selectors.properties)}),this.property_view.render()},destroy_properties:function(){t(Upfront.Settings.LayoutEditor.Selectors.properties).html("")},create_menu:function(e){var i=_(this.Objects).reduce(function(t,i){return e instanceof i.View?i:t},!1);if(i=i&&i.ContextMenu?i:Upfront.Views.ContextMenu,i.ContextMenu===!1)return!1;"undefined"==typeof i.ContextMenu&&(i.ContextMenu=Upfront.Views.ContextMenu);var n=new i.ContextMenu({model:e.model,for_view:e,el:t(Upfront.Settings.LayoutEditor.Selectors.contextmenu)});n.for_view=e,n.render(),this.context_menu_view=n},destroy_menu:function(){return!!this.context_menu_view&&(t(Upfront.Settings.LayoutEditor.Selectors.contextmenu).html("").hide(),void(this.context_menu_view=!1))},create_settings:function(e,i){var n,o;return this.settings_view?this.destroy_settings():!!parseInt(e.model.get_property_value_by_name("has_settings"),10)&&(i||(n=_(this.Objects).reduce(function(t,i){return e instanceof i.View?i:t},!1),n=n&&n.Settings?n:Upfront.Views.Editor.Settings,i=n.Settings),o=new i({model:e.model,anchor:!!n&&n.anchor,el:t(Upfront.Settings.LayoutEditor.Selectors.settings)}),o.for_view=e,o.render(),this.settings_view=o,void o.trigger("rendered"))},destroy_settings:function(){return!!this.settings_view&&(this.settings_view.trigger("closed"),this.settings_view.remove(),this.settings_view=!1,void t("body").append('<div id="settings"/>'))},create_post:function(t){Upfront.Settings.LayoutEditor.newpostType=t,this.load_layout({item:"single-"+t,type:"single"})},openLightboxRegion:function(t){var e=Upfront.Application.layout.get("regions"),i=e.get_by_name(t);i&&(_.each(e.models,function(t){"lightbox"==t.attributes.sub&&Upfront.data.region_views[t.cid].hide()}),Upfront.data.region_views[i.cid].show())},getLightboxSafeName:function(t){var e=this.layout&&this.layout.get?this.layout.get("regions"):Upfront.Application.current_subapplication.layout.get("regions"),i=!!e&&e.get_by_name("lightbox");return i||(i=new Upfront.Models.Region({name:"lightbox",container:"lightbox",title:"lightbox Region"}),i.add_to(e,e.length-1)),"ltb-"+t.toLowerCase().replace(/\s/g,"-")+(e.length+1)},createLightboxRegion:function(t){var e=this.layout&&this.layout.get?this.layout.get("regions"):Upfront.Application.current_subapplication.layout.get("regions"),i=this.getLightboxSafeName(t),n=new Upfront.Models.Region(_.extend({},Upfront.data.region_default_args,{name:i,container:"lightbox",title:t,type:"lightbox",sub:"lightbox"}));return n.init_properties({col:10,height:400,click_out_close:"yes",show_close:"yes",overlay_color:"rgba(38,58,77,0.75)",lightbox_color:"rgba(248,254,255,0.9)"}),this.listenToOnce(Upfront.Events,"entity:region:added",this.openNewRegion),n.add_to(e,e.length-1,{sub:"lightbox"}),i},openNewRegion:function(t){t.show&&(t.show(),t.on_settings_click())}}),p=new(l.extend({Objects:{},boot:function(){},start:function(){this.stop(),this.set_up_event_plumbing_before_render(),this.set_up_editor_interface(),this.set_up_event_plumbing_after_render(),t("html").removeClass("upfront-edit-content upfront-edit-theme upfront-edit-postlayout upfront-edit-responsive").addClass("upfront-edit-layout")},stop:function(){return this.stopListening(Upfront.Events)}})),d=new(a.extend({initialize:function(){this.listenTo(Upfront.Events,"post:content:edit:start",this.startContentEditorMode),this.listenTo(Upfront.Events,"post:content:edit:stop",this.stopContentEditorMode)},boot:function(){Upfront.Util.log("Preparing post content mode for execution"),Upfront.Events.trigger("upfront:post:edit:booted",this)},start:function(){Upfront.Util.log("Starting post the content edit mode")},stop:function(){var e=t("#page");Upfront.Util.log("Stopping post the content edit mode"),e.find(".upfront-module").each(function(){t(this).is(".ui-draggable")&&t(this).draggable("enable"),t(this).is(".ui-resizable")&&t(this).resizable("enable")}),Upfront.Events.trigger("upfront:element:edit:stop"),e.find(".upfront-region-edit-trigger").show(),this.contentEditor=!1},startContentEditorMode:function(e){if(h.current_subapplication!=d){this.contentEditor=e;t("#page");Upfront.Events.on("content:insertcount:updated",this.updateInsertCount)}},stopContentEditorMode:function(){Upfront.Events.off("content:insertcount:updated",this.updateInsertCount),h.current_subapplication==d&&h.start(h.mode.last)},updateInsertCount:function(){console.log("update insertcount"),Upfront.Util.post({action:"upfront_update_insertcount"})}})),c=new(a.extend({boot:function(){Upfront.Util.log("Preparing content mode for execution")},start:function(){Upfront.Util.log("Starting the content edit mode"),Upfront.Behaviors.GridEditor.grid||Upfront.Behaviors.GridEditor.init(),t("html").removeClass("upfront-edit-layout upfront-edit-theme upfront-edit-postlayout upfront-edit-responsive").addClass("upfront-edit-content")},stop:function(){Upfront.Util.log("Stopping the content edit mode"),this.stopListening(Upfront.Events)}})),u=new(l.extend({Objects:{},boot:function(){},start:function(){this.stop(),this.Objects=Upfront.Application.LayoutEditor.Objects,this.set_up_event_plumbing_before_render(),Upfront.Application.sidebar.render(),this.topbar=new Upfront.Views.Editor.Topbar.Topbar,this.topbar.start(),this.set_up_event_plumbing_after_render(),this.listenTo(Upfront.Events,"command:layout:browse",Upfront.Behaviors.LayoutEditor.browse_layout_dialog),t("html").removeClass("upfront-edit-content upfront-edit-theme upfront-edit-postlayout upfront-edit-layout").addClass("upfront-edit-responsive")},stop:function(){return this.topbar&&this.topbar.stop(),this.stopListening(Upfront.Events)}})),h=new(Backbone.Router.extend({LayoutEditor:p,ContentEditor:c,PostContentEditor:d,ResponsiveEditor:u,actions:{save:"upfront_save_layout",save_meta:"upfront_save_layout_meta",delete_layout:"upfront_delete_page_template",reset_changes:"upfront_reset_layout",load:"upfront_load_layout"},routes:{done:"destroy_editor","new-layout":"dispatch_layout_creation","create_new(/:postType)":"create_new_entry","*otherRoutes":"fetchLayout"},MODE:{CONTENT:"content",LAYOUT:"layout",THEME:"theme",POST:"post layout",POSTCONTENT:"post content",RESPONSIVE:"responsive"},mode:{last:!1,current:!1},set_post_content_style:function(t){return t="undefined"==typeof t||t,this.MODE.POSTCONTENT_STYLE=t,!0},is_post_content_style:function(){return this.MODE.POSTCONTENT_STYLE===this.mode.current},is_builder:function(){return this.mode.current===this.MODE.THEME||this.mode.last===this.MODE.THEME},is_editor:function(){return!this.is_builder()},is_single:function(t){return"type"in _upfront_post_data.layout&&"single"===_upfront_post_data.layout.type&&("undefined"==typeof t||"item"in _upfront_post_data.layout&&"single-"+t===_upfront_post_data.layout.item)},is_archive:function(t){return"type"in _upfront_post_data.layout&&"archive"===_upfront_post_data.layout.type&&("undefined"==typeof t||"item"in _upfront_post_data.layout&&"archive-"+t===_upfront_post_data.layout.item)},urlCache:{},current_subapplication:!1,sidebar:!1,layout:!1,layout_ready:!1,responsiveMode:!1,boot:function(){this.MODE=Upfront.Settings.Application.MODE;var e=this;t("body .upfront-edit_layout a").addClass("active"),t("body").off("click",".upfront-edit_layout").on("click",".upfront-edit_layout",function(){return e.start(),!1}),t(document).trigger("upfront-load")},start:function(e){var i=_.template;if(_.template=function(t,e){if("undefined"==typeof e)return i(t);var n=i(t);return n(e)},Upfront.Util.post({action:"upfront_load_styles",layout:{item:"archive-home",type:"archive"},base_only:!0}).success(function(e){t("#upfront-main-css").after('<style id="upfront-main-base-css">'+e.data.styles+"</style>"),t("#upfront-main-css").remove()}),e||(e=this.MODE.DEFAULT),this.mode.current==e)return!1;if(t("#wpadminbar").hide(),t("html").attr("style","margin-top: 0 !important;"),this.set_current(e),this.current_subapplication&&this.current_subapplication.start||Upfront.Util.log("Can't boot invalid subapplication"),Upfront.Events.trigger("application:mode:before_switch"),this.listenToResponsiveModes(),this.layout){var n=this.layout.get("regions"),o=n.get_by_name("shadow");return n&&o&&n.remove(o),this.create_sidebar(),this.current_subapplication.layout=this.layout,this.current_subapplication&&this.current_subapplication.start?this.current_subapplication.start():Upfront.Util.log("No current subapplication"),Upfront.Events.trigger("application:mode:after_switch"),!1}var r=this,s=Upfront.plugins.call("long-loading-notice"),a=Upfront.Settings.l10n.global.application.long_loading_notice;s.status&&"called"===s.status&&s.result&&(a=s.result),r.loading=new Upfront.Views.Editor.Loading({loading:Upfront.Settings.l10n.global.application.loading,loading_notice:a,loading_type:"upfront-boot",done:Upfront.Settings.l10n.global.application.thank_you_for_waiting,fixed:!0,remove_on_event:"upfront:renderingqueue:start"}),r.loading.on_finish(function(){t(Upfront.Settings.LayoutEditor.Selectors.sidebar).show(),t(".upfront-editable_trigger").hide(),Upfront.Application.user_can_modify_layout()||r.setup_edit_layout()}),r.loading.render(),t("body").append(r.loading.$el),r.create_sidebar(),require(["objects","media","content","bg-settings","spectrum","responsive","uaccordion","redactor","ueditor","utext","ucomment","ucontact","ugallery","uimage","upfront-like-box","upfront_login","upfront_maps","unewnavigation","ubutton","uposts","usearch","upfront_slider","upfront-social_media","utabs","this_post","upostdata","this_page","uwidget","uyoutube","upfront_code","uspacer"],function(e){r.currentUrl=window.location.pathname+window.location.search,r.saveCache=!0,r.load_layout(_upfront_post_data.layout),r.start_navigation(),r.create_cssEditor(),r.create_preset_saver(),r.create_color_saver(),t(document).trigger("Upfront:loaded"),Upfront.Events.trigger("Upfront:loaded")})},stop:function(){},restart:function(){var t=this.mode.last||this.MODE.DEFAULT;this.start(t)},setup_edit_layout:function(){var e=this;e.loading.on_finish(function(){var e=t("#page");e.find(".upfront-region-edit-trigger").remove(),t("a.upfront-entity-delete_trigger").remove()})},load_layout:function(e,i){var n=this,o={action:this.actions.load,data:e,load_dev:_upfront_storage_key!=_upfront_save_storage_key?1:0};return i&&(o=_.extend(o,i)),_upfront_post_data&&(o.post_id=_upfront_post_data.post_id),t("body").removeClass(Upfront.Settings.LayoutEditor.Grid.scope),this.loadingLayout&&this.loadingLayout.abort(),this.loadingLayout=Upfront.Util.post(o).success(function(e){n.set_layout_up(e),n.saveCache&&(n.urlCache[n.currentUrl]=t.extend(!0,{},e),n.saveCache=!1)}).error(function(i){"abort"!=i.statusText&&(Upfront.Util.log("Error loading layout "+e),n.loading.cancel(function(){t(Upfront.Settings.LayoutEditor.Selectors.sidebar).hide(),t("#wpadminbar").show(),t("html").removeAttr("style")}))}),this.loadingLayout},create_layout:function(e,i){var n=this,o={action:"upfront_create_layout",data:e,load_dev:_upfront_storage_key!=_upfront_save_storage_key?1:0};return i&&(o=_.extend(o,i)),_upfront_post_data&&(o.post_id=_upfront_post_data.post_id),t("body").removeClass(Upfront.Settings.LayoutEditor.Grid.scope),this.loadingLayout&&this.loadingLayout.abort(),this.loadingLayout=Upfront.Util.post(o).success(function(i){Upfront.layout_data_from_create_layout=e,n.set_layout_up(i),n.saveCache&&(n.urlCache[n.currentUrl]=t.extend(!0,{},i),n.saveCache=!1)}).error(function(i){"abort"!=i.statusText&&(Upfront.Util.log("Error creating layout "+e),n.loading.cancel(function(){t(Upfront.Settings.LayoutEditor.Selectors.sidebar).hide(),t("#wpadminbar").show(),t("html").removeAttr("style")}))}),this.loadingLayout},set_layout_up:function(e){var i=this,n=t.extend(!0,{},e.data.layout)||{};"undefined"!=typeof e.data.template_type&&(_upfront_post_data.template_type=e.data.template_type),"undefined"!=typeof e.data.template_slug&&(_upfront_post_data.template_slug=e.data.template_slug),"undefined"!=typeof e.data.layout_change&&(_upfront_post_data.layout_change=parseInt(e.data.layout_change,10),1!==_upfront_post_data.layout_change&&(_upfront_post_data.layout_change=0)),e.data.post&&this.post_set_up(e.data.post);var o=e.data.query||{};this.layout&&(this.unset_layout(),window._upfront_get_current_query=function(){return o}),this.layout=new Upfront.Models.Layout(n),this.current_subapplication.layout=this.layout,this.sidebar.model.set(this.layout.toJSON()),"undefined"!=typeof e.data.post&&null!==e.data.post&&("undefined"!==e.data.post.ID&&e.data.query.post_count||"undefined"!==e.data.post.ID&&"single"===e.data.cascade.type||e.data.query.is_singular)?Upfront.Events.trigger("click:edit:navigate",e.data.post.ID):Upfront.Events.trigger("click:edit:navigate",!1);var r=this.layout.get("regions").get_by_name("shadow");r&&this.layout.get("regions").remove(r),window._upfront_post_data.layout=e.data.cascade,Upfront.Events.trigger("upfront:layout:loaded"),i.current_subapplication&&i.current_subapplication.start?i.current_subapplication.start():Upfront.Util.log("No current subapplication"),Upfront.Events.once("layout:after_render",function(){i.layout_ready=!0}),i.layout_view=new Upfront.Views.Layout({model:i.layout,el:t(Upfront.Settings.LayoutEditor.Selectors.main)}),Upfront.Events.trigger("upfront:renderingqueue:settotal",i.layout_view),Upfront.Events.trigger("layout:render",i.current_subapplication),Upfront.Application.loading.done(function(){try{var t=sessionStorage.getItem("upfront_tab_id");null===t&&(t=Upfront.Util.get_unique_id("tab_id"),sessionStorage.setItem("upfront_tab_id",t))}catch(t){var t=Upfront.Util.get_unique_id("tab_id")}Upfront.PreviewUpdate.run(i.layout,t),Upfront.Events.trigger("application:mode:after_switch")})},unset_layout:function(){var e,i,n;Upfront.data.currentEntity=!1,Upfront.data.Ueditor&&_.each(Upfront.data.Ueditor.instances,function(t){t.stop()}),this.layout&&(this.layout.trigger("destroy"),this.layout=!1),this.current_subapplication.layout&&(this.current_subapplication.layout=!1),this.layout_view&&(i=this.layout_view.el,e={name:i.tagName,id:i.id,className:i.className},n=t("<"+e.name+">"),this.layout_view.$el.after(n),this.layout_view.remove(),this.layout_view=!1,this.layout_ready=!1,n.attr({class:e.className,id:e.id}),Upfront.Events.off("upfront:editor:init"),Upfront.Events.off("upfront:post:taxonomy_changed")),t(Upfront.Settings.LayoutEditor.Selectors.main).length||t("body").prepend('<div id="page" />')},create_new_entry:function(e){var i=this,n={item:"single-"+e,type:"single",specificity:"single-"+e+"-1000000"},o=new t.Deferred,r={},s=this.set_loading(Upfront.Settings.l10n.global.application.preparing_new_post_type.replace(/%s/,e),Upfront.Settings.l10n.global.application.here_we_are);return this.current_subapplication&&this.current_subapplication.stop&&this.current_subapplication.stop(),Upfront.Events.once("upfront:post:edit:stop",function(t,e){i.navigate("/edit/"+e.post_type+"/"+e.ID+location.search,{trigger:!1,replace:!0})}),Upfront.Events.once("post:initialized",function(t){t.once("post:updated",function(t){Upfront.Settings.LayoutEditor.newpostType=!1,i.navigate("/edit/"+t.post_type+"/"+t.ID,{trigger:!1,replace:!0})}),i.listenToOnce(t.editor,"rendered",function(){setTimeout(function(){t.editor.editContents(!1,t.$(".upfront-content-marker-title"))},200)})}),this.load_layout(n,{new_post:e}).done(function(t){Upfront.Settings.LayoutEditor.newpostType=e,r=t.data.post,Upfront.data.posts[r.ID].is_new=!0,o.resolve(Upfront.data.posts[r.ID]),s.done()}),o.promise()},post_set_up:function(e){e.meta=[];var i=new Upfront.Models.Post(e);i.is_new="draft"===e.post_status&&e.post_content.indexOf("<p")<0,Upfront.data.posts[i.id]=i,_upfront_post_data.post_id=i.id;var n="logged-in admin-bar customize-support flex-support";n+="page"==e.post_type?" page page-id-"+i.id+" page-template-default":" single single-"+e.post_type+" postid-"+i.id,i.is_new&&(n+=" is_new"),t("body").removeClass().addClass(n)},set_gridstate:function(t){this.gridstate=t},get_gridstate:function(){return this.gridstate},get_current:function(){return this.mode.current||this.MODE.DEFAULT},set_current:function(t){return this.current_subapplication&&this.current_subapplication.stop&&this.current_subapplication.stop(),t||(t=this.MODE.DEFAULT),this.mode.current!=t&&(this.mode.last=this.mode.current,t&&this.MODE.CONTENT==t?(this.mode.current=this.MODE.CONTENT,this.current_subapplication=this.ContentEditor):t&&this.MODE.THEME==t?(this.mode.current=this.MODE.THEME,this.current_subapplication=this.ThemeEditor):t&&this.MODE.POSTCONTENT==t?(this.mode.current=this.MODE.POSTCONTENT,this.current_subapplication=this.PostContentEditor):t&&this.MODE.RESPONSIVE==t?(this.mode.current=this.MODE.RESPONSIVE,this.current_subapplication=this.ResponsiveEditor):(this.mode.current=this.MODE.LAYOUT,this.current_subapplication=this.LayoutEditor),void this.current_subapplication.boot())},create_sidebar:function(){this.sidebar||(this.sidebar=new Upfront.Views.Editor.Sidebar.Sidebar({model:new Upfront.Models.Layout({}),el:t(Upfront.Settings.LayoutEditor.Selectors.sidebar)}))},recursiveExistenceMigration:function(e,i){for(var n=i.split(" "),o=this;n.length>0;){try{if(t(e+n.join(" ")).closest("#"+o.element_id).length)return!0}catch(t){}n.pop()}return!1},stylesAddSelectorMigration:function(e,i){if(this.is_global_stylesheet&&empty(i))return e;var n=this,o=e.split("}"),r="";return _.each(o,function(e){var o=t.trim(e).split("{");if(2!=o.length)return!0;var s=o[0].split(","),a=[];_.each(s,function(e){e=t.trim(e);var o=e.replace(/:[^\s]+/,""),r="@"===o[0]||n.recursiveExistenceMigration(i,o),s=r?"":" ";a.push(""+i+s+e)}),r+=a.join(", ")+" {"+o[1]+"\n}\n"}),r},create_cssEditor:function(){var e,i=this,n=new Upfront.Views.Editor.CSSEditor,o="";n.fetchThemeStyles(!0).done(function(n){Upfront.data.styles={},_.each(n,function(e,i){Upfront.data.styles[i]=[],_.each(e,function(e,n){e=Upfront.Util.colors.convert_string_ufc_to_color(e),Upfront.data.styles[i].push(n);var o=t("#"+n),r=e.replace(/#page/g,"div#page.upfront-layout-view .upfront-editable_entity.upfront-module");o.length?o.html(r):(o=t('<style id="'+n+'">'+r+"</style>"),t("body").append(o))})}),_.each(Upfront.mainData.iconFonts,function(i){i.active===!0&&(_.each(i.files,function(t,e){switch(o+="url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+t+"') format('",e){case"eot":o+="embedded-opentype";break;case"woff":o+="woff";break;case"ttf":o+="truetype";break;case"svg":o+="svg"}o+="'),"}),e="@font-face {font-family: '"+i.family+"';",i.files.eot&&(e+="src: url('"+Upfront.mainData.currentThemeUrl+"/icon-fonts/"+i.files.eot+"');"),e+="\tsrc:"+o.substring(0,o.length-1)+";",e+="\tfont-weight: normal;\tfont-style: normal;}.uf_font_icon, .uf_font_icon * {\tfont-family: '"+i.family+"'!important;}",t("body").append('<style id="active-icon-font">'+e+"</style>"))}),_upfront_post_data.layout&&i.apply_region_css(),Upfront.Events.trigger("upfront:csseditor:ready")}),n.createSelectors(Upfront.Application.LayoutEditor.Objects),n.createSelector(Upfront.Models.ModuleGroup,Upfront.Views.ModuleGroup,"ModuleGroup"),n.createSelector(Upfront.Models.Region,Upfront.Views.RegionContainerView,"RegionContainer"),n.createSelector(Upfront.Models.Region,Upfront.Views.RegionView,"Region"),n.createSelector(Upfront.Models.Region,Upfront.Views.RegionLightboxView,"RegionLightbox"),Upfront.plugins.call("insert-css-editor-selectors",{cssEditor:n}),Upfront.Events.on("upfront:layout:loaded",i.apply_region_css,i),Upfront.Events.on("upfront:layout:loaded",i.ensure_layout_style,i),this.cssEditor=n},create_preset_saver:function(){this.presetSaver=Upfront.Views.PresetSaver},create_color_saver:function(){this.colorSaver=Upfront.Views.ColorSaver},ensure_layout_style:function(){var e;Upfront.Application.current_subapplication.layout&&!t("style#layout-style").length&&(e=Upfront.Application.current_subapplication.layout.get("properties").findWhere({name:"layout_style"})?Upfront.Application.current_subapplication.layout.get("properties").findWhere({name:"layout_style"}).get("value"):"",e&&e.length&&(e=Upfront.Util.colors.convert_string_ufc_to_color(e)),t("body").append('<style id="layout-style">'+e+"</style>"))},apply_region_css:function(){var e=this,i=_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type;_.each(Upfront.data.styles,function(n,o){o!=e.cssEditor.elementTypes.RegionContainer.id&&o!=e.cssEditor.elementTypes.Region.id||_.isArray(n)&&_.each(n,function(e){var n=t("#"+e);n.length&&(e.match(new RegExp("^"+i))||e.match(new RegExp("^"+o)))?n.prop("disabled",!1):n.prop("disabled",!0)})})},adjust_grid_padding_settings:function(e){var i=t(e).parent(),n=parseInt(i.css("padding-top"),10),o=parseInt(i.css("padding-bottom"),10);n>0&&i.find(".upfront-overlay-grid").css("top",n*-1),o>0&&i.find(".upfront-overlay-grid").css("bottom",o*-1)},fetchLayout:function(t,e){this.mode.current!=this.MODE.LAYOUT&&this.start(this.MODE.LAYOUT);var i,n=this,o=!!e&&[],r=t?"/"+t:"/";if(r.indexOf("edit/post")!==-1||r.indexOf("edit/page")!==-1){var s=parseInt(r.replace(/[^\d.]/g,""),10);isNaN(s)||s===_upfront_post_data.post_id||(_upfront_post_data.post_id=s)}o&&(_.each(e,function(t,e){o.push(e+"="+t)}),r+="?"+o.join("&")),i=this.set_loading(Upfront.Settings.l10n.global.application.loading_path.replace(/%s/,r),Upfront.Settings.l10n.global.application.here_we_are),this.urlCache[r]?setTimeout(function(){Upfront.Settings.LayoutEditor.newpostType=!1,n.set_layout_up(n.urlCache[r]),n.currentUrl=r,i.done()},150):(n.unset_layout(),this.load_layout(r).done(function(t){Upfront.Settings.LayoutEditor.newpostType=!1,i.done(),Upfront.Settings.LayoutEditor.newpostType=!1,n.urlCache[r]=t,this.currentUrl=r}))},start_navigation:function(){var t=document.createElement("a");t.href=Upfront.Settings.site_url,Backbone.history.start({pushState:!0,root:t.pathname,silent:!0})},set_loading:function(e,i){var n=this,o=this.loadingLayer;return o?(document.querySelector(".upfront-loading-text").innerText=e,o.options.done=i):(o=new Upfront.Views.Editor.Loading({loading:e,done:i,fixed:!0,remove_on_event:"upfront:renderingqueue:start"}),o.render(),t("body").append(o.$el),o.on_finish(function(){n.loadingLayer=!1})),this.loadingLayer=o,o},listenToResponsiveModes:function(){if(!this.responsiveMode){var t=this;this.responsiveMode="desktop",this.listenTo(Upfront.Events,"upfront:layout_size:change_breakpoint",function(e,i){t.responsiveMode=e.id})}},user_can:function(t){return t=(_.isString(t)?t:"").toUpperCase(),!!((Upfront.Settings.Application||{}).PERMS||{})[t]},user_can_modify_layout:function(){var t=this.is_archive(),e=this.is_archive("home"),i=this.is_single(),n=this.is_single("page");return!!this.user_can("LAYOUT_MODE")&&(!(!e||!this.user_can("HOME_LAYOUT_MODE"))||(!(e||!t||!this.user_can("ARCHIVE_LAYOUT_MODE"))||(!(!n||!this.user_can("SINGLEPAGE_LAYOUT_MODE"))||!(n||!i||!this.user_can("SINGLEPOST_LAYOUT_MODE")))))},user_can_save_content:function(){return!(!this.is_single()||!this.user_can("EDIT_OWN")&&!this.user_can("EDIT"))},is_plugin_layout:function(t){var e=Upfront.Application.current_subapplication.get_layout_data().layout;if("undefined"==typeof t&&e.item&&"single-page"===e.item&&e.specificity&&e.specificity.match("single-page-")){var i=e.specificity.match(/\d+/);_.isNull(i)===!1&&1===i.length&&(t=i[0])}var n;return _.each(Upfront.mainData.pluginsLayouts,function(i,o){n||(_.each(i.pagesById,function(e){parseInt(e.pageId,10)===parseInt(t,10)&&(n={pluginName:i.pluginName,content:i.sampleContents[e.content]?i.sampleContents[e.content]:""})}),n||_.each(i.layouts,function(t){n||(t.specificity&&e.specificity&&_.isNull(e.specificity.match(t.specificity))===!1?n={pluginName:i.pluginName,content:i.sampleContents[t.content]?i.sampleContents[t.content]:""}:t.item===e.item&&(n={pluginName:i.pluginName,content:i.sampleContents[t.content]?i.sampleContents[t.content]:""}))}))}),n}}));return{Application:h,Subapplication:l}}),t(function(){t("body").on("click",".upfront-edit_layout",function(t){t.preventDefault()})})}(jQuery),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("pako",[],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.pako=t()}}(function(){return function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var p=new Error("Cannot find module '"+s+"'");throw p.code="MODULE_NOT_FOUND",p}var d=i[s]={exports:{}};e[s][0].call(d.exports,function(t){var i=e[s][1][t];return o(i?i:t)},d,d.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=l.assign({level:v,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(i!==_)throw new Error(d[i]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var o;if(o="string"==typeof e.dictionary?p.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,i=a.deflateSetDictionary(this.strm,o),i!==_)throw new Error(d[i]);this._dict_set=!0}}function o(t,e){
var i=new n(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}function r(t,e){return e=e||{},e.raw=!0,o(t,e)}function s(t,e){return e=e||{},e.gzip=!0,o(t,e)}var a=t("./zlib/deflate"),l=t("./utils/common"),p=t("./utils/strings"),d=t("./zlib/messages"),c=t("./zlib/zstream"),u=Object.prototype.toString,h=0,f=4,_=0,g=1,m=2,v=-1,b=0,y=8;n.prototype.push=function(t,e){var i,n,o=this.strm,r=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:e===!0?f:h,"string"==typeof t?o.input=p.string2buf(t):"[object ArrayBuffer]"===u.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new l.Buf8(r),o.next_out=0,o.avail_out=r),i=a.deflate(o,n),i!==g&&i!==_)return this.onEnd(i),this.ended=!0,!1;0!==o.avail_out&&(0!==o.avail_in||n!==f&&n!==m)||("string"===this.options.to?this.onData(p.buf2binstring(l.shrinkBuf(o.output,o.next_out))):this.onData(l.shrinkBuf(o.output,o.next_out)))}while((o.avail_in>0||0===o.avail_out)&&i!==g);return n===f?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===_):n!==m||(this.onEnd(_),o.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===_&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=n,i.deflate=o,i.deflateRaw=r,i.gzip=s},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(t,e,i){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=s.inflateInit2(this.strm,e.windowBits);if(i!==p.Z_OK)throw new Error(d[i]);this.header=new u,s.inflateGetHeader(this.strm,this.header)}function o(t,e){var i=new n(e);if(i.push(t,!0),i.err)throw i.msg;return i.result}function r(t,e){return e=e||{},e.raw=!0,o(t,e)}var s=t("./zlib/inflate"),a=t("./utils/common"),l=t("./utils/strings"),p=t("./zlib/constants"),d=t("./zlib/messages"),c=t("./zlib/zstream"),u=t("./zlib/gzheader"),h=Object.prototype.toString;n.prototype.push=function(t,e){var i,n,o,r,d,c,u=this.strm,f=this.options.chunkSize,_=this.options.dictionary,g=!1;if(this.ended)return!1;n=e===~~e?e:e===!0?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof t?u.input=l.binstring2buf(t):"[object ArrayBuffer]"===h.call(t)?u.input=new Uint8Array(t):u.input=t,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new a.Buf8(f),u.next_out=0,u.avail_out=f),i=s.inflate(u,p.Z_NO_FLUSH),i===p.Z_NEED_DICT&&_&&(c="string"==typeof _?l.string2buf(_):"[object ArrayBuffer]"===h.call(_)?new Uint8Array(_):_,i=s.inflateSetDictionary(this.strm,c)),i===p.Z_BUF_ERROR&&g===!0&&(i=p.Z_OK,g=!1),i!==p.Z_STREAM_END&&i!==p.Z_OK)return this.onEnd(i),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&i!==p.Z_STREAM_END&&(0!==u.avail_in||n!==p.Z_FINISH&&n!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(o=l.utf8border(u.output,u.next_out),r=u.next_out-o,d=l.buf2string(u.output,o),u.next_out=r,u.avail_out=f-r,r&&a.arraySet(u.output,u.output,o,r,0),this.onData(d)):this.onData(a.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(g=!0)}while((u.avail_in>0||0===u.avail_out)&&i!==p.Z_STREAM_END);return i===p.Z_STREAM_END&&(n=p.Z_FINISH),n===p.Z_FINISH?(i=s.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===p.Z_OK):n!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),u.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=n,i.inflate=o,i.inflateRaw=r,i.ungzip=o},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(t,e,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,i,n,o){if(e.subarray&&t.subarray)return void t.set(e.subarray(i,i+n),o);for(var r=0;r<n;r++)t[o+r]=e[i+r]},flattenChunks:function(t){var e,i,n,o,r,s;for(n=0,e=0,i=t.length;e<i;e++)n+=t[e].length;for(s=new Uint8Array(n),o=0,e=0,i=t.length;e<i;e++)r=t[e],s.set(r,o),o+=r.length;return s}},r={arraySet:function(t,e,i,n,o){for(var r=0;r<n;r++)t[o+r]=e[i+r]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,o)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,r))},i.setTyped(n)},{}],4:[function(t,e,i){"use strict";function n(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&r))return String.fromCharCode.apply(null,o.shrinkBuf(t,e));for(var i="",n=0;n<e;n++)i+=String.fromCharCode(t[n]);return i}var o=t("./common"),r=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var a=new o.Buf8(256),l=0;l<256;l++)a[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;a[254]=a[254]=1,i.string2buf=function(t){var e,i,n,r,s,a=t.length,l=0;for(r=0;r<a;r++)i=t.charCodeAt(r),55296===(64512&i)&&r+1<a&&(n=t.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(e=new o.Buf8(l),s=0,r=0;s<l;r++)i=t.charCodeAt(r),55296===(64512&i)&&r+1<a&&(n=t.charCodeAt(r+1),56320===(64512&n)&&(i=65536+(i-55296<<10)+(n-56320),r++)),i<128?e[s++]=i:i<2048?(e[s++]=192|i>>>6,e[s++]=128|63&i):i<65536?(e[s++]=224|i>>>12,e[s++]=128|i>>>6&63,e[s++]=128|63&i):(e[s++]=240|i>>>18,e[s++]=128|i>>>12&63,e[s++]=128|i>>>6&63,e[s++]=128|63&i);return e},i.buf2binstring=function(t){return n(t,t.length)},i.binstring2buf=function(t){for(var e=new o.Buf8(t.length),i=0,n=e.length;i<n;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,o,r,s,l=e||t.length,p=new Array(2*l);for(o=0,i=0;i<l;)if(r=t[i++],r<128)p[o++]=r;else if(s=a[r],s>4)p[o++]=65533,i+=s-1;else{for(r&=2===s?31:3===s?15:7;s>1&&i<l;)r=r<<6|63&t[i++],s--;s>1?p[o++]=65533:r<65536?p[o++]=r:(r-=65536,p[o++]=55296|r>>10&1023,p[o++]=56320|1023&r)}return n(p,o)},i.utf8border=function(t,e){var i;for(e=e||t.length,e>t.length&&(e=t.length),i=e-1;i>=0&&128===(192&t[i]);)i--;return i<0?e:0===i?e:i+a[t[i]]>e?i:e}},{"./common":3}],5:[function(t,e,i){"use strict";function n(t,e,i,n){for(var o=65535&t|0,r=t>>>16&65535|0,s=0;0!==i;){s=i>2e3?2e3:i,i-=s;do o=o+e[n++]|0,r=r+o|0;while(--s);o%=65521,r%=65521}return o|r<<16|0}e.exports=n},{}],6:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(t,e,i){"use strict";function n(){for(var t,e=[],i=0;i<256;i++){t=i;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}function o(t,e,i,n){var o=r,s=n+i;t^=-1;for(var a=n;a<s;a++)t=t>>>8^o[255&(t^e[a])];return t^-1}var r=n();e.exports=o},{}],8:[function(t,e,i){"use strict";function n(t,e){return t.msg=j[e],e}function o(t){return(t<<1)-(t>4?9:0)}function r(t){for(var e=t.length;--e>=0;)t[e]=0}function s(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(z.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function a(t,e){I._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,s(t.strm)}function l(t,e){t.pending_buf[t.pending++]=e}function p(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function d(t,e,i,n){var o=t.avail_in;return o>n&&(o=n),0===o?0:(t.avail_in-=o,z.arraySet(e,t.input,t.next_in,o,i),1===t.state.wrap?t.adler=P(t.adler,e,o,i):2===t.state.wrap&&(t.adler=M(t.adler,e,o,i)),t.next_in+=o,t.total_in+=o,o)}function c(t,e){var i,n,o=t.max_chain_length,r=t.strstart,s=t.prev_length,a=t.nice_match,l=t.strstart>t.w_size-ct?t.strstart-(t.w_size-ct):0,p=t.window,d=t.w_mask,c=t.prev,u=t.strstart+dt,h=p[r+s-1],f=p[r+s];t.prev_length>=t.good_match&&(o>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,p[i+s]===f&&p[i+s-1]===h&&p[i]===p[r]&&p[++i]===p[r+1]){r+=2,i++;do;while(p[++r]===p[++i]&&p[++r]===p[++i]&&p[++r]===p[++i]&&p[++r]===p[++i]&&p[++r]===p[++i]&&p[++r]===p[++i]&&p[++r]===p[++i]&&p[++r]===p[++i]&&r<u);if(n=dt-(u-r),r=u-dt,n>s){if(t.match_start=e,s=n,n>=a)break;h=p[r+s-1],f=p[r+s]}}while((e=c[e&d])>l&&0!==--o);return s<=t.lookahead?s:t.lookahead}function u(t){var e,i,n,o,r,s=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=s+(s-ct)){z.arraySet(t.window,t.window,s,s,0),t.match_start-=s,t.strstart-=s,t.block_start-=s,i=t.hash_size,e=i;do n=t.head[--e],t.head[e]=n>=s?n-s:0;while(--i);i=s,e=i;do n=t.prev[--e],t.prev[e]=n>=s?n-s:0;while(--i);o+=s}if(0===t.strm.avail_in)break;if(i=d(t.strm,t.window,t.strstart+t.lookahead,o),t.lookahead+=i,t.lookahead+t.insert>=pt)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[r+pt-1])&t.hash_mask,t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<pt)););}while(t.lookahead<ct&&0!==t.strm.avail_in)}function h(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(u(t),0===t.lookahead&&e===O)return yt;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+i;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,a(t,!1),0===t.strm.avail_out))return yt;if(t.strstart-t.block_start>=t.w_size-ct&&(a(t,!1),0===t.strm.avail_out))return yt}return t.insert=0,e===L?(a(t,!0),0===t.strm.avail_out?kt:$t):t.strstart>t.block_start&&(a(t,!1),0===t.strm.avail_out)?yt:yt}function f(t,e){for(var i,n;;){if(t.lookahead<ct){if(u(t),t.lookahead<ct&&e===O)return yt;if(0===t.lookahead)break}if(i=0,t.lookahead>=pt&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+pt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-ct&&(t.match_length=c(t,i)),t.match_length>=pt)if(n=I._tr_tally(t,t.strstart-t.match_start,t.match_length-pt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=pt){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+pt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=I._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(a(t,!1),0===t.strm.avail_out))return yt}return t.insert=t.strstart<pt-1?t.strstart:pt-1,e===L?(a(t,!0),0===t.strm.avail_out?kt:$t):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?yt:wt}function _(t,e){for(var i,n,o;;){if(t.lookahead<ct){if(u(t),t.lookahead<ct&&e===O)return yt;if(0===t.lookahead)break}if(i=0,t.lookahead>=pt&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+pt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=pt-1,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-ct&&(t.match_length=c(t,i),t.match_length<=5&&(t.strategy===q||t.match_length===pt&&t.strstart-t.match_start>4096)&&(t.match_length=pt-1)),t.prev_length>=pt&&t.match_length<=t.prev_length){o=t.strstart+t.lookahead-pt,n=I._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-pt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=o&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+pt-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(0!==--t.prev_length);if(t.match_available=0,t.match_length=pt-1,t.strstart++,n&&(a(t,!1),0===t.strm.avail_out))return yt}else if(t.match_available){if(n=I._tr_tally(t,0,t.window[t.strstart-1]),n&&a(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return yt}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=I._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<pt-1?t.strstart:pt-1,e===L?(a(t,!0),0===t.strm.avail_out?kt:$t):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?yt:wt}function g(t,e){for(var i,n,o,r,s=t.window;;){if(t.lookahead<=dt){if(u(t),t.lookahead<=dt&&e===O)return yt;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=pt&&t.strstart>0&&(o=t.strstart-1,n=s[o],n===s[++o]&&n===s[++o]&&n===s[++o])){r=t.strstart+dt;do;while(n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&n===s[++o]&&o<r);t.match_length=dt-(r-o),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=pt?(i=I._tr_tally(t,1,t.match_length-pt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=I._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(a(t,!1),0===t.strm.avail_out))return yt}return t.insert=0,e===L?(a(t,!0),0===t.strm.avail_out?kt:$t):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?yt:wt}function m(t,e){for(var i;;){if(0===t.lookahead&&(u(t),0===t.lookahead)){if(e===O)return yt;break}if(t.match_length=0,i=I._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(a(t,!1),0===t.strm.avail_out))return yt}return t.insert=0,e===L?(a(t,!0),0===t.strm.avail_out?kt:$t):t.last_lit&&(a(t,!1),0===t.strm.avail_out)?yt:wt}function v(t,e,i,n,o){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=n,this.func=o}function b(t){t.window_size=2*t.w_size,r(t.head),t.max_lazy_match=T[t.level].max_lazy,t.good_match=T[t.level].good_length,t.nice_match=T[t.level].nice_length,t.max_chain_length=T[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=pt-1,t.match_available=0,t.ins_h=0}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=K,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new z.Buf16(2*at),this.dyn_dtree=new z.Buf16(2*(2*rt+1)),this.bl_tree=new z.Buf16(2*(2*st+1)),r(this.dyn_ltree),r(this.dyn_dtree),r(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new z.Buf16(lt+1),this.heap=new z.Buf16(2*ot+1),r(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new z.Buf16(2*ot+1),r(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function w(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=X,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?ht:vt,t.adler=2===e.wrap?0:1,e.last_flush=O,I._tr_init(e),V):n(t,R)}function k(t){var e=w(t);return e===V&&b(t.state),e}function $(t,e){return t&&t.state?2!==t.state.wrap?R:(t.state.gzhead=e,V):R}function x(t,e,i,o,r,s){if(!t)return R;var a=1;if(e===W&&(e=6),o<0?(a=0,o=-o):o>15&&(a=2,o-=16),r<1||r>Z||i!==K||o<8||o>15||e<0||e>9||s<0||s>J)return n(t,R);8===o&&(o=9);var l=new y;return t.state=l,l.strm=t,l.wrap=a,l.gzhead=null,l.w_bits=o,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=r+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+pt-1)/pt),l.window=new z.Buf8(2*l.w_size),l.head=new z.Buf16(l.hash_size),l.prev=new z.Buf16(l.w_size),l.lit_bufsize=1<<r+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new z.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=e,l.strategy=s,l.method=i,k(t)}function U(t,e){return x(t,e,K,tt,et,Y)}function E(t,e){var i,a,d,c;if(!t||!t.state||e>N||e<0)return t?n(t,R):R;if(a=t.state,!t.output||!t.input&&0!==t.avail_in||a.status===bt&&e!==L)return n(t,0===t.avail_out?H:R);if(a.strm=t,i=a.last_flush,a.last_flush=e,a.status===ht)if(2===a.wrap)t.adler=0,l(a,31),l(a,139),l(a,8),a.gzhead?(l(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),l(a,255&a.gzhead.time),l(a,a.gzhead.time>>8&255),l(a,a.gzhead.time>>16&255),l(a,a.gzhead.time>>24&255),l(a,9===a.level?2:a.strategy>=G||a.level<2?4:0),l(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(l(a,255&a.gzhead.extra.length),l(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(t.adler=M(t.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=ft):(l(a,0),l(a,0),l(a,0),l(a,0),l(a,0),l(a,9===a.level?2:a.strategy>=G||a.level<2?4:0),l(a,xt),a.status=vt);else{var u=K+(a.w_bits-8<<4)<<8,h=-1;h=a.strategy>=G||a.level<2?0:a.level<6?1:6===a.level?2:3,u|=h<<6,0!==a.strstart&&(u|=ut),u+=31-u%31,a.status=vt,p(a,u),0!==a.strstart&&(p(a,t.adler>>>16),p(a,65535&t.adler)),t.adler=1}if(a.status===ft)if(a.gzhead.extra){for(d=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>d&&(t.adler=M(t.adler,a.pending_buf,a.pending-d,d)),s(t),d=a.pending,a.pending!==a.pending_buf_size));)l(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>d&&(t.adler=M(t.adler,a.pending_buf,a.pending-d,d)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=_t)}else a.status=_t;if(a.status===_t)if(a.gzhead.name){d=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>d&&(t.adler=M(t.adler,a.pending_buf,a.pending-d,d)),s(t),d=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,l(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>d&&(t.adler=M(t.adler,a.pending_buf,a.pending-d,d)),0===c&&(a.gzindex=0,a.status=gt)}else a.status=gt;if(a.status===gt)if(a.gzhead.comment){d=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>d&&(t.adler=M(t.adler,a.pending_buf,a.pending-d,d)),s(t),d=a.pending,a.pending===a.pending_buf_size)){c=1;break}c=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,l(a,c)}while(0!==c);a.gzhead.hcrc&&a.pending>d&&(t.adler=M(t.adler,a.pending_buf,a.pending-d,d)),0===c&&(a.status=mt)}else a.status=mt;if(a.status===mt&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&s(t),a.pending+2<=a.pending_buf_size&&(l(a,255&t.adler),l(a,t.adler>>8&255),t.adler=0,a.status=vt)):a.status=vt),0!==a.pending){if(s(t),0===t.avail_out)return a.last_flush=-1,V}else if(0===t.avail_in&&o(e)<=o(i)&&e!==L)return n(t,H);if(a.status===bt&&0!==t.avail_in)return n(t,H);if(0!==t.avail_in||0!==a.lookahead||e!==O&&a.status!==bt){var f=a.strategy===G?m(a,e):a.strategy===Q?g(a,e):T[a.level].func(a,e);if(f!==kt&&f!==$t||(a.status=bt),f===yt||f===kt)return 0===t.avail_out&&(a.last_flush=-1),V;if(f===wt&&(e===D?I._tr_align(a):e!==N&&(I._tr_stored_block(a,0,0,!1),e===A&&(r(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),s(t),0===t.avail_out))return a.last_flush=-1,V}return e!==L?V:a.wrap<=0?B:(2===a.wrap?(l(a,255&t.adler),l(a,t.adler>>8&255),l(a,t.adler>>16&255),l(a,t.adler>>24&255),l(a,255&t.total_in),l(a,t.total_in>>8&255),l(a,t.total_in>>16&255),l(a,t.total_in>>24&255)):(p(a,t.adler>>>16),p(a,65535&t.adler)),s(t),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?V:B)}function S(t){var e;return t&&t.state?(e=t.state.status,e!==ht&&e!==ft&&e!==_t&&e!==gt&&e!==mt&&e!==vt&&e!==bt?n(t,R):(t.state=null,e===vt?n(t,F):V)):R}function C(t,e){var i,n,o,s,a,l,p,d,c=e.length;if(!t||!t.state)return R;if(i=t.state,s=i.wrap,2===s||1===s&&i.status!==ht||i.lookahead)return R;for(1===s&&(t.adler=P(t.adler,e,c,0)),i.wrap=0,c>=i.w_size&&(0===s&&(r(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new z.Buf8(i.w_size),z.arraySet(d,e,c-i.w_size,i.w_size,0),e=d,c=i.w_size),a=t.avail_in,l=t.next_in,p=t.input,t.avail_in=c,t.next_in=0,t.input=e,u(i);i.lookahead>=pt;){n=i.strstart,o=i.lookahead-(pt-1);do i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+pt-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++;while(--o);i.strstart=n,i.lookahead=pt-1,u(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=pt-1,i.match_available=0,t.next_in=l,t.input=p,t.avail_in=a,i.wrap=s,V}var T,z=t("../utils/common"),I=t("./trees"),P=t("./adler32"),M=t("./crc32"),j=t("./messages"),O=0,D=1,A=3,L=4,N=5,V=0,B=1,R=-2,F=-3,H=-5,W=-1,q=1,G=2,Q=3,J=4,Y=0,X=2,K=8,Z=9,tt=15,et=8,it=29,nt=256,ot=nt+1+it,rt=30,st=19,at=2*ot+1,lt=15,pt=3,dt=258,ct=dt+pt+1,ut=32,ht=42,ft=69,_t=73,gt=91,mt=103,vt=113,bt=666,yt=1,wt=2,kt=3,$t=4,xt=3;T=[new v(0,0,0,0,h),new v(4,4,8,4,f),new v(4,5,16,8,f),new v(4,6,32,32,f),new v(4,4,16,16,_),new v(8,16,32,32,_),new v(8,16,128,128,_),new v(8,32,128,256,_),new v(32,128,258,1024,_),new v(32,258,258,4096,_)],i.deflateInit=U,i.deflateInit2=x,i.deflateReset=k,i.deflateResetKeep=w,i.deflateSetHeader=$,i.deflate=E,i.deflateEnd=S,i.deflateSetDictionary=C,i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(t,e,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=n},{}],10:[function(t,e,i){"use strict";var n=30,o=12;e.exports=function(t,e){var i,r,s,a,l,p,d,c,u,h,f,_,g,m,v,b,y,w,k,$,x,U,E,S,C;i=t.state,r=t.next_in,S=t.input,s=r+(t.avail_in-5),a=t.next_out,C=t.output,l=a-(e-t.avail_out),p=a+(t.avail_out-257),d=i.dmax,c=i.wsize,u=i.whave,h=i.wnext,f=i.window,_=i.hold,g=i.bits,m=i.lencode,v=i.distcode,b=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;t:do{g<15&&(_+=S[r++]<<g,g+=8,_+=S[r++]<<g,g+=8),w=m[_&b];e:for(;;){if(k=w>>>24,_>>>=k,g-=k,k=w>>>16&255,0===k)C[a++]=65535&w;else{if(!(16&k)){if(0===(64&k)){w=m[(65535&w)+(_&(1<<k)-1)];continue e}if(32&k){i.mode=o;break t}t.msg="invalid literal/length code",i.mode=n;break t}$=65535&w,k&=15,k&&(g<k&&(_+=S[r++]<<g,g+=8),$+=_&(1<<k)-1,_>>>=k,g-=k),g<15&&(_+=S[r++]<<g,g+=8,_+=S[r++]<<g,g+=8),w=v[_&y];i:for(;;){if(k=w>>>24,_>>>=k,g-=k,k=w>>>16&255,!(16&k)){if(0===(64&k)){w=v[(65535&w)+(_&(1<<k)-1)];continue i}t.msg="invalid distance code",i.mode=n;break t}if(x=65535&w,k&=15,g<k&&(_+=S[r++]<<g,g+=8,g<k&&(_+=S[r++]<<g,g+=8)),x+=_&(1<<k)-1,x>d){t.msg="invalid distance too far back",i.mode=n;break t}if(_>>>=k,g-=k,k=a-l,x>k){if(k=x-k,k>u&&i.sane){t.msg="invalid distance too far back",i.mode=n;break t}if(U=0,E=f,0===h){if(U+=c-k,k<$){$-=k;do C[a++]=f[U++];while(--k);U=a-x,E=C}}else if(h<k){if(U+=c+h-k,k-=h,k<$){$-=k;do C[a++]=f[U++];while(--k);if(U=0,h<$){k=h,$-=k;do C[a++]=f[U++];while(--k);U=a-x,E=C}}}else if(U+=h-k,k<$){$-=k;do C[a++]=f[U++];while(--k);U=a-x,E=C}for(;$>2;)C[a++]=E[U++],C[a++]=E[U++],C[a++]=E[U++],$-=3;$&&(C[a++]=E[U++],$>1&&(C[a++]=E[U++]))}else{U=a-x;do C[a++]=C[U++],C[a++]=C[U++],C[a++]=C[U++],$-=3;while($>2);$&&(C[a++]=C[U++],$>1&&(C[a++]=C[U++]))}break}}break}}while(r<s&&a<p);$=g>>3,r-=$,g-=$<<3,_&=(1<<g)-1,t.next_in=r,t.next_out=a,t.avail_in=r<s?5+(s-r):5-(r-s),t.avail_out=a<p?257+(p-a):257-(a-p),i.hold=_,i.bits=g}},{}],11:[function(t,e,i){"use strict";function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function o(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new v.Buf16(320),this.work=new v.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function r(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=A,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new v.Buf32(_t),e.distcode=e.distdyn=new v.Buf32(gt),e.sane=1,e.back=-1,T):P}function s(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,r(t)):P}function a(t,e){var i,n;return t&&t.state?(n=t.state,e<0?(i=0,e=-e):(i=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?P:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=i,n.wbits=e,s(t))):P}function l(t,e){var i,n;return t?(n=new o,t.state=n,n.window=null,i=a(t,e),i!==T&&(t.state=null),i):P}function p(t){return l(t,vt)}function d(t){if(bt){var e;for(g=new v.Buf32(512),m=new v.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(k(x,t.lens,0,288,g,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;k(U,t.lens,0,32,m,0,t.work,{bits:5}),bt=!1}t.lencode=g,t.lenbits=9,t.distcode=m,t.distbits=5}function c(t,e,i,n){var o,r=t.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new v.Buf8(r.wsize)),n>=r.wsize?(v.arraySet(r.window,e,i-r.wsize,r.wsize,0),r.wnext=0,r.whave=r.wsize):(o=r.wsize-r.wnext,o>n&&(o=n),v.arraySet(r.window,e,i-n,o,r.wnext),n-=o,n?(v.arraySet(r.window,e,i-n,n,0),r.wnext=n,r.whave=r.wsize):(r.wnext+=o,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=o))),0}function u(t,e){var i,o,r,s,a,l,p,u,h,f,_,g,m,_t,gt,mt,vt,bt,yt,wt,kt,$t,xt,Ut,Et=0,St=new v.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return P;i=t.state,i.mode===Q&&(i.mode=J),a=t.next_out,r=t.output,p=t.avail_out,s=t.next_in,o=t.input,l=t.avail_in,u=i.hold,h=i.bits,f=l,_=p,$t=T;t:for(;;)switch(i.mode){case A:if(0===i.wrap){i.mode=J;break}for(;h<16;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(2&i.wrap&&35615===u){i.check=0,St[0]=255&u,St[1]=u>>>8&255,i.check=y(i.check,St,2,0),u=0,h=0,i.mode=L;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",i.mode=ut;break}if((15&u)!==D){t.msg="unknown compression method",i.mode=ut;break}if(u>>>=4,h-=4,kt=(15&u)+8,0===i.wbits)i.wbits=kt;else if(kt>i.wbits){t.msg="invalid window size",i.mode=ut;break}i.dmax=1<<kt,t.adler=i.check=1,i.mode=512&u?q:Q,u=0,h=0;break;case L:for(;h<16;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(i.flags=u,(255&i.flags)!==D){t.msg="unknown compression method",i.mode=ut;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=ut;break}i.head&&(i.head.text=u>>8&1),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,i.check=y(i.check,St,2,0)),u=0,h=0,i.mode=N;case N:for(;h<32;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}i.head&&(i.head.time=u),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,St[2]=u>>>16&255,St[3]=u>>>24&255,i.check=y(i.check,St,4,0)),u=0,h=0,i.mode=V;case V:for(;h<16;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}i.head&&(i.head.xflags=255&u,i.head.os=u>>8),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,i.check=y(i.check,St,2,0)),u=0,h=0,i.mode=B;case B:if(1024&i.flags){for(;h<16;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}i.length=u,i.head&&(i.head.extra_len=u),512&i.flags&&(St[0]=255&u,St[1]=u>>>8&255,i.check=y(i.check,St,2,0)),u=0,h=0}else i.head&&(i.head.extra=null);i.mode=R;case R:if(1024&i.flags&&(g=i.length,g>l&&(g=l),g&&(i.head&&(kt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),v.arraySet(i.head.extra,o,s,g,kt)),512&i.flags&&(i.check=y(i.check,o,g,s)),l-=g,s+=g,i.length-=g),i.length))break t;i.length=0,i.mode=F;case F:if(2048&i.flags){if(0===l)break t;g=0;do kt=o[s+g++],i.head&&kt&&i.length<65536&&(i.head.name+=String.fromCharCode(kt));while(kt&&g<l);if(512&i.flags&&(i.check=y(i.check,o,g,s)),l-=g,s+=g,kt)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=H;case H:if(4096&i.flags){if(0===l)break t;g=0;do kt=o[s+g++],i.head&&kt&&i.length<65536&&(i.head.comment+=String.fromCharCode(kt));while(kt&&g<l);if(512&i.flags&&(i.check=y(i.check,o,g,s)),l-=g,s+=g,kt)break t}else i.head&&(i.head.comment=null);i.mode=W;case W:if(512&i.flags){for(;h<16;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(u!==(65535&i.check)){t.msg="header crc mismatch",i.mode=ut;break}u=0,h=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=Q;break;case q:for(;h<32;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}t.adler=i.check=n(u),u=0,h=0,i.mode=G;case G:if(0===i.havedict)return t.next_out=a,t.avail_out=p,t.next_in=s,t.avail_in=l,i.hold=u,i.bits=h,I;t.adler=i.check=1,i.mode=Q;case Q:if(e===S||e===C)break t;case J:if(i.last){u>>>=7&h,h-=7&h,i.mode=pt;break}for(;h<3;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}switch(i.last=1&u,u>>>=1,h-=1,3&u){case 0:i.mode=Y;break;case 1:if(d(i),i.mode=it,e===C){u>>>=2,h-=2;break t}break;case 2:i.mode=Z;break;case 3:t.msg="invalid block type",i.mode=ut}u>>>=2,h-=2;break;case Y:for(u>>>=7&h,h-=7&h;h<32;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if((65535&u)!==(u>>>16^65535)){t.msg="invalid stored block lengths",i.mode=ut;break}if(i.length=65535&u,u=0,h=0,i.mode=X,e===C)break t;case X:i.mode=K;case K:if(g=i.length){if(g>l&&(g=l),g>p&&(g=p),0===g)break t;v.arraySet(r,o,s,g,a),l-=g,s+=g,p-=g,a+=g,i.length-=g;break}i.mode=Q;break;case Z:for(;h<14;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(i.nlen=(31&u)+257,u>>>=5,h-=5,i.ndist=(31&u)+1,u>>>=5,h-=5,i.ncode=(15&u)+4,u>>>=4,h-=4,i.nlen>286||i.ndist>30){t.msg="too many length or distance symbols",i.mode=ut;break}i.have=0,i.mode=tt;case tt:for(;i.have<i.ncode;){for(;h<3;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}i.lens[Ct[i.have++]]=7&u,u>>>=3,h-=3}for(;i.have<19;)i.lens[Ct[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,xt={bits:i.lenbits},$t=k($,i.lens,0,19,i.lencode,0,i.work,xt),i.lenbits=xt.bits,$t){t.msg="invalid code lengths set",i.mode=ut;break}i.have=0,i.mode=et;case et:for(;i.have<i.nlen+i.ndist;){for(;Et=i.lencode[u&(1<<i.lenbits)-1],gt=Et>>>24,mt=Et>>>16&255,vt=65535&Et,!(gt<=h);){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(vt<16)u>>>=gt,h-=gt,i.lens[i.have++]=vt;else{if(16===vt){for(Ut=gt+2;h<Ut;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(u>>>=gt,h-=gt,0===i.have){t.msg="invalid bit length repeat",i.mode=ut;break}kt=i.lens[i.have-1],g=3+(3&u),u>>>=2,h-=2}else if(17===vt){for(Ut=gt+3;h<Ut;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}u>>>=gt,h-=gt,kt=0,g=3+(7&u),u>>>=3,h-=3}else{for(Ut=gt+7;h<Ut;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}u>>>=gt,h-=gt,kt=0,g=11+(127&u),u>>>=7,h-=7}if(i.have+g>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=ut;break}for(;g--;)i.lens[i.have++]=kt}}if(i.mode===ut)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=ut;break}if(i.lenbits=9,xt={bits:i.lenbits},$t=k(x,i.lens,0,i.nlen,i.lencode,0,i.work,xt),i.lenbits=xt.bits,$t){t.msg="invalid literal/lengths set",i.mode=ut;break}if(i.distbits=6,i.distcode=i.distdyn,
xt={bits:i.distbits},$t=k(U,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,xt),i.distbits=xt.bits,$t){t.msg="invalid distances set",i.mode=ut;break}if(i.mode=it,e===C)break t;case it:i.mode=nt;case nt:if(l>=6&&p>=258){t.next_out=a,t.avail_out=p,t.next_in=s,t.avail_in=l,i.hold=u,i.bits=h,w(t,_),a=t.next_out,r=t.output,p=t.avail_out,s=t.next_in,o=t.input,l=t.avail_in,u=i.hold,h=i.bits,i.mode===Q&&(i.back=-1);break}for(i.back=0;Et=i.lencode[u&(1<<i.lenbits)-1],gt=Et>>>24,mt=Et>>>16&255,vt=65535&Et,!(gt<=h);){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(mt&&0===(240&mt)){for(bt=gt,yt=mt,wt=vt;Et=i.lencode[wt+((u&(1<<bt+yt)-1)>>bt)],gt=Et>>>24,mt=Et>>>16&255,vt=65535&Et,!(bt+gt<=h);){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}u>>>=bt,h-=bt,i.back+=bt}if(u>>>=gt,h-=gt,i.back+=gt,i.length=vt,0===mt){i.mode=lt;break}if(32&mt){i.back=-1,i.mode=Q;break}if(64&mt){t.msg="invalid literal/length code",i.mode=ut;break}i.extra=15&mt,i.mode=ot;case ot:if(i.extra){for(Ut=i.extra;h<Ut;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}i.length+=u&(1<<i.extra)-1,u>>>=i.extra,h-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=rt;case rt:for(;Et=i.distcode[u&(1<<i.distbits)-1],gt=Et>>>24,mt=Et>>>16&255,vt=65535&Et,!(gt<=h);){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(0===(240&mt)){for(bt=gt,yt=mt,wt=vt;Et=i.distcode[wt+((u&(1<<bt+yt)-1)>>bt)],gt=Et>>>24,mt=Et>>>16&255,vt=65535&Et,!(bt+gt<=h);){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}u>>>=bt,h-=bt,i.back+=bt}if(u>>>=gt,h-=gt,i.back+=gt,64&mt){t.msg="invalid distance code",i.mode=ut;break}i.offset=vt,i.extra=15&mt,i.mode=st;case st:if(i.extra){for(Ut=i.extra;h<Ut;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}i.offset+=u&(1<<i.extra)-1,u>>>=i.extra,h-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=ut;break}i.mode=at;case at:if(0===p)break t;if(g=_-p,i.offset>g){if(g=i.offset-g,g>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=ut;break}g>i.wnext?(g-=i.wnext,m=i.wsize-g):m=i.wnext-g,g>i.length&&(g=i.length),_t=i.window}else _t=r,m=a-i.offset,g=i.length;g>p&&(g=p),p-=g,i.length-=g;do r[a++]=_t[m++];while(--g);0===i.length&&(i.mode=nt);break;case lt:if(0===p)break t;r[a++]=i.length,p--,i.mode=nt;break;case pt:if(i.wrap){for(;h<32;){if(0===l)break t;l--,u|=o[s++]<<h,h+=8}if(_-=p,t.total_out+=_,i.total+=_,_&&(t.adler=i.check=i.flags?y(i.check,r,_,a-_):b(i.check,r,_,a-_)),_=p,(i.flags?u:n(u))!==i.check){t.msg="incorrect data check",i.mode=ut;break}u=0,h=0}i.mode=dt;case dt:if(i.wrap&&i.flags){for(;h<32;){if(0===l)break t;l--,u+=o[s++]<<h,h+=8}if(u!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=ut;break}u=0,h=0}i.mode=ct;case ct:$t=z;break t;case ut:$t=M;break t;case ht:return j;case ft:default:return P}return t.next_out=a,t.avail_out=p,t.next_in=s,t.avail_in=l,i.hold=u,i.bits=h,(i.wsize||_!==t.avail_out&&i.mode<ut&&(i.mode<pt||e!==E))&&c(t,t.output,t.next_out,_-t.avail_out)?(i.mode=ht,j):(f-=t.avail_in,_-=t.avail_out,t.total_in+=f,t.total_out+=_,i.total+=_,i.wrap&&_&&(t.adler=i.check=i.flags?y(i.check,r,_,t.next_out-_):b(i.check,r,_,t.next_out-_)),t.data_type=i.bits+(i.last?64:0)+(i.mode===Q?128:0)+(i.mode===it||i.mode===X?256:0),(0===f&&0===_||e===E)&&$t===T&&($t=O),$t)}function h(t){if(!t||!t.state)return P;var e=t.state;return e.window&&(e.window=null),t.state=null,T}function f(t,e){var i;return t&&t.state?(i=t.state,0===(2&i.wrap)?P:(i.head=e,e.done=!1,T)):P}function _(t,e){var i,n,o,r=e.length;return t&&t.state?(i=t.state,0!==i.wrap&&i.mode!==G?P:i.mode===G&&(n=1,n=b(n,e,r,0),n!==i.check)?M:(o=c(t,e,r,r))?(i.mode=ht,j):(i.havedict=1,T)):P}var g,m,v=t("../utils/common"),b=t("./adler32"),y=t("./crc32"),w=t("./inffast"),k=t("./inftrees"),$=0,x=1,U=2,E=4,S=5,C=6,T=0,z=1,I=2,P=-2,M=-3,j=-4,O=-5,D=8,A=1,L=2,N=3,V=4,B=5,R=6,F=7,H=8,W=9,q=10,G=11,Q=12,J=13,Y=14,X=15,K=16,Z=17,tt=18,et=19,it=20,nt=21,ot=22,rt=23,st=24,at=25,lt=26,pt=27,dt=28,ct=29,ut=30,ht=31,ft=32,_t=852,gt=592,mt=15,vt=mt,bt=!0;i.inflateReset=s,i.inflateReset2=a,i.inflateResetKeep=r,i.inflateInit=p,i.inflateInit2=l,i.inflate=u,i.inflateEnd=h,i.inflateGetHeader=f,i.inflateSetDictionary=_,i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(t,e,i){"use strict";var n=t("../utils/common"),o=15,r=852,s=592,a=0,l=1,p=2,d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],u=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,f,_,g,m,v){var b,y,w,k,$,x,U,E,S,C=v.bits,T=0,z=0,I=0,P=0,M=0,j=0,O=0,D=0,A=0,L=0,N=null,V=0,B=new n.Buf16(o+1),R=new n.Buf16(o+1),F=null,H=0;for(T=0;T<=o;T++)B[T]=0;for(z=0;z<f;z++)B[e[i+z]]++;for(M=C,P=o;P>=1&&0===B[P];P--);if(M>P&&(M=P),0===P)return _[g++]=20971520,_[g++]=20971520,v.bits=1,0;for(I=1;I<P&&0===B[I];I++);for(M<I&&(M=I),D=1,T=1;T<=o;T++)if(D<<=1,D-=B[T],D<0)return-1;if(D>0&&(t===a||1!==P))return-1;for(R[1]=0,T=1;T<o;T++)R[T+1]=R[T]+B[T];for(z=0;z<f;z++)0!==e[i+z]&&(m[R[e[i+z]]++]=z);if(t===a?(N=F=m,x=19):t===l?(N=d,V-=257,F=c,H-=257,x=256):(N=u,F=h,x=-1),L=0,z=0,T=I,$=g,j=M,O=0,w=-1,A=1<<M,k=A-1,t===l&&A>r||t===p&&A>s)return 1;for(var W=0;;){W++,U=T-O,m[z]<x?(E=0,S=m[z]):m[z]>x?(E=F[H+m[z]],S=N[V+m[z]]):(E=96,S=0),b=1<<T-O,y=1<<j,I=y;do y-=b,_[$+(L>>O)+y]=U<<24|E<<16|S|0;while(0!==y);for(b=1<<T-1;L&b;)b>>=1;if(0!==b?(L&=b-1,L+=b):L=0,z++,0===--B[T]){if(T===P)break;T=e[i+m[z]]}if(T>M&&(L&k)!==w){for(0===O&&(O=M),$+=I,j=T-O,D=1<<j;j+O<P&&(D-=B[j+O],!(D<=0));)j++,D<<=1;if(A+=1<<j,t===l&&A>r||t===p&&A>s)return 1;w=L&k,_[w]=M<<24|j<<16|$-g|0}}return 0!==L&&(_[$+L]=T-O<<24|64<<16|0),v.bits=M,0}},{"../utils/common":3}],13:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(t,e,i){"use strict";function n(t){for(var e=t.length;--e>=0;)t[e]=0}function o(t,e,i,n,o){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=n,this.max_length=o,this.has_stree=t&&t.length}function r(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function s(t){return t<256?lt[t]:lt[256+(t>>>7)]}function a(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function l(t,e,i){t.bi_valid>J-i?(t.bi_buf|=e<<t.bi_valid&65535,a(t,t.bi_buf),t.bi_buf=e>>J-t.bi_valid,t.bi_valid+=i-J):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function p(t,e,i){l(t,i[2*e],i[2*e+1])}function d(t,e){var i=0;do i|=1&t,t>>>=1,i<<=1;while(--e>0);return i>>>1}function c(t){16===t.bi_valid?(a(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function u(t,e){var i,n,o,r,s,a,l=e.dyn_tree,p=e.max_code,d=e.stat_desc.static_tree,c=e.stat_desc.has_stree,u=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,f=e.stat_desc.max_length,_=0;for(r=0;r<=Q;r++)t.bl_count[r]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<G;i++)n=t.heap[i],r=l[2*l[2*n+1]+1]+1,r>f&&(r=f,_++),l[2*n+1]=r,n>p||(t.bl_count[r]++,s=0,n>=h&&(s=u[n-h]),a=l[2*n],t.opt_len+=a*(r+s),c&&(t.static_len+=a*(d[2*n+1]+s)));if(0!==_){do{for(r=f-1;0===t.bl_count[r];)r--;t.bl_count[r]--,t.bl_count[r+1]+=2,t.bl_count[f]--,_-=2}while(_>0);for(r=f;0!==r;r--)for(n=t.bl_count[r];0!==n;)o=t.heap[--i],o>p||(l[2*o+1]!==r&&(t.opt_len+=(r-l[2*o+1])*l[2*o],l[2*o+1]=r),n--)}}function h(t,e,i){var n,o,r=new Array(Q+1),s=0;for(n=1;n<=Q;n++)r[n]=s=s+i[n-1]<<1;for(o=0;o<=e;o++){var a=t[2*o+1];0!==a&&(t[2*o]=d(r[a]++,a))}}function f(){var t,e,i,n,r,s=new Array(Q+1);for(i=0,n=0;n<R-1;n++)for(dt[n]=i,t=0;t<1<<et[n];t++)pt[i++]=n;for(pt[i-1]=n,r=0,n=0;n<16;n++)for(ct[n]=r,t=0;t<1<<it[n];t++)lt[r++]=n;for(r>>=7;n<W;n++)for(ct[n]=r<<7,t=0;t<1<<it[n]-7;t++)lt[256+r++]=n;for(e=0;e<=Q;e++)s[e]=0;for(t=0;t<=143;)st[2*t+1]=8,t++,s[8]++;for(;t<=255;)st[2*t+1]=9,t++,s[9]++;for(;t<=279;)st[2*t+1]=7,t++,s[7]++;for(;t<=287;)st[2*t+1]=8,t++,s[8]++;for(h(st,H+1,s),t=0;t<W;t++)at[2*t+1]=5,at[2*t]=d(t,5);ut=new o(st,et,F+1,H,Q),ht=new o(at,it,0,W,Q),ft=new o(new Array(0),nt,0,q,Y)}function _(t){var e;for(e=0;e<H;e++)t.dyn_ltree[2*e]=0;for(e=0;e<W;e++)t.dyn_dtree[2*e]=0;for(e=0;e<q;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*X]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function g(t){t.bi_valid>8?a(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function m(t,e,i,n){g(t),n&&(a(t,i),a(t,~i)),P.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}function v(t,e,i,n){var o=2*e,r=2*i;return t[o]<t[r]||t[o]===t[r]&&n[e]<=n[i]}function b(t,e,i){for(var n=t.heap[i],o=i<<1;o<=t.heap_len&&(o<t.heap_len&&v(e,t.heap[o+1],t.heap[o],t.depth)&&o++,!v(e,n,t.heap[o],t.depth));)t.heap[i]=t.heap[o],i=o,o<<=1;t.heap[i]=n}function y(t,e,i){var n,o,r,a,d=0;if(0!==t.last_lit)do n=t.pending_buf[t.d_buf+2*d]<<8|t.pending_buf[t.d_buf+2*d+1],o=t.pending_buf[t.l_buf+d],d++,0===n?p(t,o,e):(r=pt[o],p(t,r+F+1,e),a=et[r],0!==a&&(o-=dt[r],l(t,o,a)),n--,r=s(n),p(t,r,i),a=it[r],0!==a&&(n-=ct[r],l(t,n,a)));while(d<t.last_lit);p(t,X,e)}function w(t,e){var i,n,o,r=e.dyn_tree,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,p=-1;for(t.heap_len=0,t.heap_max=G,i=0;i<l;i++)0!==r[2*i]?(t.heap[++t.heap_len]=p=i,t.depth[i]=0):r[2*i+1]=0;for(;t.heap_len<2;)o=t.heap[++t.heap_len]=p<2?++p:0,r[2*o]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=s[2*o+1]);for(e.max_code=p,i=t.heap_len>>1;i>=1;i--)b(t,r,i);o=l;do i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],b(t,r,1),n=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=n,r[2*o]=r[2*i]+r[2*n],t.depth[o]=(t.depth[i]>=t.depth[n]?t.depth[i]:t.depth[n])+1,r[2*i+1]=r[2*n+1]=o,t.heap[1]=o++,b(t,r,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],u(t,e),h(r,p,t.bl_count)}function k(t,e,i){var n,o,r=-1,s=e[1],a=0,l=7,p=4;for(0===s&&(l=138,p=3),e[2*(i+1)+1]=65535,n=0;n<=i;n++)o=s,s=e[2*(n+1)+1],++a<l&&o===s||(a<p?t.bl_tree[2*o]+=a:0!==o?(o!==r&&t.bl_tree[2*o]++,t.bl_tree[2*K]++):a<=10?t.bl_tree[2*Z]++:t.bl_tree[2*tt]++,a=0,r=o,0===s?(l=138,p=3):o===s?(l=6,p=3):(l=7,p=4))}function $(t,e,i){var n,o,r=-1,s=e[1],a=0,d=7,c=4;for(0===s&&(d=138,c=3),n=0;n<=i;n++)if(o=s,s=e[2*(n+1)+1],!(++a<d&&o===s)){if(a<c){do p(t,o,t.bl_tree);while(0!==--a)}else 0!==o?(o!==r&&(p(t,o,t.bl_tree),a--),p(t,K,t.bl_tree),l(t,a-3,2)):a<=10?(p(t,Z,t.bl_tree),l(t,a-3,3)):(p(t,tt,t.bl_tree),l(t,a-11,7));a=0,r=o,0===s?(d=138,c=3):o===s?(d=6,c=3):(d=7,c=4)}}function x(t){var e;for(k(t,t.dyn_ltree,t.l_desc.max_code),k(t,t.dyn_dtree,t.d_desc.max_code),w(t,t.bl_desc),e=q-1;e>=3&&0===t.bl_tree[2*ot[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function U(t,e,i,n){var o;for(l(t,e-257,5),l(t,i-1,5),l(t,n-4,4),o=0;o<n;o++)l(t,t.bl_tree[2*ot[o]+1],3);$(t,t.dyn_ltree,e-1),$(t,t.dyn_dtree,i-1)}function E(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return j;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return O;for(e=32;e<F;e++)if(0!==t.dyn_ltree[2*e])return O;return j}function S(t){_t||(f(),_t=!0),t.l_desc=new r(t.dyn_ltree,ut),t.d_desc=new r(t.dyn_dtree,ht),t.bl_desc=new r(t.bl_tree,ft),t.bi_buf=0,t.bi_valid=0,_(t)}function C(t,e,i,n){l(t,(A<<1)+(n?1:0),3),m(t,e,i,!0)}function T(t){l(t,L<<1,3),p(t,X,st),c(t)}function z(t,e,i,n){var o,r,s=0;t.level>0?(t.strm.data_type===D&&(t.strm.data_type=E(t)),w(t,t.l_desc),w(t,t.d_desc),s=x(t),o=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=o&&(o=r)):o=r=i+5,i+4<=o&&e!==-1?C(t,e,i,n):t.strategy===M||r===o?(l(t,(L<<1)+(n?1:0),3),y(t,st,at)):(l(t,(N<<1)+(n?1:0),3),U(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),y(t,t.dyn_ltree,t.dyn_dtree)),_(t),n&&g(t)}function I(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(pt[i]+F+1)]++,t.dyn_dtree[2*s(e)]++),t.last_lit===t.lit_bufsize-1}var P=t("../utils/common"),M=4,j=0,O=1,D=2,A=0,L=1,N=2,V=3,B=258,R=29,F=256,H=F+1+R,W=30,q=19,G=2*H+1,Q=15,J=16,Y=7,X=256,K=16,Z=17,tt=18,et=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],it=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],nt=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ot=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],rt=512,st=new Array(2*(H+2));n(st);var at=new Array(2*W);n(at);var lt=new Array(rt);n(lt);var pt=new Array(B-V+1);n(pt);var dt=new Array(R);n(dt);var ct=new Array(W);n(ct);var ut,ht,ft,_t=!1;i._tr_init=S,i._tr_stored_block=C,i._tr_flush_block=z,i._tr_tally=I,i._tr_align=T},{"../utils/common":3}],15:[function(t,e,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}],"/":[function(t,e,i){"use strict";var n=t("./lib/utils/common").assign,o=t("./lib/deflate"),r=t("./lib/inflate"),s=t("./lib/zlib/constants"),a={};n(a,o,r,s),e.exports=a},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}),function(t){window.empty=function(t){return"undefined"==typeof t||!t},window.count=function(t){return"undefined"==typeof t?0:t&&t.length?t.length:0},_.mixin({isTrue:function(t){return"undefined"!=typeof t&&(_.isString(t)?"true"===t.toLowerCase():_.isNumber(t)?0!==t:void 0)}});var e=function(t){var e=(new Date).getTime(),i=Math.max(0,16-(e-lastTime)),n=setTimeout(function(){t(e+i)},i);return lastTime=e+i,n};define("util",["pako"],function(i){var n=function(e){return t.trim(e)&&"#"!=t.trim(e)&&""!==t.trim(e)?e.length&&"#"==e[0]?e.indexOf("#ltb-")>-1?"lightbox":"anchor":"undefined"!=typeof window.location.origin&&e.substring(0,window.location.origin.length)==window.location.origin?"undefined"!=typeof window.location.pathname&&e.substring(window.location.origin.length,window.location.origin.length+window.location.pathname.length)==window.location.pathname&&"#"==e.substring(window.location.origin.length+window.location.pathname.length)[0]?"anchor":"entry":e.match(/^mailto/)?"email":e.match(/^tel/)?"phone":"external":"unlink"},o={isRTL:function(){return!!Upfront.mainData.isRTL},model_to_json:function(t){if(!t)return{};var e=t&&t.toJSON?t.toJSON():t,i=JSON.stringify(e),n=JSON.parse(i);return n},get_unique_id:function(t){return _.template("{{prefix}}-{{stamp}}-{{numeric}}",{prefix:t||"entity",stamp:(new Date).getTime(),numeric:Math.floor(999*Math.random()+1e3)})},log:function(){var t=["[UPFRONT]: "].concat(arguments);console.log.apply(console,t)},dbg:function(){Upfront.Util.log(JSON.stringify(arguments[0]))},clone:function(t){return jQuery.extend(!0,{},t)},preg_quote:function(t){var e=/[|\\{}()[\]^$+*?.]/g;if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(e,"\\$&")},css_support:function(t){var e=document.createElement("div"),i=new RegExp("(khtml|moz|ms|webkit|)"+t,"i");for(var n in e.style)if(n.match(i))return!0;return!1},post:function(e,i){var n=_.isObject(e)&&e.action?e:{action:"upfront_request",data:e};return Upfront.Application.current_subapplication.layout&&(n.layout=Upfront.Application.current_subapplication.layout.get("layout")),Upfront.layout_data_from_create_layout&&n.data&&"fake_post"===n.data.post_id&&!n.layout&&(n.layout=Upfront.layout_data_from_create_layout,Upfront.layout_data_from_create_layout=!1),n.storage_key||(n.storage_key=_upfront_storage_key),n.stylesheet=_upfront_stylesheet,n.mode=Upfront.Application.get_current(),n.dev=location.search.indexOf("dev=true")>-1,n.isbuilder=Upfront.Application.is_builder(),t.post(Upfront.Settings.ajax_url,n,function(){},i?i:"json")},is_able_to_debug:function(){return!!Upfront.Settings.Application.PERMS.DEBUG||(Upfront.Util.log("This user doesn't have enough permissions to debug or reset"),!1)},reset_layout:function(){if(!this.is_able_to_debug())return!1;var t={action:"upfront_reset_layout"};return this.post(t)},reset_cache:function(){if(!this.is_able_to_debug())return!1;var t={action:"upfront_reset_cache"};return this.post(t)},reset_all:function(){if(!this.is_able_to_debug())return!1;var t={action:"upfront_reset_all_from_db"};return this.post(t)},format_date:function(t,e,i){if(!t||!t.getFullYear){if(t&&t.length){var n=t;if(t=new Date(Date.parse(t)),!t)return n}if(!t||!t.getFullYear)return t}var o=t.getFullYear()+"/",r=t.getDate(),s=t.getMonth()+1;if(r<10&&(r="0"+r),s<10&&(s="0"+s),o+=s+"/"+r,e){var a=t.getHours(),l=t.getMinutes();if(o+=" "+(a<10?"0":"")+a+":"+(l<10?"0":"")+l,i){var p=t.getSeconds();o+=":"+(p<10?"0":"")+p}}return o},get_avatar:function(t,e){var i=window.location.href.split("//"),n=i[0]+"//www.gravatar.com/avatar/",o="";if(e=e&&parseInt(e,10)==e?e:32,_.isString(t))o=t;else{if(!(t instanceof Upfront.Models.User||t instanceof Upfront.Models.Comment))return!1;o=t.get("gravatar")}return n+o+"?d=mm&s="+e},grid:{update_class:function(t,e,i){var n;_.isUndefined(i)?(i=(e||"").replace(/[^\d.]/g,""),n=e.replace(i,"")):n=e;var o=new RegExp("\\b"+n+"\\d+");t.hasClass(n+i)||(t.attr("class").match(o)?t.attr("class",t.attr("class").replace(o,n+i)):t.addClass(n+i))},col_to_width:function(t){if(!t)return 0;var e=Upfront.Settings.LayoutEditor.Grid.column_width,i=Upfront.Settings.LayoutEditor.Grid.class;return parseInt(t.replace(i,""),10)*e},width_to_col:function(t,e){if(e="undefined"!=typeof e&&e,t=parseInt(t,10),t<0)return 0;var i=Upfront.Settings.LayoutEditor.Grid.column_width;return Math[e?"ceil":"floor"](t/i)},height_to_row:function(t){var e=Upfront.Settings.LayoutEditor.Grid.baseline;return Math.ceil(t/e)},normalize_width:function(t){return this.width_to_col(t)*Upfront.Settings.LayoutEditor.Grid.column_width},normalize_height:function(t){return this.height_to_row(t)*Upfront.Settings.LayoutEditor.Grid.baseline},derive_from_classes:function(t,e){if(!t||t.length<2||!e)return!1;var i=new RegExp("("+e+"\\d+(d)*)","g"),n=t.match(i);return!_.isEmpty(n)&&n[0]},derive_column_class:function(t){return this.derive_from_classes(t,"c")},derive_margintop_class:function(t){return this.derive_from_classes(t,"mt")},derive_marginleft_class:function(t){return this.derive_from_classes(t,"ml")}},width_to_col:function(t){return this.grid.width_to_col(t)},height_to_row:function(t){return this.grid.height_to_row(t)},openLightboxRegion:function(t){var e=Upfront.Application.layout.get("regions"),i=e.get_by_name(t);i&&(_.each(e.models,function(t){"lightbox"==t.attributes.sub&&Upfront.data.region_views[t.cid].hide()}),Upfront.data.region_views[i.cid].show())},find_sorted:function(t,e){return t.find(e).each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb)},sort_elements_cb:function(e,i){var n=t(e).data("breakpoint_order"),o=t(i).data("breakpoint_order");return _.isNumber(n)||(n=t(e).data("dom_order")),_.isNumber(o)||(o=t(i).data("dom_order")),n>o?1:-1},normalize_sort_elements_cb:function(e){t(this).data("dom_order",e)},find_from_elements:function(e,i,n,o,r){var s=e.index(t(i)),a=o?_.first(e,s).reverse():_.rest(e,s+1),l=!1,p=n&&_.isFunction(n),d=r&&_.isFunction(r);return t(_.filter(a,function(i){return!l&&(!!(p&&n(t(i),e)||!p&&t(i).is(n))&&(!r||!(d&&r(t(i),e)||!d&&t(i).is(r))||(l=!0,!1)))}))},requestAnimationFrame:t.proxy(window.requestAnimationFrame,window)||t.proxy(window.webkitRequestAnimationFrame,window)||t.proxy(window.mozRequestAnimationFrame,window)||t.proxy(window.oRequestAnimationFrame,window)||t.proxy(window.msRequestAnimationFrame,window)||e,template:function(t){var e=_.templateSettings,i=!1;return _.templateSettings={interpolate:/<\?php echo (.+?) \?>/g,evaluate:/<\?php (.+?) \?>/g},i=_.template(t),_.templateSettings=e,function(t){return _.each(t,function(e,i){t["$"+i]=e}),i(t)}},Transient:{_memory_queue:{},_key:window.location.path+window.location.search,initialize:function(){Upfront.Settings.Debug.transients||(this._memory_queue[this._key]=JSON.stringify({}))},get_current:function(){return this._memory_queue[this._key]?JSON.parse(this._memory_queue[this._key]):{}},length:function(t){var e=this.get(t);return e.length},set:function(t,e){var i=this.get_current();i[t]=o.model_to_json(e),this._memory_queue[this._key]=JSON.stringify(i)},get:function(t){var e=this.get_current(),i=e[t]||!1;return i},get_all:function(t){var e=!!t&&new RegExp(t),i=[],n=!!this._memory_queue[this._key]&&JSON.parse(this._memory_queue[this._key]);return n&&_(n).each(function(t,n){return!(!e||n.match(e))||void(i=t)}),i},push:function(t,e){var i=this.get(t)||[];return i.push(e),this.set(t,i)},pop:function(t){var e=this.get(t)||[],i=!(!e||!e.pop)&&e.pop();return this.set(t,e),i}},date:{php_format_to_jquery:function(t){var e={d:"dd",D:"D",j:"d",l:"DD",N:"",S:"",w:"",z:"o",W:"",F:"MM",m:"mm",M:"M",n:"m",t:"",L:"",o:"",Y:"yy",y:"y",a:"",A:"",B:"",g:"",G:"",h:"",H:"",i:"",s:"",u:""};jqueryui_format="",escaping=!1;for(var i=0;i<t.length;i++){var n=t[i];"\\"===n?(i++,escaping?jqueryui_format+=t[i]:jqueryui_format+="'"+t[i],escaping=!0):(escaping&&(jqueryui_format+="'",escaping=!1),_.isUndefined(e[n])?jqueryui_format+=n:jqueryui_format+=e[n])}return jqueryui_format},php_format_to_js:function(t){var e={d:"dd",D:"D",j:"d",l:"DD",N:"",S:"",w:"",z:"o",W:"",F:"MMMM",m:"mmmm",M:"M",n:"m",t:"",L:"",o:"",Y:"yyyy",y:"y",a:"",A:"",B:"",g:"",G:"",h:"",H:"",i:"",s:"",u:""};jqueryui_format="",escaping=!1;for(var i=0;i<t.length;i++){var n=t[i];"\\"===n?(i++,escaping?jqueryui_format+=t[i]:jqueryui_format+="'"+t[i],escaping=!0):(escaping&&(jqueryui_format+="'",escaping=!1),_.isUndefined(e[n])?jqueryui_format+=n:jqueryui_format+=e[n])}return jqueryui_format}},colors:{to_color_value:function(t){return Upfront.Util.colors.is_theme_color(t)?Upfront.Util.colors.get_color(t):t},is_theme_color:function(t){return!(!t||!t.match)&&!!t.match(/^#?ufc\d+$/)},get_ufc:function(t){if(_.isEmpty(t))return!1;t=tinycolor(t);var e,i=Upfront.Views.Theme_Colors.colors.pluck("color");for(var n in i)i[n].replace("#","")===t.toHex()&&(e="ufc"+n);return e},get_color:function(t){if(_.isEmpty(t))return!1;var e=Upfront.Views.Theme_Colors.colors.pluck("color"),i=Upfront.Views.Theme_Colors.colors.pluck("alpha"),n=parseInt(t.replace("ufc","").replace("#",""),10),o="#000000"===e[n]&&0===i[n]?"inherit":e[n];return o},convert_string_ufc_to_color:function(t,e){if(_.isEmpty(t))return t;e="undefined"==typeof e||e;var i=Upfront.Views.Theme_Colors.colors.pluck("color"),n=Upfront.Views.Theme_Colors.colors.pluck("alpha"),o=new RegExp("/\\*[^,;\\n]*#ufc(\\d*)\\*/[^,;\\n]*([\\*/]*((#[A-Fa-f0-9]+)+|(rgb[a]?[^\\)]*\\))))+","g");t=t.replace(o,"#ufc$1");for(var r in i){var s="#000000"===i[r]&&0===n[r]?"inherit":i[r],a=new RegExp("#ufc"+r,"g");s=e?"/*#ufc"+r+"*/"+s:s,t=t.replace(a,s)}return t},remove_ufcs:function(t){var e=Upfront.Views.Theme_Colors.colors.pluck("color");for(var i in e){var n=new RegExp("/\\*#ufc"+i+"\\*/"+e[i],"g"),o=e[i];t=t.replace(n,o)}return t},convert_string_color_to_ufc:function(t){var e=Upfront.Views.Theme_Colors.colors.pluck("color");for(var i in e){var n=new RegExp("/\\*#ufc"+i+"\\*/"+e[i],"gi"),o="#ufc"+i;t=t.replace(n,o)}return t},update_colors_in_dom:function(e,i,n){var o=new RegExp("/\\*#ufc"+n+"\\*/#(?:[0-9a-fA-F]{3}){1,2}","gi"),r=document.getElementsByTagName("html")[0],s="/*#ufc"+n+"*/"+i,a=findAndReplaceDOMText(r,{find:o,replace:function(t,e){return s}});t(".upfront-plain_txt > p").each(function(){var e=t(this),i=e.html();e.html(i.replace(o,s))});var l=t("*").filter(function(){return t(this).data("ufc")});return t(l).each(function(){var e=t(this),i=e.data("ufc"),n=e.data("ufc_rule");e.css(n,i)}),a},update_colors_to_match_ufc:function(t){var e=Upfront.Views.Theme_Colors.colors.pluck("color");for(var i in e){var n=new RegExp("/\\*#ufc"+i+"\\*/#(?:[0-9a-fA-F]{3}){1,2}","gi"),o="/*#ufc"+i+"*/"+e[i];t=t.replace(n,o)}return t},rgba_to_rgb:function(t){return _.isString(t)?t.replace(/ /g,"").replace(/^rgba\((\d+)\,(\d+)\,(\d+)\,(\d+\.?\d{0,}?)\)$/,"rgb($1, $2, $3)"):t}},guessLinkType:n,visitLink:function(e){var i,o,r,s,a=n(e);"lightbox"===a?(i=Upfront.Application.layout.get("regions"),o=!!i&&i.get_by_name(e.substring(1)),o&&(_.each(i.models,function(t){"lightbox"==t.attributes.sub&&Upfront.data.region_views[t.cid].hide()}),r=Upfront.data.region_views[o.cid],r.show())):"anchor"==a?(s=e.replace(/^.*?#/,"#"),t(s).length>0?t("html,body").animate({scrollTop:t(s).offset().top},"slow"):console.log("obselete anchor")):"entry"==a?window.location.href=e.replace("&editmode=true","").replace("editmode=true","")+(e.indexOf("?")>0?"&editmode=true":"?editmode=true"):window.open(e)},checkLightbox:function(t){return regions=Upfront.Application.layout.get("regions"),lightbox=!!regions&&regions.get_by_name(t.substring(1)),!!lightbox},compress:function(t,e){console.time("compressing");var n,o,r,s={to:"string",level:Upfront.mainData.save_compression_level};return e=_.isObject(e)?_.extend(s,e):s,n=JSON.stringify(t),o=i.deflateRaw(n,e),r=btoa(o),console.log("compressed length:"+r.length,"compressed ratio:"+Math.round(r.length/n.length*100)/100),console.timeEnd("compressing"),{result:r,original_length:n.length,compressed_length:r.length}},extract:function(t,e,n,o){if(console.time("extracting"),n&&n!==t.length)return!1;var r,s,a,l={to:"string"};return e=_.isObject(e)?_.extend(l,e):l,r=atob(t),s=i.inflateRaw(r,e),(!o||o===s.length)&&(a=JSON.parse(s),console.timeEnd("extracting"),a)}},r={$popup:{},$background:{},_deferred:{},init:function(){t("#upfront-popup").length?this.close():t("#page").append('<div id="upfront-popup" class="upfront-ui" style="display:none"><div id="upfront-popup-close" class="upfront-icon upfront-icon-popup-close">&times;</div><div class="upfront-popup-meta" id="upfront-popup-top"></div><div id="upfront-popup-content"></div><div class="upfront-popup-meta" id="upfront-popup-bottom"></div></div>').append("<div id='upfront-popup-background' style='display:none' />"),this.$popup=t("#upfront-popup"),this.$background=t("#upfront-popup-background"),this.$popup.find("#upfront-popup-content").empty()},open:function(e,i,n){i=i||{},this.data=i,this.disable_esc=i.disable_esc||!1,n=n||"default-popup",this.init();var o=this,r=t("#sidebar-ui").width(),s=t(window),a=i.width||630,l=((s.width()-a)/2+r/2,s.height()/3*2,function(){return t("#upfront-popup").attr("class","upfront-ui"),o.close(),!1});return this.disable_esc||t("body").bind("keyup",function(t){27===t.keyCode&&o.close()}),this.$background.on("click",l).show(),this.$popup.show().find("#upfront-popup-close").on("click",l).end(),n&&this.$popup.addClass(n).data("classname",n),t("body").addClass("upfront-popup-open"),e.apply(this.$popup.find("#upfront-popup-content").get(),[i,this.$popup.find("#upfront-popup-top"),this.$popup.find("#upfront-popup-bottom")]),this._deferred=new t.Deferred,this._deferred.promise()},close:function(e){this.data.hold_editor?this._deferred.notify("dont_close"):this._deferred.notify("before_close"),this.$background.hide(),this.$popup.hide().find("#upfront-popup-content").empty(),this.$popup.find("#upfront-popup-top").empty(),this.$popup.find("#upfront-popup-bottom").empty(),t("body").removeClass("upfront-popup-open");var i=this.$popup.data("classname");i&&this.$popup.removeClass(i),Upfront.Events.trigger("popup:closed"),this._deferred.resolve(this.$popup,e)}},s=function(){var t=!1,e=!1,i=!1,n=!1,o=!1,r=!1,s=!1,a=!1,l=!1,p=function(t,e){Upfront.Settings.Application.PERMS.REVISIONS&&(Upfront.Application.mode.current===Upfront.Application.MODE.THEME?d():(l=e,n=t,u())),window.onbeforeunload=m,window.unload=v},d=function(){Upfront.Events.off("entity:region:deactivated",c),Upfront.Events.off("entity:settings:deactivate",c),Upfront.Events.off("entity:removed:after",c),Upfront.Events.off("entity:resize_start",c),Upfront.Events.off("entity:drag_stop",c),Upfront.Events.off("entity:module:after_render",c),Upfront.Events.off("upfront:element:edit:stop",c),Upfront.Events.on("entity:region:deactivated",c,this),Upfront.Events.on("entity:settings:deactivate",c,this),Upfront.Events.on("entity:removed:after",c,this),Upfront.Events.on("entity:resize_start",c,this),Upfront.Events.on("entity:drag_stop",c,this),Upfront.Events.on("entity:module:after_render",c,this),Upfront.Events.on("upfront:element:edit:stop",c,this),Upfront.Events.off("command:layout:export_theme",g),Upfront.Events.on("command:layout:export_theme",g)},c=function(){r=!0},u=function(){Upfront.PreviewUpdate.__deferred_save_callback=Upfront.PreviewUpdate.__deferred_save_callback||_.debounce(f,200),Upfront.Events.off("entity:removed:after",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("entity:resize_start",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("entity:drag_stop",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("upfront:element:edit:stop",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.on("entity:removed:after",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("entity:resize_start",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("entity:drag_stop",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("upfront:element:edit:stop",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.off("model:property:add",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.off("model:property:set",Upfront.PreviewUpdate.__deferred_save_callback),Upfront.Events.on("model:property:add",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("model:property:set",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.off("entity:region:deactivated",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.on("entity:region:deactivated",Upfront.PreviewUpdate.__deferred_save_callback,this),Upfront.Events.off("command:layout:save_success",g),Upfront.Events.on("command:layout:save_success",g)},h=function(){t=Upfront.Util.model_to_json(n),t&&t.regions&&(t.regions=_(t.regions).reject(function(t){return"shadow"===t.name})),t.layout=_upfront_post_data.layout,t.preferred_layout=n.get("current_layout"),t.tab_id=l,Upfront.mainData.save_compression?(i=Upfront.Util.compress(t),t=i.result):t=JSON.stringify(t)},f=function(){return!o&&(o=!0,r=!0,h(),t===e?void(o=!1):(e=t,Upfront.Events.trigger("preview:build:start"),Upfront.Util.post({action:"upfront_build_preview",data:t,current_url:window.location.href,original_length:i?i.original_length:0,compressed_length:i?i.compressed_length:0,compression:Upfront.mainData.save_compression?1:0}).success(function(t){var e=t.data||{};if("html"in e&&e.html?(s=e.html,a=e.idx):Upfront.Util.log("Invalid response"),o=!1,Upfront.Events.trigger("preview:build:stop"),"concurrent_users"in e&&e.concurrent_users&&_.size(e.concurrent_users)){var i=_.values(e.concurrent_users).join(", ");Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.views.already_edited_nag.replace(/%s/,i),"error")}e.other_tab_open&&Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.views.multiple_tabs_nag,"error")}).error(function(){Upfront.Util.log("error building layout preview")}),void p(n,l)))},g=function(){r=!1},m=function(t){t=t||window.event;var e=Upfront.Settings.l10n.global.views.unsaved_changes_nag;if(o||r)return t&&(t.returnValue=e),e},v=function(){Upfront.Events.trigger("stay:upfront:editor")},b=function(){return s},y=function(){return a};return{run:p,preview_url:b,get_revision:y,rebind_events:u}};return{Util:o,Popup:r,PreviewUpdate:new s}})}(jQuery),define("scripts/upfront/plugins",[],function(){var t=function(){var t=[];this.addPlugin=function(e){t.push(e)},this.isRequiredByPlugin=function(e){for(var i=!1,n=0;n<t.length;n++){t[n].required&&_.indexOf(t[n].required,e)>-1&&(i=!0);break}return i},this.isForbiddenByPlugin=function(e){for(var i=!1,n=0;n<t.length;n++){t[n].forbidden&&_.indexOf(t[n].forbidden,e)>-1&&(i=!0);
break}return i},this.call=function(e,i){for(var n=0;n<t.length;n++)if(t[n].callbacks[e])return{status:"called",result:t[n].callbacks[e](i)};return{status:"none"}}};return t});var Upfront=window.Upfront||{};Upfront.mainData=Upfront.mainData||{},Upfront.Events={},define("jquery",[],function(){return jQuery}),require.config(Upfront.mainData.requireConfig),require(["backbone"],function(t){_.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g},require(["application","util","scripts/upfront/plugins"],function(e,i,n){_.extend(Upfront.Events,t.Events),Upfront.Settings={ace_url:"//cdnjs.cloudflare.com/ajax/libs/ace/1.1.01/ace.js",root_url:Upfront.mainData.root,ajax_url:Upfront.mainData.ajax,admin_url:Upfront.mainData.admin,site_url:Upfront.mainData.site,Debug:Upfront.mainData.debug,ContentEditor:{Requirements:Upfront.mainData.layoutEditorRequirements,Selectors:{sidebar:"#sidebar-ui"}},Application:{MODE:Upfront.mainData.applicationModes,NO_SAVE:Upfront.mainData.readOnly,DEBUG:!1,PERMS:Upfront.mainData.PERMS},LayoutEditor:{Requirements:Upfront.mainData.layoutEditorRequirements,Selectors:{sidebar:"#sidebar-ui",commands:"#commands",properties:"#properties",layouts:"#layouts",settings:"#settings",contextmenu:"#contextmenu",main:"#page"},Specificity:Upfront.mainData.specificity,ArchiveSpecificity:Upfront.mainData.archiveSpecificity,Grid:Upfront.mainData.gridInfo,Theme:Upfront.mainData.themeInfo},Content:Upfront.mainData.content,l10n:Upfront.mainData.l10n},Upfront.plugins=new n,window._upfront_debug_mode&&(Upfront.Settings.Application.DEBUG=!0,Upfront.Settings.Application.NO_SAVE=!0),_.extend(Upfront,e),_.extend(Upfront,i),Upfront.Util.Transient.initialize(),Upfront.LoadedObjectsDeferreds={},Upfront.Events.trigger("application:loaded:layout_editor"),Upfront.Application&&Upfront.Application.boot?Upfront.Application.boot():Upfront.Util.log("something went wrong")})}),define("main",function(){});