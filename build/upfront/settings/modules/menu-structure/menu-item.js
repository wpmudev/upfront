define(["scripts/upfront/settings/modules/menu-structure/menu-item-editor","text!scripts/upfront/settings/modules/menu-structure/menu-item.tpl"],function(e,t){var n=Backbone.View.extend({className:"menu-structure-module-item",events:{"click .menu-item-header":"toggleEditor","click .menu-item-delete":"deleteItem"},initialize:function(e){this.options=e||{},this.subViews=[],this.depth=this.options.depth||0,this.parent_view=e.parent_view;var t=this.model.get("sub");t&&_.each(t,function(e){this.subViews.unshift(new n({model:new Backbone.Model(e),depth:this.depth+1,menuId:this.options.menuId}))},this)},render:function(){var n=this;this.$el.html(_.template(t,{title:this.model.get("menu-item-title"),type:this.getLinkTypeLabel(Upfront.Util.guessLinkType(this.model.get("menu-item-url")))})),this.$el.data("menu-item-object-id",this.model.get("menu-item-object-id")),this.$el.data("menu-item-depth",this.depth),this.$el.addClass("menu-structure-item-depth-"+this.depth);var r=new e({model:this.model,menuId:this.options.menuId});return this.$el.append(r.render().el),this.listenTo(r,"change",function(){n.trigger("change",n.model.toJSON())}),setTimeout(function(){_.each(n.subViews,function(e){n.$el.after(e.render().el)})},100),this.delegateEvents(),this},toggleEditor:function(){this.$el.toggleClass("menu-item-expanded"),this.$el.find(".menu-item-editor").toggle()},getLinkTypeLabel:function(e){var t=Upfront.Settings.l10n.global.content;switch(e){case"unlink":return t.no_link;case"external":return t.url;case"email":return t.email_address;case"entry":return t.post_or_page;case"anchor":return t.anchor;case"image":return t.larger_image;case"lightbox":return t.lightbox}},deleteItem:function(e){e.preventDefault(),e.stopPropagation(),typeof this.model.get("menu-item-db-id")!="undefined"&&Upfront.Util.post({action:"upfront_new_delete_menu_item",menu_item_id:this.model.get("menu-item-db-id")}).success(function(e){}).error(function(e){Upfront.Util.log("Error Deleting Menu Item")}),setTimeout(function(){Upfront.Events.trigger("menu_element:edit")},100)}});return n});