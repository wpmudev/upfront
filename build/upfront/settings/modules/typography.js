define(["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=e.extend({className:"settings_module typography_settings_item",group:!0,get_title:function(){return this.options.title},initialize:function(e){this.options=e||{},this.fieldCounter=0,this.currentElement="";var n=this,r=this.options.state,i="no-toggle";typeof n.options.elements!="undefined"&&this.fieldCounter++,typeof this.options.default_element!="undefined"&&(this.currentElement=this.options.default_element+"-"),typeof this.model.get(r+"-element-type")!="undefined"&&typeof this.options.elements!="undefined"&&(this.currentElement=this.model.get(r+"-element-type")+"-"),this.options.toggle===!0&&(this.fieldCounter++,i="element-toggled"),this.fields=_([new Upfront.Views.Editor.Field.Typeface_Chosen_Select({name:this.currentElement+this.options.fields.typeface,model:this.model,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_fonts_for_select(),default_value:this.model.get(this.currentElement+this.options.fields.typeface),label:t.typeface,select_width:"225px",label_style:"inline",className:r+"-font-face static typeFace "+i,change:function(e){n.model.set(n.currentElement+n.options.fields.typeface,e),n.fields._wrapped[1+n.fieldCounter]=new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({model:this.model,name:n.currentElement+n.options.fields.fontstyle,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(n.model.get(n.currentElement+n.options.fields.typeface)),label:t.weight_style,font_family:n.model.get(n.options.fields.typeface),select_width:"225px",label_style:"inline",className:r+"-font-style static weightStyle "+i,change:function(e){var t=Upfront.Views.Font_Model.parse_variant(e);n.model.set(n.currentElement+n.options.fields.fontstyle,e),n.model.set(n.currentElement+n.options.fields.weight,t.weight),n.model.set(n.currentElement+n.options.fields.style,t.style)},show:function(e){e!==null&&n.fields._wrapped[1+n.fieldCounter].set_option_font(e)}}),n.$el.empty(),n.render()}}),new Upfront.Views.Editor.Field.Typeface_Style_Chosen_Select({model:this.model,name:this.currentElement+this.options.fields.fontstyle,values:Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(n.model.get(this.currentElement+n.options.fields.typeface)),default_value:this.model.get(this.currentElement+this.options.fields.fontstyle),label:t.weight_style,font_family:n.model.get(this.options.fields.typeface),select_width:"225px",label_style:"inline",className:r+"-font-style static weightStyle "+i,change:function(e){var t=Upfront.Views.Font_Model.parse_variant(e);n.model.set(n.currentElement+n.options.fields.fontstyle,e),n.model.set(n.currentElement+n.options.fields.weight,t.weight),n.model.set(n.currentElement+n.options.fields.style,t.style)},show:function(e){e!==null&&n.fields._wrapped[1+n.fieldCounter].set_option_font(e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-font-size fontSize "+i,name:this.currentElement+this.options.fields.size,default_value:this.model.get(this.currentElement+this.options.fields.size),label:t.size,label_style:"inline",suffix:t.px,change:function(e){n.model.set(n.currentElement+n.options.fields.size,e)}}),new Upfront.Views.Editor.Field.Number({model:this.model,className:r+"-font-lineheight lineHeight "+i,name:this.currentElement+this.options.fields.line_height,label:t.line_height,label_style:"inline",default_value:this.model.get(this.currentElement+this.options.fields.line_height),min:0,step:.1,change:function(e){n.model.set(n.currentElement+n.options.fields.line_height,e)}}),new Upfront.Views.Editor.Field.Color({model:this.model,className:r+"-font-color upfront-field-wrap upfront-field-wrap-color sp-cf fontColor "+i,name:this.currentElement+this.options.fields.color,default_value:this.model.get(this.currentElement+this.options.fields.color),blank_alpha:0,label_style:"inline",label:t.color,spectrum:{preferredFormat:"rgb",change:function(e){if(!e)return!1;var t=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();n.model.set(n.currentElement+n.options.fields.color,t)},move:function(e){if(!e)return!1;var t=e.get_is_theme_color()!==!1?e.theme_color:e.toRgbString();n.model.set(n.currentElement+n.options.fields.color,t)}}})]),typeof n.options.elements!="undefined"&&this.fields.unshift(new Upfront.Views.Editor.Field.Select({model:this.model,label:t.type_element,label_style:"inline",name:r+"-element-type",className:r+"-select-element selectElement "+i,values:n.options.elements,change:function(e){n.model.set(r+"-element-type",e),n.$el.empty(),n.render()},show:function(e){n.currentElement=e+"-";var t=n.get_field_values(e);n.update_fields(t)}})),this.options.toggle===!0&&(this.group=!1,this.fields.unshift(new Upfront.Views.Editor.Field.Checkboxes({model:this.model,className:"useTypography checkbox-title "+i,name:n.options.fields.use,label:"",multiple:!1,values:[{label:t.typography,value:"yes",checked:this.model.get(n.options.fields.use)}],change:function(e){console.log("triggered change on checkbox"),n.model.set(n.options.fields.use,e),n.reset_fields(e)},show:function(e,t){var n=t.closest(".state_modules");e=="yes"?(n.find("."+r+"-select-element").show(),n.find("."+r+"-font-face").show(),n.find("."+r+"-font-style").show(),n.find("."+r+"-font-size").show(),n.find("."+r+"-font-lineheight").show(),n.find("."+r+"-font-color").show()):(n.find("."+r+"-select-element").hide(),n.find("."+r+"-font-face").hide(),n.find("."+r+"-font-style").hide(),n.find("."+r+"-font-size").hide(),n.find("."+r+"-font-lineheight").hide(),n.find("."+r+"-font-color").hide())}})))},reset_fields:function(e){var t,n=this;typeof e!="undefined"&&e==="yes"&&(typeof this.options.elements!="undefined"?_.each(this.options.elements,function(e){var r=e.value+"-";t=n.get_static_field_values(n.options.prepend,r),n.update_fields(t),n.save_static_values(t,r)}):(t=this.get_static_field_values(this.options.prepend,""),n.update_fields(t),this.save_static_values(t,"")),this.$el.empty(),this.render())},save_static_values:function(e,t){var n=Upfront.Views.Font_Model.parse_variant(e.fontstyle);this.model.set(t+this.options.fields.typeface,e.typeface),this.model.set(t+this.options.fields.fontstyle,e.fontstyle),this.model.set(t+this.options.fields.weight,n.weight),this.model.set(t+this.options.fields.style,n.style),this.model.set(t+this.options.fields.size,e.fontsize),this.model.set(t+this.options.fields.line_height,e.line_height),this.model.set(t+this.options.fields.color,e.color)},get_static_field_values:function(e,t){var n={},r="";return typeof this.options.prefix!="undefined"&&(r=this.options.prefix+"-"),n.typeface=this.model.get(this.clear_prepend(t+r+this.options.fields.typeface,e))||"",n.fontstyle=this.model.get(this.clear_prepend(t+r+this.options.fields.fontstyle,e))||"",n.fontsize=this.model.get(this.clear_prepend(t+r+this.options.fields.size,e))||"",n.line_height=this.model.get(this.clear_prepend(t+r+this.options.fields.line_height,e))||"",n.color=this.model.get(this.clear_prepend(t+r+this.options.fields.color,e))||"",n},clear_prepend:function(e,t){return e.replace(t,"")},get_field_values:function(e){var t={};if(typeof this.options.global_typography!="undefined"&&this.options.global_typography===!0){var n=Upfront.mainData.global_typography[this.normalize_elements_selector(e)];t.typeface=this.model.get(this.currentElement+this.options.fields.typeface)||n.font_face||"",t.fontstyle=this.model.get(this.currentElement+this.options.fields.fontstyle)||n.weight+" "+n.style||"",t.fontsize=this.model.get(this.currentElement+this.options.fields.size)||n.size||"",t.line_height=this.model.get(this.currentElement+this.options.fields.line_height)||n.line_height||"",t.color=this.model.get(this.currentElement+this.options.fields.color)||n.color||""}else t.typeface=this.model.get(this.currentElement+this.options.fields.typeface)||"",t.fontstyle=this.model.get(this.currentElement+this.options.fields.fontstyle)||"",t.fontsize=this.model.get(this.currentElement+this.options.fields.size)||"",t.line_height=this.model.get(this.currentElement+this.options.fields.line_height)||"",t.color=this.model.get(this.currentElement+this.options.fields.color)||"";return t},update_fields:function(e){this.fields._wrapped[this.fieldCounter].set_value(e.typeface),this.fields._wrapped[this.fieldCounter].set_option_font(e.typeface),this.fields._wrapped[this.fieldCounter+1].options.values=Upfront.Views.Editor.Fonts.theme_fonts_collection.get_variants_for_select(e.typeface),this.fields._wrapped[this.fieldCounter+1].set_value(e.fontstyle),this.fields._wrapped[this.fieldCounter+1].set_option_font(e.fontstyle),this.fields._wrapped[this.fieldCounter+2].set_value(e.fontsize),this.fields._wrapped[this.fieldCounter+3].set_value(e.line_height),this.fields._wrapped[this.fieldCounter+4].set_value(e.color),this.fields._wrapped[this.fieldCounter+4].update_input_border_color(e.color)},normalize_elements_selector:function(e){return e==="a-hover"?"a:hover":e==="blockquote-alternative"?"blockquote.upfront-quote-alternative":e}});return n});