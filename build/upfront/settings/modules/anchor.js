define(["scripts/upfront/settings/modules/base-module"],function(e){var t=Upfront.Settings.l10n.preset_manager,n=Upfront.Views.Editor.Field.Field.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input id="upfront-anchor-element-checkbox" type="checkbox" class = "upfront-field-checkbox" /> <label for="upfront-anchor-element-checkbox"><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+Upfront.Settings.l10n.global.views.anchor_nag+"</div></div>",initialize:function(e){Upfront.Views.Editor.Field.Field.prototype.initialize.call(this,e),this.options.field=new Upfront.Views.Editor.Field.Text(this.options)},render:function(){var e=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(t){t.stopPropagation(),e.field_toggle.apply(e)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(t){t.stopPropagation(),e.check_value.apply(e)}),setTimeout(function(){e.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),t=this.$el.find(".upfront-embedded_toggleable"),n=e.length&&e.val?e.val():"";t.removeClass("error").removeClass("ok"),n.length&&!n.match(/^[a-zA-Z]+$/)?t.addClass("error"):n.length&&t.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var e=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:e.html()}))},get_value:function(){var e={},t=this.$el.find(":checkbox"),n=this.$el.find('[name="'+this.options.field.get_name()+'"]'),r=n.val().replace(/[^a-zA-Z]/g,"");return t.is(":checked")&&r?r:""}}),r=e.extend({className:"upfront-settings-item-anchor",initialize:function(e){this.options=e;var t=new n({element_label:Upfront.Settings.l10n.global.views.make_element_anchor,className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple checkbox-title",model:this.model,property:"anchor"});t.on("anchor:updated",function(){this.trigger("anchor:item:updated")},this),this.fields=_([t])},save_fields:function(){this.fields.invoke("check_value"),e.prototype.save_fields.call(this)}});return r});