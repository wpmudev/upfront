!function(e){var o=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["scripts/upfront/bg-settings/mixins","scripts/upfront/inline-panels/map-editor"],function(t,n){var a=Upfront.Views.Editor.Settings.Item.extend(_.extend({},t,{events:{"click .open-map-code-panel-button":"init_code_panel"},group:!1,initialize:function(t){var n=this,a=this.model.get_property_value_by_name("background_map_center"),l=function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e)};a||(this.model.init_property("background_map_center",[-37.818,144.976]),this.model.init_property("background_map_zoom",10),this.model.init_property("background_map_style","ROADMAP"),this.model.init_property("background_map_controls",""),this.model.init_property("background_show_markers",""),this.model.init_property("background_use_custom_map_code",""));var i={location:new Upfront.Views.Editor.Field.Text({model:this.model,label:o.location,property:"background_map_location",use_breakpoint_property:!0,placeholder:"e.g 123 Nice St",change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e,!0),n._location=e,n._location_changed=!0},rendered:function(){this.$el.addClass("uf-bgsettings-map-location")}}),refresh:new Upfront.Views.Editor.Field.Button({label:"",compact:!0,classname:"upfront-field-icon upfront-field-icon-refresh-2 upfront-refresh-map",on_click:function(){var e=n.$el.find('input[name="background_map_location"]');e.length&&(n._location=e.val()),n._location_changed=!0,n.geocode_location()}}),zoom:new Upfront.Views.Editor.Field.Slider({model:this.model,label:o.zoom,property:"background_map_zoom",use_breakpoint_property:!0,default_value:8,min:1,max:19,step:1,change:l,rendered:function(){this.$el.addClass("uf-bgsettings-map-zoom")}}),style:new Upfront.Views.Editor.Field.Select({model:this.model,label:o.map_style,property:"background_map_style",use_breakpoint_property:!0,values:[{label:o.roadmap,value:"ROADMAP"},{label:o.satellite,value:"SATELLITE"},{label:o.hybrid,value:"HYBRID"},{label:o.terrain,value:"TERRAIN"}],change:l,rendered:function(){this.$el.addClass("uf-bgsettings-map-style")}}),controls:new Upfront.Views.Editor.Field.Select({model:this.model,label:o.map_controls,placeholder:o.choose_ctrl,property:"background_map_controls",use_breakpoint_property:!0,multiple:!0,default_value:["pan"],values:[{label:o.pan,value:"pan"},{label:o.zoom,value:"zoom"},{label:o.map_type,value:"map_type"},{label:o.scale,value:"scale"},{label:o.street_view,value:"street_view"},{label:o.overview_map,value:"overview_map"}],change:l,rendered:function(){this.$el.addClass("uf-bgsettings-map-controls")}}),show_markers:new Upfront.Views.Editor.Field.Toggle({model:this.model,label:o.show_markers,property:"background_show_markers",use_breakpoint_property:!0,hide_label:!0,values:[{label:o.show_markers,value:1}],multiple:!1,change:l,rendered:function(){this.$el.addClass("uf-bgsettings-map-show-marker")}}),custom_map_code:new Upfront.Views.Editor.Field.Toggle({model:this.model,label:o.custom_map_code,property:"background_use_custom_map_code",hide_label:!0,values:[{label:o.custom_map_code+'<span class="checkbox-info" title="'+o.custom_map_code_info+'"></span>',value:1}],multiple:!1,change:function(){var o=this.get_value();this.property.set({value:o}),1==o?e(".open-map-code-panel-button",this.$el.parent()).show():e(".open-map-code-panel-button",this.$el.parent()).hide()},rendered:function(){this.$el.addClass("uf-bgsettings-map-custom-map-code")}}),open_map_code_panel:new Upfront.Views.Editor.Field.Button({model:n.model,label:o.open_map_code_panel,className:"open-map-code-panel-button upfront-small-button",compact:!0})};this.$el.addClass("uf-bgsettings-item uf-bgsettings-mapitem"),t.fields=_.map(i,function(e){return e}),this._location=i.location.get_value(),this.$el.on("keypress",'input[name="background_map_location"]',function(o){13===o.keyCode&&(n._location=e(this).val(),n._location_changed=!0,n.geocode_location())}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,t)},render:function(){Upfront.Views.Editor.Settings.Item.prototype.render.call(this),e('[name="background_use_custom_map_code"]',this.$el).trigger("change")},geocode_location:function(){if(!(window._upfront_api_keys||{}).gmaps)return!1;if(1!=this._geocoding&&this._location_changed){var e=this,o=this._location,t=new google.maps.Geocoder;o&&(this._geocoding=!0,t.geocode({address:o},function(o,t){if(t!=google.maps.GeocoderStatus.OK)return e._geocoding=!1,e._location_changed=!1,!1;var n=o[0].geometry.location;e.model.set_breakpoint_property("background_map_center",[n.lat(),n.lng()]),e._geocoding=!1,e._location_changed=!1}))}},init_code_panel:function(){var e=new n({model:this.model});e.render()}}));return a})}(jQuery);