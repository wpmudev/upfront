!function(e){var o=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["scripts/upfront/bg-settings/mixins","scripts/upfront/video-selector"],function(e,t){var i=Upfront.Views.Editor.Settings.Item.extend(_.extend({},e,{group:!1,initialize:function(e){var i,l=this,d=new t,r=new Upfront.Views.Editor.Field.Button({label:o.browse,model:this.model,compact:!0,classname:"uf-button-alt uf-bgsettings-image-pick uf-bgsettings-video-pick",on_click:function(){d.open().done(function(e){d.close(),l.model.set_breakpoint_property("uploaded_background_video_embed",""),l.model.set_breakpoint_property("uploaded_background_video",""),l.model.set_breakpoint_property("background_video_embed",""),l.model.set_breakpoint_property("background_video",""),l.model.set_breakpoint_property("background_video_width",e.width),l.model.set_breakpoint_property("background_video_height",e.height),l.model.set_breakpoint_property("uploaded_background_video_embed",e.embed),l.model.set_breakpoint_property("uploaded_background_video",e.id),l.model.set_breakpoint_property("type","uploaded_video")})}}),n=new Upfront.Views.Editor.Field.Text({model:this.model,label:o.video_url,property:"background_video",use_breakpoint_property:!0,default_value:"",placeholder:o.video_url,change:function(){var e=this.get_value();e&&(l.model.set_breakpoint_property("type","video"),l.model.set_breakpoint_property("uploaded_background_video_embed",""),l.model.set_breakpoint_property("uploaded_background_video",""),l.model.set_breakpoint_property("background_video_embed",""),l.get_video_embed(e).done(function(e){e.data&&(l.model.set_breakpoint_property("background_video_width",e.data.width),l.model.set_breakpoint_property("background_video_height",e.data.height),l.model.set_breakpoint_property("background_video_embed",e.data.html))})),this.model.set_breakpoint_property(this.property_name,e)},rendered:function(){this.$el.addClass("uf-bgsettings-video-url")}});i={bg_style:new Upfront.Views.Editor.Field.Select({model:this.model,label:o.video_source,className:"upfront-field-wrap upfront-field-wrap-select background-video-style-field",property:"background_style",use_breakpoint_property:!0,default_value:"upload",icon_class:"upfront-region-field-icon",values:this.get_bg_style_values(),change:function(){var e=this.get_value();"upload"===e?(n.$el.hide(),r.$el.show(),l.$el.find(".background-video-style-field").css({minWidth:"138px",maxWidth:"138px"}),l.$el.find(".background-video-style-field .upfront-field-select").css({minWidth:"138px",maxWidth:"138px"})):"service"===e&&(r.$el.hide(),n.$el.show(),l.$el.find(".background-video-style-field").css("minWidth","100%"),l.$el.find(".background-video-style-field .upfront-field-select").css({minWidth:"100%",maxWidth:"100%"})),l._bg_style=e,l.update_video()}}),pick_video:r,video:n,mute:new Upfront.Views.Editor.Field.Toggle({model:this.model,property:"background_video_mute",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:o.mute_on_play,value:1}],change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-mute")}}),autoplay:new Upfront.Views.Editor.Field.Toggle({model:this.model,property:"background_video_autoplay",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:o.autoplay,value:1}],change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-autoplay")}}),loop:new Upfront.Views.Editor.Field.Toggle({model:this.model,property:"background_video_loop",use_breakpoint_property:!0,default_value:1,layout:"horizontal-inline",multiple:!1,values:[{label:o.loop,value:1}],change:function(){var e=this.get_value();this.model.set_breakpoint_property(this.property_name,e?1:0)},rendered:function(){this.$el.addClass("uf-bgsettings-video-loop")}}),style:new Upfront.Views.Editor.Field.Select({model:this.model,label:o.video_cropping_method,property:"background_video_style",use_breakpoint_property:!0,layout:"horizontal-inline",default_value:["crop"],values:[{label:o.scale_and_crop,value:"crop"},{label:o.no_crop_embed,value:"full"},{label:o.no_crop_bg,value:"inside"}],change:function(){var e=this.get_value();"inside"==e?i.color.$el.show():i.color.$el.hide(),this.model.set_breakpoint_property(this.property_name,e)},rendered:function(){this.$el.addClass("uf-bgsettings-video-style")}}),color:new Upfront.Views.Editor.Field.Color({model:this.model,label:o.bg_color_short,label_style:"inline",property:"background_color",use_breakpoint_property:!0,default_value:"#ffffff",spectrum:{move:function(e){l.preview_color(e)},change:function(e){l.update_color(e)},hide:function(e){l.reset_color()}},rendered:function(){this.$el.addClass("uf-bgsettings-video-color")}})},this.$el.addClass("uf-bgsettings-item uf-bgsettings-videoitem"),e.fields=_.map(i,function(e){return e}),this.on("show",function(){i.style.trigger("changed")}),this.bind_toggles(),this.constructor.__super__.initialize.call(this,e),setTimeout(function(){var e=l.model.get_breakpoint_property_value("background_style");"upload"===e?(n.$el.hide(),r.$el.show(),l.$el.find(".upfront-field-select").css("minWidth","138px")):"service"===e?(r.$el.hide(),n.$el.show(),l.$el.find(".upfront-field-select").css("minWidth","100%")):(l.model.set_breakpoint_property("background_style","upload"),n.$el.hide(),r.$el.show(),l.$el.find(".upfront-field-select").css("minWidth","138px"))},50)},get_video_embed:function(e){return Upfront.Util.post({action:"upfront-media-get_embed_raw",media:e})},get_bg_style_values:function(){var e=[{label:o.uploaded_video,value:"upload"},{label:o.video_service,value:"service"}];return e},update_video:function(){var e=this._bg_style;this.model.set_breakpoint_property("background_style",e)}}));return i})}(jQuery);