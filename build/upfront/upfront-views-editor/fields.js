!function(t){var e=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["scripts/upfront/upfront-views-editor/mixins","scripts/upfront/upfront-views-editor/theme-colors","text!upfront/templates/color_picker.html"],function(i,s,n){var l=Backbone.View.extend({className:"upfront-field-wrap",initialize:function(t){this.options=t,this.multiple="undefined"!=typeof this.options.multiple?this.options.multiple:"undefined"!=typeof this.multiple?this.multiple:!1,this.label="undefined"!=typeof this.options.label?this.options.label:"",this.default_value="undefined"!=typeof this.options.default_value?this.options.default_value:this.multiple?[]:"",this.options.property?(this.property=this.model.get_property_by_name(this.options.property),this.property===!1&&(this.model.init_property(this.options.property,this.default_value),this.property=this.model.get_property_by_name(this.options.property)),this.property_name=this.options.property,"undefined"!=typeof this.options.use_breakpoint_property&&(this.use_breakpoint_property=this.options.use_breakpoint_property)):this.property=!1,this.name=this.options.name?this.options.name:this.cid,this.selected_state=this.selected_state?this.selected_state:"",this.options.init&&this.options.init(),this.init&&this.init(),this.options.change&&this.on("changed",this.options.change,this),this.options.show&&this.on("changed rendered",this.dispatch_show,this),this.options.focus&&this.on("focus",this.options.focus,this),this.options.blur&&this.on("blur",this.options.blur,this),this.options.rendered&&this.on("rendered",this.options.rendered,this),this.options.on_click&&(this.on_click=this.options.on_click),this.once("rendered",function(){var t=this;this.get_field().on("focus",function(){t.trigger("focus")}).on("blur",function(){t.trigger("blur")})},this)},dispatch_show:function(){var t=this;setTimeout(function(){t.options.show(t.get_value(),t.$el)},100)},get_name:function(){return this.property?this.property.get("name"):this.name},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?this.model.get_breakpoint_property_value(this.property_name,!0):this.property.get("value");if(this.model){var t=this.model.get(this.name);return t?t:this.default_value}return this.default_value},get_value:function(){var e=this.get_field();return!this.multiple||1==e.size()&&e.is("select")?e.val():_.map(e,function(e){return t(e).val()})},set_value:function(t){this.get_field().val(t)},get_field_id:function(){return this.cid+"-"+this.get_name()},get_field_name:function(){return this.get_name()},get_field:function(){return this.$el.find("[name="+this.get_field_name()+"]"+(this.selected_state?":"+this.selected_state:""))},get_label_html:function(){if(this.options.hide_label===!0)return"";var t={"for":this.get_field_id(),"class":"upfront-field-label "+("inline"==this.options.label_style?"upfront-field-label-inline":"upfront-field-label-block")};return"<label "+this.get_field_attr_html(t)+">"+this.label+"</label>"},get_field_attr_html:function(t){return _.map(t,function(t,e){return e+'="'+t+'"'}).join(" ")}}),o=l.extend({className:"upfront-field-wrap upfront-field-wrap-text",render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html());var e=this;this.get_field().keyup(function(){""===t(this).val()?t(this).addClass("upfront-field-empty"):t(this).hasClass("upfront-field-empty")&&t(this).removeClass("upfront-field-empty")}).trigger("keyup").change(function(){e.trigger("changed",e.get_value())}),this.trigger("rendered")},get_field_html:function(){var t={type:"text","class":"upfront-field upfront-field-text",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),a=o.extend({is_edited:!1,className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-toggleable",render:function(){if(o.prototype.render.call(this),this.is_edited)return!1;this.$el.append(' <a href="#" class="upfront-toggleable-button">Edit</a>');var e=this;this.$el.on("click",".upfront-toggleable-button",function(i){i.preventDefault(),i.stopPropagation();var s=t(this),n=e.get_field();s.hide(),n.replaceWith(e.get_editable_html()),e.is_edited=!0})},has_been_edited:function(){return this.is_edited},reset_state:function(){this.is_edited=a.prototype.is_edited},get_field_html:function(){return this.is_edited?this.get_editable_html():this.get_toggleable_html()},get_field:function(){return this.is_edited?o.prototype.get_field.call(this):this.$el.find(".upfront-field-toggleable-value")},get_value:function(){return this.is_edited?o.prototype.get_value.call(this):t.trim(this.get_field().text())},set_value:function(t){return this.is_edited?this.get_field().val(t):this.get_field().text(t)},get_toggleable_html:function(){var t=this.get_value()||this.get_saved_value();return'<span class="upfront-field-toggleable-value">'+t+"</span>"},get_editable_html:function(){var t={type:"text","class":"upfront-field upfront-field-text upfront-field-toggleable",id:this.get_field_id(),name:this.get_field_name(),value:this.get_value()||this.get_saved_value()};return"inline"===this.options.label_style&&(t["class"]+=" upfront-has_inline_label"),this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),p=l.extend({className:"upfront-field-wrap upfront-field-wrap-button",events:{click:"on_click"},render:function(){this.$el.html(""),this.options.compact||this.$el.append(this.get_label_html()),this.options.info&&this.$el.append(this.get_info_html()),this.$el.append(this.get_field_html());this.options.classname&&this.$el.addClass(this.options.classname),this.trigger("rendered"),this.delegateEvents()},get_info_html:function(){return'<span class="button-info">'+this.options.info+"</span>"},get_field_html:function(){var t={type:"button","class":"upfront-field upfront-field-button",id:this.get_field_id(),name:this.get_field_name(),value:this.label};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.value=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),r=o.extend({get_field_html:function(){var t={type:"email","class":"upfront-field upfront-field-text upfront-field-email",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"}}),h=o.extend({className:"upfront-field-wrap upfront-field-wrap-text upfront-field-wrap-textarea",get_field_html:function(){var t={cols:"40",rows:"5","class":"upfront-field upfront-field-text upfront-field-textarea",id:this.get_field_id(),name:this.get_field_name()};return this.options.compact?(t.placeholder=this.label,this.$el.attr("title",this.label)):this.options.placeholder&&(t.placeholder=this.options.placeholder),"<textarea "+this.get_field_attr_html(t)+">"+this.get_saved_value()+"</textarea>"}}),d=o.extend({className:"upfront-field-wrap upfront-field-wrap-number",get_field_html:function(){var t={type:"number","class":"upfront-field upfront-field-number",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return"undefined"!=typeof this.options.min&&(t.min=this.options.min),"undefined"!=typeof this.options.max&&(t.max=this.options.max),"undefined"!=typeof this.options.step&&(t.step=this.options.step)," <input "+this.get_field_attr_html(t)+" /> "+(this.options.suffix?this.options.suffix:"")}}),c=o.extend(_.extend({},i.Upfront_Icon_Mixin,{className:"upfront-field-wrap upfront-field-wrap-slider",initialize:function(t){this.options=t,c.__super__.initialize.apply(this,arguments);var e=this,i={range:this.getOption("range","min"),min:this.getOption("min",0),max:this.getOption("max",0),step:this.getOption("step",1),orientation:this.getOption("orientation","horizontal"),value:this.get_saved_value()};this.value=this.get_saved_value(),"undefined"==typeof this.value&&(this.value=i.min),this.options.callbacks&&_.extend(i,this.options.callbacks),i.slide=function(t,i){var s=i.value;e.value=s,e.$("input").val(e.value).trigger("change"),e.options.valueTextFilter&&(s=e.options.valueTextFilter(s)),e.$(".upfront-field-slider-value").text(s),e.options.callbacks&&e.options.callbacks.slide&&e.options.callbacks.slide(t,i)},this.on("rendered",function(){var t=e.$("#"+e.get_field_id());"vertical"==i.orientation&&t.addClass("upfront-field-slider-vertical"),t.slider(i)})},get_field_html:function(){var t='<input type="hidden" name="'+this.get_field_name()+'" value="'+this.value+'">',e=this.value;return this.options.info&&(t+='<div class="upfront-field-info">'+this.options.info+"</div>"),t+='<div class="upfront-field upfront-field-slider" id="'+this.get_field_id()+'"></div>',this.options.valueTextFilter&&(e=this.options.valueTextFilter(e)),t+='<div class="upfront-field-slider-value"> '+e+"</div>"},getOption:function(t,e){return this.options[t]?this.options[t]:e}})),u=o.extend({className:"upfront-field-wrap upfront-field-wrap-hidden",get_field_html:function(){var t={type:"hidden",id:this.get_field_id(),name:this.get_field_name(),"class":"upfront-field upfront-field-hidden",value:this.get_saved_value()};return" <input "+this.get_field_attr_html(t)+" /> "}}),f=o.extend({className:"upfront-field-wrap upfront-field-wrap-color sp-cf",defaults:{blank_alpha:1,autoHide:!0,hideOnOuterClick:!0},spectrumDefaults:{clickoutFiresChange:!0,showSelectionPalette:!0,showAlpha:!0,showPalette:!0,localStorageKey:"spectrum.recent_colors",palette:s.colors.pluck("color").length?s.colors.pluck("color"):[],maxSelectionSize:10,preferredFormat:"hex",showButtons:!1,showInput:!0,allowEmpty:!0,appendTo:"parent"},events:{"change .upfront_color_picker_rgba input":"rgba_sidebar_changed","change .sp-input":"sp_input_changed","click .upfront_color_picker_reset":"set_to_blank"},initialize:function(i){this.options=_.extend({},this.defaults,i),this.field_options=_.extend({},this.defaults,i),this.options.blank_alpha=_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha,this.sidebar_template=_.template(n);var s=this,l="object"==typeof this.options.spectrum?_.extend({},this.spectrumDefaults,this.options.spectrum):this.spectrumDefaults;this.rgba={r:0,g:0,b:0,a:0},this.spectrumOptions=l,l.move=_.bind(this.on_spectrum_move,this),l.show=_.bind(this.on_spectrum_show,this),l.beforeShow=_.bind(this.on_spectrum_beforeShow,this);var o=function(t){s.options.spectrum&&s.options.spectrum.hide&&s.options.spectrum.hide(t)};l.hide=o,l.autoHide||(l.hide=function(t){s.color=t,o(t),s.$(".sp-replacer").addClass("sp-active"),s.$(".sp-container").removeClass("sp-hidden")}),this.l10n_update=_.debounce(function(){t(".sp-container").each(function(){t(this).find(".sp-input-container").attr("data-label",e.current_color).end().find(".sp-palette-container").attr("data-label",e.theme_colors).end().find(".sp-palette-row:last").attr("data-label",e.recent_colors)})}),f.__super__.initialize.apply(this,arguments),this.on("rendered",this._rendered)},_rendered:function(){var t=this;this.$("input[name="+this.get_field_name()+"]").spectrum(this.spectrumOptions),this.$spectrum=this.$("input[name="+this.get_field_name()+"]"),this.$spectrum.on("reflow.spectrum move.spectrum change",this.l10n_update),this.$(".sp-container").append("<div class='color_picker_rgb_container'></div>"),this.update_input_border_color(this.get_saved_value()),this.$(".sp-container").data("field_color",this),this.$(".sp-container").data("$spectrum",this.$spectrum),this.$(".sp-container").find(".sp-choose").on("click.spectrum",function(e){t.options.spectrum&&t.options.spectrum.choose&&t.color&&t.options.spectrum.choose(t.color),t.options.autoHide!==!0&&(t.$(".sp-replacer").removeClass("sp-active"),t.$(".sp-container").addClass("sp-hidden"),Upfront.Events.trigger("color:spectrum:hide"))}),this.$(".sp-container").find(".sp-choose").text(Upfront.Settings.l10n.global.content.ok)},on_spectrum_move:function(e,i){if(!_.isEmpty(e)){this.color=e;var s=e.toRgbString();t(".sp-dragger").css({"border-top-color":s,"border-right-color":s}),this.update_input_border_color(e.toRgbString()),this.update_input_val(s),this.rgba=_.extend(this.rgba,e.toRgb()),this.render_sidebar_rgba(this.rgba)}this.options.spectrum&&this.options.spectrum.move&&this.options.spectrum.move(e),this.toggle_alpha_selector(e,i)},on_spectrum_show:function(e){Upfront.Events.trigger("color:spectrum:show");var i=t(".sp-input"),s=i.val();if(!_.isEmpty(e)){this.color=e;var n=e.toRgbString();this.rgba=_.extend(this.rgba,e.toRgb()),this.update_input_border_color(e.toRgbString()),this.render_sidebar_rgba(this.rgba),this.update_input_val(n)}if(!_.isEmpty(s)&&!this.is_hex(s)){var l=tinycolor(s);i.val(l.toRgbString())}if(this.options.spectrum&&this.options.spectrum.show&&this.options.spectrum.show(e),t(".sp-container").not(this.$(".sp-container")).each(function(){var e=t(this),i=e.data("sp-options");i&&i.flat||e.addClass("sp-hidden")}),!_.isEmpty(e)){var o=this;tinycolor(e);setTimeout(function(){o.toggle_alpha_selector(e)},100)}!this.options.spectrum||this.options.spectrum.flat||this.field_options&&this.field_options.flat||!this.field_options.hideOnOuterClick||t("html").on("mousedown",_.bind(this.hide_on_outer_click,this))},on_spectrum_beforeShow:function(e){e instanceof Object&&t.extend(e,tinycolor.prototype),this.color=e,this.update_palette(),this.$("input[name="+this.get_field_name()+"]").spectrum("option","palette",this.options.palette),this.options.spectrum&&this.options.spectrum.beforeShow&&this.options.spectrum.beforeShow(e),this.$(".sp-container").data("sp-options",this.options.spectrum)},render:function(){f.__super__.render.apply(this,arguments),this.stopListening(Upfront.Events,"theme_colors:update");var t=_.debounce(this.update_palette,200);this.listenTo(Upfront.Events,"theme_colors:update",t,this)},hide_on_outer_click:function(e){if(!this.$(".sp-container").hasClass("sp-hidden")){var i=t(e.target);i.is(".sp-container")||i.parents(".sp-container").length||(this.revert(),this.$(".sp-container").addClass("sp-hidden"),Upfront.Events.trigger("color:spectrum:hide"),t("html").off("mousedown",_.bind(this.hide_on_outer_click,this)))}},revert:function(){this.$spectrum.trigger("click.spectrum"),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(this.color),this.color&&this.color.toRgbString&&this.update_input_border_color(this.color.toRgbString)},update_palette:function(){this.$spectrum&&this.$spectrum.spectrum&&this.$spectrum.spectrum("option","palette",s.colors.pluck("color").length?s.colors.pluck("color"):[])},is_hex:function(t){return-1===t.indexOf("#")?!1:!0},get_field_html:function(){var t={type:"text","class":"upfront-field upfront-field-color",id:this.get_field_id(),name:this.get_field_name(),value:this.get_saved_value()};return" <input "+this.get_field_attr_html(t)+" /> "+(this.options.suffix?this.options.suffix:"")},get_saved_value:function(){if(this.property)return this.use_breakpoint_property?Upfront.Util.colors.to_color_value(this.model.get_breakpoint_property_value(this.property_name,!0)):this.property.get("value");if(this.model){var t=this.model.get(this.name);return t?t:this.default_value}return this.default_value},update_input_border_color:function(t){var e=this.$el.find(".sp-preview"),i=this;setTimeout(function(){i.$el.find(".upfront_color_picker_rgb_main").css({backgroundColor:t})},10),e.css({backgroundColor:t}),"rgba(0, 0, 0, 0)"!==t?e.removeClass("uf-unset-color"):0===e.closest(".theme_colors_empty_picker").length&&e.addClass("uf-unset-color")},update_input_val:function(t){this.$(".sp-input").val(t)},render_sidebar_rgba:function(t){var e=this;this.$(".color_picker_rgb_container").html(this.sidebar_template(t)),this.$(".upfront_color_picker_reset").on("click",function(t){t.preventDefault(),e.set_to_blank()})},rgba_sidebar_changed:function(e){var i=t(e.target),s=i.data("type"),n=parseFloat(i.val()),l=this.$spectrum.spectrum("get"),o={};o[s]=n,l=tinycolor(_.extend(l.toRgb(),o)),this.$spectrum.spectrum("set",l.toRgbString()),this.update_input_border_color(l.toRgbString()),this.update_input_val(l.toRgbString()),this.render_sidebar_rgba(l.toRgb()),this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(l),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(l),e.stopPropagation(),e.preventDefault(),this.$spectrum.trigger("dragstop.spectrum")},sp_input_changed:function(e){var i=tinycolor(t(e.target).val());this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(i),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(i),this.update_input_border_color(i.toRgbString)},set_to_blank:function(){var t="rgba(0, 0, 0, "+(_.isUndefined(this.options.blank_alpha)?1:this.options.blank_alpha)+")",e=tinycolor(t);e.reset=!0,this.rgba={r:0,g:0,b:0,a:0},this.$spectrum.spectrum("set",e.toRgbString()),this.update_input_border_color(t),this.update_input_val("#000000"),this.render_sidebar_rgba(this.rgba),this.options.spectrum&&"function"==typeof this.options.spectrum.move&&this.options.spectrum.move(e),this.options.spectrum&&"function"==typeof this.options.spectrum.change&&this.options.spectrum.change(e),this.options&&"function"==typeof this.options.move&&this.options.move(e),this.options&&"function"==typeof this.options.change&&this.options.change(e)},get_value:function(){return this.$el.find(".sp-preview-inner").css("background-color")},set_value:function(t){Upfront.Util.colors.is_theme_color(t)&&(t=Upfront.Util.colors.get_color(t));var e=tinycolor(t);this.color=e,this.$spectrum.spectrum("set",e)},toggle_alpha_selector:function(i){if(!_.isEmpty(i)){var s=this.$(".sp-alpha");Upfront.Views.Theme_Colors.colors.is_theme_color(i)?(s.addClass("sp-alpha-disabled sp-alpha-lower-opacity"),$overlay=t("<span class='sp-alpha-overlay' title='"+e.theme_colors_opacity_disabled+"'>"+e.theme_colors_opacity_disabled+"</span>").on("click",function(t){t.stopPropagation(),t.preventDefault()}),this.$(".sp-alpha-overlay").length||s.before($overlay)):(s.removeClass("sp-alpha-disabled sp-alpha-lower-opacity"),this.$(".sp-alpha-overlay").remove())}}}),g=l.extend(_.extend({},i.Upfront_Icon_Mixin,{get_values_html:function(){return _.map(this.options.values,this.get_value_html,this).join("")},set_value:function(t){this.$el.find('[value="'+t+'"]').trigger("click")}})),m=g.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-field-select-value":"openOptions","mouseup .upfront-field-select":"onMouseUp","change .upfront-field-select-option input":"onChange","click .upfront-field-select-option label":"onOptionClick"},onOptionClick:function(e){if(!this.multiple){if(e.stopPropagation(),t(this).closest(".upfront-field-select-option").hasClass("upfront-field-select-option-disabled"))return;t(e.currentTarget).siblings("input").not(":checked")&&t(e.currentTarget).siblings("input").click(),this.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),this.trigger("blur")}},openOptions:function(e){if(e&&e.stopPropagation(),!this.options.disabled){t(".upfront-field-select-expanded").removeClass("upfront-field-select-expanded"),this.$el.find(".upfront-field-select").css("min-width","").css("min-width",this.$el.find(".upfront-field-select").width()),this.$el.find(".upfront-field-select").addClass("upfront-field-select-expanded");var i=this;_.delay(function(){var e=i.$el.parents("#sidebar-ui").length,s=i.$el.parents("#element-settings-sidebar").length,n=46;if(1==e||1==s){var l=i.$el.find(".upfront-field-select-options"),o=l.parent(),a=o.offset().top-t("#element-settings-sidebar").offset().top;a+=n,l.css("width",o.width()+3),l.css("top",a+"px"),Upfront.Util.isRTL()?l.css("right",t(window).width()-o.offset().left-o.width()+"px"):l.css("left",o.offset().left+"px"),l.css("display","block")}},10),t(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.on_scroll),this.trigger("focus")}},on_scroll:function(t){var e=t.data;e.$el.find(".upfront-field-select").removeClass("upfront-field-select-expanded"),e.trigger("blur")},onMouseUp:function(t){t.stopPropagation()},onChange:function(){this.update_select_display_value(),this.trigger("changed",this.get_value())},selected_state:"checked",className:"upfront-field-wrap upfront-field-wrap-select",render:function(){this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.trigger("rendered")},update_select_display_value:function(){var e=this.options.select_label?this.options.select_label:this.options.placeholder?this.options.placeholder:"",i=this.$el.find(".upfront-field-select-value"),s=this.$el.find(".upfront-field-select-option input:checked");if(1!=s.length||this.multiple){var n=[];s.each(function(){n.push(t(this).closest(".upfront-field-select-option").text())}),i.text(0===s.length?e:n.join(", "))}else{var l=s.closest(".upfront-field-select-option"),o=l.text(),a=l.find(".upfront-field-icon").clone();i.html(""),a&&i.append(a),i.append("<span>"+o+"</span>")}this.$el.find(".upfront-field-select-option").each(function(){t(this).find("input:checked").length>0?t(this).addClass("upfront-field-select-option-selected"):t(this).removeClass("upfront-field-select-option-selected")})},get_field_html:function(){var t={"class":"upfront-field-select upfront-no-select",id:this.get_field_id()};return t["class"]+=" upfront-field-select-"+(this.options.multiple?"multiple":"single"),this.options.disabled&&(t["class"]+=" upfront-field-select-disabled"),"zebra"==this.options.style&&(t["class"]+=" upfront-field-select-zebra"),"<div "+this.get_field_attr_html(t)+'><div class="upfront-field-select-value"></div><ul class="upfront-field-select-options">'+this.get_values_html()+"</ul></div>"},get_value_html:function(t,e){var i=this.get_field_id()+"-"+e,s={type:this.multiple?"checkbox":"radio",id:i,name:this.get_field_name(),"class":"upfront-field-"+(this.multiple?"checkbox":"radio"),value:t.value},n=this.get_saved_value(),l="upfront-field-select-option";t.disabled&&(s.disabled="disabled",l+=" upfront-field-select-option-disabled");var o=this.options.icon_class?this.options.icon_class:null;this.multiple&&_.contains(n,t.value)?s.checked="checked":this.multiple||n!=t.value||(s.checked="checked"),s.checked&&(l+=" upfront-field-select-option-selected"),l+=" upfront-field-select-option-"+(0===e%2?"odd":"even");var a="<input "+this.get_field_attr_html(s)+" />";return'<li class="'+l+'"><label for="'+i+'">'+this.get_icon_html(t.icon,o)+'<span class="upfront-field-label-text">'+t.label+"</span></label>"+a+"</li>"}})),v=m.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,initialize:function(e){this.options=e,l.prototype.initialize.call(this,e),t(".sidebar-panel-content, #sidebar-scroll-wrapper").on("scroll",this,this.closeChosen)},render:function(){var t=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.stop_scroll_propagation(this.$el.find(".upfront-field-select-options")),this.multiple||this.get_saved_value()||this.$el.find(".upfront-field-select-option:eq(0) input").prop("checked",!0),this.update_select_display_value(),this.options.width&&this.$el.find(".upfront-field-select").css("width",this.options.width),this.options.additional_classes&&this.$el.addClass(this.options.additional_classes),this.$el.find("select").on("chosen:hiding_dropdown",function(){t.allowMouseWheel()}),this.trigger("rendered")},get_field_html:function(){var t=this.multiple?"multiple":"";return['<select class="upfront-chosen-select"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(t,e){var i="";return t.value===this.options.default_value&&(i=' selected="selected"'),['<option value="',t.value,'"',i,">",t.label,"</option>"].join("")},on_change:function(t){this.allowMouseWheel(),this.$el.find(".chosen-drop").css("display","none"),this.trigger("changed")},get_value:function(){return this.$el.find("select").val()},set_value:function(t){this.$el.find("select").val(t).trigger("chosen:updated")},openOptions:function(e){t(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").bind("mousewheel",function(){return!1});var i=this;_.delay(function(){var e=i.$el.parents("#sidebar-ui").length,s=i.$el.parents("#element-settings-sidebar").length,n=44;if(1==e||1==s){var l=i.$el.find(".chosen-drop"),o=l.parent(),a=o.offset().top-t("#element-settings-sidebar").offset().top+o.height();a+=n,l.css("width",o.width()),l.css("top",a+"px"),l.css("left",o.offset().left+"px"),l.css("display","block")}},20),i.$el.find(".chosen-drop").show()},closeChosen:function(t){var e=t.data,i=e.$el.parents("#sidebar-ui").length,s=e.$el.parents("#element-settings-sidebar").length;(1==i||1==s)&&e.$el.find(".chosen-drop").css("display","none"),e.$el.find("select").trigger("chosen:close"),e.allowMouseWheel()},allowMouseWheel:function(){t(".sidebar-panel-content .sidebar-tab-content, #sidebar-scroll-wrapper").unbind("mousewheel")}}),b=v.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var t=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-typeface"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(t,e){var i="",s=this.get_saved_value();return t.value===s&&(i=' selected="selected"'),['<option value="',t.value,'"',i,' style="font-family: ',t.value,'">',t.label,"</option>"].join("")},render:function(){v.prototype.render.call(this);var e=this;t(".upfront-chosen-select-typeface",this.$el).chosen({width:this.options.select_width}),setTimeout(function(){e.set_option_font(e.get_saved_value())},50)},on_change:function(t){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(t){this.$el.find(".chosen-single").css("font-family",t)},openOptions:function(t){v.prototype.openOptions.call(this)}}),y=v.extend({events:{"change select":"on_change","click .chosen-container .chosen-single":"openOptions"},multiple:!1,get_field_html:function(){var t=this.multiple?"multiple":"";return['<div class="upfront-select-font"><select class="upfront-chosen-select-style"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select></div>"].join("")},get_value_html:function(t,e){var i="",s=this.options.font_family,n=Upfront.Views.Font_Model.parse_variant(t.value),l=this.get_saved_value();t.value===l&&(i=' selected="selected"');var o=this.map_labels(n.weight,n.style);return['<option value="',t.value,'"',i,' style="font-family: ',s,"; font-weight: ",n.weight,"; font-style: ",n.style,' ">',o,"</option>"].join("")},render:function(){v.prototype.render.call(this);var e=this;t(".upfront-chosen-select-style",this.$el).chosen({width:this.options.select_width,disable_search:!0}),setTimeout(function(){e.set_option_font(e.get_saved_value())},50)},map_labels:function(t,i){var s,n={100:e.label_thin,200:e.label_extra_light,300:e.label_light,400:e.label_regular,500:e.label_medium,600:e.label_semi_bold,700:e.label_bold,800:e.label_extra_bold,900:e.label_ultra_bold};return s=!_.isUndefined(t)&&t.match(/^(\d+)/)?n[t]:t,"italic"==i&&(s+=" "+i),s},on_change:function(t){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none"),this.set_option_font(this.get_value())},set_option_font:function(t){var e=this.$el.parent().parent().find(".upfront-chosen-select-typeface").val(),i=Upfront.Views.Font_Model.parse_variant(t);this.$el.find(".chosen-single").css({"font-family":e,"font-weight":i.weight,"font-style":i.style})},openOptions:function(t){v.prototype.openOptions.call(this)}}),$=v.extend({events:{"change select":"on_change","click .chosen-container-multi":"openOptions"},multiple:!0,get_field_html:function(){var t=this.multiple?"multiple":"";return['<select class="upfront-chosen-select-multiple"',t,' data-placeholder="',this.options.placeholder,'">',this.get_values_html(),"</select>"].join("")},get_value_html:function(t,e){var i="",s=this.get_saved_value();return _.contains(s,t.value)&&(i=' selected="selected"'),['<option value="',t.value,'"',i,">",t.label,"</option>"].join("")},render:function(){v.prototype.render.call(this);t(".upfront-chosen-select-multiple",this.$el).chosen({width:this.options.select_width})},on_change:function(t){this.trigger("changed",this.get_value()),this.$el.find(".chosen-drop").css("display","none")},openOptions:function(t){v.prototype.openOptions.call(this)}}),k=g.extend({selected_state:"checked",render:function(){var e=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append(this.get_field_html()),this.$el.on("change",".upfront-field-multiple input",function(){e.$el.find(".upfront-field-multiple").each(function(){t(this).find("input:checked").size()>0?t(this).addClass("upfront-field-multiple-selected"):t(this).removeClass("upfront-field-multiple-selected")}),e.trigger("changed",e.get_value())}),this.trigger("rendered")},get_field_html:function(){return this.get_values_html()},get_value_html:function(t,e){var i=this.get_field_id()+"-"+e,s="upfront-field-multiple",n={type:this.type,id:i,name:this.get_field_name(),value:t.value,"class":"upfront-field-"+this.type},l=this.get_saved_value(),o=this.options.icon_class?this.options.icon_class:null;return this.options.layout&&(s+=" upfront-field-multiple-"+this.options.layout),t.disabled&&(n.disabled="disabled",s+=" upfront-field-multiple-disabled"),this.multiple&&_.contains(l,t.value)?n.checked="checked":this.multiple||l!=t.value||(n.checked="checked"),t.checked&&(n.checked="checked"),n.checked&&(s+=" upfront-field-multiple-selected"),'<span class="'+s+'"><input '+this.get_field_attr_html(n)+' /><label for="'+i+'">'+this.get_icon_html(t.icon,o)+'<span class="upfront-field-label-text">'+t.label+"</span></label></span>"}}),x=k.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-radios",type:"radio"}),w=k.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes",type:"checkbox",multiple:!0}),C=w.extend({className:"upfront-field-wrap upfront-field-wrap-multiple upfront-field-wrap-checkboxes upfront-field-wrap-optional",events:{"change input":"onChange"},initialize:function(t){var e=this;C.__super__.initialize.apply(this,arguments),this.options=t,this.on("panel:set",function(){this.panel.on("rendered",function(){e.onChange()})}),t.onChange&&(this.onChange=t.onChange)},onChange:function(){var e=this.$("input"),i=this.panel.$("input[name="+this.options.relatedField+"]").closest(".upfront-field-wrap");e.is(":checked")?i.show():i.hide(),t("#settings").height(this.panel.$(".upfront-settings_panel").outerHeight()),this.model.set_property(this.options.property,this.get_value());
}}),S=l.extend(_.extend({},i.Upfront_Scroll_Mixin,{events:{"click .upfront-suggest-add":"add_list","focus .upfront-field-text-suggest":"reveal_suggest","keyup .upfront-field-text-suggest":"update_suggest"},multiple:!0,selected_state:"checked",added_list:[],checked_list:[],suggest_list:[],render:function(){var i=this;this.$el.html(""),this.label&&this.$el.append(this.get_label_html()),this.$el.append('<div class="upfront-suggest-wrap" />');var s=this.$el.find(".upfront-suggest-wrap");s.append(this.get_field_html()),s.append('<div class="upfront-suggest-list-wrap upfront-no-select" />'),this.checked_list=this.get_saved_value();var n=this.$el.find(".upfront-suggest-list-wrap");n.append('<ul class="upfront-suggest-lists">'+this.get_suggest_list_html()+"</ul>"),n.append('<div class="upfront-suggest-add-wrap"><span class="upfront-suggest-add-value"></span><span class="upfront-suggest-add">'+e.add_new+"</span></div>"),this.stop_scroll_propagation(this.$el.find(".upfront-suggest-lists")),this.$el.on("change",".upfront-suggest-list input",function(){var e=t(this).val();!t(this).is(":checked")&&_.contains(i.checked_list,e)?i.checked_list=_.without(i.checked_list,e):i.checked_list.push(e),i.trigger("changed")}),this.$el.on("click",function(t){t.stopPropagation()}),t("#settings").on("click",".upfront-settings_panel",function(){i.$el.find(".upfront-suggest-list-wrap").removeClass("upfront-suggest-list-wrap-expanded")}),this.trigger("rendered")},reveal_suggest:function(){this.$el.find(".upfront-suggest-list-wrap").addClass("upfront-suggest-list-wrap-expanded"),this.update_suggest()},update_suggest:function(){var t=this.get_field_input_value();this.$el.find(".upfront-suggest-lists").html(this.get_suggest_list_html()),t?(this.$el.find(".upfront-suggest-add-wrap").show(),this.$el.find(".upfront-suggest-add-value").text(t),this.$el.find(".upfront-suggest-add").toggle(!_.contains(this.suggest_list,t))):this.$el.find(".upfront-suggest-add-wrap").hide()},get_field_html:function(){var t={type:"text","class":"upfront-field upfront-field-text upfront-field-text-suggest",id:this.get_field_id()};return this.options.placeholder&&(t.placeholder=this.options.placeholder),"<input "+this.get_field_attr_html(t)+" />"},get_suggest_list_html:function(){var t=this.get_field_input_value(),e=t?new RegExp("("+t+")","ig"):!1,i=this.get_suggest_list(e),s=this;return _.map(i,function(t,i){var n=s.get_field_id()+"-"+i,l={type:"checkbox",id:n,name:s.get_field_name(),value:t,"class":"upfront-field-checkbox"};_.contains(s.checked_list,t)&&(l.checked="checked");var o=e?t.replace(e,'<span class="upfront-suggest-match">$1</span>'):t;return'<li class="upfront-suggest-list"><input '+s.get_field_attr_html(l)+' /><label for="'+n+'">'+o+"</label></li>"}).join("")},get_suggest_list:function(t){var e=[];return _.each([this.options.source,this.added_list,this.get_saved_value()],function(i,s){_.each(i,function(i){2==s&&_.contains(e,i)||!(t&&i.match(t)||!t)||e.push(i)})}),this.suggest_list=e,e},get_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val()},empty_field_input_value:function(){return this.$el.find("#"+this.get_field_id()).val("")},add_list:function(t){var e=this.get_field_input_value();this.added_list.push(e),this.checked_list.push(e),this.empty_field_input_value(),this.update_suggest()}})),O=m.extend({initialize:function(t){m.prototype.initialize.call(this,t),this.options.values=this.get_anchors()},get_anchors:function(){var t=Settings_AnchorTrigger.prototype.get_anchors.call(this),e=[];return _(t).each(function(t){e.push({label:t,value:t})}),e}}),U=Backbone.View.extend({tagName:"li",events:{"change input":"on_change"},className:function(){var t="upfront-field-select-option";return this.model.get("default")&&(t+=" upfront-field-select-option-disabled"),this.model.get("enabled")&&(t+=" upfront-field-select-option-selected"),t},template:'<label><span class="upfront-field-label-text">{{ name }} {[ if (width > 0) { ]}({{width}}px){[ } ]}</span></label><input type="checkbox" class="upfront-field-checkbox" value="{{ id }}" {[ if (is_default) { ]} disabled="disabled"{[ } ]}{[ if (enabled) { ]} checked="checked"{[ } ]}>',initilize:function(t){this.options=t||{},this.listenTo(this.model,"change",this.render)},on_change:function(t){this.model.set({enabled:this.$el.find("input").is(":checked")})},render:function(){var t=this.model.toJSON();return t.is_default=t["default"],this.$el.append(_.template(this.template,t)),this}}),T=m.extend({className:"upfront-field-select upfront-no-select upfront-field-compact-label-select",template:'<ul class="upfront-field-select-options"><li class="upfront-field-select-option"><label><span class="upfront-field-label-text">{{ label_text }}</span></label></li></ul></div>',initialize:function(t){this.options=t||{},this.listenTo(this.collection,"add remove change:name change:width",this.render)},render:function(){this.$el.html(""),this.$el.append(_.template(this.template,this.options)),this.$el.addClass(" upfront-field-select-"+(this.options.multiple?"multiple":"single")),this.options.disabled&&this.$el.addClass("upfront-field-select-disabled"),"zebra"==this.options.style&&this.$el.addClass("upfront-field-select-zebra"),_.each(this.collection.models,function(t){var e=new U({model:t});e.render(),this.$el.find("ul").append(e.el)},this)},onOptionClick:function(t){this.$el.toggleClass("compact-label-select-open"),m.prototype.onOptionClick.call(this,t)}}),z=l.extend({className:"upfront-field-complex_field-boolean_toggleable_text upfront-field-multiple",tpl:'<input type="checkbox" class = "upfront-field-checkbox" /> <label><span class="upfront-field-label-text">{{element_label}}</span></label> <div class="upfront-embedded_toggleable" style="display:none">{{field}}<div class="upfront-embedded_toggleable-notice">'+e.anchor_nag+"</div></div>",initialize:function(t){l.prototype.initialize.call(this,t),this.options.field=new o(this.options)},render:function(){var t=this;this.$el.empty(),this.$el.append(this.get_field_html()),this.$el.on("click",":checkbox",function(e){e.stopPropagation(),t.field_toggle.apply(t)}),this.model.get_property_value_by_name(this.options.field.get_name())&&(this.$el.find(":checkbox").attr("checked",!0),this.check_value(),this.field_toggle()),this.$el.on("keyup",'[name="'+this.options.field.get_name()+'"]',function(e){e.stopPropagation(),t.check_value.apply(t)}),setTimeout(function(){t.trigger("anchor:updated")},50)},field_toggle:function(){this.$el.find(":checkbox").is(":checked")?this.$el.find(".upfront-embedded_toggleable").show():this.$el.find(".upfront-embedded_toggleable").hide(),this.property.set({value:this.get_value()}),this.trigger("anchor:updated")},check_value:function(){var t=this.$el.find('[name="'+this.options.field.get_name()+'"]'),e=this.$el.find(".upfront-embedded_toggleable"),i=t.length&&t.val?t.val():"";e.removeClass("error").removeClass("ok"),i.length&&!i.match(/^[a-zA-Z]+$/)?e.addClass("error"):i.length&&e.addClass("ok"),this.property.set({value:this.get_value()})},get_field_html:function(){this.options.field.render();var t=this.options.field.$el;return _.template(this.tpl,_.extend({},this.options,{field:t.html()}))},get_value:function(){var t=this.$el.find(":checkbox"),e=this.$el.find('[name="'+this.options.field.get_name()+'"]'),i=e.val().replace(/[^a-zA-Z]/g,"");return t.is(":checked")&&i?i:""}});return{Field:l,Text:o,Button:p,Email:r,Textarea:h,Color:f,Multiple_Suggest:S,Chosen_Select:v,Typeface_Chosen_Select:b,Typeface_Style_Chosen_Select:y,Multiple_Chosen_Select:$,Number:d,Slider:c,Select:m,Radios:x,Checkboxes:w,Hidden:u,Anchor:O,Optional:C,Field_Compact_Label_Select_Option:U,Field_Compact_Label_Select:T,Field_Complex_Toggleable_Text_Field:z,ToggleableText:a}})}(jQuery);