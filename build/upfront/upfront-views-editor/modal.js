!function(t){define([],function(){return Backbone.View.extend({attributes:function(){return{class:"upfront-inline-modal upfront-ui upfront-no-select",id:"upfront-inline-modal-"+this.cid}},initialize:function(t){this.options=t,this.$to=t.to,this.button_text=t.button_text?t.button_text:Upfront.Settings.l10n.global.content.ok,this.button="undefined"==typeof t.button||t.button,this.width="undefined"!=typeof t.width?t.width:"50%",this.top="undefined"!=typeof t.top?t.top:-1,this.left="undefined"!=typeof t.left?t.left:-1,this.right="undefined"!=typeof t.right?t.right:-1,this.keep_position="undefined"==typeof t.keep_position||t.keep_position},events:{click:"on_click","click .upfront-inline-modal-content":"on_click_content","click .upfront-inline-modal-save":"on_click_save"},render:function(){this.$el.html('<div class="upfront-inline-modal-wrap"><div class="upfront-inline-modal-content"></div></div>'),this.$el.hide()},open:function(i,o,e){var n,s,h=this.$el.find(".upfront-inline-modal-wrap"),l=this.$el.find(".upfront-inline-modal-content"),d=t('<button type="button" class="upfront-inline-modal-save">'+this.button_text+"</button>"),f={},r=o&&o.for_view&&o.for_view.$el.hasClass("upfront-region-side-lightbox");return this._deferred=t.Deferred(),this.$el.show(),i.apply(o,[l,this.$el]),e="undefined"!=typeof e?e:this.button,e&&d.appendTo(l),f.width=this.width,!r&&this.top>=0?(f.top=this.top,f.bottom="auto"):(s=this.$el.height()>t(window).height()?t(window).height():this.$el.height(),n=l.outerHeight(),this.top=s-n>0?(s-n)/2:0,r&&(this.top=22),f.top=this.top,f.bottom="auto"),this.left>=0?(f.left=this.left,f.right="auto"):this.right>=0&&(f.left="auto",f.width>0&&this.right+f.width<=t(window).width()&&(f.right=this.right,window.innerWidth<1366&&(f.right=f.width))),h.css(f),this.keep_position&&(this.update_pos(),t(window).on("scroll",this,this.on_scroll)),this.trigger("modal:open"),this._deferred.promise()},close:function(i){this.$el.hide(),t(window).off("scroll",this.on_scroll),this.trigger("modal:close"),this._deferred&&(i?this._deferred.resolve(this):this._deferred.reject(this))},on_scroll:function(t){var i=t.data;i.update_pos()},on_click:function(){this.close(!1)},on_click_content:function(t){t.stopPropagation()},on_click_save:function(){this.close(!0)},update_pos:function(){var i=t(Upfront.Settings.LayoutEditor.Selectors.main);if("none"!=this.$el.css("display")){var o=this.$el.find(".upfront-inline-modal-wrap"),e=this.$to.offset(),n=e.top,s=n+this.$to.outerHeight(),h=t(window).height(),l=t(document).scrollTop(),d=l+h,f=i.offset().top,r=50,p=this.$el.offset(),c=p.left+this.$el.width(),u=this.$el.find(".upfront-inline-modal-wrap").outerHeight(),a=n+u;l>=n-f?"fixed"!=this.$el.css("position")&&(this.$el.css({position:"fixed",top:0,bottom:0,left:p.left,right:t(window).width()-c}),o.css({top:f+this.top})):(s>a?s:a)+r>d?"fixed"!=this.$el.css("position")&&(this.$el.css({position:"fixed",top:0,bottom:0,left:p.left,right:t(window).width()-c}),o.css({top:(s>a?h-(s-n>h?h:s-n)-r:h-u-r)+this.top})):(this.$el.css({position:"",top:"",bottom:"",left:"",right:""}),o.css({top:this.top}))}}})})}(jQuery);