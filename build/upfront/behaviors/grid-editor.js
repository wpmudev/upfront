!function(e){define(["scripts/upfront/behaviors/dragdrop","scripts/upfront/behaviors/resize"],function(t,i){var r={lightbox_cols:!1,main:{$el:null,top:0,left:0,right:0},grid_layout:{top:0,left:0,right:0},containment:{$el:null,top:0,left:0,right:0,col:0,grid:{top:0,left:0,right:0}},min_col:1,max_row:0,compare_col:2,compare_row:10,focus_compare_col:1,focus_compare_row:3,update_distance:10,timeout:0,focus_timeout:500,focus:!1,focus_out_distance:50,focus_coord:{x:0,y:0},_t:null,_t_focus:null,col_size:0,baseline:0,grid:null,region_type_priority:{wide:1,clip:1,full:1,fixed:2,lightbox:2},els:[],wraps:[],regions:[],drops:[],drop:null,el_selector:"",el_selector_direct:"",module_selector:".upfront-module-view > .upfront-module, .upfront-module-group",module_selector_direct:"> .upfront-module-view > .upfront-module, > .upfront-module-group",object_selector:".upfront-object-view > .upfront-object",object_selector_direct:"> .upfront-object-view > .upfront-object",_id:0,drag_instances:{},resize_instances:{},wrapper_resize_instances:{},show_debug_element:!1,resizing:!1,_new_id:function(){var e=Upfront.Behaviors.GridEditor;return e._id++,e._id},get_grid:function(e,t){var i=Upfront.Behaviors.GridEditor,r=Upfront.Util.isRTL()?Math.round((i.grid_layout.right-e)/i.col_size)+1:Math.round((e-i.grid_layout.left)/i.col_size)+1,o=Math.ceil((t-i.grid_layout.top)/i.baseline)+1;return{x:r,y:o}},get_position:function(t){var i=Upfront.Behaviors.GridEditor,r=e(t),o=parseFloat(r.css("width")),n=parseFloat(r.css("height")),a=r.offset(),l=a.top,s=l+n,p=Upfront.Util.isRTL()?a.left+o:a.left,d=Upfront.Util.isRTL()?p-o:p+o,_=i.get_grid(p,l),c=r.data("current_col")?r.data("current_col"):Math.round(o/i.col_size),u=Math.floor(n/i.baseline),g={top:Math.round(l),left:Math.round(p),bottom:Math.round(s),right:Math.round(d)},f={top:_.y,left:_.x,right:_.x+c-1,bottom:_.y+u-1};return{$el:r,_id:i._new_id(),position:g,outer_position:g,width:o,height:n,center:{y:Math.round(l+n/2),x:Upfront.Util.isRTL()?Math.round(p-o/2):Math.round(p+o/2)},col:c,row:u,grid:f,outer_grid:f,grid_center:{y:_.y+u/2-1,x:_.x+c/2-1}}},get_region_position:function(t){var i=Upfront.Behaviors.GridEditor,r=e(t),o=r.find(".upfront-modules_container"),n=i.get_position(o);return n.$el=r,n},init_margin:function(e){var t=Upfront.Behaviors.GridEditor,i=Math.round(parseFloat(e.$el.css("margin-left"))/t.col_size),r=Math.round(parseFloat(e.$el.css("margin-top"))/t.baseline);e.$el.data("margin",{original:{left:i,top:r},current:{left:i,top:r}})},get_affected_els:function(e,t,i,r){var o={top:[],left:[],bottom:[],right:[]},n=e.outer_grid;if(Array.isArray(i)?i.push(e):i=[e],r=r?!0:!1,_.each(_.reject(t,function(e){var t=_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)});return t?!0:!1}),function(t){e.region==t.region&&e.group==t.group&&((t.outer_grid.top>=n.top&&t.outer_grid.top<n.bottom||t.outer_grid.bottom>=n.top&&t.outer_grid.bottom<=n.bottom||n.top>=t.outer_grid.top&&n.top<t.outer_grid.bottom||n.bottom>=t.outer_grid.top&&n.bottom<=t.outer_grid.bottom)&&(n.left>t.outer_grid.right&&o.left.push(t),n.right<t.outer_grid.left&&o.right.push(t)),n.top>t.outer_grid.bottom&&o.top.push(t),n.bottom<t.outer_grid.top&&o.bottom.push(t))}),r){var a=_.max(o.left,function(e){return e.outer_grid.right});o.left=_.filter(o.left,function(e){return e.outer_grid.right==a.outer_grid.right});var l=_.min(o.right,function(e){return e.outer_grid.left});o.right=_.filter(o.right,function(e){return e.outer_grid.left==l.outer_grid.left});var s=_.max(o.top,function(e){return e.outer_grid.top});o.top=_.filter(o.top,function(e){return e.outer_grid.top==s.outer_grid.top});var p=_.min(o.bottom,function(e){return e.outer_grid.top});o.bottom=_.filter(o.bottom,function(e){return e.outer_grid.top==p.outer_grid.top})}return o},get_affected_wrapper_els:function(e,t,i,r){var o=Upfront.Behaviors.GridEditor,n=o.get_affected_els(e,t,i,r),a={top:_.flatten(_.map(n.top,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_max(e,i,!0);return _.filter(t,function(e){return e.outer_grid.bottom==r.outer_grid.bottom})})),bottom:_.flatten(_.map(n.bottom,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_min(e,i,!0);return _.filter(t,function(e){return e.outer_grid.top==r.outer_grid.top})})),left:_.flatten(_.map(n.left,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_max(e,i,!1);return _.filter(t,function(e){return e.outer_grid.right==r.outer_grid.right})})),right:_.flatten(_.map(n.right,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_min(e,i,!1);return _.filter(t,function(e){return e.outer_grid.left==r.outer_grid.left})}))};return a},get_move_limit:function(e,t){var i=[t.grid.left,t.grid.right];return _.each(e.left,function(e){e.grid.right>i[0]&&(i[0]=e.grid.right+1)}),_.each(e.right,function(e){e.grid.left<i[1]&&(i[1]=e.grid.left-1)}),i},get_resize_limit:function(e,t){var i=[t.grid.left,t.grid.right];return _.each(e.left,function(e){e.grid.left>i[0]&&(i[0]=e.grid.left)}),_.each(e.right,function(e){e.grid.right<i[1]&&(i[1]=e.grid.right)}),i},get_max_size:function(e,t,i,r){var o=Upfront.Behaviors.GridEditor,n=o.get_class_num(e.$el,o.grid["class"]),r=/all|nw|se/.test(r)?r:"all",a=e.$el.data("margin"),l=o.get_affected_els(e,t,[],!0),s=o.get_move_limit(l,o.containment),p="nw"==r?n+e.grid.left-s[0]:"se"==r?n+s[1]-e.grid.right:s[1]-s[0]+1,d=i.$el.hasClass("upfront-region-expand-lock"),c=l.bottom.length?_.min(l.bottom,function(e){return e.grid.top}):!1,u=c?c.grid.top-e.grid.top:i.grid.bottom-e.grid.top,g="nw"==r?a.original.top+e.row:"se"==r?u:u+a.original.top;return{col:p,row:d||"nw"==r?g:!1}},get_wrap_els:function(t){var i=Upfront.Behaviors.GridEditor,r=t.$el.find(i.el_selector_direct);return _.map(r,function(t){var t=i.get_el(e(t));return _.find(i.els,function(e){return e._id==t._id})})},get_wrap_el_min:function(e,t,i){var r=Upfront.Behaviors.GridEditor,o=r.get_wrap_els(e),n=_.min(_.reject(o,function(e){return t?_.find(t,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),function(e){return i?e.grid.top:e.grid.left});return _.isObject(n)?n:!1},get_wrap_el_max:function(e,t,i){var r=Upfront.Behaviors.GridEditor,o=r.get_wrap_els(e),n=_.max(_.reject(o,function(e){return t?_.find(t,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),function(e){return i?e.grid.bottom:e.grid.right});return _.isObject(n)?n:!1},get_el:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.els,function(t){return e.get(0)==t.$el.get(0)})},get_wrap:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.wraps,function(t){return e.get(0)==t.$el.get(0)})},get_region:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.regions,function(t){return e.get(0)==t.$el.get(0)})},get_drop:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.drops,function(t){return e.get(0)==t.$el.get(0)})},get_class_num:function(e,t){var i=_.isString(e)?e:e.attr("class"),r=new RegExp("\\b"+t+"(\\d+)"),o=i.match(r);return o&&o[1]?parseInt(o[1],10):0},get_el_model:function(e){var t,i=Upfront.Application,r=(Upfront.Behaviors.GridEditor,i.layout.get("regions")),o=e.attr("id"),n=function(e){if(!e)return!1;var t,i=e.get_by_element_id(o);return i?i:(e.find(function(e){return e.get("modules")?(t=n(e.get("modules")),t?!0:!1):e.get("objects")?(t=a(e.get("objects")),t?!0:!1):void 0}),t)},a=function(e){if(!e)return!1;var t,i=e.get_by_element_id(o);return i?i:(e.find(function(e){return e.get("objects")?(t=a(e.get("objects")),t?!0:!1):void 0}),t)};return r.find(function(e){return t=n(e.get("modules")),t?!0:!1}),t?t:!1},update_class:function(e,t,i){var r,o,n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,a=new RegExp("\\b"+t+"\\d+");!n||n["default"]?e.hasClass(t+i)||(e.attr("class").match(a)?e.attr("class",e.attr("class").replace(a,t+i)):e.addClass(t+i)):(r=e.parent(),o=Math.round(r.width()/this.col_size),"c"==t?e.css("width",i/o*100+"%"):"ml"==t?e.css("margin-left",i/o*100+"%"):"mt"==t&&e.css("margin-top",i*this.baseline+"px"))},update_margin_classes:function(e){this.time_start("fn update_margin_classes");var t=e.data("margin"),i=Upfront.Behaviors.GridEditor;t.current!=t.original&&(i.update_class(e,i.grid.left_margin_class,t.current.left),i.update_class(e,i.grid.top_margin_class,t.current.top)),this.time_end("fn update_margin_classes")},update_model_classes:function(e,t){this.time_start("fn update_model_classes");var i=Upfront.Settings.LayoutEditor.CurrentBreakpoint,r=this.get_el_model(e);!r||i&&!i["default"]||r.replace_class(t.join(" ")),this.time_end("fn update_model_classes")},update_model_breakpoint:function(e,t){var i,r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=this.get_el_model(e);o&&r&&!r["default"]&&(i=Upfront.Util.clone(o.get_property_value_by_name("breakpoint")||{}),_.isObject(i[r.id])||(i[r.id]={}),i[r.id]=_.extend(i[r.id],t),i[r.id].edited=!0,o.set_property("breakpoint",i))},update_model_margin_classes:function(t,i){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=Upfront.Behaviors.GridEditor;t.each(function(){var t,n,a,l,s=e(this),p=s.data("margin");(p&&(p.original.left!=p.current.left||p.original.top!=p.current.top)||i)&&(a=p?p.current.top:0,l=p?p.current.left:0,!r||r["default"]?(t=[o.grid.left_margin_class+l,o.grid.top_margin_class+a],i&&(t=_.union(t,i)),o.update_model_classes(s,t)):(n={left:l,top:a},i&&_.each(i,function(e){var t=e.match(/^([A-Za-z])(\d+)$/);t&&t[1]==o.grid["class"]&&(n.col=parseInt(t[2]))}),o.update_model_breakpoint(s,n)))})},adjust_els_right:function(e,t,i){this.time_start("fn adjust_els_right");var r=Upfront.Behaviors.GridEditor;_.each(e,function(e){var o=e.$el.data("margin"),n=e.grid.left>t?e.grid.left-t-1:o.current.left;o.current.left!=n&&(o.current.left=n,i&&r.update_margin_classes(e.$el),e.$el.data("margin",o))}),this.time_end("fn adjust_els_right")},adjust_affected_right:function(e,t,i,r,o){this.time_start("fn adjust_affected_right");var n=Upfront.Behaviors.GridEditor,a=n.get_wrap_el_max(e,i),l=a?r&&r>a.grid.right?r:a.grid.right:r?r:e.grid.left-1;t=_.reject(t,function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),n.adjust_els_right(t,l,o),r+1==n.containment.grid.left&&0==n.get_wrap_els(e).length&&e.$el.nextAll(".upfront-wrapper:eq(0)").data("clear","clear"),this.time_end("fn adjust_affected_right")},adjust_els_bottom:function(e,t,i){this.time_start("fn adjust_els_bottom");var r=Upfront.Behaviors.GridEditor;_.each(e,function(e){var o=e.$el.data("margin"),n=e.grid.top>t?e.grid.top-t-1:0;o.current.top!=n&&(o.current.top=n,i&&r.update_margin_classes(e.$el),e.$el.data("margin",o))}),this.time_end("fn adjust_els_bottom")},adjust_affected_bottom:function(e,t,i,r,o){this.time_start("fn adjust_affected_bottom");var n=Upfront.Behaviors.GridEditor,a=n.get_wrap_el_max(e,i,!0),l=a?r&&r>a.grid.bottom?r:a.grid.bottom:r?r:e.grid.bottom-1;t=_.reject(t,function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),n.adjust_els_bottom(t,l,o),this.time_end("fn adjust_affected_bottom")},normalize:function(t,i){this.time_start("fn normalize");var r=Upfront.Application,o=Upfront.Behaviors.GridEditor,n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,a=r.layout.get("regions"),l=[],s=[],p=[],d=[],c=n&&!n["default"];i=_.filter(i,function(e){return e.$el.is(":visible")||e.height>0}),_.each(i,function(t){var r=t.$el.find(o.module_selector_direct+", "+o.object_selector_direct),u=o.get_region(t.$el.closest(".upfront-region")),g=0==t.$el.closest(".upfront-objects_container").length?t.$el.closest(".upfront-module-group"):!1,f=g!==!1&&g.length>0,h=f?o.get_el(g):!1,m=f?!1:t.$el.closest(".upfront-object-group"),w=m!==!1&&m.length>0,b=w?o.get_el(m):!1,v=c?t.$el.data("breakpoint_order"):t.$el.index(".upfront-wrapper"),y=!1,z=!1,U=!1,$=!1;r.each(function(t){if(!(this.offsetWidth<=0)){var i=o.get_el(e(this)),r=!n||n["default"]?o.get_class_num(i.$el,o.grid["class"]):i.$el.data("breakpoint_col");i.col<r&&i.col>0&&o.update_model_margin_classes(i.$el,[o.grid["class"]+i.col])}}),r.each(function(r){var n=o.get_el(e(this)),h=o.get_affected_els(n,i,[],!1);n.$el.data("margin");if(0==r&&(h.left.length>0||h.right.length>0)){var b=_.max(_.union(h.left,h.right),function(e){return e.outer_grid.bottom});if(b.outer_grid.bottom<n.grid.top){var x=o.get_el_model(n.$el),E=x.collection,k=E.indexOf(x),S=_.max(_.union(h.left,h.right),function(e){return e.outer_grid.left}),j=c?S.$el.data("breakpoint_order"):S.$el.index(".upfront-wrapper"),B=_.last(o.get_wrap_els(S)),M=o.get_el_model(B.$el),G=E.indexOf(M),C=n.grid.top-b.outer_grid.bottom;if(z=n.grid.top-C+1,U=u.grid.left,y=!0,n.outer_grid.top=z,!c&&G>k||c&&j>v)if(c){var L=f?o.get_el_model(g).get("wrappers"):a.get_by_name(n.region).get("wrappers"),W=t.$el.parent().find("> .upfront-wrapper").each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb),A=!1;W.each(function(i){var r=L.get_by_wrapper_id(e(this).attr("id"));this==t.$el.get(0)?(A=!0,r.set_breakpoint_property("order",j)):(r.set_breakpoint_property("order",i-1),this==S.$el.get(0)&&(A=!1))})}else $=G,t.$el.insertAfter(S.$el),d.push({collection:E,model:x,index:$});f?s.push(g):w?p.push(m):l.push(n.region)}}else if(y&&!c&&$!==!1){var x=o.get_el_model(n.$el),E=x.collection;d.push({collection:E,model:x,index:$})}}),y&&(t.outer_grid.top=z,t.grid.top=z,t.outer_grid.left=U,t.$el.data("clear","clear")),c||r.size()>1&&r.each(function(){var r=o.get_el(e(this)),n=o.get_affected_els(t,i,[],!1);if(0==n.left.length&&0==n.right.length){var a=o.get_el_model(r.$el),d=w?Upfront.data.object_views[a.cid]:Upfront.data.module_views[a.cid],_=f&&d.group_view?d.group_view:w&&d.object_group_view?d.object_group_view:d.region_view,c=f&&h?h:w&&b?b:u,v=_.model.get("wrappers"),y=Upfront.Util.get_unique_id("wrapper"),z=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:y},{name:"class",value:o.grid["class"]+(r.grid.left+r.col-c.grid.left)}]}),U=new Upfront.Views.Wrapper({model:z});v.add(z),z.add_class("clr"),U.parent_view=d.parent_view,d.wrapper_view=U,U.render(),r.$el.closest(".upfront-wrapper").before(U.$el),U.$el.append(d.$el),a.set_property("wrapper_id",y),Upfront.data.wrapper_views[z.cid]=U,o.init_margin(r),f?s.push(g):w?p.push(m):l.push(r.region)}})}),_.each(i,function(e){var t=o.get_region(e.$el.closest(".upfront-region"));t&&(c||e.outer_grid.left!=t.grid.left||e.$el.hasClass("clr")||e.$el.addClass("clr"))}),_.each(_.uniq(l),function(e){var t=a.get_by_name(e),i=Upfront.data.region_views[t.cid];o.update_wrappers(t,i.$el)}),_.each(_.uniq(s),function(e){var t=o.get_el_model(e),i=Upfront.data.module_views[t.cid];o.update_wrappers(t,i.$el)}),_.each(_.uniq(p),function(e){var t=o.get_el_model(e),i=Upfront.data.object_views[t.cid];o.update_wrappers(t,i.$el)}),c||_.each(d,function(e){e.collection.remove(e.model,{silent:!0}),e.model.add_to(e.collection,e.index)}),_.each(i,function(e){e.$el.removeData("clear")}),this.time_end("fn normalize")},init:function(){var t=(Upfront.Application,Upfront.Behaviors.GridEditor),i=e(Upfront.Settings.LayoutEditor.Selectors.main),r=i.offset();i.find(".upfront-layout");t.baseline=Upfront.Settings.LayoutEditor.Grid.baseline,t.grid=Upfront.Settings.LayoutEditor.Grid,t.col_size=t.grid.column_width,t.max_row=Math.floor(.5*e(window).height()/t.baseline),t.main={$el:i,top:r.top,bottom:r.top+i.outerHeight(),left:r.left,right:r.left+i.outerWidth()};var o=15;e(document).on("scroll",function(e){t.resizing!==!1&&t.resizing!=window.scrollY&&(window.scrollY>t.resizing?t.resizing+=o:t.resizing-=o,window.scrollTo(window.scrollX,t.resizing))})},start:function(e,t,i){this.time_start("fn start");var r=(Upfront.Application,Upfront.Behaviors.GridEditor),o=r.main.$el.offset(),n=r.main.$el.find(".upfront-layout"),a=n.offset(),l=e.$el.find(".upfront-editable_entity").eq(0).is(".upfront-object"),s=i||e.$el.closest(".upfront-editable_entities_container"),p=s.offset();r.col_size=r.grid.column_width,r.el_selector=l?r.object_selector:r.module_selector,r.el_selector_direct=l?r.object_selector_direct:r.module_selector_direct,r.main.top=o.top,r.main.bottom=o.top+r.main.$el.outerHeight(),r.main.left=o.left,r.main.right=o.left+r.main.$el.outerWidth();var d=a.left+(n.outerWidth()-r.grid.size*r.col_size)/2;r.grid_layout={top:a.top,bottom:a.top+n.outerHeight(),left:d,right:d+r.grid.size*r.col_size,layout_left:a.left,layout_right:a.left+n.outerWidth()};var _=s.outerWidth(),c=s.outerHeight(),u=Math.round(_/r.col_size),g=Math.round(c/r.baseline),f=r.get_grid(p.left,p.top);r.containment={$el:s,top:p.top,bottom:p.top+c,left:p.left,right:p.left+_,col:u,grid:{top:f.y,bottom:f.y+g-1,left:f.x,right:f.x+u-1}},r.update_position_data(s),this.time_end("fn start")},update_position_data:function(e,t){this.time_start("fn update_position_data");var i=(Upfront.Application,Upfront.Behaviors.GridEditor),r=i.main.$el.find(".upfront-layout"),o=(i.el_selector==i.object_selector,!1),n=e.find("> .upfront-wrapper"),a=r.find(".upfront-region").not(".upfront-region-locked"),l=e.closest(".upfront-region"),s=l.data("name"),p=e.closest(".upfront-module-group"),d=p.length>0?p.attr("id"):!1;"shadow"!==s?(n=n.filter(":visible"),o=n.find(i.el_selector_direct)):o=e.find("> .upfront-module-view > .upfront-module"),i.els=_.map(o,i.get_position),_.each(i.els,function(e){e.region=s,e.group=d,i.init_margin(e)}),i.wraps=_.map(n,i.get_position),_.each(i.wraps,function(e){e.region=s,e.group=d}),!1!==t&&(i.regions=_.map(a,i.get_region_position),_.each(i.regions,function(e){e.region=e.$el.closest(".upfront-region").data("name"),e.group=!1})),this.time_end("fn update_position_data")},update_wrappers:function(t,i){if(t){this.time_start("fn update_wrappers");var r=(Upfront.Application,Upfront.Behaviors.GridEditor),o=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=(r.el_selector==r.object_selector,e(Upfront.Settings.LayoutEditor.Selectors.main)),a=n.find(".upfront-layout"),l=t.get("wrappers");(i?i:a).find(".upfront-wrapper:visible").each(function(){var t=e(this),i=t.attr("id"),n=l.get_by_wrapper_id(i),a=t.data("clear"),s=_.map(t.find(r.el_selector_direct),function(t){var i=e(t);return i&&i.length?i:!1}).filter(function(e){return e!==!1});if(0==s.length)return void(n&&l.remove(n));if(!t.hasClass("upfront-wrapper-preview")&&!(t.height()<=0)&&n){var p,d=!o||o["default"]?r.get_class_num(t,r.grid["class"]):t.data("breakpoint_col"),c=_.map(s,function(e){return{$el:e,col:!o||o["default"]?r.get_class_num(e,r.grid["class"]):e.data("breakpoint_col")}}),u=_.max(c,function(e){return e?e.col:void 0}),g=u.col;r.update_class(t,r.grid["class"],g),!o||o["default"]?(d!=g&&n.replace_class(r.grid["class"]+g),a&&"clear"==a||!a&&t.hasClass("clr")?n.add_class("clr"):n.remove_class("clr")):(p=Upfront.Util.clone(n.get_property_value_by_name("breakpoint")||{}),_.isObject(p[o.id])||(p[o.id]={}),p[o.id].col=g,a&&(p[o.id].clear="clear"==a),n.set_property("breakpoint",p))}});var s=[];l.each(function(t){0==e("#"+t.get_wrapper_id()).size()&&s.push(t)}),_.each(s,function(e){l.remove(e)}),Upfront.Events.trigger("entity:wrappers:update",t),this.time_end("fn update_wrappers")}},create_resizable:function(t,i){var r,o,n,a=this,l=Upfront.Behaviors.GridEditor,s=t.$el.hasClass("upfront-module-group"),p=t.$el.hasClass("upfront-object-view"),d=s?t.$el:t.$el.find(">.upfront-editable_entity"),c="undefined"!=typeof t.group_view,u=e(Upfront.Settings.LayoutEditor.Selectors.main);u.find(".upfront-layout");return Upfront.Application.mode.current!==Upfront.Application.MODE.THEME&&i.get_property_value_by_name("disable_resize")?!1:d.hasClass("upfront-module-spacer")||d.hasClass("upfront-object-spacer")?!1:p&&"undefined"==typeof t.object_group_view?!1:d.data("ui-resizable")?(d.resizable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?(d.append('<span class="upfront-icon-control upfront-icon-control-resize-s upfront-resize-handle-s ui-resizable-handle ui-resizable-s"></span>'),void d.resizable({containment:"document",autoHide:!1,delay:50,handles:{s:".upfront-resize-handle-s"},start:function(a,s){l.start(t,i),l.resizing=window.scrollY;var p=l.get_el(d),c=d.data("margin"),u=e(this).data("ui-resizable");n=u.axis?u.axis:"se",o=e('<div class="upfront-resize-placeholder"></div>'),o.css({marginLeft:c.original.left/(p.col+c.original.left)*100+"%",marginTop:c.original.top*l.baseline,width:p.col/(p.col+c.original.left)*100+"%",height:s.originalSize.height}),r=e('<div class="upfront-resize" style="height:'+p.height+'px;"></div>'),r.css({height:p.height,width:p.width,minWidth:p.width,maxWidth:p.width,position:"absolute"}),"nw"==n?r.css({top:p.position.top,right:e("body").width()-p.position.right}):r.css({top:p.position.top,left:p.position.left}),e("body").append(r),_.each(l.els,function(e,t){l.els[t]=l.get_position(e.$el)}),_.each(l.wraps,function(e,t){l.wraps[t]=l.get_position(e.$el)}),l.normalize(l.els,l.wraps),l.update_position_data(l.containment.$el);var g=d.position(),f={left:g.left+c.original.left*l.col_size,top:g.top+c.original.top*l.baseline};d.css({marginLeft:0,marginTop:0,position:"absolute",left:f.left,top:f.top,minHeight:""}),u.originalPosition.left=f.left,u.originalPosition.top=f.top,u._updateCache({left:f.left,top:f.top}),o.insertBefore(d),t.trigger("entity:resize_start",{row:p.row,col:p.col,height:p.height,width:p.width,axis:n},t,t.model),Upfront.Events.trigger("entity:resize_start",t,t.model)},resize:function(i,a){var s=d.closest(".upfront-wrapper"),p=d.closest(".upfront-region"),c=l.get_el(d),u=l.get_wrap(s),g=l.get_region(p),f=p.hasClass("upfront-region-expand-lock"),h=c.col,m=u?l.get_affected_wrapper_els(u,l.wraps,[],!0):l.get_affected_els(c,l.els,[],!0),w=l.get_move_limit(m,l.containment),b=h+("nw"==n?c.grid.left-w[0]:w[1]-c.grid.right),v=m.bottom.length?_.min(m.bottom,function(e){return e.grid.top}):!1,y=v?v.grid.top-c.grid.top:g.grid.bottom-c.grid.top+1,z=Math.ceil(a.size.width/l.col_size),U=z>b?Math.round(b*l.col_size):a.size.width,$=(a.size.height>15?a.size.height:0)||a.originalSize.height,x=Math.ceil($/l.baseline),E=z>b?b:z,k=f&&x>y&&y>0?y:x;Math.abs(e(window).height()-i.clientY)<50&&($+=10*l.baseline,e(window).scrollTop(e(window).scrollTop()+10*l.baseline)),d.css({height:k*l.baseline,width:U,minWidth:U,maxWidth:U}),d.data("resize-col",E),d.data("resize-row",k),r.css({height:k*l.baseline,width:E*l.col_size,minWidth:E*l.col_size,maxWidth:E*l.col_size}),"nw"==n&&r.css({top:c.$el.find(">.upfront-resize-handle-nw").offset().top,marginTop:c.$el.find(">.upfront-resize-handle-se").offset().top+c.$el.find(">.upfront-resize-handle-se").height()-c.$el.find(">.upfront-resize-handle-nw").offset().top-k*l.baseline}),f||"nw"==n||o.css("height",k*l.baseline),t.update_size_hint(E*l.col_size,k*l.baseline),t.trigger("entity:resizing",{row:k,col:E,height:k*l.baseline,width:E*l.col_size,axis:n},t,t.model)},stop:function(e,s){Upfront.Events.trigger("entity:pre_resize_stop",t,t.model,s);var u,g,f=Upfront.Settings.LayoutEditor.CurrentBreakpoint,h=d.closest(".upfront-wrapper"),m=d.closest(".upfront-region"),w=l.get_el(d),b=(d.data("margin"),l.get_wrap(h)),v=(m.hasClass("upfront-region-expand-lock"),b?l.get_affected_wrapper_els(b,l.wraps,[],!0):l.get_affected_els(w,l.els,[],!0)),y=(l.get_move_limit(v,l.containment),Math.ceil(s.originalSize.width/l.col_size),Math.ceil(s.originalSize.height/l.baseline),d.find(".upost-data-object").length?d.find(".upost-data-object"):!1,d.data("resize-col")),z=parseFloat(d.data("resize-row")),U=a.layout.get("regions");U.get_by_name(m.data("name")),p?l.containment.$el:c?t.group_view.$el.find(".upfront-editable_entities_container:first"):m.find(".upfront-modules_container > .upfront-editable_entities_container:first");if(l.resizing=!1,o.remove(),r.remove(),d.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!f||f["default"]){i.set_property("row",z);var $=i.get("objects");$&&1==$.length&&$.each(function(e){e.set_property("row",z)})}else{u=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(u[f.id])||(u[f.id]={}),g=u[f.id],g.edited=!0,g.row=z,i.set_property("breakpoint",u);var $=i.get("objects");$&&1==$.length&&$.each(function(e){var t=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{});_.isObject(t[f.id])||(t[f.id]={}),t[f.id].row=z,e.set_property("breakpoint",t)})}l.update_position_data(l.containment.$el),l.normalize(l.els,l.wraps),d.removeData("resize-col"),d.removeData("resize-row"),t.trigger("entity:resize_stop",{row:z,col:y,height:z*l.baseline,width:y*l.col_size,axis:n},t,t.model),Upfront.Events.trigger("entity:resize_stop",t,t.model,s),Upfront.Events.trigger("entity:resized",t,t.model)}})):(d.data("ui-resizable")&&d.resizable("option","disabled",!1),!1)},toggle_resizables:function(t){e(".upfront-editable_entity.ui-resizable").resizable("option","disabled",!t)},resize:function(t,i,r,o,n,a){var l=Upfront.Application,s=Upfront.Behaviors.GridEditor,n=/all|nw|se/.test(n)?n:"all",p=e(Upfront.Settings.LayoutEditor.Selectors.main);p.find(".upfront-layout");s.start(t,i);var d=t.$el.find(".upfront-editable_entity:first"),_=d.find(".upfront-editable_entity"),c=d.closest(".upfront-wrapper"),u=d.closest(".upfront-region"),g=(d.data("margin"),s.get_el(d)),f=s.get_wrap(c),h=s.get_region(u),m=(u.hasClass("upfront-region-expand-lock"),f?s.get_affected_wrapper_els(f,s.wraps,[],!0):s.get_affected_els(g,s.els,[],!0),s.get_max_size(g,s.els,h,n)),w="undefined"!=typeof t.group_view,b=w?t.group_view.model:!1,v=l.layout.get("regions"),y=v.get_by_name(u.data("name")),z=(w?b:y).get("wrappers"),U=z.get_by_wrapper_id(c.attr("id"));Upfront.data.wrapper_views[U.cid];if(1>r||1>o)return!1;if(!a){d.css("min-height",""),_.css("min-height","");var $=Math.ceil(d.outerHeight()/s.baseline);o=o>$?o:$,d.css("min-height",o*s.baseline),_.css("min-height",(o-2)*s.baseline)}r=r?r>m.col?m.col:r:g.col,o=o?m.row&&o>m.row?m.row:o:g.row,s.normalize(s.els,s.wraps),s.update_position_data(s.containment.$el),s.update_class(d,s.grid["class"],r),i.set_property("row",o);var x=i.get("objects");return x&&1==x.length&&x.each(function(e){e.set_property("row",o)}),"se"!=n?i.replace_class([s.grid["class"]+r].join(" ")):i.replace_class(s.grid["class"]+r),"undefined"!=typeof t.group_view?s.update_wrappers(t.group_view.model,t.group_view.$el):s.update_wrappers(y,h.$el),t.trigger("entity:resize_stop",{row:o,col:r},t,t.model),Upfront.Events.trigger("entity:resized",t,t.model),!0},create_wrapper_resizable:function(t,i){var r,o,n,a,l,s,p,d,c,u,g,f,h,m,w,b,v,y,z,U,$,x,E,k,S=this,j=Upfront.Behaviors.GridEditor,B=t.$el,M=e(Upfront.Settings.LayoutEditor.Selectors.main);M.find(".upfront-layout");return Upfront.Application.mode.current!==Upfront.Application.MODE.THEME&&i.get_property_value_by_name("disable_resize")?!1:B.data("ui-resizable")?(B.resizable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?void B.resizable({containment:"document",autoHide:!1,delay:50,handles:{w:".upfront-resize-handle-wrapper-w",e:".upfront-resize-handle-wrapper-e"},start:function(S,M){j.time_start("fn wrapper_resize_start"),j.start(t,i),j.resizing=window.scrollY,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=!_.isUndefined(t.parent_view.object_group_view),n?(l=t.parent_view.object_group_view,s=j.get_position(l.$el)):(a=!_.isUndefined(t.parent_view.group_view),l=a?t.parent_view.group_view:t.parent_view.region_view,s=a?j.get_position(l.$el):j.get_region(l.$el));var G,C=j.get_wrap(B),L=e(this).data("ui-resizable"),W=(Upfront.Util.find_sorted(B.parent(),"> .upfront-wrapper"),j.get_affected_els(C,j.wraps,[],!0),l.model.get("wrappers")),A=n?l.model.get("objects"):l.model.get("modules"),T=j.parse_modules_to_lines(A,W,o.id,s.col);r=B.closest(".upfront-region"),v=L.axis?L.axis:"e",g=!1,G=!1,f=!1,h=!1,b=!1,p=B.find("> .upfront-module-group").length>0,U=C.col,y=j.min_col,z=j.min_col,_.each(T,function(e){_.each(e.wrappers,function(t,r){var o=!1;t.model==i&&(E=0===r,k=r===e.wrappers.length-1,w=t.spacer,E||"w"!=v?k||"e"!=v||(o=e.wrappers[r+1]):o=e.wrappers[r-1],o!==!1&&(f=o.model,h=Upfront.data.wrapper_views[f.cid],g=h.$el,G=j.get_wrap(g),b=o.spacer))})}),$=[],B.find(j.el_selector_direct).each(function(){var t=j.get_el_model(e(this)),i=n?Upfront.data.object_views[t.cid]:Upfront.data.module_views[t.cid];i&&$.push({view:i,is_group:n?!1:e(this).hasClass("upfront-module-group"),el:j.get_el(e(this))})}),p&&_.each($,function(e){if(e.is_group){var t=j.get_group_min_col(e.view);y=t>y?t:y}}),c=e('<div class="upfront-resize" style="height:'+C.height+'px;"></div>'),c.css({height:C.height,width:C.width,minWidth:C.width,maxWidth:C.width,position:"absolute"}),"w"==v?c.css({top:C.position.top,right:e("body").width()-C.position.right}):c.css({top:C.position.top,left:C.position.left}),e("body").append(c),x=[],g&&g.length&&(d=g.find("> .upfront-module-group").length>0,g.find(j.el_selector_direct).each(function(){var t=j.get_el_model(e(this)),i=n?Upfront.data.object_views[t.cid]:Upfront.data.module_views[t.cid];i&&x.push({view:i,is_group:n?!1:e(this).hasClass("upfront-module-group"),el:j.get_el(e(this))})}),d&&_.each(x,function(e){if(e.is_group){var t=j.get_group_min_col(e.view);z=t>z?t:z}}),U=C.col+G.col,w||b?w&&(U-=z,y=0):U-=z,b&&(z=0)),u=e('<div class="upfront-resize-placeholder"></div>'),u.css({width:(G?G.col+C.col:C.col)/s.col*100+"%",height:M.originalSize.height,position:"relative"}),o&&!o["default"]&&u.css("order",B.css("order")),(w||b)&&(m=e('<div class="upfront-spacer-feed"></div>'),m.css({width:j.col_size,height:"auto",top:0,bottom:0,position:"absolute"}),u.append(m)),_.each(j.els,function(e,t){j.els[t]=j.get_position(e.$el)}),_.each(j.wraps,function(e,t){j.wraps[t]=j.get_position(e.$el)}),j.normalize(j.els,j.wraps),j.update_position_data(j.containment.$el);var O=B.position(),V=g?g.position():!1;B.css({marginLeft:0,marginTop:0,position:"absolute",left:O.left,top:O.top,minHeight:""}),g&&g.css({marginLeft:0,marginTop:0,position:"absolute",top:V.top,left:V.left}),L.originalPosition.left=O.left,L.originalPosition.top=O.top,L._updateCache({left:O.left,top:O.top}),u.insertBefore(B),_.each($,function(e){e.view.trigger("entity:resize_start",{row:e.el.row,col:e.el.col,height:e.el.height,width:e.el.width,axis:v},e.view,e.view.model)}),_.each(x,function(e){e.view.trigger("entity:resize_start",{row:e.el.row,col:e.el.col,height:e.el.height,width:e.el.width,axis:"w"==v?"e":"w"},e.view,e.view.model)}),t.trigger("entity:wrapper:resize_start",{row:C.row,col:C.col,height:C.height,width:C.width,axis:v},t,t.model),h&&h.trigger("entity:wrapper:resize_start",{row:G.row,col:G.col,height:G.height,width:G.width,axis:"w"==v?"e":"w"},h,h.model),Upfront.Events.trigger("entity:wrapper:resize_start",t,t.model,h,h.model),j.time_end("fn wrapper_resize_start")},resize:function(e,i){j.time_start("fn wrapper_resize_resizing");var o=j.get_wrap(B),n=g?j.get_wrap(g):!1,a=(j.get_region(r),y*j.col_size),l=s>U?Math.round(U*j.col_size):a>i.size.width?a:i.size.width,s=Math.round(l/j.col_size),p=(i.size.height>15?i.size.height:0)||i.originalSize.height,d="w"==v?i.originalPosition.left+i.originalSize.width-l:i.position.left,u=s>U?U:s,f=U-u+z,E=(U+z)*j.col_size-l;if(B.css({left:d,height:p,width:l,minWidth:l,maxWidth:l}),B.data("resize-col",u),w&&l<j.col_size){var k=.5*Math.round((j.col_size-l)/j.col_size*100)/100;m.css({left:"e"==v?0:"auto",right:"e"==v?"auto":0,backgroundColor:"rgba(200, 0, 0, "+k+")"})}if(g&&(g.css({width:E,minWidth:E,maxWidth:E}),"e"==v&&g.css("margin-left",n.width-E),g.data("resize-col",f),b&&E<j.col_size)){var k=.5*Math.round((j.col_size-E)/j.col_size*100)/100;m.css({left:"w"==v?0:"auto",right:"w"==v?"auto":0,backgroundColor:"rgba(200, 0, 0, "+k+")"})}c.css({height:p,width:u*j.col_size,minWidth:u*j.col_size,maxWidth:u*j.col_size}),_.each($,function(e){e.view.trigger("entity:resizing",{row:e.el.row,
col:u,height:e.el.height,width:u*j.col_size,axis:v},e.view,e.view.model)}),_.each(x,function(e){e.view.trigger("entity:resizing",{row:e.el.row,col:f,height:e.el.height,width:f*j.col_size,axis:"w"==v?"e":"w"},e.view,e.view.model)}),t.trigger("entity:wrapper:resizing",{row:o.row,col:u,height:o.height,width:u*j.col_size,axis:v},t,t.model),h&&h.trigger("entity:wrapper:resizing",{row:n.row,col:f,height:n.height,width:f*j.col_size,axis:"w"==v?"e":"w"},h,h.model),j.time_end("fn wrapper_resize_resizing")},stop:function(e,a){j.time_start("fn wrapper_resize_stop"),Upfront.Events.trigger("entity:wrapper:pre_resize_stop",t,t.model,a);var s=j.get_wrap(B),p=g?j.get_wrap(g):!1,d=(Math.ceil(a.originalSize.width/j.col_size),B.data("resize-col")),m=g?g.data("resize-col"):0,y=S.layout.get("regions"),z=(y.get_by_name(r.data("name")),"w"==v&&E),M="e"==v&&k;j.resizing=!1,u.remove(),c.remove(),B.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),g&&g.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!f&&(z||M)&&U-d>0?t.add_spacer(z?"left":"right",U-d,U,n):(d>0?o&&!o["default"]?(i.set_breakpoint_property("edited",!0,!0),i.set_breakpoint_property("col",d),_.each($,function(e){e.view.model.set_breakpoint_property("edited",!0,!0),e.view.model.set_breakpoint_property("col",d)})):(i.replace_class(j.grid["class"]+d),_.each($,function(e){e.view.model.replace_class(j.grid["class"]+d)})):w&&(i.collection.remove(i),_.each($,function(e){e.view.model.collection.remove(e.view.model)})),f&&(m>0?o&&!o["default"]?(f.set_breakpoint_property("edited",!0,!0),f.set_breakpoint_property("col",m),_.each(x,function(e){e.view.model.set_breakpoint_property("edited",!0,!0),e.view.model.set_breakpoint_property("col",m)})):(f.replace_class(j.grid["class"]+m),_.each(x,function(e){e.view.model.replace_class(j.grid["class"]+m)})):b&&(f.collection.remove(f),_.each(x,function(e){e.view.model.collection.remove(e.view.model)})))),n?l.model.get("objects").each(function(e){e.set_breakpoint_property("edited",!0,!0)}):l.model.get("modules").each(function(e){e.set_breakpoint_property("edited",!0,!0)}),l.model.get("wrappers").each(function(e){e.set_breakpoint_property("edited",!0,!0)}),j.update_position_data(j.containment.$el),j.normalize(j.els,j.wraps),B.removeData("resize-col"),g&&g.removeData("resize-col"),_.each($,function(e){e.view.trigger("entity:resize_stop",{row:e.el.row,col:d,height:e.el.height,width:d*j.col_size,axis:v},e.view,e.view.model)}),_.each(x,function(e){e.view.trigger("entity:resize_stop",{row:e.el.row,col:m,height:e.el.height,width:m*j.col_size,axis:"w"==v?"e":"w"},e.view,e.view.model)}),t.trigger("entity:wrapper:resize_stop",{row:s.row,col:d,height:s.height,width:d*j.col_size,axis:v},t,t.model),t.trigger("entity:wrapper:resize",{col:d},t,t.model),h&&(h.trigger("entity:wrapper:resize_stop",{row:p.row,col:m,height:p.height,width:d*j.col_size,axis:"w"==v?"e":"w"},h,h.model),h.trigger("entity:wrapper:resize",{col:m},h,h.model)),Upfront.Events.trigger("entity:wrapper:resize_stop",t,t.model,h,h.model,a),Upfront.Events.trigger("entity:wrapper:resized",t,t.model,h,h.model),j.time_end("fn wrapper_resize_stop")}}):(B.data("ui-resizable")&&B.resizable("option","disabled",!1),B.find(".upfront-resize-handle-wrapper").remove(),!1)},get_group_min_col:function(e){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=Upfront.Behaviors.GridEditor,r=e.model.get("modules"),o=e.model.get("wrappers"),n=!t||t["default"]?i.get_class_num(e.$el,i.grid["class"]):e.$el.data("breakpoint_col"),a=i.parse_modules_to_lines(r,o,t?t.id:"desktop",n),l=i.min_col;return _.each(a,function(e){var t=0;_.each(e.wrappers,function(e){t+=e.spacer?1:i.min_col}),t>l&&(l=t)}),l},create_draggable:function(e,i){var r=Upfront.Behaviors.GridEditor;r.drag_instances[e.cid]?r.drag_instances[e.cid].setup():(r.drag_instances[e.cid]=new t(e,i),i.on("remove",function(){delete r.drag_instances[e.cid]}))},toggle_draggables:function(t){e(".upfront-editable_entity.ui-draggable").draggable("option","disabled",!t)},parse_modules_to_lines:function(e,t,i,r){var o=Upfront.Behaviors.GridEditor,n={},a=[],l=[],s=0,p=0;return e.each(function(e,a){var l=e.get_wrapper_id(),s=t.get_by_wrapper_id(l),p=s?s.get_property_value_by_name("breakpoint"):!1,d=p&&i in p?p[i]:{},_=s?s.get_property_value_by_name("class"):"",c=o.get_class_num(_,o.grid["class"]),u=!!_.match(/clr/),g=e.get_property_value_by_name("breakpoint"),f=g&&i in g?g[i]:{},h=e.get_property_value_by_name("default_hide"),m=e.get_property_value_by_name("hide"),w=e.get_property_value_by_name("class"),b=o.get_class_num(w,o.grid["class"]),v=!!w.match(/(upfront-module-spacer|upfront-object-spacer)/),y=a,z=a,U={};s&&("desktop"!=i&&(m="hide"in f?f.hide:h,b="col"in f?parseInt(f.col,10):b,y="order"in f?1e4*parseInt(f.order,10)+y:y,c="col"in d?parseInt(d.col,10):c,z="order"in d?1e4*parseInt(d.order,10)+z:z,u="clear"in d?d.clear:u),m===!1&&(m=h),m&&v||(U={model:e,col:b,order:y,spacer:v,hide:m},b>c&&(c=b),c>r&&(c=r),l in n?(n[l].modules.push(U),n[l].col=c):n[l]={model:s,modules:[U],order:z,col:c,clear:u,spacer:v}))}),a=_.sortBy(n,function(e,t){return e.order}),_.each(a,function(e,t){(t>0&&e.clear||s>0&&s+e.col>r)&&(l[p].col=s,p++,s=0),_.isUndefined(l[p])&&(l[p]={wrappers:[],col:0}),s+=e.col,l[p].wrappers.push(e),l[p].col=s}),l},get_container_col:function(e,t){var i=Upfront.Behaviors.GridEditor,r=!_.isUndefined(e.group_view),o=!_.isUndefined(e.object_group_view),n=(r?e.group_view:o?e.object_group_view.parent_module_view:e.region_view).model.get_property_value_by_name("breakpoint"),a=n&&t.id in n?n[t.id]:{},l=o?e.object_group_view.parent_module_view.$el.find("> .upfront-module"):(r?e.group_view:e.region_view).$el,s=t["default"]?i.get_class_num(l,i.grid["class"]):_.isNumber(a.col)?a.col:t.columns;return s>t.columns?t.columns:s},normalize_module_remove:function(e,t,i,r,o){var n=(Upfront.Application,Upfront.Behaviors.GridEditor),a=(i.indexOf(t),Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled());!_.isUndefined(e.group_view),!_.isUndefined(e.object_group_view);_.each(a,function(r){var a,l,s,p,d,c,u=r.toJSON(),g=n.get_container_col(e,u),f=n.parse_modules_to_lines(i,o,u.id,g),h=!1,m=!1,w=[],b=[];if(_.each(f,function(e){a||(s=!1,p=!1,_.each(e.wrappers,function(i){l&&!p&&(p=i),_.each(i.modules,function(r){t==r.model&&(l=i,a=e)}),l||(s=i)}))}),a){if(p&&(c=p.model.get_property_value_by_name("class"),c.match(/clr/g)||(m=!0)),s&&(d=s.model.get_property_value_by_name("class"),d.match(/clr/g)&&!m&&(h=!0)),_.each(a.wrappers,function(e){e!=l&&(w.push(e),e.spacer&&b.push(e))}),w.length>=2&&(m=!1),1==l.modules.length){var v=g,y=0,z=0;_.each(b,function(e){v-=e.col}),w.length==b.length?_.each(w,function(e,t){_.each(e.modules,function(e){i.remove(e.model)}),o.remove(e.model)}):(y=Math.floor(v/(w.length-b.length)),z=v-(w.length-b.length)*y,_.each(w,function(e,t){if(!_.contains(b,e)){var i=e.model.get_property_value_by_name("class"),r=e.model.get_property_value_by_name("breakpoint"),o=r&&u.id in r?r[u.id]:{},a=y;z>0&&(a+=1,z-=1),u["default"]?(e.model.replace_class(n.grid["class"]+a+(0!=t||i.match(/clr/g)?"":" clr")),_.each(e.modules,function(e){e.model.replace_class(n.grid["class"]+a)})):(o.col=a,0!=t||o.clear||(o.clear=!0),e.model.set_property("breakpoint",Upfront.Util.clone(r)),_.each(e.modules,function(e){var t=e.model.get_property_value_by_name("breakpoint"),i=t&&u.id in t?t[u.id]:{};i.col=a,e.model.set_property("breakpoint",Upfront.Util.clone(t))}))}}))}if(u["default"]&&(h||m)){var U=!1;_.each(h?s.modules:p.modules,function(e,t){var i=e.model.get_property_value_by_name("class"),r=n.get_class_num(i,n.grid["class"]),a=Upfront.data.module_views[e.model.cid],l=h?s:p,d=Upfront.data.wrapper_views[l.model.cid],_=U?Upfront.data.wrapper_views[U.cid]:d;if(t>0){var c=Upfront.Util.get_unique_id("wrapper"),u=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:c},{name:"class",value:n.grid["class"]+r+" clr"}]}),g=new Upfront.Views.Wrapper({model:u});o.add(u),g.parent_view=a.parent_view,a.wrapper_view=g,g.render(),g.$el.append(a.$el),_.$el.after(g.$el),Upfront.data.wrapper_views[u.cid]=g,e.model.set_property("wrapper_id",c),U=u}})}}})},adapt_to_breakpoint:function(e,t,i,r,o){var n=(Upfront.Application,Upfront.Behaviors.GridEditor),a=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:i}).toJSON(),l=Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON(),o=o===!0?!0:!1,s=n.parse_modules_to_lines(e,t,l.id,l.columns),p=n.parse_modules_to_lines(e,t,i,r),d=n._filter_edited_lines(p,a),c=[],u=[],g=[],f=[],h=[],m=[],w=[];n._wrapper_index=0,_.each(s,function(e,t){_.each(e.wrappers,function(i,r){if(!i.spacer){var o=i.model.get_breakpoint_property_value("edited",!1,!1,a);if(o)return void n._wrapper_index++;n._wrapper_index++,c.push({prev:n._find_prev_wrapper_from_lines(i,r,e,t,s),next:n._find_next_wrapper_from_lines(i,r,e,t,s),current:i,order:n._wrapper_index})}})}),0!=c.length&&(c=_.filter(c,function(e,t){return t==e.order-1?(u.push(e),!1):n._wrapper_index==e.order+(c.length-t-1)?(g.push(e),!1):!0}),m=n._adapt_wrappers_to_line(u,r),f=n._adapt_wrappers_to_line(c,r),h=f.slice(0),w=n._adapt_wrappers_to_line(g,r),n._wrapper_index=0,_.each(m,function(e){n._set_adapt_wrappers(e.wrappers,r,o,a)}),_.each(d,function(e,t){var i=t>0?d[t-1]:!1;t<d.length-1?d[t+1]:!1;_.each(e.wrappers,function(t,l){var s=[];_.each(h,function(t,l){var p=t.prev_wrapper,d=t.next_wrapper,c=!1,u=Math.floor(r/t.wrappers.length);r-u*t.wrappers.length;_.each(t.wrappers,function(t){n._find_wrapper_in_line(p,i)?c=!0:n._find_wrapper_in_line(d,e)&&!n._find_wrapper_in_line(p,e)&&(c=!0)}),c&&(n._set_adapt_wrappers(t.wrappers,r,o,a),s.push(l))}),_.each(s,function(e,t){h.splice(e-t,1)}),n._wrapper_index++,t.model.set_breakpoint_property("order",n._wrapper_index,o,a)})}),_.each(_.union(h,w),function(e){n._set_adapt_wrappers(e.wrappers,r,o,a)}))},_set_adapt_wrappers:function(e,t,i,r){var o=Math.floor(t/e.length),n=t-o*e.length,a=this;_.each(e,function(e,t){var l=o;n>0&&(l++,n--),a._wrapper_index++,e.current.model.set_breakpoint_property("clear",0==t,i,r),e.current.model.set_breakpoint_property("col",l,i,r),e.current.model.set_breakpoint_property("order",a._wrapper_index,i,r),_.each(e.current.modules,function(e,t){e.model.set_breakpoint_property("col",l,i,r)})})},_filter_edited_lines:function(e,t){return _.filter(e,function(e){var i=!1;return _.each(e.wrappers,function(e){if(!e.spacer&&!i){var r=e.model.get_breakpoint_property_value("edited",!1,!1,t);return r?void 0:void(i=!0)}}),!i})},_adapt_wrappers_to_line:function(e,t){var i=0,r=[],o=[],n=!1,a=!1,l=!1;return _.each(e,function(s,p){var d=n&&s.order-n.order>1;if((d||i+s.current.col>t)&&o.length>0&&(r.push({wrappers:o,col:i,prev_wrapper:a,next_wrapper:l}),o=[],i=0,d&&(a=!1,l=!1)),a===!1&&(a=s.prev),l===!1){l=s.next;for(var _=p+1;_<e.length&&!(e[_].order-s.order>1);_++)l=e[_].next}i+=s.current.col,o.push(s),n=s}),o.length>0&&r.push({wrappers:o,col:i,prev_wrapper:a,next_wrapper:l}),r},_find_prev_wrapper_from_lines:function(e,t,i,r,o){if(t>0){if(!i.wrappers[t-1].spacer)return i.wrappers[t-1];if(t>1)return i.wrappers[t-2]}if(r>0)for(var n=o[r-1].wrappers.length-1;n>=0;n--)if(!o[r-1].wrappers[n].spacer)return o[r-1].wrappers[n];return!1},_find_next_wrapper_from_lines:function(e,t,i,r,o){if(t<i.wrappers.length-1){if(!i.wrappers[t+1].spacer)return i.wrappers[t+1];if(t<i.wrappers.length-2)return i.wrappers[t+2]}if(r<o.length-1)for(var n=0;n<o[r+1].wrappers.length;n++)if(!o[r+1].wrappers[n].spacer)return o[r+1].wrappers[n];return!1},_find_wrapper_in_line:function(e,t){return t&&t.wrappers&&e?0==t.wrappers.length?!1:_.find(t.wrappers,function(t,i){return e.model.cid==t.model.cid}):!1},adapt_region_to_breakpoint:function(e,t,i,r){var o=(Upfront.Application,Upfront.Behaviors.GridEditor,Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON()),r=r===!0?!0:!1;e.each(function(e){var n=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{}),a=e.get_property_value_by_name("col"),l=e.get("sub");_.isObject(n[t])||(n[t]={edited:!1}),n[t].edited||(e.is_main()||!l||l.match(/^(left|right)$/)?n[t].col=o.columns:l.match(/^lightbox$/)&&a>i&&(n[t].col=i)),e.set_property("breakpoint",n,r)})},create_region_resizable:function(t,i){var r,o,n,a=Upfront.Behaviors.GridEditor,l=t.$el,s=e(Upfront.Settings.LayoutEditor.Selectors.main),p=(s.find(".upfront-layout"),i.collection),d=(p.indexOf(i),p.size()-1,i.get("sub")),c=(i.get("container"),{}),u=function(){var e={top:i.get_property_value_by_name("top"),left:i.get_property_value_by_name("left"),bottom:i.get_property_value_by_name("bottom"),right:i.get_property_value_by_name("right"),width:i.get_property_value_by_name("width"),height:i.get_property_value_by_name("height")};return e.is_top="number"==typeof e.top,e.is_left="number"==typeof e.left,e.is_bottom="number"==typeof e.bottom,e.is_right="number"==typeof e.right,e};return l.data("ui-resizable")?!1:void((i.is_main()||!d||d.match(/^(fixed|left|right)$/))&&(i.is_main()?(r=["s"],o={s:".upfront-region-resize-handle-s"}):"left"==d?(r=["e","s"],o={e:".upfront-region-resize-handle-e",s:".upfront-region-resize-handle-s"}):"right"==d?(r=["w","s"],o={w:".upfront-region-resize-handle-w",s:".upfront-region-resize-handle-s"}):"fixed"==d&&(c=u(),c.is_top&&c.is_left||c.is_bottom&&c.is_right?(r=["nw","se"],o={nw:".upfront-region-resize-handle-nw",se:".upfront-region-resize-handle-se"}):(r=["ne","sw"],o={ne:".upfront-region-resize-handle-ne",sw:".upfront-region-resize-handle-sw"})),_.each(r,function(e){var t=e.match(/^(e|w|s|n)$/)?"upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-"+e:"upfront-icon-control upfront-icon-control-resize upfront-icon-control-resize-"+e;l.append('<div class="'+t+" upfront-region-resize-handle upfront-region-resize-handle-"+e+" ui-resizable-handle ui-resizable-"+e+'"></div>')}),l.resizable({containment:"document",handles:o,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(i,r){var o=(a.get_class_num(l,a.grid["class"]),e(this).data("ui-resizable")),s=r.helper;if(n=o.axis?o.axis:"se",a.resizing=window.scrollY,e(this).resizable("option","minWidth",3*a.col_size),"fixed"!=d)e(this).resizable("option","maxWidth",10*a.col_size);else{e(this).resizable("option","minHeight",3*a.baseline),l.css("position",""),t.update_region_position(),c=u();var p=l.position();o.originalPosition.left=p.left,o.originalPosition.top=p.top,o.originalSize.width=c.width,o.originalSize.height=c.height,o._updateCache({left:p.left,top:p.top}),s.css({marginLeft:0,marginTop:0,left:p.left,top:p.top,position:"fixed"})}Upfront.Events.trigger("entity:region:resize_start",t,t.model)},resize:function(e,i){var r=i.helper;if("fixed"!=d)if("s"==n){var o=Math.abs(Math.ceil(i.size.height/a.baseline)),p=Math.round(o*a.baseline);r.css({height:p,width:i.originalSize.width,minWidth:i.originalSize.width,maxWidth:i.originalSize.width}),t.update_size_hint(i.originalSize.width,p),l.data("resize-row",o)}else{var _=a.get_class_num(l,a.grid["class"]),u=l.prevAll(".upfront-region:first"),g=l.nextAll(".upfront-region:first"),f=u.size()>0?a.get_class_num(u,a.grid["class"]):0,h=g.size()>0?a.get_class_num(g,a.grid["class"]):0,m=_+(h>f?h:f),w=Math.abs(Math.ceil(i.size.width/a.col_size)),b=w>m?m:w,v=Math.round(b*a.col_size);r.css({height:i.originalSize.height,width:v,minWidth:v,maxWidth:v,marginLeft:"w"==n?i.size.width-v:0}),t.update_size_hint(v,i.originalSize.height),l.data("resize-col",b)}else{var y,z,U=(l.offset(),s.offset(),l.height()),$=l.width(),x=max_width=!1;c.is_top&&(x="nw"==n||"ne"==n?c.top+U:!1),!c.is_top&&c.is_bottom&&(x="se"==n||"sw"==n?c.bottom+U:!1),c.is_left&&(max_width="nw"==n||"sw"==n?c.left+$:!1),!c.is_left&&c.is_right&&(max_width="se"==n||"ne"==n?c.right+$:!1),z=Math.round(x&&i.size.height>x?x:i.size.height),y=Math.round(max_width&&i.size.width>max_width?max_width:i.size.width),r.css({height:z,width:y}),t.update_size_hint(y,z,r),l.data("resize-height",z),l.data("resize-width",y)}},stop:function(e,r){var o,s,p=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(a.resizing=!1,l.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",right:"",bottom:""}),"fixed"!=d){var u=l.data("resize-col"),g=l.data("resize-row");!p||p["default"]?(u&&i.set_property("col",u),g&&i.set_property("row",g)):(u||g)&&(o=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(o[p.id])||(o[p.id]={}),s=o[p.id],s.edited=!0,u&&(s.col=u),g&&(s.row=g),i.set_property("breakpoint",o)),l.removeData("resize-col"),l.removeData("resize-row")}else{var f=l.data("resize-width"),h=l.data("resize-height"),u=Math.floor(f/a.col_size);"nw"!=n&&"ne"!=n||!c.is_top||i.set_property("top",c.top+c.height-h),"se"!=n&&"sw"!=n||c.is_top||!c.is_bottom||i.set_property("bottom",c.bottom+c.height-h),"nw"!=n&&"sw"!=n||!c.is_left||i.set_property("left",c.left+c.width-f),"se"!=n&&"ne"!=n||c.is_left||!c.is_right||i.set_property("right",c.right+c.width-f),i.set_property("width",f,!0),i.set_property("height",h,!0),i.set_property("col",u,!0),i.get("properties").trigger("change"),l.removeData("resize-width"),l.removeData("resize-height")}Upfront.Events.trigger("entity:region:resize_stop",t,t.model)}})))},create_region_draggable:function(t,i){if(i.get("container")&&i.get("container")!=i.get("name")){var r=(Upfront.Behaviors.GridEditor,t.$el),o=e(Upfront.Settings.LayoutEditor.Selectors.main),n=(o.find(".upfront-layout"),t.parent_view.get_container_view(i)),a=i.get("sub"),l={},s=!1,p=function(){var e={top:i.get_property_value_by_name("top"),left:i.get_property_value_by_name("left"),bottom:i.get_property_value_by_name("bottom"),right:i.get_property_value_by_name("right"),width:i.get_property_value_by_name("width"),height:i.get_property_value_by_name("height")};return e.is_top="number"==typeof e.top,e.is_left="number"==typeof e.left,e.is_bottom="number"==typeof e.bottom,e.is_right="number"==typeof e.right,e},d={},_="";return"fixed"!=a?!1:r.data("ui-draggable")?!1:void r.draggable({disabled:!0,revert:!0,revertDuration:0,zIndex:100,helper:"clone",delay:15,scroll:!1,iframeFix:!0,start:function(e,t){var o=t.helper,n=r.width(),a=r.height();o.css("width",n),o.css("height",a),r.hide(),l=p(),s=i.get("restrict_to_container"),_=o.css("position")},drag:function(i,r){var a,l,s,p,c=r.helper,u=o.offset(),g=o.width(),f=n.$el.offset(),h=n.$el.height(),m=f.top+h,w=e(window).scrollTop(),b=e(window).height(),v=w+b,y=g/2+u.left,z="fixed"==_||h>b?b/2:h/2,U=r.position.left,$=r.position.top,x=c.width(),E=c.height(),k=x/2+U,S=E/2+$;d={},"absolute"==_&&h>b&&v>=m&&(z=h-b/2),z>=S?(a="fixed"==_||b>h||m>=v?0:h-b,s=a>$?a:$,d.top=s-a):(a="fixed"==_||h>b&&f.top>=w?b-E:h-E,s=$>a?a:$,d.bottom=a-s),y>=k?(l=u.left,p=l>U?l:U,d.left=p-l):(l=g-x+u.left,p=U>l?l:U,d.right=l-p),t.update_position_hint(d,c),r.position.top=s,r.position.left=p},stop:function(e,t){r.show(),"number"==typeof d.top?(i.set_property("top",d.top,!0),i.remove_property("bottom",!0)):"number"==typeof d.bottom&&(i.set_property("bottom",d.bottom,!0),i.remove_property("top",!0)),"number"==typeof d.left?(i.set_property("left",d.left,!0),i.remove_property("right",!0)):"number"==typeof d.right&&(i.set_property("right",d.right,!0),i.remove_property("left",!0)),i.get("properties").trigger("change")}})}},create_region_container_resizable:function(t,i){var r=Upfront.Behaviors.GridEditor,o=t.$el,n=e(Upfront.Settings.LayoutEditor.Selectors.main),a=i.get("sub"),l="s",s={},p=n.find(".upfront-layout");return o.data("ui-resizable")?!1:(i.is_main()||"bottom"!=a||(l="n"),o.append('<div class="upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-'+l+" upfront-region-resize-handle upfront-region-resize-handle-"+l+" ui-resizable-handle ui-resizable-"+l+'"></div>'),s[l]=".upfront-region-resize-handle-"+l,void o.resizable({containment:"document",handles:s,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(e,i){Upfront.Events.trigger("entity:region_container:resize_start",t,t.model),Upfront.Events.trigger("command:region:edit_toggle",!1),r._prepare_resize_auto_scroll(i,p.find("> .upfront-regions"))},resize:function(n,a){var l=a.helper,s=(a.size.height>15?a.size.height:0)||a.originalSize.height,p=Math.ceil(s/r.baseline),d=e(this).data("ui-resizable");l.css({width:o.width(),height:p*r.baseline}),o.data("resize-row",p);var c=Upfront.data.region_views[i.cid];c&&c.update_size_hint(c.$el.width(),p*r.baseline),_.each(t.sub_model,function(e){var t=Upfront.data.region_views[e.cid];t&&(t.$el.hasClass("upfront-region-side-left")||t.$el.hasClass("upfront-region-side-right"))&&t.update_size_hint(t.$el.width(),p*r.baseline)}),r._start_resize_auto_scroll(n,a,s,d)},stop:function(e,n){var a,l,s=Upfront.Settings.LayoutEditor.CurrentBreakpoint,p=o.data("resize-row");o.css({width:"",minHeight:"",height:"",maxHeight:"",position:"",top:"",left:""}),r._clear_resize_auto_scroll(),!s||s["default"]?i.set_property("row",p):(a=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(a[s.id])||(a[s.id]={}),l=a[s.id],l.edited=!0,l.row=p,i.set_property("breakpoint",a)),o.removeData("resize-row"),Upfront.Events.trigger("entity:region_container:resize_stop",t,t.model),Upfront.Events.trigger("command:region:edit_toggle",!0),r.resizing=!1}}))},_auto_scroll_t:!1,_auto_scroll_data:{},_auto_scroll_step:3,_auto_scroll_timeout:100,_prepare_resize_auto_scroll:function(t,i){var r=e(document).height(),o=e('<div class="upfront-auto-scroller"></div>');o.css({width:1,height:0,visibility:"hidden"}).appendTo(i?i:"body"),this._auto_scroll_data={document_height:r,position_top:t.originalPosition.top,position_height:t.originalSize.height,position_rest:r-(t.originalPosition.top+t.originalSize.height),$scroller:o}},_start_resize_auto_scroll:function(t,i,r,o){var n=this,a=e(window).height(),l=Math.abs(a-t.clientY),s=r-this._auto_scroll_data.position_height,p=s-this._auto_scroll_data.position_rest,d=0,_=this._auto_scroll_step*this.baseline,c=i.helper;clearTimeout(this._auto_scroll_t),l>50||(this._auto_scroll_t=setTimeout(function(){d+=_,p+d>0&&n._auto_scroll_data.$scroller.height(p+d+l),o.size.height=r+d,o.parentData.height=e(document).height(),c.css("height",o.size.height),e(window).scrollTop(e(window).scrollTop()+_),o._trigger("resize",t,i)},this._auto_scroll_timeout))},_clear_resize_auto_scroll:function(){this._auto_scroll_data.$scroller.remove(),clearTimeout(this._auto_scroll_t)},toggle_region_resizable:function(t){var i,r=e(Upfront.Settings.LayoutEditor.Selectors.main);t?(i=e(r.hasClass("upfront-region-fixed-editing")?".upfront-region-side-fixed":".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip, .upfront-region-sub-container"),i.each(function(){e(this).data("ui-resizable")&&e(this).resizable("option","disabled",!1)})):e(".upfront-region, .upfront-region-container").each(function(){e(this).data("ui-resizable")&&e(this).resizable("option","disabled",!0)})},toggle_region_draggable:function(t){var i,r=e(Upfront.Settings.LayoutEditor.Selectors.main);t?(i=e(r.hasClass("upfront-region-fixed-editing")?".upfront-region-side-fixed":".upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip"),i.each(function(){e(this).data("ui-draggable")&&e(this).draggable("option","disabled",!1)})):e(".upfront-region, .upfront-region-container").each(function(){e(this).data("ui-draggable")&&e(this).draggable("option","disabled",!0)})},edit_structure:function(){var t=Upfront.Behaviors.GridEditor,i=Upfront.Application,r=Upfront.Settings.LayoutEditor.Grid,o=e('<div class="upfront-edit-grid-wrap clearfix" />'),n=e('<div class="upfront-edit-grid upfront-edit-grid-recommended" />'),a=e('<div class="upfront-edit-grid upfront-edit-grid-custom" />'),l=e('<div class="upfront-edit-page-color" />'),s=e('<div class="upfront-grid-width-preview">Grid width: <span class="upfront-grid-width" /></div>'),p=e('<div class="upfront-grid-width-preview">( Grid width: <span class="upfront-grid-width" /> )</div>'),d=r.column_width!=r.column_widths[r.size_name]||r.type_padding!=r.type_paddings[r.size_name]||r.baseline!=r.baselines[r.size_name]||!/^(0|5|10|15)$/.test(r.column_padding),c=function(){var e="custom"==g.grid.get_value(),i={column_width:e?g.custom_width.get_value():r.column_widths[r.size_name],column_padding:e?g.custom_padding.get_value():g.recommended_padding.get_value(),baseline:e?g.custom_baseline.get_value():r.baselines[r.size_name],type_padding:e?g.custom_type_padding.get_value():r.type_paddings[r.size_name]},o=i.column_width*r.size;s.find(".upfront-grid-width").text(o+"px"),p.find(".upfront-grid-width").text(o+"px"),t.update_grid(i)},u=new Upfront.Views.Editor.Command_ToggleGrid,g={structure:new Upfront.Views.Editor.Field.Radios({label:Upfront.Settings.l10n.global.behaviors.structure,layout:"vertical",default_value:i.layout.get("layout_slug")||"blank",icon_class:"upfront-structure-field-icon",values:[{label:"",value:"blank",icon:"blank"},{label:"",value:"wide",icon:"wide-no-sidebar"},{label:"",value:"wide-right-sidebar",icon:"wide-right-sidebar"},{label:"",value:"wide-left-sidebar",icon:"wide-left-sidebar"},{label:"",value:"clip",icon:"clip-no-sidebar"},{label:"",value:"clip-right-sidebar",icon:"clip-right-sidebar"},{label:"",value:"clip-left-sidebar",icon:"clip-left-sidebar"},{label:"",value:"full",icon:"full"},{label:"",value:"full-extended",icon:"full-extended"}],change:function(){if("upfront"===Upfront.themeExporter.currentTheme){var e=g.structure.get_value(),t=i.layout.get("layout_slug");(t&&t!=e||!t&&"blank"!=e)&&(i.layout.set("layout_slug",e),Upfront.Application.get_gridstate()&&u.on_click(),i.create_layout(_upfront_post_data.layout,{layout_slug:e}),Upfront.Events.once("layout:render",function(){Upfront.Application.get_gridstate()||u.on_click()}))}}}),grid:new Upfront.Views.Editor.Field.Radios({label:Upfront.Settings.l10n.global.behaviors.grid_settings,layout:"horizontal-inline",default_value:d?"custom":"recommended",values:[{label:Upfront.Settings.l10n.global.behaviors.recommended_settings,value:"recommended"},{label:Upfront.Settings.l10n.global.behaviors.custom_settings,value:"custom"}],change:function(){var e=this.get_value();"custom"==e?(a.show(),n.hide()):(n.show(),a.hide()),c()}}),recommended_padding:new Upfront.Views.Editor.Field.Select({default_value:r.column_padding,values:[{label:Upfront.Settings.l10n.global.behaviors.padding_large,value:"15"},{label:Upfront.Settings.l10n.global.behaviors.padding_medium,value:"10"},{label:Upfront.Settings.l10n.global.behaviors.padding_small,value:"5"},{label:Upfront.Settings.l10n.global.behaviors.no_padding,value:"0"}],change:c}),bg_color:new Upfront.Views.Editor.Field.Color({model:i.layout,label:Upfront.Settings.l10n.global.behaviors.page_bg_color,label_style:"inline",property:"background_color",spectrum:{move:function(e){var t=e.toRgb(),r="rgba("+t.r+","+t.g+","+t.b+","+e.alpha+")";i.layout.set_property("background_color",r)}}}),custom_width:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.column_width,label_style:"inline",min:40,max:100,default_value:r.column_width,change:c}),custom_padding:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.column_padding,label_style:"inline",min:0,max:100,default_value:r.column_padding,change:c}),custom_baseline:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.baseline_grid,label_style:"inline",min:5,max:100,default_value:r.baseline,change:c}),custom_type_padding:new Upfront.Views.Editor.Field.Number({label:Upfront.Settings.l10n.global.behaviors.additional_type_padding,label_style:"inline",min:0,max:100,default_value:r.type_padding,change:c}),floated:new Upfront.Views.Editor.Field.Checkboxes({multiple:!1,default_value:!0,values:[{label:Upfront.Settings.l10n.global.behaviors.allow_floats_outside_main_grid,value:!0}]})};t.structure_modal||(t.structure_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!0,top:120,width:540}),t.structure_modal.render(),e("body").append(t.structure_modal.el)),Upfront.Application.get_gridstate()||u.on_click(),t.structure_modal.open(function(e,t){t.addClass("upfront-structure-modal"),_.each(g,function(e){e.render(),e.delegateEvents()}),e.html(""),"upfront"===Upfront.themeExporter.currentTheme&&e.append(g.structure.el),e.append(g.grid.el),n.append(g.recommended_padding.el),n.append(s),o.append(n),a.append(g.custom_width.el),a.append(p),a.append(g.custom_padding.el),a.append(g.custom_baseline.el),a.append(g.custom_type_padding.el),l.append(g.bg_color.el),o.append(a),o.append(l),e.append(o),e.append(g.floated.el),g.grid.trigger("changed")},t).always(function(){Upfront.Application.get_gridstate()&&u.on_click()})},update_grid:function(t){var i=Upfront.Application,r=Upfront.Settings.LayoutEditor.Grid,o=i.layout.get_property_value_by_name("grid")||{column_widths:{},column_paddings:{},baselines:{},type_paddings:{}},n=Upfront.Settings.LayoutEditor.CurrentBreakpoint||Upfront.Settings.LayoutEditor.Grid.size_name,a=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:_.isObject(n)?n.id:n}),l=!1;t.column_width&&(o.column_widths[r.size_name]=t.column_width,a.get_property_value_by_name("column_width")!=t.column_width&&(a.set_property("column_width",t.column_width),l=!0)),"column_padding"in t&&(o.column_paddings[r.size_name]=t.column_padding,a.get_property_value_by_name("column_padding")!=t.column_padding&&(a.set_property("column_padding",t.column_padding),l=!0)),t.baseline&&(t.baseline!=r.baseline&&(clearTimeout(this._load_editor_css),this._load_editor_css=setTimeout(function(){Upfront.Util.post({action:"upfront_load_editor_grid",baseline:t.baseline},"text").success(function(t){e("#upfront-editor-grid-inline").length?e("#upfront-editor-grid-inline").html(t):e("head").append('<style id="upfront-editor-grid-inline">'+t+"</style>")})},1e3)),o.baselines[r.size_name]=t.baseline,a.get_property_value_by_name("baseline")!=t.baseline&&(a.set_property("baseline",t.baseline),l=!0)),t.type_padding&&(o.type_paddings[r.size_name]=t.type_padding,a.get_property_value_by_name("type_padding")!=t.type_padding&&(a.set_property("type_padding",t.type_padding),l=!0)),Upfront.Settings.LayoutEditor.Grid=_.extend(r,t),i.layout.set_property("grid",o),i.layout_view.update_grid_css(),this.init(),l&&Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME&&a.trigger("change:enabled",a)},apply_grid:function(){var e=Upfront.Behaviors.GridEditor,t=Upfront.Application,i=Upfront.Settings.LayoutEditor.Grid,r=t.layout.get_property_value_by_name("grid");if(r&&r.column_widths&&r.column_widths[i.size_name])return e.update_grid({column_width:r.column_widths[i.size_name],column_padding:r.column_paddings[i.size_name],baseline:r.baselines[i.size_name],type_padding:r.type_paddings[i.size_name]})},time_start:function(e){this.show_debug_element&&console.time(e)},time_end:function(e){this.show_debug_element&&console.timeEnd(e)},set_timeout:function(e){this.timeout=e},set_compare_size:function(e,t){this.compare_col=e,this.compare_row=t},toggle_debug:function(){this.show_debug_element=!this.show_debug_element,this.show_debug_element?this.render_debug():this.delete_debug()},render_debug:function(){var t=this,i=e(Upfront.Settings.LayoutEditor.Selectors.main);$modal=e('<div id="behavior-debug" class="upfront-inline-modal"></div>'),$wrap=e('<div class="upfront-inline-modal-wrap"></div>'),field_delay=new Upfront.Views.Editor.Field.Number({name:"delay",label:Upfront.Settings.l10n.global.behaviors.delay_before_drag,label_style:"inline",min:0,max:2e3,step:1,default_value:300,change:function(){e(".upfront-module.ui-draggable, .upfront-module-group.ui-draggable, .upfront-object.ui-draggable").draggable("option","delay",this.get_value())}}),field_timeout=new Upfront.Views.Editor.Field.Number({
name:"timeout",label:Upfront.Settings.l10n.global.behaviors.delay_before_changing_position,label_style:"inline",min:0,max:2e3,step:1,default_value:t.timeout,change:function(){t.timeout=parseInt(this.get_value(),10)}}),field_debug=new Upfront.Views.Editor.Field.Checkboxes({name:"debug",multiple:!1,default_value:!0,values:[{label:Upfront.Settings.l10n.global.behaviors.show_debug_info,value:!0}],change:function(){t.show_debug_element=this.get_value()?!0:!1}}),$close=e('<a href="#" class="upfront-close-debug">'+Upfront.Settings.l10n.global.behaviors.close+"</a>"),i.addClass("show-debug"),field_delay.render(),$wrap.append(field_delay.$el),field_timeout.render(),$wrap.append(field_timeout.$el),field_debug.render(),$wrap.append(field_debug.$el),$wrap.append($close),$modal.append($wrap),e("body").append($modal),$modal.css({top:"auto",left:"auto",bottom:0,right:0,position:"fixed"}),$wrap.css({width:360,top:0,padding:"10px",position:"relative"}),$close.on("click",function(){t.show_debug_element=!1,t.delete_debug()})},delete_debug:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.removeClass("show-debug"),e("#behavior-debug").remove()}};return r})}(jQuery);