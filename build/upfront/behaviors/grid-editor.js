!function(e){define(["scripts/upfront/behaviors/dragdrop","scripts/upfront/behaviors/resize"],function(t,i){var r={lightbox_cols:!1,main:{$el:null,top:0,left:0,right:0},grid_layout:{top:0,left:0,right:0},containment:{$el:null,top:0,left:0,right:0,col:0,grid:{top:0,left:0,right:0}},min_col:1,max_row:0,compare_col:2,compare_row:10,focus_compare_col:1,focus_compare_row:3,update_distance:10,timeout:0,focus_timeout:500,focus:!1,focus_out_distance:50,focus_coord:{x:0,y:0},_t:null,_t_focus:null,col_size:0,baseline:0,grid:null,region_type_priority:{wide:1,clip:1,full:1,fixed:2,lightbox:2},els:[],wraps:[],regions:[],drops:[],drop:null,el_selector:"",el_selector_direct:"",module_selector:".upfront-module-view > .upfront-module, .upfront-module-group",module_selector_direct:"> .upfront-module-view > .upfront-module, > .upfront-module-group",object_selector:".upfront-object-view > .upfront-object",object_selector_direct:"> .upfront-object-view > .upfront-object",_id:0,drag_instances:{},resize_instances:{},wrapper_resize_instances:{},show_debug_element:!1,resizing:!1,_new_id:function(){var e=Upfront.Behaviors.GridEditor;return e._id++,e._id},get_grid:function(e,t){var i=Upfront.Behaviors.GridEditor,r=Upfront.Util.isRTL()?Math.round((i.grid_layout.right-e)/i.col_size)+1:Math.round((e-i.grid_layout.left)/i.col_size)+1,o=Math.ceil((t-i.grid_layout.top)/i.baseline)+1;return{x:r,y:o}},get_position:function(t){var i=Upfront.Behaviors.GridEditor,r=e(t),o=parseFloat(r.css("width")),n=parseFloat(r.css("height")),a=r.offset(),s=a.top,l=s+n,p=Upfront.Util.isRTL()?a.left+o:a.left,_=Upfront.Util.isRTL()?p-o:p+o,d=i.get_grid(p,s),c=r.data("current_col")?r.data("current_col"):Math.round(o/i.col_size),u=Math.floor(n/i.baseline),g={top:Math.round(s),left:Math.round(p),bottom:Math.round(l),right:Math.round(_)},f={top:d.y,left:d.x,right:d.x+c-1,bottom:d.y+u-1};return{$el:r,_id:i._new_id(),position:g,outer_position:g,width:o,height:n,center:{y:Math.round(s+n/2),x:Upfront.Util.isRTL()?Math.round(p-o/2):Math.round(p+o/2)},col:c,row:u,grid:f,outer_grid:f,grid_center:{y:d.y+u/2-1,x:d.x+c/2-1}}},get_region_position:function(t){var i=Upfront.Behaviors.GridEditor,r=e(t),o=r.find(".upfront-modules_container"),n=i.get_position(o);return n.$el=r,n},init_margin:function(e){var t=Upfront.Behaviors.GridEditor,i=Math.round(parseFloat(e.$el.css("margin-left"))/t.col_size),r=Math.round(parseFloat(e.$el.css("margin-top"))/t.baseline);e.$el.data("margin",{original:{left:i,top:r},current:{left:i,top:r}})},get_affected_els:function(e,t,i,r){var o={top:[],left:[],bottom:[],right:[]},n=e.outer_grid;if(Array.isArray(i)?i.push(e):i=[e],r=r?!0:!1,_.each(_.reject(t,function(e){var t=_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)});return t?!0:!1}),function(t){e.region==t.region&&e.group==t.group&&((t.outer_grid.top>=n.top&&t.outer_grid.top<n.bottom||t.outer_grid.bottom>=n.top&&t.outer_grid.bottom<=n.bottom||n.top>=t.outer_grid.top&&n.top<t.outer_grid.bottom||n.bottom>=t.outer_grid.top&&n.bottom<=t.outer_grid.bottom)&&(n.left>t.outer_grid.right&&o.left.push(t),n.right<t.outer_grid.left&&o.right.push(t)),n.top>t.outer_grid.bottom&&o.top.push(t),n.bottom<t.outer_grid.top&&o.bottom.push(t))}),r){var a=_.max(o.left,function(e){return e.outer_grid.right});o.left=_.filter(o.left,function(e){return e.outer_grid.right==a.outer_grid.right});var s=_.min(o.right,function(e){return e.outer_grid.left});o.right=_.filter(o.right,function(e){return e.outer_grid.left==s.outer_grid.left});var l=_.max(o.top,function(e){return e.outer_grid.top});o.top=_.filter(o.top,function(e){return e.outer_grid.top==l.outer_grid.top});var p=_.min(o.bottom,function(e){return e.outer_grid.top});o.bottom=_.filter(o.bottom,function(e){return e.outer_grid.top==p.outer_grid.top})}return o},get_affected_wrapper_els:function(e,t,i,r){var o=Upfront.Behaviors.GridEditor,n=o.get_affected_els(e,t,i,r),a={top:_.flatten(_.map(n.top,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_max(e,i,!0);return _.filter(t,function(e){return e.outer_grid.bottom==r.outer_grid.bottom})})),bottom:_.flatten(_.map(n.bottom,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_min(e,i,!0);return _.filter(t,function(e){return e.outer_grid.top==r.outer_grid.top})})),left:_.flatten(_.map(n.left,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_max(e,i,!1);return _.filter(t,function(e){return e.outer_grid.right==r.outer_grid.right})})),right:_.flatten(_.map(n.right,function(e){var t=_.reject(o.get_wrap_els(e),function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),r=o.get_wrap_el_min(e,i,!1);return _.filter(t,function(e){return e.outer_grid.left==r.outer_grid.left})}))};return a},get_move_limit:function(e,t){var i=[t.grid.left,t.grid.right];return _.each(e.left,function(e){e.grid.right>i[0]&&(i[0]=e.grid.right+1)}),_.each(e.right,function(e){e.grid.left<i[1]&&(i[1]=e.grid.left-1)}),i},get_resize_limit:function(e,t){var i=[t.grid.left,t.grid.right];return _.each(e.left,function(e){e.grid.left>i[0]&&(i[0]=e.grid.left)}),_.each(e.right,function(e){e.grid.right<i[1]&&(i[1]=e.grid.right)}),i},get_max_size:function(e,t,i,r){var o=Upfront.Behaviors.GridEditor,n=o.get_class_num(e.$el,o.grid["class"]),r=/all|nw|se/.test(r)?r:"all",a=e.$el.data("margin"),s=o.get_affected_els(e,t,[],!0),l=o.get_move_limit(s,o.containment),p="nw"==r?n+e.grid.left-l[0]:"se"==r?n+l[1]-e.grid.right:l[1]-l[0]+1,d=i.$el.hasClass("upfront-region-expand-lock"),c=s.bottom.length?_.min(s.bottom,function(e){return e.grid.top}):!1,u=c?c.grid.top-e.grid.top:i.grid.bottom-e.grid.top,g="nw"==r?a.original.top+e.row:"se"==r?u:u+a.original.top;return{col:p,row:d||"nw"==r?g:!1}},get_wrap_els:function(t){var i=Upfront.Behaviors.GridEditor,r=t.$el.find(i.el_selector_direct);return _.map(r,function(t){var t=i.get_el(e(t));return _.find(i.els,function(e){return e._id==t._id})})},get_wrap_el_min:function(e,t,i){var r=Upfront.Behaviors.GridEditor,o=r.get_wrap_els(e),n=_.min(_.reject(o,function(e){return t?_.find(t,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),function(e){return i?e.grid.top:e.grid.left});return _.isObject(n)?n:!1},get_wrap_el_max:function(e,t,i){var r=Upfront.Behaviors.GridEditor,o=r.get_wrap_els(e),n=_.max(_.reject(o,function(e){return t?_.find(t,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),function(e){return i?e.grid.bottom:e.grid.right});return _.isObject(n)?n:!1},get_el:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.els,function(t){return e.get(0)==t.$el.get(0)})},get_wrap:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.wraps,function(t){return e.get(0)==t.$el.get(0)})},get_region:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.regions,function(t){return e.get(0)==t.$el.get(0)})},get_drop:function(e){var t=Upfront.Behaviors.GridEditor;return _.find(t.drops,function(t){return e.get(0)==t.$el.get(0)})},get_class_num:function(e,t){var i=_.isString(e)?e:e.attr("class"),r=new RegExp("\\b"+t+"(\\d+)"),o=i.match(r);return o&&o[1]?parseInt(o[1],10):0},get_el_model:function(e){var t,i=Upfront.Application,r=(Upfront.Behaviors.GridEditor,i.layout.get("regions")),o=e.attr("id"),n=function(e){if(!e)return!1;if(!e.get_by_element_id&&"function"!=typeof e.get_by_element_id)return!1;var t,i=e.get_by_element_id(o);return i?i:(e.find(function(e){return e.get("modules")?(t=n(e.get("modules")),t?!0:!1):e.get("objects")?(t=a(e.get("objects")),t?!0:!1):void 0}),t)},a=function(e){if(!e)return!1;if(!e.get_by_element_id&&"function"!=typeof e.get_by_element_id)return!1;var t,i=e.get_by_element_id(o);return i?i:(e.find(function(e){return e.get("objects")?(t=a(e.get("objects")),t?!0:!1):void 0}),t)};return r.find(function(e){return t=n(e.get("modules")),t?!0:!1}),t?t:!1},update_class:function(e,t,i){var r,o,n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,a=new RegExp("\\b"+t+"\\d+");!n||n["default"]?e.hasClass(t+i)||(e.attr("class").match(a)?e.attr("class",e.attr("class").replace(a,t+i)):e.addClass(t+i)):(r=e.parent(),o=Math.round(r.width()/this.col_size),"c"==t?e.css("width",i/o*100+"%"):"ml"==t?e.css("margin-left",i/o*100+"%"):"mt"==t&&e.css("margin-top",i*this.baseline+"px"))},update_margin_classes:function(e){this.time_start("fn update_margin_classes");var t=e.data("margin"),i=Upfront.Behaviors.GridEditor;t.current!=t.original&&(i.update_class(e,i.grid.left_margin_class,t.current.left),i.update_class(e,i.grid.top_margin_class,t.current.top)),this.time_end("fn update_margin_classes")},update_model_classes:function(e,t){this.time_start("fn update_model_classes");var i=Upfront.Settings.LayoutEditor.CurrentBreakpoint,r=this.get_el_model(e);!r||i&&!i["default"]||r.replace_class(t.join(" ")),this.time_end("fn update_model_classes")},update_model_breakpoint:function(e,t){var i,r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=this.get_el_model(e);o&&r&&!r["default"]&&(i=Upfront.Util.clone(o.get_property_value_by_name("breakpoint")||{}),_.isObject(i[r.id])||(i[r.id]={}),i[r.id]=_.extend(i[r.id],t),i[r.id].edited=!0,o.set_property("breakpoint",i))},update_model_margin_classes:function(t,i){var r=Upfront.Settings.LayoutEditor.CurrentBreakpoint,o=Upfront.Behaviors.GridEditor;t.each(function(){var t,n,a,s,l=e(this),p=l.data("margin");(p&&(p.original.left!=p.current.left||p.original.top!=p.current.top)||i)&&(a=p?p.current.top:0,s=p?p.current.left:0,!r||r["default"]?(t=[o.grid.left_margin_class+s,o.grid.top_margin_class+a],i&&(t=_.union(t,i)),o.update_model_classes(l,t)):(n={left:s,top:a},i&&_.each(i,function(e){var t=e.match(/^([A-Za-z])(\d+)$/);t&&t[1]==o.grid["class"]&&(n.col=parseInt(t[2]))}),o.update_model_breakpoint(l,n)))})},adjust_els_right:function(e,t,i){this.time_start("fn adjust_els_right");var r=Upfront.Behaviors.GridEditor;_.each(e,function(e){var o=e.$el.data("margin"),n=e.grid.left>t?e.grid.left-t-1:o.current.left;o.current.left!=n&&(o.current.left=n,i&&r.update_margin_classes(e.$el),e.$el.data("margin",o))}),this.time_end("fn adjust_els_right")},adjust_affected_right:function(e,t,i,r,o){this.time_start("fn adjust_affected_right");var n=Upfront.Behaviors.GridEditor,a=n.get_wrap_el_max(e,i),s=a?r&&r>a.grid.right?r:a.grid.right:r?r:e.grid.left-1;t=_.reject(t,function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),n.adjust_els_right(t,s,o),r+1==n.containment.grid.left&&0==n.get_wrap_els(e).length&&e.$el.nextAll(".upfront-wrapper:eq(0)").data("clear","clear"),this.time_end("fn adjust_affected_right")},adjust_els_bottom:function(e,t,i){this.time_start("fn adjust_els_bottom");var r=Upfront.Behaviors.GridEditor;_.each(e,function(e){var o=e.$el.data("margin"),n=e.grid.top>t?e.grid.top-t-1:0;o.current.top!=n&&(o.current.top=n,i&&r.update_margin_classes(e.$el),e.$el.data("margin",o))}),this.time_end("fn adjust_els_bottom")},adjust_affected_bottom:function(e,t,i,r,o){this.time_start("fn adjust_affected_bottom");var n=Upfront.Behaviors.GridEditor,a=n.get_wrap_el_max(e,i,!0),s=a?r&&r>a.grid.bottom?r:a.grid.bottom:r?r:e.grid.bottom-1;t=_.reject(t,function(e){return i?_.find(i,function(t){return t.$el.get(0)==e.$el.get(0)}):!1}),n.adjust_els_bottom(t,s,o),this.time_end("fn adjust_affected_bottom")},normalize:function(t,i){this.time_start("fn normalize");var r=Upfront.Application,o=Upfront.Behaviors.GridEditor,n=Upfront.Settings.LayoutEditor.CurrentBreakpoint,a=r.layout.get("regions"),s=[],l=[],p=[],d=[],c=n&&!n["default"];i=_.filter(i,function(e){return e.$el.is(":visible")||e.height>0}),_.each(i,function(t){var r=t.$el.find(o.module_selector_direct+", "+o.object_selector_direct),u=o.get_region(t.$el.closest(".upfront-region")),g=0==t.$el.closest(".upfront-objects_container").length?t.$el.closest(".upfront-module-group"):!1,f=g!==!1&&g.length>0,h=f?o.get_el(g):!1,m=f?!1:t.$el.closest(".upfront-object-group"),w=m!==!1&&m.length>0,b=w?o.get_el(m):!1,v=c?t.$el.data("breakpoint_order"):t.$el.index(".upfront-wrapper"),y=!1,z=!1,U=!1,$=!1;r.each(function(t){if(!(this.offsetWidth<=0)){var i=o.get_el(e(this)),r=!n||n["default"]?o.get_class_num(i.$el,o.grid["class"]):i.$el.data("breakpoint_col");i.col<r&&i.col>0&&o.update_model_margin_classes(i.$el,[o.grid["class"]+i.col])}}),r.each(function(r){var n=o.get_el(e(this)),h=o.get_affected_els(n,i,[],!1);n.$el.data("margin");if(0==r&&(h.left.length>0||h.right.length>0)){var b=_.max(_.union(h.left,h.right),function(e){return e.outer_grid.bottom});if(b.outer_grid.bottom<n.grid.top){var x=o.get_el_model(n.$el),E=x.collection,k=E.indexOf(x),j=_.max(_.union(h.left,h.right),function(e){return e.outer_grid.left}),S=c?j.$el.data("breakpoint_order"):j.$el.index(".upfront-wrapper"),B=_.last(o.get_wrap_els(j)),M=o.get_el_model(B.$el),G=E.indexOf(M),L=n.grid.top-b.outer_grid.bottom;if(z=n.grid.top-L+1,U=u.grid.left,y=!0,n.outer_grid.top=z,!c&&G>k||c&&S>v)if(c){var W=f?o.get_el_model(g).get("wrappers"):a.get_by_name(n.region).get("wrappers"),C=t.$el.parent().find("> .upfront-wrapper").each(Upfront.Util.normalize_sort_elements_cb).sort(Upfront.Util.sort_elements_cb),T=!1;C.each(function(i){var r=W.get_by_wrapper_id(e(this).attr("id"));this==t.$el.get(0)?(T=!0,r.set_breakpoint_property("order",S)):(r.set_breakpoint_property("order",i-1),this==j.$el.get(0)&&(T=!1))})}else $=G,t.$el.insertAfter(j.$el),d.push({collection:E,model:x,index:$});f?l.push(g):w?p.push(m):s.push(n.region)}}else if(y&&!c&&$!==!1){var x=o.get_el_model(n.$el),E=x.collection;d.push({collection:E,model:x,index:$})}}),y&&(t.outer_grid.top=z,t.grid.top=z,t.outer_grid.left=U,t.$el.data("clear","clear")),c||r.size()>1&&r.each(function(){var r=o.get_el(e(this)),n=o.get_affected_els(t,i,[],!1);if(0==n.left.length&&0==n.right.length){var a=o.get_el_model(r.$el),_=w?Upfront.data.object_views[a.cid]:Upfront.data.module_views[a.cid],d=f&&_.group_view?_.group_view:w&&_.object_group_view?_.object_group_view:_.region_view,c=f&&h?h:w&&b?b:u,v=d.model.get("wrappers"),y=Upfront.Util.get_unique_id("wrapper"),z=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:y},{name:"class",value:o.grid["class"]+(r.grid.left+r.col-c.grid.left)}]}),U=new Upfront.Views.Wrapper({model:z});v.add(z),z.add_class("clr"),U.parent_view=_.parent_view,_.wrapper_view=U,U.render(),r.$el.closest(".upfront-wrapper").before(U.$el),U.$el.append(_.$el),a.set_property("wrapper_id",y),Upfront.data.wrapper_views[z.cid]=U,o.init_margin(r),f?l.push(g):w?p.push(m):s.push(r.region)}})}),_.each(i,function(e){var t=o.get_region(e.$el.closest(".upfront-region"));t&&(c||e.outer_grid.left!=t.grid.left||e.$el.hasClass("clr")||e.$el.addClass("clr"))}),_.each(_.uniq(s),function(e){var t=a.get_by_name(e),i=Upfront.data.region_views[t.cid];o.update_wrappers(t,i.$el)}),_.each(_.uniq(l),function(e){var t=o.get_el_model(e),i=Upfront.data.module_views[t.cid];o.update_wrappers(t,i.$el)}),_.each(_.uniq(p),function(e){var t=o.get_el_model(e),i=Upfront.data.object_views[t.cid];o.update_wrappers(t,i.$el)}),c||_.each(d,function(e){e.collection.remove(e.model,{silent:!0}),e.model.add_to(e.collection,e.index)}),_.each(i,function(e){e.$el.removeData("clear")}),this.time_end("fn normalize")},init:function(){var t=(Upfront.Application,Upfront.Behaviors.GridEditor),i=e(Upfront.Settings.LayoutEditor.Selectors.main),r=i.offset();i.find(".upfront-layout");t.baseline=Upfront.Settings.LayoutEditor.Grid.baseline,t.grid=Upfront.Settings.LayoutEditor.Grid,t.col_size=t.grid.column_width,t.max_row=Math.floor(.5*e(window).height()/t.baseline),t.main={$el:i,top:r.top,bottom:r.top+i.outerHeight(),left:r.left,right:r.left+i.outerWidth()};var o=15;e(document).on("scroll",function(e){t.resizing!==!1&&t.resizing!=window.scrollY&&(window.scrollY>t.resizing?t.resizing+=o:t.resizing-=o,window.scrollTo(window.scrollX,t.resizing))})},start:function(e,t,i){this.time_start("fn start");var r=(Upfront.Application,Upfront.Behaviors.GridEditor),o=r.main.$el.offset(),n=r.main.$el.find(".upfront-layout"),a=n.offset(),s=e.$el.find(".upfront-editable_entity").eq(0).is(".upfront-object"),l=i||e.$el.closest(".upfront-editable_entities_container"),p=l.offset();r.col_size=r.grid.column_width,r.el_selector=s?r.object_selector:r.module_selector,r.el_selector_direct=s?r.object_selector_direct:r.module_selector_direct,r.main.top=o.top,r.main.bottom=o.top+r.main.$el.outerHeight(),r.main.left=o.left,r.main.right=o.left+r.main.$el.outerWidth();var _=a.left+(n.outerWidth()-r.grid.size*r.col_size)/2;r.grid_layout={top:a.top,bottom:a.top+n.outerHeight(),left:_,right:_+r.grid.size*r.col_size,layout_left:a.left,layout_right:a.left+n.outerWidth()};var d=l.outerWidth(),c=l.outerHeight(),u=Math.round(d/r.col_size),g=Math.round(c/r.baseline),f=r.get_grid(p.left,p.top);r.containment={$el:l,top:p.top,bottom:p.top+c,left:p.left,right:p.left+d,col:u,grid:{top:f.y,bottom:f.y+g-1,left:f.x,right:f.x+u-1}},r.update_position_data(l),this.time_end("fn start")},update_position_data:function(e,t){this.time_start("fn update_position_data");var i=(Upfront.Application,Upfront.Behaviors.GridEditor),r=i.main.$el.find(".upfront-layout"),o=(i.el_selector==i.object_selector,!1),n=e.find("> .upfront-wrapper"),a=r.find(".upfront-region").not(".upfront-region-locked"),s=e.closest(".upfront-region"),l=s.data("name"),p=e.closest(".upfront-module-group"),d=p.length>0?p.attr("id"):!1;"shadow"!==l?(n=n.filter(":visible"),o=n.find(i.el_selector_direct)):o=e.find("> .upfront-module-view > .upfront-module"),i.els=_.map(o,i.get_position),_.each(i.els,function(e){e.region=l,e.group=d,i.init_margin(e)}),i.wraps=_.map(n,i.get_position),_.each(i.wraps,function(e){e.region=l,e.group=d}),!1!==t&&(i.regions=_.map(a,i.get_region_position),_.each(i.regions,function(e){e.region=e.$el.closest(".upfront-region").data("name"),e.group=!1})),this.time_end("fn update_position_data")},update_wrappers:function(t,i){if(t){this.time_start("fn update_wrappers");var r=(Upfront.Application,Upfront.Behaviors.GridEditor),o=Upfront.Settings.LayoutEditor.CurrentBreakpoint,n=(r.el_selector==r.object_selector,e(Upfront.Settings.LayoutEditor.Selectors.main)),a=n.find(".upfront-layout"),s=t.get("wrappers");(i?i:a).find(".upfront-wrapper:visible").each(function(){var t=e(this),i=t.attr("id"),n=s.get_by_wrapper_id(i),a=t.data("clear"),l=_.map(t.find(r.el_selector_direct),function(t){var i=e(t);return i&&i.length?i:!1}).filter(function(e){return e!==!1});if(0==l.length)return void(n&&s.remove(n));if(!t.hasClass("upfront-wrapper-preview")&&!(t.height()<=0)&&n){var p,d=!o||o["default"]?r.get_class_num(t,r.grid["class"]):t.data("breakpoint_col"),c=_.map(l,function(e){return{$el:e,col:!o||o["default"]?r.get_class_num(e,r.grid["class"]):e.data("breakpoint_col")}}),u=_.max(c,function(e){return e?e.col:void 0}),g=u.col;r.update_class(t,r.grid["class"],g),!o||o["default"]?(d!=g&&n.replace_class(r.grid["class"]+g),a&&"clear"==a||!a&&t.hasClass("clr")?n.add_class("clr"):n.remove_class("clr")):(p=Upfront.Util.clone(n.get_property_value_by_name("breakpoint")||{}),_.isObject(p[o.id])||(p[o.id]={}),p[o.id].col=g,a&&(p[o.id].clear="clear"==a),n.set_property("breakpoint",p))}});var l=[];s.each(function(t){0==e("#"+t.get_wrapper_id()).size()&&l.push(t)}),_.each(l,function(e){s.remove(e)}),Upfront.Events.trigger("entity:wrappers:update",t),this.time_end("fn update_wrappers")}},create_resizable:function(t,i){var r,o,n,a=this,s=Upfront.Behaviors.GridEditor,l=t.$el.hasClass("upfront-module-group"),p=t.$el.hasClass("upfront-object-view"),d=l?t.$el:t.$el.find(">.upfront-editable_entity"),c="undefined"!=typeof t.group_view,u=e(Upfront.Settings.LayoutEditor.Selectors.main);u.find(".upfront-layout");return!1===Upfront.plugins.isRequiredByPlugin("setup resizeable")&&i.get_property_value_by_name("disable_resize")?!1:d.hasClass("upfront-module-spacer")||d.hasClass("upfront-object-spacer")?!1:p&&"undefined"==typeof t.object_group_view?!1:d.data("ui-resizable")?(d.resizable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?(d.append('<span class="upfront-icon-control upfront-icon-control-resize-s upfront-resize-handle-s ui-resizable-handle ui-resizable-s"></span>'),void d.resizable({containment:"document",autoHide:!1,delay:50,handles:{s:".upfront-resize-handle-s"},start:function(a,l){s.start(t,i),s.resizing=window.scrollY;var p=s.get_el(d),c=d.data("margin"),u=e(this).data("ui-resizable");n=u.axis?u.axis:"se",o=e('<div class="upfront-resize-placeholder"></div>'),o.css({marginLeft:c.original.left/(p.col+c.original.left)*100+"%",marginTop:c.original.top*s.baseline,width:p.col/(p.col+c.original.left)*100+"%",height:l.originalSize.height}),r=e('<div class="upfront-resize" style="height:'+p.height+'px;"></div>'),r.css({height:p.height,width:p.width,minWidth:p.width,maxWidth:p.width,position:"absolute"}),"nw"==n?r.css({top:p.position.top,right:e("body").width()-p.position.right}):r.css({top:p.position.top,left:p.position.left}),e("body").append(r),_.each(s.els,function(e,t){s.els[t]=s.get_position(e.$el)}),_.each(s.wraps,function(e,t){s.wraps[t]=s.get_position(e.$el)}),s.normalize(s.els,s.wraps),s.update_position_data(s.containment.$el);var g=d.position(),f={left:g.left+c.original.left*s.col_size,top:g.top+c.original.top*s.baseline};d.css({marginLeft:0,marginTop:0,position:"absolute",left:f.left,top:f.top,minHeight:""}),u.originalPosition.left=f.left,u.originalPosition.top=f.top,u._updateCache({left:f.left,top:f.top}),o.insertBefore(d),t.trigger("entity:resize_start",{row:p.row,col:p.col,height:p.height,width:p.width,axis:n},t,t.model),Upfront.Events.trigger("entity:resize_start",t,t.model)},resize:function(i,a){var l=d.closest(".upfront-wrapper"),p=d.closest(".upfront-region"),c=s.get_el(d),u=s.get_wrap(l),g=s.get_region(p),f=p.hasClass("upfront-region-expand-lock"),h=c.col,m=u?s.get_affected_wrapper_els(u,s.wraps,[],!0):s.get_affected_els(c,s.els,[],!0),w=s.get_move_limit(m,s.containment),b=h+("nw"==n?c.grid.left-w[0]:w[1]-c.grid.right),v=m.bottom.length?_.min(m.bottom,function(e){return e.grid.top}):!1,y=v?v.grid.top-c.grid.top:g.grid.bottom-c.grid.top+1,z=Math.ceil(a.size.width/s.col_size),U=z>b?Math.round(b*s.col_size):a.size.width,$=(a.size.height>15?a.size.height:0)||a.originalSize.height,x=Math.ceil($/s.baseline),E=z>b?b:z,k=f&&x>y&&y>0?y:x;Math.abs(e(window).height()-i.clientY)<50&&($+=10*s.baseline,e(window).scrollTop(e(window).scrollTop()+10*s.baseline)),d.css({height:k*s.baseline,width:U,minWidth:U,maxWidth:U}),d.data("resize-col",E),d.data("resize-row",k),r.css({height:k*s.baseline,width:E*s.col_size,minWidth:E*s.col_size,maxWidth:E*s.col_size}),"nw"==n&&r.css({top:c.$el.find(">.upfront-resize-handle-nw").offset().top,marginTop:c.$el.find(">.upfront-resize-handle-se").offset().top+c.$el.find(">.upfront-resize-handle-se").height()-c.$el.find(">.upfront-resize-handle-nw").offset().top-k*s.baseline}),f||"nw"==n||o.css("height",k*s.baseline),t.update_size_hint(E*s.col_size,k*s.baseline),t.trigger("entity:resizing",{row:k,col:E,height:k*s.baseline,width:E*s.col_size,axis:n},t,t.model)},stop:function(e,l){Upfront.Events.trigger("entity:pre_resize_stop",t,t.model,l);var u,g,f=Upfront.Settings.LayoutEditor.CurrentBreakpoint,h=d.closest(".upfront-wrapper"),m=d.closest(".upfront-region"),w=s.get_el(d),b=(d.data("margin"),s.get_wrap(h)),v=(m.hasClass("upfront-region-expand-lock"),b?s.get_affected_wrapper_els(b,s.wraps,[],!0):s.get_affected_els(w,s.els,[],!0)),y=(s.get_move_limit(v,s.containment),Math.ceil(l.originalSize.width/s.col_size),Math.ceil(l.originalSize.height/s.baseline),d.find(".upost-data-object").length?d.find(".upost-data-object"):!1,d.data("resize-col")),z=parseFloat(d.data("resize-row")),U=a.layout.get("regions");U.get_by_name(m.data("name")),p?s.containment.$el:c?t.group_view.$el.find(".upfront-editable_entities_container:first"):m.find(".upfront-modules_container > .upfront-editable_entities_container:first");if(s.resizing=!1,o.remove(),r.remove(),d.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!f||f["default"]){var $=i.get("objects");$&&1==$.length&&$.each(function(e){e.set_property("row",z)}),i.set_property("row",z)}else{var $=i.get("objects");$&&1==$.length&&$.each(function(e){var t=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{});_.isObject(t[f.id])||(t[f.id]={}),t[f.id].row=z,e.set_property("breakpoint",t)}),u=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(u[f.id])||(u[f.id]={}),g=u[f.id],g.edited=!0,g.row=z,i.set_property("breakpoint",u)}s.update_position_data(s.containment.$el),s.normalize(s.els,s.wraps),d.removeData("resize-col"),d.removeData("resize-row"),t.trigger("entity:resize_stop",{row:z,col:y,height:z*s.baseline,width:y*s.col_size,axis:n},t,t.model),Upfront.Events.trigger("entity:resize_stop",t,t.model,l),Upfront.Events.trigger("entity:resized",t,t.model)}})):(d.data("ui-resizable")&&d.resizable("option","disabled",!1),!1)},toggle_resizables:function(t){e(".upfront-editable_entity.ui-resizable").resizable("option","disabled",!t)},resize:function(t,i,r,o,n,a){var s=Upfront.Application,l=Upfront.Behaviors.GridEditor,n=/all|nw|se/.test(n)?n:"all",p=e(Upfront.Settings.LayoutEditor.Selectors.main);p.find(".upfront-layout");l.start(t,i);var _=t.$el.find(".upfront-editable_entity:first"),d=_.find(".upfront-editable_entity"),c=_.closest(".upfront-wrapper"),u=_.closest(".upfront-region"),g=(_.data("margin"),l.get_el(_)),f=l.get_wrap(c),h=l.get_region(u),m=(u.hasClass("upfront-region-expand-lock"),f?l.get_affected_wrapper_els(f,l.wraps,[],!0):l.get_affected_els(g,l.els,[],!0),l.get_max_size(g,l.els,h,n)),w="undefined"!=typeof t.group_view,b=w?t.group_view.model:!1,v=s.layout.get("regions"),y=v.get_by_name(u.data("name")),z=(w?b:y).get("wrappers"),U=z.get_by_wrapper_id(c.attr("id"));Upfront.data.wrapper_views[U.cid];if(1>r||1>o)return!1;if(!a){_.css("min-height",""),d.css("min-height","");var $=Math.ceil(_.outerHeight()/l.baseline);o=o>$?o:$,_.css("min-height",o*l.baseline),d.css("min-height",(o-2)*l.baseline)}r=r?r>m.col?m.col:r:g.col,o=o?m.row&&o>m.row?m.row:o:g.row,l.normalize(l.els,l.wraps),l.update_position_data(l.containment.$el),l.update_class(_,l.grid["class"],r),i.set_property("row",o);var x=i.get("objects");return x&&1==x.length&&x.each(function(e){e.set_property("row",o)}),"se"!=n?i.replace_class([l.grid["class"]+r].join(" ")):i.replace_class(l.grid["class"]+r),"undefined"!=typeof t.group_view?l.update_wrappers(t.group_view.model,t.group_view.$el):l.update_wrappers(y,h.$el),t.trigger("entity:resize_stop",{row:o,col:r},t,t.model),Upfront.Events.trigger("entity:resized",t,t.model),!0},create_wrapper_resizable:function(t,i){var r,o,n,a,s,l,p,d,c,u,g,f,h,m,w,b,v,y,z,U,$,x,E,k,j=this,S=Upfront.Behaviors.GridEditor,B=t.$el,M=e(Upfront.Settings.LayoutEditor.Selectors.main);M.find(".upfront-layout");return!1===Upfront.plugins.isRequiredByPlugin("setup resizeable")&&i.get_property_value_by_name("disable_resize")?!1:B.data("ui-resizable")?(B.resizable("option","disabled",!1),!1):Upfront.Application.user_can_modify_layout()?void B.resizable({containment:"document",autoHide:!1,delay:50,handles:{w:".upfront-resize-handle-wrapper-w",e:".upfront-resize-handle-wrapper-e"},start:function(j,M){S.time_start("fn wrapper_resize_start"),S.start(t,i),S.resizing=window.scrollY,o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),n=!_.isUndefined(t.parent_view.object_group_view),n?(s=t.parent_view.object_group_view,l=S.get_position(s.$el)):(a=!_.isUndefined(t.parent_view.group_view),s=a?t.parent_view.group_view:t.parent_view.region_view,l=a?S.get_position(s.$el):S.get_region(s.$el));var G,L=S.get_wrap(B),W=e(this).data("ui-resizable"),C=(Upfront.Util.find_sorted(B.parent(),"> .upfront-wrapper"),S.get_affected_els(L,S.wraps,[],!0),s.model.get("wrappers")),T=n?s.model.get("objects"):s.model.get("modules"),A=S.parse_modules_to_lines(T,C,o.id,l.col);r=B.closest(".upfront-region"),v=W.axis?W.axis:"e",g=!1,G=!1,f=!1,h=!1,b=!1,p=B.find("> .upfront-module-group").length>0,U=L.col,y=S.min_col,z=S.min_col,_.each(A,function(e){_.each(e.wrappers,function(t,r){var o=!1;t.model==i&&(E=0===r,k=r===e.wrappers.length-1,w=t.spacer,E||"w"!=v?k||"e"!=v||(o=e.wrappers[r+1]):o=e.wrappers[r-1],o!==!1&&(f=o.model,h=Upfront.data.wrapper_views[f.cid],g=h.$el,G=S.get_wrap(g),b=o.spacer))})}),$=[],B.find(S.el_selector_direct).each(function(){var t=S.get_el_model(e(this)),i=n?Upfront.data.object_views[t.cid]:Upfront.data.module_views[t.cid];i&&$.push({view:i,is_group:n?!1:e(this).hasClass("upfront-module-group"),el:S.get_el(e(this))})}),p&&_.each($,function(e){if(e.is_group){var t=S.get_group_min_col(e.view);y=t>y?t:y}}),c=e('<div class="upfront-resize" style="height:'+L.height+'px;"></div>'),c.css({height:L.height,width:L.width,minWidth:L.width,maxWidth:L.width,position:"absolute"}),"w"==v?c.css({top:L.position.top,right:e("body").width()-L.position.right}):c.css({top:L.position.top,left:L.position.left}),e("body").append(c),x=[],g&&g.length&&(d=g.find("> .upfront-module-group").length>0,g.find(S.el_selector_direct).each(function(){var t=S.get_el_model(e(this)),i=n?Upfront.data.object_views[t.cid]:Upfront.data.module_views[t.cid];i&&x.push({view:i,is_group:n?!1:e(this).hasClass("upfront-module-group"),el:S.get_el(e(this))})}),d&&_.each(x,function(e){if(e.is_group){var t=S.get_group_min_col(e.view);z=t>z?t:z}}),U=L.col+G.col,w||b?w&&(U-=z,y=0):U-=z,b&&(z=0)),u=e('<div class="upfront-resize-placeholder"></div>'),u.css({width:(G?G.col+L.col:L.col)/l.col*100+"%",height:M.originalSize.height,position:"relative"}),o&&!o["default"]&&u.css("order",B.css("order")),(w||b)&&(m=e('<div class="upfront-spacer-feed"></div>'),m.css({width:S.col_size,height:"auto",top:0,bottom:0,position:"absolute"}),u.append(m)),_.each(S.els,function(e,t){S.els[t]=S.get_position(e.$el)}),_.each(S.wraps,function(e,t){S.wraps[t]=S.get_position(e.$el)}),S.normalize(S.els,S.wraps),S.update_position_data(S.containment.$el);var O=B.position(),D=g?g.position():!1;B.css({marginLeft:0,marginTop:0,position:"absolute",left:O.left,top:O.top,minHeight:""}),g&&g.css({marginLeft:0,marginTop:0,position:"absolute",top:D.top,left:D.left}),W.originalPosition.left=O.left,W.originalPosition.top=O.top,W._updateCache({left:O.left,top:O.top}),u.insertBefore(B),_.each($,function(e){e.view.trigger("entity:resize_start",{row:e.el.row,col:e.el.col,height:e.el.height,width:e.el.width,axis:v},e.view,e.view.model)}),_.each(x,function(e){e.view.trigger("entity:resize_start",{row:e.el.row,col:e.el.col,height:e.el.height,width:e.el.width,axis:"w"==v?"e":"w"},e.view,e.view.model)}),t.trigger("entity:wrapper:resize_start",{row:L.row,col:L.col,height:L.height,width:L.width,axis:v},t,t.model),h&&h.trigger("entity:wrapper:resize_start",{row:G.row,col:G.col,height:G.height,width:G.width,axis:"w"==v?"e":"w"},h,h.model),Upfront.Events.trigger("entity:wrapper:resize_start",t,t.model,h,h.model),S.time_end("fn wrapper_resize_start")},resize:function(e,i){S.time_start("fn wrapper_resize_resizing");var o=S.get_wrap(B),n=g?S.get_wrap(g):!1,a=(S.get_region(r),y*S.col_size),s=l>U?Math.round(U*S.col_size):a>i.size.width?a:i.size.width,l=Math.round(s/S.col_size),p=(i.size.height>15?i.size.height:0)||i.originalSize.height,d="w"==v?i.originalPosition.left+i.originalSize.width-s:i.position.left,u=l>U?U:l,f=U-u+z,E=(U+z)*S.col_size-s;if(B.css({left:d,height:p,width:s,minWidth:s,maxWidth:s}),B.data("resize-col",u),w&&s<S.col_size){var k=.5*Math.round((S.col_size-s)/S.col_size*100)/100;m.css({left:"e"==v?0:"auto",right:"e"==v?"auto":0,backgroundColor:"rgba(200, 0, 0, "+k+")"})}if(g&&(g.css({width:E,minWidth:E,maxWidth:E}),"e"==v&&g.css("margin-left",n.width-E),g.data("resize-col",f),b&&E<S.col_size)){var k=.5*Math.round((S.col_size-E)/S.col_size*100)/100;m.css({left:"w"==v?0:"auto",right:"w"==v?"auto":0,backgroundColor:"rgba(200, 0, 0, "+k+")"})}c.css({height:p,
width:u*S.col_size,minWidth:u*S.col_size,maxWidth:u*S.col_size}),_.each($,function(e){e.view.trigger("entity:resizing",{row:e.el.row,col:u,height:e.el.height,width:u*S.col_size,axis:v},e.view,e.view.model)}),_.each(x,function(e){e.view.trigger("entity:resizing",{row:e.el.row,col:f,height:e.el.height,width:f*S.col_size,axis:"w"==v?"e":"w"},e.view,e.view.model)}),t.trigger("entity:wrapper:resizing",{row:o.row,col:u,height:o.height,width:u*S.col_size,axis:v},t,t.model),h&&h.trigger("entity:wrapper:resizing",{row:n.row,col:f,height:n.height,width:f*S.col_size,axis:"w"==v?"e":"w"},h,h.model),S.time_end("fn wrapper_resize_resizing")},stop:function(e,a){S.time_start("fn wrapper_resize_stop"),Upfront.Events.trigger("entity:wrapper:pre_resize_stop",t,t.model,a);var l=S.get_wrap(B),p=g?S.get_wrap(g):!1,d=(Math.ceil(a.originalSize.width/S.col_size),B.data("resize-col")),m=g?g.data("resize-col"):0,y=j.layout.get("regions"),z=(y.get_by_name(r.data("name")),"w"==v&&E),M="e"==v&&k;S.resizing=!1,u.remove(),c.remove(),B.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),g&&g.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",marginLeft:"",marginTop:""}),!f&&(z||M)&&U-d>0?t.add_spacer(z?"left":"right",U-d,U,n):(d>0?o&&!o["default"]?(i.set_breakpoint_property("edited",!0,!0),i.set_breakpoint_property("col",d),_.each($,function(e){e.view.model.set_breakpoint_property("edited",!0,!0),e.view.model.set_breakpoint_property("col",d)})):(i.replace_class(S.grid["class"]+d),_.each($,function(e){e.view.model.replace_class(S.grid["class"]+d)})):w&&(i.collection.remove(i),_.each($,function(e){e.view.model.collection.remove(e.view.model)})),f&&(m>0?o&&!o["default"]?(f.set_breakpoint_property("edited",!0,!0),f.set_breakpoint_property("col",m),_.each(x,function(e){e.view.model.set_breakpoint_property("edited",!0,!0),e.view.model.set_breakpoint_property("col",m)})):(f.replace_class(S.grid["class"]+m),_.each(x,function(e){e.view.model.replace_class(S.grid["class"]+m)})):b&&(f.collection.remove(f),_.each(x,function(e){e.view.model.collection.remove(e.view.model)})))),n?s.model.get("objects").each(function(e){e.set_breakpoint_property("edited",!0,!0)}):s.model.get("modules").each(function(e){e.set_breakpoint_property("edited",!0,!0)}),s.model.get("wrappers").each(function(e){e.set_breakpoint_property("edited",!0,!0)}),S.update_position_data(S.containment.$el),S.normalize(S.els,S.wraps),B.removeData("resize-col"),g&&g.removeData("resize-col"),_.each($,function(e){e.view.trigger("entity:resize_stop",{row:e.el.row,col:d,height:e.el.height,width:d*S.col_size,axis:v},e.view,e.view.model)}),_.each(x,function(e){e.view.trigger("entity:resize_stop",{row:e.el.row,col:m,height:e.el.height,width:m*S.col_size,axis:"w"==v?"e":"w"},e.view,e.view.model)}),t.trigger("entity:wrapper:resize_stop",{row:l.row,col:d,height:l.height,width:d*S.col_size,axis:v},t,t.model),t.trigger("entity:wrapper:resize",{col:d},t,t.model),h&&(h.trigger("entity:wrapper:resize_stop",{row:p.row,col:m,height:p.height,width:d*S.col_size,axis:"w"==v?"e":"w"},h,h.model),h.trigger("entity:wrapper:resize",{col:m},h,h.model)),Upfront.Events.trigger("entity:wrapper:resize_stop",t,t.model,h,h.model,a),Upfront.Events.trigger("entity:wrapper:resized",t,t.model,h,h.model),S.time_end("fn wrapper_resize_stop")}}):(B.data("ui-resizable")&&B.resizable("option","disabled",!1),B.find(".upfront-resize-handle-wrapper").remove(),!1)},get_group_min_col:function(e){var t=Upfront.Settings.LayoutEditor.CurrentBreakpoint,i=Upfront.Behaviors.GridEditor,r=e.model.get("modules"),o=e.model.get("wrappers"),n=!t||t["default"]?i.get_class_num(e.$el,i.grid["class"]):e.$el.data("breakpoint_col"),a=i.parse_modules_to_lines(r,o,t?t.id:"desktop",n),s=i.min_col;return _.each(a,function(e){var t=0;_.each(e.wrappers,function(e){t+=e.spacer?1:i.min_col}),t>s&&(s=t)}),s},create_draggable:function(e,i){var r=Upfront.Behaviors.GridEditor;r.drag_instances[e.cid]?r.drag_instances[e.cid].setup():(r.drag_instances[e.cid]=new t(e,i),i.on("remove",function(){delete r.drag_instances[e.cid]}))},toggle_draggables:function(t){e(".upfront-editable_entity.ui-draggable").draggable("option","disabled",!t)},parse_modules_to_lines:function(e,t,i,r){var o=Upfront.Behaviors.GridEditor,n={},a=[],s=[],l=0,p=0;return e.each(function(e,a){var s=e.get_wrapper_id(),l=t.get_by_wrapper_id(s),p=l?l.get_property_value_by_name("breakpoint"):!1,_=p&&i in p?p[i]:{},d=l?l.get_property_value_by_name("class"):"",c=o.get_class_num(d,o.grid["class"]),u=!!d.match(/clr/),g=e.get_property_value_by_name("breakpoint"),f=g&&i in g?g[i]:{},h=e.get_property_value_by_name("default_hide"),m=e.get_property_value_by_name("hide"),w=e.get_property_value_by_name("class"),b=o.get_class_num(w,o.grid["class"]),v=!!w.match(/(upfront-module-spacer|upfront-object-spacer)/),y=a,z=a,U={};l&&("desktop"!=i&&(m="hide"in f?f.hide:h,b="col"in f?parseInt(f.col,10):b,y="order"in f?1e4*parseInt(f.order,10)+y:y,c="col"in _?parseInt(_.col,10):c,z="order"in _?1e4*parseInt(_.order,10)+z:z,u="clear"in _?_.clear:u),m===!1&&(m=h),m&&v||(U={model:e,col:b,order:y,spacer:v,hide:m},b>c&&(c=b),c>r&&(c=r),s in n?(n[s].modules.push(U),n[s].col=c):n[s]={model:l,modules:[U],order:z,col:c,clear:u,spacer:v}))}),a=_.sortBy(n,function(e,t){return e.order}),_.each(a,function(e,t){(t>0&&e.clear||l>0&&l+e.col>r)&&(s[p].col=l,p++,l=0),_.isUndefined(s[p])&&(s[p]={wrappers:[],col:0}),l+=e.col,s[p].wrappers.push(e),s[p].col=l}),s},get_container_col:function(e,t){var i=Upfront.Behaviors.GridEditor,r=!_.isUndefined(e.group_view),o=!_.isUndefined(e.object_group_view),n=(r?e.group_view:o?e.object_group_view.parent_module_view:e.region_view).model.get_property_value_by_name("breakpoint"),a=n&&t.id in n?n[t.id]:{},s=o?e.object_group_view.parent_module_view.$el.find("> .upfront-module"):(r?e.group_view:e.region_view).$el,l=t["default"]?i.get_class_num(s,i.grid["class"]):_.isNumber(a.col)?a.col:t.columns;return l>t.columns?t.columns:l},normalize_module_remove:function(e,t,i,r,o){var n=(Upfront.Application,Upfront.Behaviors.GridEditor),a=(i.indexOf(t),Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled());!_.isUndefined(e.group_view),!_.isUndefined(e.object_group_view);_.each(a,function(r){var a,s,l,p,d,c,u=r.toJSON(),g=n.get_container_col(e,u),f=n.parse_modules_to_lines(i,o,u.id,g),h=!1,m=!1,w=[],b=[];if(_.each(f,function(e){a||(l=!1,p=!1,_.each(e.wrappers,function(i){s&&!p&&(p=i),_.each(i.modules,function(r){t==r.model&&(s=i,a=e)}),s||(l=i)}))}),a){if(p&&(c=p.model.get_property_value_by_name("class"),c.match(/clr/g)||(m=!0)),l&&(d=l.model.get_property_value_by_name("class"),d.match(/clr/g)&&!m&&(h=!0)),_.each(a.wrappers,function(e){e!=s&&(w.push(e),e.spacer&&b.push(e))}),w.length>=2&&(m=!1),1==s.modules.length){var v=g,y=0,z=0;_.each(b,function(e){v-=e.col}),w.length==b.length?_.each(w,function(e,t){_.each(e.modules,function(e){i.remove(e.model)}),o.remove(e.model)}):(y=Math.floor(v/(w.length-b.length)),z=v-(w.length-b.length)*y,_.each(w,function(e,t){if(!_.contains(b,e)){var i=e.model.get_property_value_by_name("class"),r=e.model.get_property_value_by_name("breakpoint"),o=r&&u.id in r?r[u.id]:{},a=y;z>0&&(a+=1,z-=1),u["default"]?(e.model.replace_class(n.grid["class"]+a+(0!=t||i.match(/clr/g)?"":" clr")),_.each(e.modules,function(e){e.model.replace_class(n.grid["class"]+a)})):(o.col=a,0!=t||o.clear||(o.clear=!0),e.model.set_property("breakpoint",Upfront.Util.clone(r)),_.each(e.modules,function(e){var t=e.model.get_property_value_by_name("breakpoint"),i=t&&u.id in t?t[u.id]:{};i.col=a,e.model.set_property("breakpoint",Upfront.Util.clone(t))}))}}))}if(u["default"]&&(h||m)){var U=!1;_.each(h?l.modules:p.modules,function(e,t){var i=e.model.get_property_value_by_name("class"),r=n.get_class_num(i,n.grid["class"]),a=Upfront.data.module_views[e.model.cid],s=h?l:p,_=Upfront.data.wrapper_views[s.model.cid],d=U?Upfront.data.wrapper_views[U.cid]:_;if(t>0){var c=Upfront.Util.get_unique_id("wrapper"),u=new Upfront.Models.Wrapper({name:"",properties:[{name:"wrapper_id",value:c},{name:"class",value:n.grid["class"]+r+" clr"}]}),g=new Upfront.Views.Wrapper({model:u});o.add(u),g.parent_view=a.parent_view,a.wrapper_view=g,g.render(),g.$el.append(a.$el),d.$el.after(g.$el),Upfront.data.wrapper_views[u.cid]=g,e.model.set_property("wrapper_id",c),U=u}})}}})},adapt_to_breakpoint:function(e,t,i,r,o){var n=(Upfront.Application,Upfront.Behaviors.GridEditor),a=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:i}).toJSON(),s=Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON(),o=o===!0?!0:!1,l=n.parse_modules_to_lines(e,t,s.id,s.columns),p=n.parse_modules_to_lines(e,t,i,r),d=n._filter_edited_lines(p,a),c=[],u=[],g=[],f=[],h=[],m=[],w=[];n._wrapper_index=0,_.each(l,function(e,t){_.each(e.wrappers,function(i,r){if(!i.spacer){var o=i.model.get_breakpoint_property_value("edited",!1,!1,a);if(o)return void n._wrapper_index++;n._wrapper_index++,c.push({prev:n._find_prev_wrapper_from_lines(i,r,e,t,l),next:n._find_next_wrapper_from_lines(i,r,e,t,l),current:i,order:n._wrapper_index})}})}),0!=c.length&&(c=_.filter(c,function(e,t){return t==e.order-1?(u.push(e),!1):n._wrapper_index==e.order+(c.length-t-1)?(g.push(e),!1):!0}),m=n._adapt_wrappers_to_line(u,r),f=n._adapt_wrappers_to_line(c,r),h=f.slice(0),w=n._adapt_wrappers_to_line(g,r),n._wrapper_index=0,_.each(m,function(e){n._set_adapt_wrappers(e.wrappers,r,o,a)}),_.each(d,function(e,t){var i=t>0?d[t-1]:!1;t<d.length-1?d[t+1]:!1;_.each(e.wrappers,function(t,s){var l=[];_.each(h,function(t,s){var p=t.prev_wrapper,d=t.next_wrapper,c=!1,u=Math.floor(r/t.wrappers.length);r-u*t.wrappers.length;_.each(t.wrappers,function(t){n._find_wrapper_in_line(p,i)?c=!0:n._find_wrapper_in_line(d,e)&&!n._find_wrapper_in_line(p,e)&&(c=!0)}),c&&(n._set_adapt_wrappers(t.wrappers,r,o,a),l.push(s))}),_.each(l,function(e,t){h.splice(e-t,1)}),n._wrapper_index++,t.model.set_breakpoint_property("order",n._wrapper_index,o,a)})}),_.each(_.union(h,w),function(e){n._set_adapt_wrappers(e.wrappers,r,o,a)}))},_set_adapt_wrappers:function(e,t,i,r){var o=Math.floor(t/e.length),n=t-o*e.length,a=this;_.each(e,function(e,t){var s=o;n>0&&(s++,n--),a._wrapper_index++,e.current.model.set_breakpoint_property("clear",0==t,i,r),e.current.model.set_breakpoint_property("col",s,i,r),e.current.model.set_breakpoint_property("order",a._wrapper_index,i,r),_.each(e.current.modules,function(e,t){e.model.set_breakpoint_property("col",s,i,r)})})},_filter_edited_lines:function(e,t){return _.filter(e,function(e){var i=!1;return _.each(e.wrappers,function(e){if(!e.spacer&&!i){var r=e.model.get_breakpoint_property_value("edited",!1,!1,t);return r?void 0:void(i=!0)}}),!i})},_adapt_wrappers_to_line:function(e,t){var i=0,r=[],o=[],n=!1,a=!1,s=!1;return _.each(e,function(l,p){var _=n&&l.order-n.order>1;if((_||i+l.current.col>t)&&o.length>0&&(r.push({wrappers:o,col:i,prev_wrapper:a,next_wrapper:s}),o=[],i=0,_&&(a=!1,s=!1)),a===!1&&(a=l.prev),s===!1){s=l.next;for(var d=p+1;d<e.length&&!(e[d].order-l.order>1);d++)s=e[d].next}i+=l.current.col,o.push(l),n=l}),o.length>0&&r.push({wrappers:o,col:i,prev_wrapper:a,next_wrapper:s}),r},_find_prev_wrapper_from_lines:function(e,t,i,r,o){if(t>0){if(!i.wrappers[t-1].spacer)return i.wrappers[t-1];if(t>1)return i.wrappers[t-2]}if(r>0)for(var n=o[r-1].wrappers.length-1;n>=0;n--)if(!o[r-1].wrappers[n].spacer)return o[r-1].wrappers[n];return!1},_find_next_wrapper_from_lines:function(e,t,i,r,o){if(t<i.wrappers.length-1){if(!i.wrappers[t+1].spacer)return i.wrappers[t+1];if(t<i.wrappers.length-2)return i.wrappers[t+2]}if(r<o.length-1)for(var n=0;n<o[r+1].wrappers.length;n++)if(!o[r+1].wrappers[n].spacer)return o[r+1].wrappers[n];return!1},_find_wrapper_in_line:function(e,t){return t&&t.wrappers&&e?0==t.wrappers.length?!1:_.find(t.wrappers,function(t,i){return e.model.cid==t.model.cid}):!1},adapt_region_to_breakpoint:function(e,t,i,r){var o=(Upfront.Application,Upfront.Behaviors.GridEditor,Upfront.Views.breakpoints_storage.get_breakpoints().get_default().toJSON()),r=r===!0?!0:!1;e.each(function(e){var n=Upfront.Util.clone(e.get_property_value_by_name("breakpoint")||{}),a=e.get_property_value_by_name("col"),s=e.get("sub");_.isObject(n[t])||(n[t]={edited:!1}),n[t].edited||(e.is_main()||!s||s.match(/^(left|right)$/)?n[t].col=o.columns:s.match(/^lightbox$/)&&a>i&&(n[t].col=i)),e.set_property("breakpoint",n,r)})},create_region_resizable:function(t,i){var r,o,n,a=Upfront.Behaviors.GridEditor,s=t.$el,l=e(Upfront.Settings.LayoutEditor.Selectors.main),p=(l.find(".upfront-layout"),i.collection),d=(p.indexOf(i),p.size()-1,i.get("sub")),c=(i.get("container"),{}),u=function(){var e={top:i.get_property_value_by_name("top"),left:i.get_property_value_by_name("left"),bottom:i.get_property_value_by_name("bottom"),right:i.get_property_value_by_name("right"),width:i.get_property_value_by_name("width"),height:i.get_property_value_by_name("height")};return e.is_top="number"==typeof e.top,e.is_left="number"==typeof e.left,e.is_bottom="number"==typeof e.bottom,e.is_right="number"==typeof e.right,e};return s.data("ui-resizable")?!1:void((i.is_main()||!d||d.match(/^(fixed|left|right)$/))&&(i.is_main()?(r=["s"],o={s:".upfront-region-resize-handle-s"}):"left"==d?(r=["e","s"],o={e:".upfront-region-resize-handle-e",s:".upfront-region-resize-handle-s"}):"right"==d?(r=["w","s"],o={w:".upfront-region-resize-handle-w",s:".upfront-region-resize-handle-s"}):"fixed"==d&&(c=u(),c.is_top&&c.is_left||c.is_bottom&&c.is_right?(r=["nw","se"],o={nw:".upfront-region-resize-handle-nw",se:".upfront-region-resize-handle-se"}):(r=["ne","sw"],o={ne:".upfront-region-resize-handle-ne",sw:".upfront-region-resize-handle-sw"})),_.each(r,function(e){var t=e.match(/^(e|w|s|n)$/)?"upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-"+e:"upfront-icon-control upfront-icon-control-resize upfront-icon-control-resize-"+e;s.append('<div class="'+t+" upfront-region-resize-handle upfront-region-resize-handle-"+e+" ui-resizable-handle ui-resizable-"+e+'"></div>')}),s.resizable({containment:"document",handles:o,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(i,r){var o=(a.get_class_num(s,a.grid["class"]),e(this).data("ui-resizable")),l=r.helper;if(n=o.axis?o.axis:"se",a.resizing=window.scrollY,e(this).resizable("option","minWidth",3*a.col_size),"fixed"!=d)e(this).resizable("option","maxWidth",10*a.col_size);else{e(this).resizable("option","minHeight",3*a.baseline),s.css("position",""),t.update_region_position(),c=u();var p=s.position();o.originalPosition.left=p.left,o.originalPosition.top=p.top,o.originalSize.width=c.width,o.originalSize.height=c.height,o._updateCache({left:p.left,top:p.top}),l.css({marginLeft:0,marginTop:0,left:p.left,top:p.top,position:"fixed"})}Upfront.Events.trigger("entity:region:resize_start",t,t.model)},resize:function(e,i){var r=i.helper;if("fixed"!=d)if("s"==n){var o=Math.abs(Math.ceil(i.size.height/a.baseline)),p=Math.round(o*a.baseline);r.css({height:p,width:i.originalSize.width,minWidth:i.originalSize.width,maxWidth:i.originalSize.width}),t.update_size_hint(i.originalSize.width,p),s.data("resize-row",o)}else{var _=a.get_class_num(s,a.grid["class"]),u=s.prevAll(".upfront-region:first"),g=s.nextAll(".upfront-region:first"),f=u.size()>0?a.get_class_num(u,a.grid["class"]):0,h=g.size()>0?a.get_class_num(g,a.grid["class"]):0,m=_+(h>f?h:f),w=Math.abs(Math.ceil(i.size.width/a.col_size)),b=w>m?m:w,v=Math.round(b*a.col_size);r.css({height:i.originalSize.height,width:v,minWidth:v,maxWidth:v,marginLeft:"w"==n?i.size.width-v:0}),t.update_size_hint(v,i.originalSize.height),s.data("resize-col",b)}else{var y,z,U=(s.offset(),l.offset(),s.height()),$=s.width(),x=max_width=!1;c.is_top&&(x="nw"==n||"ne"==n?c.top+U:!1),!c.is_top&&c.is_bottom&&(x="se"==n||"sw"==n?c.bottom+U:!1),c.is_left&&(max_width="nw"==n||"sw"==n?c.left+$:!1),!c.is_left&&c.is_right&&(max_width="se"==n||"ne"==n?c.right+$:!1),z=Math.round(x&&i.size.height>x?x:i.size.height),y=Math.round(max_width&&i.size.width>max_width?max_width:i.size.width),r.css({height:z,width:y}),t.update_size_hint(y,z,r),s.data("resize-height",z),s.data("resize-width",y)}},stop:function(e,r){var o,l,p=Upfront.Settings.LayoutEditor.CurrentBreakpoint;if(a.resizing=!1,s.css({width:"",minWidth:"",maxWidth:"",height:"",position:"",top:"",left:"",right:"",bottom:""}),"fixed"!=d){var u=s.data("resize-col"),g=s.data("resize-row");!p||p["default"]?(u&&i.set_property("col",u),g&&i.set_property("row",g)):(u||g)&&(o=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(o[p.id])||(o[p.id]={}),l=o[p.id],l.edited=!0,u&&(l.col=u),g&&(l.row=g),i.set_property("breakpoint",o)),s.removeData("resize-col"),s.removeData("resize-row")}else{var f=s.data("resize-width"),h=s.data("resize-height"),u=Math.floor(f/a.col_size);"nw"!=n&&"ne"!=n||!c.is_top||i.set_property("top",c.top+c.height-h),"se"!=n&&"sw"!=n||c.is_top||!c.is_bottom||i.set_property("bottom",c.bottom+c.height-h),"nw"!=n&&"sw"!=n||!c.is_left||i.set_property("left",c.left+c.width-f),"se"!=n&&"ne"!=n||c.is_left||!c.is_right||i.set_property("right",c.right+c.width-f),i.set_property("width",f,!0),i.set_property("height",h,!0),i.set_property("col",u,!0),i.get("properties").trigger("change"),s.removeData("resize-width"),s.removeData("resize-height")}Upfront.Events.trigger("entity:region:resize_stop",t,t.model)}})))},create_region_draggable:function(t,i){if(i.get("container")&&i.get("container")!=i.get("name")){var r=(Upfront.Behaviors.GridEditor,t.$el),o=e(Upfront.Settings.LayoutEditor.Selectors.main),n=(o.find(".upfront-layout"),t.parent_view.get_container_view(i)),a=i.get("sub"),s={},l=!1,p=function(){var e={top:i.get_property_value_by_name("top"),left:i.get_property_value_by_name("left"),bottom:i.get_property_value_by_name("bottom"),right:i.get_property_value_by_name("right"),width:i.get_property_value_by_name("width"),height:i.get_property_value_by_name("height")};return e.is_top="number"==typeof e.top,e.is_left="number"==typeof e.left,e.is_bottom="number"==typeof e.bottom,e.is_right="number"==typeof e.right,e},_={},d="";return"fixed"!=a?!1:r.data("ui-draggable")?!1:void r.draggable({disabled:!0,revert:!0,revertDuration:0,zIndex:100,helper:"clone",delay:15,scroll:!1,iframeFix:!0,start:function(e,t){var o=t.helper,n=r.width(),a=r.height();o.css("width",n),o.css("height",a),r.hide(),s=p(),l=i.get("restrict_to_container"),d=o.css("position")},drag:function(i,r){var a,s,l,p,c=r.helper,u=o.offset(),g=o.width(),f=n.$el.offset(),h=n.$el.height(),m=f.top+h,w=e(window).scrollTop(),b=e(window).height(),v=w+b,y=g/2+u.left,z="fixed"==d||h>b?b/2:h/2,U=r.position.left,$=r.position.top,x=c.width(),E=c.height(),k=x/2+U,j=E/2+$;_={},"absolute"==d&&h>b&&v>=m&&(z=h-b/2),z>=j?(a="fixed"==d||b>h||m>=v?0:h-b,l=a>$?a:$,_.top=l-a):(a="fixed"==d||h>b&&f.top>=w?b-E:h-E,l=$>a?a:$,_.bottom=a-l),y>=k?(s=u.left,p=s>U?s:U,_.left=p-s):(s=g-x+u.left,p=U>s?s:U,_.right=s-p),t.update_position_hint(_,c),r.position.top=l,r.position.left=p},stop:function(e,t){r.show(),"number"==typeof _.top?(i.set_property("top",_.top,!0),i.remove_property("bottom",!0)):"number"==typeof _.bottom&&(i.set_property("bottom",_.bottom,!0),i.remove_property("top",!0)),"number"==typeof _.left?(i.set_property("left",_.left,!0),i.remove_property("right",!0)):"number"==typeof _.right&&(i.set_property("right",_.right,!0),i.remove_property("left",!0)),i.get("properties").trigger("change")}})}},create_region_container_resizable:function(t,i){var r=Upfront.Behaviors.GridEditor,o=t.$el,n=e(Upfront.Settings.LayoutEditor.Selectors.main),a=i.get("sub"),s="s",l={},p=n.find(".upfront-layout");return o.data("ui-resizable")?!1:(i.is_main()||"bottom"!=a||(s="n"),o.append('<div class="upfront-icon-control-region upfront-icon-control-region-resize upfront-icon-control-region-resize-'+s+" upfront-region-resize-handle upfront-region-resize-handle-"+s+" ui-resizable-handle ui-resizable-"+s+'"></div>'),l[s]=".upfront-region-resize-handle-"+s,void o.resizable({containment:"document",handles:l,helper:"region-resizable-helper",disabled:!0,zIndex:9999999,start:function(e,i){Upfront.Events.trigger("entity:region_container:resize_start",t,t.model),Upfront.Events.trigger("command:region:edit_toggle",!1),r._prepare_resize_auto_scroll(i,p.find("> .upfront-regions"))},resize:function(n,a){var s=a.helper,l=(a.size.height>15?a.size.height:0)||a.originalSize.height,p=Math.ceil(l/r.baseline),d=e(this).data("ui-resizable");s.css({width:o.width(),height:p*r.baseline}),o.data("resize-row",p);var c=Upfront.data.region_views[i.cid];c&&c.update_size_hint(c.$el.width(),p*r.baseline),_.each(t.sub_model,function(e){var t=Upfront.data.region_views[e.cid];t&&(t.$el.hasClass("upfront-region-side-left")||t.$el.hasClass("upfront-region-side-right"))&&t.update_size_hint(t.$el.width(),p*r.baseline)}),r._start_resize_auto_scroll(n,a,l,d)},stop:function(e,n){var a,s,l=Upfront.Settings.LayoutEditor.CurrentBreakpoint,p=o.data("resize-row");o.css({width:"",minHeight:"",height:"",maxHeight:"",position:"",top:"",left:""}),r._clear_resize_auto_scroll(),!l||l["default"]?i.set_property("row",p):(a=Upfront.Util.clone(i.get_property_value_by_name("breakpoint")||{}),_.isObject(a[l.id])||(a[l.id]={}),s=a[l.id],s.edited=!0,s.row=p,i.set_property("breakpoint",a)),o.removeData("resize-row"),Upfront.Events.trigger("entity:region_container:resize_stop",t,t.model),Upfront.Events.trigger("command:region:edit_toggle",!0),r.resizing=!1}}))},_auto_scroll_t:!1,_auto_scroll_data:{},_auto_scroll_step:3,_auto_scroll_timeout:100,_prepare_resize_auto_scroll:function(t,i){var r=e(document).height(),o=e('<div class="upfront-auto-scroller"></div>');o.css({width:1,height:0,visibility:"hidden"}).appendTo(i?i:"body"),this._auto_scroll_data={document_height:r,position_top:t.originalPosition.top,position_height:t.originalSize.height,position_rest:r-(t.originalPosition.top+t.originalSize.height),$scroller:o}},_start_resize_auto_scroll:function(t,i,r,o){var n=this,a=e(window).height(),s=Math.abs(a-t.clientY),l=r-this._auto_scroll_data.position_height,p=l-this._auto_scroll_data.position_rest,_=0,d=this._auto_scroll_step*this.baseline,c=i.helper;clearTimeout(this._auto_scroll_t),s>50||(this._auto_scroll_t=setTimeout(function(){_+=d,p+_>0&&n._auto_scroll_data.$scroller.height(p+_+s),o.size.height=r+_,o.parentData.height=e(document).height(),c.css("height",o.size.height),e(window).scrollTop(e(window).scrollTop()+d),o._trigger("resize",t,i)},this._auto_scroll_timeout))},_clear_resize_auto_scroll:function(){this._auto_scroll_data.$scroller.remove(),clearTimeout(this._auto_scroll_t)},toggle_region_resizable:function(t){var i,r=e(Upfront.Settings.LayoutEditor.Selectors.main);t?(i=e(r.hasClass("upfront-region-fixed-editing")?".upfront-region-side-fixed":".upfront-region-center, .upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip, .upfront-region-sub-container"),i.each(function(){e(this).data("ui-resizable")&&e(this).resizable("option","disabled",!1)})):e(".upfront-region, .upfront-region-container").each(function(){e(this).data("ui-resizable")&&e(this).resizable("option","disabled",!0)})},toggle_region_draggable:function(t){var i,r=e(Upfront.Settings.LayoutEditor.Selectors.main);t?(i=e(r.hasClass("upfront-region-fixed-editing")?".upfront-region-side-fixed":".upfront-region-side-left, .upfront-region-side-right, .upfront-region-container-wide, .upfront-region-container-clip"),i.each(function(){e(this).data("ui-draggable")&&e(this).draggable("option","disabled",!1)})):e(".upfront-region, .upfront-region-container").each(function(){e(this).data("ui-draggable")&&e(this).draggable("option","disabled",!0)})},update_grid:function(t){var i=Upfront.Application,r=Upfront.Settings.LayoutEditor.Grid,o=i.layout.get_property_value_by_name("grid")||{column_widths:{},column_paddings:{},baselines:{},type_paddings:{}},n=Upfront.Settings.LayoutEditor.CurrentBreakpoint||Upfront.Settings.LayoutEditor.Grid.size_name,a=Upfront.Views.breakpoints_storage.get_breakpoints().findWhere({id:_.isObject(n)?n.id:n}),s=!1;t.column_width&&(o.column_widths[r.size_name]=t.column_width,a.get_property_value_by_name("column_width")!=t.column_width&&(a.set_property("column_width",t.column_width),s=!0)),"column_padding"in t&&(o.column_paddings[r.size_name]=t.column_padding,a.get_property_value_by_name("column_padding")!=t.column_padding&&(a.set_property("column_padding",t.column_padding),s=!0)),t.baseline&&(t.baseline!=r.baseline&&(clearTimeout(this._load_editor_css),this._load_editor_css=setTimeout(function(){Upfront.Util.post({action:"upfront_load_editor_grid",baseline:t.baseline},"text").success(function(t){e("#upfront-editor-grid-inline").length?e("#upfront-editor-grid-inline").html(t):e("head").append('<style id="upfront-editor-grid-inline">'+t+"</style>")})},1e3)),o.baselines[r.size_name]=t.baseline,a.get_property_value_by_name("baseline")!=t.baseline&&(a.set_property("baseline",t.baseline),s=!0)),t.type_padding&&(o.type_paddings[r.size_name]=t.type_padding,a.get_property_value_by_name("type_padding")!=t.type_padding&&(a.set_property("type_padding",t.type_padding),s=!0)),Upfront.Settings.LayoutEditor.Grid=_.extend(r,t),i.layout.set_property("grid",o),i.layout_view.update_grid_css(),this.init(),i.layout_ready&&Upfront.Events.trigger("upfront:grid:updated"),s&&!0===Upfront.plugins.isRequiredByPlugin("update grid")&&a.trigger("change:enabled",a)},time_start:function(e){this.show_debug_element&&console.time(e)},time_end:function(e){this.show_debug_element&&console.timeEnd(e)},set_timeout:function(e){this.timeout=e},set_compare_size:function(e,t){this.compare_col=e,this.compare_row=t},toggle_debug:function(){this.show_debug_element=!this.show_debug_element,this.show_debug_element?this.render_debug():this.delete_debug()},render_debug:function(){var t=this,i=e(Upfront.Settings.LayoutEditor.Selectors.main);$modal=e('<div id="behavior-debug" class="upfront-inline-modal"></div>'),$wrap=e('<div class="upfront-inline-modal-wrap"></div>'),field_delay=new Upfront.Views.Editor.Field.Number({name:"delay",label:Upfront.Settings.l10n.global.behaviors.delay_before_drag,label_style:"inline",min:0,max:2e3,step:1,default_value:300,change:function(){e(".upfront-module.ui-draggable, .upfront-module-group.ui-draggable, .upfront-object.ui-draggable").draggable("option","delay",this.get_value())}}),field_timeout=new Upfront.Views.Editor.Field.Number({name:"timeout",label:Upfront.Settings.l10n.global.behaviors.delay_before_changing_position,label_style:"inline",min:0,max:2e3,step:1,default_value:t.timeout,change:function(){t.timeout=parseInt(this.get_value(),10)}}),field_debug=new Upfront.Views.Editor.Field.Checkboxes({name:"debug",multiple:!1,default_value:!0,values:[{label:Upfront.Settings.l10n.global.behaviors.show_debug_info,value:!0}],change:function(){t.show_debug_element=this.get_value()?!0:!1}}),$close=e('<a href="#" class="upfront-close-debug">'+Upfront.Settings.l10n.global.behaviors.close+"</a>"),i.addClass("show-debug"),field_delay.render(),$wrap.append(field_delay.$el),field_timeout.render(),$wrap.append(field_timeout.$el),field_debug.render(),$wrap.append(field_debug.$el),$wrap.append($close),$modal.append($wrap),e("body").append($modal),$modal.css({top:"auto",left:"auto",bottom:0,right:0,position:"fixed"}),$wrap.css({width:360,top:0,padding:"10px",position:"relative"}),$close.on("click",function(){t.show_debug_element=!1,t.delete_debug()})},delete_debug:function(){var t=e(Upfront.Settings.LayoutEditor.Selectors.main);t.removeClass("show-debug"),e("#behavior-debug").remove()}};return r})}(jQuery);