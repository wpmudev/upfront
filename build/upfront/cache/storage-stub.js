define([],function(){var t=128,e="general",r=function(t){if(Array.prototype.reduce)return t.split("").reduce(function(t,e){return t=(t<<5)-t+e.charCodeAt(0),t&t},0);var e=0;if(0===t.length)return e;for(var r=0;r<this.length;r++){var n=t.charCodeAt(r);e=(e<<5)-e+n,e&=e}return e},n={get_storage_id:function(){return"_upfront_cache"},get_hash:function(t){return t?""+r(t):""},get_storage:function(){return{}},set_storage:function(t){return!0},get_valid_key:function(e){return!!e&&("string"!=typeof e&&(e=this.get_hash(JSON.stringify(e))),!(e.length>t)&&e)},set:function(t,r,n){if(t=this.get_valid_key(t),!t)return!1;n=n||e;var i=this.get_storage();return i[n]=i[n]||{},i[n][t]=r,this.set_storage(i)},has:function(t,r){if(t=this.get_valid_key(t),!t)return!1;r=r||e;var n=this.get_storage();return n[r]=n[r]||{},!!(t in n[r])},unset:function(t,r){if(t=this.get_valid_key(t),!t)return!1;if(r=r||e,!this.has(t,r))return!1;var n=this.get_storage();return n[r]=n[r]||{},delete n[r][t],this.set_storage(n)},purge:function(){return Upfront.Util.log("Purging all caches"),this.set_storage({})},purge_bucket:function(t){t=t||e;var r=this.get_storage();return r[t]=r[t]||{},r[t]={},this.set_storage(r)},get:function(t,r){if(t=this.get_valid_key(t),!t)return!1;if(r=r||e,!this.has(t,r))return!1;var n=this.get_storage();return n[r]=n[r]||{},n[r][t]},listen:function(){return this.stop_listening(),Upfront.Events.on("upfront:cache:purge",this.purge,this),this._is_listening=!0,!0},stop_listening:function(){return Upfront.Events.off("upfront:cache:purge",this.purge),this._is_listening=!1,!0},is_listening:function(){return!!this._is_listening}};return n});