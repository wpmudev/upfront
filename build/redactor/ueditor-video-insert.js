!function(t){define(["scripts/redactor/ueditor-insert","elements/upfront-image/js/video-selector"],function(e,o){var s=(Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.ueditor:Upfront.mainData.l10n.global.ueditor,e.UeditorInsert.extend({type:"video",controlsOpen:!1,defaults:{mute:!1,controls:!0,loop:!1,autoplay:!1},events:{"click .video-insert-controls":"toggleVideoControls","click .swap-video-insert-button":"swapVideo","click .video-insert-toggle-mute":"toggleMute","click .video-insert-toggle-controls":"toggleControls","click .video-insert-toggle-loop":"toggleLoop","click .video-insert-toggle-autoplay":"toggleAutoplay"},getSimpleOutput:function(){var e=t(this.data.get("video_embed"));this.data.get("mute")===!0?e.attr("muted",!0):e.removeAttr("muted"),this.data.get("controls")===!0?e.attr("controls","controls"):e.removeAttr("controls"),this.data.get("autoplay")===!0?e.attr("data-autoplay-video",!0):e.removeAttr("data-autoplay-video"),this.data.get("loop")===!0?e.attr("loop",!0):e.removeAttr("loop");var o=t('<div><div class="uinsert-video-insert">'+t("<div/>").append(e).html()+"</div></div>");return o.html()},getOutput:function(){return this.getSimpleOutput()},start:function(e){var o=new t.Deferred;return this.$editor=e.closest(".redactor-box"),this.data.set(this.defaults,{silent:!0}),this.selectVideo(o),o},swapVideo:function(){this.selectVideo()},selectVideo:function(t){var e=new o,s=this;Upfront.preventRedactorStopOnOutsideClick=!0,e.open({multiple_selection:!1}).done(function(o){e.close(),s.data.set({video_embed:s.getEmbedFromVideoData(o),id:o.id}),t&&t.resolve(s,o.embed),Upfront.preventRedactorStopOnOutsideClick=!1})},getEmbedFromVideoData:function(e){var o=parseInt(this.$editor.width(),10),s=t(e.embed).find("video").attr("preload","none").attr("width",o).attr("height",Math.round(o/e.aspect)).attr("data-cover-url",e.cover).attr("data-aspect",e.aspect).attr("controls","controls");return s},toggleVideoControls:function(e){!1!==t(e.target).hasClass("video-insert-controls")&&(this.controlsOpen=!this.controlsOpen,this.$el.find(".video-insert-controls-panel").toggle(),this.$el.find(".video-insert-controls").hasClass("video-insert-controls-expanded")?this.$el.find(".video-insert-controls").removeClass("video-insert-controls-expanded"):this.$el.find(".video-insert-controls").addClass("video-insert-controls-expanded"))},render:function(){this.$el.addClass("uinsert-video-insert");var e=t(this.data.get("video_embed"));this.data.get("mute")===!0?e.attr("muted",!0):e.removeAttr("muted"),this.data.get("controls")===!0?e.attr("controls","controls"):e.removeAttr("controls"),this.data.get("autoplay")===!0?e.attr("data-autoplay-video",!0):e.removeAttr("data-autoplay-video"),this.data.get("loop")===!0?e.attr("loop",!0):e.removeAttr("loop"),this.$el.html(e),e.css("background-image","url("+e.attr("data-cover-url")+")").css("background-size","cover"),this.$el.css("position","relative");var o=t('<div class="video-insert-controls"><div class="video-insert-controls-panel"><div class="image-crop-edit-button image-edit-col-full" title="Swap Video"><input type="button" class="swap-video-insert-button upfront-field upfront-field-button" value="Swap Video" placeholder="Swap Video"></div><div><span>Mute:</span><div class="upfront_toggle"><input '+(this.data.get("mute")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-mute"> <label class="upfront_toggle_label video-insert-toggle-mute"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div><div><span>Autoplay</span><div class="upfront_toggle"><input '+(this.data.get("autoplay")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-autoplay"> <label class="upfront_toggle_label video-insert-toggle-autoplay"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div><div><span>Loop</span><div class="upfront_toggle"><input '+(this.data.get("loop")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-loop"> <label class="upfront_toggle_label video-insert-toggle-loop"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div><div><span>Controls</span><div class="upfront_toggle"><input '+(this.data.get("controls")?"checked":"")+' type="checkbox" class="upfront_toggle_checkbox video-insert-toggle-checkbox-controls"> <label class="upfront_toggle_label video-insert-toggle-controls"> <span class="upfront_toggle_inner"></span> <span class="upfront_toggle_switch"></span></label></div></div></div></div>');this.$el.append(o),this.controlsOpen&&(this.$el.find(".video-insert-controls").addClass("video-insert-controls-expanded"),this.$el.find(".video-insert-controls-panel").toggle()),this.$el.parent().is("p")&&this.$el.unwrap()},toggleMute:function(){this.data.get("mute")===!0?(this.data.set("mute",!1),this.$el.find(".video-insert-toggle-checkbox-mute").removeAttr("checked")):(this.data.set("mute",!0),this.$el.find(".video-insert-toggle-checkbox-mute").attr("checked","checked"))},toggleLoop:function(){this.data.get("loop")===!0?(this.data.set("loop",!1),this.$el.find(".video-insert-toggle-checkbox-loop").removeAttr("checked")):(this.data.set("loop",!0),this.$el.find(".video-insert-toggle-checkbox-loop").attr("checked","checked"))},toggleAutoplay:function(){this.data.get("autoplay")===!0?(this.data.set("autoplay",!1),this.$el.find(".video-insert-toggle-checkbox-autoplay").removeAttr("checked")):(this.data.set("autoplay",!0),this.$el.find(".video-insert-toggle-checkbox-autoplay").attr("checked","checked"))},toggleControls:function(){this.data.get("controls")===!0?(this.data.set("controls",!1),this.$el.find(".video-insert-toggle-checkbox-controls").removeAttr("checked")):(this.data.set("controls",!0),this.$el.find(".video-insert-toggle-checkbox-controls").attr("checked","checked"))},importInserts:function(e,o){var i={};return e.find(".uinsert-video-insert").each(function(){var e,o=t(this),a=o.find("video"),n={};n.video_embed=t("<div/>").append(a).html(),n.controls=!!a.attr("controls"),n.autoplay=!!a.attr("data-autoplay-video"),n.loop=!!a.attr("loop"),n.mute=!!a.attr("muted"),e=new s({data:n}),i[e.data.id]=e,e.render(),o.replaceWith(e.$el)}),i}}));return{VideoInsert:s}})}(jQuery);