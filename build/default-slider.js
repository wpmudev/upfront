!function(t){var e=function(t,e,i){var s,n,a,r=null,l=0;i||(i={});var d=function(){l=i.leading===!1?0:(new Date).getTime(),r=null,a=t.apply(s,n),r||(s=n=null)};return function(){var o=(new Date).getTime();l||i.leading!==!1||(l=o);var c=e-(o-l);return s=this,n=arguments,0>=c||c>e?(clearTimeout(r),r=null,l=o,a=t.apply(s,n),r||(s=n=null)):r||i.trailing===!1||(r=setTimeout(d,c)),a}};t.fn.upfront_default_slider=function(e){var s,n="string"==typeof e;return this.each(function(){var a=t(this),r=a.data("uslider");r?n&&(s=r.callMethod(e)):n?t.error("Can't call the ueditor method "+e+". The slider is not initialized"):a.data("uslider",new i(a,e))}),1==this.length&"undefined"!=typeof s?s:this};var i=function(e,i){var s=t.extend({auto:!0,interval:5e3,auto_height:!0,control:"outside",control_num:!0,control_next_prev:!0,show_control:"always",effect:"crossfade",classname:{slider:"upfront-default-slider",slider_wrap:"upfront-default-slider-wrap",item:"upfront-default-slider-item",nav:"upfront-default-slider-nav",nav_item:"upfront-default-slider-nav-item",prev:"upfront-default-slider-nav-prev",next:"upfront-default-slider-nav-next"},adjust_slide_size:!0,starting_slide:0,caption_height:!1},i),n=s.item?e.find(">"+s.item):e.find(">."+s.classname.item);this.$slider=e.data("slider-applied",!0).addClass(s.classname.slider).append('<div class="'+s.classname.slider_wrap+'" />'),this.opts=s,this.index=0,this.pause=!1,this.timer=!1,this.update_configs(),this.update_items(n),this.$slider.append(t('<div class="'+s.classname.nav+'" />')),this.update_nav(),s.control_next_prev&&this.prev_next_navigation(),this.slider_switch(s.starting_slide),this.update_auto_slide(),this.bind_events(),this.$slider.trigger("rendered")};i.prototype={callMethod:function(t){switch(t){case"next":this.next();break;case"prev":this.prev()}},update_configs:function(){var t=this.$slider,e=t.attr("data-slider-auto"),i=this.opts;t.removeClass(i.classname.slider+"-control-"+i.control),t.removeClass(i.classname.slider+"-control-"+i.show_control),e="string"!=typeof e?i.auto:"0"==e?!1:!0,i.auto=e,i.interval=parseInt(t.attr("data-slider-interval")||i.interval,10),i.effect=t.attr("data-slider-effect")||i.effect,i.control=t.attr("data-slider-control")||i.control,i.show_control=t.attr("data-slider-show-control")||i.show_control,i.caption_height=1===parseInt(t.attr("data-caption_height")||i.caption_height,10),t.addClass(i.classname.slider+"-control-"+i.control),t.addClass(i.classname.slider+"-control-"+i.show_control)},update_items:function(e){var i=this.$slider,s=this.opts,n=i.find("."+s.classname.slider_wrap);this.items=e,n.html("").append(this.items),this.items.each(function(e,i){var s=t(i),n=s.data("caption-selector"),a=s.data("caption"),r=s.find(".uslide-caption");n||a?(r.length||(r=t('<div class="uslide-caption" />'),s.append(r)),n?r.html(t(n).html()):r.html(a)):r.length&&r.remove()}),this.items.addClass(s.classname.item),s.auto_height?(this.calc_height(),i.find("img").one("load",t.proxy(this.calc_height,this))):s.adjust_slide_size&&this.adjust_slide_size()},calc_height:function(){var e,i=this;this.$slider.css("height",9999),this.items.each(function(){var s=t(this).find("img"),n=t(this).find(".uslide-caption"),a=i.opts.caption_height?n.outerHeight(!0):0,r=s.height()+a;e=e>r?e:r}),this.$slider.css({"padding-top":15*Math.ceil(e/15),height:"auto"})},adjust_slide_size:function(){var e=this.$slider.outerHeight(),i=this.$slider.outerWidth();this.items.each(function(){var s,n,a=t(this).find("img");a.css({height:"",width:""}),s=a.height(),n=a.width(),e/i>s/n?a.css({height:"100%",width:"auto",marginLeft:(i-Math.round(e/s*n))/2,marginTop:""}):a.css({height:"auto",width:"100%",marginLeft:"",marginTop:(e-Math.round(i/n*s))/2})})},update_nav:function(){var e=this,i=this.opts,s=this.$slider.find("."+i.classname.nav);s.html(""),i.control_num&&(this.items.each(function(t){s.append('<i class="'+i.classname.nav_item+" uslider-dotnav-"+t+'" data-slider-index="'+t+'">'+t+"</i>")}),this.$slider.on("click","."+i.classname.nav_item,function(i){i.preventDefault();var s=t(this).data("slider-index");e.slider_switch(s),e.pause=!0}))},prev_next_navigation:function(){var t=this,e=this.opts;this.$slider.append('<div class="'+e.classname.prev+'" /><div class="'+e.classname.next+'" />').on("click","."+e.classname.prev,function(e){e.preventDefault(),t.prev()}).on("click","."+e.classname.next,function(e){e.preventDefault(),t.next()})},next:function(){var t=this.opts,e=t.effect;this.slider_switch(this.index+1>=this.items.length?0:this.index+1,!1,e),this.pause=!0},prev:function(){var t=this.opts,e="slide-left"==t.effect?"slide-right":"slide-right"==t.effect?"slide-left":"slide-down"==t.effect?"slide-up":"slide-up"==t.effect?"slide-down":"crossfade";this.slider_switch(this.index>0?this.index-1:this.items.length-1,!1,e),this.pause=!0},slider_switch:function(e,i,s){var n=this.opts,a=this.$slider.find(n.classname.nav),r=this.$slider,l=a.find("."+n.classname.nav_item).eq(e),d=this.items.eq(e),o=r.find("."+n.classname.item+"-current"),c="animationend.slider webkitAnimationEnd.slider MSAnimationEnd.slider oAnimationEnd.slider webkitTransitionEnd.slider otransitionend.slider oTransitionEnd.slider msTransitionEnd.slider transitionend.slider";s||(s=n.effect),d.hasClass(n.classname.item+"-current")||i&&this.pause||(r.trigger("slideout",o).find("div.slide-previous").removeClass("slide-previous"),o.removeClass(n.classname.item+"-current").addClass("slide-previous"),d.addClass(n.classname.item+"-current"),a.find("."+n.classname.nav_item+"-selected").removeClass(n.classname.nav_item+"-selected"),l.addClass(n.classname.nav_item+"-selected"),this.index=e,d.addClass(n.classname.item+"-effect-"+s),d.one(c,function(){t(this).removeClass(n.classname.item+"-effect-"+s),d.hasClass(n.classname.item+"-current")&&r.trigger("slidein",[d,e]),d.off(c)}),r.find(".upfront-default-slider-nav-item").removeClass("uslider-dotnav-current"),r.find(".uslider-dotnav-"+e).addClass("uslider-dotnav-current")),this.pause=!1},update_auto_slide:function(){var t=this,e=this.opts;this.timer&&clearInterval(this.timer),e.auto&&e.interval>999&&(this.timer=setInterval(function(){t.slider_switch(t.index+1>=t.items.length?0:t.index+1,!0)},e.interval))},bind_events:function(){var e=this,i=e.$slider,s=e.opts;i.on("refresh",function(){var n=s.item?i.find(">"+s.item):i.find(">."+s.classname.item),a=n.length,r=e.items.length;e.update_configs(),e.update_auto_slide(),a?(e.update_items(n),e.update_nav(),a!=r&&e.slider_switch(s.starting_slide)):s.auto_height&&e.calc_height(),!s.auto_height&&s.adjust_slide_size&&(e.adjust_slide_size(),e.items.find("img").one("load",t.proxy(e.adjust_slide_size,e)))}).on("pause",function(){clearInterval(e.timer)}).on("resume",function(){e.update_auto_slide()})}},t(document).ready(function(){var i={item:".upfront-inserted_image-wrapper",control_next_prev:!1};t(".upfront-inline_post-slider").upfront_default_slider(i);var s={auto_height:!1,control:"inside"},n=function(){t(".upfront-bg-slider").each(function(){"none"!=t(this).closest(".upfront-output-bg-overlay").css("display")&&t(this).upfront_default_slider(s)})};n(),t(window).on("load",function(){t(".upfront-inline_post-slider, .upfront-bg-slider").trigger("refresh")});var a=e(function(){n(),t(".upfront-inline_post-slider, .upfront-bg-slider").trigger("refresh")},100);t(window).on("resize",a),t(document).on("upfront-load",function(){Upfront.Events.on("application:mode:after_switch",function(){t(".upfront-inline_post-slider").upfront_default_slider(i)}),Upfront.Events.on("entity:background:update",function(e,i){var n=e.$el.find(".upfront-region-bg-slider");n.length&&n.each(function(){t(this).data("slider-applied")?t(this).trigger("refresh"):t(this).upfront_default_slider(s)})})})})}(jQuery);